<!DOCTYPE html>
<html lang="en">

<head>
    <!-- body starts at 3567 -->
    <link rel='shortcut icon' type='image/x-icon' href='./favicon.ico' />
    <script>
        function lamejs() {
            function U(f) { return new Int32Array(f) } function G(f) { return new Float32Array(f) } function ha(f) { if (1 == f.length) return G(f[0]); var k = f[0]; f = f.slice(1); for (var r = [], x = 0; x < k; x++)r.push(ha(f)); return r } function Ua(f) { if (1 == f.length) return U(f[0]); var k = f[0]; f = f.slice(1); for (var r = [], x = 0; x < k; x++)r.push(Ua(f)); return r } function fc(f) { if (1 == f.length) return new Int16Array(f[0]); var k = f[0]; f = f.slice(1); for (var r = [], x = 0; x < k; x++)r.push(fc(f)); return r } function Tb(f) {
                if (1 == f.length) return Array(f[0]);
                var k = f[0]; f = f.slice(1); for (var r = [], x = 0; x < k; x++)r.push(Tb(f)); return r
            } function pa(f) { this.ordinal = f } function J(f) { this.ordinal = f } function ka(f) { this.ordinal = function () { return f } } function ic() { this.getLameVersion = function () { return "3.98.4" }; this.getLameShortVersion = function () { return "3.98.4" }; this.getLameVeryShortVersion = function () { return "LAME3.98r" }; this.getPsyVersion = function () { return "0.93" }; this.getLameUrl = function () { return "http://www.mp3dev.org/" }; this.getLameOsBitness = function () { return "32bits" } }
            function fb() {
                function x(a) { this.bits = 0 | a } function k(a, e, c, b, g, l) { e = .5946 / e; for (a >>= 1; 0 != a--;)g[l++] = e > c[b++] ? 0 : 1, g[l++] = e > c[b++] ? 0 : 1 } function r(a, e, c, b, g, l) { a >>= 1; var h = a % 2; for (a >>= 1; 0 != a--;) { var p = c[b++] * e; var m = c[b++] * e; var n = 0 | p; var d = c[b++] * e; var z = 0 | m; var E = c[b++] * e; var f = 0 | d; p += u.adj43[n]; n = 0 | E; m += u.adj43[z]; g[l++] = 0 | p; d += u.adj43[f]; g[l++] = 0 | m; E += u.adj43[n]; g[l++] = 0 | d; g[l++] = 0 | E } 0 != h && (p = c[b++] * e, m = c[b++] * e, p += u.adj43[0 | p], m += u.adj43[0 | m], g[l++] = 0 | p, g[l++] = 0 | m) } function K(a, e, c, b) {
                    var m, g =
                        e, h = m = 0; do { var p = a[g++], n = a[g++]; m < p && (m = p); h < n && (h = n) } while (g < c); m < h && (m = h); switch (m) {
                            case 0: return m; case 1: g = e; e = 0; m = v.ht[1].hlen; do h = 2 * a[g + 0] + a[g + 1], g += 2, e += m[h]; while (g < c); b.bits += e; return 1; case 2: case 3: g = e; e = d[m - 1]; m = 0; h = v.ht[e].xlen; p = 2 == e ? v.table23 : v.table56; do n = a[g + 0] * h + a[g + 1], g += 2, m += p[n]; while (g < c); a = m & 65535; m >>= 16; m > a && (m = a, e++); b.bits += m; return e; case 4: case 5: case 6: case 7: case 8: case 9: case 10: case 11: case 12: case 13: case 14: case 15: g = e; e = d[m - 1]; var p = h = m = 0, n = v.ht[e].xlen, l = v.ht[e].hlen,
                                f = v.ht[e + 1].hlen, q = v.ht[e + 2].hlen; do { var D = a[g + 0] * n + a[g + 1], g = g + 2; m += l[D]; h += f[D]; p += q[D] } while (g < c); a = e; m > h && (m = h, a++); m > p && (m = p, a = e + 2); b.bits += m; return a; default: if (m > Y.IXMAX_VAL) return b.bits = Y.LARGE_BITS, -1; m -= 15; for (g = 24; 32 > g && !(v.ht[g].linmax >= m); g++); for (h = g - 8; 24 > h && !(v.ht[h].linmax >= m); h++); m = h; p = 65536 * v.ht[m].xlen + v.ht[g].xlen; h = 0; do n = a[e++], l = a[e++], 0 != n && (14 < n && (n = 15, h += p), n *= 16), 0 != l && (14 < l && (l = 15, h += p), n += l), h += v.largetbl[n]; while (e < c); a = h & 65535; h >>= 16; h > a && (h = a, m = g); b.bits += h; return m
                        }
                }
                function C(a, e, b, c, g, l, h, p) { for (var m = e.big_values, n = 2; n < f.SBMAX_l + 1; n++) { var d = a.scalefac_band.l[n]; if (d >= m) break; var E = g[n - 2] + e.count1bits; if (b.part2_3_length <= E) break; E = new x(E); d = K(c, d, m, E); E = E.bits; b.part2_3_length <= E || (b.assign(e), b.part2_3_length = E, b.region0_count = l[n - 2], b.region1_count = n - 2 - l[n - 2], b.table_select[0] = h[n - 2], b.table_select[1] = p[n - 2], b.table_select[2] = d) } } var u = null; this.qupvt = null; this.setModules = function (a) { u = this.qupvt = a }; var fa = [[0, 0], [0, 0], [0, 0], [0, 0], [0, 0], [0, 1], [1, 1], [1,
                    1], [1, 2], [2, 2], [2, 3], [2, 3], [3, 4], [3, 4], [3, 4], [4, 5], [4, 5], [4, 6], [5, 6], [5, 6], [5, 7], [6, 7], [6, 7]], d = [1, 2, 5, 7, 7, 10, 10, 13, 13, 13, 13, 13, 13, 13, 13]; this.noquant_count_bits = function (a, e, b) {
                        var c = e.l3_enc, m = Math.min(576, e.max_nonzero_coeff + 2 >> 1 << 1); null != b && (b.sfb_count1 = 0); for (; 1 < m && 0 == (c[m - 1] | c[m - 2]); m -= 2); e.count1 = m; for (var g = 0, h = 0; 3 < m && !(1 < ((c[m - 1] | c[m - 2] | c[m - 3] | c[m - 4]) & 2147483647)); m -= 4) { var p = 2 * (2 * (2 * c[m - 4] + c[m - 3]) + c[m - 2]) + c[m - 1]; g += v.t32l[p]; h += v.t33l[p] } p = g; e.count1table_select = 0; g > h && (p = h, e.count1table_select =
                            1); e.count1bits = p; e.big_values = m; if (0 == m) return p; e.block_type == f.SHORT_TYPE ? (g = 3 * a.scalefac_band.s[3], g > e.big_values && (g = e.big_values), h = e.big_values) : e.block_type == f.NORM_TYPE ? (g = e.region0_count = a.bv_scf[m - 2], h = e.region1_count = a.bv_scf[m - 1], h = a.scalefac_band.l[g + h + 2], g = a.scalefac_band.l[g + 1], h < m && (p = new x(p), e.table_select[2] = K(c, h, m, p), p = p.bits)) : (e.region0_count = 7, e.region1_count = f.SBMAX_l - 1 - 7 - 1, g = a.scalefac_band.l[8], h = m, g > h && (g = h)); g = Math.min(g, m); h = Math.min(h, m); 0 < g && (p = new x(p), e.table_select[0] =
                                K(c, 0, g, p), p = p.bits); g < h && (p = new x(p), e.table_select[1] = K(c, g, h, p), p = p.bits); 2 == a.use_best_huffman && (e.part2_3_length = p, best_huffman_divide(a, e), p = e.part2_3_length); if (null != b && e.block_type == f.NORM_TYPE) { for (c = 0; a.scalefac_band.l[c] < e.big_values;)c++; b.sfb_count1 = c } return p
                    }; this.count_bits = function (a, e, c, b) {
                        var m = c.l3_enc, g = Y.IXMAX_VAL / u.IPOW20(c.global_gain); if (c.xrpow_max > g) return Y.LARGE_BITS; var g = u.IPOW20(c.global_gain), h, p = 0, n = 0, l = 0, d = 0, q = 0, w = m, t = 0, D = e, H = 0; var B = null != b && c.global_gain == b.global_gain;
                        var Q = c.block_type == f.SHORT_TYPE ? 38 : 21; for (h = 0; h <= Q; h++) {
                            var V = -1; if (B || c.block_type == f.NORM_TYPE) V = c.global_gain - (c.scalefac[h] + (0 != c.preflag ? u.pretab[h] : 0) << c.scalefac_scale + 1) - 8 * c.subblock_gain[c.window[h]]; if (B && b.step[h] == V) 0 != n && (r(n, g, D, H, w, t), n = 0), 0 != l && (k(l, g, D, H, w, t), l = 0); else {
                                var N = c.width[h]; p + c.width[h] > c.max_nonzero_coeff && (h = c.max_nonzero_coeff - p + 1, qa.fill(m, c.max_nonzero_coeff, 576, 0), N = h, 0 > N && (N = 0), h = Q + 1); 0 == n && 0 == l && (w = m, t = q, D = e, H = d); null != b && 0 < b.sfb_count1 && h >= b.sfb_count1 && 0 < b.step[h] &&
                                    V >= b.step[h] ? (0 != n && (r(n, g, D, H, w, t), n = 0, w = m, t = q, D = e, H = d), l += N) : (0 != l && (k(l, g, D, H, w, t), l = 0, w = m, t = q, D = e, H = d), n += N); if (0 >= N) { 0 != l && (k(l, g, D, H, w, t), l = 0); 0 != n && (r(n, g, D, H, w, t), n = 0); break }
                            } h <= Q && (q += c.width[h], d += c.width[h], p += c.width[h])
                        } 0 != n && r(n, g, D, H, w, t); 0 != l && k(l, g, D, H, w, t); if (0 != (a.substep_shaping & 2)) for (g = 0, Q = .634521682242439 / u.IPOW20(c.global_gain + c.scalefac_scale), p = 0; p < c.sfbmax; p++)if (B = c.width[p], 0 == a.pseudohalf[p]) g += B; else for (n = g, g += B; n < g; ++n)m[n] = e[n] >= Q ? m[n] : 0; return this.noquant_count_bits(a,
                            c, b)
                    }; this.best_huffman_divide = function (a, e) {
                        var c = new rb, b = e.l3_enc, g = U(23), l = U(23), h = U(23), p = U(23); if (e.block_type != f.SHORT_TYPE || 1 != a.mode_gr) {
                            c.assign(e); if (e.block_type == f.NORM_TYPE) {
                                for (var d = e.big_values, q = 0; 22 >= q; q++)g[q] = Y.LARGE_BITS; for (q = 0; 16 > q; q++) { var w = a.scalefac_band.l[q + 1]; if (w >= d) break; for (var t = 0, D = new x(t), k = K(b, 0, w, D), t = D.bits, I = 0; 8 > I; I++) { var H = a.scalefac_band.l[q + I + 2]; if (H >= d) break; D = t; D = new x(D); H = K(b, w, H, D); D = D.bits; g[q + I] > D && (g[q + I] = D, l[q + I] = q, h[q + I] = k, p[q + I] = H) } } C(a, c, e,
                                    b, g, l, h, p)
                            } d = c.big_values; if (!(0 == d || 1 < (b[d - 2] | b[d - 1]) || (d = e.count1 + 2, 576 < d))) {
                                c.assign(e); c.count1 = d; for (w = q = 0; d > c.big_values; d -= 4)t = 2 * (2 * (2 * b[d - 4] + b[d - 3]) + b[d - 2]) + b[d - 1], q += v.t32l[t], w += v.t33l[t]; c.big_values = d; c.count1table_select = 0; q > w && (q = w, c.count1table_select = 1); c.count1bits = q; c.block_type == f.NORM_TYPE ? C(a, c, e, b, g, l, h, p) : (c.part2_3_length = q, q = a.scalefac_band.l[8], q > d && (q = d), 0 < q && (a = new x(c.part2_3_length), c.table_select[0] = K(b, 0, q, a), c.part2_3_length = a.bits), d > q && (a = new x(c.part2_3_length),
                                    c.table_select[1] = K(b, q, d, a), c.part2_3_length = a.bits), e.part2_3_length > c.part2_3_length && e.assign(c))
                            }
                        }
                    }; var c = [1, 1, 1, 1, 8, 2, 2, 2, 4, 4, 4, 8, 8, 8, 16, 16], w = [1, 2, 4, 8, 1, 2, 4, 8, 2, 4, 8, 2, 4, 8, 4, 8], a = [0, 0, 0, 0, 3, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4], b = [0, 1, 2, 3, 0, 1, 2, 3, 1, 2, 3, 1, 2, 3, 2, 3]; fb.slen1_tab = a; fb.slen2_tab = b; this.best_scalefac_store = function (e, g, m, n) {
                        var l = n.tt[g][m], d, h, p = 0; for (d = h = 0; d < l.sfbmax; d++) { var q = l.width[d]; h += q; for (q = -q; 0 > q && 0 == l.l3_enc[q + h]; q++); 0 == q && (l.scalefac[d] = p = -2) } if (0 == l.scalefac_scale && 0 == l.preflag) {
                            for (d =
                                h = 0; d < l.sfbmax; d++)0 < l.scalefac[d] && (h |= l.scalefac[d]); if (0 == (h & 1) && 0 != h) { for (d = 0; d < l.sfbmax; d++)0 < l.scalefac[d] && (l.scalefac[d] >>= 1); l.scalefac_scale = p = 1 }
                        } if (0 == l.preflag && l.block_type != f.SHORT_TYPE && 2 == e.mode_gr) { for (d = 11; d < f.SBPSY_l && !(l.scalefac[d] < u.pretab[d] && -2 != l.scalefac[d]); d++); if (d == f.SBPSY_l) { for (d = 11; d < f.SBPSY_l; d++)0 < l.scalefac[d] && (l.scalefac[d] -= u.pretab[d]); l.preflag = p = 1 } } for (d = 0; 4 > d; d++)n.scfsi[m][d] = 0; if (2 == e.mode_gr && 1 == g && n.tt[0][m].block_type != f.SHORT_TYPE && n.tt[1][m].block_type !=
                            f.SHORT_TYPE) {
                                g = n.tt[1][m]; h = n.tt[0][m]; for (p = 0; p < v.scfsi_band.length - 1; p++) { for (d = v.scfsi_band[p]; d < v.scfsi_band[p + 1] && !(h.scalefac[d] != g.scalefac[d] && 0 <= g.scalefac[d]); d++); if (d == v.scfsi_band[p + 1]) { for (d = v.scfsi_band[p]; d < v.scfsi_band[p + 1]; d++)g.scalefac[d] = -1; n.scfsi[m][p] = 1 } } for (d = n = m = 0; 11 > d; d++)-1 != g.scalefac[d] && (n++, m < g.scalefac[d] && (m = g.scalefac[d])); for (q = h = 0; d < f.SBPSY_l; d++)-1 != g.scalefac[d] && (q++, h < g.scalefac[d] && (h = g.scalefac[d])); for (p = 0; 16 > p; p++)m < c[p] && h < w[p] && (d = a[p] * n + b[p] * q, g.part2_length >
                                    d && (g.part2_length = d, g.scalefac_compress = p)); p = 0
                        } for (d = 0; d < l.sfbmax; d++)-2 == l.scalefac[d] && (l.scalefac[d] = 0); 0 != p && (2 == e.mode_gr ? this.scale_bitcount(l) : this.scale_bitcount_lsf(e, l))
                    }; var B = [0, 18, 36, 54, 54, 36, 54, 72, 54, 72, 90, 72, 90, 108, 108, 126], e = [0, 18, 36, 54, 51, 35, 53, 71, 52, 70, 88, 69, 87, 105, 104, 122], l = [0, 10, 20, 30, 33, 21, 31, 41, 32, 42, 52, 43, 53, 63, 64, 74]; this.scale_bitcount = function (a) {
                        var b, g = 0, d = 0, q = a.scalefac; if (a.block_type == f.SHORT_TYPE) { var t = B; 0 != a.mixed_block_flag && (t = e) } else if (t = l, 0 == a.preflag) {
                            for (b =
                                11; b < f.SBPSY_l && !(q[b] < u.pretab[b]); b++); if (b == f.SBPSY_l) for (a.preflag = 1, b = 11; b < f.SBPSY_l; b++)q[b] -= u.pretab[b]
                        } for (b = 0; b < a.sfbdivide; b++)g < q[b] && (g = q[b]); for (; b < a.sfbmax; b++)d < q[b] && (d = q[b]); a.part2_length = Y.LARGE_BITS; for (b = 0; 16 > b; b++)g < c[b] && d < w[b] && a.part2_length > t[b] && (a.part2_length = t[b], a.scalefac_compress = b); return a.part2_length == Y.LARGE_BITS
                    }; var q = [[15, 15, 7, 7], [15, 15, 7, 0], [7, 3, 0, 0], [15, 31, 31, 0], [7, 7, 7, 0], [3, 3, 0, 0]]; this.scale_bitcount_lsf = function (a, e) {
                        var b, c, d, l, h = U(4), p = e.scalefac; a =
                            0 != e.preflag ? 2 : 0; for (d = 0; 4 > d; d++)h[d] = 0; if (e.block_type == f.SHORT_TYPE) { var A = 1; var w = u.nr_of_sfb_block[a][A]; for (b = l = 0; 4 > b; b++) { var t = w[b] / 3; for (d = 0; d < t; d++, l++)for (c = 0; 3 > c; c++)p[3 * l + c] > h[b] && (h[b] = p[3 * l + c]) } } else for (A = 0, w = u.nr_of_sfb_block[a][A], b = l = 0; 4 > b; b++)for (t = w[b], d = 0; d < t; d++, l++)p[l] > h[b] && (h[b] = p[l]); w = !1; for (b = 0; 4 > b; b++)h[b] > q[a][b] && (w = !0); if (!w) {
                                e.sfb_partition_table = u.nr_of_sfb_block[a][A]; for (b = 0; 4 > b; b++)e.slen[b] = g[h[b]]; A = e.slen[0]; b = e.slen[1]; h = e.slen[2]; t = e.slen[3]; switch (a) {
                                    case 0: e.scalefac_compress =
                                        (5 * A + b << 4) + (h << 2) + t; break; case 1: e.scalefac_compress = 400 + (5 * A + b << 2) + h; break; case 2: e.scalefac_compress = 500 + 3 * A + b; break; default: S.err.printf("intensity stereo not implemented yet\n")
                                }
                            } if (!w) for (b = e.part2_length = 0; 4 > b; b++)e.part2_length += e.slen[b] * e.sfb_partition_table[b]; return w
                    }; var g = [0, 1, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4]; this.huffman_init = function (a) {
                        for (var e = 2; 576 >= e; e += 2) {
                            for (var b = 0, c; a.scalefac_band.l[++b] < e;); for (c = fa[b][0]; a.scalefac_band.l[c + 1] > e;)c--; 0 > c && (c = fa[b][0]); a.bv_scf[e - 2] = c; for (c =
                                fa[b][1]; a.scalefac_band.l[c + a.bv_scf[e - 2] + 2] > e;)c--; 0 > c && (c = fa[b][1]); a.bv_scf[e - 1] = c
                        }
                    }
            } function ca() {
                function f(d, c, f, a, b, k) { for (; 0 != b--;)f[a] = 1E-10 + d[c + 0] * k[0] - f[a - 1] * k[1] + d[c - 1] * k[2] - f[a - 2] * k[3] + d[c - 2] * k[4] - f[a - 3] * k[5] + d[c - 3] * k[6] - f[a - 4] * k[7] + d[c - 4] * k[8] - f[a - 5] * k[9] + d[c - 5] * k[10] - f[a - 6] * k[11] + d[c - 6] * k[12] - f[a - 7] * k[13] + d[c - 7] * k[14] - f[a - 8] * k[15] + d[c - 8] * k[16] - f[a - 9] * k[17] + d[c - 9] * k[18] - f[a - 10] * k[19] + d[c - 10] * k[20], ++a, ++c } function k(d, c, f, a, b, k) {
                    for (; 0 != b--;)f[a] = d[c + 0] * k[0] - f[a - 1] * k[1] + d[c - 1] * k[2] -
                        f[a - 2] * k[3] + d[c - 2] * k[4], ++a, ++c
                } function r(d) { return d * d } var K = ca.RMS_WINDOW_TIME_NUMERATOR, C = ca.RMS_WINDOW_TIME_DENOMINATOR, u = [[.038575994352, -3.84664617118067, -.02160367184185, 7.81501653005538, -.00123395316851, -11.34170355132042, -9.291677959E-5, 13.05504219327545, -.01655260341619, -12.28759895145294, .02161526843274, 9.4829380631979, -.02074045215285, -5.87257861775999, .00594298065125, 2.75465861874613, .00306428023191, -.86984376593551, 1.2025322027E-4, .13919314567432, .00288463683916], [.0541865640643, -3.47845948550071,
                    -.02911007808948, 6.36317777566148, -.00848709379851, -8.54751527471874, -.00851165645469, 9.4769360780128, -.00834990904936, -8.81498681370155, .02245293253339, 6.85401540936998, -.02596338512915, -4.39470996079559, .01624864962975, 2.19611684890774, -.00240879051584, -.75104302451432, .00674613682247, .13149317958808, -.00187763777362], [.15457299681924, -2.37898834973084, -.09331049056315, 2.84868151156327, -.06247880153653, -2.64577170229825, .02163541888798, 2.23697657451713, -.05588393329856, -1.67148153367602, .04781476674921,
                    1.00595954808547, .00222312597743, -.45953458054983, .03174092540049, .16378164858596, -.01390589421898, -.05032077717131, .00651420667831, .0234789740702, -.00881362733839], [.30296907319327, -1.61273165137247, -.22613988682123, 1.0797749225997, -.08587323730772, -.2565625775407, .03282930172664, -.1627671912044, -.00915702933434, -.22638893773906, -.02364141202522, .39120800788284, -.00584456039913, -.22138138954925, .06276101321749, .04500235387352, -8.28086748E-6, .02005851806501, .00205861885564, .00302439095741, -.02950134983287],
                [.33642304856132, -1.49858979367799, -.2557224142557, .87350271418188, -.11828570177555, .12205022308084, .11921148675203, -.80774944671438, -.07834489609479, .47854794562326, -.0046997791438, -.12453458140019, -.0058950022444, -.04067510197014, .05724228140351, .08333755284107, .00832043980773, -.04237348025746, -.0163538138454, .02977207319925, -.0176017656815], [.4491525660845, -.62820619233671, -.14351757464547, .29661783706366, -.22784394429749, -.372563729424, -.01419140100551, .00213767857124, .04078262797139, -.42029820170918,
                    -.12398163381748, .22199650564824, .04097565135648, .00613424350682, .10478503600251, .06747620744683, -.01863887810927, .05784820375801, -.03193428438915, .03222754072173, .00541907748707], [.56619470757641, -1.04800335126349, -.75464456939302, .29156311971249, .1624213774223, -.26806001042947, .16744243493672, .00819999645858, -.18901604199609, .45054734505008, .3093178284183, -.33032403314006, -.27562961986224, .0673936833311, .00647310677246, -.04784254229033, .08647503780351, .01639907836189, -.0378898455484, .01807364323573,
                    -.00588215443421], [.58100494960553, -.51035327095184, -.53174909058578, -.31863563325245, -.14289799034253, -.20256413484477, .17520704835522, .1472815413433, .02377945217615, .38952639978999, .15558449135573, -.23313271880868, -.25344790059353, -.05246019024463, .01628462406333, -.02505961724053, .06920467763959, .02442357316099, -.03721611395801, .01818801111503, -.00749618797172], [.53648789255105, -.2504987195602, -.42163034350696, -.43193942311114, -.00275953611929, -.03424681017675, .04267842219415, -.04678328784242, -.10214864179676,
                    .26408300200955, .14590772289388, .15113130533216, -.02459864859345, -.17556493366449, -.11202315195388, -.18823009262115, -.04060034127, .05477720428674, .0478866554818, .0470440968812, -.02217936801134]], v = [[.98621192462708, -1.97223372919527, -1.97242384925416, .97261396931306, .98621192462708], [.98500175787242, -1.96977855582618, -1.97000351574484, .9702284756635, .98500175787242], [.97938932735214, -1.95835380975398, -1.95877865470428, .95920349965459, .97938932735214], [.97531843204928, -1.95002759149878, -1.95063686409857,
                        .95124613669835, .97531843204928], [.97316523498161, -1.94561023566527, -1.94633046996323, .94705070426118, .97316523498161], [.96454515552826, -1.92783286977036, -1.92909031105652, .93034775234268, .96454515552826], [.96009142950541, -1.91858953033784, -1.92018285901082, .92177618768381, .96009142950541], [.95856916599601, -1.9154210807478, -1.91713833199203, .91885558323625, .95856916599601], [.94597685600279, -1.88903307939452, -1.89195371200558, .89487434461664, .94597685600279]]; this.InitGainAnalysis = function (d, c) {
                            a: {
                                for (var f =
                                    0; f < MAX_ORDER; f++)d.linprebuf[f] = d.lstepbuf[f] = d.loutbuf[f] = d.rinprebuf[f] = d.rstepbuf[f] = d.routbuf[f] = 0; switch (0 | c) { case 48E3: d.reqindex = 0; break; case 44100: d.reqindex = 1; break; case 32E3: d.reqindex = 2; break; case 24E3: d.reqindex = 3; break; case 22050: d.reqindex = 4; break; case 16E3: d.reqindex = 5; break; case 12E3: d.reqindex = 6; break; case 11025: d.reqindex = 7; break; case 8E3: d.reqindex = 8; break; default: c = INIT_GAIN_ANALYSIS_ERROR; break a }d.sampleWindow = 0 | (c * K + C - 1) / C; d.lsum = 0; d.rsum = 0; d.totsamp = 0; qa.ill(d.A, 0); c = INIT_GAIN_ANALYSIS_OK
                            } if (c !=
                                INIT_GAIN_ANALYSIS_OK) return INIT_GAIN_ANALYSIS_ERROR; d.linpre = MAX_ORDER; d.rinpre = MAX_ORDER; d.lstep = MAX_ORDER; d.rstep = MAX_ORDER; d.lout = MAX_ORDER; d.rout = MAX_ORDER; qa.fill(d.B, 0); return INIT_GAIN_ANALYSIS_OK
                        }; this.AnalyzeSamples = function (d, c, w, a, b, B, e) {
                            if (0 == B) return GAIN_ANALYSIS_OK; var l = 0; var q = B; switch (e) { case 1: a = c; b = w; break; case 2: break; default: return GAIN_ANALYSIS_ERROR }B < MAX_ORDER ? (S.arraycopy(c, w, d.linprebuf, MAX_ORDER, B), S.arraycopy(a, b, d.rinprebuf, MAX_ORDER, B)) : (S.arraycopy(c, w, d.linprebuf,
                                MAX_ORDER, MAX_ORDER), S.arraycopy(a, b, d.rinprebuf, MAX_ORDER, MAX_ORDER)); for (; 0 < q;) {
                                    var g = q > d.sampleWindow - d.totsamp ? d.sampleWindow - d.totsamp : q; if (l < MAX_ORDER) { e = d.linpre + l; var t = d.linprebuf; var D = d.rinpre + l; var m = d.rinprebuf; g > MAX_ORDER - l && (g = MAX_ORDER - l) } else e = w + l, t = c, D = b + l, m = a; f(t, e, d.lstepbuf, d.lstep + d.totsamp, g, u[d.reqindex]); f(m, D, d.rstepbuf, d.rstep + d.totsamp, g, u[d.reqindex]); k(d.lstepbuf, d.lstep + d.totsamp, d.loutbuf, d.lout + d.totsamp, g, v[d.reqindex]); k(d.rstepbuf, d.rstep + d.totsamp, d.routbuf, d.rout +
                                        d.totsamp, g, v[d.reqindex]); e = d.lout + d.totsamp; t = d.loutbuf; D = d.rout + d.totsamp; m = d.routbuf; for (var n = g % 8; 0 != n--;)d.lsum += r(t[e++]), d.rsum += r(m[D++]); for (n = g / 8; 0 != n--;)d.lsum += r(t[e + 0]) + r(t[e + 1]) + r(t[e + 2]) + r(t[e + 3]) + r(t[e + 4]) + r(t[e + 5]) + r(t[e + 6]) + r(t[e + 7]), e += 8, d.rsum += r(m[D + 0]) + r(m[D + 1]) + r(m[D + 2]) + r(m[D + 3]) + r(m[D + 4]) + r(m[D + 5]) + r(m[D + 6]) + r(m[D + 7]), D += 8; q -= g; l += g; d.totsamp += g; d.totsamp == d.sampleWindow && (e = 10 * ca.STEPS_per_dB * Math.log10((d.lsum + d.rsum) / d.totsamp * .5 + 1E-37), e = 0 >= e ? 0 : 0 | e, e >= d.A.length && (e =
                                            d.A.length - 1), d.A[e]++, d.lsum = d.rsum = 0, S.arraycopy(d.loutbuf, d.totsamp, d.loutbuf, 0, MAX_ORDER), S.arraycopy(d.routbuf, d.totsamp, d.routbuf, 0, MAX_ORDER), S.arraycopy(d.lstepbuf, d.totsamp, d.lstepbuf, 0, MAX_ORDER), S.arraycopy(d.rstepbuf, d.totsamp, d.rstepbuf, 0, MAX_ORDER), d.totsamp = 0); if (d.totsamp > d.sampleWindow) return GAIN_ANALYSIS_ERROR
                                } B < MAX_ORDER ? (S.arraycopy(d.linprebuf, B, d.linprebuf, 0, MAX_ORDER - B), S.arraycopy(d.rinprebuf, B, d.rinprebuf, 0, MAX_ORDER - B), S.arraycopy(c, w, d.linprebuf, MAX_ORDER - B, B), S.arraycopy(a,
                                    b, d.rinprebuf, MAX_ORDER - B, B)) : (S.arraycopy(c, w + B - MAX_ORDER, d.linprebuf, 0, MAX_ORDER), S.arraycopy(a, b + B - MAX_ORDER, d.rinprebuf, 0, MAX_ORDER)); return GAIN_ANALYSIS_OK
                        }; this.GetTitleGain = function (d) {
                            var c = d.A; var f = d.A.length, a, b = 0; for (a = 0; a < f; a++)b += c[a]; if (0 == b) c = GAIN_NOT_ENOUGH_SAMPLES; else { b = 0 | Math.ceil(b * (1 - .95)); for (a = f; 0 < a-- && !(0 >= (b -= c[a]));); c = 64.82 - a / ca.STEPS_per_dB } for (f = 0; f < d.A.length; f++)d.B[f] += d.A[f], d.A[f] = 0; for (f = 0; f < MAX_ORDER; f++)d.linprebuf[f] = d.lstepbuf[f] = d.loutbuf[f] = d.rinprebuf[f] =
                                d.rstepbuf[f] = d.routbuf[f] = 0; d.totsamp = 0; d.lsum = d.rsum = 0; return c
                        }
            } function wc() {
                function f(c, d, a, b, f, e, l, q, g, t, k, m, n, z, E) { this.vbr_q = c; this.quant_comp = d; this.quant_comp_s = a; this.expY = b; this.st_lrm = f; this.st_s = e; this.masking_adj = l; this.masking_adj_short = q; this.ath_lower = g; this.ath_curve = t; this.ath_sensitivity = k; this.interch = m; this.safejoint = n; this.sfb21mod = z; this.msfix = E } function k(c, d, a, b, f, e, l, q, g, t, k, m, n, z) {
                    this.quant_comp = d; this.quant_comp_s = a; this.safejoint = b; this.nsmsfix = f; this.st_lrm = e; this.st_s =
                        l; this.nsbass = q; this.scale = g; this.masking_adj = t; this.ath_lower = k; this.ath_curve = m; this.interch = n; this.sfscale = z
                } function r(c, d, a) {
                    var b = c.VBR == J.vbr_rh ? u : v, f = c.VBR_q_frac, e = b[d], b = b[d + 1]; e.st_lrm += f * (b.st_lrm - e.st_lrm); e.st_s += f * (b.st_s - e.st_s); e.masking_adj += f * (b.masking_adj - e.masking_adj); e.masking_adj_short += f * (b.masking_adj_short - e.masking_adj_short); e.ath_lower += f * (b.ath_lower - e.ath_lower); e.ath_curve += f * (b.ath_curve - e.ath_curve); e.ath_sensitivity += f * (b.ath_sensitivity - e.ath_sensitivity); e.interch +=
                        f * (b.interch - e.interch); e.msfix += f * (b.msfix - e.msfix); b = e.vbr_q; 0 > b && (b = 0); 9 < b && (b = 9); c.VBR_q = b; c.VBR_q_frac = 0; 0 != a ? c.quant_comp = e.quant_comp : 0 < Math.abs(c.quant_comp - -1) || (c.quant_comp = e.quant_comp); 0 != a ? c.quant_comp_short = e.quant_comp_s : 0 < Math.abs(c.quant_comp_short - -1) || (c.quant_comp_short = e.quant_comp_s); 0 != e.expY && (c.experimentalY = 0 != e.expY); 0 != a ? c.internal_flags.nsPsy.attackthre = e.st_lrm : 0 < Math.abs(c.internal_flags.nsPsy.attackthre - -1) || (c.internal_flags.nsPsy.attackthre = e.st_lrm); 0 != a ? c.internal_flags.nsPsy.attackthre_s =
                            e.st_s : 0 < Math.abs(c.internal_flags.nsPsy.attackthre_s - -1) || (c.internal_flags.nsPsy.attackthre_s = e.st_s); 0 != a ? c.maskingadjust = e.masking_adj : 0 < Math.abs(c.maskingadjust - 0) || (c.maskingadjust = e.masking_adj); 0 != a ? c.maskingadjust_short = e.masking_adj_short : 0 < Math.abs(c.maskingadjust_short - 0) || (c.maskingadjust_short = e.masking_adj_short); 0 != a ? c.ATHlower = -e.ath_lower / 10 : 0 < Math.abs(10 * -c.ATHlower - 0) || (c.ATHlower = -e.ath_lower / 10); 0 != a ? c.ATHcurve = e.ath_curve : 0 < Math.abs(c.ATHcurve - -1) || (c.ATHcurve = e.ath_curve);
                    0 != a ? c.athaa_sensitivity = e.ath_sensitivity : 0 < Math.abs(c.athaa_sensitivity - -1) || (c.athaa_sensitivity = e.ath_sensitivity); 0 < e.interch && (0 != a ? c.interChRatio = e.interch : 0 < Math.abs(c.interChRatio - -1) || (c.interChRatio = e.interch)); 0 < e.safejoint && (c.exp_nspsytune |= e.safejoint); 0 < e.sfb21mod && (c.exp_nspsytune |= e.sfb21mod << 20); 0 != a ? c.msfix = e.msfix : 0 < Math.abs(c.msfix - -1) || (c.msfix = e.msfix); 0 == a && (c.VBR_q = d, c.VBR_q_frac = f)
                } function K(c, f, a) {
                    var b = C.nearestBitrateFullIndex(f); c.VBR = J.vbr_abr; c.VBR_mean_bitrate_kbps =
                        f; c.VBR_mean_bitrate_kbps = Math.min(c.VBR_mean_bitrate_kbps, 320); c.VBR_mean_bitrate_kbps = Math.max(c.VBR_mean_bitrate_kbps, 8); c.brate = c.VBR_mean_bitrate_kbps; 320 < c.VBR_mean_bitrate_kbps && (c.disable_reservoir = !0); 0 < d[b].safejoint && (c.exp_nspsytune |= 2); 0 < d[b].sfscale && (c.internal_flags.noise_shaping = 2); if (0 < Math.abs(d[b].nsbass)) { var w = int(4 * d[b].nsbass); 0 > w && (w += 64); c.exp_nspsytune |= w << 2 } 0 != a ? c.quant_comp = d[b].quant_comp : 0 < Math.abs(c.quant_comp - -1) || (c.quant_comp = d[b].quant_comp); 0 != a ? c.quant_comp_short =
                            d[b].quant_comp_s : 0 < Math.abs(c.quant_comp_short - -1) || (c.quant_comp_short = d[b].quant_comp_s); 0 != a ? c.msfix = d[b].nsmsfix : 0 < Math.abs(c.msfix - -1) || (c.msfix = d[b].nsmsfix); 0 != a ? c.internal_flags.nsPsy.attackthre = d[b].st_lrm : 0 < Math.abs(c.internal_flags.nsPsy.attackthre - -1) || (c.internal_flags.nsPsy.attackthre = d[b].st_lrm); 0 != a ? c.internal_flags.nsPsy.attackthre_s = d[b].st_s : 0 < Math.abs(c.internal_flags.nsPsy.attackthre_s - -1) || (c.internal_flags.nsPsy.attackthre_s = d[b].st_s); 0 != a ? c.scale = d[b].scale : 0 < Math.abs(c.scale -
                                -1) || (c.scale = d[b].scale); 0 != a ? c.maskingadjust = d[b].masking_adj : 0 < Math.abs(c.maskingadjust - 0) || (c.maskingadjust = d[b].masking_adj); 0 < d[b].masking_adj ? 0 != a ? c.maskingadjust_short = .9 * d[b].masking_adj : 0 < Math.abs(c.maskingadjust_short - 0) || (c.maskingadjust_short = .9 * d[b].masking_adj) : 0 != a ? c.maskingadjust_short = 1.1 * d[b].masking_adj : 0 < Math.abs(c.maskingadjust_short - 0) || (c.maskingadjust_short = 1.1 * d[b].masking_adj); 0 != a ? c.ATHlower = -d[b].ath_lower / 10 : 0 < Math.abs(10 * -c.ATHlower - 0) || (c.ATHlower = -d[b].ath_lower / 10);
                    0 != a ? c.ATHcurve = d[b].ath_curve : 0 < Math.abs(c.ATHcurve - -1) || (c.ATHcurve = d[b].ath_curve); 0 != a ? c.interChRatio = d[b].interch : 0 < Math.abs(c.interChRatio - -1) || (c.interChRatio = d[b].interch); return f
                } var C; this.setModules = function (c) { C = c }; var u = [new f(0, 9, 9, 0, 5.2, 125, -4.2, -6.3, 4.8, 1, 0, 0, 2, 21, .97), new f(1, 9, 9, 0, 5.3, 125, -3.6, -5.6, 4.5, 1.5, 0, 0, 2, 21, 1.35), new f(2, 9, 9, 0, 5.6, 125, -2.2, -3.5, 2.8, 2, 0, 0, 2, 21, 1.49), new f(3, 9, 9, 1, 5.8, 130, -1.8, -2.8, 2.6, 3, -4, 0, 2, 20, 1.64), new f(4, 9, 9, 1, 6, 135, -.7, -1.1, 1.1, 3.5, -8, 0, 2, 0, 1.79),
                new f(5, 9, 9, 1, 6.4, 140, .5, .4, -7.5, 4, -12, 2E-4, 0, 0, 1.95), new f(6, 9, 9, 1, 6.6, 145, .67, .65, -14.7, 6.5, -19, 4E-4, 0, 0, 2.3), new f(7, 9, 9, 1, 6.6, 145, .8, .75, -19.7, 8, -22, 6E-4, 0, 0, 2.7), new f(8, 9, 9, 1, 6.6, 145, 1.2, 1.15, -27.5, 10, -23, 7E-4, 0, 0, 0), new f(9, 9, 9, 1, 6.6, 145, 1.6, 1.6, -36, 11, -25, 8E-4, 0, 0, 0), new f(10, 9, 9, 1, 6.6, 145, 2, 2, -36, 12, -25, 8E-4, 0, 0, 0)], v = [new f(0, 9, 9, 0, 4.2, 25, -7, -4, 7.5, 1, 0, 0, 2, 26, .97), new f(1, 9, 9, 0, 4.2, 25, -5.6, -3.6, 4.5, 1.5, 0, 0, 2, 21, 1.35), new f(2, 9, 9, 0, 4.2, 25, -4.4, -1.8, 2, 2, 0, 0, 2, 18, 1.49), new f(3, 9, 9, 1, 4.2, 25,
                    -3.4, -1.25, 1.1, 3, -4, 0, 2, 15, 1.64), new f(4, 9, 9, 1, 4.2, 25, -2.2, .1, 0, 3.5, -8, 0, 2, 0, 1.79), new f(5, 9, 9, 1, 4.2, 25, -1, 1.65, -7.7, 4, -12, 2E-4, 0, 0, 1.95), new f(6, 9, 9, 1, 4.2, 25, -0, 2.47, -7.7, 6.5, -19, 4E-4, 0, 0, 2), new f(7, 9, 9, 1, 4.2, 25, .5, 2, -14.5, 8, -22, 6E-4, 0, 0, 2), new f(8, 9, 9, 1, 4.2, 25, 1, 2.4, -22, 10, -23, 7E-4, 0, 0, 2), new f(9, 9, 9, 1, 4.2, 25, 1.5, 2.95, -30, 11, -25, 8E-4, 0, 0, 2), new f(10, 9, 9, 1, 4.2, 25, 2, 2.95, -36, 12, -30, 8E-4, 0, 0, 2)], d = [new k(8, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -30, 11, .0012, 1), new k(16, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -25, 11, .001, 1), new k(24,
                        9, 9, 0, 0, 6.6, 145, 0, .95, 0, -20, 11, .001, 1), new k(32, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -15, 11, .001, 1), new k(40, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -10, 11, 9E-4, 1), new k(48, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -10, 11, 9E-4, 1), new k(56, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -6, 11, 8E-4, 1), new k(64, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, -2, 11, 8E-4, 1), new k(80, 9, 9, 0, 0, 6.6, 145, 0, .95, 0, 0, 8, 7E-4, 1), new k(96, 9, 9, 0, 2.5, 6.6, 145, 0, .95, 0, 1, 5.5, 6E-4, 1), new k(112, 9, 9, 0, 2.25, 6.6, 145, 0, .95, 0, 2, 4.5, 5E-4, 1), new k(128, 9, 9, 0, 1.95, 6.4, 140, 0, .95, 0, 3, 4, 2E-4, 1), new k(160, 9, 9, 1, 1.79, 6, 135, 0, .95,
                            -2, 5, 3.5, 0, 1), new k(192, 9, 9, 1, 1.49, 5.6, 125, 0, .97, -4, 7, 3, 0, 0), new k(224, 9, 9, 1, 1.25, 5.2, 125, 0, .98, -6, 9, 2, 0, 0), new k(256, 9, 9, 1, .97, 5.2, 125, 0, 1, -8, 10, 1, 0, 0), new k(320, 9, 9, 1, .9, 5.2, 125, 0, 1, -10, 12, 0, 0, 0)]; this.apply_preset = function (c, d, a) {
                                switch (d) {
                                    case W.R3MIX: d = W.V3; c.VBR = J.vbr_mtrh; break; case W.MEDIUM: d = W.V4; c.VBR = J.vbr_rh; break; case W.MEDIUM_FAST: d = W.V4; c.VBR = J.vbr_mtrh; break; case W.STANDARD: d = W.V2; c.VBR = J.vbr_rh; break; case W.STANDARD_FAST: d = W.V2; c.VBR = J.vbr_mtrh; break; case W.EXTREME: d = W.V0; c.VBR = J.vbr_rh;
                                        break; case W.EXTREME_FAST: d = W.V0; c.VBR = J.vbr_mtrh; break; case W.INSANE: return d = 320, c.preset = d, K(c, d, a), c.VBR = J.vbr_off, d
                                }c.preset = d; switch (d) { case W.V9: return r(c, 9, a), d; case W.V8: return r(c, 8, a), d; case W.V7: return r(c, 7, a), d; case W.V6: return r(c, 6, a), d; case W.V5: return r(c, 5, a), d; case W.V4: return r(c, 4, a), d; case W.V3: return r(c, 3, a), d; case W.V2: return r(c, 2, a), d; case W.V1: return r(c, 1, a), d; case W.V0: return r(c, 0, a), d }if (8 <= d && 320 >= d) return K(c, d, a); c.preset = 0; return d
                            }
            } function xc() {
                var f; this.setModules =
                    function (k) { f = k }; this.ResvFrameBegin = function (k, r) {
                        var x = k.internal_flags, C = x.l3_side, u = f.getframebits(k); r.bits = (u - 8 * x.sideinfo_len) / x.mode_gr; var v = 2048 * x.mode_gr - 8; if (320 < k.brate) var d = 8 * int(1E3 * k.brate / (k.out_samplerate / 1152) / 8 + .5); else d = 11520, k.strict_ISO && (d = 8 * int(32E4 / (k.out_samplerate / 1152) / 8 + .5)); x.ResvMax = d - u; x.ResvMax > v && (x.ResvMax = v); if (0 > x.ResvMax || k.disable_reservoir) x.ResvMax = 0; k = r.bits * x.mode_gr + Math.min(x.ResvSize, x.ResvMax); k > d && (k = d); C.resvDrain_pre = 0; null != x.pinfo && (x.pinfo.mean_bits =
                            r.bits / 2, x.pinfo.resvsize = x.ResvSize); return k
                    }; this.ResvMaxBits = function (f, r, x, C) { var k = f.internal_flags, v = k.ResvSize, d = k.ResvMax; 0 != C && (v += r); 0 != (k.substep_shaping & 1) && (d *= .9); x.bits = r; 10 * v > 9 * d ? (C = v - 9 * d / 10, x.bits += C, k.substep_shaping |= 128) : (C = 0, k.substep_shaping &= 127, f.disable_reservoir || 0 != (k.substep_shaping & 1) || (x.bits -= .1 * r)); f = v < 6 * k.ResvMax / 10 ? v : 6 * k.ResvMax / 10; f -= C; 0 > f && (f = 0); return f }; this.ResvAdjust = function (f, r) { f.ResvSize -= r.part2_3_length + r.part2_length }; this.ResvFrameEnd = function (f, r) {
                        var k,
                        x = f.l3_side; f.ResvSize += r * f.mode_gr; r = 0; x.resvDrain_post = 0; x.resvDrain_pre = 0; 0 != (k = f.ResvSize % 8) && (r += k); k = f.ResvSize - r - f.ResvMax; 0 < k && (r += k); k = Math.min(8 * x.main_data_begin, r) / 8; x.resvDrain_pre += 8 * k; r -= 8 * k; f.ResvSize -= 8 * k; x.main_data_begin -= k; x.resvDrain_post += r; f.ResvSize -= r
                    }
            } function gb() {
                function f(a, b) { var e = a[b + 0] & 255, e = e << 8 | a[b + 1] & 255, e = e << 8 | a[b + 2] & 255; return e = e << 8 | a[b + 3] & 255 } function k(a, b, c) { a[b + 0] = c >> 24 & 255; a[b + 1] = c >> 16 & 255; a[b + 2] = c >> 8 & 255; a[b + 3] = c & 255 } function r(a, b, c) {
                    a[b + 0] = c >> 8 & 255;
                    a[b + 1] = c & 255
                } function K(a, b, c) { return 255 & (a << b | c & ~(-1 << b)) } function C(a, b) {
                    var e = a.internal_flags; b[0] = K(b[0], 8, 255); b[1] = K(b[1], 3, 7); b[1] = K(b[1], 1, 16E3 > a.out_samplerate ? 0 : 1); b[1] = K(b[1], 1, a.version); b[1] = K(b[1], 2, 1); b[1] = K(b[1], 1, a.error_protection ? 0 : 1); b[2] = K(b[2], 4, e.bitrate_index); b[2] = K(b[2], 2, e.samplerate_index); b[2] = K(b[2], 1, 0); b[2] = K(b[2], 1, a.extension); b[3] = K(b[3], 2, a.mode.ordinal()); b[3] = K(b[3], 2, e.mode_ext); b[3] = K(b[3], 1, a.copyright); b[3] = K(b[3], 1, a.original); b[3] = K(b[3], 2, a.emphasis);
                    b[0] = 255; var e = b[1] & 241; var c = 1 == a.version ? 128 : 16E3 > a.out_samplerate ? 32 : 64; a.VBR == J.vbr_off && (c = a.brate); c = a.free_format ? 0 : 255 & 16 * G.BitrateIndex(c, a.version, a.out_samplerate); b[1] = 1 == a.version ? 255 & (e | 10) : 255 & (e | 2); e = b[2] & 13; b[2] = 255 & (c | e)
                } function u(a, b) { return b = b >> 8 ^ B[(b ^ a) & 255] } var G, d, c; this.setModules = function (a, b, f) { G = a; d = b; c = f }; var w = gb.NUMTOCENTRIES, a = gb.MAXFRAMESIZE, b = w + 4 + 4 + 4 + 4 + 4 + 9 + 1 + 1 + 8 + 1 + 1 + 3 + 1 + 1 + 2 + 4 + 2 + 2, B = [0, 49345, 49537, 320, 49921, 960, 640, 49729, 50689, 1728, 1920, 51009, 1280, 50625, 50305, 1088,
                    52225, 3264, 3456, 52545, 3840, 53185, 52865, 3648, 2560, 51905, 52097, 2880, 51457, 2496, 2176, 51265, 55297, 6336, 6528, 55617, 6912, 56257, 55937, 6720, 7680, 57025, 57217, 8E3, 56577, 7616, 7296, 56385, 5120, 54465, 54657, 5440, 55041, 6080, 5760, 54849, 53761, 4800, 4992, 54081, 4352, 53697, 53377, 4160, 61441, 12480, 12672, 61761, 13056, 62401, 62081, 12864, 13824, 63169, 63361, 14144, 62721, 13760, 13440, 62529, 15360, 64705, 64897, 15680, 65281, 16320, 16E3, 65089, 64001, 15040, 15232, 64321, 14592, 63937, 63617, 14400, 10240, 59585, 59777, 10560, 60161, 11200, 10880, 59969,
                    60929, 11968, 12160, 61249, 11520, 60865, 60545, 11328, 58369, 9408, 9600, 58689, 9984, 59329, 59009, 9792, 8704, 58049, 58241, 9024, 57601, 8640, 8320, 57409, 40961, 24768, 24960, 41281, 25344, 41921, 41601, 25152, 26112, 42689, 42881, 26432, 42241, 26048, 25728, 42049, 27648, 44225, 44417, 27968, 44801, 28608, 28288, 44609, 43521, 27328, 27520, 43841, 26880, 43457, 43137, 26688, 30720, 47297, 47489, 31040, 47873, 31680, 31360, 47681, 48641, 32448, 32640, 48961, 32E3, 48577, 48257, 31808, 46081, 29888, 30080, 46401, 30464, 47041, 46721, 30272, 29184, 45761, 45953, 29504, 45313,
                    29120, 28800, 45121, 20480, 37057, 37249, 20800, 37633, 21440, 21120, 37441, 38401, 22208, 22400, 38721, 21760, 38337, 38017, 21568, 39937, 23744, 23936, 40257, 24320, 40897, 40577, 24128, 23040, 39617, 39809, 23360, 39169, 22976, 22656, 38977, 34817, 18624, 18816, 35137, 19200, 35777, 35457, 19008, 19968, 36545, 36737, 20288, 36097, 19904, 19584, 35905, 17408, 33985, 34177, 17728, 34561, 18368, 18048, 34369, 33281, 17088, 17280, 33601, 16640, 33217, 32897, 16448]; this.addVbrFrame = function (a) {
                        var b = a.internal_flags; var e = b.VBR_seek_table; a = v.bitrate_table[a.version][b.bitrate_index];
                        e.nVbrNumFrames++; e.sum += a; e.seen++; if (!(e.seen < e.want) && (e.pos < e.size && (e.bag[e.pos] = e.sum, e.pos++, e.seen = 0), e.pos == e.size)) { for (a = 1; a < e.size; a += 2)e.bag[a / 2] = e.bag[a]; e.want *= 2; e.pos /= 2 }
                    }; this.getVbrTag = function (a) {
                        var b = new VBRTagData, e = 0; b.flags = 0; var c = a[e + 1] >> 3 & 1, d = a[e + 2] >> 2 & 3, k = a[e + 3] >> 6 & 3, m = a[e + 2] >> 4 & 15, m = v.bitrate_table[c][m]; b.samprate = 14 == a[e + 1] >> 4 ? v.samplerate_table[2][d] : v.samplerate_table[c][d]; d = e = 0 != c ? 3 != k ? e + 36 : e + 21 : 3 != k ? e + 21 : e + 13; if (!(new String(a, d, 4(), null)).equals("Xing") && !(new String(a,
                            d, 4(), null)).equals("Info")) return null; e += 4; b.hId = c; d = b.flags = f(a, e); e += 4; 0 != (d & 1) && (b.frames = f(a, e), e += 4); 0 != (d & 2) && (b.bytes = f(a, e), e += 4); if (0 != (d & 4)) { if (null != b.toc) for (k = 0; k < w; k++)b.toc[k] = a[e + k]; e += w } b.vbrScale = -1; 0 != (d & 8) && (b.vbrScale = f(a, e), e += 4); b.headersize = 72E3 * (c + 1) * m / b.samprate; e += 21; c = a[e + 0] << 4; c += a[e + 1] >> 4; m = (a[e + 1] & 15) << 8; m += a[e + 2] & 255; if (0 > c || 3E3 < c) c = -1; if (0 > m || 3E3 < m) m = -1; b.encDelay = c; b.encPadding = m; return b
                    }; this.InitVbrTag = function (e) {
                        var c = e.internal_flags; var f = 1 == e.version ? 128 :
                            16E3 > e.out_samplerate ? 32 : 64; e.VBR == J.vbr_off && (f = e.brate); f = 72E3 * (e.version + 1) * f / e.out_samplerate; var g = c.sideinfo_len + b; c.VBR_seek_table.TotalFrameSize = f; if (f < g || f > a) e.bWriteVbrTag = !1; else for (c.VBR_seek_table.nVbrNumFrames = 0, c.VBR_seek_table.nBytesWritten = 0, c.VBR_seek_table.sum = 0, c.VBR_seek_table.seen = 0, c.VBR_seek_table.want = 1, c.VBR_seek_table.pos = 0, null == c.VBR_seek_table.bag && (c.VBR_seek_table.bag = new int[400], c.VBR_seek_table.size = 400), f = new Int8Array(a), C(e, f), c = c.VBR_seek_table.TotalFrameSize,
                                g = 0; g < c; ++g)d.add_dummy_byte(e, f[g] & 255, 1)
                    }; this.updateMusicCRC = function (a, b, c, d) { for (var e = 0; e < d; ++e)a[0] = u(b[c + e], a[0]) }; this.getLameTagFrame = function (a, b) {
                        var e = a.internal_flags; if (!a.bWriteVbrTag || e.Class_ID != W.LAME_ID || 0 >= e.VBR_seek_table.pos) return 0; if (b.length < e.VBR_seek_table.TotalFrameSize) return e.VBR_seek_table.TotalFrameSize; qa.fill(b, 0, e.VBR_seek_table.TotalFrameSize, 0); C(a, b); var g = new Int8Array(w); if (a.free_format) for (var f = 1; f < w; ++f)g[f] = 255 & 255 * f / 100; else {
                            var l = e.VBR_seek_table;
                            if (!(0 >= l.pos)) for (f = 1; f < w; ++f) { var m = 0 | Math.floor(f / w * l.pos); m > l.pos - 1 && (m = l.pos - 1); m = 0 | 256 * l.bag[m] / l.sum; 255 < m && (m = 255); g[f] = 255 & m }
                        } m = e.sideinfo_len; a.error_protection && (m -= 2); b[m++] = 0; b[m++] = 0; b[m++] = 0; b[m++] = 0; k(b, m, 15); m += 4; k(b, m, e.VBR_seek_table.nVbrNumFrames); m += 4; l = e.VBR_seek_table.nBytesWritten + e.VBR_seek_table.TotalFrameSize; k(b, m, 0 | l); m += 4; S.arraycopy(g, 0, b, m, g.length); m += g.length; a.error_protection && d.CRC_writeheader(e, b); for (var n = 0, f = 0; f < m; f++)n = u(b[f], n); var g = m, f = n, z = a.internal_flags,
                            m = 0, n = a.encoder_delay, E = a.encoder_padding, h = 100 - 10 * a.VBR_q - a.quality, p = c.getLameVeryShortVersion(); var A = [1, 5, 3, 2, 4, 0, 3]; var y = 0 | (255 < a.lowpassfreq / 100 + .5 ? 255 : a.lowpassfreq / 100 + .5), B = 0, x = 0, R = a.internal_flags.noise_shaping, X = 0, I, H = 0 != (a.exp_nspsytune & 1); var M = 0 != (a.exp_nspsytune & 2); var Q = I = !1, V = a.internal_flags.nogap_total, N = a.internal_flags.nogap_current, v = a.ATHtype; switch (a.VBR) { case vbr_abr: var Qa = a.VBR_mean_bitrate_kbps; break; case vbr_off: Qa = a.brate; break; default: Qa = a.VBR_min_bitrate_kbps }A = 0 +
                                (a.VBR.ordinal() < A.length ? A[a.VBR.ordinal()] : 0); z.findReplayGain && (510 < z.RadioGain && (z.RadioGain = 510), -510 > z.RadioGain && (z.RadioGain = -510), x = 11264, x = 0 <= z.RadioGain ? x | z.RadioGain : x | 512 | -z.RadioGain); z.findPeakSample && (B = Math.abs(0 | z.PeakSample / 32767 * Math.pow(2, 23) + .5)); -1 != V && (0 < N && (Q = !0), N < V - 1 && (I = !0)); H = v + ((H ? 1 : 0) << 4) + ((M ? 1 : 0) << 5) + ((I ? 1 : 0) << 6) + ((Q ? 1 : 0) << 7); 0 > h && (h = 0); switch (a.mode) {
                                    case MONO: M = 0; break; case STEREO: M = 1; break; case DUAL_CHANNEL: M = 2; break; case JOINT_STEREO: M = a.force_ms ? 4 : 3; break; default: M =
                                        7
                                }I = 32E3 >= a.in_samplerate ? 0 : 48E3 == a.in_samplerate ? 2 : 48E3 < a.in_samplerate ? 3 : 1; if (a.short_blocks == pa.short_block_forced || a.short_blocks == pa.short_block_dispensed || -1 == a.lowpassfreq && -1 == a.highpassfreq || a.scale_left < a.scale_right || a.scale_left > a.scale_right || a.disable_reservoir && 320 > a.brate || a.noATH || a.ATHonly || 0 == v || 32E3 >= a.in_samplerate) X = 1; R = R + (M << 2) + (X << 5) + (I << 6); z = z.nMusicCRC; k(b, g + m, h); m += 4; for (h = 0; 9 > h; h++)b[g + m + h] = 255 & p.charAt(h); m += 9; b[g + m] = 255 & A; m++; b[g + m] = 255 & y; m++; k(b, g + m, B); m += 4; r(b, g + m,
                                    x); m += 2; r(b, g + m, 0); m += 2; b[g + m] = 255 & H; m++; b[g + m] = 255 <= Qa ? 255 : 255 & Qa; m++; b[g + m] = 255 & n >> 4; b[g + m + 1] = 255 & (n << 4) + (E >> 8); b[g + m + 2] = 255 & E; m += 3; b[g + m] = 255 & R; m++; b[g + m++] = 0; r(b, g + m, a.preset); m += 2; k(b, g + m, l); m += 4; r(b, g + m, z); m += 2; for (a = 0; a < m; a++)f = u(b[g + a], f); r(b, g + m, f); return e.VBR_seek_table.TotalFrameSize
                    }; this.putVbrTag = function (b, c) {
                        if (0 >= b.internal_flags.VBR_seek_table.pos) return -1; c.seek(c.length()); if (0 == c.length()) return -1; c.seek(0); var e = new Int8Array(10); c.readFully(e); e = (new String(e, "ISO-8859-1")).startsWith("ID3") ?
                            0 : ((e[6] & 127) << 21 | (e[7] & 127) << 14 | (e[8] & 127) << 7 | e[9] & 127) + e.length; c.seek(e); e = new Int8Array(a); b = getLameTagFrame(b, e); if (b > e.length) return -1; if (1 > b) return 0; c.write(e, 0, b); return 0
                    }
            } function da() {
                function x(a, b, c) { for (; 0 < c;) { if (0 == D) { D = 8; t++; if (a.header[a.w_ptr].write_timing == g) { var e = a; S.arraycopy(e.header[e.w_ptr].buf, 0, q, t, e.sideinfo_len); t += e.sideinfo_len; g += 8 * e.sideinfo_len; e.w_ptr = e.w_ptr + 1 & ia.MAX_HEADER_BUF - 1 } q[t] = 0 } e = Math.min(c, D); c -= e; D -= e; q[t] |= b >> c << D; g += e } } function k(a, b) {
                    var c = a.internal_flags,
                    d; 8 <= b && (x(c, 76, 8), b -= 8); 8 <= b && (x(c, 65, 8), b -= 8); 8 <= b && (x(c, 77, 8), b -= 8); 8 <= b && (x(c, 69, 8), b -= 8); if (32 <= b) { var h = e.getLameShortVersion(); if (32 <= b) for (d = 0; d < h.length && 8 <= b; ++d)b -= 8, x(c, h.charAt(d), 8) } for (; 1 <= b; --b)x(c, c.ancillary_flag, 1), c.ancillary_flag ^= a.disable_reservoir ? 0 : 1
                } function r(a, b, c) { for (var e = a.header[a.h_ptr].ptr; 0 < c;) { var h = Math.min(c, 8 - (e & 7)); c -= h; a.header[a.h_ptr].buf[e >> 3] |= b >> c << 8 - (e & 7) - h; e += h } a.header[a.h_ptr].ptr = e } function K(a, b) {
                    a <<= 8; for (var c = 0; 8 > c; c++)a <<= 1, b <<= 1, 0 != ((b ^ a) &
                        65536) && (b ^= 32773); return b
                } function C(a, b) { var c = v.ht[b.count1table_select + 32], e, h = 0, d = b.big_values, g = b.big_values; for (e = (b.count1 - b.big_values) / 4; 0 < e; --e) { var f = 0, m = 0; var n = b.l3_enc[d + 0]; 0 != n && (m += 8, 0 > b.xr[g + 0] && f++); n = b.l3_enc[d + 1]; 0 != n && (m += 4, f *= 2, 0 > b.xr[g + 1] && f++); n = b.l3_enc[d + 2]; 0 != n && (m += 2, f *= 2, 0 > b.xr[g + 2] && f++); n = b.l3_enc[d + 3]; 0 != n && (m++, f *= 2, 0 > b.xr[g + 3] && f++); d += 4; g += 4; x(a, f + c.table[m], c.hlen[m]); h += c.hlen[m] } return h } function u(a, b, c, e, h) {
                    var d = v.ht[b], g = 0; if (0 == b) return g; for (; c < e; c += 2) {
                        var f =
                            0, m = 0, n = d.xlen, l = d.xlen, q = 0, I = h.l3_enc[c], k = h.l3_enc[c + 1]; 0 != I && (0 > h.xr[c] && q++, f--); 15 < b && (14 < I && (q |= I - 15 << 1, m = n, I = 15), 14 < k && (l = k - 15, q <<= n, q |= l, m += n, k = 15), l = 16); 0 != k && (q <<= 1, 0 > h.xr[c + 1] && q++, f--); I = I * l + k; m -= f; f += d.hlen[I]; x(a, d.table[I], f); x(a, q, m); g += f + m
                    } return g
                } function G(a, b) { var c = 3 * a.scalefac_band.s[3]; c > b.big_values && (c = b.big_values); var e = u(a, b.table_select[0], 0, c, b); return e += u(a, b.table_select[1], c, b.big_values, b) } function d(a, b) {
                    var c = b.big_values; var e = b.region0_count + 1; var h = a.scalefac_band.l[e];
                    e += b.region1_count + 1; var d = a.scalefac_band.l[e]; h > c && (h = c); d > c && (d = c); e = u(a, b.table_select[0], 0, h, b); e += u(a, b.table_select[1], h, d, b); return e += u(a, b.table_select[2], d, c, b)
                } function c() { this.total = 0 } function w(b, c) {
                    var e = b.internal_flags; var d = e.w_ptr; var h = e.h_ptr - 1; -1 == h && (h = ia.MAX_HEADER_BUF - 1); var f = e.header[h].write_timing - g; c.total = f; if (0 <= f) { var m = 1 + h - d; h < d && (m = 1 + h - d + ia.MAX_HEADER_BUF); f -= 8 * m * e.sideinfo_len } b = a.getframebits(b); f += b; c.total += b; c.total = 0 != c.total % 8 ? 1 + c.total / 8 : c.total / 8; c.total +=
                        t + 1; 0 > f && S.err.println("strange error flushing buffer ... \n"); return f
                } var a = this, b = null, B = null, e = null, l = null; this.setModules = function (a, c, d, f) { b = a; B = c; e = d; l = f }; var q = null, g = 0, t = 0, D = 0; this.getframebits = function (a) { var b = a.internal_flags; return 8 * (0 | 72E3 * (a.version + 1) * (0 != b.bitrate_index ? v.bitrate_table[a.version][b.bitrate_index] : a.brate) / a.out_samplerate + b.padding) }; this.CRC_writeheader = function (a, b) {
                    var c = K(b[2] & 255, 65535); c = K(b[3] & 255, c); for (var e = 6; e < a.sideinfo_len; e++)c = K(b[e] & 255, c); b[4] = byte(c >>
                        8); b[5] = byte(c & 255)
                }; this.flush_bitstream = function (a) { var e = a.internal_flags, d; var f = e.l3_side; 0 > (d = w(a, new c)) || (k(a, d), e.ResvSize = 0, f.main_data_begin = 0, e.findReplayGain && (f = b.GetTitleGain(e.rgdata), e.RadioGain = Math.floor(10 * f + .5) | 0), e.findPeakSample && (e.noclipGainChange = Math.ceil(200 * Math.log10(e.PeakSample / 32767)) | 0, 0 < e.noclipGainChange ? EQ(a.scale, 1) || EQ(a.scale, 0) ? e.noclipScale = Math.floor(32767 / e.PeakSample * 100) / 100 : e.noclipScale = -1 : e.noclipScale = -1)) }; this.add_dummy_byte = function (a, b, c) {
                    a = a.internal_flags;
                    for (var e; 0 < c--;) { e = b; for (var h = 8; 0 < h;) { 0 == D && (D = 8, t++, q[t] = 0); var d = Math.min(h, D); h -= d; D -= d; q[t] |= e >> h << D; g += d } for (e = 0; e < ia.MAX_HEADER_BUF; ++e)a.header[e].write_timing += 8 }
                }; this.format_bitstream = function (a) {
                    var b = a.internal_flags; var e = b.l3_side; var m = this.getframebits(a); k(a, e.resvDrain_pre); var h, p = a.internal_flags, l, q; var t = p.l3_side; p.header[p.h_ptr].ptr = 0; qa.fill(p.header[p.h_ptr].buf, 0, p.sideinfo_len, 0); 16E3 > a.out_samplerate ? r(p, 4094, 12) : r(p, 4095, 12); r(p, a.version, 1); r(p, 1, 2); r(p, a.error_protection ?
                        0 : 1, 1); r(p, p.bitrate_index, 4); r(p, p.samplerate_index, 2); r(p, p.padding, 1); r(p, a.extension, 1); r(p, a.mode.ordinal(), 2); r(p, p.mode_ext, 2); r(p, a.copyright, 1); r(p, a.original, 1); r(p, a.emphasis, 2); a.error_protection && r(p, 0, 16); if (1 == a.version) {
                            r(p, t.main_data_begin, 9); 2 == p.channels_out ? r(p, t.private_bits, 3) : r(p, t.private_bits, 5); for (q = 0; q < p.channels_out; q++)for (h = 0; 4 > h; h++)r(p, t.scfsi[q][h], 1); for (l = 0; 2 > l; l++)for (q = 0; q < p.channels_out; q++)h = t.tt[l][q], r(p, h.part2_3_length + h.part2_length, 12), r(p, h.big_values /
                                2, 9), r(p, h.global_gain, 8), r(p, h.scalefac_compress, 4), h.block_type != f.NORM_TYPE ? (r(p, 1, 1), r(p, h.block_type, 2), r(p, h.mixed_block_flag, 1), 14 == h.table_select[0] && (h.table_select[0] = 16), r(p, h.table_select[0], 5), 14 == h.table_select[1] && (h.table_select[1] = 16), r(p, h.table_select[1], 5), r(p, h.subblock_gain[0], 3), r(p, h.subblock_gain[1], 3), r(p, h.subblock_gain[2], 3)) : (r(p, 0, 1), 14 == h.table_select[0] && (h.table_select[0] = 16), r(p, h.table_select[0], 5), 14 == h.table_select[1] && (h.table_select[1] = 16), r(p, h.table_select[1],
                                    5), 14 == h.table_select[2] && (h.table_select[2] = 16), r(p, h.table_select[2], 5), r(p, h.region0_count, 4), r(p, h.region1_count, 3)), r(p, h.preflag, 1), r(p, h.scalefac_scale, 1), r(p, h.count1table_select, 1)
                        } else for (r(p, t.main_data_begin, 8), r(p, t.private_bits, p.channels_out), q = l = 0; q < p.channels_out; q++)h = t.tt[l][q], r(p, h.part2_3_length + h.part2_length, 12), r(p, h.big_values / 2, 9), r(p, h.global_gain, 8), r(p, h.scalefac_compress, 9), h.block_type != f.NORM_TYPE ? (r(p, 1, 1), r(p, h.block_type, 2), r(p, h.mixed_block_flag, 1), 14 == h.table_select[0] &&
                            (h.table_select[0] = 16), r(p, h.table_select[0], 5), 14 == h.table_select[1] && (h.table_select[1] = 16), r(p, h.table_select[1], 5), r(p, h.subblock_gain[0], 3), r(p, h.subblock_gain[1], 3), r(p, h.subblock_gain[2], 3)) : (r(p, 0, 1), 14 == h.table_select[0] && (h.table_select[0] = 16), r(p, h.table_select[0], 5), 14 == h.table_select[1] && (h.table_select[1] = 16), r(p, h.table_select[1], 5), 14 == h.table_select[2] && (h.table_select[2] = 16), r(p, h.table_select[2], 5), r(p, h.region0_count, 4), r(p, h.region1_count, 3)), r(p, h.scalefac_scale, 1), r(p, h.count1table_select,
                                1); a.error_protection && CRC_writeheader(p, p.header[p.h_ptr].buf); t = p.h_ptr; p.h_ptr = t + 1 & ia.MAX_HEADER_BUF - 1; p.header[p.h_ptr].write_timing = p.header[t].write_timing + m; p.h_ptr == p.w_ptr && S.err.println("Error: MAX_HEADER_BUF too small in bitstream.c \n"); var p = 8 * b.sideinfo_len, D, B = 0, u = a.internal_flags, I = u.l3_side; if (1 == a.version) for (q = 0; 2 > q; q++)for (h = 0; h < u.channels_out; h++) {
                                    t = I.tt[q][h]; var H = fb.slen1_tab[t.scalefac_compress]; var M = fb.slen2_tab[t.scalefac_compress]; for (l = D = 0; l < t.sfbdivide; l++)-1 != t.scalefac[l] &&
                                        (x(u, t.scalefac[l], H), D += H); for (; l < t.sfbmax; l++)-1 != t.scalefac[l] && (x(u, t.scalefac[l], M), D += M); D = t.block_type == f.SHORT_TYPE ? D + G(u, t) : D + d(u, t); D += C(u, t); B += D
                                } else for (h = q = 0; h < u.channels_out; h++) {
                                    t = I.tt[q][h]; var Q, V = 0; var N = l = D = 0; if (t.block_type == f.SHORT_TYPE) { for (; 4 > N; N++)for (M = t.sfb_partition_table[N] / 3, H = t.slen[N], Q = 0; Q < M; Q++, l++)x(u, Math.max(t.scalefac[3 * l + 0], 0), H), x(u, Math.max(t.scalefac[3 * l + 1], 0), H), x(u, Math.max(t.scalefac[3 * l + 2], 0), H), V += 3 * H; D += G(u, t) } else {
                                        for (; 4 > N; N++)for (M = t.sfb_partition_table[N],
                                            H = t.slen[N], Q = 0; Q < M; Q++, l++)x(u, Math.max(t.scalefac[l], 0), H), V += H; D += d(u, t)
                                    } D += C(u, t); B += V + D
                                } p += B; k(a, e.resvDrain_post); p += e.resvDrain_post; e.main_data_begin += (m - p) / 8; w(a, new c) != b.ResvSize && S.err.println("Internal buffer inconsistency. flushbits <> ResvSize"); 8 * e.main_data_begin != b.ResvSize && (S.err.printf("bit reservoir error: \nl3_side.main_data_begin: %d \nResvoir size:             %d \nresv drain (post)         %d \nresv drain (pre)          %d \nheader and sideinfo:      %d \ndata bits:                %d \ntotal bits:               %d (remainder: %d) \nbitsperframe:             %d \n",
                                    8 * e.main_data_begin, b.ResvSize, e.resvDrain_post, e.resvDrain_pre, 8 * b.sideinfo_len, p - e.resvDrain_post - 8 * b.sideinfo_len, p, p % 8, m), S.err.println("This is a fatal error.  It has several possible causes:"), S.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"), S.err.println(" 9%%  Your system is overclocked"), S.err.println(" 1%%  bug in LAME encoding library"), b.ResvSize = 8 * e.main_data_begin); if (1E9 < g) { for (a = 0; a < ia.MAX_HEADER_BUF; ++a)b.header[a].write_timing -= g; g = 0 } return 0
                };
                this.copy_buffer = function (a, c, e, d, h) {
                    var f = t + 1; if (0 >= f) return 0; if (0 != d && f > d) return -1; S.arraycopy(q, 0, c, e, f); t = -1; D = 0; if (0 != h && (d = U(1), d[0] = a.nMusicCRC, l.updateMusicCRC(d, c, e, f), a.nMusicCRC = d[0], 0 < f && (a.VBR_seek_table.nBytesWritten += f), a.decode_on_the_fly)) {
                        d = ha([2, 1152]); h = f; for (var g = -1, m; 0 != g;)if (g = B.hip_decode1_unclipped(a.hip, c, e, h, d[0], d[1]), h = 0, -1 == g && (g = 0), 0 < g) {
                            if (a.findPeakSample) {
                                for (m = 0; m < g; m++)d[0][m] > a.PeakSample ? a.PeakSample = d[0][m] : -d[0][m] > a.PeakSample && (a.PeakSample = -d[0][m]); if (1 <
                                    a.channels_out) for (m = 0; m < g; m++)d[1][m] > a.PeakSample ? a.PeakSample = d[1][m] : -d[1][m] > a.PeakSample && (a.PeakSample = -d[1][m])
                            } if (a.findReplayGain && b.AnalyzeSamples(a.rgdata, d[0], 0, d[1], 0, g, a.channels_out) == ca.GAIN_ANALYSIS_ERROR) return -6
                        }
                    } return f
                }; this.init_bit_stream_w = function (a) { q = new Int8Array(W.LAME_MAXMP3BUFFER); a.h_ptr = a.w_ptr = 0; a.header[a.h_ptr].write_timing = 0; t = -1; g = D = 0 }
            } function ba(f, k, r, v) { this.xlen = f; this.linmax = k; this.table = r; this.hlen = v } function Fa(f) { this.bits = f } function Fb() {
                this.bits =
                this.over_SSD = this.over_count = this.max_noise = this.tot_noise = this.over_noise = 0
            } function yc() { this.setModules = function (f, k) { } } function zc() { this.floor = this.decay = this.adjustLimit = this.adjust = this.aaSensitivityP = this.useAdjust = 0; this.l = G(f.SBMAX_l); this.s = G(f.SBMAX_s); this.psfb21 = G(f.PSFB21); this.psfb12 = G(f.PSFB12); this.cb_l = G(f.CBANDS); this.cb_s = G(f.CBANDS); this.eql_w = G(f.BLKSIZE / 2) } function Ac() {
                this.scale_right = this.scale_left = this.scale = this.out_samplerate = this.in_samplerate = this.num_channels = this.num_samples =
                    this.class_id = 0; this.decode_only = this.bWriteVbrTag = this.analysis = !1; this.quality = 0; this.mode = ka.STEREO; this.write_id3tag_automatic = this.decode_on_the_fly = this.findReplayGain = this.free_format = this.force_ms = !1; this.error_protection = this.emphasis = this.extension = this.original = this.copyright = this.compression_ratio = this.brate = 0; this.disable_reservoir = this.strict_ISO = !1; this.quant_comp_short = this.quant_comp = 0; this.experimentalY = !1; this.preset = this.exp_nspsytune = this.experimentalZ = 0; this.VBR = null; this.maskingadjust_short =
                        this.maskingadjust = this.highpasswidth = this.lowpasswidth = this.highpassfreq = this.lowpassfreq = this.VBR_hard_min = this.VBR_max_bitrate_kbps = this.VBR_min_bitrate_kbps = this.VBR_mean_bitrate_kbps = this.VBR_q = this.VBR_q_frac = 0; this.noATH = this.ATHshort = this.ATHonly = !1; this.athaa_sensitivity = this.athaa_loudapprox = this.athaa_type = this.ATHlower = this.ATHcurve = this.ATHtype = 0; this.short_blocks = null; this.useTemporal = !1; this.msfix = this.interChRatio = 0; this.tune = !1; this.lame_allocated_gfp = this.frameNum = this.framesize =
                            this.encoder_padding = this.encoder_delay = this.version = this.tune_value_a = 0; this.internal_flags = null
            } function Bc(x) {
                this.quantize = x; this.iteration_loop = function (k, r, x, v) {
                    var u = k.internal_flags, C = G(ra.SFBMAX), d = G(576), c = U(2), w = u.l3_side; var a = new Fa(0); this.quantize.rv.ResvFrameBegin(k, a); a = a.bits; for (var b = 0; b < u.mode_gr; b++) {
                        var B = this.quantize.qupvt.on_pe(k, r, c, a, b, b); u.mode_ext == f.MPG_MD_MS_LR && (this.quantize.ms_convert(u.l3_side, b), this.quantize.qupvt.reduce_side(c, x[b], a, B)); for (B = 0; B < u.channels_out; B++) {
                            var e =
                                w.tt[b][B]; if (e.block_type != f.SHORT_TYPE) { var l = 0; l = u.PSY.mask_adjust - l } else l = 0, l = u.PSY.mask_adjust_short - l; u.masking_lower = Math.pow(10, .1 * l); this.quantize.init_outer_loop(u, e); this.quantize.init_xrpow(u, e, d) && (this.quantize.qupvt.calc_xmin(k, v[b][B], e, C), this.quantize.outer_loop(k, e, C, d, B, c[B])); this.quantize.iteration_finish_one(u, b, B)
                        }
                    } this.quantize.rv.ResvFrameEnd(u, a)
                }
            } function Cc() {
                this.linprebuf = G(2 * ca.MAX_ORDER); this.linpre = 0; this.lstepbuf = G(ca.MAX_SAMPLES_PER_WINDOW + ca.MAX_ORDER); this.lstep =
                    0; this.loutbuf = G(ca.MAX_SAMPLES_PER_WINDOW + ca.MAX_ORDER); this.lout = 0; this.rinprebuf = G(2 * ca.MAX_ORDER); this.rinpre = 0; this.rstepbuf = G(ca.MAX_SAMPLES_PER_WINDOW + ca.MAX_ORDER); this.rstep = 0; this.routbuf = G(ca.MAX_SAMPLES_PER_WINDOW + ca.MAX_ORDER); this.first = this.freqindex = this.rsum = this.lsum = this.totsamp = this.sampleWindow = this.rout = 0; this.A = U(0 | ca.STEPS_per_dB * ca.MAX_dB); this.B = U(0 | ca.STEPS_per_dB * ca.MAX_dB)
            } function ma(x, k, r, v) {
                this.l = U(1 + f.SBMAX_l); this.s = U(1 + f.SBMAX_s); this.psfb21 = U(1 + f.PSFB21); this.psfb12 =
                    U(1 + f.PSFB12); var C = this.l, u = this.s; 4 == arguments.length && (this.arrL = arguments[0], this.arrS = arguments[1], this.arr21 = arguments[2], this.arr12 = arguments[3], S.arraycopy(this.arrL, 0, C, 0, Math.min(this.arrL.length, this.l.length)), S.arraycopy(this.arrS, 0, u, 0, Math.min(this.arrS.length, this.s.length)), S.arraycopy(this.arr21, 0, this.psfb21, 0, Math.min(this.arr21.length, this.psfb21.length)), S.arraycopy(this.arr12, 0, this.psfb12, 0, Math.min(this.arr12.length, this.psfb12.length)))
            } function Y() {
                function x(a, b) {
                    b = C.ATHformula(b,
                        a); return b = Math.pow(10, (b - 100) / 10 + a.ATHlower)
                } function k(a) { this.s = a } var r = null, v = null, C = null; this.setModules = function (a, b, c) { r = a; v = b; C = c }; this.IPOW20 = function (b) { return a[b] }; var u = Y.IXMAX_VAL + 2, fa = Y.Q_MAX, d = Y.Q_MAX2; this.nr_of_sfb_block = [[[6, 5, 5, 5], [9, 9, 9, 9], [6, 9, 9, 9]], [[6, 5, 7, 3], [9, 9, 12, 6], [6, 9, 12, 6]], [[11, 10, 0, 0], [18, 18, 0, 0], [15, 18, 0, 0]], [[7, 7, 7, 0], [12, 12, 12, 0], [6, 15, 12, 0]], [[6, 6, 6, 3], [12, 9, 9, 6], [6, 12, 9, 6]], [[8, 8, 5, 0], [15, 12, 9, 0], [6, 18, 9, 0]]]; var c = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 3, 3, 3, 2,
                    0]; this.pretab = c; this.sfBandIndex = [new ma([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 24, 32, 42, 56, 74, 100, 132, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 114, 136, 162, 194, 232, 278, 332, 394, 464, 540, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 136, 180, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 134, 174, 192], [0, 0,
                        0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 4, 8, 12, 16, 20, 24, 30, 36, 44, 52, 62, 74, 90, 110, 134, 162, 196, 238, 288, 342, 418, 576], [0, 4, 8, 12, 16, 22, 30, 40, 52, 66, 84, 106, 136, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 4, 8, 12, 16, 20, 24, 30, 36, 42, 50, 60, 72, 88, 106, 128, 156, 190, 230, 276, 330, 384, 576], [0, 4, 8, 12, 16, 22, 28, 38, 50, 64, 80, 100, 126, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 4, 8, 12, 16, 20, 24, 30, 36, 44, 54, 66, 82, 102, 126, 156, 194, 240, 296, 364, 448, 550, 576], [0, 4, 8, 12, 16, 22, 30, 42, 58, 78, 104, 138, 180, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0,
                            0, 0, 0, 0, 0]), new ma([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 134, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 6, 12, 18, 24, 30, 36, 44, 54, 66, 80, 96, 116, 140, 168, 200, 238, 284, 336, 396, 464, 522, 576], [0, 4, 8, 12, 18, 26, 36, 48, 62, 80, 104, 134, 174, 192], [0, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0]), new ma([0, 12, 24, 36, 48, 60, 72, 88, 108, 132, 160, 192, 232, 280, 336, 400, 476, 566, 568, 570, 572, 574, 576], [0, 8, 16, 24, 36, 52, 72, 96, 124, 160, 162, 164, 166, 192], [0, 0, 0, 0, 0, 0, 0], [0,
                                0, 0, 0, 0, 0, 0])]; var w = G(fa + d + 1), a = G(fa), b = G(u), B = G(u); this.adj43 = B; this.iteration_init = function (c) {
                                    var e = c.internal_flags, q = e.l3_side; if (0 == e.iteration_init_init) {
                                        e.iteration_init_init = 1; q.main_data_begin = 0; for (var g, t, k = c.internal_flags.ATH.l, m = c.internal_flags.ATH.psfb21, n = c.internal_flags.ATH.s, z = c.internal_flags.ATH.psfb12, E = c.internal_flags, h = c.out_samplerate, p = 0; p < f.SBMAX_l; p++)for (t = E.scalefac_band.l[p], q = E.scalefac_band.l[p + 1], k[p] = sb.MAX_VALUE; t < q; t++)g = t * h / 1152, g = x(c, g), k[p] = Math.min(k[p],
                                            g); for (p = 0; p < f.PSFB21; p++)for (t = E.scalefac_band.psfb21[p], q = E.scalefac_band.psfb21[p + 1], m[p] = sb.MAX_VALUE; t < q; t++)g = t * h / 1152, g = x(c, g), m[p] = Math.min(m[p], g); for (p = 0; p < f.SBMAX_s; p++) { t = E.scalefac_band.s[p]; q = E.scalefac_band.s[p + 1]; for (n[p] = sb.MAX_VALUE; t < q; t++)g = t * h / 384, g = x(c, g), n[p] = Math.min(n[p], g); n[p] *= E.scalefac_band.s[p + 1] - E.scalefac_band.s[p] } for (p = 0; p < f.PSFB12; p++) {
                                                t = E.scalefac_band.psfb12[p]; q = E.scalefac_band.psfb12[p + 1]; for (z[p] = sb.MAX_VALUE; t < q; t++)g = t * h / 384, g = x(c, g), z[p] = Math.min(z[p], g);
                                                z[p] *= E.scalefac_band.s[13] - E.scalefac_band.s[12]
                                            } if (c.noATH) { for (p = 0; p < f.SBMAX_l; p++)k[p] = 1E-20; for (p = 0; p < f.PSFB21; p++)m[p] = 1E-20; for (p = 0; p < f.SBMAX_s; p++)n[p] = 1E-20; for (p = 0; p < f.PSFB12; p++)z[p] = 1E-20 } E.ATH.floor = 10 * Math.log10(x(c, -1)); b[0] = 0; for (q = 1; q < u; q++)b[q] = Math.pow(q, 4 / 3); for (q = 0; q < u - 1; q++)B[q] = q + 1 - Math.pow(.5 * (b[q] + b[q + 1]), .75); B[q] = .5; for (q = 0; q < fa; q++)a[q] = Math.pow(2, -.1875 * (q - 210)); for (q = 0; q <= fa + d; q++)w[q] = Math.pow(2, .25 * (q - 210 - d)); r.huffman_init(e); q = c.exp_nspsytune >> 2 & 63; 32 <= q && (q -= 64);
                                        k = Math.pow(10, q / 4 / 10); q = c.exp_nspsytune >> 8 & 63; 32 <= q && (q -= 64); m = Math.pow(10, q / 4 / 10); q = c.exp_nspsytune >> 14 & 63; 32 <= q && (q -= 64); n = Math.pow(10, q / 4 / 10); q = c.exp_nspsytune >> 20 & 63; 32 <= q && (q -= 64); z = n * Math.pow(10, q / 4 / 10); for (q = 0; q < f.SBMAX_l; q++)c = 6 >= q ? k : 13 >= q ? m : 20 >= q ? n : z, e.nsPsy.longfact[q] = c; for (q = 0; q < f.SBMAX_s; q++)c = 5 >= q ? k : 10 >= q ? m : 11 >= q ? n : z, e.nsPsy.shortfact[q] = c
                                    }
                                }; this.on_pe = function (a, b, c, d, f, k) {
                                    var e = a.internal_flags, g = 0, l = U(2), q, g = new Fa(g); a = v.ResvMaxBits(a, d, g, k); var g = g.bits, h = g + a; h > ia.MAX_BITS_PER_GRANULE &&
                                        (h = ia.MAX_BITS_PER_GRANULE); for (q = k = 0; q < e.channels_out; ++q)c[q] = Math.min(ia.MAX_BITS_PER_CHANNEL, g / e.channels_out), l[q] = 0 | c[q] * b[f][q] / 700 - c[q], l[q] > 3 * d / 4 && (l[q] = 3 * d / 4), 0 > l[q] && (l[q] = 0), l[q] + c[q] > ia.MAX_BITS_PER_CHANNEL && (l[q] = Math.max(0, ia.MAX_BITS_PER_CHANNEL - c[q])), k += l[q]; if (k > a) for (q = 0; q < e.channels_out; ++q)l[q] = a * l[q] / k; for (q = 0; q < e.channels_out; ++q)c[q] += l[q], a -= l[q]; for (q = k = 0; q < e.channels_out; ++q)k += c[q]; if (k > ia.MAX_BITS_PER_GRANULE) for (q = 0; q < e.channels_out; ++q)c[q] *= ia.MAX_BITS_PER_GRANULE,
                                            c[q] /= k; return h
                                }; this.reduce_side = function (a, b, c, d) { b = .33 * (.5 - b) / .5; 0 > b && (b = 0); .5 < b && (b = .5); b = 0 | .5 * b * (a[0] + a[1]); b > ia.MAX_BITS_PER_CHANNEL - a[0] && (b = ia.MAX_BITS_PER_CHANNEL - a[0]); 0 > b && (b = 0); 125 <= a[1] && (125 < a[1] - b ? (a[0] < c && (a[0] += b), a[1] -= b) : (a[0] += a[1] - 125, a[1] = 125)); b = a[0] + a[1]; b > d && (a[0] = d * a[0] / b, a[1] = d * a[1] / b) }; this.athAdjust = function (a, b, c) { b = Z.FAST_LOG10_X(b, 10); a *= a; var e = 0; b -= c; 1E-20 < a && (e = 1 + Z.FAST_LOG10_X(a, 10 / 90.30873362)); 0 > e && (e = 0); return Math.pow(10, .1 * (b * e + (c + 90.30873362 - 94.82444863))) };
                this.calc_xmin = function (a, b, c, d) {
                    var e = 0, g = a.internal_flags, m, l = 0, q = 0, k = g.ATH, h = c.xr, p = a.VBR == J.vbr_mtrh ? 1 : 0, A = g.masking_lower; if (a.VBR == J.vbr_mtrh || a.VBR == J.vbr_mt) A = 1; for (m = 0; m < c.psy_lmax; m++) {
                        var w = a.VBR == J.vbr_rh || a.VBR == J.vbr_mtrh ? athAdjust(k.adjust, k.l[m], k.floor) : k.adjust * k.l[m]; var r = c.width[m]; var B = w / r; var x = 2.220446049250313E-16; var u = r >> 1; var I = 0; do { var H = h[l] * h[l]; I += H; x += H < B ? H : B; l++; H = h[l] * h[l]; I += H; x += H < B ? H : B; l++ } while (0 < --u); I > w && q++; m == f.SBPSY_l && (u = w * g.nsPsy.longfact[m], x < u && (x =
                            u)); 0 != p && (w = x); a.ATHonly || (x = b.en.l[m], 0 < x && (u = I * b.thm.l[m] * A / x, 0 != p && (u *= g.nsPsy.longfact[m]), w < u && (w = u))); 0 != p ? d[e++] = w : d[e++] = w * g.nsPsy.longfact[m]
                    } w = 575; if (c.block_type != f.SHORT_TYPE) for (I = 576; 0 != I-- && da.EQ(h[I], 0);)w = I; c.max_nonzero_coeff = w; for (var M = c.sfb_smin; m < c.psymax; M++, m += 3) {
                        var Q; var V = a.VBR == J.vbr_rh || a.VBR == J.vbr_mtrh ? athAdjust(k.adjust, k.s[M], k.floor) : k.adjust * k.s[M]; r = c.width[m]; for (Q = 0; 3 > Q; Q++) {
                            I = 0; u = r >> 1; B = V / r; x = 2.220446049250313E-16; do H = h[l] * h[l], I += H, x += H < B ? H : B, l++, H = h[l] * h[l],
                                I += H, x += H < B ? H : B, l++; while (0 < --u); I > V && q++; M == f.SBPSY_s && (u = V * g.nsPsy.shortfact[M], x < u && (x = u)); w = 0 != p ? x : V; a.ATHonly || a.ATHshort || (x = b.en.s[M][Q], 0 < x && (u = I * b.thm.s[M][Q] * A / x, 0 != p && (u *= g.nsPsy.shortfact[M]), w < u && (w = u))); 0 != p ? d[e++] = w : d[e++] = w * g.nsPsy.shortfact[M]
                        } a.useTemporal && (d[e - 3] > d[e - 3 + 1] && (d[e - 3 + 1] += (d[e - 3] - d[e - 3 + 1]) * g.decay), d[e - 3 + 1] > d[e - 3 + 2] && (d[e - 3 + 2] += (d[e - 3 + 1] - d[e - 3 + 2]) * g.decay))
                    } return q
                }; this.calc_noise_core = function (a, c, d, f) {
                    var e = 0, g = c.s, m = a.l3_enc; if (g > a.count1) for (; 0 != d--;) {
                        var l = a.xr[g];
                        g++; e += l * l; l = a.xr[g]; g++; e += l * l
                    } else if (g > a.big_values) { var q = G(2); q[0] = 0; for (q[1] = f; 0 != d--;)l = Math.abs(a.xr[g]) - q[m[g]], g++, e += l * l, l = Math.abs(a.xr[g]) - q[m[g]], g++, e += l * l } else for (; 0 != d--;)l = Math.abs(a.xr[g]) - b[m[g]] * f, g++, e += l * l, l = Math.abs(a.xr[g]) - b[m[g]] * f, g++, e += l * l; c.s = g; return e
                }; this.calc_noise = function (a, b, d, f, t) {
                    var e = 0, g = 0, l, q = 0, r = 0, h = 0, p = -20, A = 0, y = a.scalefac, x = 0; for (l = f.over_SSD = 0; l < a.psymax; l++) {
                        var B = a.global_gain - (y[x++] + (0 != a.preflag ? c[l] : 0) << a.scalefac_scale + 1) - 8 * a.subblock_gain[a.window[l]];
                        if (null != t && t.step[l] == B) { var u = t.noise[l]; A += a.width[l]; d[e++] = u / b[g++]; u = t.noise_log[l] } else { u = w[B + Y.Q_MAX2]; var v = a.width[l] >> 1; A + a.width[l] > a.max_nonzero_coeff && (v = a.max_nonzero_coeff - A + 1, v = 0 < v ? v >> 1 : 0); A = new k(A); u = this.calc_noise_core(a, A, v, u); A = A.s; null != t && (t.step[l] = B, t.noise[l] = u); u = d[e++] = u / b[g++]; u = Z.FAST_LOG10(Math.max(u, 1E-20)); null != t && (t.noise_log[l] = u) } null != t && (t.global_gain = a.global_gain); h += u; 0 < u && (B = Math.max(0 | 10 * u + .5, 1), f.over_SSD += B * B, q++, r += u); p = Math.max(p, u)
                    } f.over_count = q;
                    f.tot_noise = h; f.over_noise = r; f.max_noise = p; return q
                }; this.set_pinfo = function (a, b, d, g, k) {
                    var e = a.internal_flags, m, l, q = 0 == b.scalefac_scale ? .5 : 1, w = b.scalefac, h = G(ra.SFBMAX), p = G(ra.SFBMAX), A = new Fb; calc_xmin(a, d, b, h); calc_noise(b, h, p, A, null); var t = 0; var r = b.sfb_lmax; b.block_type != f.SHORT_TYPE && 0 == b.mixed_block_flag && (r = 22); for (m = 0; m < r; m++) {
                        var B = e.scalefac_band.l[m]; var x = e.scalefac_band.l[m + 1]; var u = x - B; for (l = 0; t < x; t++)l += b.xr[t] * b.xr[t]; l /= u; var I = 1E15; e.pinfo.en[g][k][m] = I * l; e.pinfo.xfsf[g][k][m] =
                            I * h[m] * p[m] / u; l = 0 < d.en.l[m] && !a.ATHonly ? l / d.en.l[m] : 0; e.pinfo.thr[g][k][m] = I * Math.max(l * d.thm.l[m], e.ATH.l[m]); e.pinfo.LAMEsfb[g][k][m] = 0; 0 != b.preflag && 11 <= m && (e.pinfo.LAMEsfb[g][k][m] = -q * c[m]); m < f.SBPSY_l && (e.pinfo.LAMEsfb[g][k][m] -= q * w[m])
                    } if (b.block_type == f.SHORT_TYPE) for (r = m, m = b.sfb_smin; m < f.SBMAX_s; m++) {
                        B = e.scalefac_band.s[m]; x = e.scalefac_band.s[m + 1]; u = x - B; for (var H = 0; 3 > H; H++) {
                            l = 0; for (I = B; I < x; I++)l += b.xr[t] * b.xr[t], t++; l = Math.max(l / u, 1E-20); I = 1E15; e.pinfo.en_s[g][k][3 * m + H] = I * l; e.pinfo.xfsf_s[g][k][3 *
                                m + H] = I * h[r] * p[r] / u; l = 0 < d.en.s[m][H] ? l / d.en.s[m][H] : 0; if (a.ATHonly || a.ATHshort) l = 0; e.pinfo.thr_s[g][k][3 * m + H] = I * Math.max(l * d.thm.s[m][H], e.ATH.s[m]); e.pinfo.LAMEsfb_s[g][k][3 * m + H] = -2 * b.subblock_gain[H]; m < f.SBPSY_s && (e.pinfo.LAMEsfb_s[g][k][3 * m + H] -= q * w[r]); r++
                        }
                    } e.pinfo.LAMEqss[g][k] = b.global_gain; e.pinfo.LAMEmainbits[g][k] = b.part2_3_length + b.part2_length; e.pinfo.LAMEsfbits[g][k] = b.part2_length; e.pinfo.over[g][k] = A.over_count; e.pinfo.max_noise[g][k] = 10 * A.max_noise; e.pinfo.over_noise[g][k] = 10 * A.over_noise;
                    e.pinfo.tot_noise[g][k] = 10 * A.tot_noise; e.pinfo.over_SSD[g][k] = A.over_SSD
                }
            } function Dc() { this.sfb_count1 = this.global_gain = 0; this.step = U(39); this.noise = G(39); this.noise_log = G(39) } function rb() {
                this.xr = G(576); this.l3_enc = U(576); this.scalefac = U(ra.SFBMAX); this.mixed_block_flag = this.block_type = this.scalefac_compress = this.global_gain = this.count1 = this.big_values = this.part2_3_length = this.xrpow_max = 0; this.table_select = U(3); this.subblock_gain = U(4); this.sfbdivide = this.psymax = this.sfbmax = this.psy_lmax = this.sfb_smin =
                    this.sfb_lmax = this.part2_length = this.count1table_select = this.scalefac_scale = this.preflag = this.region1_count = this.region0_count = 0; this.width = U(ra.SFBMAX); this.window = U(ra.SFBMAX); this.count1bits = 0; this.sfb_partition_table = null; this.slen = U(4); this.max_nonzero_coeff = 0; var f = this; this.assign = function (k) {
                        f.xr = new Float32Array(k.xr); f.l3_enc = new Int32Array(k.l3_enc); f.scalefac = new Int32Array(k.scalefac); f.xrpow_max = k.xrpow_max; f.part2_3_length = k.part2_3_length; f.big_values = k.big_values; f.count1 = k.count1;
                        f.global_gain = k.global_gain; f.scalefac_compress = k.scalefac_compress; f.block_type = k.block_type; f.mixed_block_flag = k.mixed_block_flag; f.table_select = new Int32Array(k.table_select); f.subblock_gain = new Int32Array(k.subblock_gain); f.region0_count = k.region0_count; f.region1_count = k.region1_count; f.preflag = k.preflag; f.scalefac_scale = k.scalefac_scale; f.count1table_select = k.count1table_select; f.part2_length = k.part2_length; f.sfb_lmax = k.sfb_lmax; f.sfb_smin = k.sfb_smin; f.psy_lmax = k.psy_lmax; f.sfbmax = k.sfbmax; f.psymax =
                            k.psymax; f.sfbdivide = k.sfbdivide; f.width = new Int32Array(k.width); f.window = new Int32Array(k.window); f.count1bits = k.count1bits; f.sfb_partition_table = k.sfb_partition_table.slice(0); f.slen = new Int32Array(k.slen); f.max_nonzero_coeff = k.max_nonzero_coeff
                    }
            } function Ec() {
                function x(d) { this.ordinal = d } function k(d) { for (var c = 0; c < d.sfbmax; c++)if (0 == d.scalefac[c] + d.subblock_gain[d.window[c]]) return !1; return !0 } var r; this.rv = null; var v; this.qupvt = null; var C, u = new yc, fa; this.setModules = function (d, c, f, a) {
                    r = d; this.rv =
                        v = c; this.qupvt = C = f; fa = a; u.setModules(C, fa)
                }; this.ms_convert = function (d, c) { for (var f = 0; 576 > f; ++f) { var a = d.tt[c][0].xr[f], b = d.tt[c][1].xr[f]; d.tt[c][0].xr[f] = .5 * (a + b) * Z.SQRT2; d.tt[c][1].xr[f] = .5 * (a - b) * Z.SQRT2 } }; this.init_xrpow = function (d, c, f) {
                    var a = 0 | c.max_nonzero_coeff; c.xrpow_max = 0; qa.fill(f, a, 576, 0); for (var b, k = b = 0; k <= a; ++k) { var e = Math.abs(c.xr[k]); b += e; f[k] = Math.sqrt(e * Math.sqrt(e)); f[k] > c.xrpow_max && (c.xrpow_max = f[k]) } if (1E-20 < b) {
                        f = 0; 0 != (d.substep_shaping & 2) && (f = 1); for (a = 0; a < c.psymax; a++)d.pseudohalf[a] =
                            f; return !0
                    } qa.fill(c.l3_enc, 0, 576, 0); return !1
                }; this.init_outer_loop = function (d, c) {
                    c.part2_3_length = 0; c.big_values = 0; c.count1 = 0; c.global_gain = 210; c.scalefac_compress = 0; c.table_select[0] = 0; c.table_select[1] = 0; c.table_select[2] = 0; c.subblock_gain[0] = 0; c.subblock_gain[1] = 0; c.subblock_gain[2] = 0; c.subblock_gain[3] = 0; c.region0_count = 0; c.region1_count = 0; c.preflag = 0; c.scalefac_scale = 0; c.count1table_select = 0; c.part2_length = 0; c.sfb_lmax = f.SBPSY_l; c.sfb_smin = f.SBPSY_s; c.psy_lmax = d.sfb21_extra ? f.SBMAX_l : f.SBPSY_l;
                    c.psymax = c.psy_lmax; c.sfbmax = c.sfb_lmax; c.sfbdivide = 11; for (var k = 0; k < f.SBMAX_l; k++)c.width[k] = d.scalefac_band.l[k + 1] - d.scalefac_band.l[k], c.window[k] = 3; if (c.block_type == f.SHORT_TYPE) {
                        var a = G(576); c.sfb_smin = 0; c.sfb_lmax = 0; 0 != c.mixed_block_flag && (c.sfb_smin = 3, c.sfb_lmax = 2 * d.mode_gr + 4); c.psymax = c.sfb_lmax + 3 * ((d.sfb21_extra ? f.SBMAX_s : f.SBPSY_s) - c.sfb_smin); c.sfbmax = c.sfb_lmax + 3 * (f.SBPSY_s - c.sfb_smin); c.sfbdivide = c.sfbmax - 18; c.psy_lmax = c.sfb_lmax; var b = d.scalefac_band.l[c.sfb_lmax]; S.arraycopy(c.xr, 0,
                            a, 0, 576); for (k = c.sfb_smin; k < f.SBMAX_s; k++)for (var r = d.scalefac_band.s[k], e = d.scalefac_band.s[k + 1], l = 0; 3 > l; l++)for (var q = r; q < e; q++)c.xr[b++] = a[3 * q + l]; a = c.sfb_lmax; for (k = c.sfb_smin; k < f.SBMAX_s; k++)c.width[a] = c.width[a + 1] = c.width[a + 2] = d.scalefac_band.s[k + 1] - d.scalefac_band.s[k], c.window[a] = 0, c.window[a + 1] = 1, c.window[a + 2] = 2, a += 3
                    } c.count1bits = 0; c.sfb_partition_table = C.nr_of_sfb_block[0][0]; c.slen[0] = 0; c.slen[1] = 0; c.slen[2] = 0; c.slen[3] = 0; c.max_nonzero_coeff = 575; qa.fill(c.scalefac, 0); k = d.ATH; a = c.xr; if (c.block_type !=
                        f.SHORT_TYPE) for (b = !1, r = f.PSFB21 - 1; 0 <= r && !b; r--)for (c = d.scalefac_band.psfb21[r], e = d.scalefac_band.psfb21[r + 1], l = C.athAdjust(k.adjust, k.psfb21[r], k.floor), 1E-12 < d.nsPsy.longfact[21] && (l *= d.nsPsy.longfact[21]), --e; e >= c; e--)if (Math.abs(a[e]) < l) a[e] = 0; else { b = !0; break } else for (l = 0; 3 > l; l++)for (b = !1, r = f.PSFB12 - 1; 0 <= r && !b; r--)for (c = 3 * d.scalefac_band.s[12] + (d.scalefac_band.s[13] - d.scalefac_band.s[12]) * l + (d.scalefac_band.psfb12[r] - d.scalefac_band.psfb12[0]), e = c + (d.scalefac_band.psfb12[r + 1] - d.scalefac_band.psfb12[r]),
                            q = C.athAdjust(k.adjust, k.psfb12[r], k.floor), 1E-12 < d.nsPsy.shortfact[12] && (q *= d.nsPsy.shortfact[12]), --e; e >= c; e--)if (Math.abs(a[e]) < q) a[e] = 0; else { b = !0; break }
                }; x.BINSEARCH_NONE = new x(0); x.BINSEARCH_UP = new x(1); x.BINSEARCH_DOWN = new x(2); this.trancate_smallspectrums = function (d, c, k, a) {
                    var b = G(ra.SFBMAX); if ((0 != (d.substep_shaping & 4) || c.block_type != f.SHORT_TYPE) && 0 == (d.substep_shaping & 128)) {
                        C.calc_noise(c, k, b, new Fb, null); for (var r = 0; 576 > r; r++) { var e = 0; 0 != c.l3_enc[r] && (e = Math.abs(c.xr[r])); a[r] = e } r = 0; e =
                            8; c.block_type == f.SHORT_TYPE && (e = 6); do { var l, q, g = c.width[e], r = r + g; if (!(1 <= b[e] || (qa.sort(a, r - g, g), da.EQ(a[r - 1], 0)))) { var t = (1 - b[e]) * k[e]; var w = l = 0; do { for (q = 1; w + q < g && !da.NEQ(a[w + r - g], a[w + r + q - g]); q++); var m = a[w + r - g] * a[w + r - g] * q; if (t < m) { 0 != w && (l = a[w + r - g - 1]); break } t -= m; w += q } while (w < g); if (!da.EQ(l, 0)) { do Math.abs(c.xr[r - g]) <= l && (c.l3_enc[r - g] = 0); while (0 < --g) } } } while (++e < c.psymax); c.part2_3_length = fa.noquant_count_bits(d, c, null)
                    }
                }; this.outer_loop = function (d, c, r, a, b, u) {
                    var e = d.internal_flags, l = new rb, q = G(576),
                    g = G(ra.SFBMAX), t = new Fb, w = new Dc, m = 9999999, n = !1, B = !1, v = 0, h, p = e.CurrentStep[b], A = !1, y = e.OldValue[b]; var O = x.BINSEARCH_NONE; c.global_gain = y; for (h = u - c.part2_length; ;) { var F = fa.count_bits(e, a, c, null); if (1 == p || F == h) break; F > h ? (O == x.BINSEARCH_DOWN && (A = !0), A && (p /= 2), O = x.BINSEARCH_UP, F = p) : (O == x.BINSEARCH_UP && (A = !0), A && (p /= 2), O = x.BINSEARCH_DOWN, F = -p); c.global_gain += F; 0 > c.global_gain && (c.global_gain = 0, A = !0); 255 < c.global_gain && (c.global_gain = 255, A = !0) } for (; F > h && 255 > c.global_gain;)c.global_gain++, F = fa.count_bits(e,
                        a, c, null); e.CurrentStep[b] = 4 <= y - c.global_gain ? 4 : 2; e.OldValue[b] = c.global_gain; c.part2_3_length = F; if (0 == e.noise_shaping) return 100; C.calc_noise(c, r, g, t, w); t.bits = c.part2_3_length; l.assign(c); b = 0; for (S.arraycopy(a, 0, q, 0, 576); !n;) {
                            do {
                                h = new Fb; A = 255; p = 0 != (e.substep_shaping & 2) ? 20 : 3; if (e.sfb21_extra) { if (1 < g[l.sfbmax]) break; if (l.block_type == f.SHORT_TYPE && (1 < g[l.sfbmax + 1] || 1 < g[l.sfbmax + 2])) break } y = l; F = a; O = d.internal_flags; var R = y, X = g, I = F, H = d.internal_flags; var M = 0 == R.scalefac_scale ? 1.2968395546510096 : 1.6817928305074292;
                                for (var Q = 0, V = 0; V < R.sfbmax; V++)Q < X[V] && (Q = X[V]); V = H.noise_shaping_amp; 3 == V && (V = B ? 2 : 1); switch (V) { case 2: break; case 1: Q = 1 < Q ? Math.pow(Q, .5) : .95 * Q; break; default: Q = 1 < Q ? 1 : .95 * Q }for (var N = 0, V = 0; V < R.sfbmax; V++) { var la = R.width[V], N = N + la; if (!(X[V] < Q)) { if (0 != (H.substep_shaping & 2) && (H.pseudohalf[V] = 0 == H.pseudohalf[V] ? 1 : 0, 0 == H.pseudohalf[V] && 2 == H.noise_shaping_amp)) break; R.scalefac[V]++; for (la = -la; 0 > la; la++)I[N + la] *= M, I[N + la] > R.xrpow_max && (R.xrpow_max = I[N + la]); if (2 == H.noise_shaping_amp) break } } if (M = k(y)) y = !1; else if (M =
                                    2 == O.mode_gr ? fa.scale_bitcount(y) : fa.scale_bitcount_lsf(O, y)) {
                                        if (1 < O.noise_shaping) if (qa.fill(O.pseudohalf, 0), 0 == y.scalefac_scale) { M = y; for (X = R = 0; X < M.sfbmax; X++) { H = M.width[X]; I = M.scalefac[X]; 0 != M.preflag && (I += C.pretab[X]); R += H; if (0 != (I & 1)) for (I++, H = -H; 0 > H; H++)F[R + H] *= 1.2968395546510096, F[R + H] > M.xrpow_max && (M.xrpow_max = F[R + H]); M.scalefac[X] = I >> 1 } M.preflag = 0; M.scalefac_scale = 1; M = !1 } else if (y.block_type == f.SHORT_TYPE && 0 < O.subblock_gain) {
                                            b: {
                                                M = O; R = y; X = F; I = R.scalefac; for (F = 0; F < R.sfb_lmax; F++)if (16 <= I[F]) {
                                                    F =
                                                    !0; break b
                                                } for (H = 0; 3 > H; H++) {
                                                    V = Q = 0; for (F = R.sfb_lmax + H; F < R.sfbdivide; F += 3)Q < I[F] && (Q = I[F]); for (; F < R.sfbmax; F += 3)V < I[F] && (V = I[F]); if (!(16 > Q && 8 > V)) {
                                                        if (7 <= R.subblock_gain[H]) { F = !0; break b } R.subblock_gain[H]++; Q = M.scalefac_band.l[R.sfb_lmax]; for (F = R.sfb_lmax + H; F < R.sfbmax; F += 3)if (V = R.width[F], N = I[F], N -= 4 >> R.scalefac_scale, 0 <= N) I[F] = N, Q += 3 * V; else { I[F] = 0; N = C.IPOW20(210 + (N << R.scalefac_scale + 1)); Q += V * (H + 1); for (la = -V; 0 > la; la++)X[Q + la] *= N, X[Q + la] > R.xrpow_max && (R.xrpow_max = X[Q + la]); Q += V * (3 - H - 1) } N = C.IPOW20(202);
                                                        Q += R.width[F] * (H + 1); for (la = -R.width[F]; 0 > la; la++)X[Q + la] *= N, X[Q + la] > R.xrpow_max && (R.xrpow_max = X[Q + la])
                                                    }
                                                } F = !1
                                            } M = F || k(y)
                                        } M || (M = 2 == O.mode_gr ? fa.scale_bitcount(y) : fa.scale_bitcount_lsf(O, y)); y = !M
                                } else y = !0; if (!y) break; 0 != l.scalefac_scale && (A = 254); y = u - l.part2_length; if (0 >= y) break; for (; (l.part2_3_length = fa.count_bits(e, a, l, w)) > y && l.global_gain <= A;)l.global_gain++; if (l.global_gain > A) break; if (0 == t.over_count) {
                                    for (; (l.part2_3_length = fa.count_bits(e, a, l, w)) > m && l.global_gain <= A;)l.global_gain++; if (l.global_gain >
                                        A) break
                                } C.calc_noise(l, r, g, h, w); h.bits = l.part2_3_length; O = c.block_type != f.SHORT_TYPE ? d.quant_comp : d.quant_comp_short; A = t; y = h; M = l; F = g; switch (O) {
                                    default: case 9: 0 < A.over_count ? (O = y.over_SSD <= A.over_SSD, y.over_SSD == A.over_SSD && (O = y.bits < A.bits)) : O = 0 > y.max_noise && 10 * y.max_noise + y.bits <= 10 * A.max_noise + A.bits; break; case 0: O = y.over_count < A.over_count || y.over_count == A.over_count && y.over_noise < A.over_noise || y.over_count == A.over_count && da.EQ(y.over_noise, A.over_noise) && y.tot_noise < A.tot_noise; break; case 8: O =
                                        y; X = 1E-37; for (R = 0; R < M.psymax; R++)I = F[R], I = Z.FAST_LOG10(.368 + .632 * I * I * I), X += I; O.max_noise = Math.max(1E-20, X); case 1: O = y.max_noise < A.max_noise; break; case 2: O = y.tot_noise < A.tot_noise; break; case 3: O = y.tot_noise < A.tot_noise && y.max_noise < A.max_noise; break; case 4: O = 0 >= y.max_noise && .2 < A.max_noise || 0 >= y.max_noise && 0 > A.max_noise && A.max_noise > y.max_noise - .2 && y.tot_noise < A.tot_noise || 0 >= y.max_noise && 0 < A.max_noise && A.max_noise > y.max_noise - .2 && y.tot_noise < A.tot_noise + A.over_noise || 0 < y.max_noise && -.05 < A.max_noise &&
                                            A.max_noise > y.max_noise - .1 && y.tot_noise + y.over_noise < A.tot_noise + A.over_noise || 0 < y.max_noise && -.1 < A.max_noise && A.max_noise > y.max_noise - .15 && y.tot_noise + y.over_noise + y.over_noise < A.tot_noise + A.over_noise + A.over_noise; break; case 5: O = y.over_noise < A.over_noise || da.EQ(y.over_noise, A.over_noise) && y.tot_noise < A.tot_noise; break; case 6: O = y.over_noise < A.over_noise || da.EQ(y.over_noise, A.over_noise) && (y.max_noise < A.max_noise || da.EQ(y.max_noise, A.max_noise) && y.tot_noise <= A.tot_noise); break; case 7: O = y.over_count <
                                                A.over_count || y.over_noise < A.over_noise
                                }0 == A.over_count && (O = O && y.bits < A.bits); O = O ? 1 : 0; if (0 != O) m = c.part2_3_length, t = h, c.assign(l), b = 0, S.arraycopy(a, 0, q, 0, 576); else if (0 == e.full_outer_loop) { if (++b > p && 0 == t.over_count) break; if (3 == e.noise_shaping_amp && B && 30 < b) break; if (3 == e.noise_shaping_amp && B && 15 < l.global_gain - v) break }
                            } while (255 > l.global_gain + l.scalefac_scale); 3 == e.noise_shaping_amp ? B ? n = !0 : (l.assign(c), S.arraycopy(q, 0, a, 0, 576), b = 0, v = l.global_gain, B = !0) : n = !0
                        } d.VBR == J.vbr_rh || d.VBR == J.vbr_mtrh ? S.arraycopy(q,
                            0, a, 0, 576) : 0 != (e.substep_shaping & 1) && trancate_smallspectrums(e, c, r, a); return t.over_count
                }; this.iteration_finish_one = function (d, c, f) { var a = d.l3_side, b = a.tt[c][f]; fa.best_scalefac_store(d, c, f, a); 1 == d.use_best_huffman && fa.best_huffman_divide(d, b); v.ResvAdjust(d, b) }; this.VBR_encode_granule = function (d, c, f, a, b, k, e) {
                    var l = d.internal_flags, q = new rb, g = G(576), r = e, w = (e + k) / 2, m = 0, n = l.sfb21_extra; qa.fill(q.l3_enc, 0); do {
                        l.sfb21_extra = w > r - 42 ? !1 : n; var u = outer_loop(d, c, f, a, b, w); 0 >= u ? (m = 1, e = c.part2_3_length, q.assign(c),
                            S.arraycopy(a, 0, g, 0, 576), e -= 32, u = e - k, w = (e + k) / 2) : (k = w + 32, u = e - k, w = (e + k) / 2, 0 != m && (m = 2, c.assign(q), S.arraycopy(g, 0, a, 0, 576)))
                    } while (12 < u); l.sfb21_extra = n; 2 == m && S.arraycopy(q.l3_enc, 0, c.l3_enc, 0, 576)
                }; this.get_framebits = function (d, c) { var f = d.internal_flags; f.bitrate_index = f.VBR_min_bitrate; r.getframebits(d); f.bitrate_index = 1; var a = r.getframebits(d); for (var b = 1; b <= f.VBR_max_bitrate; b++)f.bitrate_index = b, a = new Fa(a), c[b] = v.ResvFrameBegin(d, a), a = a.bits }; this.VBR_old_prepare = function (d, c, k, a, b, r, e, l, q) {
                    var g =
                        d.internal_flags, t = 1, w = 0; g.bitrate_index = g.VBR_max_bitrate; var m = v.ResvFrameBegin(d, new Fa(0)) / g.mode_gr; get_framebits(d, r); for (var n = 0; n < g.mode_gr; n++) {
                            var u = C.on_pe(d, c, l[n], m, n, 0); g.mode_ext == f.MPG_MD_MS_LR && (ms_convert(g.l3_side, n), C.reduce_side(l[n], k[n], m, u)); for (u = 0; u < g.channels_out; ++u) {
                                var x = g.l3_side.tt[n][u]; if (x.block_type != f.SHORT_TYPE) { var h = 1.28 / (1 + Math.exp(3.5 - c[n][u] / 300)) - .05; h = g.PSY.mask_adjust - h } else h = 2.56 / (1 + Math.exp(3.5 - c[n][u] / 300)) - .14, h = g.PSY.mask_adjust_short - h; g.masking_lower =
                                    Math.pow(10, .1 * h); init_outer_loop(g, x); q[n][u] = C.calc_xmin(d, a[n][u], x, b[n][u]); 0 != q[n][u] && (t = 0); e[n][u] = 126; w += l[n][u]
                            }
                        } for (n = 0; n < g.mode_gr; n++)for (u = 0; u < g.channels_out; u++)w > r[g.VBR_max_bitrate] && (l[n][u] *= r[g.VBR_max_bitrate], l[n][u] /= w), e[n][u] > l[n][u] && (e[n][u] = l[n][u]); return t
                }; this.bitpressure_strategy = function (d, c, k, a) {
                    for (var b = 0; b < d.mode_gr; b++)for (var r = 0; r < d.channels_out; r++) {
                        for (var e = d.l3_side.tt[b][r], l = c[b][r], q = 0, g = 0; g < e.psy_lmax; g++)l[q++] *= 1 + .029 * g * g / f.SBMAX_l / f.SBMAX_l; if (e.block_type ==
                            f.SHORT_TYPE) for (g = e.sfb_smin; g < f.SBMAX_s; g++)l[q++] *= 1 + .029 * g * g / f.SBMAX_s / f.SBMAX_s, l[q++] *= 1 + .029 * g * g / f.SBMAX_s / f.SBMAX_s, l[q++] *= 1 + .029 * g * g / f.SBMAX_s / f.SBMAX_s; a[b][r] = 0 | Math.max(k[b][r], .9 * a[b][r])
                    }
                }; this.VBR_new_prepare = function (d, c, k, a, b, r) {
                    var e, l = d.internal_flags, q = 1, g = e = 0; if (d.free_format) { l.bitrate_index = 0; e = new Fa(e); var t = v.ResvFrameBegin(d, e); e = e.bits; b[0] = t } else l.bitrate_index = l.VBR_max_bitrate, e = new Fa(e), v.ResvFrameBegin(d, e), e = e.bits, get_framebits(d, b), t = b[l.VBR_max_bitrate]; for (b =
                        0; b < l.mode_gr; b++) { C.on_pe(d, c, r[b], e, b, 0); l.mode_ext == f.MPG_MD_MS_LR && ms_convert(l.l3_side, b); for (var u = 0; u < l.channels_out; ++u) { var m = l.l3_side.tt[b][u]; l.masking_lower = Math.pow(10, .1 * l.PSY.mask_adjust); init_outer_loop(l, m); 0 != C.calc_xmin(d, k[b][u], m, a[b][u]) && (q = 0); g += r[b][u] } } for (b = 0; b < l.mode_gr; b++)for (u = 0; u < l.channels_out; u++)g > t && (r[b][u] *= t, r[b][u] /= g); return q
                }; this.calc_target_bits = function (d, c, k, a, b, u) {
                    var e = d.internal_flags, l = e.l3_side; e.bitrate_index = e.VBR_max_bitrate; var q = new Fa(0);
                    u[0] = v.ResvFrameBegin(d, q); e.bitrate_index = 1; q = r.getframebits(d) - 8 * e.sideinfo_len; b[0] = q / (e.mode_gr * e.channels_out); q = d.VBR_mean_bitrate_kbps * d.framesize * 1E3; 0 != (e.substep_shaping & 1) && (q *= 1.09); q /= d.out_samplerate; q -= 8 * e.sideinfo_len; q /= e.mode_gr * e.channels_out; var g = .93 + .07 * (11 - d.compression_ratio) / 5.5; .9 > g && (g = .9); 1 < g && (g = 1); for (d = 0; d < e.mode_gr; d++) {
                        var t = 0; for (b = 0; b < e.channels_out; b++) {
                            a[d][b] = int(g * q); if (700 < c[d][b]) {
                                var w = int((c[d][b] - 700) / 1.4), m = l.tt[d][b]; a[d][b] = int(g * q); m.block_type == f.SHORT_TYPE &&
                                    w < q / 2 && (w = q / 2); w > 3 * q / 2 ? w = 3 * q / 2 : 0 > w && (w = 0); a[d][b] += w
                            } a[d][b] > ia.MAX_BITS_PER_CHANNEL && (a[d][b] = ia.MAX_BITS_PER_CHANNEL); t += a[d][b]
                        } if (t > ia.MAX_BITS_PER_GRANULE) for (b = 0; b < e.channels_out; ++b)a[d][b] *= ia.MAX_BITS_PER_GRANULE, a[d][b] /= t
                    } if (e.mode_ext == f.MPG_MD_MS_LR) for (d = 0; d < e.mode_gr; d++)C.reduce_side(a[d], k[d], q * e.channels_out, ia.MAX_BITS_PER_GRANULE); for (d = c = 0; d < e.mode_gr; d++)for (b = 0; b < e.channels_out; b++)a[d][b] > ia.MAX_BITS_PER_CHANNEL && (a[d][b] = ia.MAX_BITS_PER_CHANNEL), c += a[d][b]; if (c > u[0]) for (d =
                        0; d < e.mode_gr; d++)for (b = 0; b < e.channels_out; b++)a[d][b] *= u[0], a[d][b] /= c
                }
            } function Fc() {
                function x(c, d, a) {
                    for (var b, f, e = 10, l = d + 238 - 14 - 286, q = -15; 0 > q; q++) {
                        var g = k[e + -10]; f = c[l + -224] * g; b = c[d + 224] * g; g = k[e + -9]; f += c[l + -160] * g; b += c[d + 160] * g; g = k[e + -8]; f += c[l + -96] * g; b += c[d + 96] * g; g = k[e + -7]; f += c[l + -32] * g; b += c[d + 32] * g; g = k[e + -6]; f += c[l + 32] * g; b += c[d + -32] * g; g = k[e + -5]; f += c[l + 96] * g; b += c[d + -96] * g; g = k[e + -4]; f += c[l + 160] * g; b += c[d + -160] * g; g = k[e + -3]; f += c[l + 224] * g; b += c[d + -224] * g; g = k[e + -2]; f += c[d + -256] * g; b -= c[l + 256] * g; g = k[e +
                            -1]; f += c[d + -192] * g; b -= c[l + 192] * g; g = k[e + 0]; f += c[d + -128] * g; b -= c[l + 128] * g; g = k[e + 1]; f += c[d + -64] * g; b -= c[l + 64] * g; g = k[e + 2]; f += c[d + 0] * g; b -= c[l + 0] * g; g = k[e + 3]; f += c[d + 64] * g; b -= c[l + -64] * g; g = k[e + 4]; f += c[d + 128] * g; b -= c[l + -128] * g; g = k[e + 5]; f += c[d + 192] * g; b -= c[l + -192] * g; f *= k[e + 6]; g = b - f; a[30 + 2 * q] = b + f; a[31 + 2 * q] = k[e + 7] * g; e += 18; d--; l++
                    } b = c[d + -16] * k[e + -10]; f = c[d + -32] * k[e + -2]; b += (c[d + -48] - c[d + 16]) * k[e + -9]; f += c[d + -96] * k[e + -1]; b += (c[d + -80] + c[d + 48]) * k[e + -8]; f += c[d + -160] * k[e + 0]; b += (c[d + -112] - c[d + 80]) * k[e + -7]; f += c[d + -224] * k[e +
                        1]; b += (c[d + -144] + c[d + 112]) * k[e + -6]; f -= c[d + 32] * k[e + 2]; b += (c[d + -176] - c[d + 144]) * k[e + -5]; f -= c[d + 96] * k[e + 3]; b += (c[d + -208] + c[d + 176]) * k[e + -4]; f -= c[d + 160] * k[e + 4]; b += (c[d + -240] - c[d + 208]) * k[e + -3]; f -= c[d + 224]; c = f - b; d = f + b; b = a[14]; f = a[15] - b; a[31] = d + b; a[30] = c + f; a[15] = c - f; a[14] = d - b; b = a[28] - a[0]; a[0] += a[28]; a[28] = b * k[e + -36 + 7]; b = a[29] - a[1]; a[1] += a[29]; a[29] = b * k[e + -36 + 7]; b = a[26] - a[2]; a[2] += a[26]; a[26] = b * k[e + -72 + 7]; b = a[27] - a[3]; a[3] += a[27]; a[27] = b * k[e + -72 + 7]; b = a[24] - a[4]; a[4] += a[24]; a[24] = b * k[e + -108 + 7]; b = a[25] - a[5];
                    a[5] += a[25]; a[25] = b * k[e + -108 + 7]; b = a[22] - a[6]; a[6] += a[22]; a[22] = b * Z.SQRT2; b = a[23] - a[7]; a[7] += a[23]; a[23] = b * Z.SQRT2 - a[7]; a[7] -= a[6]; a[22] -= a[7]; a[23] -= a[22]; b = a[6]; a[6] = a[31] - b; a[31] += b; b = a[7]; a[7] = a[30] - b; a[30] += b; b = a[22]; a[22] = a[15] - b; a[15] += b; b = a[23]; a[23] = a[14] - b; a[14] += b; b = a[20] - a[8]; a[8] += a[20]; a[20] = b * k[e + -180 + 7]; b = a[21] - a[9]; a[9] += a[21]; a[21] = b * k[e + -180 + 7]; b = a[18] - a[10]; a[10] += a[18]; a[18] = b * k[e + -216 + 7]; b = a[19] - a[11]; a[11] += a[19]; a[19] = b * k[e + -216 + 7]; b = a[16] - a[12]; a[12] += a[16]; a[16] = b * k[e + -252 +
                        7]; b = a[17] - a[13]; a[13] += a[17]; a[17] = b * k[e + -252 + 7]; b = -a[20] + a[24]; a[20] += a[24]; a[24] = b * k[e + -216 + 7]; b = -a[21] + a[25]; a[21] += a[25]; a[25] = b * k[e + -216 + 7]; b = a[4] - a[8]; a[4] += a[8]; a[8] = b * k[e + -216 + 7]; b = a[5] - a[9]; a[5] += a[9]; a[9] = b * k[e + -216 + 7]; b = a[0] - a[12]; a[0] += a[12]; a[12] = b * k[e + -72 + 7]; b = a[1] - a[13]; a[1] += a[13]; a[13] = b * k[e + -72 + 7]; b = a[16] - a[28]; a[16] += a[28]; a[28] = b * k[e + -72 + 7]; b = -a[17] + a[29]; a[17] += a[29]; a[29] = b * k[e + -72 + 7]; b = Z.SQRT2 * (a[2] - a[10]); a[2] += a[10]; a[10] = b; b = Z.SQRT2 * (a[3] - a[11]); a[3] += a[11]; a[11] = b; b = Z.SQRT2 *
                            (-a[18] + a[26]); a[18] += a[26]; a[26] = b - a[18]; b = Z.SQRT2 * (-a[19] + a[27]); a[19] += a[27]; a[27] = b - a[19]; b = a[2]; a[19] -= a[3]; a[3] -= b; a[2] = a[31] - b; a[31] += b; b = a[3]; a[11] -= a[19]; a[18] -= b; a[3] = a[30] - b; a[30] += b; b = a[18]; a[27] -= a[11]; a[19] -= b; a[18] = a[15] - b; a[15] += b; b = a[19]; a[10] -= b; a[19] = a[14] - b; a[14] += b; b = a[10]; a[11] -= b; a[10] = a[23] - b; a[23] += b; b = a[11]; a[26] -= b; a[11] = a[22] - b; a[22] += b; b = a[26]; a[27] -= b; a[26] = a[7] - b; a[7] += b; b = a[27]; a[27] = a[6] - b; a[6] += b; b = Z.SQRT2 * (a[0] - a[4]); a[0] += a[4]; a[4] = b; b = Z.SQRT2 * (a[1] - a[5]); a[1] +=
                                a[5]; a[5] = b; b = Z.SQRT2 * (a[16] - a[20]); a[16] += a[20]; a[20] = b; b = Z.SQRT2 * (a[17] - a[21]); a[17] += a[21]; a[21] = b; b = -Z.SQRT2 * (a[8] - a[12]); a[8] += a[12]; a[12] = b - a[8]; b = -Z.SQRT2 * (a[9] - a[13]); a[9] += a[13]; a[13] = b - a[9]; b = -Z.SQRT2 * (a[25] - a[29]); a[25] += a[29]; a[29] = b - a[25]; b = -Z.SQRT2 * (a[24] + a[28]); a[24] -= a[28]; a[28] = b - a[24]; b = a[24] - a[16]; a[24] = b; b = a[20] - b; a[20] = b; b = a[28] - b; a[28] = b; b = a[25] - a[17]; a[25] = b; b = a[21] - b; a[21] = b; b = a[29] - b; a[29] = b; b = a[17] - a[1]; a[17] = b; b = a[9] - b; a[9] = b; b = a[25] - b; a[25] = b; b = a[5] - b; a[5] = b; b = a[21] - b;
                    a[21] = b; b = a[13] - b; a[13] = b; b = a[29] - b; a[29] = b; b = a[1] - a[0]; a[1] = b; b = a[16] - b; a[16] = b; b = a[17] - b; a[17] = b; b = a[8] - b; a[8] = b; b = a[9] - b; a[9] = b; b = a[24] - b; a[24] = b; b = a[25] - b; a[25] = b; b = a[4] - b; a[4] = b; b = a[5] - b; a[5] = b; b = a[20] - b; a[20] = b; b = a[21] - b; a[21] = b; b = a[12] - b; a[12] = b; b = a[13] - b; a[13] = b; b = a[28] - b; a[28] = b; b = a[29] - b; a[29] = b; b = a[0]; a[0] += a[31]; a[31] -= b; b = a[1]; a[1] += a[30]; a[30] -= b; b = a[16]; a[16] += a[15]; a[15] -= b; b = a[17]; a[17] += a[14]; a[14] -= b; b = a[8]; a[8] += a[23]; a[23] -= b; b = a[9]; a[9] += a[22]; a[22] -= b; b = a[24]; a[24] += a[7]; a[7] -=
                        b; b = a[25]; a[25] += a[6]; a[6] -= b; b = a[4]; a[4] += a[27]; a[27] -= b; b = a[5]; a[5] += a[26]; a[26] -= b; b = a[20]; a[20] += a[11]; a[11] -= b; b = a[21]; a[21] += a[10]; a[10] -= b; b = a[12]; a[12] += a[19]; a[19] -= b; b = a[13]; a[13] += a[18]; a[18] -= b; b = a[28]; a[28] += a[3]; a[3] -= b; b = a[29]; a[29] += a[2]; a[2] -= b
                } var k = [-.1482523854003001, 32.308141959636465, 296.40344946382766, 883.1344870032432, 11113.947376231741, 1057.2713659324597, 305.7402417275812, 30.825928907280012, 3.8533188138216365, 59.42900443849514, 709.5899960123345, 5281.91112291017, -5829.66483675846,
                -817.6293103748613, -76.91656988279972, -4.594269939176596, .9063471690191471, .1960342806591213, -.15466694054279598, 34.324387823855965, 301.8067566458425, 817.599602898885, 11573.795901679885, 1181.2520595540152, 321.59731579894424, 31.232021761053772, 3.7107095756221318, 53.650946155329365, 684.167428119626, 5224.56624370173, -6366.391851890084, -908.9766368219582, -89.83068876699639, -5.411397422890401, .8206787908286602, .3901806440322567, -.16070888947830023, 36.147034243915876, 304.11815768187864, 732.7429163887613,
                    11989.60988270091, 1300.012278487897, 335.28490093152146, 31.48816102859945, 3.373875931311736, 47.232241542899175, 652.7371796173471, 5132.414255594984, -6909.087078780055, -1001.9990371107289, -103.62185754286375, -6.104916304710272, .7416505462720353, .5805693545089249, -.16636367662261495, 37.751650073343995, 303.01103387567713, 627.9747488785183, 12358.763425278165, 1412.2779918482834, 346.7496836825721, 31.598286663170416, 3.1598635433980946, 40.57878626349686, 616.1671130880391, 5007.833007176154, -7454.040671756168,
                -1095.7960341867115, -118.24411666465777, -6.818469345853504, .6681786379192989, .7653668647301797, -.1716176790982088, 39.11551877123304, 298.3413246578966, 503.5259106886539, 12679.589408408976, 1516.5821921214542, 355.9850766329023, 31.395241710249053, 2.9164211881972335, 33.79716964664243, 574.8943997801362, 4853.234992253242, -7997.57021486075, -1189.7624067269965, -133.6444792601766, -7.7202770609839915, .5993769336819237, .9427934736519954, -.17645823955292173, 40.21879108166477, 289.9982036694474, 359.3226160751053,
                    12950.259102786438, 1612.1013903507662, 362.85067106591504, 31.045922092242872, 2.822222032597987, 26.988862316190684, 529.8996541764288, 4671.371946949588, -8535.899136645805, -1282.5898586244496, -149.58553632943463, -8.643494270763135, .5345111359507916, 1.111140466039205, -.36174739330527045, 41.04429910497807, 277.5463268268618, 195.6386023135583, 13169.43812144731, 1697.6433561479398, 367.40983966190305, 30.557037410382826, 2.531473372857427, 20.070154905927314, 481.50208566532336, 4464.970341588308, -9065.36882077239,
                -1373.62841526722, -166.1660487028118, -9.58289321133207, .4729647758913199, 1.268786568327291, -.36970682634889585, 41.393213350082036, 261.2935935556502, 12.935476055240873, 13336.131683328815, 1772.508612059496, 369.76534388639965, 29.751323653701338, 2.4023193045459172, 13.304795348228817, 430.5615775526625, 4237.0568611071185, -9581.931701634761, -1461.6913552409758, -183.12733958476446, -10.718010163869403, .41421356237309503, 1.414213562373095, -.37677560326535325, 41.619486213528496, 241.05423794991074, -187.94665032361226,
                    13450.063605744153, 1836.153896465782, 369.4908799925761, 29.001847876923147, 2.0714759319987186, 6.779591200894186, 377.7767837205709, 3990.386575512536, -10081.709459700915, -1545.947424837898, -200.3762958015653, -11.864482073055006, .3578057213145241, 1.546020906725474, -.3829366947518991, 41.1516456456653, 216.47684307105183, -406.1569483347166, 13511.136535077321, 1887.8076599260432, 367.3025214564151, 28.136213436723654, 1.913880671464418, .3829366947518991, 323.85365704338597, 3728.1472257487526, -10561.233882199509,
                -1625.2025997821418, -217.62525175416, -13.015432208941645, .3033466836073424, 1.66293922460509, -.5822628872992417, 40.35639251440489, 188.20071124269245, -640.2706748618148, 13519.21490106562, 1927.6022433578062, 362.8197642637487, 26.968821921868447, 1.7463817695935329, -5.62650678237171, 269.3016715297017, 3453.386536448852, -11016.145278780888, -1698.6569643425091, -234.7658734267683, -14.16351421663124, .2504869601913055, 1.76384252869671, -.5887180101749253, 39.23429103868072, 155.76096234403798, -889.2492977967378,
                    13475.470561874661, 1955.0535223723712, 356.4450994756727, 25.894952980042156, 1.5695032905781554, -11.181939564328772, 214.80884394039484, 3169.1640829158237, -11443.321309975563, -1765.1588461316153, -251.68908574481912, -15.49755935939164, .198912367379658, 1.847759065022573, -.7912582233652842, 37.39369355329111, 119.699486012458, -1151.0956593239027, 13380.446257078214, 1970.3952110853447, 348.01959814116185, 24.731487364283044, 1.3850130831637748, -16.421408865300393, 161.05030052864092, 2878.3322807850063, -11838.991423510031,
                -1823.985884688674, -268.2854986386903, -16.81724543849939, .1483359875383474, 1.913880671464418, -.7960642926861912, 35.2322109610459, 80.01928065061526, -1424.0212633405113, 13235.794061869668, 1973.804052543835, 337.9908651258184, 23.289159354463873, 1.3934255946442087, -21.099669467133474, 108.48348407242611, 2583.700758091299, -12199.726194855148, -1874.2780658979746, -284.2467154529415, -18.11369784385905, .09849140335716425, 1.961570560806461, -.998795456205172, 32.56307803611191, 36.958364584370486, -1706.075448829146,
                    13043.287458812016, 1965.3831106103316, 326.43182772364605, 22.175018750622293, 1.198638339011324, -25.371248002043963, 57.53505923036915, 2288.41886619975, -12522.674544337233, -1914.8400385312243, -299.26241273417224, -19.37805630698734, .04912684976946725, 1.990369453344394, .0178904535 * Z.SQRT2 / 2.384E-6, .008938074 * Z.SQRT2 / 2.384E-6, .0015673635 * Z.SQRT2 / 2.384E-6, .001228571 * Z.SQRT2 / 2.384E-6, 4.856585E-4 * Z.SQRT2 / 2.384E-6, 1.09434E-4 * Z.SQRT2 / 2.384E-6, 5.0783E-5 * Z.SQRT2 / 2.384E-6, 6.914E-6 * Z.SQRT2 / 2.384E-6, 12804.797818791945,
                    1945.5515939597317, 313.4244966442953, 20.801593959731544, 1995.1556208053692, 9.000838926174497, -29.20218120805369], r = [[2.382191739347913E-13, 6.423305872147834E-13, 9.400849094049688E-13, 1.122435026096556E-12, 1.183840321267481E-12, 1.122435026096556E-12, 9.40084909404969E-13, 6.423305872147839E-13, 2.382191739347918E-13, 5.456116108943412E-12, 4.878985199565852E-12, 4.240448995017367E-12, 3.559909094758252E-12, 2.858043359288075E-12, 2.156177623817898E-12, 1.475637723558783E-12, 8.371015190102974E-13, 2.599706096327376E-13,
                        -5.456116108943412E-12, -4.878985199565852E-12, -4.240448995017367E-12, -3.559909094758252E-12, -2.858043359288076E-12, -2.156177623817898E-12, -1.475637723558783E-12, -8.371015190102975E-13, -2.599706096327376E-13, -2.382191739347923E-13, -6.423305872147843E-13, -9.400849094049696E-13, -1.122435026096556E-12, -1.183840321267481E-12, -1.122435026096556E-12, -9.400849094049694E-13, -6.42330587214784E-13, -2.382191739347918E-13], [2.382191739347913E-13, 6.423305872147834E-13, 9.400849094049688E-13, 1.122435026096556E-12,
                        1.183840321267481E-12, 1.122435026096556E-12, 9.400849094049688E-13, 6.423305872147841E-13, 2.382191739347918E-13, 5.456116108943413E-12, 4.878985199565852E-12, 4.240448995017367E-12, 3.559909094758253E-12, 2.858043359288075E-12, 2.156177623817898E-12, 1.475637723558782E-12, 8.371015190102975E-13, 2.599706096327376E-13, -5.461314069809755E-12, -4.921085770524055E-12, -4.343405037091838E-12, -3.732668368707687E-12, -3.093523840190885E-12, -2.430835727329465E-12, -1.734679010007751E-12, -9.74825365660928E-13, -2.797435120168326E-13,
                        0, 0, 0, 0, 0, 0, -2.283748241799531E-13, -4.037858874020686E-13, -2.146547464825323E-13], [.1316524975873958, .414213562373095, .7673269879789602, 1.091308501069271, 1.303225372841206, 1.56968557711749, 1.920982126971166, 2.414213562373094, 3.171594802363212, 4.510708503662055, 7.595754112725146, 22.90376554843115, .984807753012208, .6427876096865394, .3420201433256688, .9396926207859084, -.1736481776669303, -.7660444431189779, .8660254037844387, .5, -.5144957554275265, -.4717319685649723, -.3133774542039019, -.1819131996109812,
                        -.09457419252642064, -.04096558288530405, -.01419856857247115, -.003699974673760037, .8574929257125442, .8817419973177052, .9496286491027329, .9833145924917901, .9955178160675857, .9991605581781475, .999899195244447, .9999931550702802], [0, 0, 0, 0, 0, 0, 2.283748241799531E-13, 4.037858874020686E-13, 2.146547464825323E-13, 5.461314069809755E-12, 4.921085770524055E-12, 4.343405037091838E-12, 3.732668368707687E-12, 3.093523840190885E-12, 2.430835727329466E-12, 1.734679010007751E-12, 9.74825365660928E-13, 2.797435120168326E-13,
                        -5.456116108943413E-12, -4.878985199565852E-12, -4.240448995017367E-12, -3.559909094758253E-12, -2.858043359288075E-12, -2.156177623817898E-12, -1.475637723558782E-12, -8.371015190102975E-13, -2.599706096327376E-13, -2.382191739347913E-13, -6.423305872147834E-13, -9.400849094049688E-13, -1.122435026096556E-12, -1.183840321267481E-12, -1.122435026096556E-12, -9.400849094049688E-13, -6.423305872147841E-13, -2.382191739347918E-13]], v = r[f.SHORT_TYPE], C = r[f.SHORT_TYPE], u = r[f.SHORT_TYPE], J = r[f.SHORT_TYPE], d = [0, 1, 16, 17,
                            8, 9, 24, 25, 4, 5, 20, 21, 12, 13, 28, 29, 2, 3, 18, 19, 10, 11, 26, 27, 6, 7, 22, 23, 14, 15, 30, 31]; this.mdct_sub48 = function (c, k, a) {
                                for (var b = 286, w = 0; w < c.channels_out; w++) {
                                    for (var e = 0; e < c.mode_gr; e++) {
                                        for (var l, q = c.l3_side.tt[e][w], g = q.xr, t = 0, D = c.sb_sample[w][1 - e], m = 0, n = 0; 9 > n; n++)for (x(k, b, D[m]), x(k, b + 32, D[m + 1]), m += 2, b += 64, l = 1; 32 > l; l += 2)D[m - 1][l] *= -1; for (l = 0; 32 > l; l++, t += 18) {
                                            var D = q.block_type, m = c.sb_sample[w][e], z = c.sb_sample[w][1 - e]; 0 != q.mixed_block_flag && 2 > l && (D = 0); if (1E-12 > c.amp_filter[l]) qa.fill(g, t + 0, t + 18, 0); else {
                                                if (1 >
                                                    c.amp_filter[l]) for (n = 0; 18 > n; n++)z[n][d[l]] *= c.amp_filter[l]; if (D == f.SHORT_TYPE) {
                                                        for (n = -3; 0 > n; n++) { var E = r[f.SHORT_TYPE][n + 3]; g[t + 3 * n + 9] = m[9 + n][d[l]] * E - m[8 - n][d[l]]; g[t + 3 * n + 18] = m[14 - n][d[l]] * E + m[15 + n][d[l]]; g[t + 3 * n + 10] = m[15 + n][d[l]] * E - m[14 - n][d[l]]; g[t + 3 * n + 19] = z[2 - n][d[l]] * E + z[3 + n][d[l]]; g[t + 3 * n + 11] = z[3 + n][d[l]] * E - z[2 - n][d[l]]; g[t + 3 * n + 20] = z[8 - n][d[l]] * E + z[9 + n][d[l]] } n = g; m = t; for (E = 0; 3 > E; E++) {
                                                            var h = n[m + 6] * r[f.SHORT_TYPE][0] - n[m + 15]; z = n[m + 0] * r[f.SHORT_TYPE][2] - n[m + 9]; var p = h + z; var A = h - z; h = n[m + 15] * r[f.SHORT_TYPE][0] +
                                                                n[m + 6]; z = n[m + 9] * r[f.SHORT_TYPE][2] + n[m + 0]; var y = h + z; var O = -h + z; z = 2.069978111953089E-11 * (n[m + 3] * r[f.SHORT_TYPE][1] - n[m + 12]); h = 2.069978111953089E-11 * (n[m + 12] * r[f.SHORT_TYPE][1] + n[m + 3]); n[m + 0] = 1.90752519173728E-11 * p + z; n[m + 15] = 1.90752519173728E-11 * -y + h; A *= 1.6519652744032674E-11; y = 9.537625958686404E-12 * y + h; n[m + 3] = A - y; n[m + 6] = A + y; p = 9.537625958686404E-12 * p - z; O *= 1.6519652744032674E-11; n[m + 9] = p + O; n[m + 12] = p - O; m++
                                                        }
                                                    } else {
                                                        E = G(18); for (n = -9; 0 > n; n++)p = r[D][n + 27] * z[n + 9][d[l]] + r[D][n + 36] * z[8 - n][d[l]], A = r[D][n + 9] * m[n +
                                                            9][d[l]] - r[D][n + 18] * m[8 - n][d[l]], E[n + 9] = p - A * v[3 + n + 9], E[n + 18] = p * v[3 + n + 9] + A; var n = g, m = t; p = E; var F = p[17] - p[9]; var R = p[15] - p[11]; var X = p[14] - p[12]; O = p[0] + p[8]; y = p[1] + p[7]; h = p[2] + p[6]; A = p[3] + p[5]; n[m + 17] = O + h - A - (y - p[4]); E = (O + h - A) * C[19] + (y - p[4]); z = (F - R - X) * C[18]; n[m + 5] = z + E; n[m + 6] = z - E; var I = (p[16] - p[10]) * C[18]; y = y * C[19] + p[4]; z = F * C[12] + I + R * C[13] + X * C[14]; E = -O * C[16] + y - h * C[17] + A * C[15]; n[m + 1] = z + E; n[m + 2] = z - E; z = F * C[13] - I - R * C[14] + X * C[12]; E = -O * C[17] + y - h * C[15] + A * C[16]; n[m + 9] = z + E; n[m + 10] = z - E; z = F * C[14] - I + R * C[12] - X * C[13];
                                                    E = O * C[15] - y + h * C[16] - A * C[17]; n[m + 13] = z + E; n[m + 14] = z - E; F = p[8] - p[0]; R = p[6] - p[2]; X = p[5] - p[3]; O = p[17] + p[9]; y = p[16] + p[10]; h = p[15] + p[11]; A = p[14] + p[12]; n[m + 0] = O + h + A + (y + p[13]); z = (O + h + A) * C[19] - (y + p[13]); E = (F - R + X) * C[18]; n[m + 11] = z + E; n[m + 12] = z - E; I = (p[7] - p[1]) * C[18]; y = p[13] - y * C[19]; z = O * C[15] - y + h * C[16] + A * C[17]; E = F * C[14] + I + R * C[12] + X * C[13]; n[m + 3] = z + E; n[m + 4] = z - E; z = -O * C[17] + y - h * C[15] - A * C[16]; E = F * C[13] + I - R * C[14] - X * C[12]; n[m + 7] = z + E; n[m + 8] = z - E; z = -O * C[16] + y - h * C[17] - A * C[15]; E = F * C[12] - I + R * C[13] - X * C[14]; n[m + 15] = z + E; n[m + 16] =
                                                        z - E
                                                }
                                            } if (D != f.SHORT_TYPE && 0 != l) for (n = 7; 0 <= n; --n)D = g[t + n] * u[20 + n] + g[t + -1 - n] * J[28 + n], m = g[t + n] * J[28 + n] - g[t + -1 - n] * u[20 + n], g[t + -1 - n] = D, g[t + n] = m
                                        }
                                    } k = a; b = 286; if (1 == c.mode_gr) for (e = 0; 18 > e; e++)S.arraycopy(c.sb_sample[w][1][e], 0, c.sb_sample[w][0][e], 0, 32)
                                }
                            }
            } function za() { this.thm = new tb; this.en = new tb } function f() {
                var x = f.FFTOFFSET, k = f.MPG_MD_MS_LR, r = null, v = this.psy = null, C = null, u = null; this.setModules = function (d, c, f, a) { r = d; v = this.psy = c; C = a; u = f }; var fa = new Fc; this.lame_encode_mp3_frame = function (d, c, w, a, b, B) {
                    var e =
                        Tb([2, 2]); e[0][0] = new za; e[0][1] = new za; e[1][0] = new za; e[1][1] = new za; var l = Tb([2, 2]); l[0][0] = new za; l[0][1] = new za; l[1][0] = new za; l[1][1] = new za; var q = [null, null], g = d.internal_flags, t = ha([2, 4]), D = [.5, .5], m = [[0, 0], [0, 0]], n = [[0, 0], [0, 0]]; q[0] = c; q[1] = w; if (0 == g.lame_encode_frame_init) {
                            c = d.internal_flags; var z, E; if (0 == c.lame_encode_frame_init) {
                                w = G(2014); var h = G(2014); c.lame_encode_frame_init = 1; for (E = z = 0; z < 286 + 576 * (1 + c.mode_gr); ++z)z < 576 * c.mode_gr ? (w[z] = 0, 2 == c.channels_out && (h[z] = 0)) : (w[z] = q[0][E], 2 ==
                                    c.channels_out && (h[z] = q[1][E]), ++E); for (E = 0; E < c.mode_gr; E++)for (z = 0; z < c.channels_out; z++)c.l3_side.tt[E][z].block_type = f.SHORT_TYPE; fa.mdct_sub48(c, w, h)
                            }
                        } g.padding = 0; 0 > (g.slot_lag -= g.frac_SpF) && (g.slot_lag += d.out_samplerate, g.padding = 1); if (0 != g.psymodel) for (h = [null, null], z = 0, E = U(2), w = 0; w < g.mode_gr; w++) {
                            for (c = 0; c < g.channels_out; c++)h[c] = q[c], z = 576 + 576 * w - f.FFTOFFSET; c = d.VBR == J.vbr_mtrh || d.VBR == J.vbr_mt ? v.L3psycho_anal_vbr(d, h, z, w, e, l, m[w], n[w], t[w], E) : v.L3psycho_anal_ns(d, h, z, w, e, l, m[w], n[w], t[w], E);
                            if (0 != c) return -4; d.mode == ka.JOINT_STEREO && (D[w] = t[w][2] + t[w][3], 0 < D[w] && (D[w] = t[w][3] / D[w])); for (c = 0; c < g.channels_out; c++) { var p = g.l3_side.tt[w][c]; p.block_type = E[c]; p.mixed_block_flag = 0 }
                        } else for (w = 0; w < g.mode_gr; w++)for (c = 0; c < g.channels_out; c++)g.l3_side.tt[w][c].block_type = f.NORM_TYPE, g.l3_side.tt[w][c].mixed_block_flag = 0, n[w][c] = m[w][c] = 700; 0 == g.ATH.useAdjust ? g.ATH.adjust = 1 : (c = g.loudness_sq[0][0], t = g.loudness_sq[1][0], 2 == g.channels_out ? (c += g.loudness_sq[0][1], t += g.loudness_sq[1][1]) : (c += c, t += t),
                            2 == g.mode_gr && (c = Math.max(c, t)), c = .5 * c * g.ATH.aaSensitivityP, .03125 < c ? (1 <= g.ATH.adjust ? g.ATH.adjust = 1 : g.ATH.adjust < g.ATH.adjustLimit && (g.ATH.adjust = g.ATH.adjustLimit), g.ATH.adjustLimit = 1) : (t = 31.98 * c + 6.25E-4, g.ATH.adjust >= t ? (g.ATH.adjust *= .075 * t + .925, g.ATH.adjust < t && (g.ATH.adjust = t)) : g.ATH.adjustLimit >= t ? g.ATH.adjust = t : g.ATH.adjust < g.ATH.adjustLimit && (g.ATH.adjust = g.ATH.adjustLimit), g.ATH.adjustLimit = t)); fa.mdct_sub48(g, q[0], q[1]); g.mode_ext = f.MPG_MD_LR_LR; if (d.force_ms) g.mode_ext = f.MPG_MD_MS_LR; else if (d.mode ==
                                ka.JOINT_STEREO) { for (w = h = t = 0; w < g.mode_gr; w++)for (c = 0; c < g.channels_out; c++)t += n[w][c], h += m[w][c]; t <= 1 * h && (t = g.l3_side.tt[0], c = g.l3_side.tt[g.mode_gr - 1], t[0].block_type == t[1].block_type && c[0].block_type == c[1].block_type && (g.mode_ext = f.MPG_MD_MS_LR)) } g.mode_ext == k && (e = l, m = n); if (d.analysis && null != g.pinfo) for (w = 0; w < g.mode_gr; w++)for (c = 0; c < g.channels_out; c++)g.pinfo.ms_ratio[w] = g.ms_ratio[w], g.pinfo.ms_ener_ratio[w] = D[w], g.pinfo.blocktype[w][c] = g.l3_side.tt[w][c].block_type, g.pinfo.pe[w][c] = m[w][c], S.arraycopy(g.l3_side.tt[w][c].xr,
                                    0, g.pinfo.xr[w][c], 0, 576), g.mode_ext == k && (g.pinfo.ers[w][c] = g.pinfo.ers[w][c + 2], S.arraycopy(g.pinfo.energy[w][c + 2], 0, g.pinfo.energy[w][c], 0, g.pinfo.energy[w][c].length)); if (d.VBR == J.vbr_off || d.VBR == J.vbr_abr) {
                                        for (l = 0; 18 > l; l++)g.nsPsy.pefirbuf[l] = g.nsPsy.pefirbuf[l + 1]; for (w = n = 0; w < g.mode_gr; w++)for (c = 0; c < g.channels_out; c++)n += m[w][c]; g.nsPsy.pefirbuf[18] = n; n = g.nsPsy.pefirbuf[9]; for (l = 0; 9 > l; l++)n += (g.nsPsy.pefirbuf[l] + g.nsPsy.pefirbuf[18 - l]) * f.fircoef[l]; n = 3350 * g.mode_gr * g.channels_out / n; for (w = 0; w < g.mode_gr; w++)for (c =
                                            0; c < g.channels_out; c++)m[w][c] *= n
                                    } g.iteration_loop.iteration_loop(d, m, D, e); r.format_bitstream(d); a = r.copy_buffer(g, a, b, B, 1); d.bWriteVbrTag && C.addVbrFrame(d); if (d.analysis && null != g.pinfo) { for (c = 0; c < g.channels_out; c++) { for (b = 0; b < x; b++)g.pinfo.pcmdata[c][b] = g.pinfo.pcmdata[c][b + d.framesize]; for (b = x; 1600 > b; b++)g.pinfo.pcmdata[c][b] = q[c][b - x] } u.set_frame_pinfo(d, e) } g.bitrate_stereoMode_Hist[g.bitrate_index][4]++; g.bitrate_stereoMode_Hist[15][4]++; 2 == g.channels_out && (g.bitrate_stereoMode_Hist[g.bitrate_index][g.mode_ext]++,
                                        g.bitrate_stereoMode_Hist[15][g.mode_ext]++); for (d = 0; d < g.mode_gr; ++d)for (q = 0; q < g.channels_out; ++q)b = g.l3_side.tt[d][q].block_type | 0, 0 != g.l3_side.tt[d][q].mixed_block_flag && (b = 4), g.bitrate_blockType_Hist[g.bitrate_index][b]++, g.bitrate_blockType_Hist[g.bitrate_index][5]++, g.bitrate_blockType_Hist[15][b]++, g.bitrate_blockType_Hist[15][5]++; return a
                }
            } function Gc() { this.size = this.pos = this.want = this.seen = this.sum = 0; this.bag = null; this.TotalFrameSize = this.nBytesWritten = this.nVbrNumFrames = 0 } function Hc() {
                this.tt =
                [[null, null], [null, null]]; this.resvDrain_post = this.resvDrain_pre = this.private_bits = this.main_data_begin = 0; this.scfsi = [U(4), U(4)]; for (var f = 0; 2 > f; f++)for (var k = 0; 2 > k; k++)this.tt[f][k] = new rb
            } function tb() { this.l = G(f.SBMAX_l); this.s = ha([f.SBMAX_s, 3]); var x = this; this.assign = function (k) { S.arraycopy(k.l, 0, x.l, 0, f.SBMAX_l); for (var r = 0; r < f.SBMAX_s; r++)for (var v = 0; 3 > v; v++)x.s[r][v] = k.s[r][v] } } function Ic() {
                this.last_en_subshort = ha([4, 9]); this.lastAttacks = U(4); this.pefirbuf = G(19); this.longfact = G(f.SBMAX_l);
                this.shortfact = G(f.SBMAX_s); this.attackthre_s = this.attackthre = 0
            } function ia() {
                function x() { this.ptr = this.write_timing = 0; this.buf = new Int8Array(40) } this.fill_buffer_resample_init = this.iteration_init_init = this.lame_encode_frame_init = this.Class_ID = 0; this.mfbuf = ha([2, ia.MFSIZE]); this.full_outer_loop = this.use_best_huffman = this.subblock_gain = this.noise_shaping_stop = this.psymodel = this.substep_shaping = this.noise_shaping_amp = this.noise_shaping = this.highpass2 = this.highpass1 = this.lowpass2 = this.lowpass1 = this.mode_ext =
                    this.samplerate_index = this.bitrate_index = this.VBR_max_bitrate = this.VBR_min_bitrate = this.mf_size = this.mf_samples_to_encode = this.resample_ratio = this.channels_out = this.channels_in = this.mode_gr = 0; this.l3_side = new Hc; this.ms_ratio = G(2); this.slot_lag = this.frac_SpF = this.padding = 0; this.tag_spec = null; this.nMusicCRC = 0; this.OldValue = U(2); this.CurrentStep = U(2); this.masking_lower = 0; this.bv_scf = U(576); this.pseudohalf = U(ra.SFBMAX); this.sfb21_extra = !1; this.inbuf_old = Array(2); this.blackfilt = Array(2 * ia.BPC + 1); this.itime =
                        new Float64Array(2); this.sideinfo_len = 0; this.sb_sample = ha([2, 2, 18, f.SBLIMIT]); this.amp_filter = G(32); this.header = Array(ia.MAX_HEADER_BUF); this.ResvMax = this.ResvSize = this.ancillary_flag = this.w_ptr = this.h_ptr = 0; this.scalefac_band = new ma; this.minval_l = G(f.CBANDS); this.minval_s = G(f.CBANDS); this.nb_1 = ha([4, f.CBANDS]); this.nb_2 = ha([4, f.CBANDS]); this.nb_s1 = ha([4, f.CBANDS]); this.nb_s2 = ha([4, f.CBANDS]); this.s3_ll = this.s3_ss = null; this.decay = 0; this.thm = Array(4); this.en = Array(4); this.tot_ener = G(4); this.loudness_sq =
                            ha([2, 2]); this.loudness_sq_save = G(2); this.mld_l = G(f.SBMAX_l); this.mld_s = G(f.SBMAX_s); this.bm_l = U(f.SBMAX_l); this.bo_l = U(f.SBMAX_l); this.bm_s = U(f.SBMAX_s); this.bo_s = U(f.SBMAX_s); this.npart_s = this.npart_l = 0; this.s3ind = Ua([f.CBANDS, 2]); this.s3ind_s = Ua([f.CBANDS, 2]); this.numlines_s = U(f.CBANDS); this.numlines_l = U(f.CBANDS); this.rnumlines_l = G(f.CBANDS); this.mld_cb_l = G(f.CBANDS); this.mld_cb_s = G(f.CBANDS); this.numlines_l_num1 = this.numlines_s_num1 = 0; this.pe = G(4); this.ms_ener_ratio_old = this.ms_ratio_l_old = this.ms_ratio_s_old =
                                0; this.blocktype_old = U(2); this.nsPsy = new Ic; this.VBR_seek_table = new Gc; this.PSY = this.ATH = null; this.nogap_current = this.nogap_total = 0; this.findPeakSample = this.findReplayGain = this.decode_on_the_fly = !0; this.AudiophileGain = this.RadioGain = this.PeakSample = 0; this.rgdata = null; this.noclipScale = this.noclipGainChange = 0; this.bitrate_stereoMode_Hist = Ua([16, 5]); this.bitrate_blockType_Hist = Ua([16, 6]); this.hip = this.pinfo = null; this.in_buffer_nsamples = 0; this.iteration_loop = this.in_buffer_1 = this.in_buffer_0 = null; for (var k =
                                    0; k < this.en.length; k++)this.en[k] = new tb; for (k = 0; k < this.thm.length; k++)this.thm[k] = new tb; for (k = 0; k < this.header.length; k++)this.header[k] = new x
            } function Jc() {
                function x(f, k, d) {
                    var c = 0; d <<= 1; var r = k + d; var a = 4; do {
                        var b; var u = a >> 1; var e = a; var l = a << 1; var q = l + e; a = l << 1; var g = k; var t = g + u; do {
                            var x = f[g + 0] - f[g + e]; var m = f[g + 0] + f[g + e]; var n = f[g + l] - f[g + q]; var C = f[g + l] + f[g + q]; f[g + l] = m - C; f[g + 0] = m + C; f[g + q] = x - n; f[g + e] = x + n; x = f[t + 0] - f[t + e]; m = f[t + 0] + f[t + e]; n = Z.SQRT2 * f[t + q]; C = Z.SQRT2 * f[t + l]; f[t + l] = m - C; f[t + 0] = m + C; f[t +
                                q] = x - n; f[t + e] = x + n; t += a; g += a
                        } while (g < r); var E = v[c + 0]; var h = v[c + 1]; for (b = 1; b < u; b++) {
                            var p = 1 - 2 * h * h; var A = 2 * h * E; g = k + b; t = k + e - b; do { var y = A * f[g + e] - p * f[t + e]; C = p * f[g + e] + A * f[t + e]; x = f[g + 0] - C; m = f[g + 0] + C; var O = f[t + 0] - y; var G = f[t + 0] + y; y = A * f[g + q] - p * f[t + q]; C = p * f[g + q] + A * f[t + q]; n = f[g + l] - C; C = f[g + l] + C; var R = f[t + l] - y; var X = f[t + l] + y; y = h * C - E * R; C = E * C + h * R; f[g + l] = m - C; f[g + 0] = m + C; f[t + q] = O - y; f[t + e] = O + y; y = E * X - h * n; C = h * X + E * n; f[t + l] = G - C; f[t + 0] = G + C; f[g + q] = x - y; f[g + e] = x + y; t += a; g += a } while (g < r); p = E; E = p * v[c + 0] - h * v[c + 1]; h = p * v[c + 1] + h * v[c +
                                0]
                        } c += 2
                    } while (a < d)
                } var k = G(f.BLKSIZE), r = G(f.BLKSIZE_s / 2), v = [.9238795325112867, .3826834323650898, .9951847266721969, .0980171403295606, .9996988186962042, .02454122852291229, .9999811752826011, .006135884649154475], C = [0, 128, 64, 192, 32, 160, 96, 224, 16, 144, 80, 208, 48, 176, 112, 240, 8, 136, 72, 200, 40, 168, 104, 232, 24, 152, 88, 216, 56, 184, 120, 248, 4, 132, 68, 196, 36, 164, 100, 228, 20, 148, 84, 212, 52, 180, 116, 244, 12, 140, 76, 204, 44, 172, 108, 236, 28, 156, 92, 220, 60, 188, 124, 252, 2, 130, 66, 194, 34, 162, 98, 226, 18, 146, 82, 210, 50, 178, 114, 242, 10, 138,
                    74, 202, 42, 170, 106, 234, 26, 154, 90, 218, 58, 186, 122, 250, 6, 134, 70, 198, 38, 166, 102, 230, 22, 150, 86, 214, 54, 182, 118, 246, 14, 142, 78, 206, 46, 174, 110, 238, 30, 158, 94, 222, 62, 190, 126, 254]; this.fft_short = function (k, v, d, c, w) {
                        for (k = 0; 3 > k; k++) {
                            var a = f.BLKSIZE_s / 2, b = 65535 & 192 * (k + 1), u = f.BLKSIZE_s / 8 - 1; do {
                                var e = C[u << 2] & 255; var l = r[e] * c[d][w + e + b]; var q = r[127 - e] * c[d][w + e + b + 128]; var g = l - q; l += q; var t = r[e + 64] * c[d][w + e + b + 64]; q = r[63 - e] * c[d][w + e + b + 192]; var D = t - q; t += q; a -= 4; v[k][a + 0] = l + t; v[k][a + 2] = l - t; v[k][a + 1] = g + D; v[k][a + 3] = g - D; l = r[e +
                                    1] * c[d][w + e + b + 1]; q = r[126 - e] * c[d][w + e + b + 129]; g = l - q; l += q; t = r[e + 65] * c[d][w + e + b + 65]; q = r[62 - e] * c[d][w + e + b + 193]; D = t - q; t += q; v[k][a + f.BLKSIZE_s / 2 + 0] = l + t; v[k][a + f.BLKSIZE_s / 2 + 2] = l - t; v[k][a + f.BLKSIZE_s / 2 + 1] = g + D; v[k][a + f.BLKSIZE_s / 2 + 3] = g - D
                            } while (0 <= --u); x(v[k], a, f.BLKSIZE_s / 2)
                        }
                    }; this.fft_long = function (r, v, d, c, w) {
                        r = f.BLKSIZE / 8 - 1; var a = f.BLKSIZE / 2; do {
                            var b = C[r] & 255; var u = k[b] * c[d][w + b]; var e = k[b + 512] * c[d][w + b + 512]; var l = u - e; u += e; var q = k[b + 256] * c[d][w + b + 256]; e = k[b + 768] * c[d][w + b + 768]; var g = q - e; q += e; a -= 4; v[a + 0] =
                                u + q; v[a + 2] = u - q; v[a + 1] = l + g; v[a + 3] = l - g; u = k[b + 1] * c[d][w + b + 1]; e = k[b + 513] * c[d][w + b + 513]; l = u - e; u += e; q = k[b + 257] * c[d][w + b + 257]; e = k[b + 769] * c[d][w + b + 769]; g = q - e; q += e; v[a + f.BLKSIZE / 2 + 0] = u + q; v[a + f.BLKSIZE / 2 + 2] = u - q; v[a + f.BLKSIZE / 2 + 1] = l + g; v[a + f.BLKSIZE / 2 + 3] = l - g
                        } while (0 <= --r); x(v, a, f.BLKSIZE / 2)
                    }; this.init_fft = function (u) { for (u = 0; u < f.BLKSIZE; u++)k[u] = .42 - .5 * Math.cos(2 * Math.PI * (u + .5) / f.BLKSIZE) + .08 * Math.cos(4 * Math.PI * (u + .5) / f.BLKSIZE); for (u = 0; u < f.BLKSIZE_s / 2; u++)r[u] = .5 * (1 - Math.cos(2 * Math.PI * (u + .5) / f.BLKSIZE_s)) }
            }
            function $b() {
                function x(a, b) { for (var c = 0, d = 0; d < f.BLKSIZE / 2; ++d)c += a[d] * b.ATH.eql_w[d]; return c *= D } function k(a, b, c, f, d, e) { if (b > a) if (b < a * n) var g = b / a; else return a + b; else { if (a >= b * n) return a + b; g = a / b } a += b; if (6 >= f + 3) { if (g >= m) return a; f = 0 | Z.FAST_LOG10_X(g, 16); return a * p[f] } f = 0 | Z.FAST_LOG10_X(g, 16); b = 0 != e ? d.ATH.cb_s[c] * d.ATH.adjust : d.ATH.cb_l[c] * d.ATH.adjust; return a < z * b ? a > b ? (c = 1, 13 >= f && (c = A[f]), b = Z.FAST_LOG10_X(a / b, 10 / 15), a * ((h[f] - c) * b + c)) : 13 < f ? a : a * A[f] : a * h[f] } function r(a, b, c) {
                    0 > a && (a = 0); 0 > b && (b = 0); if (0 >=
                        a) return b; if (0 >= b) return a; var f = b > a ? b / a : a / b; if (-2 <= c && 2 >= c) { if (f >= m) return a + b; c = 0 | Z.FAST_LOG10_X(f, 16); return (a + b) * y[c] } if (f < n) return a + b; a < b && (a = b); return a
                } function v(a, b, c, d, e) {
                    var h, g, p = 0, k = 0; for (h = g = 0; h < f.SBMAX_s; ++g, ++h) { for (var l = a.bo_s[h], m = a.npart_s, l = l < m ? l : m; g < l;)p += b[g], k += c[g], g++; a.en[d].s[h][e] = p; a.thm[d].s[h][e] = k; if (g >= m) { ++h; break } k = a.PSY.bo_s_weight[h]; m = 1 - k; p = k * b[g]; k *= c[g]; a.en[d].s[h][e] += p; a.thm[d].s[h][e] += k; p = m * b[g]; k = m * c[g] } for (; h < f.SBMAX_s; ++h)a.en[d].s[h][e] = 0, a.thm[d].s[h][e] =
                        0
                } function C(a, b, c, d) { var e, h, g = 0, p = 0; for (e = h = 0; e < f.SBMAX_l; ++h, ++e) { for (var k = a.bo_l[e], l = a.npart_l, k = k < l ? k : l; h < k;)g += b[h], p += c[h], h++; a.en[d].l[e] = g; a.thm[d].l[e] = p; if (h >= l) { ++e; break } p = a.PSY.bo_l_weight[e]; l = 1 - p; g = p * b[h]; p *= c[h]; a.en[d].l[e] += g; a.thm[d].l[e] += p; g = l * b[h]; p = l * c[h] } for (; e < f.SBMAX_l; ++e)a.en[d].l[e] = 0, a.thm[d].l[e] = 0 } function u(a, b, c) { return 1 <= c ? a : 0 >= c ? b : 0 < b ? Math.pow(a / b, c) * b : 0 } function W(a, b) {
                    for (var c = 309.07, d = 0; d < f.SBMAX_s - 1; d++)for (var e = 0; 3 > e; e++) {
                        var h = a.thm.s[d][e]; if (0 < h) {
                            var h =
                                h * b, g = a.en.s[d][e]; g > h && (c = g > 1E10 * h ? c + 23.02585092994046 * O[d] : c + O[d] * Z.FAST_LOG10(g / h))
                        }
                    } return c
                } function d(a, b) { for (var c = 281.0575, d = 0; d < f.SBMAX_l - 1; d++) { var e = a.thm.l[d]; if (0 < e) { var e = e * b, h = a.en.l[d]; h > e && (c = h > 1E10 * e ? c + 23.02585092994046 * F[d] : c + F[d] * Z.FAST_LOG10(h / e)) } } return c } function c(a, b, c, d, f) { var e, h; for (e = h = 0; e < a.npart_l; ++e) { var g = 0, p = 0, k; for (k = 0; k < a.numlines_l[e]; ++k, ++h) { var l = b[h], g = g + l; p < l && (p = l) } c[e] = g; d[e] = p; f[e] = g * a.rnumlines_l[e] } } function w(a, b, c, d) {
                    var f = E.length - 1, e = 0, h = c[e] +
                        c[e + 1]; if (0 < h) { var g = b[e]; g < b[e + 1] && (g = b[e + 1]); h = 20 * (2 * g - h) / (h * (a.numlines_l[e] + a.numlines_l[e + 1] - 1)); g = 0 | h; g > f && (g = f); d[e] = g } else d[e] = 0; for (e = 1; e < a.npart_l - 1; e++)h = c[e - 1] + c[e] + c[e + 1], 0 < h ? (g = b[e - 1], g < b[e] && (g = b[e]), g < b[e + 1] && (g = b[e + 1]), h = 20 * (3 * g - h) / (h * (a.numlines_l[e - 1] + a.numlines_l[e] + a.numlines_l[e + 1] - 1)), g = 0 | h, g > f && (g = f), d[e] = g) : d[e] = 0; h = c[e - 1] + c[e]; 0 < h ? (g = b[e - 1], g < b[e] && (g = b[e]), h = 20 * (2 * g - h) / (h * (a.numlines_l[e - 1] + a.numlines_l[e] - 1)), g = 0 | h, g > f && (g = f), d[e] = g) : d[e] = 0
                } function a(a, b, c, e, d, f, h) {
                    var g =
                        2 * f; d = 0 < f ? Math.pow(10, d) : 1; for (var p, k, l = 0; l < h; ++l) { var m = a[2][l], q = a[3][l], A = b[0][l], r = b[1][l], n = b[2][l], t = b[3][l]; A <= 1.58 * r && r <= 1.58 * A ? (p = c[l] * m, k = Math.max(n, Math.min(t, c[l] * q)), p = Math.max(t, Math.min(n, p))) : (k = n, p = t); 0 < f && (t = e[l] * d, A = Math.min(Math.max(A, t), Math.max(r, t)), n = Math.max(k, t), t = Math.max(p, t), r = n + t, 0 < r && A * g < r && (A = A * g / r, n *= A, t *= A), k = Math.min(n, k), p = Math.min(t, p)); k > m && (k = m); p > q && (p = q); b[2][l] = k; b[3][l] = p }
                } function b(a, b) { a = 0 <= a ? 27 * -a : a * b; return -72 >= a ? 0 : Math.exp(.2302585093 * a) } function B(a) {
                    0 >
                    a && (a = 0); a *= .001; return 13 * Math.atan(.76 * a) + 3.5 * Math.atan(a * a / 56.25)
                } function e(a, b, c, e, d, h, g, p, k, l, m, q) {
                    var A = G(f.CBANDS + 1), r = p / (15 < q ? 1152 : 384), t = U(f.HBLKSIZE), n; p /= k; var u = 0, Q = 0; for (n = 0; n < f.CBANDS; n++) { var w; var y = B(p * u); A[n] = p * u; for (w = u; .34 > B(p * w) - y && w <= k / 2; w++); a[n] = w - u; for (Q = n + 1; u < w;)t[u++] = n; if (u > k / 2) { u = k / 2; ++n; break } } A[n] = p * u; for (y = 0; y < q; y++)n = l[y], u = l[y + 1], n = 0 | Math.floor(.5 + m * (n - .5)), 0 > n && (n = 0), w = 0 | Math.floor(.5 + m * (u - .5)), w > k / 2 && (w = k / 2), c[y] = (t[n] + t[w]) / 2, b[y] = t[w], g[y] = (r * u - A[b[y]]) / (A[b[y] +
                        1] - A[b[y]]), 0 > g[y] ? g[y] = 0 : 1 < g[y] && (g[y] = 1), u = B(p * l[y] * m), u = Math.min(u, 15.5) / 15.5, h[y] = Math.pow(10, 1.25 * (1 - Math.cos(Math.PI * u)) - 2.5); for (b = u = 0; b < Q; b++)c = a[b], y = B(p * u), h = B(p * (u + c - 1)), e[b] = .5 * (y + h), y = B(p * (u - .5)), h = B(p * (u + c - .5)), d[b] = h - y, u += c; return Q
                } function l(a, c, e, d, h, g) {
                    var p = ha([f.CBANDS, f.CBANDS]), k = 0; if (g) for (var l = 0; l < c; l++)for (g = 0; g < c; g++) {
                        var m = e[l] - e[g]; m = 0 <= m ? 3 * m : 1.5 * m; if (.5 <= m && 2.5 >= m) { var q = m - .5; q = 8 * (q * q - 2 * q) } else q = 0; m += .474; m = 15.811389 + 7.5 * m - 17.5 * Math.sqrt(1 + m * m); -60 >= m ? q = 0 : (m = Math.exp(.2302585093 *
                            (q + m)), q = m / .6609193); m = q * d[g]; p[l][g] = m * h[l]
                    } else for (g = 0; g < c; g++) { q = 15 + Math.min(21 / e[g], 12); var A; var r, l = q; for (A = 0; 1E-20 < b(A, l); --A); var n = A; for (r = 0; 1E-12 < Math.abs(r - n);)A = (r + n) / 2, 0 < b(A, l) ? r = A : n = A; m = n; for (A = 0; 1E-20 < b(A, l); A += 1); n = 0; for (r = A; 1E-12 < Math.abs(r - n);)A = (r + n) / 2, 0 < b(A, l) ? n = A : r = A; var t = 0; for (n = 0; 1E3 >= n; ++n)A = m + n * (r - m) / 1E3, A = b(A, l), t += A; A = 1001 / (t * (r - m)); for (l = 0; l < c; l++)m = A * b(e[l] - e[g], q) * d[g], p[l][g] = m * h[l] } for (l = 0; l < c; l++) {
                        for (g = 0; g < c && !(0 < p[l][g]); g++); a[l][0] = g; for (g = c - 1; 0 < g && !(0 < p[l][g]); g--);
                        a[l][1] = g; k += a[l][1] - a[l][0] + 1
                    } e = G(k); for (l = d = 0; l < c; l++)for (g = a[l][0]; g <= a[l][1]; g++)e[d++] = p[l][g]; return e
                } function q(a) { a = B(a); a = Math.min(a, 15.5) / 15.5; return Math.pow(10, 1.25 * (1 - Math.cos(Math.PI * a)) - 2.5) } function g(a, b) { -.3 > a && (a = 3410); a = Math.max(.1, a / 1E3); return 3.64 * Math.pow(a, -.8) - 6.8 * Math.exp(-.6 * Math.pow(a - 3.4, 2)) + 6 * Math.exp(-.15 * Math.pow(a - 8.7, 2)) + .001 * (.6 + .04 * b) * Math.pow(a, 4) } var t = new Jc, D = 1 / 217621504 / (f.BLKSIZE / 2), m, n, z, E = [1, .79433, .63096, .63096, .63096, .63096, .63096, .25119, .11749], h = [3.3246 *
                    3.3246, 3.23837 * 3.23837, 9.9500500969, 9.0247369744, 8.1854926609, 7.0440875649, 2.46209 * 2.46209, 2.284 * 2.284, 4.4892710641, 1.96552 * 1.96552, 1.82335 * 1.82335, 1.69146 * 1.69146, 2.4621061921, 2.1508568964, 1.37074 * 1.37074, 1.31036 * 1.31036, 1.5691069696, 1.4555939904, 1.16203 * 1.16203, 1.2715945225, 1.09428 * 1.09428, 1.0659 * 1.0659, 1.0779838276, 1.0382591025, 1], p = [1.7782755904, 1.35879 * 1.35879, 1.38454 * 1.38454, 1.39497 * 1.39497, 1.40548 * 1.40548, 1.3537 * 1.3537, 1.6999465924, 1.22321 * 1.22321, 1.3169398564, 1], A = [5.5396212496, 2.29259 * 2.29259,
                        4.9868695969, 2.12675 * 2.12675, 2.02545 * 2.02545, 1.87894 * 1.87894, 1.74303 * 1.74303, 1.61695 * 1.61695, 2.2499700001, 1.39148 * 1.39148, 1.29083 * 1.29083, 1.19746 * 1.19746, 1.2339655056, 1.0779838276], y = [1.7782755904, 1.35879 * 1.35879, 1.38454 * 1.38454, 1.39497 * 1.39497, 1.40548 * 1.40548, 1.3537 * 1.3537, 1.6999465924, 1.22321 * 1.22321, 1.3169398564, 1], O = [11.8, 13.6, 17.2, 32, 46.5, 51.3, 57.5, 67.1, 71.5, 84.6, 97.6, 130], F = [6.8, 5.8, 5.8, 6.4, 6.5, 9.9, 12.1, 14.4, 15, 18.9, 21.6, 26.9, 34.2, 40.2, 46.8, 56.5, 60.7, 73.9, 85.7, 93.4, 126.1], R = [-1.730326E-17, -.01703172,
                        -1.349528E-17, .0418072, -6.73278E-17, -.0876324, -3.0835E-17, .1863476, -1.104424E-16, -.627638]; this.L3psycho_anal_ns = function (a, b, e, h, g, p, l, m, q, A) {
                            var r, n = a.internal_flags, y = ha([2, f.BLKSIZE]), Q = ha([2, 3, f.BLKSIZE_s]), I = G(f.CBANDS + 1), H = G(f.CBANDS + 1), V = G(f.CBANDS + 2), O = U(2), D = U(2), z, M, B, X, F, N, K, la = ha([2, 576]), S = U(f.CBANDS + 2), ca = U(f.CBANDS + 2); qa.fill(ca, 0); var fa = n.channels_out; a.mode == ka.JOINT_STEREO && (fa = 4); var T = a.VBR == J.vbr_off ? 0 == n.ResvMax ? 0 : n.ResvSize / n.ResvMax * .5 : a.VBR == J.vbr_rh || a.VBR == J.vbr_mtrh ||
                                a.VBR == J.vbr_mt ? .6 : 1; for (z = 0; z < n.channels_out; z++) { var Qa = b[z], L = e + 576 - 350 - 21 + 192; for (B = 0; 576 > B; B++) { var ba; var ia = Qa[L + B + 10]; for (X = ba = 0; 9 > X; X += 2)ia += R[X] * (Qa[L + B + X] + Qa[L + B + 21 - X]), ba += R[X + 1] * (Qa[L + B + X + 1] + Qa[L + B + 21 - X - 1]); la[z][B] = ia + ba } g[h][z].en.assign(n.en[z]); g[h][z].thm.assign(n.thm[z]); 2 < fa && (p[h][z].en.assign(n.en[z + 2]), p[h][z].thm.assign(n.thm[z + 2])) } for (z = 0; z < fa; z++) {
                                    var Ka = G(12), da = [0, 0, 0, 0], Da = G(12), Y = 1, ac = G(f.CBANDS), ra = G(f.CBANDS), ya = [0, 0, 0, 0], xa = G(f.HBLKSIZE), ma = ha([3, f.HBLKSIZE_s]); for (B =
                                        0; 3 > B; B++)Ka[B] = n.nsPsy.last_en_subshort[z][B + 6], Da[B] = Ka[B] / n.nsPsy.last_en_subshort[z][B + 4], da[0] += Ka[B]; if (2 == z) for (B = 0; 576 > B; B++) { var za = la[0][B]; var Ub = la[1][B]; la[0][B] = za + Ub; la[1][B] = za - Ub } var Za = la[z & 1], bc = 0; for (B = 0; 9 > B; B++) { var Ua = bc + 64; for (r = 1; bc < Ua; bc++)r < Math.abs(Za[bc]) && (r = Math.abs(Za[bc])); n.nsPsy.last_en_subshort[z][B] = Ka[B + 3] = r; da[1 + B / 3] += r; r = r > Ka[B + 3 - 2] ? r / Ka[B + 3 - 2] : Ka[B + 3 - 2] > 10 * r ? Ka[B + 3 - 2] / (10 * r) : 0; Da[B + 3] = r } if (a.analysis) {
                                            var Fa = Da[0]; for (B = 1; 12 > B; B++)Fa < Da[B] && (Fa = Da[B]); n.pinfo.ers[h][z] =
                                                n.pinfo.ers_save[z]; n.pinfo.ers_save[z] = Fa
                                        } var sb = 3 == z ? n.nsPsy.attackthre_s : n.nsPsy.attackthre; for (B = 0; 12 > B; B++)0 == ya[B / 3] && Da[B] > sb && (ya[B / 3] = B % 3 + 1); for (B = 1; 4 > B; B++)1.7 > (da[B - 1] > da[B] ? da[B - 1] / da[B] : da[B] / da[B - 1]) && (ya[B] = 0, 1 == B && (ya[0] = 0)); 0 != ya[0] && 0 != n.nsPsy.lastAttacks[z] && (ya[0] = 0); if (3 == n.nsPsy.lastAttacks[z] || 0 != ya[0] + ya[1] + ya[2] + ya[3]) Y = 0, 0 != ya[1] && 0 != ya[0] && (ya[1] = 0), 0 != ya[2] && 0 != ya[1] && (ya[2] = 0), 0 != ya[3] && 0 != ya[2] && (ya[3] = 0); 2 > z ? D[z] = Y : 0 == Y && (D[0] = D[1] = 0); q[z] = n.tot_ener[z]; var ub = void 0,
                                            Vb = void 0, ob = void 0, P = void 0, jc = a, Ia = xa, Gb = ma, Ra = y, La = z & 1, Ma = Q, Sa = z & 1, va = h, Na = z, fb = b, gb = e, Va = jc.internal_flags; if (2 > Na) t.fft_long(Va, Ra[La], Na, fb, gb), t.fft_short(Va, Ma[Sa], Na, fb, gb); else if (2 == Na) { for (var ja = f.BLKSIZE - 1; 0 <= ja; --ja)ub = Ra[La + 0][ja], Vb = Ra[La + 1][ja], Ra[La + 0][ja] = (ub + Vb) * Z.SQRT2 * .5, Ra[La + 1][ja] = (ub - Vb) * Z.SQRT2 * .5; for (var Ca = 2; 0 <= Ca; --Ca)for (ja = f.BLKSIZE_s - 1; 0 <= ja; --ja)ub = Ma[Sa + 0][Ca][ja], Vb = Ma[Sa + 1][Ca][ja], Ma[Sa + 0][Ca][ja] = (ub + Vb) * Z.SQRT2 * .5, Ma[Sa + 1][Ca][ja] = (ub - Vb) * Z.SQRT2 * .5 } Ia[0] =
                                                Ra[La + 0][0]; Ia[0] *= Ia[0]; for (ja = f.BLKSIZE / 2 - 1; 0 <= ja; --ja)ob = Ra[La + 0][f.BLKSIZE / 2 - ja], P = Ra[La + 0][f.BLKSIZE / 2 + ja], Ia[f.BLKSIZE / 2 - ja] = .5 * (ob * ob + P * P); for (Ca = 2; 0 <= Ca; --Ca)for (Gb[Ca][0] = Ma[Sa + 0][Ca][0], Gb[Ca][0] *= Gb[Ca][0], ja = f.BLKSIZE_s / 2 - 1; 0 <= ja; --ja)ob = Ma[Sa + 0][Ca][f.BLKSIZE_s / 2 - ja], P = Ma[Sa + 0][Ca][f.BLKSIZE_s / 2 + ja], Gb[Ca][f.BLKSIZE_s / 2 - ja] = .5 * (ob * ob + P * P); for (var rb = 0, ja = 11; ja < f.HBLKSIZE; ja++)rb += Ia[ja]; Va.tot_ener[Na] = rb; if (jc.analysis) {
                                                    for (ja = 0; ja < f.HBLKSIZE; ja++)Va.pinfo.energy[va][Na][ja] = Va.pinfo.energy_save[Na][ja],
                                                        Va.pinfo.energy_save[Na][ja] = Ia[ja]; Va.pinfo.pe[va][Na] = Va.pe[Na]
                                                } 2 == jc.athaa_loudapprox && 2 > Na && (Va.loudness_sq[va][Na] = Va.loudness_sq_save[Na], Va.loudness_sq_save[Na] = x(Ia, Va)); c(n, xa, I, ac, ra); w(n, ac, ra, S); for (K = 0; 3 > K; K++) {
                                                    for (var Hb, aa, sa = void 0, ta = void 0, Wb = void 0, Ab = ma, Ta = H, $a = V, vb = z, Fb = K, Ga = a.internal_flags, sa = ta = 0; sa < Ga.npart_s; ++sa) { for (var Ib = 0, tb = 0, hb = Ga.numlines_s[sa], zb = 0; zb < hb; ++zb, ++ta) { var Bb = Ab[Fb][ta], Ib = Ib + Bb; tb < Bb && (tb = Bb) } Ta[sa] = Ib } for (ta = sa = 0; sa < Ga.npart_s; sa++) {
                                                        var wb = Ga.s3ind_s[sa][0],
                                                        ab = Ga.s3_ss[ta++] * Ta[wb]; for (++wb; wb <= Ga.s3ind_s[sa][1];)ab += Ga.s3_ss[ta] * Ta[wb], ++ta, ++wb; Wb = 2 * Ga.nb_s1[vb][sa]; $a[sa] = Math.min(ab, Wb); Ga.blocktype_old[vb & 1] == f.SHORT_TYPE && (Wb = 16 * Ga.nb_s2[vb][sa], $a[sa] = Math.min(Wb, $a[sa])); Ga.nb_s2[vb][sa] = Ga.nb_s1[vb][sa]; Ga.nb_s1[vb][sa] = ab
                                                    } for (; sa <= f.CBANDS; ++sa)Ta[sa] = 0, $a[sa] = 0; v(n, H, V, z, K); for (N = 0; N < f.SBMAX_s; N++) {
                                                        aa = n.thm[z].s[N][K]; aa *= .8; if (2 <= ya[K] || 1 == ya[K + 1]) { var ib = 0 != K ? K - 1 : 2; r = u(n.thm[z].s[N][ib], aa, .6 * T); aa = Math.min(aa, r) } if (1 == ya[K]) ib = 0 != K ? K - 1 :
                                                            2, r = u(n.thm[z].s[N][ib], aa, .3 * T), aa = Math.min(aa, r); else if (0 != K && 3 == ya[K - 1] || 0 == K && 3 == n.nsPsy.lastAttacks[z]) ib = 2 != K ? K + 1 : 0, r = u(n.thm[z].s[N][ib], aa, .3 * T), aa = Math.min(aa, r); Hb = Ka[3 * K + 3] + Ka[3 * K + 4] + Ka[3 * K + 5]; 6 * Ka[3 * K + 5] < Hb && (aa *= .5, 6 * Ka[3 * K + 4] < Hb && (aa *= .5)); n.thm[z].s[N][K] = aa
                                                    }
                                                } n.nsPsy.lastAttacks[z] = ya[2]; for (M = F = 0; M < n.npart_l; M++) {
                                                    for (var xb = n.s3ind[M][0], Qb = I[xb] * E[S[xb]], jb = n.s3_ll[F++] * Qb; ++xb <= n.s3ind[M][1];)Qb = I[xb] * E[S[xb]], jb = k(jb, n.s3_ll[F++] * Qb, xb, xb - M, n, 0); jb *= .158489319246111; V[M] = n.blocktype_old[z &
                                                        1] == f.SHORT_TYPE ? jb : u(Math.min(jb, Math.min(2 * n.nb_1[z][M], 16 * n.nb_2[z][M])), jb, T); n.nb_2[z][M] = n.nb_1[z][M]; n.nb_1[z][M] = jb
                                                } for (; M <= f.CBANDS; ++M)I[M] = 0, V[M] = 0; C(n, I, V, z)
                                } if ((a.mode == ka.STEREO || a.mode == ka.JOINT_STEREO) && 0 < a.interChRatio) {
                                    var Cb = a.interChRatio, Oa = a.internal_flags; if (1 < Oa.channels_out) {
                                        for (var Aa = 0; Aa < f.SBMAX_l; Aa++) { var oa = Oa.thm[0].l[Aa]; var Jb = Oa.thm[1].l[Aa]; Oa.thm[0].l[Aa] += Jb * Cb; Oa.thm[1].l[Aa] += oa * Cb } for (Aa = 0; Aa < f.SBMAX_s; Aa++)for (var kb = 0; 3 > kb; kb++)oa = Oa.thm[0].s[Aa][kb], Jb =
                                            Oa.thm[1].s[Aa][kb], Oa.thm[0].s[Aa][kb] += Jb * Cb, Oa.thm[1].s[Aa][kb] += oa * Cb
                                    }
                                } if (a.mode == ka.JOINT_STEREO) {
                                    for (var Db, Kb, Ja, Xa, ea = 0; ea < f.SBMAX_l; ea++)n.thm[0].l[ea] > 1.58 * n.thm[1].l[ea] || n.thm[1].l[ea] > 1.58 * n.thm[0].l[ea] || (Xa = n.mld_l[ea] * n.en[3].l[ea], Ja = Math.max(n.thm[2].l[ea], Math.min(n.thm[3].l[ea], Xa)), Xa = n.mld_l[ea] * n.en[2].l[ea], Kb = Math.max(n.thm[3].l[ea], Math.min(n.thm[2].l[ea], Xa)), n.thm[2].l[ea] = Ja, n.thm[3].l[ea] = Kb); for (ea = 0; ea < f.SBMAX_s; ea++)for (var Ba = 0; 3 > Ba; Ba++)n.thm[0].s[ea][Ba] > 1.58 * n.thm[1].s[ea][Ba] ||
                                        n.thm[1].s[ea][Ba] > 1.58 * n.thm[0].s[ea][Ba] || (Xa = n.mld_s[ea] * n.en[3].s[ea][Ba], Ja = Math.max(n.thm[2].s[ea][Ba], Math.min(n.thm[3].s[ea][Ba], Xa)), Xa = n.mld_s[ea] * n.en[2].s[ea][Ba], Kb = Math.max(n.thm[3].s[ea][Ba], Math.min(n.thm[2].s[ea][Ba], Xa)), n.thm[2].s[ea][Ba] = Ja, n.thm[3].s[ea][Ba] = Kb); Db = a.msfix; if (0 < Math.abs(Db)) {
                                            for (var Lb = Db, Ha, bb, cb, db, Eb, ga = Lb, lb = Math.pow(10, a.ATHlower * n.ATH.adjust), Lb = 2 * Lb, ga = 2 * ga, wa = 0; wa < f.SBMAX_l; wa++)bb = n.ATH.cb_l[n.bm_l[wa]] * lb, Eb = Math.min(Math.max(n.thm[0].l[wa], bb), Math.max(n.thm[1].l[wa],
                                                bb)), db = Math.max(n.thm[2].l[wa], bb), cb = Math.max(n.thm[3].l[wa], bb), Eb * Lb < db + cb && (Ha = Eb * ga / (db + cb), db *= Ha, cb *= Ha), n.thm[2].l[wa] = Math.min(db, n.thm[2].l[wa]), n.thm[3].l[wa] = Math.min(cb, n.thm[3].l[wa]); lb *= f.BLKSIZE_s / f.BLKSIZE; for (wa = 0; wa < f.SBMAX_s; wa++)for (var mb = 0; 3 > mb; mb++)bb = n.ATH.cb_s[n.bm_s[wa]] * lb, Eb = Math.min(Math.max(n.thm[0].s[wa][mb], bb), Math.max(n.thm[1].s[wa][mb], bb)), db = Math.max(n.thm[2].s[wa][mb], bb), cb = Math.max(n.thm[3].s[wa][mb], bb), Eb * Lb < db + cb && (Ha = Eb * Lb / (db + cb), db *= Ha, cb *= Ha), n.thm[2].s[wa][mb] =
                                                    Math.min(n.thm[2].s[wa][mb], db), n.thm[3].s[wa][mb] = Math.min(n.thm[3].s[wa][mb], cb)
                                        }
                                } var Wa = a.internal_flags; a.short_blocks != pa.short_block_coupled || 0 != D[0] && 0 != D[1] || (D[0] = D[1] = 0); for (var ua = 0; ua < Wa.channels_out; ua++)O[ua] = f.NORM_TYPE, a.short_blocks == pa.short_block_dispensed && (D[ua] = 1), a.short_blocks == pa.short_block_forced && (D[ua] = 0), 0 != D[ua] ? Wa.blocktype_old[ua] == f.SHORT_TYPE && (O[ua] = f.STOP_TYPE) : (O[ua] = f.SHORT_TYPE, Wa.blocktype_old[ua] == f.NORM_TYPE && (Wa.blocktype_old[ua] = f.START_TYPE), Wa.blocktype_old[ua] ==
                                    f.STOP_TYPE && (Wa.blocktype_old[ua] = f.SHORT_TYPE)), A[ua] = Wa.blocktype_old[ua], Wa.blocktype_old[ua] = O[ua]; for (z = 0; z < fa; z++) { var Mb = 0; if (1 < z) { var cc = m; Mb = -2; var Ea = f.NORM_TYPE; if (A[0] == f.SHORT_TYPE || A[1] == f.SHORT_TYPE) Ea = f.SHORT_TYPE; var Nb = p[h][z - 2] } else cc = l, Mb = 0, Ea = A[z], Nb = g[h][z]; cc[Mb + z] = Ea == f.SHORT_TYPE ? W(Nb, n.masking_lower) : d(Nb, n.masking_lower); a.analysis && (n.pinfo.pe[h][z] = cc[Mb + z]) } return 0
                        }; var X = [-1.730326E-17, -.01703172, -1.349528E-17, .0418072, -6.73278E-17, -.0876324, -3.0835E-17, .1863476,
                        -1.104424E-16, -.627638]; this.L3psycho_anal_vbr = function (b, e, h, g, p, l, k, m, n, q) {
                            for (var A, y, Q, z = b.internal_flags, B, H, V = G(f.HBLKSIZE), I = ha([3, f.HBLKSIZE_s]), O = ha([2, f.BLKSIZE]), D = ha([2, 3, f.BLKSIZE_s]), M = ha([4, f.CBANDS]), R = ha([4, f.CBANDS]), F = ha([4, 3]), N = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], K = U(2), J = b.mode == ka.JOINT_STEREO ? 4 : z.channels_out, la = ha([2, 576]), S = b.internal_flags, fa = S.channels_out, ca = b.mode == ka.JOINT_STEREO ? 4 : fa, T = 0; T < fa; T++) {
                                firbuf = e[T]; for (var Qa = h + 576 - 350 - 21 + 192, L = 0; 576 > L; L++) {
                                    var ba;
                                    var ia = firbuf[Qa + L + 10]; for (var da = ba = 0; 9 > da; da += 2)ia += X[da] * (firbuf[Qa + L + da] + firbuf[Qa + L + 21 - da]), ba += X[da + 1] * (firbuf[Qa + L + da + 1] + firbuf[Qa + L + 21 - da - 1]); la[T][L] = ia + ba
                                } p[g][T].en.assign(S.en[T]); p[g][T].thm.assign(S.thm[T]); 2 < ca && (l[g][T].en.assign(S.en[T + 2]), l[g][T].thm.assign(S.thm[T + 2]))
                            } for (T = 0; T < ca; T++) {
                                var Y = G(12), Da = G(12), ra = [0, 0, 0, 0], xa = la[T & 1], qa = 0, ya = 3 == T ? S.nsPsy.attackthre_s : S.nsPsy.attackthre, ma = 1; if (2 == T) for (L = 0, da = 576; 0 < da; ++L, --da) {
                                    var ac = la[0][L], Fa = la[1][L]; la[0][L] = ac + Fa; la[1][L] = ac -
                                        Fa
                                } for (L = 0; 3 > L; L++)Da[L] = S.nsPsy.last_en_subshort[T][L + 6], Y[L] = Da[L] / S.nsPsy.last_en_subshort[T][L + 4], ra[0] += Da[L]; for (L = 0; 9 > L; L++) { for (var za = qa + 64, Za = 1; qa < za; qa++)Za < Math.abs(xa[qa]) && (Za = Math.abs(xa[qa])); S.nsPsy.last_en_subshort[T][L] = Da[L + 3] = Za; ra[1 + L / 3] += Za; Za = Za > Da[L + 3 - 2] ? Za / Da[L + 3 - 2] : Da[L + 3 - 2] > 10 * Za ? Da[L + 3 - 2] / (10 * Za) : 0; Y[L + 3] = Za } for (L = 0; 3 > L; ++L) { var Ua = Da[3 * L + 3] + Da[3 * L + 4] + Da[3 * L + 5], Ub = 1; 6 * Da[3 * L + 5] < Ua && (Ub *= .5, 6 * Da[3 * L + 4] < Ua && (Ub *= .5)); F[T][L] = Ub } if (b.analysis) {
                                    for (var fb = Y[0], L = 1; 12 > L; L++)fb <
                                        Y[L] && (fb = Y[L]); S.pinfo.ers[g][T] = S.pinfo.ers_save[T]; S.pinfo.ers_save[T] = fb
                                } for (L = 0; 12 > L; L++)0 == N[T][L / 3] && Y[L] > ya && (N[T][L / 3] = L % 3 + 1); for (L = 1; 4 > L; L++) { var gb = ra[L - 1], ub = ra[L]; 4E4 > Math.max(gb, ub) && gb < 1.7 * ub && ub < 1.7 * gb && (1 == L && N[T][0] <= N[T][L] && (N[T][0] = 0), N[T][L] = 0) } N[T][0] <= S.nsPsy.lastAttacks[T] && (N[T][0] = 0); if (3 == S.nsPsy.lastAttacks[T] || 0 != N[T][0] + N[T][1] + N[T][2] + N[T][3]) ma = 0, 0 != N[T][1] && 0 != N[T][0] && (N[T][1] = 0), 0 != N[T][2] && 0 != N[T][1] && (N[T][2] = 0), 0 != N[T][3] && 0 != N[T][2] && (N[T][3] = 0); 2 > T ? K[T] = ma :
                                    0 == ma && (K[0] = K[1] = 0); n[T] = S.tot_ener[T]
                            } var sb = b.internal_flags; b.short_blocks != pa.short_block_coupled || 0 != K[0] && 0 != K[1] || (K[0] = K[1] = 0); for (var ob = 0; ob < sb.channels_out; ob++)b.short_blocks == pa.short_block_dispensed && (K[ob] = 1), b.short_blocks == pa.short_block_forced && (K[ob] = 0); for (var P = 0; P < J; P++) {
                                Q = P & 1; B = O; var rb = b, Ia = P, Gb = g, Ra = V, La = B, Ma = Q, Sa = rb.internal_flags; if (2 > Ia) t.fft_long(Sa, La[Ma], Ia, e, h); else if (2 == Ia) for (var va = f.BLKSIZE - 1; 0 <= va; --va) {
                                    var Na = La[Ma + 0][va], tb = La[Ma + 1][va]; La[Ma + 0][va] = (Na + tb) *
                                        Z.SQRT2 * .5; La[Ma + 1][va] = (Na - tb) * Z.SQRT2 * .5
                                } Ra[0] = La[Ma + 0][0]; Ra[0] *= Ra[0]; for (va = f.BLKSIZE / 2 - 1; 0 <= va; --va) { var zb = La[Ma + 0][f.BLKSIZE / 2 - va], Va = La[Ma + 0][f.BLKSIZE / 2 + va]; Ra[f.BLKSIZE / 2 - va] = .5 * (zb * zb + Va * Va) } for (var ja = 0, va = 11; va < f.HBLKSIZE; va++)ja += Ra[va]; Sa.tot_ener[Ia] = ja; if (rb.analysis) { for (va = 0; va < f.HBLKSIZE; va++)Sa.pinfo.energy[Gb][Ia][va] = Sa.pinfo.energy_save[Ia][va], Sa.pinfo.energy_save[Ia][va] = Ra[va]; Sa.pinfo.pe[Gb][Ia] = Sa.pe[Ia] } var Ca = P, Fb = V, Hb = b.internal_flags; 2 == b.athaa_loudapprox && 2 > Ca &&
                                    (Hb.loudness_sq[g][Ca] = Hb.loudness_sq_save[Ca], Hb.loudness_sq_save[Ca] = x(Fb, Hb)); if (0 != K[Q]) {
                                        var aa = void 0, sa = void 0, ta = z, Wb = V, Ab = M[P], Ta = R[P], $a = P, vb = G(f.CBANDS), Tb = G(f.CBANDS), Ga = U(f.CBANDS + 2); c(ta, Wb, Ab, vb, Tb); w(ta, vb, Tb, Ga); for (var Ib = 0, aa = 0; aa < ta.npart_l; aa++) {
                                            var $b, hb = ta.s3ind[aa][0], fc = ta.s3ind[aa][1], Bb = 0, wb = 0, Bb = Ga[hb], wb = wb + 1; var ab = ta.s3_ll[Ib] * Ab[hb] * E[Ga[hb]]; ++Ib; for (++hb; hb <= fc;) { Bb += Ga[hb]; wb += 1; var ib = ta.s3_ll[Ib] * Ab[hb] * E[Ga[hb]]; ab = $b = r(ab, ib, hb - aa); ++Ib; ++hb } Bb = (1 + 2 * Bb) / (2 * wb);
                                            var xb = .5 * E[Bb]; ab *= xb; if (ta.blocktype_old[$a & 1] == f.SHORT_TYPE) sa = 2 * ta.nb_1[$a][aa], Ta[aa] = 0 < sa ? Math.min(ab, sa) : Math.min(ab, .3 * Ab[aa]); else { var Qb = 16 * ta.nb_2[$a][aa], jb = 2 * ta.nb_1[$a][aa]; 0 >= Qb && (Qb = ab); 0 >= jb && (jb = ab); sa = ta.blocktype_old[$a & 1] == f.NORM_TYPE ? Math.min(jb, Qb) : jb; Ta[aa] = Math.min(ab, sa) } ta.nb_2[$a][aa] = ta.nb_1[$a][aa]; ta.nb_1[$a][aa] = ab; ib = vb[aa]; ib *= ta.minval_l[aa]; ib *= xb; Ta[aa] > ib && (Ta[aa] = ib); 1 < ta.masking_lower && (Ta[aa] *= ta.masking_lower); Ta[aa] > Ab[aa] && (Ta[aa] = Ab[aa]); 1 > ta.masking_lower &&
                                                (Ta[aa] *= ta.masking_lower)
                                        } for (; aa < f.CBANDS; ++aa)Ab[aa] = 0, Ta[aa] = 0
                                    } else for (var Cb = z, Oa = P, Aa = 0; Aa < Cb.npart_l; Aa++)Cb.nb_2[Oa][Aa] = Cb.nb_1[Oa][Aa], Cb.nb_1[Oa][Aa] = 0
                            } 2 == K[0] + K[1] && b.mode == ka.JOINT_STEREO && a(M, R, z.mld_cb_l, z.ATH.cb_l, b.ATHlower * z.ATH.adjust, b.msfix, z.npart_l); for (P = 0; P < J; P++)Q = P & 1, 0 != K[Q] && C(z, M[P], R[P], P); for (var oa = 0; 3 > oa; oa++) {
                                for (P = 0; P < J; ++P)if (Q = P & 1, 0 != K[Q]) { var Jb = z, kb = P; if (0 == oa) for (var Db = 0; Db < Jb.npart_s; Db++)Jb.nb_s2[kb][Db] = Jb.nb_s1[kb][Db], Jb.nb_s1[kb][Db] = 0 } else {
                                    H = D; var Kb =
                                        P, Ja = oa, Xa = I, ea = H, Ba = Q, Lb = b.internal_flags; 0 == Ja && 2 > Kb && t.fft_short(Lb, ea[Ba], Kb, e, h); if (2 == Kb) for (var Ha = f.BLKSIZE_s - 1; 0 <= Ha; --Ha) { var bb = ea[Ba + 0][Ja][Ha], cb = ea[Ba + 1][Ja][Ha]; ea[Ba + 0][Ja][Ha] = (bb + cb) * Z.SQRT2 * .5; ea[Ba + 1][Ja][Ha] = (bb - cb) * Z.SQRT2 * .5 } Xa[Ja][0] = ea[Ba + 0][Ja][0]; Xa[Ja][0] *= Xa[Ja][0]; for (Ha = f.BLKSIZE_s / 2 - 1; 0 <= Ha; --Ha) { var db = ea[Ba + 0][Ja][f.BLKSIZE_s / 2 - Ha], Eb = ea[Ba + 0][Ja][f.BLKSIZE_s / 2 + Ha]; Xa[Ja][f.BLKSIZE_s / 2 - Ha] = .5 * (db * db + Eb * Eb) } for (var ga = void 0, lb = void 0, wa = void 0, mb = I, Wa = M[P], ua = R[P],
                                            Mb = P, cc = oa, Ea = b.internal_flags, Nb = new float[f.CBANDS], kc = G(f.CBANDS), dc = new int[f.CBANDS], ga = lb = 0; ga < Ea.npart_s; ++ga) { for (var gc = 0, lc = 0, sc = Ea.numlines_s[ga], wa = 0; wa < sc; ++wa, ++lb) { var mc = mb[cc][lb], gc = gc + mc; lc < mc && (lc = mc) } Wa[ga] = gc; Nb[ga] = lc; kc[ga] = gc / sc } for (; ga < f.CBANDS; ++ga)Nb[ga] = 0, kc[ga] = 0; var Ya = void 0, nb = void 0, Ob = Ea, pb = Nb, Rb = kc, Xb = dc, Yb = E.length - 1, na = 0, Pa = Rb[na] + Rb[na + 1]; 0 < Pa ? (Ya = pb[na], Ya < pb[na + 1] && (Ya = pb[na + 1]), Pa = 20 * (2 * Ya - Pa) / (Pa * (Ob.numlines_s[na] + Ob.numlines_s[na + 1] - 1)), nb = 0 | Pa, nb > Yb &&
                                                (nb = Yb), Xb[na] = nb) : Xb[na] = 0; for (na = 1; na < Ob.npart_s - 1; na++)Pa = Rb[na - 1] + Rb[na] + Rb[na + 1], 0 < Pa ? (Ya = pb[na - 1], Ya < pb[na] && (Ya = pb[na]), Ya < pb[na + 1] && (Ya = pb[na + 1]), Pa = 20 * (3 * Ya - Pa) / (Pa * (Ob.numlines_s[na - 1] + Ob.numlines_s[na] + Ob.numlines_s[na + 1] - 1)), nb = 0 | Pa, nb > Yb && (nb = Yb), Xb[na] = nb) : Xb[na] = 0; Pa = Rb[na - 1] + Rb[na]; 0 < Pa ? (Ya = pb[na - 1], Ya < pb[na] && (Ya = pb[na]), Pa = 20 * (2 * Ya - Pa) / (Pa * (Ob.numlines_s[na - 1] + Ob.numlines_s[na] - 1)), nb = 0 | Pa, nb > Yb && (nb = Yb), Xb[na] = nb) : Xb[na] = 0; for (lb = ga = 0; ga < Ea.npart_s; ga++) {
                                                    var yb = Ea.s3ind_s[ga][0],
                                                    ic = Ea.s3ind_s[ga][1]; var hc = dc[yb]; var tc = 1; var ec = Ea.s3_ss[lb] * Wa[yb] * E[dc[yb]]; ++lb; for (++yb; yb <= ic;) { hc += dc[yb]; tc += 1; var Zb = Ea.s3_ss[lb] * Wa[yb] * E[dc[yb]]; ec = r(ec, Zb, yb - ga); ++lb; ++yb } hc = (1 + 2 * hc) / (2 * tc); var uc = .5 * E[hc]; ec *= uc; ua[ga] = ec; Ea.nb_s2[Mb][ga] = Ea.nb_s1[Mb][ga]; Ea.nb_s1[Mb][ga] = ec; Zb = Nb[ga]; Zb *= Ea.minval_s[ga]; Zb *= uc; ua[ga] > Zb && (ua[ga] = Zb); 1 < Ea.masking_lower && (ua[ga] *= Ea.masking_lower); ua[ga] > Wa[ga] && (ua[ga] = Wa[ga]); 1 > Ea.masking_lower && (ua[ga] *= Ea.masking_lower)
                                                } for (; ga < f.CBANDS; ++ga)Wa[ga] =
                                                    0, ua[ga] = 0
                                } 0 == K[0] + K[1] && b.mode == ka.JOINT_STEREO && a(M, R, z.mld_cb_s, z.ATH.cb_s, b.ATHlower * z.ATH.adjust, b.msfix, z.npart_s); for (P = 0; P < J; ++P)Q = P & 1, 0 == K[Q] && v(z, M[P], R[P], P, oa)
                            } for (P = 0; P < J; P++)if (Q = P & 1, 0 == K[Q]) for (var Sb = 0; Sb < f.SBMAX_s; Sb++) {
                                for (var vc = G(3), oa = 0; 3 > oa; oa++) {
                                    var eb = z.thm[P].s[Sb][oa], eb = .8 * eb; if (2 <= N[P][oa] || 1 == N[P][oa + 1]) y = 0 != oa ? oa - 1 : 2, A = u(z.thm[P].s[Sb][y], eb, .36), eb = Math.min(eb, A); else if (1 == N[P][oa]) y = 0 != oa ? oa - 1 : 2, A = u(z.thm[P].s[Sb][y], eb, .18), eb = Math.min(eb, A); else if (0 != oa && 3 == N[P][oa -
                                        1] || 0 == oa && 3 == z.nsPsy.lastAttacks[P]) y = 2 != oa ? oa + 1 : 0, A = u(z.thm[P].s[Sb][y], eb, .18), eb = Math.min(eb, A); eb *= F[P][oa]; vc[oa] = eb
                                } for (oa = 0; 3 > oa; oa++)z.thm[P].s[Sb][oa] = vc[oa]
                            } for (P = 0; P < J; P++)z.nsPsy.lastAttacks[P] = N[P][2]; for (var Pb = b.internal_flags, qb = 0; qb < Pb.channels_out; qb++) {
                                var nc = f.NORM_TYPE; 0 != K[qb] ? Pb.blocktype_old[qb] == f.SHORT_TYPE && (nc = f.STOP_TYPE) : (nc = f.SHORT_TYPE, Pb.blocktype_old[qb] == f.NORM_TYPE && (Pb.blocktype_old[qb] = f.START_TYPE), Pb.blocktype_old[qb] == f.STOP_TYPE && (Pb.blocktype_old[qb] = f.SHORT_TYPE));
                                q[qb] = Pb.blocktype_old[qb]; Pb.blocktype_old[qb] = nc
                            } for (P = 0; P < J; P++) { if (1 < P) { var oc = m; var pc = -2; var qc = f.NORM_TYPE; if (q[0] == f.SHORT_TYPE || q[1] == f.SHORT_TYPE) qc = f.SHORT_TYPE; var rc = l[g][P - 2] } else oc = k, pc = 0, qc = q[P], rc = p[g][P]; oc[pc + P] = qc == f.SHORT_TYPE ? W(rc, z.masking_lower) : d(rc, z.masking_lower); b.analysis && (z.pinfo.pe[g][P] = oc[pc + P]) } return 0
                        }; this.psymodel_init = function (a) {
                            var b, c, d = a.internal_flags, h, g = !0, p = 13; var k = b = 0; var A = -8.25, r = -4.5, u = G(f.CBANDS), y = G(f.CBANDS), w = G(f.CBANDS), x = a.out_samplerate;
                            switch (a.experimentalZ) { default: case 0: g = !0; break; case 1: g = a.VBR == J.vbr_mtrh || a.VBR == J.vbr_mt ? !1 : !0; break; case 2: g = !1; break; case 3: p = 8, b = -1.75, k = -.0125, A = -8.25, r = -2.25 }d.ms_ener_ratio_old = .25; d.blocktype_old[0] = d.blocktype_old[1] = f.NORM_TYPE; for (h = 0; 4 > h; ++h) {
                                for (var v = 0; v < f.CBANDS; ++v)d.nb_1[h][v] = 1E20, d.nb_2[h][v] = 1E20, d.nb_s1[h][v] = d.nb_s2[h][v] = 1; for (c = 0; c < f.SBMAX_l; c++)d.en[h].l[c] = 1E20, d.thm[h].l[c] = 1E20; for (v = 0; 3 > v; ++v) {
                                    for (c = 0; c < f.SBMAX_s; c++)d.en[h].s[c][v] = 1E20, d.thm[h].s[c][v] = 1E20; d.nsPsy.lastAttacks[h] =
                                        0
                                } for (v = 0; 9 > v; v++)d.nsPsy.last_en_subshort[h][v] = 10
                            } d.loudness_sq_save[0] = d.loudness_sq_save[1] = 0; d.npart_l = e(d.numlines_l, d.bo_l, d.bm_l, u, y, d.mld_l, d.PSY.bo_l_weight, x, f.BLKSIZE, d.scalefac_band.l, f.BLKSIZE / 1152, f.SBMAX_l); for (h = 0; h < d.npart_l; h++)c = b, u[h] >= p && (c = k * (u[h] - p) / (24 - p) + b * (24 - u[h]) / (24 - p)), w[h] = Math.pow(10, c / 10), d.rnumlines_l[h] = 0 < d.numlines_l[h] ? 1 / d.numlines_l[h] : 0; d.s3_ll = l(d.s3ind, d.npart_l, u, y, w, g); for (h = v = 0; h < d.npart_l; h++) {
                                k = sb.MAX_VALUE; for (c = 0; c < d.numlines_l[h]; c++, v++)b = x * v / (1E3 *
                                    f.BLKSIZE), b = this.ATHformula(1E3 * b, a) - 20, b = Math.pow(10, .1 * b), b *= d.numlines_l[h], k > b && (k = b); d.ATH.cb_l[h] = k; k = -20 + 20 * u[h] / 10; 6 < k && (k = 100); -15 > k && (k = -15); k -= 8; d.minval_l[h] = Math.pow(10, k / 10) * d.numlines_l[h]
                            } d.npart_s = e(d.numlines_s, d.bo_s, d.bm_s, u, y, d.mld_s, d.PSY.bo_s_weight, x, f.BLKSIZE_s, d.scalefac_band.s, f.BLKSIZE_s / 384, f.SBMAX_s); for (h = v = 0; h < d.npart_s; h++) {
                                c = A; u[h] >= p && (c = r * (u[h] - p) / (24 - p) + A * (24 - u[h]) / (24 - p)); w[h] = Math.pow(10, c / 10); k = sb.MAX_VALUE; for (c = 0; c < d.numlines_s[h]; c++, v++)b = x * v / (1E3 * f.BLKSIZE_s),
                                    b = this.ATHformula(1E3 * b, a) - 20, b = Math.pow(10, .1 * b), b *= d.numlines_s[h], k > b && (k = b); d.ATH.cb_s[h] = k; k = -7 + 7 * u[h] / 12; 12 < u[h] && (k *= 1 + 3.1 * Math.log(1 + k)); 12 > u[h] && (k *= 1 + 2.3 * Math.log(1 - k)); -15 > k && (k = -15); k -= 8; d.minval_s[h] = Math.pow(10, k / 10) * d.numlines_s[h]
                            } d.s3_ss = l(d.s3ind_s, d.npart_s, u, y, w, g); m = Math.pow(10, .5625); n = Math.pow(10, 1.5); z = Math.pow(10, 1.5); t.init_fft(d); d.decay = Math.exp(-2.302585092994046 / (.01 * x / 192)); h = 3.5; 0 != (a.exp_nspsytune & 2) && (h = 1); 0 < Math.abs(a.msfix) && (h = a.msfix); a.msfix = h; for (g = 0; g < d.npart_l; g++)d.s3ind[g][1] >
                                d.npart_l - 1 && (d.s3ind[g][1] = d.npart_l - 1); d.ATH.decay = Math.pow(10, 576 * d.mode_gr / x * -1.2); d.ATH.adjust = .01; d.ATH.adjustLimit = 1; if (-1 != a.ATHtype) { v = a.out_samplerate / f.BLKSIZE; for (h = b = g = 0; h < f.BLKSIZE / 2; ++h)b += v, d.ATH.eql_w[h] = 1 / Math.pow(10, this.ATHformula(b, a) / 10), g += d.ATH.eql_w[h]; g = 1 / g; for (h = f.BLKSIZE / 2; 0 <= --h;)d.ATH.eql_w[h] *= g } for (g = v = 0; g < d.npart_s; ++g)for (h = 0; h < d.numlines_s[g]; ++h)++v; for (g = v = 0; g < d.npart_l; ++g)for (h = 0; h < d.numlines_l[g]; ++h)++v; for (h = v = 0; h < d.npart_l; h++)b = x * (v + d.numlines_l[h] / 2) / (1 *
                                    f.BLKSIZE), d.mld_cb_l[h] = q(b), v += d.numlines_l[h]; for (; h < f.CBANDS; ++h)d.mld_cb_l[h] = 1; for (h = v = 0; h < d.npart_s; h++)b = x * (v + d.numlines_s[h] / 2) / (1 * f.BLKSIZE_s), d.mld_cb_s[h] = q(b), v += d.numlines_s[h]; for (; h < f.CBANDS; ++h)d.mld_cb_s[h] = 1; return 0
                        }; this.ATHformula = function (a, b) { switch (b.ATHtype) { case 0: a = g(a, 9); break; case 1: a = g(a, -1); break; case 2: a = g(a, 0); break; case 3: a = g(a, 1) + 6; break; case 4: a = g(a, b.ATHcurve); break; default: a = g(a, 0) }return a }
            } function W() {
                function x() {
                    this.mask_adjust_short = this.mask_adjust = 0;
                    this.bo_l_weight = G(f.SBMAX_l); this.bo_s_weight = G(f.SBMAX_s)
                } function k() { this.lowerlimit = 0 } function r(a, b) { this.lowpass = b } function K(a) { return 1 < a ? 0 : 0 >= a ? 1 : Math.cos(Math.PI / 2 * a) } function C(a, b) {
                    switch (a) {
                        case 44100: return b.version = 1, 0; case 48E3: return b.version = 1; case 32E3: return b.version = 1, 2; case 22050: return b.version = 0; case 24E3: return b.version = 0, 1; case 16E3: return b.version = 0, 2; case 11025: return b.version = 0; case 12E3: return b.version = 0, 1; case 8E3: return b.version = 0, 2; default: return b.version =
                            0, -1
                    }
                } function u(a, b, c) { 16E3 > c && (b = 2); c = v.bitrate_table[b][1]; for (var d = 2; 14 >= d; d++)0 < v.bitrate_table[b][d] && Math.abs(v.bitrate_table[b][d] - a) < Math.abs(c - a) && (c = v.bitrate_table[b][d]); return c } function U(a, b, c) { 16E3 > c && (b = 2); for (c = 0; 14 >= c; c++)if (0 < v.bitrate_table[b][c] && v.bitrate_table[b][c] == a) return c; return -1 } function d(a, b) {
                    var c = [new r(8, 2E3), new r(16, 3700), new r(24, 3900), new r(32, 5500), new r(40, 7E3), new r(48, 7500), new r(56, 1E4), new r(64, 11E3), new r(80, 13500), new r(96, 15100), new r(112, 15600),
                    new r(128, 17E3), new r(160, 17500), new r(192, 18600), new r(224, 19400), new r(256, 19700), new r(320, 20500)]; b = e.nearestBitrateFullIndex(b); a.lowerlimit = c[b].lowpass
                } function c(a) { var b = f.BLKSIZE + a.framesize - f.FFTOFFSET; return b = Math.max(b, 512 + a.framesize - 32) } function w(d, g, k, m, n, r, t) {
                    var h = d.internal_flags, p = 0, A = [null, null], u = [null, null]; if (4294479419 != h.Class_ID) return -3; if (0 == m) return 0; var y = q.copy_buffer(h, n, r, t, 0); if (0 > y) return y; r += y; p += y; u[0] = g; u[1] = k; if (da.NEQ(d.scale, 0) && da.NEQ(d.scale, 1)) for (y =
                        0; y < m; ++y)u[0][y] *= d.scale, 2 == h.channels_out && (u[1][y] *= d.scale); if (da.NEQ(d.scale_left, 0) && da.NEQ(d.scale_left, 1)) for (y = 0; y < m; ++y)u[0][y] *= d.scale_left; if (da.NEQ(d.scale_right, 0) && da.NEQ(d.scale_right, 1)) for (y = 0; y < m; ++y)u[1][y] *= d.scale_right; if (2 == d.num_channels && 1 == h.channels_out) for (y = 0; y < m; ++y)u[0][y] = .5 * (u[0][y] + u[1][y]), u[1][y] = 0; g = c(d); A[0] = h.mfbuf[0]; A[1] = h.mfbuf[1]; for (k = 0; 0 < m;) {
                            var v = [null, null]; v[0] = u[0]; v[1] = u[1]; y = new a; var w = d; var x = A; var z = k, C = m, O = y, D = w.internal_flags; if (.9999 > D.resample_ratio ||
                                1.0001 < D.resample_ratio) for (var E = 0; E < D.channels_out; E++) {
                                    var R = new b, K = O, F, J = x[E], S = D.mf_size, W = w.framesize, U = v[E], Z = z, ba = C, fa = R, ka = E, Y = w.internal_flags, ha = 0, ra = w.out_samplerate / B(w.out_samplerate, w.in_samplerate); ra > ia.BPC && (ra = ia.BPC); var pa = 1E-4 > Math.abs(Y.resample_ratio - Math.floor(.5 + Y.resample_ratio)) ? 1 : 0; var qa = 1 / Y.resample_ratio; 1 < qa && (qa = 1); var ma = 31; 0 == ma % 2 && --ma; ma += pa; pa = ma + 1; if (0 == Y.fill_buffer_resample_init) {
                                        Y.inbuf_old[0] = G(pa); Y.inbuf_old[1] = G(pa); for (F = 0; F <= 2 * ra; ++F)Y.blackfilt[F] =
                                            G(pa); Y.itime[0] = 0; for (ha = Y.itime[1] = 0; ha <= 2 * ra; ha++) { var xa = 0; var T = (ha - ra) / (2 * ra); for (F = 0; F <= ma; F++) { var Fa = Y.blackfilt[ha], L = F, za = F - T, Ua = Math.PI * qa, za = za / ma; 0 > za && (za = 0); 1 < za && (za = 1); var Ka = za - .5, za = .42 - .5 * Math.cos(2 * za * Math.PI) + .08 * Math.cos(4 * za * Math.PI), xa = xa + (Fa[L] = 1E-9 > Math.abs(Ka) ? Ua / Math.PI : za * Math.sin(ma * Ua * Ka) / (Math.PI * ma * Ka)) } for (F = 0; F <= ma; F++)Y.blackfilt[ha][F] /= xa } Y.fill_buffer_resample_init = 1
                                    } xa = Y.inbuf_old[ka]; for (qa = 0; qa < W; qa++) {
                                        F = qa * Y.resample_ratio; ha = 0 | Math.floor(F - Y.itime[ka]);
                                        if (ma + ha - ma / 2 >= ba) break; T = F - Y.itime[ka] - (ha + ma % 2 * .5); T = 0 | Math.floor(2 * T * ra + ra + .5); for (F = Fa = 0; F <= ma; ++F)L = F + ha - ma / 2, Fa += (0 > L ? xa[pa + L] : U[Z + L]) * Y.blackfilt[T][F]; J[S + qa] = Fa
                                    } fa.num_used = Math.min(ba, ma + ha - ma / 2); Y.itime[ka] += fa.num_used - qa * Y.resample_ratio; if (fa.num_used >= pa) for (F = 0; F < pa; F++)xa[F] = U[Z + fa.num_used + F - pa]; else { J = pa - fa.num_used; for (F = 0; F < J; ++F)xa[F] = xa[F + fa.num_used]; for (ha = 0; F < pa; ++F, ++ha)xa[F] = U[Z + ha] } K.n_out = qa; O.n_in = R.num_used
                                } else for (O.n_out = Math.min(w.framesize, C), O.n_in = O.n_out, w =
                                    0; w < O.n_out; ++w)x[0][D.mf_size + w] = v[0][z + w], 2 == D.channels_out && (x[1][D.mf_size + w] = v[1][z + w]); x = y.n_in; y = y.n_out; if (h.findReplayGain && !h.decode_on_the_fly && l.AnalyzeSamples(h.rgdata, A[0], h.mf_size, A[1], h.mf_size, y, h.channels_out) == ca.GAIN_ANALYSIS_ERROR) return -6; m -= x; k += x; h.mf_size += y; 1 > h.mf_samples_to_encode && (h.mf_samples_to_encode = f.ENCDELAY + f.POSTDELAY); h.mf_samples_to_encode += y; if (h.mf_size >= g) {
                                        x = t - p; 0 == t && (x = 0); y = d; x = e.enc.lame_encode_mp3_frame(y, A[0], A[1], n, r, x); y.frameNum++; y = x; if (0 > y) return y;
                                        r += y; p += y; h.mf_size -= d.framesize; h.mf_samples_to_encode -= d.framesize; for (x = 0; x < h.channels_out; x++)for (y = 0; y < h.mf_size; y++)A[x][y] = A[x][y + d.framesize]
                                    }
                        } return p
                } function a() { this.n_out = this.n_in = 0 } function b() { this.num_used = 0 } function B(a, b) { return 0 != b ? B(b, a % b) : a } var e = this; W.V9 = 410; W.V8 = 420; W.V7 = 430; W.V6 = 440; W.V5 = 450; W.V4 = 460; W.V3 = 470; W.V2 = 480; W.V1 = 490; W.V0 = 500; W.R3MIX = 1E3; W.STANDARD = 1001; W.EXTREME = 1002; W.INSANE = 1003; W.STANDARD_FAST = 1004; W.EXTREME_FAST = 1005; W.MEDIUM = 1006; W.MEDIUM_FAST = 1007; W.LAME_MAXMP3BUFFER =
                    147456; var l, q, g, t, D, m = new $b, n, z, E; this.enc = new f; this.setModules = function (a, b, c, d, e, f, k, r, u) { l = a; q = b; g = c; t = d; D = e; n = f; z = r; E = u; this.enc.setModules(q, m, t, n) }; this.lame_init = function () {
                        var a = new Ac; a.class_id = 4294479419; var b = a.internal_flags = new ia; a.mode = ka.NOT_SET; a.original = 1; a.in_samplerate = 44100; a.num_channels = 2; a.num_samples = -1; a.bWriteVbrTag = !0; a.quality = -1; a.short_blocks = null; b.subblock_gain = -1; a.lowpassfreq = 0; a.highpassfreq = 0; a.lowpasswidth = -1; a.highpasswidth = -1; a.VBR = J.vbr_off; a.VBR_q = 4;
                        a.ATHcurve = -1; a.VBR_mean_bitrate_kbps = 128; a.VBR_min_bitrate_kbps = 0; a.VBR_max_bitrate_kbps = 0; a.VBR_hard_min = 0; b.VBR_min_bitrate = 1; b.VBR_max_bitrate = 13; a.quant_comp = -1; a.quant_comp_short = -1; a.msfix = -1; b.resample_ratio = 1; b.OldValue[0] = 180; b.OldValue[1] = 180; b.CurrentStep[0] = 4; b.CurrentStep[1] = 4; b.masking_lower = 1; b.nsPsy.attackthre = -1; b.nsPsy.attackthre_s = -1; a.scale = -1; a.athaa_type = -1; a.ATHtype = -1; a.athaa_loudapprox = -1; a.athaa_sensitivity = 0; a.useTemporal = null; a.interChRatio = -1; b.mf_samples_to_encode = f.ENCDELAY +
                            f.POSTDELAY; a.encoder_padding = 0; b.mf_size = f.ENCDELAY - f.MDCTDELAY; a.findReplayGain = !1; a.decode_on_the_fly = !1; b.decode_on_the_fly = !1; b.findReplayGain = !1; b.findPeakSample = !1; b.RadioGain = 0; b.AudiophileGain = 0; b.noclipGainChange = 0; b.noclipScale = -1; a.preset = 0; a.write_id3tag_automatic = !0; a.lame_allocated_gfp = 1; return a
                    }; this.nearestBitrateFullIndex = function (a) {
                        var b = [8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320]; var c = b[16]; var d = 16; var e = b[16]; var h = 16; for (var f = 0; 16 > f; f++)if (Math.max(a, b[f +
                            1]) != a) { c = b[f + 1]; d = f + 1; e = b[f]; h = f; break } return c - a > a - e ? h : d
                    }; this.lame_init_params = function (a) {
                        var b = a.internal_flags; b.Class_ID = 0; null == b.ATH && (b.ATH = new zc); null == b.PSY && (b.PSY = new x); null == b.rgdata && (b.rgdata = new Cc); b.channels_in = a.num_channels; 1 == b.channels_in && (a.mode = ka.MONO); b.channels_out = a.mode == ka.MONO ? 1 : 2; b.mode_ext = f.MPG_MD_MS_LR; a.mode == ka.MONO && (a.force_ms = !1); a.VBR == J.vbr_off && 128 != a.VBR_mean_bitrate_kbps && 0 == a.brate && (a.brate = a.VBR_mean_bitrate_kbps); a.VBR != J.vbr_off && a.VBR != J.vbr_mtrh &&
                            a.VBR != J.vbr_mt && (a.free_format = !1); a.VBR == J.vbr_off && 0 == a.brate && da.EQ(a.compression_ratio, 0) && (a.compression_ratio = 11.025); a.VBR == J.vbr_off && 0 < a.compression_ratio && (0 == a.out_samplerate && (a.out_samplerate = map2MP3Frequency(int(.97 * a.in_samplerate))), a.brate = 0 | 16 * a.out_samplerate * b.channels_out / (1E3 * a.compression_ratio), b.samplerate_index = C(a.out_samplerate, a), a.free_format || (a.brate = u(a.brate, a.version, a.out_samplerate))); 0 != a.out_samplerate && (16E3 > a.out_samplerate ? (a.VBR_mean_bitrate_kbps = Math.max(a.VBR_mean_bitrate_kbps,
                                8), a.VBR_mean_bitrate_kbps = Math.min(a.VBR_mean_bitrate_kbps, 64)) : 32E3 > a.out_samplerate ? (a.VBR_mean_bitrate_kbps = Math.max(a.VBR_mean_bitrate_kbps, 8), a.VBR_mean_bitrate_kbps = Math.min(a.VBR_mean_bitrate_kbps, 160)) : (a.VBR_mean_bitrate_kbps = Math.max(a.VBR_mean_bitrate_kbps, 32), a.VBR_mean_bitrate_kbps = Math.min(a.VBR_mean_bitrate_kbps, 320))); if (0 == a.lowpassfreq) {
                                    switch (a.VBR) {
                                        case J.vbr_off: var c = new k; d(c, a.brate); c = c.lowerlimit; break; case J.vbr_abr: c = new k; d(c, a.VBR_mean_bitrate_kbps); c = c.lowerlimit; break;
                                        case J.vbr_rh: var e = [19500, 19E3, 18600, 18E3, 17500, 16E3, 15600, 14900, 12500, 1E4, 3950]; if (0 <= a.VBR_q && 9 >= a.VBR_q) { c = e[a.VBR_q]; var h = e[a.VBR_q + 1]; e = a.VBR_q_frac; c = linear_int(c, h, e) } else c = 19500; break; default: e = [19500, 19E3, 18500, 18E3, 17500, 16500, 15500, 14500, 12500, 9500, 3950], 0 <= a.VBR_q && 9 >= a.VBR_q ? (c = e[a.VBR_q], h = e[a.VBR_q + 1], e = a.VBR_q_frac, c = linear_int(c, h, e)) : c = 19500
                                    }a.mode != ka.MONO || a.VBR != J.vbr_off && a.VBR != J.vbr_abr || (c *= 1.5); a.lowpassfreq = c | 0
                                } 0 == a.out_samplerate && (2 * a.lowpassfreq > a.in_samplerate && (a.lowpassfreq =
                                    a.in_samplerate / 2), c = a.lowpassfreq | 0, e = a.in_samplerate, h = 44100, 48E3 <= e ? h = 48E3 : 44100 <= e ? h = 44100 : 32E3 <= e ? h = 32E3 : 24E3 <= e ? h = 24E3 : 22050 <= e ? h = 22050 : 16E3 <= e ? h = 16E3 : 12E3 <= e ? h = 12E3 : 11025 <= e ? h = 11025 : 8E3 <= e && (h = 8E3), -1 == c ? c = h : (15960 >= c && (h = 44100), 15250 >= c && (h = 32E3), 11220 >= c && (h = 24E3), 9970 >= c && (h = 22050), 7230 >= c && (h = 16E3), 5420 >= c && (h = 12E3), 4510 >= c && (h = 11025), 3970 >= c && (h = 8E3), c = e < h ? 44100 < e ? 48E3 : 32E3 < e ? 44100 : 24E3 < e ? 32E3 : 22050 < e ? 24E3 : 16E3 < e ? 22050 : 12E3 < e ? 16E3 : 11025 < e ? 12E3 : 8E3 < e ? 11025 : 8E3 : h), a.out_samplerate = c); a.lowpassfreq =
                                        Math.min(20500, a.lowpassfreq); a.lowpassfreq = Math.min(a.out_samplerate / 2, a.lowpassfreq); a.VBR == J.vbr_off && (a.compression_ratio = 16 * a.out_samplerate * b.channels_out / (1E3 * a.brate)); a.VBR == J.vbr_abr && (a.compression_ratio = 16 * a.out_samplerate * b.channels_out / (1E3 * a.VBR_mean_bitrate_kbps)); a.bWriteVbrTag || (a.findReplayGain = !1, a.decode_on_the_fly = !1, b.findPeakSample = !1); b.findReplayGain = a.findReplayGain; b.decode_on_the_fly = a.decode_on_the_fly; b.decode_on_the_fly && (b.findPeakSample = !0); if (b.findReplayGain && l.InitGainAnalysis(b.rgdata,
                                            a.out_samplerate) == ca.INIT_GAIN_ANALYSIS_ERROR) return a.internal_flags = null, -6; b.decode_on_the_fly && !a.decode_only && (null != b.hip && E.hip_decode_exit(b.hip), b.hip = E.hip_decode_init()); b.mode_gr = 24E3 >= a.out_samplerate ? 1 : 2; a.framesize = 576 * b.mode_gr; a.encoder_delay = f.ENCDELAY; b.resample_ratio = a.in_samplerate / a.out_samplerate; switch (a.VBR) {
                                                case J.vbr_mt: case J.vbr_rh: case J.vbr_mtrh: a.compression_ratio = [5.7, 6.5, 7.3, 8.2, 10, 11.9, 13, 14, 15, 16.5][a.VBR_q]; break; case J.vbr_abr: a.compression_ratio = 16 * a.out_samplerate *
                                                    b.channels_out / (1E3 * a.VBR_mean_bitrate_kbps); break; default: a.compression_ratio = 16 * a.out_samplerate * b.channels_out / (1E3 * a.brate)
                                            }a.mode == ka.NOT_SET && (a.mode = ka.JOINT_STEREO); 0 < a.highpassfreq ? (b.highpass1 = 2 * a.highpassfreq, b.highpass2 = 0 <= a.highpasswidth ? 2 * (a.highpassfreq + a.highpasswidth) : 2 * a.highpassfreq, b.highpass1 /= a.out_samplerate, b.highpass2 /= a.out_samplerate) : (b.highpass1 = 0, b.highpass2 = 0); 0 < a.lowpassfreq ? (b.lowpass2 = 2 * a.lowpassfreq, 0 <= a.lowpasswidth ? (b.lowpass1 = 2 * (a.lowpassfreq - a.lowpasswidth),
                                                0 > b.lowpass1 && (b.lowpass1 = 0)) : b.lowpass1 = 2 * a.lowpassfreq, b.lowpass1 /= a.out_samplerate, b.lowpass2 /= a.out_samplerate) : (b.lowpass1 = 0, b.lowpass2 = 0); c = a.internal_flags; var r = 32, w = -1; if (0 < c.lowpass1) { var B = 999; for (e = 0; 31 >= e; e++)h = e / 31, h >= c.lowpass2 && (r = Math.min(r, e)), c.lowpass1 < h && h < c.lowpass2 && (B = Math.min(B, e)); c.lowpass1 = 999 == B ? (r - .75) / 31 : (B - .75) / 31; c.lowpass2 = r / 31 } 0 < c.highpass2 && c.highpass2 < .75 / 31 * .9 && (c.highpass1 = 0, c.highpass2 = 0, S.err.println("Warning: highpass filter disabled.  highpass frequency too small\n"));
                        if (0 < c.highpass2) { r = -1; for (e = 0; 31 >= e; e++)h = e / 31, h <= c.highpass1 && (w = Math.max(w, e)), c.highpass1 < h && h < c.highpass2 && (r = Math.max(r, e)); c.highpass1 = w / 31; c.highpass2 = -1 == r ? (w + .75) / 31 : (r + .75) / 31 } for (e = 0; 32 > e; e++)h = e / 31, w = c.highpass2 > c.highpass1 ? K((c.highpass2 - h) / (c.highpass2 - c.highpass1 + 1E-20)) : 1, h = c.lowpass2 > c.lowpass1 ? K((h - c.lowpass1) / (c.lowpass2 - c.lowpass1 + 1E-20)) : 1, c.amp_filter[e] = w * h; b.samplerate_index = C(a.out_samplerate, a); if (0 > b.samplerate_index) return a.internal_flags = null, -1; if (a.VBR == J.vbr_off) if (a.free_format) b.bitrate_index =
                            0; else { if (a.brate = u(a.brate, a.version, a.out_samplerate), b.bitrate_index = U(a.brate, a.version, a.out_samplerate), 0 >= b.bitrate_index) return a.internal_flags = null, -1 } else b.bitrate_index = 1; a.analysis && (a.bWriteVbrTag = !1); null != b.pinfo && (a.bWriteVbrTag = !1); q.init_bit_stream_w(b); c = b.samplerate_index + 3 * a.version + 6 * (16E3 > a.out_samplerate ? 1 : 0); for (e = 0; e < f.SBMAX_l + 1; e++)b.scalefac_band.l[e] = t.sfBandIndex[c].l[e]; for (e = 0; e < f.PSFB21 + 1; e++)h = (b.scalefac_band.l[22] - b.scalefac_band.l[21]) / f.PSFB21, h = b.scalefac_band.l[21] +
                                e * h, b.scalefac_band.psfb21[e] = h; b.scalefac_band.psfb21[f.PSFB21] = 576; for (e = 0; e < f.SBMAX_s + 1; e++)b.scalefac_band.s[e] = t.sfBandIndex[c].s[e]; for (e = 0; e < f.PSFB12 + 1; e++)h = (b.scalefac_band.s[13] - b.scalefac_band.s[12]) / f.PSFB12, h = b.scalefac_band.s[12] + e * h, b.scalefac_band.psfb12[e] = h; b.scalefac_band.psfb12[f.PSFB12] = 192; b.sideinfo_len = 1 == a.version ? 1 == b.channels_out ? 21 : 36 : 1 == b.channels_out ? 13 : 21; a.error_protection && (b.sideinfo_len += 2); c = a.internal_flags; a.frameNum = 0; a.write_id3tag_automatic && z.id3tag_write_v2(a);
                        c.bitrate_stereoMode_Hist = Ua([16, 5]); c.bitrate_blockType_Hist = Ua([16, 6]); c.PeakSample = 0; a.bWriteVbrTag && n.InitVbrTag(a); b.Class_ID = 4294479419; for (c = 0; 19 > c; c++)b.nsPsy.pefirbuf[c] = 700 * b.mode_gr * b.channels_out; -1 == a.ATHtype && (a.ATHtype = 4); switch (a.VBR) {
                            case J.vbr_mt: a.VBR = J.vbr_mtrh; case J.vbr_mtrh: null == a.useTemporal && (a.useTemporal = !1); g.apply_preset(a, 500 - 10 * a.VBR_q, 0); 0 > a.quality && (a.quality = LAME_DEFAULT_QUALITY); 5 > a.quality && (a.quality = 0); 5 < a.quality && (a.quality = 5); b.PSY.mask_adjust = a.maskingadjust;
                                b.PSY.mask_adjust_short = a.maskingadjust_short; b.sfb21_extra = a.experimentalY ? !1 : 44E3 < a.out_samplerate; b.iteration_loop = new VBRNewIterationLoop(D); break; case J.vbr_rh: g.apply_preset(a, 500 - 10 * a.VBR_q, 0); b.PSY.mask_adjust = a.maskingadjust; b.PSY.mask_adjust_short = a.maskingadjust_short; b.sfb21_extra = a.experimentalY ? !1 : 44E3 < a.out_samplerate; 6 < a.quality && (a.quality = 6); 0 > a.quality && (a.quality = LAME_DEFAULT_QUALITY); b.iteration_loop = new VBROldIterationLoop(D); break; default: b.sfb21_extra = !1, 0 > a.quality && (a.quality =
                                    LAME_DEFAULT_QUALITY), c = a.VBR, c == J.vbr_off && (a.VBR_mean_bitrate_kbps = a.brate), g.apply_preset(a, a.VBR_mean_bitrate_kbps, 0), a.VBR = c, b.PSY.mask_adjust = a.maskingadjust, b.PSY.mask_adjust_short = a.maskingadjust_short, b.iteration_loop = c == J.vbr_off ? new Bc(D) : new ABRIterationLoop(D)
                        }if (a.VBR != J.vbr_off) {
                            b.VBR_min_bitrate = 1; b.VBR_max_bitrate = 14; 16E3 > a.out_samplerate && (b.VBR_max_bitrate = 8); if (0 != a.VBR_min_bitrate_kbps && (a.VBR_min_bitrate_kbps = u(a.VBR_min_bitrate_kbps, a.version, a.out_samplerate), b.VBR_min_bitrate =
                                U(a.VBR_min_bitrate_kbps, a.version, a.out_samplerate), 0 > b.VBR_min_bitrate) || 0 != a.VBR_max_bitrate_kbps && (a.VBR_max_bitrate_kbps = u(a.VBR_max_bitrate_kbps, a.version, a.out_samplerate), b.VBR_max_bitrate = U(a.VBR_max_bitrate_kbps, a.version, a.out_samplerate), 0 > b.VBR_max_bitrate)) return -1; a.VBR_min_bitrate_kbps = v.bitrate_table[a.version][b.VBR_min_bitrate]; a.VBR_max_bitrate_kbps = v.bitrate_table[a.version][b.VBR_max_bitrate]; a.VBR_mean_bitrate_kbps = Math.min(v.bitrate_table[a.version][b.VBR_max_bitrate], a.VBR_mean_bitrate_kbps);
                            a.VBR_mean_bitrate_kbps = Math.max(v.bitrate_table[a.version][b.VBR_min_bitrate], a.VBR_mean_bitrate_kbps)
                        } a.tune && (b.PSY.mask_adjust += a.tune_value_a, b.PSY.mask_adjust_short += a.tune_value_a); c = a.internal_flags; switch (a.quality) {
                            default: case 9: c.psymodel = 0; c.noise_shaping = 0; c.noise_shaping_amp = 0; c.noise_shaping_stop = 0; c.use_best_huffman = 0; c.full_outer_loop = 0; break; case 8: a.quality = 7; case 7: c.psymodel = 1; c.noise_shaping = 0; c.noise_shaping_amp = 0; c.noise_shaping_stop = 0; c.use_best_huffman = 0; c.full_outer_loop =
                                0; break; case 6: c.psymodel = 1; 0 == c.noise_shaping && (c.noise_shaping = 1); c.noise_shaping_amp = 0; c.noise_shaping_stop = 0; -1 == c.subblock_gain && (c.subblock_gain = 1); c.use_best_huffman = 0; c.full_outer_loop = 0; break; case 5: c.psymodel = 1; 0 == c.noise_shaping && (c.noise_shaping = 1); c.noise_shaping_amp = 0; c.noise_shaping_stop = 0; -1 == c.subblock_gain && (c.subblock_gain = 1); c.use_best_huffman = 0; c.full_outer_loop = 0; break; case 4: c.psymodel = 1; 0 == c.noise_shaping && (c.noise_shaping = 1); c.noise_shaping_amp = 0; c.noise_shaping_stop = 0; -1 ==
                                    c.subblock_gain && (c.subblock_gain = 1); c.use_best_huffman = 1; c.full_outer_loop = 0; break; case 3: c.psymodel = 1; 0 == c.noise_shaping && (c.noise_shaping = 1); c.noise_shaping_amp = 1; c.noise_shaping_stop = 1; -1 == c.subblock_gain && (c.subblock_gain = 1); c.use_best_huffman = 1; c.full_outer_loop = 0; break; case 2: c.psymodel = 1; 0 == c.noise_shaping && (c.noise_shaping = 1); 0 == c.substep_shaping && (c.substep_shaping = 2); c.noise_shaping_amp = 1; c.noise_shaping_stop = 1; -1 == c.subblock_gain && (c.subblock_gain = 1); c.use_best_huffman = 1; c.full_outer_loop =
                                        0; break; case 1: c.psymodel = 1; 0 == c.noise_shaping && (c.noise_shaping = 1); 0 == c.substep_shaping && (c.substep_shaping = 2); c.noise_shaping_amp = 2; c.noise_shaping_stop = 1; -1 == c.subblock_gain && (c.subblock_gain = 1); c.use_best_huffman = 1; c.full_outer_loop = 0; break; case 0: c.psymodel = 1, 0 == c.noise_shaping && (c.noise_shaping = 1), 0 == c.substep_shaping && (c.substep_shaping = 2), c.noise_shaping_amp = 2, c.noise_shaping_stop = 1, -1 == c.subblock_gain && (c.subblock_gain = 1), c.use_best_huffman = 1, c.full_outer_loop = 0
                        }b.ATH.useAdjust = 0 > a.athaa_type ?
                            3 : a.athaa_type; b.ATH.aaSensitivityP = Math.pow(10, a.athaa_sensitivity / -10); null == a.short_blocks && (a.short_blocks = pa.short_block_allowed); a.short_blocks != pa.short_block_allowed || a.mode != ka.JOINT_STEREO && a.mode != ka.STEREO || (a.short_blocks = pa.short_block_coupled); 0 > a.quant_comp && (a.quant_comp = 1); 0 > a.quant_comp_short && (a.quant_comp_short = 0); 0 > a.msfix && (a.msfix = 0); a.exp_nspsytune |= 1; 0 > a.internal_flags.nsPsy.attackthre && (a.internal_flags.nsPsy.attackthre = $b.NSATTACKTHRE); 0 > a.internal_flags.nsPsy.attackthre_s &&
                                (a.internal_flags.nsPsy.attackthre_s = $b.NSATTACKTHRE_S); 0 > a.scale && (a.scale = 1); 0 > a.ATHtype && (a.ATHtype = 4); 0 > a.ATHcurve && (a.ATHcurve = 4); 0 > a.athaa_loudapprox && (a.athaa_loudapprox = 2); 0 > a.interChRatio && (a.interChRatio = 0); null == a.useTemporal && (a.useTemporal = !0); b.slot_lag = b.frac_SpF = 0; a.VBR == J.vbr_off && (b.slot_lag = b.frac_SpF = 72E3 * (a.version + 1) * a.brate % a.out_samplerate | 0); t.iteration_init(a); m.psymodel_init(a); return 0
                    }; this.lame_encode_flush = function (a, b, d, e) {
                        var g = a.internal_flags, h = fc([2, 1152]), k = 0,
                        l = g.mf_samples_to_encode - f.POSTDELAY, m = c(a); if (1 > g.mf_samples_to_encode) return 0; var n = 0; a.in_samplerate != a.out_samplerate && (l += 16 * a.out_samplerate / a.in_samplerate); var p = a.framesize - l % a.framesize; 576 > p && (p += a.framesize); a.encoder_padding = p; for (p = (l + p) / a.framesize; 0 < p && 0 <= k;) { var r = m - g.mf_size, l = a.frameNum, r = r * a.in_samplerate, r = r / a.out_samplerate; 1152 < r && (r = 1152); 1 > r && (r = 1); k = e - n; 0 == e && (k = 0); k = this.lame_encode_buffer(a, h[0], h[1], r, b, d, k); d += k; n += k; p -= l != a.frameNum ? 1 : 0 } g.mf_samples_to_encode = 0; if (0 >
                            k) return k; k = e - n; 0 == e && (k = 0); q.flush_bitstream(a); k = q.copy_buffer(g, b, d, k, 1); if (0 > k) return k; d += k; n += k; k = e - n; 0 == e && (k = 0); if (a.write_id3tag_automatic) { z.id3tag_write_v1(a); k = q.copy_buffer(g, b, d, k, 0); if (0 > k) return k; n += k } return n
                    }; this.lame_encode_buffer = function (a, b, c, d, e, f, g) {
                        var h = a.internal_flags, k = [null, null]; if (4294479419 != h.Class_ID) return -3; if (0 == d) return 0; if (null == h.in_buffer_0 || h.in_buffer_nsamples < d) h.in_buffer_0 = G(d), h.in_buffer_1 = G(d), h.in_buffer_nsamples = d; k[0] = h.in_buffer_0; k[1] = h.in_buffer_1;
                        for (var l = 0; l < d; l++)k[0][l] = b[l], 1 < h.channels_in && (k[1][l] = c[l]); return w(a, k[0], k[1], d, e, f, g)
                    }
            } function Kc() { this.setModules = function (f, k) { } } function Lc() { this.setModules = function (f, k, r) { } } function Mc() { } function Nc() { this.setModules = function (f, k) { } } function xa() { this.sampleRate = this.channels = this.dataLen = this.dataOffset = 0 } function zb(f) { return f.charCodeAt(0) << 24 | f.charCodeAt(1) << 16 | f.charCodeAt(2) << 8 | f.charCodeAt(3) } var qa = {
                fill: function (f, k, r, v) {
                    if (2 == arguments.length) for (var x = 0; x < f.length; x++)f[x] =
                        arguments[1]; else for (x = k; x < r; x++)f[x] = v
                }
            }, S = { arraycopy: function (f, k, r, v, C) { for (C = k + C; k < C;)r[v++] = f[k++] } }, Z = { SQRT2: 1.4142135623730951, FAST_LOG10: function (f) { return Math.log10(f) }, FAST_LOG10_X: function (f, k) { return Math.log10(f) * k } }; pa.short_block_allowed = new pa(0); pa.short_block_coupled = new pa(1); pa.short_block_dispensed = new pa(2); pa.short_block_forced = new pa(3); var sb = { MAX_VALUE: 3.4028235E38 }; J.vbr_off = new J(0); J.vbr_mt = new J(1); J.vbr_rh = new J(2); J.vbr_abr = new J(3); J.vbr_mtrh = new J(4); J.vbr_default =
                J.vbr_mtrh; ka.STEREO = new ka(0); ka.JOINT_STEREO = new ka(1); ka.DUAL_CHANNEL = new ka(2); ka.MONO = new ka(3); ka.NOT_SET = new ka(4); ca.STEPS_per_dB = 100; ca.MAX_dB = 120; ca.GAIN_NOT_ENOUGH_SAMPLES = -24601; ca.GAIN_ANALYSIS_ERROR = 0; ca.GAIN_ANALYSIS_OK = 1; ca.INIT_GAIN_ANALYSIS_ERROR = 0; ca.INIT_GAIN_ANALYSIS_OK = 1; ca.YULE_ORDER = 10; ca.MAX_ORDER = ca.YULE_ORDER; ca.MAX_SAMP_FREQ = 48E3; ca.RMS_WINDOW_TIME_NUMERATOR = 1; ca.RMS_WINDOW_TIME_DENOMINATOR = 20; ca.MAX_SAMPLES_PER_WINDOW = ca.MAX_SAMP_FREQ * ca.RMS_WINDOW_TIME_NUMERATOR / ca.RMS_WINDOW_TIME_DENOMINATOR +
                    1; gb.NUMTOCENTRIES = 100; gb.MAXFRAMESIZE = 2880; da.EQ = function (f, k) { return Math.abs(f) > Math.abs(k) ? Math.abs(f - k) <= 1E-6 * Math.abs(f) : Math.abs(f - k) <= 1E-6 * Math.abs(k) }; da.NEQ = function (f, k) { return !da.EQ(f, k) }; var v = {
                        t1HB: [1, 1, 1, 0], t2HB: [1, 2, 1, 3, 1, 1, 3, 2, 0], t3HB: [3, 2, 1, 1, 1, 1, 3, 2, 0], t5HB: [1, 2, 6, 5, 3, 1, 4, 4, 7, 5, 7, 1, 6, 1, 1, 0], t6HB: [7, 3, 5, 1, 6, 2, 3, 2, 5, 4, 4, 1, 3, 3, 2, 0], t7HB: [1, 2, 10, 19, 16, 10, 3, 3, 7, 10, 5, 3, 11, 4, 13, 17, 8, 4, 12, 11, 18, 15, 11, 2, 7, 6, 9, 14, 3, 1, 6, 4, 5, 3, 2, 0], t8HB: [3, 4, 6, 18, 12, 5, 5, 1, 2, 16, 9, 3, 7, 3, 5, 14, 7, 3, 19, 17, 15, 13,
                            10, 4, 13, 5, 8, 11, 5, 1, 12, 4, 4, 1, 1, 0], t9HB: [7, 5, 9, 14, 15, 7, 6, 4, 5, 5, 6, 7, 7, 6, 8, 8, 8, 5, 15, 6, 9, 10, 5, 1, 11, 7, 9, 6, 4, 1, 14, 4, 6, 2, 6, 0], t10HB: [1, 2, 10, 23, 35, 30, 12, 17, 3, 3, 8, 12, 18, 21, 12, 7, 11, 9, 15, 21, 32, 40, 19, 6, 14, 13, 22, 34, 46, 23, 18, 7, 20, 19, 33, 47, 27, 22, 9, 3, 31, 22, 41, 26, 21, 20, 5, 3, 14, 13, 10, 11, 16, 6, 5, 1, 9, 8, 7, 8, 4, 4, 2, 0], t11HB: [3, 4, 10, 24, 34, 33, 21, 15, 5, 3, 4, 10, 32, 17, 11, 10, 11, 7, 13, 18, 30, 31, 20, 5, 25, 11, 19, 59, 27, 18, 12, 5, 35, 33, 31, 58, 30, 16, 7, 5, 28, 26, 32, 19, 17, 15, 8, 14, 14, 12, 9, 13, 14, 9, 4, 1, 11, 4, 6, 6, 6, 3, 2, 0], t12HB: [9, 6, 16, 33, 41, 39, 38, 26,
                                7, 5, 6, 9, 23, 16, 26, 11, 17, 7, 11, 14, 21, 30, 10, 7, 17, 10, 15, 12, 18, 28, 14, 5, 32, 13, 22, 19, 18, 16, 9, 5, 40, 17, 31, 29, 17, 13, 4, 2, 27, 12, 11, 15, 10, 7, 4, 1, 27, 12, 8, 12, 6, 3, 1, 0], t13HB: [1, 5, 14, 21, 34, 51, 46, 71, 42, 52, 68, 52, 67, 44, 43, 19, 3, 4, 12, 19, 31, 26, 44, 33, 31, 24, 32, 24, 31, 35, 22, 14, 15, 13, 23, 36, 59, 49, 77, 65, 29, 40, 30, 40, 27, 33, 42, 16, 22, 20, 37, 61, 56, 79, 73, 64, 43, 76, 56, 37, 26, 31, 25, 14, 35, 16, 60, 57, 97, 75, 114, 91, 54, 73, 55, 41, 48, 53, 23, 24, 58, 27, 50, 96, 76, 70, 93, 84, 77, 58, 79, 29, 74, 49, 41, 17, 47, 45, 78, 74, 115, 94, 90, 79, 69, 83, 71, 50, 59, 38, 36, 15, 72, 34, 56, 95,
                                    92, 85, 91, 90, 86, 73, 77, 65, 51, 44, 43, 42, 43, 20, 30, 44, 55, 78, 72, 87, 78, 61, 46, 54, 37, 30, 20, 16, 53, 25, 41, 37, 44, 59, 54, 81, 66, 76, 57, 54, 37, 18, 39, 11, 35, 33, 31, 57, 42, 82, 72, 80, 47, 58, 55, 21, 22, 26, 38, 22, 53, 25, 23, 38, 70, 60, 51, 36, 55, 26, 34, 23, 27, 14, 9, 7, 34, 32, 28, 39, 49, 75, 30, 52, 48, 40, 52, 28, 18, 17, 9, 5, 45, 21, 34, 64, 56, 50, 49, 45, 31, 19, 12, 15, 10, 7, 6, 3, 48, 23, 20, 39, 36, 35, 53, 21, 16, 23, 13, 10, 6, 1, 4, 2, 16, 15, 17, 27, 25, 20, 29, 11, 17, 12, 16, 8, 1, 1, 0, 1], t15HB: [7, 12, 18, 53, 47, 76, 124, 108, 89, 123, 108, 119, 107, 81, 122, 63, 13, 5, 16, 27, 46, 36, 61, 51, 42, 70, 52, 83,
                                        65, 41, 59, 36, 19, 17, 15, 24, 41, 34, 59, 48, 40, 64, 50, 78, 62, 80, 56, 33, 29, 28, 25, 43, 39, 63, 55, 93, 76, 59, 93, 72, 54, 75, 50, 29, 52, 22, 42, 40, 67, 57, 95, 79, 72, 57, 89, 69, 49, 66, 46, 27, 77, 37, 35, 66, 58, 52, 91, 74, 62, 48, 79, 63, 90, 62, 40, 38, 125, 32, 60, 56, 50, 92, 78, 65, 55, 87, 71, 51, 73, 51, 70, 30, 109, 53, 49, 94, 88, 75, 66, 122, 91, 73, 56, 42, 64, 44, 21, 25, 90, 43, 41, 77, 73, 63, 56, 92, 77, 66, 47, 67, 48, 53, 36, 20, 71, 34, 67, 60, 58, 49, 88, 76, 67, 106, 71, 54, 38, 39, 23, 15, 109, 53, 51, 47, 90, 82, 58, 57, 48, 72, 57, 41, 23, 27, 62, 9, 86, 42, 40, 37, 70, 64, 52, 43, 70, 55, 42, 25, 29, 18, 11, 11, 118, 68,
                                        30, 55, 50, 46, 74, 65, 49, 39, 24, 16, 22, 13, 14, 7, 91, 44, 39, 38, 34, 63, 52, 45, 31, 52, 28, 19, 14, 8, 9, 3, 123, 60, 58, 53, 47, 43, 32, 22, 37, 24, 17, 12, 15, 10, 2, 1, 71, 37, 34, 30, 28, 20, 17, 26, 21, 16, 10, 6, 8, 6, 2, 0], t16HB: [1, 5, 14, 44, 74, 63, 110, 93, 172, 149, 138, 242, 225, 195, 376, 17, 3, 4, 12, 20, 35, 62, 53, 47, 83, 75, 68, 119, 201, 107, 207, 9, 15, 13, 23, 38, 67, 58, 103, 90, 161, 72, 127, 117, 110, 209, 206, 16, 45, 21, 39, 69, 64, 114, 99, 87, 158, 140, 252, 212, 199, 387, 365, 26, 75, 36, 68, 65, 115, 101, 179, 164, 155, 264, 246, 226, 395, 382, 362, 9, 66, 30, 59, 56, 102, 185, 173, 265, 142, 253, 232, 400, 388,
                                            378, 445, 16, 111, 54, 52, 100, 184, 178, 160, 133, 257, 244, 228, 217, 385, 366, 715, 10, 98, 48, 91, 88, 165, 157, 148, 261, 248, 407, 397, 372, 380, 889, 884, 8, 85, 84, 81, 159, 156, 143, 260, 249, 427, 401, 392, 383, 727, 713, 708, 7, 154, 76, 73, 141, 131, 256, 245, 426, 406, 394, 384, 735, 359, 710, 352, 11, 139, 129, 67, 125, 247, 233, 229, 219, 393, 743, 737, 720, 885, 882, 439, 4, 243, 120, 118, 115, 227, 223, 396, 746, 742, 736, 721, 712, 706, 223, 436, 6, 202, 224, 222, 218, 216, 389, 386, 381, 364, 888, 443, 707, 440, 437, 1728, 4, 747, 211, 210, 208, 370, 379, 734, 723, 714, 1735, 883, 877, 876, 3459, 865, 2, 377,
                                            369, 102, 187, 726, 722, 358, 711, 709, 866, 1734, 871, 3458, 870, 434, 0, 12, 10, 7, 11, 10, 17, 11, 9, 13, 12, 10, 7, 5, 3, 1, 3], t24HB: [15, 13, 46, 80, 146, 262, 248, 434, 426, 669, 653, 649, 621, 517, 1032, 88, 14, 12, 21, 38, 71, 130, 122, 216, 209, 198, 327, 345, 319, 297, 279, 42, 47, 22, 41, 74, 68, 128, 120, 221, 207, 194, 182, 340, 315, 295, 541, 18, 81, 39, 75, 70, 134, 125, 116, 220, 204, 190, 178, 325, 311, 293, 271, 16, 147, 72, 69, 135, 127, 118, 112, 210, 200, 188, 352, 323, 306, 285, 540, 14, 263, 66, 129, 126, 119, 114, 214, 202, 192, 180, 341, 317, 301, 281, 262, 12, 249, 123, 121, 117, 113, 215, 206, 195, 185,
                                                347, 330, 308, 291, 272, 520, 10, 435, 115, 111, 109, 211, 203, 196, 187, 353, 332, 313, 298, 283, 531, 381, 17, 427, 212, 208, 205, 201, 193, 186, 177, 169, 320, 303, 286, 268, 514, 377, 16, 335, 199, 197, 191, 189, 181, 174, 333, 321, 305, 289, 275, 521, 379, 371, 11, 668, 184, 183, 179, 175, 344, 331, 314, 304, 290, 277, 530, 383, 373, 366, 10, 652, 346, 171, 168, 164, 318, 309, 299, 287, 276, 263, 513, 375, 368, 362, 6, 648, 322, 316, 312, 307, 302, 292, 284, 269, 261, 512, 376, 370, 364, 359, 4, 620, 300, 296, 294, 288, 282, 273, 266, 515, 380, 374, 369, 365, 361, 357, 2, 1033, 280, 278, 274, 267, 264, 259, 382, 378,
                                                372, 367, 363, 360, 358, 356, 0, 43, 20, 19, 17, 15, 13, 11, 9, 7, 6, 4, 7, 5, 3, 1, 3], t32HB: [1, 10, 8, 20, 12, 20, 16, 32, 14, 12, 24, 0, 28, 16, 24, 16], t33HB: [15, 28, 26, 48, 22, 40, 36, 64, 14, 24, 20, 32, 12, 16, 8, 0], t1l: [1, 4, 3, 5], t2l: [1, 4, 7, 4, 5, 7, 6, 7, 8], t3l: [2, 3, 7, 4, 4, 7, 6, 7, 8], t5l: [1, 4, 7, 8, 4, 5, 8, 9, 7, 8, 9, 10, 8, 8, 9, 10], t6l: [3, 4, 6, 8, 4, 4, 6, 7, 5, 6, 7, 8, 7, 7, 8, 9], t7l: [1, 4, 7, 9, 9, 10, 4, 6, 8, 9, 9, 10, 7, 7, 9, 10, 10, 11, 8, 9, 10, 11, 11, 11, 8, 9, 10, 11, 11, 12, 9, 10, 11, 12, 12, 12], t8l: [2, 4, 7, 9, 9, 10, 4, 4, 6, 10, 10, 10, 7, 6, 8, 10, 10, 11, 9, 10, 10, 11, 11, 12, 9, 9, 10, 11, 12, 12, 10, 10, 11, 11,
                                                    13, 13], t9l: [3, 4, 6, 7, 9, 10, 4, 5, 6, 7, 8, 10, 5, 6, 7, 8, 9, 10, 7, 7, 8, 9, 9, 10, 8, 8, 9, 9, 10, 11, 9, 9, 10, 10, 11, 11], t10l: [1, 4, 7, 9, 10, 10, 10, 11, 4, 6, 8, 9, 10, 11, 10, 10, 7, 8, 9, 10, 11, 12, 11, 11, 8, 9, 10, 11, 12, 12, 11, 12, 9, 10, 11, 12, 12, 12, 12, 12, 10, 11, 12, 12, 13, 13, 12, 13, 9, 10, 11, 12, 12, 12, 13, 13, 10, 10, 11, 12, 12, 13, 13, 13], t11l: [2, 4, 6, 8, 9, 10, 9, 10, 4, 5, 6, 8, 10, 10, 9, 10, 6, 7, 8, 9, 10, 11, 10, 10, 8, 8, 9, 11, 10, 12, 10, 11, 9, 10, 10, 11, 11, 12, 11, 12, 9, 10, 11, 12, 12, 13, 12, 13, 9, 9, 9, 10, 11, 12, 12, 12, 9, 9, 10, 11, 12, 12, 12, 12], t12l: [4, 4, 6, 8, 9, 10, 10, 10, 4, 5, 6, 7, 9, 9, 10, 10, 6, 6, 7,
                                                        8, 9, 10, 9, 10, 7, 7, 8, 8, 9, 10, 10, 10, 8, 8, 9, 9, 10, 10, 10, 11, 9, 9, 10, 10, 10, 11, 10, 11, 9, 9, 9, 10, 10, 11, 11, 12, 10, 10, 10, 11, 11, 11, 11, 12], t13l: [1, 5, 7, 8, 9, 10, 10, 11, 10, 11, 12, 12, 13, 13, 14, 14, 4, 6, 8, 9, 10, 10, 11, 11, 11, 11, 12, 12, 13, 14, 14, 14, 7, 8, 9, 10, 11, 11, 12, 12, 11, 12, 12, 13, 13, 14, 15, 15, 8, 9, 10, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 15, 15, 9, 9, 11, 11, 12, 12, 13, 13, 12, 13, 13, 14, 14, 15, 15, 16, 10, 10, 11, 12, 12, 12, 13, 13, 13, 13, 14, 13, 15, 15, 16, 16, 10, 11, 12, 12, 13, 13, 13, 13, 13, 14, 14, 14, 15, 15, 16, 16, 11, 11, 12, 13, 13, 13, 14, 14, 14, 14, 15, 15, 15, 16, 18, 18, 10, 10, 11,
                                                            12, 12, 13, 13, 14, 14, 14, 14, 15, 15, 16, 17, 17, 11, 11, 12, 12, 13, 13, 13, 15, 14, 15, 15, 16, 16, 16, 18, 17, 11, 12, 12, 13, 13, 14, 14, 15, 14, 15, 16, 15, 16, 17, 18, 19, 12, 12, 12, 13, 14, 14, 14, 14, 15, 15, 15, 16, 17, 17, 17, 18, 12, 13, 13, 14, 14, 15, 14, 15, 16, 16, 17, 17, 17, 18, 18, 18, 13, 13, 14, 15, 15, 15, 16, 16, 16, 16, 16, 17, 18, 17, 18, 18, 14, 14, 14, 15, 15, 15, 17, 16, 16, 19, 17, 17, 17, 19, 18, 18, 13, 14, 15, 16, 16, 16, 17, 16, 17, 17, 18, 18, 21, 20, 21, 18], t15l: [3, 5, 6, 8, 8, 9, 10, 10, 10, 11, 11, 12, 12, 12, 13, 14, 5, 5, 7, 8, 9, 9, 10, 10, 10, 11, 11, 12, 12, 12, 13, 13, 6, 7, 7, 8, 9, 9, 10, 10, 10, 11, 11, 12, 12, 13,
                                                                13, 13, 7, 8, 8, 9, 9, 10, 10, 11, 11, 11, 12, 12, 12, 13, 13, 13, 8, 8, 9, 9, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 13, 13, 9, 9, 9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 13, 13, 13, 14, 10, 9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 13, 14, 14, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 14, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 14, 14, 14, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 13, 14, 15, 14, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 13, 14, 14, 14, 15, 12, 12, 11, 12, 12, 12, 13, 13, 13, 13, 13, 13, 14, 14, 15, 15, 12, 12, 12, 12, 12, 13, 13, 13, 13, 14,
                                                                14, 14, 14, 14, 15, 15, 13, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 14, 15, 13, 13, 13, 13, 13, 13, 13, 14, 14, 14, 14, 14, 15, 15, 15, 15], t16_5l: [1, 5, 7, 9, 10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 14, 11, 4, 6, 8, 9, 10, 11, 11, 11, 12, 12, 12, 13, 14, 13, 14, 11, 7, 8, 9, 10, 11, 11, 12, 12, 13, 12, 13, 13, 13, 14, 14, 12, 9, 9, 10, 11, 11, 12, 12, 12, 13, 13, 14, 14, 14, 15, 15, 13, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 12, 10, 10, 11, 11, 12, 13, 13, 14, 13, 14, 14, 15, 15, 15, 16, 13, 11, 11, 11, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 16, 13, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 17, 17, 13, 11, 12, 12,
                                                                    13, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 13, 12, 12, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 15, 16, 15, 14, 12, 13, 12, 13, 14, 14, 14, 14, 15, 16, 16, 16, 17, 17, 16, 13, 13, 13, 13, 13, 14, 14, 15, 16, 16, 16, 16, 16, 16, 15, 16, 14, 13, 14, 14, 14, 14, 15, 15, 15, 15, 17, 16, 16, 16, 16, 18, 14, 15, 14, 14, 14, 15, 15, 16, 16, 16, 18, 17, 17, 17, 19, 17, 14, 14, 15, 13, 14, 16, 16, 15, 16, 16, 17, 18, 17, 19, 17, 16, 14, 11, 11, 11, 12, 12, 13, 13, 13, 14, 14, 14, 14, 14, 14, 14, 12], t16l: [1, 5, 7, 9, 10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 14, 10, 4, 6, 8, 9, 10, 11, 11, 11, 12, 12, 12, 13, 14, 13, 14, 10, 7, 8, 9, 10, 11, 11, 12, 12, 13, 12, 13, 13,
                                                                        13, 14, 14, 11, 9, 9, 10, 11, 11, 12, 12, 12, 13, 13, 14, 14, 14, 15, 15, 12, 10, 10, 11, 11, 12, 12, 13, 13, 13, 14, 14, 14, 15, 15, 15, 11, 10, 10, 11, 11, 12, 13, 13, 14, 13, 14, 14, 15, 15, 15, 16, 12, 11, 11, 11, 12, 13, 13, 13, 13, 14, 14, 14, 14, 15, 15, 16, 12, 11, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 17, 17, 12, 11, 12, 12, 13, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 12, 12, 12, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 15, 16, 15, 13, 12, 13, 12, 13, 14, 14, 14, 14, 15, 16, 16, 16, 17, 17, 16, 12, 13, 13, 13, 13, 14, 14, 15, 16, 16, 16, 16, 16, 16, 15, 16, 13, 13, 14, 14, 14, 14, 15, 15, 15, 15, 17, 16, 16, 16, 16, 18, 13, 15, 14, 14, 14,
                                                                        15, 15, 16, 16, 16, 18, 17, 17, 17, 19, 17, 13, 14, 15, 13, 14, 16, 16, 15, 16, 16, 17, 18, 17, 19, 17, 16, 13, 10, 10, 10, 11, 11, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 10], t24l: [4, 5, 7, 8, 9, 10, 10, 11, 11, 12, 12, 12, 12, 12, 13, 10, 5, 6, 7, 8, 9, 10, 10, 11, 11, 11, 12, 12, 12, 12, 12, 10, 7, 7, 8, 9, 9, 10, 10, 11, 11, 11, 11, 12, 12, 12, 13, 9, 8, 8, 9, 9, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 9, 9, 9, 9, 10, 10, 10, 10, 11, 11, 11, 12, 12, 12, 12, 13, 9, 10, 9, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 9, 10, 10, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 9, 11, 10, 10, 10, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 10, 11, 11,
                                                                            11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 13, 13, 10, 11, 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 13, 13, 13, 10, 12, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 10, 12, 12, 11, 11, 11, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 10, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 10, 12, 12, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 10, 13, 12, 12, 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 10, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 6], t32l: [1, 5, 5, 7, 5, 8, 7, 9, 5, 7, 7, 9, 7, 9, 9, 10], t33l: [4, 5, 5, 6, 5, 6, 6, 7, 5, 6, 6, 7, 6, 7, 7, 8]
                    }; v.ht = [new ba(0, 0, null, null), new ba(2, 0, v.t1HB, v.t1l), new ba(3,
                        0, v.t2HB, v.t2l), new ba(3, 0, v.t3HB, v.t3l), new ba(0, 0, null, null), new ba(4, 0, v.t5HB, v.t5l), new ba(4, 0, v.t6HB, v.t6l), new ba(6, 0, v.t7HB, v.t7l), new ba(6, 0, v.t8HB, v.t8l), new ba(6, 0, v.t9HB, v.t9l), new ba(8, 0, v.t10HB, v.t10l), new ba(8, 0, v.t11HB, v.t11l), new ba(8, 0, v.t12HB, v.t12l), new ba(16, 0, v.t13HB, v.t13l), new ba(0, 0, null, v.t16_5l), new ba(16, 0, v.t15HB, v.t15l), new ba(1, 1, v.t16HB, v.t16l), new ba(2, 3, v.t16HB, v.t16l), new ba(3, 7, v.t16HB, v.t16l), new ba(4, 15, v.t16HB, v.t16l), new ba(6, 63, v.t16HB, v.t16l), new ba(8, 255,
                            v.t16HB, v.t16l), new ba(10, 1023, v.t16HB, v.t16l), new ba(13, 8191, v.t16HB, v.t16l), new ba(4, 15, v.t24HB, v.t24l), new ba(5, 31, v.t24HB, v.t24l), new ba(6, 63, v.t24HB, v.t24l), new ba(7, 127, v.t24HB, v.t24l), new ba(8, 255, v.t24HB, v.t24l), new ba(9, 511, v.t24HB, v.t24l), new ba(11, 2047, v.t24HB, v.t24l), new ba(13, 8191, v.t24HB, v.t24l), new ba(0, 0, v.t32HB, v.t32l), new ba(0, 0, v.t33HB, v.t33l)]; v.largetbl = [65540, 327685, 458759, 589832, 655369, 655370, 720906, 720907, 786443, 786444, 786444, 851980, 851980, 851980, 917517, 655370, 262149, 393222,
                                524295, 589832, 655369, 720906, 720906, 720907, 786443, 786443, 786444, 851980, 917516, 851980, 917516, 655370, 458759, 524295, 589832, 655369, 720905, 720906, 786442, 786443, 851979, 786443, 851979, 851980, 851980, 917516, 917517, 720905, 589832, 589832, 655369, 720905, 720906, 786442, 786442, 786443, 851979, 851979, 917515, 917516, 917516, 983052, 983052, 786441, 655369, 655369, 720905, 720906, 786442, 786442, 851978, 851979, 851979, 917515, 917516, 917516, 983052, 983052, 983053, 720905, 655370, 655369, 720906, 720906, 786442, 851978, 851979, 917515, 851979, 917515,
                                917516, 983052, 983052, 983052, 1048588, 786441, 720906, 720906, 720906, 786442, 851978, 851979, 851979, 851979, 917515, 917516, 917516, 917516, 983052, 983052, 1048589, 786441, 720907, 720906, 786442, 786442, 851979, 851979, 851979, 917515, 917516, 983052, 983052, 983052, 983052, 1114125, 1114125, 786442, 720907, 786443, 786443, 851979, 851979, 851979, 917515, 917515, 983051, 983052, 983052, 983052, 1048588, 1048589, 1048589, 786442, 786443, 786443, 786443, 851979, 851979, 917515, 917515, 983052, 983052, 983052, 983052, 1048588, 983053, 1048589, 983053, 851978, 786444,
                                851979, 786443, 851979, 917515, 917516, 917516, 917516, 983052, 1048588, 1048588, 1048589, 1114125, 1114125, 1048589, 786442, 851980, 851980, 851979, 851979, 917515, 917516, 983052, 1048588, 1048588, 1048588, 1048588, 1048589, 1048589, 983053, 1048589, 851978, 851980, 917516, 917516, 917516, 917516, 983052, 983052, 983052, 983052, 1114124, 1048589, 1048589, 1048589, 1048589, 1179661, 851978, 983052, 917516, 917516, 917516, 983052, 983052, 1048588, 1048588, 1048589, 1179661, 1114125, 1114125, 1114125, 1245197, 1114125, 851978, 917517, 983052, 851980, 917516, 1048588,
                                1048588, 983052, 1048589, 1048589, 1114125, 1179661, 1114125, 1245197, 1114125, 1048589, 851978, 655369, 655369, 655369, 720905, 720905, 786441, 786441, 786441, 851977, 851977, 851977, 851978, 851978, 851978, 851978, 655366]; v.table23 = [65538, 262147, 458759, 262148, 327684, 458759, 393222, 458759, 524296]; v.table56 = [65539, 262148, 458758, 524296, 262148, 327684, 524294, 589831, 458757, 524294, 589831, 655368, 524295, 524295, 589832, 655369]; v.bitrate_table = [[0, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160, -1], [0, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160,
                                    192, 224, 256, 320, -1], [0, 8, 16, 24, 32, 40, 48, 56, 64, -1, -1, -1, -1, -1, -1, -1]]; v.samplerate_table = [[22050, 24E3, 16E3, -1], [44100, 48E3, 32E3, -1], [11025, 12E3, 8E3, -1]]; v.scfsi_band = [0, 6, 11, 16, 21]; Y.Q_MAX = 257; Y.Q_MAX2 = 116; Y.LARGE_BITS = 1E5; Y.IXMAX_VAL = 8206; var ra = {}; ra.SFBMAX = 3 * f.SBMAX_s; f.ENCDELAY = 576; f.POSTDELAY = 1152; f.MDCTDELAY = 48; f.FFTOFFSET = 224 + f.MDCTDELAY; f.DECDELAY = 528; f.SBLIMIT = 32; f.CBANDS = 64; f.SBPSY_l = 21; f.SBPSY_s = 12; f.SBMAX_l = 22; f.SBMAX_s = 13; f.PSFB21 = 6; f.PSFB12 = 6; f.BLKSIZE = 1024; f.HBLKSIZE = f.BLKSIZE / 2 + 1; f.BLKSIZE_s =
                                        256; f.HBLKSIZE_s = f.BLKSIZE_s / 2 + 1; f.NORM_TYPE = 0; f.START_TYPE = 1; f.SHORT_TYPE = 2; f.STOP_TYPE = 3; f.MPG_MD_LR_LR = 0; f.MPG_MD_LR_I = 1; f.MPG_MD_MS_LR = 2; f.MPG_MD_MS_I = 3; f.fircoef = [-.1039435, -.1892065, -.0432472 * 5, -.155915, 3.898045E-17, .0467745 * 5, .50455, .756825, .187098 * 5]; ia.MFSIZE = 3456 + f.ENCDELAY - f.MDCTDELAY; ia.MAX_HEADER_BUF = 256; ia.MAX_BITS_PER_CHANNEL = 4095; ia.MAX_BITS_PER_GRANULE = 7680; ia.BPC = 320; xa.RIFF = zb("RIFF"); xa.WAVE = zb("WAVE"); xa.fmt_ = zb("fmt "); xa.data = zb("data"); xa.readHeader = function (f) {
                                            var k = new xa,
                                            r = f.getUint32(0, !1); if (xa.RIFF == r && (f.getUint32(4, !0), xa.WAVE == f.getUint32(8, !1) && xa.fmt_ == f.getUint32(12, !1))) { var v = f.getUint32(16, !0), x = 20; switch (v) { case 16: case 18: k.channels = f.getUint16(x + 2, !0); k.sampleRate = f.getUint32(x + 4, !0); break; default: throw "extended fmt chunk not implemented"; }for (var x = x + v, v = xa.data, u = 0; v != r;) { r = f.getUint32(x, !1); u = f.getUint32(x + 4, !0); if (v == r) break; x += u + 8 } k.dataLen = u; k.dataOffset = x + 8; return k }
                                        }; ra.SFBMAX = 3 * f.SBMAX_s; lamejs.Mp3Encoder = function (f, k, r) {
                                            3 != arguments.length &&
                                            (console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"), f = 1, k = 44100, r = 128); var v = new W, x = new Kc, u = new ca, G = new da, d = new wc, c = new Y, w = new Ec, a = new gb, b = new ic, B = new Nc, e = new xc, l = new fb, q = new Lc, g = new Mc; v.setModules(u, G, d, c, w, a, b, B, g); G.setModules(u, g, b, a); B.setModules(G, b); d.setModules(v); w.setModules(G, e, c, l); c.setModules(l, e, v.enc.psy); e.setModules(G); l.setModules(c); a.setModules(v, G, b); x.setModules(q, g); q.setModules(b, B, d); var t = v.lame_init(); t.num_channels = f; t.in_samplerate =
                                                k; t.brate = r; t.mode = ka.STEREO; t.quality = 3; t.bWriteVbrTag = !1; t.disable_reservoir = !0; t.write_id3tag_automatic = !1; v.lame_init_params(t); var D = 1152, m = 0 | 1.25 * D + 7200, n = new Int8Array(m); this.encodeBuffer = function (a, b) { 1 == f && (b = a); a.length > D && (D = a.length, m = 0 | 1.25 * D + 7200, n = new Int8Array(m)); a = v.lame_encode_buffer(t, a, b, a.length, n, 0, m); return new Int8Array(n.subarray(0, a)) }; this.flush = function () { var a = v.lame_encode_flush(t, n, 0, m); return new Int8Array(n.subarray(0, a)) }
                                        }; lamejs.WavHeader = xa
        } lamejs();
    </script>
    <script>
        /*! jQuery v3.4.1 | (c) JS Foundation and other contributors | jquery.org/license */
        !function (e, t) { "use strict"; "object" == typeof module && "object" == typeof module.exports ? module.exports = e.document ? t(e, !0) : function (e) { if (!e.document) throw new Error("jQuery requires a window with a document"); return t(e) } : t(e) }("undefined" != typeof window ? window : this, function (C, e) { "use strict"; var t = [], E = C.document, r = Object.getPrototypeOf, s = t.slice, g = t.concat, u = t.push, i = t.indexOf, n = {}, o = n.toString, v = n.hasOwnProperty, a = v.toString, l = a.call(Object), y = {}, m = function (e) { return "function" == typeof e && "number" != typeof e.nodeType }, x = function (e) { return null != e && e === e.window }, c = { type: !0, src: !0, nonce: !0, noModule: !0 }; function b(e, t, n) { var r, i, o = (n = n || E).createElement("script"); if (o.text = e, t) for (r in c) (i = t[r] || t.getAttribute && t.getAttribute(r)) && o.setAttribute(r, i); n.head.appendChild(o).parentNode.removeChild(o) } function w(e) { return null == e ? e + "" : "object" == typeof e || "function" == typeof e ? n[o.call(e)] || "object" : typeof e } var f = "3.4.1", k = function (e, t) { return new k.fn.init(e, t) }, p = /^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g; function d(e) { var t = !!e && "length" in e && e.length, n = w(e); return !m(e) && !x(e) && ("array" === n || 0 === t || "number" == typeof t && 0 < t && t - 1 in e) } k.fn = k.prototype = { jquery: f, constructor: k, length: 0, toArray: function () { return s.call(this) }, get: function (e) { return null == e ? s.call(this) : e < 0 ? this[e + this.length] : this[e] }, pushStack: function (e) { var t = k.merge(this.constructor(), e); return t.prevObject = this, t }, each: function (e) { return k.each(this, e) }, map: function (n) { return this.pushStack(k.map(this, function (e, t) { return n.call(e, t, e) })) }, slice: function () { return this.pushStack(s.apply(this, arguments)) }, first: function () { return this.eq(0) }, last: function () { return this.eq(-1) }, eq: function (e) { var t = this.length, n = +e + (e < 0 ? t : 0); return this.pushStack(0 <= n && n < t ? [this[n]] : []) }, end: function () { return this.prevObject || this.constructor() }, push: u, sort: t.sort, splice: t.splice }, k.extend = k.fn.extend = function () { var e, t, n, r, i, o, a = arguments[0] || {}, s = 1, u = arguments.length, l = !1; for ("boolean" == typeof a && (l = a, a = arguments[s] || {}, s++), "object" == typeof a || m(a) || (a = {}), s === u && (a = this, s--); s < u; s++)if (null != (e = arguments[s])) for (t in e) r = e[t], "__proto__" !== t && a !== r && (l && r && (k.isPlainObject(r) || (i = Array.isArray(r))) ? (n = a[t], o = i && !Array.isArray(n) ? [] : i || k.isPlainObject(n) ? n : {}, i = !1, a[t] = k.extend(l, o, r)) : void 0 !== r && (a[t] = r)); return a }, k.extend({ expando: "jQuery" + (f + Math.random()).replace(/\D/g, ""), isReady: !0, error: function (e) { throw new Error(e) }, noop: function () { }, isPlainObject: function (e) { var t, n; return !(!e || "[object Object]" !== o.call(e)) && (!(t = r(e)) || "function" == typeof (n = v.call(t, "constructor") && t.constructor) && a.call(n) === l) }, isEmptyObject: function (e) { var t; for (t in e) return !1; return !0 }, globalEval: function (e, t) { b(e, { nonce: t && t.nonce }) }, each: function (e, t) { var n, r = 0; if (d(e)) { for (n = e.length; r < n; r++)if (!1 === t.call(e[r], r, e[r])) break } else for (r in e) if (!1 === t.call(e[r], r, e[r])) break; return e }, trim: function (e) { return null == e ? "" : (e + "").replace(p, "") }, makeArray: function (e, t) { var n = t || []; return null != e && (d(Object(e)) ? k.merge(n, "string" == typeof e ? [e] : e) : u.call(n, e)), n }, inArray: function (e, t, n) { return null == t ? -1 : i.call(t, e, n) }, merge: function (e, t) { for (var n = +t.length, r = 0, i = e.length; r < n; r++)e[i++] = t[r]; return e.length = i, e }, grep: function (e, t, n) { for (var r = [], i = 0, o = e.length, a = !n; i < o; i++)!t(e[i], i) !== a && r.push(e[i]); return r }, map: function (e, t, n) { var r, i, o = 0, a = []; if (d(e)) for (r = e.length; o < r; o++)null != (i = t(e[o], o, n)) && a.push(i); else for (o in e) null != (i = t(e[o], o, n)) && a.push(i); return g.apply([], a) }, guid: 1, support: y }), "function" == typeof Symbol && (k.fn[Symbol.iterator] = t[Symbol.iterator]), k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "), function (e, t) { n["[object " + t + "]"] = t.toLowerCase() }); var h = function (n) { var e, d, b, o, i, h, f, g, w, u, l, T, C, a, E, v, s, c, y, k = "sizzle" + 1 * new Date, m = n.document, S = 0, r = 0, p = ue(), x = ue(), N = ue(), A = ue(), D = function (e, t) { return e === t && (l = !0), 0 }, j = {}.hasOwnProperty, t = [], q = t.pop, L = t.push, H = t.push, O = t.slice, P = function (e, t) { for (var n = 0, r = e.length; n < r; n++)if (e[n] === t) return n; return -1 }, R = "checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped", M = "[\\x20\\t\\r\\n\\f]", I = "(?:\\\\.|[\\w-]|[^\0-\\xa0])+", W = "\\[" + M + "*(" + I + ")(?:" + M + "*([*^$|!~]?=)" + M + "*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|(" + I + "))|)" + M + "*\\]", $ = ":(" + I + ")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|" + W + ")*)|.*)\\)|)", F = new RegExp(M + "+", "g"), B = new RegExp("^" + M + "+|((?:^|[^\\\\])(?:\\\\.)*)" + M + "+$", "g"), _ = new RegExp("^" + M + "*," + M + "*"), z = new RegExp("^" + M + "*([>+~]|" + M + ")" + M + "*"), U = new RegExp(M + "|>"), X = new RegExp($), V = new RegExp("^" + I + "$"), G = { ID: new RegExp("^#(" + I + ")"), CLASS: new RegExp("^\\.(" + I + ")"), TAG: new RegExp("^(" + I + "|[*])"), ATTR: new RegExp("^" + W), PSEUDO: new RegExp("^" + $), CHILD: new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\(" + M + "*(even|odd|(([+-]|)(\\d*)n|)" + M + "*(?:([+-]|)" + M + "*(\\d+)|))" + M + "*\\)|)", "i"), bool: new RegExp("^(?:" + R + ")$", "i"), needsContext: new RegExp("^" + M + "*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\(" + M + "*((?:-\\d)?\\d*)" + M + "*\\)|)(?=[^-]|$)", "i") }, Y = /HTML$/i, Q = /^(?:input|select|textarea|button)$/i, J = /^h\d$/i, K = /^[^{]+\{\s*\[native \w/, Z = /^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/, ee = /[+~]/, te = new RegExp("\\\\([\\da-f]{1,6}" + M + "?|(" + M + ")|.)", "ig"), ne = function (e, t, n) { var r = "0x" + t - 65536; return r != r || n ? t : r < 0 ? String.fromCharCode(r + 65536) : String.fromCharCode(r >> 10 | 55296, 1023 & r | 56320) }, re = /([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g, ie = function (e, t) { return t ? "\0" === e ? "\ufffd" : e.slice(0, -1) + "\\" + e.charCodeAt(e.length - 1).toString(16) + " " : "\\" + e }, oe = function () { T() }, ae = be(function (e) { return !0 === e.disabled && "fieldset" === e.nodeName.toLowerCase() }, { dir: "parentNode", next: "legend" }); try { H.apply(t = O.call(m.childNodes), m.childNodes), t[m.childNodes.length].nodeType } catch (e) { H = { apply: t.length ? function (e, t) { L.apply(e, O.call(t)) } : function (e, t) { var n = e.length, r = 0; while (e[n++] = t[r++]); e.length = n - 1 } } } function se(t, e, n, r) { var i, o, a, s, u, l, c, f = e && e.ownerDocument, p = e ? e.nodeType : 9; if (n = n || [], "string" != typeof t || !t || 1 !== p && 9 !== p && 11 !== p) return n; if (!r && ((e ? e.ownerDocument || e : m) !== C && T(e), e = e || C, E)) { if (11 !== p && (u = Z.exec(t))) if (i = u[1]) { if (9 === p) { if (!(a = e.getElementById(i))) return n; if (a.id === i) return n.push(a), n } else if (f && (a = f.getElementById(i)) && y(e, a) && a.id === i) return n.push(a), n } else { if (u[2]) return H.apply(n, e.getElementsByTagName(t)), n; if ((i = u[3]) && d.getElementsByClassName && e.getElementsByClassName) return H.apply(n, e.getElementsByClassName(i)), n } if (d.qsa && !A[t + " "] && (!v || !v.test(t)) && (1 !== p || "object" !== e.nodeName.toLowerCase())) { if (c = t, f = e, 1 === p && U.test(t)) { (s = e.getAttribute("id")) ? s = s.replace(re, ie) : e.setAttribute("id", s = k), o = (l = h(t)).length; while (o--) l[o] = "#" + s + " " + xe(l[o]); c = l.join(","), f = ee.test(t) && ye(e.parentNode) || e } try { return H.apply(n, f.querySelectorAll(c)), n } catch (e) { A(t, !0) } finally { s === k && e.removeAttribute("id") } } } return g(t.replace(B, "$1"), e, n, r) } function ue() { var r = []; return function e(t, n) { return r.push(t + " ") > b.cacheLength && delete e[r.shift()], e[t + " "] = n } } function le(e) { return e[k] = !0, e } function ce(e) { var t = C.createElement("fieldset"); try { return !!e(t) } catch (e) { return !1 } finally { t.parentNode && t.parentNode.removeChild(t), t = null } } function fe(e, t) { var n = e.split("|"), r = n.length; while (r--) b.attrHandle[n[r]] = t } function pe(e, t) { var n = t && e, r = n && 1 === e.nodeType && 1 === t.nodeType && e.sourceIndex - t.sourceIndex; if (r) return r; if (n) while (n = n.nextSibling) if (n === t) return -1; return e ? 1 : -1 } function de(t) { return function (e) { return "input" === e.nodeName.toLowerCase() && e.type === t } } function he(n) { return function (e) { var t = e.nodeName.toLowerCase(); return ("input" === t || "button" === t) && e.type === n } } function ge(t) { return function (e) { return "form" in e ? e.parentNode && !1 === e.disabled ? "label" in e ? "label" in e.parentNode ? e.parentNode.disabled === t : e.disabled === t : e.isDisabled === t || e.isDisabled !== !t && ae(e) === t : e.disabled === t : "label" in e && e.disabled === t } } function ve(a) { return le(function (o) { return o = +o, le(function (e, t) { var n, r = a([], e.length, o), i = r.length; while (i--) e[n = r[i]] && (e[n] = !(t[n] = e[n])) }) }) } function ye(e) { return e && "undefined" != typeof e.getElementsByTagName && e } for (e in d = se.support = {}, i = se.isXML = function (e) { var t = e.namespaceURI, n = (e.ownerDocument || e).documentElement; return !Y.test(t || n && n.nodeName || "HTML") }, T = se.setDocument = function (e) { var t, n, r = e ? e.ownerDocument || e : m; return r !== C && 9 === r.nodeType && r.documentElement && (a = (C = r).documentElement, E = !i(C), m !== C && (n = C.defaultView) && n.top !== n && (n.addEventListener ? n.addEventListener("unload", oe, !1) : n.attachEvent && n.attachEvent("onunload", oe)), d.attributes = ce(function (e) { return e.className = "i", !e.getAttribute("className") }), d.getElementsByTagName = ce(function (e) { return e.appendChild(C.createComment("")), !e.getElementsByTagName("*").length }), d.getElementsByClassName = K.test(C.getElementsByClassName), d.getById = ce(function (e) { return a.appendChild(e).id = k, !C.getElementsByName || !C.getElementsByName(k).length }), d.getById ? (b.filter.ID = function (e) { var t = e.replace(te, ne); return function (e) { return e.getAttribute("id") === t } }, b.find.ID = function (e, t) { if ("undefined" != typeof t.getElementById && E) { var n = t.getElementById(e); return n ? [n] : [] } }) : (b.filter.ID = function (e) { var n = e.replace(te, ne); return function (e) { var t = "undefined" != typeof e.getAttributeNode && e.getAttributeNode("id"); return t && t.value === n } }, b.find.ID = function (e, t) { if ("undefined" != typeof t.getElementById && E) { var n, r, i, o = t.getElementById(e); if (o) { if ((n = o.getAttributeNode("id")) && n.value === e) return [o]; i = t.getElementsByName(e), r = 0; while (o = i[r++]) if ((n = o.getAttributeNode("id")) && n.value === e) return [o] } return [] } }), b.find.TAG = d.getElementsByTagName ? function (e, t) { return "undefined" != typeof t.getElementsByTagName ? t.getElementsByTagName(e) : d.qsa ? t.querySelectorAll(e) : void 0 } : function (e, t) { var n, r = [], i = 0, o = t.getElementsByTagName(e); if ("*" === e) { while (n = o[i++]) 1 === n.nodeType && r.push(n); return r } return o }, b.find.CLASS = d.getElementsByClassName && function (e, t) { if ("undefined" != typeof t.getElementsByClassName && E) return t.getElementsByClassName(e) }, s = [], v = [], (d.qsa = K.test(C.querySelectorAll)) && (ce(function (e) { a.appendChild(e).innerHTML = "<a id='" + k + "'></a><select id='" + k + "-\r\\' msallowcapture=''><option selected=''></option></select>", e.querySelectorAll("[msallowcapture^='']").length && v.push("[*^$]=" + M + "*(?:''|\"\")"), e.querySelectorAll("[selected]").length || v.push("\\[" + M + "*(?:value|" + R + ")"), e.querySelectorAll("[id~=" + k + "-]").length || v.push("~="), e.querySelectorAll(":checked").length || v.push(":checked"), e.querySelectorAll("a#" + k + "+*").length || v.push(".#.+[+~]") }), ce(function (e) { e.innerHTML = "<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>"; var t = C.createElement("input"); t.setAttribute("type", "hidden"), e.appendChild(t).setAttribute("name", "D"), e.querySelectorAll("[name=d]").length && v.push("name" + M + "*[*^$|!~]?="), 2 !== e.querySelectorAll(":enabled").length && v.push(":enabled", ":disabled"), a.appendChild(e).disabled = !0, 2 !== e.querySelectorAll(":disabled").length && v.push(":enabled", ":disabled"), e.querySelectorAll("*,:x"), v.push(",.*:") })), (d.matchesSelector = K.test(c = a.matches || a.webkitMatchesSelector || a.mozMatchesSelector || a.oMatchesSelector || a.msMatchesSelector)) && ce(function (e) { d.disconnectedMatch = c.call(e, "*"), c.call(e, "[s!='']:x"), s.push("!=", $) }), v = v.length && new RegExp(v.join("|")), s = s.length && new RegExp(s.join("|")), t = K.test(a.compareDocumentPosition), y = t || K.test(a.contains) ? function (e, t) { var n = 9 === e.nodeType ? e.documentElement : e, r = t && t.parentNode; return e === r || !(!r || 1 !== r.nodeType || !(n.contains ? n.contains(r) : e.compareDocumentPosition && 16 & e.compareDocumentPosition(r))) } : function (e, t) { if (t) while (t = t.parentNode) if (t === e) return !0; return !1 }, D = t ? function (e, t) { if (e === t) return l = !0, 0; var n = !e.compareDocumentPosition - !t.compareDocumentPosition; return n || (1 & (n = (e.ownerDocument || e) === (t.ownerDocument || t) ? e.compareDocumentPosition(t) : 1) || !d.sortDetached && t.compareDocumentPosition(e) === n ? e === C || e.ownerDocument === m && y(m, e) ? -1 : t === C || t.ownerDocument === m && y(m, t) ? 1 : u ? P(u, e) - P(u, t) : 0 : 4 & n ? -1 : 1) } : function (e, t) { if (e === t) return l = !0, 0; var n, r = 0, i = e.parentNode, o = t.parentNode, a = [e], s = [t]; if (!i || !o) return e === C ? -1 : t === C ? 1 : i ? -1 : o ? 1 : u ? P(u, e) - P(u, t) : 0; if (i === o) return pe(e, t); n = e; while (n = n.parentNode) a.unshift(n); n = t; while (n = n.parentNode) s.unshift(n); while (a[r] === s[r]) r++; return r ? pe(a[r], s[r]) : a[r] === m ? -1 : s[r] === m ? 1 : 0 }), C }, se.matches = function (e, t) { return se(e, null, null, t) }, se.matchesSelector = function (e, t) { if ((e.ownerDocument || e) !== C && T(e), d.matchesSelector && E && !A[t + " "] && (!s || !s.test(t)) && (!v || !v.test(t))) try { var n = c.call(e, t); if (n || d.disconnectedMatch || e.document && 11 !== e.document.nodeType) return n } catch (e) { A(t, !0) } return 0 < se(t, C, null, [e]).length }, se.contains = function (e, t) { return (e.ownerDocument || e) !== C && T(e), y(e, t) }, se.attr = function (e, t) { (e.ownerDocument || e) !== C && T(e); var n = b.attrHandle[t.toLowerCase()], r = n && j.call(b.attrHandle, t.toLowerCase()) ? n(e, t, !E) : void 0; return void 0 !== r ? r : d.attributes || !E ? e.getAttribute(t) : (r = e.getAttributeNode(t)) && r.specified ? r.value : null }, se.escape = function (e) { return (e + "").replace(re, ie) }, se.error = function (e) { throw new Error("Syntax error, unrecognized expression: " + e) }, se.uniqueSort = function (e) { var t, n = [], r = 0, i = 0; if (l = !d.detectDuplicates, u = !d.sortStable && e.slice(0), e.sort(D), l) { while (t = e[i++]) t === e[i] && (r = n.push(i)); while (r--) e.splice(n[r], 1) } return u = null, e }, o = se.getText = function (e) { var t, n = "", r = 0, i = e.nodeType; if (i) { if (1 === i || 9 === i || 11 === i) { if ("string" == typeof e.textContent) return e.textContent; for (e = e.firstChild; e; e = e.nextSibling)n += o(e) } else if (3 === i || 4 === i) return e.nodeValue } else while (t = e[r++]) n += o(t); return n }, (b = se.selectors = { cacheLength: 50, createPseudo: le, match: G, attrHandle: {}, find: {}, relative: { ">": { dir: "parentNode", first: !0 }, " ": { dir: "parentNode" }, "+": { dir: "previousSibling", first: !0 }, "~": { dir: "previousSibling" } }, preFilter: { ATTR: function (e) { return e[1] = e[1].replace(te, ne), e[3] = (e[3] || e[4] || e[5] || "").replace(te, ne), "~=" === e[2] && (e[3] = " " + e[3] + " "), e.slice(0, 4) }, CHILD: function (e) { return e[1] = e[1].toLowerCase(), "nth" === e[1].slice(0, 3) ? (e[3] || se.error(e[0]), e[4] = +(e[4] ? e[5] + (e[6] || 1) : 2 * ("even" === e[3] || "odd" === e[3])), e[5] = +(e[7] + e[8] || "odd" === e[3])) : e[3] && se.error(e[0]), e }, PSEUDO: function (e) { var t, n = !e[6] && e[2]; return G.CHILD.test(e[0]) ? null : (e[3] ? e[2] = e[4] || e[5] || "" : n && X.test(n) && (t = h(n, !0)) && (t = n.indexOf(")", n.length - t) - n.length) && (e[0] = e[0].slice(0, t), e[2] = n.slice(0, t)), e.slice(0, 3)) } }, filter: { TAG: function (e) { var t = e.replace(te, ne).toLowerCase(); return "*" === e ? function () { return !0 } : function (e) { return e.nodeName && e.nodeName.toLowerCase() === t } }, CLASS: function (e) { var t = p[e + " "]; return t || (t = new RegExp("(^|" + M + ")" + e + "(" + M + "|$)")) && p(e, function (e) { return t.test("string" == typeof e.className && e.className || "undefined" != typeof e.getAttribute && e.getAttribute("class") || "") }) }, ATTR: function (n, r, i) { return function (e) { var t = se.attr(e, n); return null == t ? "!=" === r : !r || (t += "", "=" === r ? t === i : "!=" === r ? t !== i : "^=" === r ? i && 0 === t.indexOf(i) : "*=" === r ? i && -1 < t.indexOf(i) : "$=" === r ? i && t.slice(-i.length) === i : "~=" === r ? -1 < (" " + t.replace(F, " ") + " ").indexOf(i) : "|=" === r && (t === i || t.slice(0, i.length + 1) === i + "-")) } }, CHILD: function (h, e, t, g, v) { var y = "nth" !== h.slice(0, 3), m = "last" !== h.slice(-4), x = "of-type" === e; return 1 === g && 0 === v ? function (e) { return !!e.parentNode } : function (e, t, n) { var r, i, o, a, s, u, l = y !== m ? "nextSibling" : "previousSibling", c = e.parentNode, f = x && e.nodeName.toLowerCase(), p = !n && !x, d = !1; if (c) { if (y) { while (l) { a = e; while (a = a[l]) if (x ? a.nodeName.toLowerCase() === f : 1 === a.nodeType) return !1; u = l = "only" === h && !u && "nextSibling" } return !0 } if (u = [m ? c.firstChild : c.lastChild], m && p) { d = (s = (r = (i = (o = (a = c)[k] || (a[k] = {}))[a.uniqueID] || (o[a.uniqueID] = {}))[h] || [])[0] === S && r[1]) && r[2], a = s && c.childNodes[s]; while (a = ++s && a && a[l] || (d = s = 0) || u.pop()) if (1 === a.nodeType && ++d && a === e) { i[h] = [S, s, d]; break } } else if (p && (d = s = (r = (i = (o = (a = e)[k] || (a[k] = {}))[a.uniqueID] || (o[a.uniqueID] = {}))[h] || [])[0] === S && r[1]), !1 === d) while (a = ++s && a && a[l] || (d = s = 0) || u.pop()) if ((x ? a.nodeName.toLowerCase() === f : 1 === a.nodeType) && ++d && (p && ((i = (o = a[k] || (a[k] = {}))[a.uniqueID] || (o[a.uniqueID] = {}))[h] = [S, d]), a === e)) break; return (d -= v) === g || d % g == 0 && 0 <= d / g } } }, PSEUDO: function (e, o) { var t, a = b.pseudos[e] || b.setFilters[e.toLowerCase()] || se.error("unsupported pseudo: " + e); return a[k] ? a(o) : 1 < a.length ? (t = [e, e, "", o], b.setFilters.hasOwnProperty(e.toLowerCase()) ? le(function (e, t) { var n, r = a(e, o), i = r.length; while (i--) e[n = P(e, r[i])] = !(t[n] = r[i]) }) : function (e) { return a(e, 0, t) }) : a } }, pseudos: { not: le(function (e) { var r = [], i = [], s = f(e.replace(B, "$1")); return s[k] ? le(function (e, t, n, r) { var i, o = s(e, null, r, []), a = e.length; while (a--) (i = o[a]) && (e[a] = !(t[a] = i)) }) : function (e, t, n) { return r[0] = e, s(r, null, n, i), r[0] = null, !i.pop() } }), has: le(function (t) { return function (e) { return 0 < se(t, e).length } }), contains: le(function (t) { return t = t.replace(te, ne), function (e) { return -1 < (e.textContent || o(e)).indexOf(t) } }), lang: le(function (n) { return V.test(n || "") || se.error("unsupported lang: " + n), n = n.replace(te, ne).toLowerCase(), function (e) { var t; do { if (t = E ? e.lang : e.getAttribute("xml:lang") || e.getAttribute("lang")) return (t = t.toLowerCase()) === n || 0 === t.indexOf(n + "-") } while ((e = e.parentNode) && 1 === e.nodeType); return !1 } }), target: function (e) { var t = n.location && n.location.hash; return t && t.slice(1) === e.id }, root: function (e) { return e === a }, focus: function (e) { return e === C.activeElement && (!C.hasFocus || C.hasFocus()) && !!(e.type || e.href || ~e.tabIndex) }, enabled: ge(!1), disabled: ge(!0), checked: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && !!e.checked || "option" === t && !!e.selected }, selected: function (e) { return e.parentNode && e.parentNode.selectedIndex, !0 === e.selected }, empty: function (e) { for (e = e.firstChild; e; e = e.nextSibling)if (e.nodeType < 6) return !1; return !0 }, parent: function (e) { return !b.pseudos.empty(e) }, header: function (e) { return J.test(e.nodeName) }, input: function (e) { return Q.test(e.nodeName) }, button: function (e) { var t = e.nodeName.toLowerCase(); return "input" === t && "button" === e.type || "button" === t }, text: function (e) { var t; return "input" === e.nodeName.toLowerCase() && "text" === e.type && (null == (t = e.getAttribute("type")) || "text" === t.toLowerCase()) }, first: ve(function () { return [0] }), last: ve(function (e, t) { return [t - 1] }), eq: ve(function (e, t, n) { return [n < 0 ? n + t : n] }), even: ve(function (e, t) { for (var n = 0; n < t; n += 2)e.push(n); return e }), odd: ve(function (e, t) { for (var n = 1; n < t; n += 2)e.push(n); return e }), lt: ve(function (e, t, n) { for (var r = n < 0 ? n + t : t < n ? t : n; 0 <= --r;)e.push(r); return e }), gt: ve(function (e, t, n) { for (var r = n < 0 ? n + t : n; ++r < t;)e.push(r); return e }) } }).pseudos.nth = b.pseudos.eq, { radio: !0, checkbox: !0, file: !0, password: !0, image: !0 }) b.pseudos[e] = de(e); for (e in { submit: !0, reset: !0 }) b.pseudos[e] = he(e); function me() { } function xe(e) { for (var t = 0, n = e.length, r = ""; t < n; t++)r += e[t].value; return r } function be(s, e, t) { var u = e.dir, l = e.next, c = l || u, f = t && "parentNode" === c, p = r++; return e.first ? function (e, t, n) { while (e = e[u]) if (1 === e.nodeType || f) return s(e, t, n); return !1 } : function (e, t, n) { var r, i, o, a = [S, p]; if (n) { while (e = e[u]) if ((1 === e.nodeType || f) && s(e, t, n)) return !0 } else while (e = e[u]) if (1 === e.nodeType || f) if (i = (o = e[k] || (e[k] = {}))[e.uniqueID] || (o[e.uniqueID] = {}), l && l === e.nodeName.toLowerCase()) e = e[u] || e; else { if ((r = i[c]) && r[0] === S && r[1] === p) return a[2] = r[2]; if ((i[c] = a)[2] = s(e, t, n)) return !0 } return !1 } } function we(i) { return 1 < i.length ? function (e, t, n) { var r = i.length; while (r--) if (!i[r](e, t, n)) return !1; return !0 } : i[0] } function Te(e, t, n, r, i) { for (var o, a = [], s = 0, u = e.length, l = null != t; s < u; s++)(o = e[s]) && (n && !n(o, r, i) || (a.push(o), l && t.push(s))); return a } function Ce(d, h, g, v, y, e) { return v && !v[k] && (v = Ce(v)), y && !y[k] && (y = Ce(y, e)), le(function (e, t, n, r) { var i, o, a, s = [], u = [], l = t.length, c = e || function (e, t, n) { for (var r = 0, i = t.length; r < i; r++)se(e, t[r], n); return n }(h || "*", n.nodeType ? [n] : n, []), f = !d || !e && h ? c : Te(c, s, d, n, r), p = g ? y || (e ? d : l || v) ? [] : t : f; if (g && g(f, p, n, r), v) { i = Te(p, u), v(i, [], n, r), o = i.length; while (o--) (a = i[o]) && (p[u[o]] = !(f[u[o]] = a)) } if (e) { if (y || d) { if (y) { i = [], o = p.length; while (o--) (a = p[o]) && i.push(f[o] = a); y(null, p = [], i, r) } o = p.length; while (o--) (a = p[o]) && -1 < (i = y ? P(e, a) : s[o]) && (e[i] = !(t[i] = a)) } } else p = Te(p === t ? p.splice(l, p.length) : p), y ? y(null, t, p, r) : H.apply(t, p) }) } function Ee(e) { for (var i, t, n, r = e.length, o = b.relative[e[0].type], a = o || b.relative[" "], s = o ? 1 : 0, u = be(function (e) { return e === i }, a, !0), l = be(function (e) { return -1 < P(i, e) }, a, !0), c = [function (e, t, n) { var r = !o && (n || t !== w) || ((i = t).nodeType ? u(e, t, n) : l(e, t, n)); return i = null, r }]; s < r; s++)if (t = b.relative[e[s].type]) c = [be(we(c), t)]; else { if ((t = b.filter[e[s].type].apply(null, e[s].matches))[k]) { for (n = ++s; n < r; n++)if (b.relative[e[n].type]) break; return Ce(1 < s && we(c), 1 < s && xe(e.slice(0, s - 1).concat({ value: " " === e[s - 2].type ? "*" : "" })).replace(B, "$1"), t, s < n && Ee(e.slice(s, n)), n < r && Ee(e = e.slice(n)), n < r && xe(e)) } c.push(t) } return we(c) } return me.prototype = b.filters = b.pseudos, b.setFilters = new me, h = se.tokenize = function (e, t) { var n, r, i, o, a, s, u, l = x[e + " "]; if (l) return t ? 0 : l.slice(0); a = e, s = [], u = b.preFilter; while (a) { for (o in n && !(r = _.exec(a)) || (r && (a = a.slice(r[0].length) || a), s.push(i = [])), n = !1, (r = z.exec(a)) && (n = r.shift(), i.push({ value: n, type: r[0].replace(B, " ") }), a = a.slice(n.length)), b.filter) !(r = G[o].exec(a)) || u[o] && !(r = u[o](r)) || (n = r.shift(), i.push({ value: n, type: o, matches: r }), a = a.slice(n.length)); if (!n) break } return t ? a.length : a ? se.error(e) : x(e, s).slice(0) }, f = se.compile = function (e, t) { var n, v, y, m, x, r, i = [], o = [], a = N[e + " "]; if (!a) { t || (t = h(e)), n = t.length; while (n--) (a = Ee(t[n]))[k] ? i.push(a) : o.push(a); (a = N(e, (v = o, m = 0 < (y = i).length, x = 0 < v.length, r = function (e, t, n, r, i) { var o, a, s, u = 0, l = "0", c = e && [], f = [], p = w, d = e || x && b.find.TAG("*", i), h = S += null == p ? 1 : Math.random() || .1, g = d.length; for (i && (w = t === C || t || i); l !== g && null != (o = d[l]); l++) { if (x && o) { a = 0, t || o.ownerDocument === C || (T(o), n = !E); while (s = v[a++]) if (s(o, t || C, n)) { r.push(o); break } i && (S = h) } m && ((o = !s && o) && u--, e && c.push(o)) } if (u += l, m && l !== u) { a = 0; while (s = y[a++]) s(c, f, t, n); if (e) { if (0 < u) while (l--) c[l] || f[l] || (f[l] = q.call(r)); f = Te(f) } H.apply(r, f), i && !e && 0 < f.length && 1 < u + y.length && se.uniqueSort(r) } return i && (S = h, w = p), c }, m ? le(r) : r))).selector = e } return a }, g = se.select = function (e, t, n, r) { var i, o, a, s, u, l = "function" == typeof e && e, c = !r && h(e = l.selector || e); if (n = n || [], 1 === c.length) { if (2 < (o = c[0] = c[0].slice(0)).length && "ID" === (a = o[0]).type && 9 === t.nodeType && E && b.relative[o[1].type]) { if (!(t = (b.find.ID(a.matches[0].replace(te, ne), t) || [])[0])) return n; l && (t = t.parentNode), e = e.slice(o.shift().value.length) } i = G.needsContext.test(e) ? 0 : o.length; while (i--) { if (a = o[i], b.relative[s = a.type]) break; if ((u = b.find[s]) && (r = u(a.matches[0].replace(te, ne), ee.test(o[0].type) && ye(t.parentNode) || t))) { if (o.splice(i, 1), !(e = r.length && xe(o))) return H.apply(n, r), n; break } } } return (l || f(e, c))(r, t, !E, n, !t || ee.test(e) && ye(t.parentNode) || t), n }, d.sortStable = k.split("").sort(D).join("") === k, d.detectDuplicates = !!l, T(), d.sortDetached = ce(function (e) { return 1 & e.compareDocumentPosition(C.createElement("fieldset")) }), ce(function (e) { return e.innerHTML = "<a href='#'></a>", "#" === e.firstChild.getAttribute("href") }) || fe("type|href|height|width", function (e, t, n) { if (!n) return e.getAttribute(t, "type" === t.toLowerCase() ? 1 : 2) }), d.attributes && ce(function (e) { return e.innerHTML = "<input/>", e.firstChild.setAttribute("value", ""), "" === e.firstChild.getAttribute("value") }) || fe("value", function (e, t, n) { if (!n && "input" === e.nodeName.toLowerCase()) return e.defaultValue }), ce(function (e) { return null == e.getAttribute("disabled") }) || fe(R, function (e, t, n) { var r; if (!n) return !0 === e[t] ? t.toLowerCase() : (r = e.getAttributeNode(t)) && r.specified ? r.value : null }), se }(C); k.find = h, k.expr = h.selectors, k.expr[":"] = k.expr.pseudos, k.uniqueSort = k.unique = h.uniqueSort, k.text = h.getText, k.isXMLDoc = h.isXML, k.contains = h.contains, k.escapeSelector = h.escape; var T = function (e, t, n) { var r = [], i = void 0 !== n; while ((e = e[t]) && 9 !== e.nodeType) if (1 === e.nodeType) { if (i && k(e).is(n)) break; r.push(e) } return r }, S = function (e, t) { for (var n = []; e; e = e.nextSibling)1 === e.nodeType && e !== t && n.push(e); return n }, N = k.expr.match.needsContext; function A(e, t) { return e.nodeName && e.nodeName.toLowerCase() === t.toLowerCase() } var D = /^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i; function j(e, n, r) { return m(n) ? k.grep(e, function (e, t) { return !!n.call(e, t, e) !== r }) : n.nodeType ? k.grep(e, function (e) { return e === n !== r }) : "string" != typeof n ? k.grep(e, function (e) { return -1 < i.call(n, e) !== r }) : k.filter(n, e, r) } k.filter = function (e, t, n) { var r = t[0]; return n && (e = ":not(" + e + ")"), 1 === t.length && 1 === r.nodeType ? k.find.matchesSelector(r, e) ? [r] : [] : k.find.matches(e, k.grep(t, function (e) { return 1 === e.nodeType })) }, k.fn.extend({ find: function (e) { var t, n, r = this.length, i = this; if ("string" != typeof e) return this.pushStack(k(e).filter(function () { for (t = 0; t < r; t++)if (k.contains(i[t], this)) return !0 })); for (n = this.pushStack([]), t = 0; t < r; t++)k.find(e, i[t], n); return 1 < r ? k.uniqueSort(n) : n }, filter: function (e) { return this.pushStack(j(this, e || [], !1)) }, not: function (e) { return this.pushStack(j(this, e || [], !0)) }, is: function (e) { return !!j(this, "string" == typeof e && N.test(e) ? k(e) : e || [], !1).length } }); var q, L = /^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/; (k.fn.init = function (e, t, n) { var r, i; if (!e) return this; if (n = n || q, "string" == typeof e) { if (!(r = "<" === e[0] && ">" === e[e.length - 1] && 3 <= e.length ? [null, e, null] : L.exec(e)) || !r[1] && t) return !t || t.jquery ? (t || n).find(e) : this.constructor(t).find(e); if (r[1]) { if (t = t instanceof k ? t[0] : t, k.merge(this, k.parseHTML(r[1], t && t.nodeType ? t.ownerDocument || t : E, !0)), D.test(r[1]) && k.isPlainObject(t)) for (r in t) m(this[r]) ? this[r](t[r]) : this.attr(r, t[r]); return this } return (i = E.getElementById(r[2])) && (this[0] = i, this.length = 1), this } return e.nodeType ? (this[0] = e, this.length = 1, this) : m(e) ? void 0 !== n.ready ? n.ready(e) : e(k) : k.makeArray(e, this) }).prototype = k.fn, q = k(E); var H = /^(?:parents|prev(?:Until|All))/, O = { children: !0, contents: !0, next: !0, prev: !0 }; function P(e, t) { while ((e = e[t]) && 1 !== e.nodeType); return e } k.fn.extend({ has: function (e) { var t = k(e, this), n = t.length; return this.filter(function () { for (var e = 0; e < n; e++)if (k.contains(this, t[e])) return !0 }) }, closest: function (e, t) { var n, r = 0, i = this.length, o = [], a = "string" != typeof e && k(e); if (!N.test(e)) for (; r < i; r++)for (n = this[r]; n && n !== t; n = n.parentNode)if (n.nodeType < 11 && (a ? -1 < a.index(n) : 1 === n.nodeType && k.find.matchesSelector(n, e))) { o.push(n); break } return this.pushStack(1 < o.length ? k.uniqueSort(o) : o) }, index: function (e) { return e ? "string" == typeof e ? i.call(k(e), this[0]) : i.call(this, e.jquery ? e[0] : e) : this[0] && this[0].parentNode ? this.first().prevAll().length : -1 }, add: function (e, t) { return this.pushStack(k.uniqueSort(k.merge(this.get(), k(e, t)))) }, addBack: function (e) { return this.add(null == e ? this.prevObject : this.prevObject.filter(e)) } }), k.each({ parent: function (e) { var t = e.parentNode; return t && 11 !== t.nodeType ? t : null }, parents: function (e) { return T(e, "parentNode") }, parentsUntil: function (e, t, n) { return T(e, "parentNode", n) }, next: function (e) { return P(e, "nextSibling") }, prev: function (e) { return P(e, "previousSibling") }, nextAll: function (e) { return T(e, "nextSibling") }, prevAll: function (e) { return T(e, "previousSibling") }, nextUntil: function (e, t, n) { return T(e, "nextSibling", n) }, prevUntil: function (e, t, n) { return T(e, "previousSibling", n) }, siblings: function (e) { return S((e.parentNode || {}).firstChild, e) }, children: function (e) { return S(e.firstChild) }, contents: function (e) { return "undefined" != typeof e.contentDocument ? e.contentDocument : (A(e, "template") && (e = e.content || e), k.merge([], e.childNodes)) } }, function (r, i) { k.fn[r] = function (e, t) { var n = k.map(this, i, e); return "Until" !== r.slice(-5) && (t = e), t && "string" == typeof t && (n = k.filter(t, n)), 1 < this.length && (O[r] || k.uniqueSort(n), H.test(r) && n.reverse()), this.pushStack(n) } }); var R = /[^\x20\t\r\n\f]+/g; function M(e) { return e } function I(e) { throw e } function W(e, t, n, r) { var i; try { e && m(i = e.promise) ? i.call(e).done(t).fail(n) : e && m(i = e.then) ? i.call(e, t, n) : t.apply(void 0, [e].slice(r)) } catch (e) { n.apply(void 0, [e]) } } k.Callbacks = function (r) { var e, n; r = "string" == typeof r ? (e = r, n = {}, k.each(e.match(R) || [], function (e, t) { n[t] = !0 }), n) : k.extend({}, r); var i, t, o, a, s = [], u = [], l = -1, c = function () { for (a = a || r.once, o = i = !0; u.length; l = -1) { t = u.shift(); while (++l < s.length) !1 === s[l].apply(t[0], t[1]) && r.stopOnFalse && (l = s.length, t = !1) } r.memory || (t = !1), i = !1, a && (s = t ? [] : "") }, f = { add: function () { return s && (t && !i && (l = s.length - 1, u.push(t)), function n(e) { k.each(e, function (e, t) { m(t) ? r.unique && f.has(t) || s.push(t) : t && t.length && "string" !== w(t) && n(t) }) }(arguments), t && !i && c()), this }, remove: function () { return k.each(arguments, function (e, t) { var n; while (-1 < (n = k.inArray(t, s, n))) s.splice(n, 1), n <= l && l-- }), this }, has: function (e) { return e ? -1 < k.inArray(e, s) : 0 < s.length }, empty: function () { return s && (s = []), this }, disable: function () { return a = u = [], s = t = "", this }, disabled: function () { return !s }, lock: function () { return a = u = [], t || i || (s = t = ""), this }, locked: function () { return !!a }, fireWith: function (e, t) { return a || (t = [e, (t = t || []).slice ? t.slice() : t], u.push(t), i || c()), this }, fire: function () { return f.fireWith(this, arguments), this }, fired: function () { return !!o } }; return f }, k.extend({ Deferred: function (e) { var o = [["notify", "progress", k.Callbacks("memory"), k.Callbacks("memory"), 2], ["resolve", "done", k.Callbacks("once memory"), k.Callbacks("once memory"), 0, "resolved"], ["reject", "fail", k.Callbacks("once memory"), k.Callbacks("once memory"), 1, "rejected"]], i = "pending", a = { state: function () { return i }, always: function () { return s.done(arguments).fail(arguments), this }, "catch": function (e) { return a.then(null, e) }, pipe: function () { var i = arguments; return k.Deferred(function (r) { k.each(o, function (e, t) { var n = m(i[t[4]]) && i[t[4]]; s[t[1]](function () { var e = n && n.apply(this, arguments); e && m(e.promise) ? e.promise().progress(r.notify).done(r.resolve).fail(r.reject) : r[t[0] + "With"](this, n ? [e] : arguments) }) }), i = null }).promise() }, then: function (t, n, r) { var u = 0; function l(i, o, a, s) { return function () { var n = this, r = arguments, e = function () { var e, t; if (!(i < u)) { if ((e = a.apply(n, r)) === o.promise()) throw new TypeError("Thenable self-resolution"); t = e && ("object" == typeof e || "function" == typeof e) && e.then, m(t) ? s ? t.call(e, l(u, o, M, s), l(u, o, I, s)) : (u++, t.call(e, l(u, o, M, s), l(u, o, I, s), l(u, o, M, o.notifyWith))) : (a !== M && (n = void 0, r = [e]), (s || o.resolveWith)(n, r)) } }, t = s ? e : function () { try { e() } catch (e) { k.Deferred.exceptionHook && k.Deferred.exceptionHook(e, t.stackTrace), u <= i + 1 && (a !== I && (n = void 0, r = [e]), o.rejectWith(n, r)) } }; i ? t() : (k.Deferred.getStackHook && (t.stackTrace = k.Deferred.getStackHook()), C.setTimeout(t)) } } return k.Deferred(function (e) { o[0][3].add(l(0, e, m(r) ? r : M, e.notifyWith)), o[1][3].add(l(0, e, m(t) ? t : M)), o[2][3].add(l(0, e, m(n) ? n : I)) }).promise() }, promise: function (e) { return null != e ? k.extend(e, a) : a } }, s = {}; return k.each(o, function (e, t) { var n = t[2], r = t[5]; a[t[1]] = n.add, r && n.add(function () { i = r }, o[3 - e][2].disable, o[3 - e][3].disable, o[0][2].lock, o[0][3].lock), n.add(t[3].fire), s[t[0]] = function () { return s[t[0] + "With"](this === s ? void 0 : this, arguments), this }, s[t[0] + "With"] = n.fireWith }), a.promise(s), e && e.call(s, s), s }, when: function (e) { var n = arguments.length, t = n, r = Array(t), i = s.call(arguments), o = k.Deferred(), a = function (t) { return function (e) { r[t] = this, i[t] = 1 < arguments.length ? s.call(arguments) : e, --n || o.resolveWith(r, i) } }; if (n <= 1 && (W(e, o.done(a(t)).resolve, o.reject, !n), "pending" === o.state() || m(i[t] && i[t].then))) return o.then(); while (t--) W(i[t], a(t), o.reject); return o.promise() } }); var $ = /^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/; k.Deferred.exceptionHook = function (e, t) { C.console && C.console.warn && e && $.test(e.name) && C.console.warn("jQuery.Deferred exception: " + e.message, e.stack, t) }, k.readyException = function (e) { C.setTimeout(function () { throw e }) }; var F = k.Deferred(); function B() { E.removeEventListener("DOMContentLoaded", B), C.removeEventListener("load", B), k.ready() } k.fn.ready = function (e) { return F.then(e)["catch"](function (e) { k.readyException(e) }), this }, k.extend({ isReady: !1, readyWait: 1, ready: function (e) { (!0 === e ? --k.readyWait : k.isReady) || (k.isReady = !0) !== e && 0 < --k.readyWait || F.resolveWith(E, [k]) } }), k.ready.then = F.then, "complete" === E.readyState || "loading" !== E.readyState && !E.documentElement.doScroll ? C.setTimeout(k.ready) : (E.addEventListener("DOMContentLoaded", B), C.addEventListener("load", B)); var _ = function (e, t, n, r, i, o, a) { var s = 0, u = e.length, l = null == n; if ("object" === w(n)) for (s in i = !0, n) _(e, t, s, n[s], !0, o, a); else if (void 0 !== r && (i = !0, m(r) || (a = !0), l && (a ? (t.call(e, r), t = null) : (l = t, t = function (e, t, n) { return l.call(k(e), n) })), t)) for (; s < u; s++)t(e[s], n, a ? r : r.call(e[s], s, t(e[s], n))); return i ? e : l ? t.call(e) : u ? t(e[0], n) : o }, z = /^-ms-/, U = /-([a-z])/g; function X(e, t) { return t.toUpperCase() } function V(e) { return e.replace(z, "ms-").replace(U, X) } var G = function (e) { return 1 === e.nodeType || 9 === e.nodeType || !+e.nodeType }; function Y() { this.expando = k.expando + Y.uid++ } Y.uid = 1, Y.prototype = { cache: function (e) { var t = e[this.expando]; return t || (t = {}, G(e) && (e.nodeType ? e[this.expando] = t : Object.defineProperty(e, this.expando, { value: t, configurable: !0 }))), t }, set: function (e, t, n) { var r, i = this.cache(e); if ("string" == typeof t) i[V(t)] = n; else for (r in t) i[V(r)] = t[r]; return i }, get: function (e, t) { return void 0 === t ? this.cache(e) : e[this.expando] && e[this.expando][V(t)] }, access: function (e, t, n) { return void 0 === t || t && "string" == typeof t && void 0 === n ? this.get(e, t) : (this.set(e, t, n), void 0 !== n ? n : t) }, remove: function (e, t) { var n, r = e[this.expando]; if (void 0 !== r) { if (void 0 !== t) { n = (t = Array.isArray(t) ? t.map(V) : (t = V(t)) in r ? [t] : t.match(R) || []).length; while (n--) delete r[t[n]] } (void 0 === t || k.isEmptyObject(r)) && (e.nodeType ? e[this.expando] = void 0 : delete e[this.expando]) } }, hasData: function (e) { var t = e[this.expando]; return void 0 !== t && !k.isEmptyObject(t) } }; var Q = new Y, J = new Y, K = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/, Z = /[A-Z]/g; function ee(e, t, n) { var r, i; if (void 0 === n && 1 === e.nodeType) if (r = "data-" + t.replace(Z, "-$&").toLowerCase(), "string" == typeof (n = e.getAttribute(r))) { try { n = "true" === (i = n) || "false" !== i && ("null" === i ? null : i === +i + "" ? +i : K.test(i) ? JSON.parse(i) : i) } catch (e) { } J.set(e, t, n) } else n = void 0; return n } k.extend({ hasData: function (e) { return J.hasData(e) || Q.hasData(e) }, data: function (e, t, n) { return J.access(e, t, n) }, removeData: function (e, t) { J.remove(e, t) }, _data: function (e, t, n) { return Q.access(e, t, n) }, _removeData: function (e, t) { Q.remove(e, t) } }), k.fn.extend({ data: function (n, e) { var t, r, i, o = this[0], a = o && o.attributes; if (void 0 === n) { if (this.length && (i = J.get(o), 1 === o.nodeType && !Q.get(o, "hasDataAttrs"))) { t = a.length; while (t--) a[t] && 0 === (r = a[t].name).indexOf("data-") && (r = V(r.slice(5)), ee(o, r, i[r])); Q.set(o, "hasDataAttrs", !0) } return i } return "object" == typeof n ? this.each(function () { J.set(this, n) }) : _(this, function (e) { var t; if (o && void 0 === e) return void 0 !== (t = J.get(o, n)) ? t : void 0 !== (t = ee(o, n)) ? t : void 0; this.each(function () { J.set(this, n, e) }) }, null, e, 1 < arguments.length, null, !0) }, removeData: function (e) { return this.each(function () { J.remove(this, e) }) } }), k.extend({ queue: function (e, t, n) { var r; if (e) return t = (t || "fx") + "queue", r = Q.get(e, t), n && (!r || Array.isArray(n) ? r = Q.access(e, t, k.makeArray(n)) : r.push(n)), r || [] }, dequeue: function (e, t) { t = t || "fx"; var n = k.queue(e, t), r = n.length, i = n.shift(), o = k._queueHooks(e, t); "inprogress" === i && (i = n.shift(), r--), i && ("fx" === t && n.unshift("inprogress"), delete o.stop, i.call(e, function () { k.dequeue(e, t) }, o)), !r && o && o.empty.fire() }, _queueHooks: function (e, t) { var n = t + "queueHooks"; return Q.get(e, n) || Q.access(e, n, { empty: k.Callbacks("once memory").add(function () { Q.remove(e, [t + "queue", n]) }) }) } }), k.fn.extend({ queue: function (t, n) { var e = 2; return "string" != typeof t && (n = t, t = "fx", e--), arguments.length < e ? k.queue(this[0], t) : void 0 === n ? this : this.each(function () { var e = k.queue(this, t, n); k._queueHooks(this, t), "fx" === t && "inprogress" !== e[0] && k.dequeue(this, t) }) }, dequeue: function (e) { return this.each(function () { k.dequeue(this, e) }) }, clearQueue: function (e) { return this.queue(e || "fx", []) }, promise: function (e, t) { var n, r = 1, i = k.Deferred(), o = this, a = this.length, s = function () { --r || i.resolveWith(o, [o]) }; "string" != typeof e && (t = e, e = void 0), e = e || "fx"; while (a--) (n = Q.get(o[a], e + "queueHooks")) && n.empty && (r++, n.empty.add(s)); return s(), i.promise(t) } }); var te = /[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source, ne = new RegExp("^(?:([+-])=|)(" + te + ")([a-z%]*)$", "i"), re = ["Top", "Right", "Bottom", "Left"], ie = E.documentElement, oe = function (e) { return k.contains(e.ownerDocument, e) }, ae = { composed: !0 }; ie.getRootNode && (oe = function (e) { return k.contains(e.ownerDocument, e) || e.getRootNode(ae) === e.ownerDocument }); var se = function (e, t) { return "none" === (e = t || e).style.display || "" === e.style.display && oe(e) && "none" === k.css(e, "display") }, ue = function (e, t, n, r) { var i, o, a = {}; for (o in t) a[o] = e.style[o], e.style[o] = t[o]; for (o in i = n.apply(e, r || []), t) e.style[o] = a[o]; return i }; function le(e, t, n, r) { var i, o, a = 20, s = r ? function () { return r.cur() } : function () { return k.css(e, t, "") }, u = s(), l = n && n[3] || (k.cssNumber[t] ? "" : "px"), c = e.nodeType && (k.cssNumber[t] || "px" !== l && +u) && ne.exec(k.css(e, t)); if (c && c[3] !== l) { u /= 2, l = l || c[3], c = +u || 1; while (a--) k.style(e, t, c + l), (1 - o) * (1 - (o = s() / u || .5)) <= 0 && (a = 0), c /= o; c *= 2, k.style(e, t, c + l), n = n || [] } return n && (c = +c || +u || 0, i = n[1] ? c + (n[1] + 1) * n[2] : +n[2], r && (r.unit = l, r.start = c, r.end = i)), i } var ce = {}; function fe(e, t) { for (var n, r, i, o, a, s, u, l = [], c = 0, f = e.length; c < f; c++)(r = e[c]).style && (n = r.style.display, t ? ("none" === n && (l[c] = Q.get(r, "display") || null, l[c] || (r.style.display = "")), "" === r.style.display && se(r) && (l[c] = (u = a = o = void 0, a = (i = r).ownerDocument, s = i.nodeName, (u = ce[s]) || (o = a.body.appendChild(a.createElement(s)), u = k.css(o, "display"), o.parentNode.removeChild(o), "none" === u && (u = "block"), ce[s] = u)))) : "none" !== n && (l[c] = "none", Q.set(r, "display", n))); for (c = 0; c < f; c++)null != l[c] && (e[c].style.display = l[c]); return e } k.fn.extend({ show: function () { return fe(this, !0) }, hide: function () { return fe(this) }, toggle: function (e) { return "boolean" == typeof e ? e ? this.show() : this.hide() : this.each(function () { se(this) ? k(this).show() : k(this).hide() }) } }); var pe = /^(?:checkbox|radio)$/i, de = /<([a-z][^\/\0>\x20\t\r\n\f]*)/i, he = /^$|^module$|\/(?:java|ecma)script/i, ge = { option: [1, "<select multiple='multiple'>", "</select>"], thead: [1, "<table>", "</table>"], col: [2, "<table><colgroup>", "</colgroup></table>"], tr: [2, "<table><tbody>", "</tbody></table>"], td: [3, "<table><tbody><tr>", "</tr></tbody></table>"], _default: [0, "", ""] }; function ve(e, t) { var n; return n = "undefined" != typeof e.getElementsByTagName ? e.getElementsByTagName(t || "*") : "undefined" != typeof e.querySelectorAll ? e.querySelectorAll(t || "*") : [], void 0 === t || t && A(e, t) ? k.merge([e], n) : n } function ye(e, t) { for (var n = 0, r = e.length; n < r; n++)Q.set(e[n], "globalEval", !t || Q.get(t[n], "globalEval")) } ge.optgroup = ge.option, ge.tbody = ge.tfoot = ge.colgroup = ge.caption = ge.thead, ge.th = ge.td; var me, xe, be = /<|&#?\w+;/; function we(e, t, n, r, i) { for (var o, a, s, u, l, c, f = t.createDocumentFragment(), p = [], d = 0, h = e.length; d < h; d++)if ((o = e[d]) || 0 === o) if ("object" === w(o)) k.merge(p, o.nodeType ? [o] : o); else if (be.test(o)) { a = a || f.appendChild(t.createElement("div")), s = (de.exec(o) || ["", ""])[1].toLowerCase(), u = ge[s] || ge._default, a.innerHTML = u[1] + k.htmlPrefilter(o) + u[2], c = u[0]; while (c--) a = a.lastChild; k.merge(p, a.childNodes), (a = f.firstChild).textContent = "" } else p.push(t.createTextNode(o)); f.textContent = "", d = 0; while (o = p[d++]) if (r && -1 < k.inArray(o, r)) i && i.push(o); else if (l = oe(o), a = ve(f.appendChild(o), "script"), l && ye(a), n) { c = 0; while (o = a[c++]) he.test(o.type || "") && n.push(o) } return f } me = E.createDocumentFragment().appendChild(E.createElement("div")), (xe = E.createElement("input")).setAttribute("type", "radio"), xe.setAttribute("checked", "checked"), xe.setAttribute("name", "t"), me.appendChild(xe), y.checkClone = me.cloneNode(!0).cloneNode(!0).lastChild.checked, me.innerHTML = "<textarea>x</textarea>", y.noCloneChecked = !!me.cloneNode(!0).lastChild.defaultValue; var Te = /^key/, Ce = /^(?:mouse|pointer|contextmenu|drag|drop)|click/, Ee = /^([^.]*)(?:\.(.+)|)/; function ke() { return !0 } function Se() { return !1 } function Ne(e, t) { return e === function () { try { return E.activeElement } catch (e) { } }() == ("focus" === t) } function Ae(e, t, n, r, i, o) { var a, s; if ("object" == typeof t) { for (s in "string" != typeof n && (r = r || n, n = void 0), t) Ae(e, s, n, r, t[s], o); return e } if (null == r && null == i ? (i = n, r = n = void 0) : null == i && ("string" == typeof n ? (i = r, r = void 0) : (i = r, r = n, n = void 0)), !1 === i) i = Se; else if (!i) return e; return 1 === o && (a = i, (i = function (e) { return k().off(e), a.apply(this, arguments) }).guid = a.guid || (a.guid = k.guid++)), e.each(function () { k.event.add(this, t, i, r, n) }) } function De(e, i, o) { o ? (Q.set(e, i, !1), k.event.add(e, i, { namespace: !1, handler: function (e) { var t, n, r = Q.get(this, i); if (1 & e.isTrigger && this[i]) { if (r.length) (k.event.special[i] || {}).delegateType && e.stopPropagation(); else if (r = s.call(arguments), Q.set(this, i, r), t = o(this, i), this[i](), r !== (n = Q.get(this, i)) || t ? Q.set(this, i, !1) : n = {}, r !== n) return e.stopImmediatePropagation(), e.preventDefault(), n.value } else r.length && (Q.set(this, i, { value: k.event.trigger(k.extend(r[0], k.Event.prototype), r.slice(1), this) }), e.stopImmediatePropagation()) } })) : void 0 === Q.get(e, i) && k.event.add(e, i, ke) } k.event = { global: {}, add: function (t, e, n, r, i) { var o, a, s, u, l, c, f, p, d, h, g, v = Q.get(t); if (v) { n.handler && (n = (o = n).handler, i = o.selector), i && k.find.matchesSelector(ie, i), n.guid || (n.guid = k.guid++), (u = v.events) || (u = v.events = {}), (a = v.handle) || (a = v.handle = function (e) { return "undefined" != typeof k && k.event.triggered !== e.type ? k.event.dispatch.apply(t, arguments) : void 0 }), l = (e = (e || "").match(R) || [""]).length; while (l--) d = g = (s = Ee.exec(e[l]) || [])[1], h = (s[2] || "").split(".").sort(), d && (f = k.event.special[d] || {}, d = (i ? f.delegateType : f.bindType) || d, f = k.event.special[d] || {}, c = k.extend({ type: d, origType: g, data: r, handler: n, guid: n.guid, selector: i, needsContext: i && k.expr.match.needsContext.test(i), namespace: h.join(".") }, o), (p = u[d]) || ((p = u[d] = []).delegateCount = 0, f.setup && !1 !== f.setup.call(t, r, h, a) || t.addEventListener && t.addEventListener(d, a)), f.add && (f.add.call(t, c), c.handler.guid || (c.handler.guid = n.guid)), i ? p.splice(p.delegateCount++, 0, c) : p.push(c), k.event.global[d] = !0) } }, remove: function (e, t, n, r, i) { var o, a, s, u, l, c, f, p, d, h, g, v = Q.hasData(e) && Q.get(e); if (v && (u = v.events)) { l = (t = (t || "").match(R) || [""]).length; while (l--) if (d = g = (s = Ee.exec(t[l]) || [])[1], h = (s[2] || "").split(".").sort(), d) { f = k.event.special[d] || {}, p = u[d = (r ? f.delegateType : f.bindType) || d] || [], s = s[2] && new RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)"), a = o = p.length; while (o--) c = p[o], !i && g !== c.origType || n && n.guid !== c.guid || s && !s.test(c.namespace) || r && r !== c.selector && ("**" !== r || !c.selector) || (p.splice(o, 1), c.selector && p.delegateCount--, f.remove && f.remove.call(e, c)); a && !p.length && (f.teardown && !1 !== f.teardown.call(e, h, v.handle) || k.removeEvent(e, d, v.handle), delete u[d]) } else for (d in u) k.event.remove(e, d + t[l], n, r, !0); k.isEmptyObject(u) && Q.remove(e, "handle events") } }, dispatch: function (e) { var t, n, r, i, o, a, s = k.event.fix(e), u = new Array(arguments.length), l = (Q.get(this, "events") || {})[s.type] || [], c = k.event.special[s.type] || {}; for (u[0] = s, t = 1; t < arguments.length; t++)u[t] = arguments[t]; if (s.delegateTarget = this, !c.preDispatch || !1 !== c.preDispatch.call(this, s)) { a = k.event.handlers.call(this, s, l), t = 0; while ((i = a[t++]) && !s.isPropagationStopped()) { s.currentTarget = i.elem, n = 0; while ((o = i.handlers[n++]) && !s.isImmediatePropagationStopped()) s.rnamespace && !1 !== o.namespace && !s.rnamespace.test(o.namespace) || (s.handleObj = o, s.data = o.data, void 0 !== (r = ((k.event.special[o.origType] || {}).handle || o.handler).apply(i.elem, u)) && !1 === (s.result = r) && (s.preventDefault(), s.stopPropagation())) } return c.postDispatch && c.postDispatch.call(this, s), s.result } }, handlers: function (e, t) { var n, r, i, o, a, s = [], u = t.delegateCount, l = e.target; if (u && l.nodeType && !("click" === e.type && 1 <= e.button)) for (; l !== this; l = l.parentNode || this)if (1 === l.nodeType && ("click" !== e.type || !0 !== l.disabled)) { for (o = [], a = {}, n = 0; n < u; n++)void 0 === a[i = (r = t[n]).selector + " "] && (a[i] = r.needsContext ? -1 < k(i, this).index(l) : k.find(i, this, null, [l]).length), a[i] && o.push(r); o.length && s.push({ elem: l, handlers: o }) } return l = this, u < t.length && s.push({ elem: l, handlers: t.slice(u) }), s }, addProp: function (t, e) { Object.defineProperty(k.Event.prototype, t, { enumerable: !0, configurable: !0, get: m(e) ? function () { if (this.originalEvent) return e(this.originalEvent) } : function () { if (this.originalEvent) return this.originalEvent[t] }, set: function (e) { Object.defineProperty(this, t, { enumerable: !0, configurable: !0, writable: !0, value: e }) } }) }, fix: function (e) { return e[k.expando] ? e : new k.Event(e) }, special: { load: { noBubble: !0 }, click: { setup: function (e) { var t = this || e; return pe.test(t.type) && t.click && A(t, "input") && De(t, "click", ke), !1 }, trigger: function (e) { var t = this || e; return pe.test(t.type) && t.click && A(t, "input") && De(t, "click"), !0 }, _default: function (e) { var t = e.target; return pe.test(t.type) && t.click && A(t, "input") && Q.get(t, "click") || A(t, "a") } }, beforeunload: { postDispatch: function (e) { void 0 !== e.result && e.originalEvent && (e.originalEvent.returnValue = e.result) } } } }, k.removeEvent = function (e, t, n) { e.removeEventListener && e.removeEventListener(t, n) }, k.Event = function (e, t) { if (!(this instanceof k.Event)) return new k.Event(e, t); e && e.type ? (this.originalEvent = e, this.type = e.type, this.isDefaultPrevented = e.defaultPrevented || void 0 === e.defaultPrevented && !1 === e.returnValue ? ke : Se, this.target = e.target && 3 === e.target.nodeType ? e.target.parentNode : e.target, this.currentTarget = e.currentTarget, this.relatedTarget = e.relatedTarget) : this.type = e, t && k.extend(this, t), this.timeStamp = e && e.timeStamp || Date.now(), this[k.expando] = !0 }, k.Event.prototype = { constructor: k.Event, isDefaultPrevented: Se, isPropagationStopped: Se, isImmediatePropagationStopped: Se, isSimulated: !1, preventDefault: function () { var e = this.originalEvent; this.isDefaultPrevented = ke, e && !this.isSimulated && e.preventDefault() }, stopPropagation: function () { var e = this.originalEvent; this.isPropagationStopped = ke, e && !this.isSimulated && e.stopPropagation() }, stopImmediatePropagation: function () { var e = this.originalEvent; this.isImmediatePropagationStopped = ke, e && !this.isSimulated && e.stopImmediatePropagation(), this.stopPropagation() } }, k.each({ altKey: !0, bubbles: !0, cancelable: !0, changedTouches: !0, ctrlKey: !0, detail: !0, eventPhase: !0, metaKey: !0, pageX: !0, pageY: !0, shiftKey: !0, view: !0, "char": !0, code: !0, charCode: !0, key: !0, keyCode: !0, button: !0, buttons: !0, clientX: !0, clientY: !0, offsetX: !0, offsetY: !0, pointerId: !0, pointerType: !0, screenX: !0, screenY: !0, targetTouches: !0, toElement: !0, touches: !0, which: function (e) { var t = e.button; return null == e.which && Te.test(e.type) ? null != e.charCode ? e.charCode : e.keyCode : !e.which && void 0 !== t && Ce.test(e.type) ? 1 & t ? 1 : 2 & t ? 3 : 4 & t ? 2 : 0 : e.which } }, k.event.addProp), k.each({ focus: "focusin", blur: "focusout" }, function (e, t) { k.event.special[e] = { setup: function () { return De(this, e, Ne), !1 }, trigger: function () { return De(this, e), !0 }, delegateType: t } }), k.each({ mouseenter: "mouseover", mouseleave: "mouseout", pointerenter: "pointerover", pointerleave: "pointerout" }, function (e, i) { k.event.special[e] = { delegateType: i, bindType: i, handle: function (e) { var t, n = e.relatedTarget, r = e.handleObj; return n && (n === this || k.contains(this, n)) || (e.type = r.origType, t = r.handler.apply(this, arguments), e.type = i), t } } }), k.fn.extend({ on: function (e, t, n, r) { return Ae(this, e, t, n, r) }, one: function (e, t, n, r) { return Ae(this, e, t, n, r, 1) }, off: function (e, t, n) { var r, i; if (e && e.preventDefault && e.handleObj) return r = e.handleObj, k(e.delegateTarget).off(r.namespace ? r.origType + "." + r.namespace : r.origType, r.selector, r.handler), this; if ("object" == typeof e) { for (i in e) this.off(i, t, e[i]); return this } return !1 !== t && "function" != typeof t || (n = t, t = void 0), !1 === n && (n = Se), this.each(function () { k.event.remove(this, e, n, t) }) } }); var je = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi, qe = /<script|<style|<link/i, Le = /checked\s*(?:[^=]|=\s*.checked.)/i, He = /^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g; function Oe(e, t) { return A(e, "table") && A(11 !== t.nodeType ? t : t.firstChild, "tr") && k(e).children("tbody")[0] || e } function Pe(e) { return e.type = (null !== e.getAttribute("type")) + "/" + e.type, e } function Re(e) { return "true/" === (e.type || "").slice(0, 5) ? e.type = e.type.slice(5) : e.removeAttribute("type"), e } function Me(e, t) { var n, r, i, o, a, s, u, l; if (1 === t.nodeType) { if (Q.hasData(e) && (o = Q.access(e), a = Q.set(t, o), l = o.events)) for (i in delete a.handle, a.events = {}, l) for (n = 0, r = l[i].length; n < r; n++)k.event.add(t, i, l[i][n]); J.hasData(e) && (s = J.access(e), u = k.extend({}, s), J.set(t, u)) } } function Ie(n, r, i, o) { r = g.apply([], r); var e, t, a, s, u, l, c = 0, f = n.length, p = f - 1, d = r[0], h = m(d); if (h || 1 < f && "string" == typeof d && !y.checkClone && Le.test(d)) return n.each(function (e) { var t = n.eq(e); h && (r[0] = d.call(this, e, t.html())), Ie(t, r, i, o) }); if (f && (t = (e = we(r, n[0].ownerDocument, !1, n, o)).firstChild, 1 === e.childNodes.length && (e = t), t || o)) { for (s = (a = k.map(ve(e, "script"), Pe)).length; c < f; c++)u = e, c !== p && (u = k.clone(u, !0, !0), s && k.merge(a, ve(u, "script"))), i.call(n[c], u, c); if (s) for (l = a[a.length - 1].ownerDocument, k.map(a, Re), c = 0; c < s; c++)u = a[c], he.test(u.type || "") && !Q.access(u, "globalEval") && k.contains(l, u) && (u.src && "module" !== (u.type || "").toLowerCase() ? k._evalUrl && !u.noModule && k._evalUrl(u.src, { nonce: u.nonce || u.getAttribute("nonce") }) : b(u.textContent.replace(He, ""), u, l)) } return n } function We(e, t, n) { for (var r, i = t ? k.filter(t, e) : e, o = 0; null != (r = i[o]); o++)n || 1 !== r.nodeType || k.cleanData(ve(r)), r.parentNode && (n && oe(r) && ye(ve(r, "script")), r.parentNode.removeChild(r)); return e } k.extend({ htmlPrefilter: function (e) { return e.replace(je, "<$1></$2>") }, clone: function (e, t, n) { var r, i, o, a, s, u, l, c = e.cloneNode(!0), f = oe(e); if (!(y.noCloneChecked || 1 !== e.nodeType && 11 !== e.nodeType || k.isXMLDoc(e))) for (a = ve(c), r = 0, i = (o = ve(e)).length; r < i; r++)s = o[r], u = a[r], void 0, "input" === (l = u.nodeName.toLowerCase()) && pe.test(s.type) ? u.checked = s.checked : "input" !== l && "textarea" !== l || (u.defaultValue = s.defaultValue); if (t) if (n) for (o = o || ve(e), a = a || ve(c), r = 0, i = o.length; r < i; r++)Me(o[r], a[r]); else Me(e, c); return 0 < (a = ve(c, "script")).length && ye(a, !f && ve(e, "script")), c }, cleanData: function (e) { for (var t, n, r, i = k.event.special, o = 0; void 0 !== (n = e[o]); o++)if (G(n)) { if (t = n[Q.expando]) { if (t.events) for (r in t.events) i[r] ? k.event.remove(n, r) : k.removeEvent(n, r, t.handle); n[Q.expando] = void 0 } n[J.expando] && (n[J.expando] = void 0) } } }), k.fn.extend({ detach: function (e) { return We(this, e, !0) }, remove: function (e) { return We(this, e) }, text: function (e) { return _(this, function (e) { return void 0 === e ? k.text(this) : this.empty().each(function () { 1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || (this.textContent = e) }) }, null, e, arguments.length) }, append: function () { return Ie(this, arguments, function (e) { 1 !== this.nodeType && 11 !== this.nodeType && 9 !== this.nodeType || Oe(this, e).appendChild(e) }) }, prepend: function () { return Ie(this, arguments, function (e) { if (1 === this.nodeType || 11 === this.nodeType || 9 === this.nodeType) { var t = Oe(this, e); t.insertBefore(e, t.firstChild) } }) }, before: function () { return Ie(this, arguments, function (e) { this.parentNode && this.parentNode.insertBefore(e, this) }) }, after: function () { return Ie(this, arguments, function (e) { this.parentNode && this.parentNode.insertBefore(e, this.nextSibling) }) }, empty: function () { for (var e, t = 0; null != (e = this[t]); t++)1 === e.nodeType && (k.cleanData(ve(e, !1)), e.textContent = ""); return this }, clone: function (e, t) { return e = null != e && e, t = null == t ? e : t, this.map(function () { return k.clone(this, e, t) }) }, html: function (e) { return _(this, function (e) { var t = this[0] || {}, n = 0, r = this.length; if (void 0 === e && 1 === t.nodeType) return t.innerHTML; if ("string" == typeof e && !qe.test(e) && !ge[(de.exec(e) || ["", ""])[1].toLowerCase()]) { e = k.htmlPrefilter(e); try { for (; n < r; n++)1 === (t = this[n] || {}).nodeType && (k.cleanData(ve(t, !1)), t.innerHTML = e); t = 0 } catch (e) { } } t && this.empty().append(e) }, null, e, arguments.length) }, replaceWith: function () { var n = []; return Ie(this, arguments, function (e) { var t = this.parentNode; k.inArray(this, n) < 0 && (k.cleanData(ve(this)), t && t.replaceChild(e, this)) }, n) } }), k.each({ appendTo: "append", prependTo: "prepend", insertBefore: "before", insertAfter: "after", replaceAll: "replaceWith" }, function (e, a) { k.fn[e] = function (e) { for (var t, n = [], r = k(e), i = r.length - 1, o = 0; o <= i; o++)t = o === i ? this : this.clone(!0), k(r[o])[a](t), u.apply(n, t.get()); return this.pushStack(n) } }); var $e = new RegExp("^(" + te + ")(?!px)[a-z%]+$", "i"), Fe = function (e) { var t = e.ownerDocument.defaultView; return t && t.opener || (t = C), t.getComputedStyle(e) }, Be = new RegExp(re.join("|"), "i"); function _e(e, t, n) { var r, i, o, a, s = e.style; return (n = n || Fe(e)) && ("" !== (a = n.getPropertyValue(t) || n[t]) || oe(e) || (a = k.style(e, t)), !y.pixelBoxStyles() && $e.test(a) && Be.test(t) && (r = s.width, i = s.minWidth, o = s.maxWidth, s.minWidth = s.maxWidth = s.width = a, a = n.width, s.width = r, s.minWidth = i, s.maxWidth = o)), void 0 !== a ? a + "" : a } function ze(e, t) { return { get: function () { if (!e()) return (this.get = t).apply(this, arguments); delete this.get } } } !function () { function e() { if (u) { s.style.cssText = "position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0", u.style.cssText = "position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%", ie.appendChild(s).appendChild(u); var e = C.getComputedStyle(u); n = "1%" !== e.top, a = 12 === t(e.marginLeft), u.style.right = "60%", o = 36 === t(e.right), r = 36 === t(e.width), u.style.position = "absolute", i = 12 === t(u.offsetWidth / 3), ie.removeChild(s), u = null } } function t(e) { return Math.round(parseFloat(e)) } var n, r, i, o, a, s = E.createElement("div"), u = E.createElement("div"); u.style && (u.style.backgroundClip = "content-box", u.cloneNode(!0).style.backgroundClip = "", y.clearCloneStyle = "content-box" === u.style.backgroundClip, k.extend(y, { boxSizingReliable: function () { return e(), r }, pixelBoxStyles: function () { return e(), o }, pixelPosition: function () { return e(), n }, reliableMarginLeft: function () { return e(), a }, scrollboxSize: function () { return e(), i } })) }(); var Ue = ["Webkit", "Moz", "ms"], Xe = E.createElement("div").style, Ve = {}; function Ge(e) { var t = k.cssProps[e] || Ve[e]; return t || (e in Xe ? e : Ve[e] = function (e) { var t = e[0].toUpperCase() + e.slice(1), n = Ue.length; while (n--) if ((e = Ue[n] + t) in Xe) return e }(e) || e) } var Ye = /^(none|table(?!-c[ea]).+)/, Qe = /^--/, Je = { position: "absolute", visibility: "hidden", display: "block" }, Ke = { letterSpacing: "0", fontWeight: "400" }; function Ze(e, t, n) { var r = ne.exec(t); return r ? Math.max(0, r[2] - (n || 0)) + (r[3] || "px") : t } function et(e, t, n, r, i, o) { var a = "width" === t ? 1 : 0, s = 0, u = 0; if (n === (r ? "border" : "content")) return 0; for (; a < 4; a += 2)"margin" === n && (u += k.css(e, n + re[a], !0, i)), r ? ("content" === n && (u -= k.css(e, "padding" + re[a], !0, i)), "margin" !== n && (u -= k.css(e, "border" + re[a] + "Width", !0, i))) : (u += k.css(e, "padding" + re[a], !0, i), "padding" !== n ? u += k.css(e, "border" + re[a] + "Width", !0, i) : s += k.css(e, "border" + re[a] + "Width", !0, i)); return !r && 0 <= o && (u += Math.max(0, Math.ceil(e["offset" + t[0].toUpperCase() + t.slice(1)] - o - u - s - .5)) || 0), u } function tt(e, t, n) { var r = Fe(e), i = (!y.boxSizingReliable() || n) && "border-box" === k.css(e, "boxSizing", !1, r), o = i, a = _e(e, t, r), s = "offset" + t[0].toUpperCase() + t.slice(1); if ($e.test(a)) { if (!n) return a; a = "auto" } return (!y.boxSizingReliable() && i || "auto" === a || !parseFloat(a) && "inline" === k.css(e, "display", !1, r)) && e.getClientRects().length && (i = "border-box" === k.css(e, "boxSizing", !1, r), (o = s in e) && (a = e[s])), (a = parseFloat(a) || 0) + et(e, t, n || (i ? "border" : "content"), o, r, a) + "px" } function nt(e, t, n, r, i) { return new nt.prototype.init(e, t, n, r, i) } k.extend({ cssHooks: { opacity: { get: function (e, t) { if (t) { var n = _e(e, "opacity"); return "" === n ? "1" : n } } } }, cssNumber: { animationIterationCount: !0, columnCount: !0, fillOpacity: !0, flexGrow: !0, flexShrink: !0, fontWeight: !0, gridArea: !0, gridColumn: !0, gridColumnEnd: !0, gridColumnStart: !0, gridRow: !0, gridRowEnd: !0, gridRowStart: !0, lineHeight: !0, opacity: !0, order: !0, orphans: !0, widows: !0, zIndex: !0, zoom: !0 }, cssProps: {}, style: function (e, t, n, r) { if (e && 3 !== e.nodeType && 8 !== e.nodeType && e.style) { var i, o, a, s = V(t), u = Qe.test(t), l = e.style; if (u || (t = Ge(s)), a = k.cssHooks[t] || k.cssHooks[s], void 0 === n) return a && "get" in a && void 0 !== (i = a.get(e, !1, r)) ? i : l[t]; "string" === (o = typeof n) && (i = ne.exec(n)) && i[1] && (n = le(e, t, i), o = "number"), null != n && n == n && ("number" !== o || u || (n += i && i[3] || (k.cssNumber[s] ? "" : "px")), y.clearCloneStyle || "" !== n || 0 !== t.indexOf("background") || (l[t] = "inherit"), a && "set" in a && void 0 === (n = a.set(e, n, r)) || (u ? l.setProperty(t, n) : l[t] = n)) } }, css: function (e, t, n, r) { var i, o, a, s = V(t); return Qe.test(t) || (t = Ge(s)), (a = k.cssHooks[t] || k.cssHooks[s]) && "get" in a && (i = a.get(e, !0, n)), void 0 === i && (i = _e(e, t, r)), "normal" === i && t in Ke && (i = Ke[t]), "" === n || n ? (o = parseFloat(i), !0 === n || isFinite(o) ? o || 0 : i) : i } }), k.each(["height", "width"], function (e, u) { k.cssHooks[u] = { get: function (e, t, n) { if (t) return !Ye.test(k.css(e, "display")) || e.getClientRects().length && e.getBoundingClientRect().width ? tt(e, u, n) : ue(e, Je, function () { return tt(e, u, n) }) }, set: function (e, t, n) { var r, i = Fe(e), o = !y.scrollboxSize() && "absolute" === i.position, a = (o || n) && "border-box" === k.css(e, "boxSizing", !1, i), s = n ? et(e, u, n, a, i) : 0; return a && o && (s -= Math.ceil(e["offset" + u[0].toUpperCase() + u.slice(1)] - parseFloat(i[u]) - et(e, u, "border", !1, i) - .5)), s && (r = ne.exec(t)) && "px" !== (r[3] || "px") && (e.style[u] = t, t = k.css(e, u)), Ze(0, t, s) } } }), k.cssHooks.marginLeft = ze(y.reliableMarginLeft, function (e, t) { if (t) return (parseFloat(_e(e, "marginLeft")) || e.getBoundingClientRect().left - ue(e, { marginLeft: 0 }, function () { return e.getBoundingClientRect().left })) + "px" }), k.each({ margin: "", padding: "", border: "Width" }, function (i, o) { k.cssHooks[i + o] = { expand: function (e) { for (var t = 0, n = {}, r = "string" == typeof e ? e.split(" ") : [e]; t < 4; t++)n[i + re[t] + o] = r[t] || r[t - 2] || r[0]; return n } }, "margin" !== i && (k.cssHooks[i + o].set = Ze) }), k.fn.extend({ css: function (e, t) { return _(this, function (e, t, n) { var r, i, o = {}, a = 0; if (Array.isArray(t)) { for (r = Fe(e), i = t.length; a < i; a++)o[t[a]] = k.css(e, t[a], !1, r); return o } return void 0 !== n ? k.style(e, t, n) : k.css(e, t) }, e, t, 1 < arguments.length) } }), ((k.Tween = nt).prototype = { constructor: nt, init: function (e, t, n, r, i, o) { this.elem = e, this.prop = n, this.easing = i || k.easing._default, this.options = t, this.start = this.now = this.cur(), this.end = r, this.unit = o || (k.cssNumber[n] ? "" : "px") }, cur: function () { var e = nt.propHooks[this.prop]; return e && e.get ? e.get(this) : nt.propHooks._default.get(this) }, run: function (e) { var t, n = nt.propHooks[this.prop]; return this.options.duration ? this.pos = t = k.easing[this.easing](e, this.options.duration * e, 0, 1, this.options.duration) : this.pos = t = e, this.now = (this.end - this.start) * t + this.start, this.options.step && this.options.step.call(this.elem, this.now, this), n && n.set ? n.set(this) : nt.propHooks._default.set(this), this } }).init.prototype = nt.prototype, (nt.propHooks = { _default: { get: function (e) { var t; return 1 !== e.elem.nodeType || null != e.elem[e.prop] && null == e.elem.style[e.prop] ? e.elem[e.prop] : (t = k.css(e.elem, e.prop, "")) && "auto" !== t ? t : 0 }, set: function (e) { k.fx.step[e.prop] ? k.fx.step[e.prop](e) : 1 !== e.elem.nodeType || !k.cssHooks[e.prop] && null == e.elem.style[Ge(e.prop)] ? e.elem[e.prop] = e.now : k.style(e.elem, e.prop, e.now + e.unit) } } }).scrollTop = nt.propHooks.scrollLeft = { set: function (e) { e.elem.nodeType && e.elem.parentNode && (e.elem[e.prop] = e.now) } }, k.easing = { linear: function (e) { return e }, swing: function (e) { return .5 - Math.cos(e * Math.PI) / 2 }, _default: "swing" }, k.fx = nt.prototype.init, k.fx.step = {}; var rt, it, ot, at, st = /^(?:toggle|show|hide)$/, ut = /queueHooks$/; function lt() { it && (!1 === E.hidden && C.requestAnimationFrame ? C.requestAnimationFrame(lt) : C.setTimeout(lt, k.fx.interval), k.fx.tick()) } function ct() { return C.setTimeout(function () { rt = void 0 }), rt = Date.now() } function ft(e, t) { var n, r = 0, i = { height: e }; for (t = t ? 1 : 0; r < 4; r += 2 - t)i["margin" + (n = re[r])] = i["padding" + n] = e; return t && (i.opacity = i.width = e), i } function pt(e, t, n) { for (var r, i = (dt.tweeners[t] || []).concat(dt.tweeners["*"]), o = 0, a = i.length; o < a; o++)if (r = i[o].call(n, t, e)) return r } function dt(o, e, t) { var n, a, r = 0, i = dt.prefilters.length, s = k.Deferred().always(function () { delete u.elem }), u = function () { if (a) return !1; for (var e = rt || ct(), t = Math.max(0, l.startTime + l.duration - e), n = 1 - (t / l.duration || 0), r = 0, i = l.tweens.length; r < i; r++)l.tweens[r].run(n); return s.notifyWith(o, [l, n, t]), n < 1 && i ? t : (i || s.notifyWith(o, [l, 1, 0]), s.resolveWith(o, [l]), !1) }, l = s.promise({ elem: o, props: k.extend({}, e), opts: k.extend(!0, { specialEasing: {}, easing: k.easing._default }, t), originalProperties: e, originalOptions: t, startTime: rt || ct(), duration: t.duration, tweens: [], createTween: function (e, t) { var n = k.Tween(o, l.opts, e, t, l.opts.specialEasing[e] || l.opts.easing); return l.tweens.push(n), n }, stop: function (e) { var t = 0, n = e ? l.tweens.length : 0; if (a) return this; for (a = !0; t < n; t++)l.tweens[t].run(1); return e ? (s.notifyWith(o, [l, 1, 0]), s.resolveWith(o, [l, e])) : s.rejectWith(o, [l, e]), this } }), c = l.props; for (!function (e, t) { var n, r, i, o, a; for (n in e) if (i = t[r = V(n)], o = e[n], Array.isArray(o) && (i = o[1], o = e[n] = o[0]), n !== r && (e[r] = o, delete e[n]), (a = k.cssHooks[r]) && "expand" in a) for (n in o = a.expand(o), delete e[r], o) n in e || (e[n] = o[n], t[n] = i); else t[r] = i }(c, l.opts.specialEasing); r < i; r++)if (n = dt.prefilters[r].call(l, o, c, l.opts)) return m(n.stop) && (k._queueHooks(l.elem, l.opts.queue).stop = n.stop.bind(n)), n; return k.map(c, pt, l), m(l.opts.start) && l.opts.start.call(o, l), l.progress(l.opts.progress).done(l.opts.done, l.opts.complete).fail(l.opts.fail).always(l.opts.always), k.fx.timer(k.extend(u, { elem: o, anim: l, queue: l.opts.queue })), l } k.Animation = k.extend(dt, { tweeners: { "*": [function (e, t) { var n = this.createTween(e, t); return le(n.elem, e, ne.exec(t), n), n }] }, tweener: function (e, t) { m(e) ? (t = e, e = ["*"]) : e = e.match(R); for (var n, r = 0, i = e.length; r < i; r++)n = e[r], dt.tweeners[n] = dt.tweeners[n] || [], dt.tweeners[n].unshift(t) }, prefilters: [function (e, t, n) { var r, i, o, a, s, u, l, c, f = "width" in t || "height" in t, p = this, d = {}, h = e.style, g = e.nodeType && se(e), v = Q.get(e, "fxshow"); for (r in n.queue || (null == (a = k._queueHooks(e, "fx")).unqueued && (a.unqueued = 0, s = a.empty.fire, a.empty.fire = function () { a.unqueued || s() }), a.unqueued++, p.always(function () { p.always(function () { a.unqueued--, k.queue(e, "fx").length || a.empty.fire() }) })), t) if (i = t[r], st.test(i)) { if (delete t[r], o = o || "toggle" === i, i === (g ? "hide" : "show")) { if ("show" !== i || !v || void 0 === v[r]) continue; g = !0 } d[r] = v && v[r] || k.style(e, r) } if ((u = !k.isEmptyObject(t)) || !k.isEmptyObject(d)) for (r in f && 1 === e.nodeType && (n.overflow = [h.overflow, h.overflowX, h.overflowY], null == (l = v && v.display) && (l = Q.get(e, "display")), "none" === (c = k.css(e, "display")) && (l ? c = l : (fe([e], !0), l = e.style.display || l, c = k.css(e, "display"), fe([e]))), ("inline" === c || "inline-block" === c && null != l) && "none" === k.css(e, "float") && (u || (p.done(function () { h.display = l }), null == l && (c = h.display, l = "none" === c ? "" : c)), h.display = "inline-block")), n.overflow && (h.overflow = "hidden", p.always(function () { h.overflow = n.overflow[0], h.overflowX = n.overflow[1], h.overflowY = n.overflow[2] })), u = !1, d) u || (v ? "hidden" in v && (g = v.hidden) : v = Q.access(e, "fxshow", { display: l }), o && (v.hidden = !g), g && fe([e], !0), p.done(function () { for (r in g || fe([e]), Q.remove(e, "fxshow"), d) k.style(e, r, d[r]) })), u = pt(g ? v[r] : 0, r, p), r in v || (v[r] = u.start, g && (u.end = u.start, u.start = 0)) }], prefilter: function (e, t) { t ? dt.prefilters.unshift(e) : dt.prefilters.push(e) } }), k.speed = function (e, t, n) { var r = e && "object" == typeof e ? k.extend({}, e) : { complete: n || !n && t || m(e) && e, duration: e, easing: n && t || t && !m(t) && t }; return k.fx.off ? r.duration = 0 : "number" != typeof r.duration && (r.duration in k.fx.speeds ? r.duration = k.fx.speeds[r.duration] : r.duration = k.fx.speeds._default), null != r.queue && !0 !== r.queue || (r.queue = "fx"), r.old = r.complete, r.complete = function () { m(r.old) && r.old.call(this), r.queue && k.dequeue(this, r.queue) }, r }, k.fn.extend({ fadeTo: function (e, t, n, r) { return this.filter(se).css("opacity", 0).show().end().animate({ opacity: t }, e, n, r) }, animate: function (t, e, n, r) { var i = k.isEmptyObject(t), o = k.speed(e, n, r), a = function () { var e = dt(this, k.extend({}, t), o); (i || Q.get(this, "finish")) && e.stop(!0) }; return a.finish = a, i || !1 === o.queue ? this.each(a) : this.queue(o.queue, a) }, stop: function (i, e, o) { var a = function (e) { var t = e.stop; delete e.stop, t(o) }; return "string" != typeof i && (o = e, e = i, i = void 0), e && !1 !== i && this.queue(i || "fx", []), this.each(function () { var e = !0, t = null != i && i + "queueHooks", n = k.timers, r = Q.get(this); if (t) r[t] && r[t].stop && a(r[t]); else for (t in r) r[t] && r[t].stop && ut.test(t) && a(r[t]); for (t = n.length; t--;)n[t].elem !== this || null != i && n[t].queue !== i || (n[t].anim.stop(o), e = !1, n.splice(t, 1)); !e && o || k.dequeue(this, i) }) }, finish: function (a) { return !1 !== a && (a = a || "fx"), this.each(function () { var e, t = Q.get(this), n = t[a + "queue"], r = t[a + "queueHooks"], i = k.timers, o = n ? n.length : 0; for (t.finish = !0, k.queue(this, a, []), r && r.stop && r.stop.call(this, !0), e = i.length; e--;)i[e].elem === this && i[e].queue === a && (i[e].anim.stop(!0), i.splice(e, 1)); for (e = 0; e < o; e++)n[e] && n[e].finish && n[e].finish.call(this); delete t.finish }) } }), k.each(["toggle", "show", "hide"], function (e, r) { var i = k.fn[r]; k.fn[r] = function (e, t, n) { return null == e || "boolean" == typeof e ? i.apply(this, arguments) : this.animate(ft(r, !0), e, t, n) } }), k.each({ slideDown: ft("show"), slideUp: ft("hide"), slideToggle: ft("toggle"), fadeIn: { opacity: "show" }, fadeOut: { opacity: "hide" }, fadeToggle: { opacity: "toggle" } }, function (e, r) { k.fn[e] = function (e, t, n) { return this.animate(r, e, t, n) } }), k.timers = [], k.fx.tick = function () { var e, t = 0, n = k.timers; for (rt = Date.now(); t < n.length; t++)(e = n[t])() || n[t] !== e || n.splice(t--, 1); n.length || k.fx.stop(), rt = void 0 }, k.fx.timer = function (e) { k.timers.push(e), k.fx.start() }, k.fx.interval = 13, k.fx.start = function () { it || (it = !0, lt()) }, k.fx.stop = function () { it = null }, k.fx.speeds = { slow: 600, fast: 200, _default: 400 }, k.fn.delay = function (r, e) { return r = k.fx && k.fx.speeds[r] || r, e = e || "fx", this.queue(e, function (e, t) { var n = C.setTimeout(e, r); t.stop = function () { C.clearTimeout(n) } }) }, ot = E.createElement("input"), at = E.createElement("select").appendChild(E.createElement("option")), ot.type = "checkbox", y.checkOn = "" !== ot.value, y.optSelected = at.selected, (ot = E.createElement("input")).value = "t", ot.type = "radio", y.radioValue = "t" === ot.value; var ht, gt = k.expr.attrHandle; k.fn.extend({ attr: function (e, t) { return _(this, k.attr, e, t, 1 < arguments.length) }, removeAttr: function (e) { return this.each(function () { k.removeAttr(this, e) }) } }), k.extend({ attr: function (e, t, n) { var r, i, o = e.nodeType; if (3 !== o && 8 !== o && 2 !== o) return "undefined" == typeof e.getAttribute ? k.prop(e, t, n) : (1 === o && k.isXMLDoc(e) || (i = k.attrHooks[t.toLowerCase()] || (k.expr.match.bool.test(t) ? ht : void 0)), void 0 !== n ? null === n ? void k.removeAttr(e, t) : i && "set" in i && void 0 !== (r = i.set(e, n, t)) ? r : (e.setAttribute(t, n + ""), n) : i && "get" in i && null !== (r = i.get(e, t)) ? r : null == (r = k.find.attr(e, t)) ? void 0 : r) }, attrHooks: { type: { set: function (e, t) { if (!y.radioValue && "radio" === t && A(e, "input")) { var n = e.value; return e.setAttribute("type", t), n && (e.value = n), t } } } }, removeAttr: function (e, t) { var n, r = 0, i = t && t.match(R); if (i && 1 === e.nodeType) while (n = i[r++]) e.removeAttribute(n) } }), ht = { set: function (e, t, n) { return !1 === t ? k.removeAttr(e, n) : e.setAttribute(n, n), n } }, k.each(k.expr.match.bool.source.match(/\w+/g), function (e, t) { var a = gt[t] || k.find.attr; gt[t] = function (e, t, n) { var r, i, o = t.toLowerCase(); return n || (i = gt[o], gt[o] = r, r = null != a(e, t, n) ? o : null, gt[o] = i), r } }); var vt = /^(?:input|select|textarea|button)$/i, yt = /^(?:a|area)$/i; function mt(e) { return (e.match(R) || []).join(" ") } function xt(e) { return e.getAttribute && e.getAttribute("class") || "" } function bt(e) { return Array.isArray(e) ? e : "string" == typeof e && e.match(R) || [] } k.fn.extend({ prop: function (e, t) { return _(this, k.prop, e, t, 1 < arguments.length) }, removeProp: function (e) { return this.each(function () { delete this[k.propFix[e] || e] }) } }), k.extend({ prop: function (e, t, n) { var r, i, o = e.nodeType; if (3 !== o && 8 !== o && 2 !== o) return 1 === o && k.isXMLDoc(e) || (t = k.propFix[t] || t, i = k.propHooks[t]), void 0 !== n ? i && "set" in i && void 0 !== (r = i.set(e, n, t)) ? r : e[t] = n : i && "get" in i && null !== (r = i.get(e, t)) ? r : e[t] }, propHooks: { tabIndex: { get: function (e) { var t = k.find.attr(e, "tabindex"); return t ? parseInt(t, 10) : vt.test(e.nodeName) || yt.test(e.nodeName) && e.href ? 0 : -1 } } }, propFix: { "for": "htmlFor", "class": "className" } }), y.optSelected || (k.propHooks.selected = { get: function (e) { var t = e.parentNode; return t && t.parentNode && t.parentNode.selectedIndex, null }, set: function (e) { var t = e.parentNode; t && (t.selectedIndex, t.parentNode && t.parentNode.selectedIndex) } }), k.each(["tabIndex", "readOnly", "maxLength", "cellSpacing", "cellPadding", "rowSpan", "colSpan", "useMap", "frameBorder", "contentEditable"], function () { k.propFix[this.toLowerCase()] = this }), k.fn.extend({ addClass: function (t) { var e, n, r, i, o, a, s, u = 0; if (m(t)) return this.each(function (e) { k(this).addClass(t.call(this, e, xt(this))) }); if ((e = bt(t)).length) while (n = this[u++]) if (i = xt(n), r = 1 === n.nodeType && " " + mt(i) + " ") { a = 0; while (o = e[a++]) r.indexOf(" " + o + " ") < 0 && (r += o + " "); i !== (s = mt(r)) && n.setAttribute("class", s) } return this }, removeClass: function (t) { var e, n, r, i, o, a, s, u = 0; if (m(t)) return this.each(function (e) { k(this).removeClass(t.call(this, e, xt(this))) }); if (!arguments.length) return this.attr("class", ""); if ((e = bt(t)).length) while (n = this[u++]) if (i = xt(n), r = 1 === n.nodeType && " " + mt(i) + " ") { a = 0; while (o = e[a++]) while (-1 < r.indexOf(" " + o + " ")) r = r.replace(" " + o + " ", " "); i !== (s = mt(r)) && n.setAttribute("class", s) } return this }, toggleClass: function (i, t) { var o = typeof i, a = "string" === o || Array.isArray(i); return "boolean" == typeof t && a ? t ? this.addClass(i) : this.removeClass(i) : m(i) ? this.each(function (e) { k(this).toggleClass(i.call(this, e, xt(this), t), t) }) : this.each(function () { var e, t, n, r; if (a) { t = 0, n = k(this), r = bt(i); while (e = r[t++]) n.hasClass(e) ? n.removeClass(e) : n.addClass(e) } else void 0 !== i && "boolean" !== o || ((e = xt(this)) && Q.set(this, "__className__", e), this.setAttribute && this.setAttribute("class", e || !1 === i ? "" : Q.get(this, "__className__") || "")) }) }, hasClass: function (e) { var t, n, r = 0; t = " " + e + " "; while (n = this[r++]) if (1 === n.nodeType && -1 < (" " + mt(xt(n)) + " ").indexOf(t)) return !0; return !1 } }); var wt = /\r/g; k.fn.extend({ val: function (n) { var r, e, i, t = this[0]; return arguments.length ? (i = m(n), this.each(function (e) { var t; 1 === this.nodeType && (null == (t = i ? n.call(this, e, k(this).val()) : n) ? t = "" : "number" == typeof t ? t += "" : Array.isArray(t) && (t = k.map(t, function (e) { return null == e ? "" : e + "" })), (r = k.valHooks[this.type] || k.valHooks[this.nodeName.toLowerCase()]) && "set" in r && void 0 !== r.set(this, t, "value") || (this.value = t)) })) : t ? (r = k.valHooks[t.type] || k.valHooks[t.nodeName.toLowerCase()]) && "get" in r && void 0 !== (e = r.get(t, "value")) ? e : "string" == typeof (e = t.value) ? e.replace(wt, "") : null == e ? "" : e : void 0 } }), k.extend({ valHooks: { option: { get: function (e) { var t = k.find.attr(e, "value"); return null != t ? t : mt(k.text(e)) } }, select: { get: function (e) { var t, n, r, i = e.options, o = e.selectedIndex, a = "select-one" === e.type, s = a ? null : [], u = a ? o + 1 : i.length; for (r = o < 0 ? u : a ? o : 0; r < u; r++)if (((n = i[r]).selected || r === o) && !n.disabled && (!n.parentNode.disabled || !A(n.parentNode, "optgroup"))) { if (t = k(n).val(), a) return t; s.push(t) } return s }, set: function (e, t) { var n, r, i = e.options, o = k.makeArray(t), a = i.length; while (a--) ((r = i[a]).selected = -1 < k.inArray(k.valHooks.option.get(r), o)) && (n = !0); return n || (e.selectedIndex = -1), o } } } }), k.each(["radio", "checkbox"], function () { k.valHooks[this] = { set: function (e, t) { if (Array.isArray(t)) return e.checked = -1 < k.inArray(k(e).val(), t) } }, y.checkOn || (k.valHooks[this].get = function (e) { return null === e.getAttribute("value") ? "on" : e.value }) }), y.focusin = "onfocusin" in C; var Tt = /^(?:focusinfocus|focusoutblur)$/, Ct = function (e) { e.stopPropagation() }; k.extend(k.event, { trigger: function (e, t, n, r) { var i, o, a, s, u, l, c, f, p = [n || E], d = v.call(e, "type") ? e.type : e, h = v.call(e, "namespace") ? e.namespace.split(".") : []; if (o = f = a = n = n || E, 3 !== n.nodeType && 8 !== n.nodeType && !Tt.test(d + k.event.triggered) && (-1 < d.indexOf(".") && (d = (h = d.split(".")).shift(), h.sort()), u = d.indexOf(":") < 0 && "on" + d, (e = e[k.expando] ? e : new k.Event(d, "object" == typeof e && e)).isTrigger = r ? 2 : 3, e.namespace = h.join("."), e.rnamespace = e.namespace ? new RegExp("(^|\\.)" + h.join("\\.(?:.*\\.|)") + "(\\.|$)") : null, e.result = void 0, e.target || (e.target = n), t = null == t ? [e] : k.makeArray(t, [e]), c = k.event.special[d] || {}, r || !c.trigger || !1 !== c.trigger.apply(n, t))) { if (!r && !c.noBubble && !x(n)) { for (s = c.delegateType || d, Tt.test(s + d) || (o = o.parentNode); o; o = o.parentNode)p.push(o), a = o; a === (n.ownerDocument || E) && p.push(a.defaultView || a.parentWindow || C) } i = 0; while ((o = p[i++]) && !e.isPropagationStopped()) f = o, e.type = 1 < i ? s : c.bindType || d, (l = (Q.get(o, "events") || {})[e.type] && Q.get(o, "handle")) && l.apply(o, t), (l = u && o[u]) && l.apply && G(o) && (e.result = l.apply(o, t), !1 === e.result && e.preventDefault()); return e.type = d, r || e.isDefaultPrevented() || c._default && !1 !== c._default.apply(p.pop(), t) || !G(n) || u && m(n[d]) && !x(n) && ((a = n[u]) && (n[u] = null), k.event.triggered = d, e.isPropagationStopped() && f.addEventListener(d, Ct), n[d](), e.isPropagationStopped() && f.removeEventListener(d, Ct), k.event.triggered = void 0, a && (n[u] = a)), e.result } }, simulate: function (e, t, n) { var r = k.extend(new k.Event, n, { type: e, isSimulated: !0 }); k.event.trigger(r, null, t) } }), k.fn.extend({ trigger: function (e, t) { return this.each(function () { k.event.trigger(e, t, this) }) }, triggerHandler: function (e, t) { var n = this[0]; if (n) return k.event.trigger(e, t, n, !0) } }), y.focusin || k.each({ focus: "focusin", blur: "focusout" }, function (n, r) { var i = function (e) { k.event.simulate(r, e.target, k.event.fix(e)) }; k.event.special[r] = { setup: function () { var e = this.ownerDocument || this, t = Q.access(e, r); t || e.addEventListener(n, i, !0), Q.access(e, r, (t || 0) + 1) }, teardown: function () { var e = this.ownerDocument || this, t = Q.access(e, r) - 1; t ? Q.access(e, r, t) : (e.removeEventListener(n, i, !0), Q.remove(e, r)) } } }); var Et = C.location, kt = Date.now(), St = /\?/; k.parseXML = function (e) { var t; if (!e || "string" != typeof e) return null; try { t = (new C.DOMParser).parseFromString(e, "text/xml") } catch (e) { t = void 0 } return t && !t.getElementsByTagName("parsererror").length || k.error("Invalid XML: " + e), t }; var Nt = /\[\]$/, At = /\r?\n/g, Dt = /^(?:submit|button|image|reset|file)$/i, jt = /^(?:input|select|textarea|keygen)/i; function qt(n, e, r, i) { var t; if (Array.isArray(e)) k.each(e, function (e, t) { r || Nt.test(n) ? i(n, t) : qt(n + "[" + ("object" == typeof t && null != t ? e : "") + "]", t, r, i) }); else if (r || "object" !== w(e)) i(n, e); else for (t in e) qt(n + "[" + t + "]", e[t], r, i) } k.param = function (e, t) { var n, r = [], i = function (e, t) { var n = m(t) ? t() : t; r[r.length] = encodeURIComponent(e) + "=" + encodeURIComponent(null == n ? "" : n) }; if (null == e) return ""; if (Array.isArray(e) || e.jquery && !k.isPlainObject(e)) k.each(e, function () { i(this.name, this.value) }); else for (n in e) qt(n, e[n], t, i); return r.join("&") }, k.fn.extend({ serialize: function () { return k.param(this.serializeArray()) }, serializeArray: function () { return this.map(function () { var e = k.prop(this, "elements"); return e ? k.makeArray(e) : this }).filter(function () { var e = this.type; return this.name && !k(this).is(":disabled") && jt.test(this.nodeName) && !Dt.test(e) && (this.checked || !pe.test(e)) }).map(function (e, t) { var n = k(this).val(); return null == n ? null : Array.isArray(n) ? k.map(n, function (e) { return { name: t.name, value: e.replace(At, "\r\n") } }) : { name: t.name, value: n.replace(At, "\r\n") } }).get() } }); var Lt = /%20/g, Ht = /#.*$/, Ot = /([?&])_=[^&]*/, Pt = /^(.*?):[ \t]*([^\r\n]*)$/gm, Rt = /^(?:GET|HEAD)$/, Mt = /^\/\//, It = {}, Wt = {}, $t = "*/".concat("*"), Ft = E.createElement("a"); function Bt(o) { return function (e, t) { "string" != typeof e && (t = e, e = "*"); var n, r = 0, i = e.toLowerCase().match(R) || []; if (m(t)) while (n = i[r++]) "+" === n[0] ? (n = n.slice(1) || "*", (o[n] = o[n] || []).unshift(t)) : (o[n] = o[n] || []).push(t) } } function _t(t, i, o, a) { var s = {}, u = t === Wt; function l(e) { var r; return s[e] = !0, k.each(t[e] || [], function (e, t) { var n = t(i, o, a); return "string" != typeof n || u || s[n] ? u ? !(r = n) : void 0 : (i.dataTypes.unshift(n), l(n), !1) }), r } return l(i.dataTypes[0]) || !s["*"] && l("*") } function zt(e, t) { var n, r, i = k.ajaxSettings.flatOptions || {}; for (n in t) void 0 !== t[n] && ((i[n] ? e : r || (r = {}))[n] = t[n]); return r && k.extend(!0, e, r), e } Ft.href = Et.href, k.extend({ active: 0, lastModified: {}, etag: {}, ajaxSettings: { url: Et.href, type: "GET", isLocal: /^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol), global: !0, processData: !0, async: !0, contentType: "application/x-www-form-urlencoded; charset=UTF-8", accepts: { "*": $t, text: "text/plain", html: "text/html", xml: "application/xml, text/xml", json: "application/json, text/javascript" }, contents: { xml: /\bxml\b/, html: /\bhtml/, json: /\bjson\b/ }, responseFields: { xml: "responseXML", text: "responseText", json: "responseJSON" }, converters: { "* text": String, "text html": !0, "text json": JSON.parse, "text xml": k.parseXML }, flatOptions: { url: !0, context: !0 } }, ajaxSetup: function (e, t) { return t ? zt(zt(e, k.ajaxSettings), t) : zt(k.ajaxSettings, e) }, ajaxPrefilter: Bt(It), ajaxTransport: Bt(Wt), ajax: function (e, t) { "object" == typeof e && (t = e, e = void 0), t = t || {}; var c, f, p, n, d, r, h, g, i, o, v = k.ajaxSetup({}, t), y = v.context || v, m = v.context && (y.nodeType || y.jquery) ? k(y) : k.event, x = k.Deferred(), b = k.Callbacks("once memory"), w = v.statusCode || {}, a = {}, s = {}, u = "canceled", T = { readyState: 0, getResponseHeader: function (e) { var t; if (h) { if (!n) { n = {}; while (t = Pt.exec(p)) n[t[1].toLowerCase() + " "] = (n[t[1].toLowerCase() + " "] || []).concat(t[2]) } t = n[e.toLowerCase() + " "] } return null == t ? null : t.join(", ") }, getAllResponseHeaders: function () { return h ? p : null }, setRequestHeader: function (e, t) { return null == h && (e = s[e.toLowerCase()] = s[e.toLowerCase()] || e, a[e] = t), this }, overrideMimeType: function (e) { return null == h && (v.mimeType = e), this }, statusCode: function (e) { var t; if (e) if (h) T.always(e[T.status]); else for (t in e) w[t] = [w[t], e[t]]; return this }, abort: function (e) { var t = e || u; return c && c.abort(t), l(0, t), this } }; if (x.promise(T), v.url = ((e || v.url || Et.href) + "").replace(Mt, Et.protocol + "//"), v.type = t.method || t.type || v.method || v.type, v.dataTypes = (v.dataType || "*").toLowerCase().match(R) || [""], null == v.crossDomain) { r = E.createElement("a"); try { r.href = v.url, r.href = r.href, v.crossDomain = Ft.protocol + "//" + Ft.host != r.protocol + "//" + r.host } catch (e) { v.crossDomain = !0 } } if (v.data && v.processData && "string" != typeof v.data && (v.data = k.param(v.data, v.traditional)), _t(It, v, t, T), h) return T; for (i in (g = k.event && v.global) && 0 == k.active++ && k.event.trigger("ajaxStart"), v.type = v.type.toUpperCase(), v.hasContent = !Rt.test(v.type), f = v.url.replace(Ht, ""), v.hasContent ? v.data && v.processData && 0 === (v.contentType || "").indexOf("application/x-www-form-urlencoded") && (v.data = v.data.replace(Lt, "+")) : (o = v.url.slice(f.length), v.data && (v.processData || "string" == typeof v.data) && (f += (St.test(f) ? "&" : "?") + v.data, delete v.data), !1 === v.cache && (f = f.replace(Ot, "$1"), o = (St.test(f) ? "&" : "?") + "_=" + kt++ + o), v.url = f + o), v.ifModified && (k.lastModified[f] && T.setRequestHeader("If-Modified-Since", k.lastModified[f]), k.etag[f] && T.setRequestHeader("If-None-Match", k.etag[f])), (v.data && v.hasContent && !1 !== v.contentType || t.contentType) && T.setRequestHeader("Content-Type", v.contentType), T.setRequestHeader("Accept", v.dataTypes[0] && v.accepts[v.dataTypes[0]] ? v.accepts[v.dataTypes[0]] + ("*" !== v.dataTypes[0] ? ", " + $t + "; q=0.01" : "") : v.accepts["*"]), v.headers) T.setRequestHeader(i, v.headers[i]); if (v.beforeSend && (!1 === v.beforeSend.call(y, T, v) || h)) return T.abort(); if (u = "abort", b.add(v.complete), T.done(v.success), T.fail(v.error), c = _t(Wt, v, t, T)) { if (T.readyState = 1, g && m.trigger("ajaxSend", [T, v]), h) return T; v.async && 0 < v.timeout && (d = C.setTimeout(function () { T.abort("timeout") }, v.timeout)); try { h = !1, c.send(a, l) } catch (e) { if (h) throw e; l(-1, e) } } else l(-1, "No Transport"); function l(e, t, n, r) { var i, o, a, s, u, l = t; h || (h = !0, d && C.clearTimeout(d), c = void 0, p = r || "", T.readyState = 0 < e ? 4 : 0, i = 200 <= e && e < 300 || 304 === e, n && (s = function (e, t, n) { var r, i, o, a, s = e.contents, u = e.dataTypes; while ("*" === u[0]) u.shift(), void 0 === r && (r = e.mimeType || t.getResponseHeader("Content-Type")); if (r) for (i in s) if (s[i] && s[i].test(r)) { u.unshift(i); break } if (u[0] in n) o = u[0]; else { for (i in n) { if (!u[0] || e.converters[i + " " + u[0]]) { o = i; break } a || (a = i) } o = o || a } if (o) return o !== u[0] && u.unshift(o), n[o] }(v, T, n)), s = function (e, t, n, r) { var i, o, a, s, u, l = {}, c = e.dataTypes.slice(); if (c[1]) for (a in e.converters) l[a.toLowerCase()] = e.converters[a]; o = c.shift(); while (o) if (e.responseFields[o] && (n[e.responseFields[o]] = t), !u && r && e.dataFilter && (t = e.dataFilter(t, e.dataType)), u = o, o = c.shift()) if ("*" === o) o = u; else if ("*" !== u && u !== o) { if (!(a = l[u + " " + o] || l["* " + o])) for (i in l) if ((s = i.split(" "))[1] === o && (a = l[u + " " + s[0]] || l["* " + s[0]])) { !0 === a ? a = l[i] : !0 !== l[i] && (o = s[0], c.unshift(s[1])); break } if (!0 !== a) if (a && e["throws"]) t = a(t); else try { t = a(t) } catch (e) { return { state: "parsererror", error: a ? e : "No conversion from " + u + " to " + o } } } return { state: "success", data: t } }(v, s, T, i), i ? (v.ifModified && ((u = T.getResponseHeader("Last-Modified")) && (k.lastModified[f] = u), (u = T.getResponseHeader("etag")) && (k.etag[f] = u)), 204 === e || "HEAD" === v.type ? l = "nocontent" : 304 === e ? l = "notmodified" : (l = s.state, o = s.data, i = !(a = s.error))) : (a = l, !e && l || (l = "error", e < 0 && (e = 0))), T.status = e, T.statusText = (t || l) + "", i ? x.resolveWith(y, [o, l, T]) : x.rejectWith(y, [T, l, a]), T.statusCode(w), w = void 0, g && m.trigger(i ? "ajaxSuccess" : "ajaxError", [T, v, i ? o : a]), b.fireWith(y, [T, l]), g && (m.trigger("ajaxComplete", [T, v]), --k.active || k.event.trigger("ajaxStop"))) } return T }, getJSON: function (e, t, n) { return k.get(e, t, n, "json") }, getScript: function (e, t) { return k.get(e, void 0, t, "script") } }), k.each(["get", "post"], function (e, i) { k[i] = function (e, t, n, r) { return m(t) && (r = r || n, n = t, t = void 0), k.ajax(k.extend({ url: e, type: i, dataType: r, data: t, success: n }, k.isPlainObject(e) && e)) } }), k._evalUrl = function (e, t) { return k.ajax({ url: e, type: "GET", dataType: "script", cache: !0, async: !1, global: !1, converters: { "text script": function () { } }, dataFilter: function (e) { k.globalEval(e, t) } }) }, k.fn.extend({ wrapAll: function (e) { var t; return this[0] && (m(e) && (e = e.call(this[0])), t = k(e, this[0].ownerDocument).eq(0).clone(!0), this[0].parentNode && t.insertBefore(this[0]), t.map(function () { var e = this; while (e.firstElementChild) e = e.firstElementChild; return e }).append(this)), this }, wrapInner: function (n) { return m(n) ? this.each(function (e) { k(this).wrapInner(n.call(this, e)) }) : this.each(function () { var e = k(this), t = e.contents(); t.length ? t.wrapAll(n) : e.append(n) }) }, wrap: function (t) { var n = m(t); return this.each(function (e) { k(this).wrapAll(n ? t.call(this, e) : t) }) }, unwrap: function (e) { return this.parent(e).not("body").each(function () { k(this).replaceWith(this.childNodes) }), this } }), k.expr.pseudos.hidden = function (e) { return !k.expr.pseudos.visible(e) }, k.expr.pseudos.visible = function (e) { return !!(e.offsetWidth || e.offsetHeight || e.getClientRects().length) }, k.ajaxSettings.xhr = function () { try { return new C.XMLHttpRequest } catch (e) { } }; var Ut = { 0: 200, 1223: 204 }, Xt = k.ajaxSettings.xhr(); y.cors = !!Xt && "withCredentials" in Xt, y.ajax = Xt = !!Xt, k.ajaxTransport(function (i) { var o, a; if (y.cors || Xt && !i.crossDomain) return { send: function (e, t) { var n, r = i.xhr(); if (r.open(i.type, i.url, i.async, i.username, i.password), i.xhrFields) for (n in i.xhrFields) r[n] = i.xhrFields[n]; for (n in i.mimeType && r.overrideMimeType && r.overrideMimeType(i.mimeType), i.crossDomain || e["X-Requested-With"] || (e["X-Requested-With"] = "XMLHttpRequest"), e) r.setRequestHeader(n, e[n]); o = function (e) { return function () { o && (o = a = r.onload = r.onerror = r.onabort = r.ontimeout = r.onreadystatechange = null, "abort" === e ? r.abort() : "error" === e ? "number" != typeof r.status ? t(0, "error") : t(r.status, r.statusText) : t(Ut[r.status] || r.status, r.statusText, "text" !== (r.responseType || "text") || "string" != typeof r.responseText ? { binary: r.response } : { text: r.responseText }, r.getAllResponseHeaders())) } }, r.onload = o(), a = r.onerror = r.ontimeout = o("error"), void 0 !== r.onabort ? r.onabort = a : r.onreadystatechange = function () { 4 === r.readyState && C.setTimeout(function () { o && a() }) }, o = o("abort"); try { r.send(i.hasContent && i.data || null) } catch (e) { if (o) throw e } }, abort: function () { o && o() } } }), k.ajaxPrefilter(function (e) { e.crossDomain && (e.contents.script = !1) }), k.ajaxSetup({ accepts: { script: "text/javascript, application/javascript, application/ecmascript, application/x-ecmascript" }, contents: { script: /\b(?:java|ecma)script\b/ }, converters: { "text script": function (e) { return k.globalEval(e), e } } }), k.ajaxPrefilter("script", function (e) { void 0 === e.cache && (e.cache = !1), e.crossDomain && (e.type = "GET") }), k.ajaxTransport("script", function (n) { var r, i; if (n.crossDomain || n.scriptAttrs) return { send: function (e, t) { r = k("<script>").attr(n.scriptAttrs || {}).prop({ charset: n.scriptCharset, src: n.url }).on("load error", i = function (e) { r.remove(), i = null, e && t("error" === e.type ? 404 : 200, e.type) }), E.head.appendChild(r[0]) }, abort: function () { i && i() } } }); var Vt, Gt = [], Yt = /(=)\?(?=&|$)|\?\?/; k.ajaxSetup({ jsonp: "callback", jsonpCallback: function () { var e = Gt.pop() || k.expando + "_" + kt++; return this[e] = !0, e } }), k.ajaxPrefilter("json jsonp", function (e, t, n) { var r, i, o, a = !1 !== e.jsonp && (Yt.test(e.url) ? "url" : "string" == typeof e.data && 0 === (e.contentType || "").indexOf("application/x-www-form-urlencoded") && Yt.test(e.data) && "data"); if (a || "jsonp" === e.dataTypes[0]) return r = e.jsonpCallback = m(e.jsonpCallback) ? e.jsonpCallback() : e.jsonpCallback, a ? e[a] = e[a].replace(Yt, "$1" + r) : !1 !== e.jsonp && (e.url += (St.test(e.url) ? "&" : "?") + e.jsonp + "=" + r), e.converters["script json"] = function () { return o || k.error(r + " was not called"), o[0] }, e.dataTypes[0] = "json", i = C[r], C[r] = function () { o = arguments }, n.always(function () { void 0 === i ? k(C).removeProp(r) : C[r] = i, e[r] && (e.jsonpCallback = t.jsonpCallback, Gt.push(r)), o && m(i) && i(o[0]), o = i = void 0 }), "script" }), y.createHTMLDocument = ((Vt = E.implementation.createHTMLDocument("").body).innerHTML = "<form></form><form></form>", 2 === Vt.childNodes.length), k.parseHTML = function (e, t, n) { return "string" != typeof e ? [] : ("boolean" == typeof t && (n = t, t = !1), t || (y.createHTMLDocument ? ((r = (t = E.implementation.createHTMLDocument("")).createElement("base")).href = E.location.href, t.head.appendChild(r)) : t = E), o = !n && [], (i = D.exec(e)) ? [t.createElement(i[1])] : (i = we([e], t, o), o && o.length && k(o).remove(), k.merge([], i.childNodes))); var r, i, o }, k.fn.load = function (e, t, n) { var r, i, o, a = this, s = e.indexOf(" "); return -1 < s && (r = mt(e.slice(s)), e = e.slice(0, s)), m(t) ? (n = t, t = void 0) : t && "object" == typeof t && (i = "POST"), 0 < a.length && k.ajax({ url: e, type: i || "GET", dataType: "html", data: t }).done(function (e) { o = arguments, a.html(r ? k("<div>").append(k.parseHTML(e)).find(r) : e) }).always(n && function (e, t) { a.each(function () { n.apply(this, o || [e.responseText, t, e]) }) }), this }, k.each(["ajaxStart", "ajaxStop", "ajaxComplete", "ajaxError", "ajaxSuccess", "ajaxSend"], function (e, t) { k.fn[t] = function (e) { return this.on(t, e) } }), k.expr.pseudos.animated = function (t) { return k.grep(k.timers, function (e) { return t === e.elem }).length }, k.offset = { setOffset: function (e, t, n) { var r, i, o, a, s, u, l = k.css(e, "position"), c = k(e), f = {}; "static" === l && (e.style.position = "relative"), s = c.offset(), o = k.css(e, "top"), u = k.css(e, "left"), ("absolute" === l || "fixed" === l) && -1 < (o + u).indexOf("auto") ? (a = (r = c.position()).top, i = r.left) : (a = parseFloat(o) || 0, i = parseFloat(u) || 0), m(t) && (t = t.call(e, n, k.extend({}, s))), null != t.top && (f.top = t.top - s.top + a), null != t.left && (f.left = t.left - s.left + i), "using" in t ? t.using.call(e, f) : c.css(f) } }, k.fn.extend({ offset: function (t) { if (arguments.length) return void 0 === t ? this : this.each(function (e) { k.offset.setOffset(this, t, e) }); var e, n, r = this[0]; return r ? r.getClientRects().length ? (e = r.getBoundingClientRect(), n = r.ownerDocument.defaultView, { top: e.top + n.pageYOffset, left: e.left + n.pageXOffset }) : { top: 0, left: 0 } : void 0 }, position: function () { if (this[0]) { var e, t, n, r = this[0], i = { top: 0, left: 0 }; if ("fixed" === k.css(r, "position")) t = r.getBoundingClientRect(); else { t = this.offset(), n = r.ownerDocument, e = r.offsetParent || n.documentElement; while (e && (e === n.body || e === n.documentElement) && "static" === k.css(e, "position")) e = e.parentNode; e && e !== r && 1 === e.nodeType && ((i = k(e).offset()).top += k.css(e, "borderTopWidth", !0), i.left += k.css(e, "borderLeftWidth", !0)) } return { top: t.top - i.top - k.css(r, "marginTop", !0), left: t.left - i.left - k.css(r, "marginLeft", !0) } } }, offsetParent: function () { return this.map(function () { var e = this.offsetParent; while (e && "static" === k.css(e, "position")) e = e.offsetParent; return e || ie }) } }), k.each({ scrollLeft: "pageXOffset", scrollTop: "pageYOffset" }, function (t, i) { var o = "pageYOffset" === i; k.fn[t] = function (e) { return _(this, function (e, t, n) { var r; if (x(e) ? r = e : 9 === e.nodeType && (r = e.defaultView), void 0 === n) return r ? r[i] : e[t]; r ? r.scrollTo(o ? r.pageXOffset : n, o ? n : r.pageYOffset) : e[t] = n }, t, e, arguments.length) } }), k.each(["top", "left"], function (e, n) { k.cssHooks[n] = ze(y.pixelPosition, function (e, t) { if (t) return t = _e(e, n), $e.test(t) ? k(e).position()[n] + "px" : t }) }), k.each({ Height: "height", Width: "width" }, function (a, s) { k.each({ padding: "inner" + a, content: s, "": "outer" + a }, function (r, o) { k.fn[o] = function (e, t) { var n = arguments.length && (r || "boolean" != typeof e), i = r || (!0 === e || !0 === t ? "margin" : "border"); return _(this, function (e, t, n) { var r; return x(e) ? 0 === o.indexOf("outer") ? e["inner" + a] : e.document.documentElement["client" + a] : 9 === e.nodeType ? (r = e.documentElement, Math.max(e.body["scroll" + a], r["scroll" + a], e.body["offset" + a], r["offset" + a], r["client" + a])) : void 0 === n ? k.css(e, t, i) : k.style(e, t, n, i) }, s, n ? e : void 0, n) } }) }), k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "), function (e, n) { k.fn[n] = function (e, t) { return 0 < arguments.length ? this.on(n, null, e, t) : this.trigger(n) } }), k.fn.extend({ hover: function (e, t) { return this.mouseenter(e).mouseleave(t || e) } }), k.fn.extend({ bind: function (e, t, n) { return this.on(e, null, t, n) }, unbind: function (e, t) { return this.off(e, null, t) }, delegate: function (e, t, n, r) { return this.on(t, e, n, r) }, undelegate: function (e, t, n) { return 1 === arguments.length ? this.off(e, "**") : this.off(t, e || "**", n) } }), k.proxy = function (e, t) { var n, r, i; if ("string" == typeof t && (n = e[t], t = e, e = n), m(e)) return r = s.call(arguments, 2), (i = function () { return e.apply(t || this, r.concat(s.call(arguments))) }).guid = e.guid = e.guid || k.guid++, i }, k.holdReady = function (e) { e ? k.readyWait++ : k.ready(!0) }, k.isArray = Array.isArray, k.parseJSON = JSON.parse, k.nodeName = A, k.isFunction = m, k.isWindow = x, k.camelCase = V, k.type = w, k.now = Date.now, k.isNumeric = function (e) { var t = k.type(e); return ("number" === t || "string" === t) && !isNaN(e - parseFloat(e)) }, "function" == typeof define && define.amd && define("jquery", [], function () { return k }); var Qt = C.jQuery, Jt = C.$; return k.noConflict = function (e) { return C.$ === k && (C.$ = Jt), e && C.jQuery === k && (C.jQuery = Qt), k }, e || (C.jQuery = C.$ = k), k });
    </script>
    <style>
        .select2-container {
            box-sizing: border-box;
            display: inline-block;
            margin: 0;
            position: relative;
            vertical-align: middle
        }

        .select2-container .select2-selection--single {
            box-sizing: border-box;
            cursor: pointer;
            display: block;
            height: 28px;
            user-select: none;
            -webkit-user-select: none
        }

        .select2-container .select2-selection--single .select2-selection__rendered {
            display: block;
            padding-left: 8px;
            padding-right: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap
        }

        .select2-container .select2-selection--single .select2-selection__clear {
            position: relative
        }

        .select2-container[dir="rtl"] .select2-selection--single .select2-selection__rendered {
            padding-right: 8px;
            padding-left: 20px
        }

        .select2-container .select2-selection--multiple {
            box-sizing: border-box;
            cursor: pointer;
            display: block;
            min-height: 32px;
            user-select: none;
            -webkit-user-select: none
        }

        .select2-container .select2-selection--multiple .select2-selection__rendered {
            display: inline-block;
            overflow: hidden;
            padding-left: 8px;
            text-overflow: ellipsis;
            white-space: nowrap
        }

        .select2-container .select2-search--inline {
            float: left
        }

        .select2-container .select2-search--inline .select2-search__field {
            box-sizing: border-box;
            border: none;
            font-size: 100%;
            margin-top: 5px;
            padding: 0
        }

        .select2-container .select2-search--inline .select2-search__field::-webkit-search-cancel-button {
            -webkit-appearance: none
        }

        .select2-dropdown {
            background-color: white;
            border: 1px solid #aaa;
            border-radius: 4px;
            box-sizing: border-box;
            display: block;
            position: absolute;
            left: -100000px;
            width: 100%;
            z-index: 1051
        }

        .select2-results {
            display: block
        }

        .select2-results__options {
            list-style: none;
            margin: 0;
            padding: 0
        }

        .select2-results__option {
            padding: 6px;
            user-select: none;
            -webkit-user-select: none
        }

        .select2-results__option[aria-selected] {
            cursor: pointer
        }

        .select2-container--open .select2-dropdown {
            left: 0
        }

        .select2-container--open .select2-dropdown--above {
            border-bottom: none;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0
        }

        .select2-container--open .select2-dropdown--below {
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0
        }

        .select2-search--dropdown {
            display: block;
            padding: 4px
        }

        .select2-search--dropdown .select2-search__field {
            padding: 4px;
            width: 100%;
            box-sizing: border-box
        }

        .select2-search--dropdown .select2-search__field::-webkit-search-cancel-button {
            -webkit-appearance: none
        }

        .select2-search--dropdown.select2-search--hide {
            display: none
        }

        .select2-close-mask {
            border: 0;
            margin: 0;
            padding: 0;
            display: block;
            position: fixed;
            left: 0;
            top: 0;
            min-height: 100%;
            min-width: 100%;
            height: auto;
            width: auto;
            opacity: 0;
            z-index: 99;
            background-color: #fff;
            filter: alpha(opacity=0)
        }

        .select2-hidden-accessible {
            border: 0 !important;
            clip: rect(0 0 0 0) !important;
            -webkit-clip-path: inset(50%) !important;
            clip-path: inset(50%) !important;
            height: 1px !important;
            overflow: hidden !important;
            padding: 0 !important;
            position: absolute !important;
            width: 1px !important;
            white-space: nowrap !important
        }

        .select2-container--default .select2-selection--single {
            background-color: #fff;
            border: 1px solid #aaa;
            border-radius: 4px
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            color: #444;
            line-height: 28px
        }

        .select2-container--default .select2-selection--single .select2-selection__clear {
            cursor: pointer;
            float: right;
            font-weight: bold
        }

        .select2-container--default .select2-selection--single .select2-selection__placeholder {
            color: #999
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 26px;
            position: absolute;
            top: 1px;
            right: 1px;
            width: 20px
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow b {
            border-color: #888 transparent transparent transparent;
            border-style: solid;
            border-width: 5px 4px 0 4px;
            height: 0;
            left: 50%;
            margin-left: -4px;
            margin-top: -2px;
            position: absolute;
            top: 50%;
            width: 0
        }

        .select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__clear {
            float: left
        }

        .select2-container--default[dir="rtl"] .select2-selection--single .select2-selection__arrow {
            left: 1px;
            right: auto
        }

        .select2-container--default.select2-container--disabled .select2-selection--single {
            background-color: #eee;
            cursor: default
        }

        .select2-container--default.select2-container--disabled .select2-selection--single .select2-selection__clear {
            display: none
        }

        .select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b {
            border-color: transparent transparent #888 transparent;
            border-width: 0 4px 5px 4px
        }

        .select2-container--default .select2-selection--multiple {
            background-color: white;
            border: 1px solid #aaa;
            border-radius: 4px;
            cursor: text
        }

        .select2-container--default .select2-selection--multiple .select2-selection__rendered {
            box-sizing: border-box;
            list-style: none;
            margin: 0;
            padding: 0 5px;
            width: 100%
        }

        .select2-container--default .select2-selection--multiple .select2-selection__rendered li {
            list-style: none
        }

        .select2-container--default .select2-selection--multiple .select2-selection__placeholder {
            color: #999;
            margin-top: 5px;
            float: left
        }

        .select2-container--default .select2-selection--multiple .select2-selection__clear {
            cursor: pointer;
            float: right;
            font-weight: bold;
            margin-top: 5px;
            margin-right: 10px
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #e4e4e4;
            border: 1px solid #aaa;
            border-radius: 4px;
            cursor: default;
            float: left;
            margin-right: 5px;
            margin-top: 5px;
            padding: 0 5px
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
            color: #999;
            cursor: pointer;
            display: inline-block;
            font-weight: bold;
            margin-right: 2px
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
            color: #333
        }

        .select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice,
        .select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__placeholder,
        .select2-container--default[dir="rtl"] .select2-selection--multiple .select2-search--inline {
            float: right
        }

        .select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice {
            margin-left: 5px;
            margin-right: auto
        }

        .select2-container--default[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove {
            margin-left: 2px;
            margin-right: auto
        }

        .select2-container--default.select2-container--focus .select2-selection--multiple {
            border: solid black 1px;
            outline: 0
        }

        .select2-container--default.select2-container--disabled .select2-selection--multiple {
            background-color: #eee;
            cursor: default
        }

        .select2-container--default.select2-container--disabled .select2-selection__choice__remove {
            display: none
        }

        .select2-container--default.select2-container--open.select2-container--above .select2-selection--single,
        .select2-container--default.select2-container--open.select2-container--above .select2-selection--multiple {
            border-top-left-radius: 0;
            border-top-right-radius: 0
        }

        .select2-container--default.select2-container--open.select2-container--below .select2-selection--single,
        .select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0
        }

        .select2-container--default .select2-search--dropdown .select2-search__field {
            border: 1px solid #aaa
        }

        .select2-container--default .select2-search--inline .select2-search__field {
            background: transparent;
            border: none;
            outline: 0;
            box-shadow: none;
            -webkit-appearance: textfield
        }

        .select2-container--default .select2-results>.select2-results__options {
            max-height: 200px;
            overflow-y: auto
        }

        .select2-container--default .select2-results__option[role=group] {
            padding: 0
        }

        .select2-container--default .select2-results__option[aria-disabled=true] {
            color: #999
        }

        .select2-container--default .select2-results__option[aria-selected=true] {
            background-color: #ddd
        }

        .select2-container--default .select2-results__option .select2-results__option {
            padding-left: 1em
        }

        .select2-container--default .select2-results__option .select2-results__option .select2-results__group {
            padding-left: 0
        }

        .select2-container--default .select2-results__option .select2-results__option .select2-results__option {
            margin-left: -1em;
            padding-left: 2em
        }

        .select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
            margin-left: -2em;
            padding-left: 3em
        }

        .select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
            margin-left: -3em;
            padding-left: 4em
        }

        .select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
            margin-left: -4em;
            padding-left: 5em
        }

        .select2-container--default .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option .select2-results__option {
            margin-left: -5em;
            padding-left: 6em
        }

        .select2-container--default .select2-results__option--highlighted[aria-selected] {
            background-color: #5897fb;
            color: white
        }

        .select2-container--default .select2-results__group {
            cursor: default;
            display: block;
            padding: 6px
        }

        .select2-container--classic .select2-selection--single {
            background-color: #f7f7f7;
            border: 1px solid #aaa;
            border-radius: 4px;
            outline: 0;
            background-image: -webkit-linear-gradient(top, #fff 50%, #eee 100%);
            background-image: -o-linear-gradient(top, #fff 50%, #eee 100%);
            background-image: linear-gradient(to bottom, #fff 50%, #eee 100%);
            background-repeat: repeat-x;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)
        }

        .select2-container--classic .select2-selection--single:focus {
            border: 1px solid #5897fb
        }

        .select2-container--classic .select2-selection--single .select2-selection__rendered {
            color: #444;
            line-height: 28px
        }

        .select2-container--classic .select2-selection--single .select2-selection__clear {
            cursor: pointer;
            float: right;
            font-weight: bold;
            margin-right: 10px
        }

        .select2-container--classic .select2-selection--single .select2-selection__placeholder {
            color: #999
        }

        .select2-container--classic .select2-selection--single .select2-selection__arrow {
            background-color: #ddd;
            border: none;
            border-left: 1px solid #aaa;
            border-top-right-radius: 4px;
            border-bottom-right-radius: 4px;
            height: 26px;
            position: absolute;
            top: 1px;
            right: 1px;
            width: 20px;
            background-image: -webkit-linear-gradient(top, #eee 50%, #ccc 100%);
            background-image: -o-linear-gradient(top, #eee 50%, #ccc 100%);
            background-image: linear-gradient(to bottom, #eee 50%, #ccc 100%);
            background-repeat: repeat-x;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFCCCCCC', GradientType=0)
        }

        .select2-container--classic .select2-selection--single .select2-selection__arrow b {
            border-color: #888 transparent transparent transparent;
            border-style: solid;
            border-width: 5px 4px 0 4px;
            height: 0;
            left: 50%;
            margin-left: -4px;
            margin-top: -2px;
            position: absolute;
            top: 50%;
            width: 0
        }

        .select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__clear {
            float: left
        }

        .select2-container--classic[dir="rtl"] .select2-selection--single .select2-selection__arrow {
            border: none;
            border-right: 1px solid #aaa;
            border-radius: 0;
            border-top-left-radius: 4px;
            border-bottom-left-radius: 4px;
            left: 1px;
            right: auto
        }

        .select2-container--classic.select2-container--open .select2-selection--single {
            border: 1px solid #5897fb
        }

        .select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow {
            background: transparent;
            border: none
        }

        .select2-container--classic.select2-container--open .select2-selection--single .select2-selection__arrow b {
            border-color: transparent transparent #888 transparent;
            border-width: 0 4px 5px 4px
        }

        .select2-container--classic.select2-container--open.select2-container--above .select2-selection--single {
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0;
            background-image: -webkit-linear-gradient(top, #fff 0%, #eee 50%);
            background-image: -o-linear-gradient(top, #fff 0%, #eee 50%);
            background-image: linear-gradient(to bottom, #fff 0%, #eee 50%);
            background-repeat: repeat-x;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFFFFFFF', endColorstr='#FFEEEEEE', GradientType=0)
        }

        .select2-container--classic.select2-container--open.select2-container--below .select2-selection--single {
            border-bottom: none;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            background-image: -webkit-linear-gradient(top, #eee 50%, #fff 100%);
            background-image: -o-linear-gradient(top, #eee 50%, #fff 100%);
            background-image: linear-gradient(to bottom, #eee 50%, #fff 100%);
            background-repeat: repeat-x;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#FFEEEEEE', endColorstr='#FFFFFFFF', GradientType=0)
        }

        .select2-container--classic .select2-selection--multiple {
            background-color: white;
            border: 1px solid #aaa;
            border-radius: 4px;
            cursor: text;
            outline: 0
        }

        .select2-container--classic .select2-selection--multiple:focus {
            border: 1px solid #5897fb
        }

        .select2-container--classic .select2-selection--multiple .select2-selection__rendered {
            list-style: none;
            margin: 0;
            padding: 0 5px
        }

        .select2-container--classic .select2-selection--multiple .select2-selection__clear {
            display: none
        }

        .select2-container--classic .select2-selection--multiple .select2-selection__choice {
            background-color: #e4e4e4;
            border: 1px solid #aaa;
            border-radius: 4px;
            cursor: default;
            float: left;
            margin-right: 5px;
            margin-top: 5px;
            padding: 0 5px
        }

        .select2-container--classic .select2-selection--multiple .select2-selection__choice__remove {
            color: #888;
            cursor: pointer;
            display: inline-block;
            font-weight: bold;
            margin-right: 2px
        }

        .select2-container--classic .select2-selection--multiple .select2-selection__choice__remove:hover {
            color: #555
        }

        .select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice {
            float: right;
            margin-left: 5px;
            margin-right: auto
        }

        .select2-container--classic[dir="rtl"] .select2-selection--multiple .select2-selection__choice__remove {
            margin-left: 2px;
            margin-right: auto
        }

        .select2-container--classic.select2-container--open .select2-selection--multiple {
            border: 1px solid #5897fb
        }

        .select2-container--classic.select2-container--open.select2-container--above .select2-selection--multiple {
            border-top: none;
            border-top-left-radius: 0;
            border-top-right-radius: 0
        }

        .select2-container--classic.select2-container--open.select2-container--below .select2-selection--multiple {
            border-bottom: none;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0
        }

        .select2-container--classic .select2-search--dropdown .select2-search__field {
            border: 1px solid #aaa;
            outline: 0
        }

        .select2-container--classic .select2-search--inline .select2-search__field {
            outline: 0;
            box-shadow: none
        }

        .select2-container--classic .select2-dropdown {
            background-color: #fff;
            border: 1px solid transparent
        }

        .select2-container--classic .select2-dropdown--above {
            border-bottom: none
        }

        .select2-container--classic .select2-dropdown--below {
            border-top: none
        }

        .select2-container--classic .select2-results>.select2-results__options {
            max-height: 200px;
            overflow-y: auto
        }

        .select2-container--classic .select2-results__option[role=group] {
            padding: 0
        }

        .select2-container--classic .select2-results__option[aria-disabled=true] {
            color: grey
        }

        .select2-container--classic .select2-results__option--highlighted[aria-selected] {
            background-color: #3875d7;
            color: #fff
        }

        .select2-container--classic .select2-results__group {
            cursor: default;
            display: block;
            padding: 6px
        }

        .select2-container--classic.select2-container--open .select2-dropdown {
            border-color: #5897fb
        }
    </style>
    <script>
        /*! Select2 4.0.7 | https://github.com/select2/select2/blob/master/LICENSE.md */!function (a) { "function" == typeof define && define.amd ? define(["jquery"], a) : "object" == typeof module && module.exports ? module.exports = function (b, c) { return void 0 === c && (c = "undefined" != typeof window ? require("jquery") : require("jquery")(b)), a(c), c } : a(jQuery) }(function (a) { var b = function () { if (a && a.fn && a.fn.select2 && a.fn.select2.amd) var b = a.fn.select2.amd; var b; return function () { if (!b || !b.requirejs) { b ? c = b : b = {}; var a, c, d; !function (b) { function e(a, b) { return v.call(a, b) } function f(a, b) { var c, d, e, f, g, h, i, j, k, l, m, n, o = b && b.split("/"), p = t.map, q = p && p["*"] || {}; if (a) { for (a = a.split("/"), g = a.length - 1, t.nodeIdCompat && x.test(a[g]) && (a[g] = a[g].replace(x, "")), "." === a[0].charAt(0) && o && (n = o.slice(0, o.length - 1), a = n.concat(a)), k = 0; k < a.length; k++)if ("." === (m = a[k])) a.splice(k, 1), k -= 1; else if (".." === m) { if (0 === k || 1 === k && ".." === a[2] || ".." === a[k - 1]) continue; k > 0 && (a.splice(k - 1, 2), k -= 2) } a = a.join("/") } if ((o || q) && p) { for (c = a.split("/"), k = c.length; k > 0; k -= 1) { if (d = c.slice(0, k).join("/"), o) for (l = o.length; l > 0; l -= 1)if ((e = p[o.slice(0, l).join("/")]) && (e = e[d])) { f = e, h = k; break } if (f) break; !i && q && q[d] && (i = q[d], j = k) } !f && i && (f = i, h = j), f && (c.splice(0, h, f), a = c.join("/")) } return a } function g(a, c) { return function () { var d = w.call(arguments, 0); return "string" != typeof d[0] && 1 === d.length && d.push(null), o.apply(b, d.concat([a, c])) } } function h(a) { return function (b) { return f(b, a) } } function i(a) { return function (b) { r[a] = b } } function j(a) { if (e(s, a)) { var c = s[a]; delete s[a], u[a] = !0, n.apply(b, c) } if (!e(r, a) && !e(u, a)) throw new Error("No " + a); return r[a] } function k(a) { var b, c = a ? a.indexOf("!") : -1; return c > -1 && (b = a.substring(0, c), a = a.substring(c + 1, a.length)), [b, a] } function l(a) { return a ? k(a) : [] } function m(a) { return function () { return t && t.config && t.config[a] || {} } } var n, o, p, q, r = {}, s = {}, t = {}, u = {}, v = Object.prototype.hasOwnProperty, w = [].slice, x = /\.js$/; p = function (a, b) { var c, d = k(a), e = d[0], g = b[1]; return a = d[1], e && (e = f(e, g), c = j(e)), e ? a = c && c.normalize ? c.normalize(a, h(g)) : f(a, g) : (a = f(a, g), d = k(a), e = d[0], a = d[1], e && (c = j(e))), { f: e ? e + "!" + a : a, n: a, pr: e, p: c } }, q = { require: function (a) { return g(a) }, exports: function (a) { var b = r[a]; return void 0 !== b ? b : r[a] = {} }, module: function (a) { return { id: a, uri: "", exports: r[a], config: m(a) } } }, n = function (a, c, d, f) { var h, k, m, n, o, t, v, w = [], x = typeof d; if (f = f || a, t = l(f), "undefined" === x || "function" === x) { for (c = !c.length && d.length ? ["require", "exports", "module"] : c, o = 0; o < c.length; o += 1)if (n = p(c[o], t), "require" === (k = n.f)) w[o] = q.require(a); else if ("exports" === k) w[o] = q.exports(a), v = !0; else if ("module" === k) h = w[o] = q.module(a); else if (e(r, k) || e(s, k) || e(u, k)) w[o] = j(k); else { if (!n.p) throw new Error(a + " missing " + k); n.p.load(n.n, g(f, !0), i(k), {}), w[o] = r[k] } m = d ? d.apply(r[a], w) : void 0, a && (h && h.exports !== b && h.exports !== r[a] ? r[a] = h.exports : m === b && v || (r[a] = m)) } else a && (r[a] = d) }, a = c = o = function (a, c, d, e, f) { if ("string" == typeof a) return q[a] ? q[a](c) : j(p(a, l(c)).f); if (!a.splice) { if (t = a, t.deps && o(t.deps, t.callback), !c) return; c.splice ? (a = c, c = d, d = null) : a = b } return c = c || function () { }, "function" == typeof d && (d = e, e = f), e ? n(b, a, c, d) : setTimeout(function () { n(b, a, c, d) }, 4), o }, o.config = function (a) { return o(a) }, a._defined = r, d = function (a, b, c) { if ("string" != typeof a) throw new Error("See almond README: incorrect module build, no module name"); b.splice || (c = b, b = []), e(r, a) || e(s, a) || (s[a] = [a, b, c]) }, d.amd = { jQuery: !0 } }(), b.requirejs = a, b.require = c, b.define = d } }(), b.define("almond", function () { }), b.define("jquery", [], function () { var b = a || $; return null == b && console && console.error && console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."), b }), b.define("select2/utils", ["jquery"], function (a) { function b(a) { var b = a.prototype, c = []; for (var d in b) { "function" == typeof b[d] && ("constructor" !== d && c.push(d)) } return c } var c = {}; c.Extend = function (a, b) { function c() { this.constructor = a } var d = {}.hasOwnProperty; for (var e in b) d.call(b, e) && (a[e] = b[e]); return c.prototype = b.prototype, a.prototype = new c, a.__super__ = b.prototype, a }, c.Decorate = function (a, c) { function d() { var b = Array.prototype.unshift, d = c.prototype.constructor.length, e = a.prototype.constructor; d > 0 && (b.call(arguments, a.prototype.constructor), e = c.prototype.constructor), e.apply(this, arguments) } function e() { this.constructor = d } var f = b(c), g = b(a); c.displayName = a.displayName, d.prototype = new e; for (var h = 0; h < g.length; h++) { var i = g[h]; d.prototype[i] = a.prototype[i] } for (var j = (function (a) { var b = function () { }; a in d.prototype && (b = d.prototype[a]); var e = c.prototype[a]; return function () { return Array.prototype.unshift.call(arguments, b), e.apply(this, arguments) } }), k = 0; k < f.length; k++) { var l = f[k]; d.prototype[l] = j(l) } return d }; var d = function () { this.listeners = {} }; d.prototype.on = function (a, b) { this.listeners = this.listeners || {}, a in this.listeners ? this.listeners[a].push(b) : this.listeners[a] = [b] }, d.prototype.trigger = function (a) { var b = Array.prototype.slice, c = b.call(arguments, 1); this.listeners = this.listeners || {}, null == c && (c = []), 0 === c.length && c.push({}), c[0]._type = a, a in this.listeners && this.invoke(this.listeners[a], b.call(arguments, 1)), "*" in this.listeners && this.invoke(this.listeners["*"], arguments) }, d.prototype.invoke = function (a, b) { for (var c = 0, d = a.length; c < d; c++)a[c].apply(this, b) }, c.Observable = d, c.generateChars = function (a) { for (var b = "", c = 0; c < a; c++) { b += Math.floor(36 * Math.random()).toString(36) } return b }, c.bind = function (a, b) { return function () { a.apply(b, arguments) } }, c._convertData = function (a) { for (var b in a) { var c = b.split("-"), d = a; if (1 !== c.length) { for (var e = 0; e < c.length; e++) { var f = c[e]; f = f.substring(0, 1).toLowerCase() + f.substring(1), f in d || (d[f] = {}), e == c.length - 1 && (d[f] = a[b]), d = d[f] } delete a[b] } } return a }, c.hasScroll = function (b, c) { var d = a(c), e = c.style.overflowX, f = c.style.overflowY; return (e !== f || "hidden" !== f && "visible" !== f) && ("scroll" === e || "scroll" === f || (d.innerHeight() < c.scrollHeight || d.innerWidth() < c.scrollWidth)) }, c.escapeMarkup = function (a) { var b = { "\\": "&#92;", "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;", "/": "&#47;" }; return "string" != typeof a ? a : String(a).replace(/[&<>"'\/\\]/g, function (a) { return b[a] }) }, c.appendMany = function (b, c) { if ("1.7" === a.fn.jquery.substr(0, 3)) { var d = a(); a.map(c, function (a) { d = d.add(a) }), c = d } b.append(c) }, c.__cache = {}; var e = 0; return c.GetUniqueElementId = function (a) { var b = a.getAttribute("data-select2-id"); return null == b && (a.id ? (b = a.id, a.setAttribute("data-select2-id", b)) : (a.setAttribute("data-select2-id", ++e), b = e.toString())), b }, c.StoreData = function (a, b, d) { var e = c.GetUniqueElementId(a); c.__cache[e] || (c.__cache[e] = {}), c.__cache[e][b] = d }, c.GetData = function (b, d) { var e = c.GetUniqueElementId(b); return d ? c.__cache[e] && null != c.__cache[e][d] ? c.__cache[e][d] : a(b).data(d) : c.__cache[e] }, c.RemoveData = function (a) { var b = c.GetUniqueElementId(a); null != c.__cache[b] && delete c.__cache[b] }, c }), b.define("select2/results", ["jquery", "./utils"], function (a, b) { function c(a, b, d) { this.$element = a, this.data = d, this.options = b, c.__super__.constructor.call(this) } return b.Extend(c, b.Observable), c.prototype.render = function () { var b = a('<ul class="select2-results__options" role="tree"></ul>'); return this.options.get("multiple") && b.attr("aria-multiselectable", "true"), this.$results = b, b }, c.prototype.clear = function () { this.$results.empty() }, c.prototype.displayMessage = function (b) { var c = this.options.get("escapeMarkup"); this.clear(), this.hideLoading(); var d = a('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'), e = this.options.get("translations").get(b.message); d.append(c(e(b.args))), d[0].className += " select2-results__message", this.$results.append(d) }, c.prototype.hideMessages = function () { this.$results.find(".select2-results__message").remove() }, c.prototype.append = function (a) { this.hideLoading(); var b = []; if (null == a.results || 0 === a.results.length) return void (0 === this.$results.children().length && this.trigger("results:message", { message: "noResults" })); a.results = this.sort(a.results); for (var c = 0; c < a.results.length; c++) { var d = a.results[c], e = this.option(d); b.push(e) } this.$results.append(b) }, c.prototype.position = function (a, b) { b.find(".select2-results").append(a) }, c.prototype.sort = function (a) { return this.options.get("sorter")(a) }, c.prototype.highlightFirstItem = function () { var a = this.$results.find(".select2-results__option[aria-selected]"), b = a.filter("[aria-selected=true]"); b.length > 0 ? b.first().trigger("mouseenter") : a.first().trigger("mouseenter"), this.ensureHighlightVisible() }, c.prototype.setClasses = function () { var c = this; this.data.current(function (d) { var e = a.map(d, function (a) { return a.id.toString() }); c.$results.find(".select2-results__option[aria-selected]").each(function () { var c = a(this), d = b.GetData(this, "data"), f = "" + d.id; null != d.element && d.element.selected || null == d.element && a.inArray(f, e) > -1 ? c.attr("aria-selected", "true") : c.attr("aria-selected", "false") }) }) }, c.prototype.showLoading = function (a) { this.hideLoading(); var b = this.options.get("translations").get("searching"), c = { disabled: !0, loading: !0, text: b(a) }, d = this.option(c); d.className += " loading-results", this.$results.prepend(d) }, c.prototype.hideLoading = function () { this.$results.find(".loading-results").remove() }, c.prototype.option = function (c) { var d = document.createElement("li"); d.className = "select2-results__option"; var e = { role: "treeitem", "aria-selected": "false" }; c.disabled && (delete e["aria-selected"], e["aria-disabled"] = "true"), null == c.id && delete e["aria-selected"], null != c._resultId && (d.id = c._resultId), c.title && (d.title = c.title), c.children && (e.role = "group", e["aria-label"] = c.text, delete e["aria-selected"]); for (var f in e) { var g = e[f]; d.setAttribute(f, g) } if (c.children) { var h = a(d), i = document.createElement("strong"); i.className = "select2-results__group"; a(i); this.template(c, i); for (var j = [], k = 0; k < c.children.length; k++) { var l = c.children[k], m = this.option(l); j.push(m) } var n = a("<ul></ul>", { class: "select2-results__options select2-results__options--nested" }); n.append(j), h.append(i), h.append(n) } else this.template(c, d); return b.StoreData(d, "data", c), d }, c.prototype.bind = function (c, d) { var e = this, f = c.id + "-results"; this.$results.attr("id", f), c.on("results:all", function (a) { e.clear(), e.append(a.data), c.isOpen() && (e.setClasses(), e.highlightFirstItem()) }), c.on("results:append", function (a) { e.append(a.data), c.isOpen() && e.setClasses() }), c.on("query", function (a) { e.hideMessages(), e.showLoading(a) }), c.on("select", function () { c.isOpen() && (e.setClasses(), e.options.get("scrollAfterSelect") && e.highlightFirstItem()) }), c.on("unselect", function () { c.isOpen() && (e.setClasses(), e.options.get("scrollAfterSelect") && e.highlightFirstItem()) }), c.on("open", function () { e.$results.attr("aria-expanded", "true"), e.$results.attr("aria-hidden", "false"), e.setClasses(), e.ensureHighlightVisible() }), c.on("close", function () { e.$results.attr("aria-expanded", "false"), e.$results.attr("aria-hidden", "true"), e.$results.removeAttr("aria-activedescendant") }), c.on("results:toggle", function () { var a = e.getHighlightedResults(); 0 !== a.length && a.trigger("mouseup") }), c.on("results:select", function () { var a = e.getHighlightedResults(); if (0 !== a.length) { var c = b.GetData(a[0], "data"); "true" == a.attr("aria-selected") ? e.trigger("close", {}) : e.trigger("select", { data: c }) } }), c.on("results:previous", function () { var a = e.getHighlightedResults(), b = e.$results.find("[aria-selected]"), c = b.index(a); if (!(c <= 0)) { var d = c - 1; 0 === a.length && (d = 0); var f = b.eq(d); f.trigger("mouseenter"); var g = e.$results.offset().top, h = f.offset().top, i = e.$results.scrollTop() + (h - g); 0 === d ? e.$results.scrollTop(0) : h - g < 0 && e.$results.scrollTop(i) } }), c.on("results:next", function () { var a = e.getHighlightedResults(), b = e.$results.find("[aria-selected]"), c = b.index(a), d = c + 1; if (!(d >= b.length)) { var f = b.eq(d); f.trigger("mouseenter"); var g = e.$results.offset().top + e.$results.outerHeight(!1), h = f.offset().top + f.outerHeight(!1), i = e.$results.scrollTop() + h - g; 0 === d ? e.$results.scrollTop(0) : h > g && e.$results.scrollTop(i) } }), c.on("results:focus", function (a) { a.element.addClass("select2-results__option--highlighted") }), c.on("results:message", function (a) { e.displayMessage(a) }), a.fn.mousewheel && this.$results.on("mousewheel", function (a) { var b = e.$results.scrollTop(), c = e.$results.get(0).scrollHeight - b + a.deltaY, d = a.deltaY > 0 && b - a.deltaY <= 0, f = a.deltaY < 0 && c <= e.$results.height(); d ? (e.$results.scrollTop(0), a.preventDefault(), a.stopPropagation()) : f && (e.$results.scrollTop(e.$results.get(0).scrollHeight - e.$results.height()), a.preventDefault(), a.stopPropagation()) }), this.$results.on("mouseup", ".select2-results__option[aria-selected]", function (c) { var d = a(this), f = b.GetData(this, "data"); if ("true" === d.attr("aria-selected")) return void (e.options.get("multiple") ? e.trigger("unselect", { originalEvent: c, data: f }) : e.trigger("close", {})); e.trigger("select", { originalEvent: c, data: f }) }), this.$results.on("mouseenter", ".select2-results__option[aria-selected]", function (c) { var d = b.GetData(this, "data"); e.getHighlightedResults().removeClass("select2-results__option--highlighted"), e.trigger("results:focus", { data: d, element: a(this) }) }) }, c.prototype.getHighlightedResults = function () { return this.$results.find(".select2-results__option--highlighted") }, c.prototype.destroy = function () { this.$results.remove() }, c.prototype.ensureHighlightVisible = function () { var a = this.getHighlightedResults(); if (0 !== a.length) { var b = this.$results.find("[aria-selected]"), c = b.index(a), d = this.$results.offset().top, e = a.offset().top, f = this.$results.scrollTop() + (e - d), g = e - d; f -= 2 * a.outerHeight(!1), c <= 2 ? this.$results.scrollTop(0) : (g > this.$results.outerHeight() || g < 0) && this.$results.scrollTop(f) } }, c.prototype.template = function (b, c) { var d = this.options.get("templateResult"), e = this.options.get("escapeMarkup"), f = d(b, c); null == f ? c.style.display = "none" : "string" == typeof f ? c.innerHTML = e(f) : a(c).append(f) }, c }), b.define("select2/keys", [], function () { return { BACKSPACE: 8, TAB: 9, ENTER: 13, SHIFT: 16, CTRL: 17, ALT: 18, ESC: 27, SPACE: 32, PAGE_UP: 33, PAGE_DOWN: 34, END: 35, HOME: 36, LEFT: 37, UP: 38, RIGHT: 39, DOWN: 40, DELETE: 46 } }), b.define("select2/selection/base", ["jquery", "../utils", "../keys"], function (a, b, c) { function d(a, b) { this.$element = a, this.options = b, d.__super__.constructor.call(this) } return b.Extend(d, b.Observable), d.prototype.render = function () { var c = a('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>'); return this._tabindex = 0, null != b.GetData(this.$element[0], "old-tabindex") ? this._tabindex = b.GetData(this.$element[0], "old-tabindex") : null != this.$element.attr("tabindex") && (this._tabindex = this.$element.attr("tabindex")), c.attr("title", this.$element.attr("title")), c.attr("tabindex", this._tabindex), this.$selection = c, c }, d.prototype.bind = function (a, b) { var d = this, e = (a.id, a.id + "-results"); this.container = a, this.$selection.on("focus", function (a) { d.trigger("focus", a) }), this.$selection.on("blur", function (a) { d._handleBlur(a) }), this.$selection.on("keydown", function (a) { d.trigger("keypress", a), a.which === c.SPACE && a.preventDefault() }), a.on("results:focus", function (a) { d.$selection.attr("aria-activedescendant", a.data._resultId) }), a.on("selection:update", function (a) { d.update(a.data) }), a.on("open", function () { d.$selection.attr("aria-expanded", "true"), d.$selection.attr("aria-owns", e), d._attachCloseHandler(a) }), a.on("close", function () { d.$selection.attr("aria-expanded", "false"), d.$selection.removeAttr("aria-activedescendant"), d.$selection.removeAttr("aria-owns"), window.setTimeout(function () { d.$selection.focus() }, 0), d._detachCloseHandler(a) }), a.on("enable", function () { d.$selection.attr("tabindex", d._tabindex) }), a.on("disable", function () { d.$selection.attr("tabindex", "-1") }) }, d.prototype._handleBlur = function (b) { var c = this; window.setTimeout(function () { document.activeElement == c.$selection[0] || a.contains(c.$selection[0], document.activeElement) || c.trigger("blur", b) }, 1) }, d.prototype._attachCloseHandler = function (c) { a(document.body).on("mousedown.select2." + c.id, function (c) { var d = a(c.target), e = d.closest(".select2"); a(".select2.select2-container--open").each(function () { a(this), this != e[0] && b.GetData(this, "element").select2("close") }) }) }, d.prototype._detachCloseHandler = function (b) { a(document.body).off("mousedown.select2." + b.id) }, d.prototype.position = function (a, b) { b.find(".selection").append(a) }, d.prototype.destroy = function () { this._detachCloseHandler(this.container) }, d.prototype.update = function (a) { throw new Error("The `update` method must be defined in child classes.") }, d }), b.define("select2/selection/single", ["jquery", "./base", "../utils", "../keys"], function (a, b, c, d) { function e() { e.__super__.constructor.apply(this, arguments) } return c.Extend(e, b), e.prototype.render = function () { var a = e.__super__.render.call(this); return a.addClass("select2-selection--single"), a.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'), a }, e.prototype.bind = function (a, b) { var c = this; e.__super__.bind.apply(this, arguments); var d = a.id + "-container"; this.$selection.find(".select2-selection__rendered").attr("id", d).attr("role", "textbox").attr("aria-readonly", "true"), this.$selection.attr("aria-labelledby", d), this.$selection.on("mousedown", function (a) { 1 === a.which && c.trigger("toggle", { originalEvent: a }) }), this.$selection.on("focus", function (a) { }), this.$selection.on("blur", function (a) { }), a.on("focus", function (b) { a.isOpen() || c.$selection.focus() }) }, e.prototype.clear = function () { var a = this.$selection.find(".select2-selection__rendered"); a.empty(), a.removeAttr("title") }, e.prototype.display = function (a, b) { var c = this.options.get("templateSelection"); return this.options.get("escapeMarkup")(c(a, b)) }, e.prototype.selectionContainer = function () { return a("<span></span>") }, e.prototype.update = function (a) { if (0 === a.length) return void this.clear(); var b = a[0], c = this.$selection.find(".select2-selection__rendered"), d = this.display(b, c); c.empty().append(d), c.attr("title", b.title || b.text) }, e }), b.define("select2/selection/multiple", ["jquery", "./base", "../utils"], function (a, b, c) { function d(a, b) { d.__super__.constructor.apply(this, arguments) } return c.Extend(d, b), d.prototype.render = function () { var a = d.__super__.render.call(this); return a.addClass("select2-selection--multiple"), a.html('<ul class="select2-selection__rendered"></ul>'), a }, d.prototype.bind = function (b, e) { var f = this; d.__super__.bind.apply(this, arguments), this.$selection.on("click", function (a) { f.trigger("toggle", { originalEvent: a }) }), this.$selection.on("click", ".select2-selection__choice__remove", function (b) { if (!f.options.get("disabled")) { var d = a(this), e = d.parent(), g = c.GetData(e[0], "data"); f.trigger("unselect", { originalEvent: b, data: g }) } }) }, d.prototype.clear = function () { var a = this.$selection.find(".select2-selection__rendered"); a.empty(), a.removeAttr("title") }, d.prototype.display = function (a, b) { var c = this.options.get("templateSelection"); return this.options.get("escapeMarkup")(c(a, b)) }, d.prototype.selectionContainer = function () { return a('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>') }, d.prototype.update = function (a) { if (this.clear(), 0 !== a.length) { for (var b = [], d = 0; d < a.length; d++) { var e = a[d], f = this.selectionContainer(), g = this.display(e, f); f.append(g), f.attr("title", e.title || e.text), c.StoreData(f[0], "data", e), b.push(f) } var h = this.$selection.find(".select2-selection__rendered"); c.appendMany(h, b) } }, d }), b.define("select2/selection/placeholder", ["../utils"], function (a) { function b(a, b, c) { this.placeholder = this.normalizePlaceholder(c.get("placeholder")), a.call(this, b, c) } return b.prototype.normalizePlaceholder = function (a, b) { return "string" == typeof b && (b = { id: "", text: b }), b }, b.prototype.createPlaceholder = function (a, b) { var c = this.selectionContainer(); return c.html(this.display(b)), c.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"), c }, b.prototype.update = function (a, b) { var c = 1 == b.length && b[0].id != this.placeholder.id; if (b.length > 1 || c) return a.call(this, b); this.clear(); var d = this.createPlaceholder(this.placeholder); this.$selection.find(".select2-selection__rendered").append(d) }, b }), b.define("select2/selection/allowClear", ["jquery", "../keys", "../utils"], function (a, b, c) { function d() { } return d.prototype.bind = function (a, b, c) { var d = this; a.call(this, b, c), null == this.placeholder && this.options.get("debug") && window.console && console.error && console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."), this.$selection.on("mousedown", ".select2-selection__clear", function (a) { d._handleClear(a) }), b.on("keypress", function (a) { d._handleKeyboardClear(a, b) }) }, d.prototype._handleClear = function (a, b) { if (!this.options.get("disabled")) { var d = this.$selection.find(".select2-selection__clear"); if (0 !== d.length) { b.stopPropagation(); var e = c.GetData(d[0], "data"), f = this.$element.val(); this.$element.val(this.placeholder.id); var g = { data: e }; if (this.trigger("clear", g), g.prevented) return void this.$element.val(f); for (var h = 0; h < e.length; h++)if (g = { data: e[h] }, this.trigger("unselect", g), g.prevented) return void this.$element.val(f); this.$element.trigger("change"), this.trigger("toggle", {}) } } }, d.prototype._handleKeyboardClear = function (a, c, d) { d.isOpen() || c.which != b.DELETE && c.which != b.BACKSPACE || this._handleClear(c) }, d.prototype.update = function (b, d) { if (b.call(this, d), !(this.$selection.find(".select2-selection__placeholder").length > 0 || 0 === d.length)) { var e = this.options.get("translations").get("removeAllItems"), f = a('<span class="select2-selection__clear" title="' + e() + '">&times;</span>'); c.StoreData(f[0], "data", d), this.$selection.find(".select2-selection__rendered").prepend(f) } }, d }), b.define("select2/selection/search", ["jquery", "../utils", "../keys"], function (a, b, c) { function d(a, b, c) { a.call(this, b, c) } return d.prototype.render = function (b) { var c = a('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>'); this.$searchContainer = c, this.$search = c.find("input"); var d = b.call(this); return this._transferTabIndex(), d }, d.prototype.bind = function (a, d, e) { var f = this; a.call(this, d, e), d.on("open", function () { f.$search.trigger("focus") }), d.on("close", function () { f.$search.val(""), f.$search.removeAttr("aria-activedescendant"), f.$search.trigger("focus") }), d.on("enable", function () { f.$search.prop("disabled", !1), f._transferTabIndex() }), d.on("disable", function () { f.$search.prop("disabled", !0) }), d.on("focus", function (a) { f.$search.trigger("focus") }), d.on("results:focus", function (a) { f.$search.attr("aria-activedescendant", a.id) }), this.$selection.on("focusin", ".select2-search--inline", function (a) { f.trigger("focus", a) }), this.$selection.on("focusout", ".select2-search--inline", function (a) { f._handleBlur(a) }), this.$selection.on("keydown", ".select2-search--inline", function (a) { if (a.stopPropagation(), f.trigger("keypress", a), f._keyUpPrevented = a.isDefaultPrevented(), a.which === c.BACKSPACE && "" === f.$search.val()) { var d = f.$searchContainer.prev(".select2-selection__choice"); if (d.length > 0) { var e = b.GetData(d[0], "data"); f.searchRemoveChoice(e), a.preventDefault() } } }); var g = document.documentMode, h = g && g <= 11; this.$selection.on("input.searchcheck", ".select2-search--inline", function (a) { if (h) return void f.$selection.off("input.search input.searchcheck"); f.$selection.off("keyup.search") }), this.$selection.on("keyup.search input.search", ".select2-search--inline", function (a) { if (h && "input" === a.type) return void f.$selection.off("input.search input.searchcheck"); var b = a.which; b != c.SHIFT && b != c.CTRL && b != c.ALT && b != c.TAB && f.handleSearch(a) }) }, d.prototype._transferTabIndex = function (a) { this.$search.attr("tabindex", this.$selection.attr("tabindex")), this.$selection.attr("tabindex", "-1") }, d.prototype.createPlaceholder = function (a, b) { this.$search.attr("placeholder", b.text) }, d.prototype.update = function (a, b) { var c = this.$search[0] == document.activeElement; if (this.$search.attr("placeholder", ""), a.call(this, b), this.$selection.find(".select2-selection__rendered").append(this.$searchContainer), this.resizeSearch(), c) { this.$element.find("[data-select2-tag]").length ? this.$element.focus() : this.$search.focus() } }, d.prototype.handleSearch = function () { if (this.resizeSearch(), !this._keyUpPrevented) { var a = this.$search.val(); this.trigger("query", { term: a }) } this._keyUpPrevented = !1 }, d.prototype.searchRemoveChoice = function (a, b) { this.trigger("unselect", { data: b }), this.$search.val(b.text), this.handleSearch() }, d.prototype.resizeSearch = function () { this.$search.css("width", "25px"); var a = ""; if ("" !== this.$search.attr("placeholder")) a = this.$selection.find(".select2-selection__rendered").innerWidth(); else { a = .75 * (this.$search.val().length + 1) + "em" } this.$search.css("width", a) }, d }), b.define("select2/selection/eventRelay", ["jquery"], function (a) { function b() { } return b.prototype.bind = function (b, c, d) { var e = this, f = ["open", "opening", "close", "closing", "select", "selecting", "unselect", "unselecting", "clear", "clearing"], g = ["opening", "closing", "selecting", "unselecting", "clearing"]; b.call(this, c, d), c.on("*", function (b, c) { if (-1 !== a.inArray(b, f)) { c = c || {}; var d = a.Event("select2:" + b, { params: c }); e.$element.trigger(d), -1 !== a.inArray(b, g) && (c.prevented = d.isDefaultPrevented()) } }) }, b }), b.define("select2/translation", ["jquery", "require"], function (a, b) { function c(a) { this.dict = a || {} } return c.prototype.all = function () { return this.dict }, c.prototype.get = function (a) { return this.dict[a] }, c.prototype.extend = function (b) { this.dict = a.extend({}, b.all(), this.dict) }, c._cache = {}, c.loadPath = function (a) { if (!(a in c._cache)) { var d = b(a); c._cache[a] = d } return new c(c._cache[a]) }, c }), b.define("select2/diacritics", [], function () { return { "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "A", "": "AA", "": "AE", "": "AE", "": "AE", "": "AO", "": "AU", "": "AV", "": "AV", "": "AY", "": "B", "": "B", "": "B", "": "B", "": "B", "": "B", "": "B", "": "B", "": "C", "": "C", "": "C", "": "C", "": "C", "": "C", "": "C", "": "C", "": "C", "": "C", "": "C", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "D", "": "DZ", "": "DZ", "": "Dz", "": "Dz", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "E", "": "F", "": "F", "": "F", "": "F", "": "F", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "G", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "H", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "I", "": "J", "": "J", "": "J", "": "J", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "K", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "L", "": "LJ", "": "Lj", "": "M", "": "M", "": "M", "": "M", "": "M", "": "M", "": "M", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "N", "": "NJ", "": "Nj", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "O", "": "OE", "": "OI", "": "OO", "": "OU", "": "P", "": "P", "": "P", "": "P", "": "P", "": "P", "": "P", "": "P", "": "P", "": "Q", "": "Q", "": "Q", "": "Q", "": "Q", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "R", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "S", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "T", "": "TZ", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "U", "": "V", "": "V", "": "V", "": "V", "": "V", "": "V", "": "V", "": "VY", "": "W", "": "W", "": "W", "": "W", "": "W", "": "W", "": "W", "": "W", "": "W", "": "X", "": "X", "": "X", "": "X", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Y", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "Z", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "a", "": "aa", "": "ae", "": "ae", "": "ae", "": "ao", "": "au", "": "av", "": "av", "": "ay", "": "b", "": "b", "": "b", "": "b", "": "b", "": "b", "": "b", "": "b", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "c", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "d", "": "dz", "": "dz", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "e", "": "f", "": "f", "": "f", "": "f", "": "f", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "g", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "h", "": "hv", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "i", "": "j", "": "j", "": "j", "": "j", "": "j", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "k", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "l", "": "lj", "": "m", "": "m", "": "m", "": "m", "": "m", "": "m", "": "m", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "n", "": "nj", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "o", "": "oe", "": "oi", "": "ou", "": "oo", "": "p", "": "p", "": "p", "": "p", "": "p", "": "p", "": "p", "": "p", "": "p", "": "q", "": "q", "": "q", "": "q", "": "q", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "r", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "s", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "t", "": "tz", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "u", "": "v", "": "v", "": "v", "": "v", "": "v", "": "v", "": "v", "": "vy", "": "w", "": "w", "": "w", "": "w", "": "w", "": "w", "": "w", "": "w", "": "w", "": "w", "": "x", "": "x", "": "x", "": "x", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "y", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "z", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "", "": "'" } }), b.define("select2/data/base", ["../utils"], function (a) { function b(a, c) { b.__super__.constructor.call(this) } return a.Extend(b, a.Observable), b.prototype.current = function (a) { throw new Error("The `current` method must be defined in child classes.") }, b.prototype.query = function (a, b) { throw new Error("The `query` method must be defined in child classes.") }, b.prototype.bind = function (a, b) { }, b.prototype.destroy = function () { }, b.prototype.generateResultId = function (b, c) { var d = b.id + "-result-"; return d += a.generateChars(4), null != c.id ? d += "-" + c.id.toString() : d += "-" + a.generateChars(4), d }, b }), b.define("select2/data/select", ["./base", "../utils", "jquery"], function (a, b, c) { function d(a, b) { this.$element = a, this.options = b, d.__super__.constructor.call(this) } return b.Extend(d, a), d.prototype.current = function (a) { var b = [], d = this; this.$element.find(":selected").each(function () { var a = c(this), e = d.item(a); b.push(e) }), a(b) }, d.prototype.select = function (a) { var b = this; if (a.selected = !0, c(a.element).is("option")) return a.element.selected = !0, void this.$element.trigger("change"); if (this.$element.prop("multiple")) this.current(function (d) { var e = []; a = [a], a.push.apply(a, d); for (var f = 0; f < a.length; f++) { var g = a[f].id; -1 === c.inArray(g, e) && e.push(g) } b.$element.val(e), b.$element.trigger("change") }); else { var d = a.id; this.$element.val(d), this.$element.trigger("change") } }, d.prototype.unselect = function (a) { var b = this; if (this.$element.prop("multiple")) { if (a.selected = !1, c(a.element).is("option")) return a.element.selected = !1, void this.$element.trigger("change"); this.current(function (d) { for (var e = [], f = 0; f < d.length; f++) { var g = d[f].id; g !== a.id && -1 === c.inArray(g, e) && e.push(g) } b.$element.val(e), b.$element.trigger("change") }) } }, d.prototype.bind = function (a, b) { var c = this; this.container = a, a.on("select", function (a) { c.select(a.data) }), a.on("unselect", function (a) { c.unselect(a.data) }) }, d.prototype.destroy = function () { this.$element.find("*").each(function () { b.RemoveData(this) }) }, d.prototype.query = function (a, b) { var d = [], e = this; this.$element.children().each(function () { var b = c(this); if (b.is("option") || b.is("optgroup")) { var f = e.item(b), g = e.matches(a, f); null !== g && d.push(g) } }), b({ results: d }) }, d.prototype.addOptions = function (a) { b.appendMany(this.$element, a) }, d.prototype.option = function (a) { var d; a.children ? (d = document.createElement("optgroup"), d.label = a.text) : (d = document.createElement("option"), void 0 !== d.textContent ? d.textContent = a.text : d.innerText = a.text), void 0 !== a.id && (d.value = a.id), a.disabled && (d.disabled = !0), a.selected && (d.selected = !0), a.title && (d.title = a.title); var e = c(d), f = this._normalizeItem(a); return f.element = d, b.StoreData(d, "data", f), e }, d.prototype.item = function (a) { var d = {}; if (null != (d = b.GetData(a[0], "data"))) return d; if (a.is("option")) d = { id: a.val(), text: a.text(), disabled: a.prop("disabled"), selected: a.prop("selected"), title: a.prop("title") }; else if (a.is("optgroup")) { d = { text: a.prop("label"), children: [], title: a.prop("title") }; for (var e = a.children("option"), f = [], g = 0; g < e.length; g++) { var h = c(e[g]), i = this.item(h); f.push(i) } d.children = f } return d = this._normalizeItem(d), d.element = a[0], b.StoreData(a[0], "data", d), d }, d.prototype._normalizeItem = function (a) { a !== Object(a) && (a = { id: a, text: a }), a = c.extend({}, { text: "" }, a); var b = { selected: !1, disabled: !1 }; return null != a.id && (a.id = a.id.toString()), null != a.text && (a.text = a.text.toString()), null == a._resultId && a.id && null != this.container && (a._resultId = this.generateResultId(this.container, a)), c.extend({}, b, a) }, d.prototype.matches = function (a, b) { return this.options.get("matcher")(a, b) }, d }), b.define("select2/data/array", ["./select", "../utils", "jquery"], function (a, b, c) { function d(a, b) { var c = b.get("data") || []; d.__super__.constructor.call(this, a, b), this.addOptions(this.convertToOptions(c)) } return b.Extend(d, a), d.prototype.select = function (a) { var b = this.$element.find("option").filter(function (b, c) { return c.value == a.id.toString() }); 0 === b.length && (b = this.option(a), this.addOptions(b)), d.__super__.select.call(this, a) }, d.prototype.convertToOptions = function (a) { function d(a) { return function () { return c(this).val() == a.id } } for (var e = this, f = this.$element.find("option"), g = f.map(function () { return e.item(c(this)).id }).get(), h = [], i = 0; i < a.length; i++) { var j = this._normalizeItem(a[i]); if (c.inArray(j.id, g) >= 0) { var k = f.filter(d(j)), l = this.item(k), m = c.extend(!0, {}, j, l), n = this.option(m); k.replaceWith(n) } else { var o = this.option(j); if (j.children) { var p = this.convertToOptions(j.children); b.appendMany(o, p) } h.push(o) } } return h }, d }), b.define("select2/data/ajax", ["./array", "../utils", "jquery"], function (a, b, c) { function d(a, b) { this.ajaxOptions = this._applyDefaults(b.get("ajax")), null != this.ajaxOptions.processResults && (this.processResults = this.ajaxOptions.processResults), d.__super__.constructor.call(this, a, b) } return b.Extend(d, a), d.prototype._applyDefaults = function (a) { var b = { data: function (a) { return c.extend({}, a, { q: a.term }) }, transport: function (a, b, d) { var e = c.ajax(a); return e.then(b), e.fail(d), e } }; return c.extend({}, b, a, !0) }, d.prototype.processResults = function (a) { return a }, d.prototype.query = function (a, b) { function d() { var d = f.transport(f, function (d) { var f = e.processResults(d, a); e.options.get("debug") && window.console && console.error && (f && f.results && c.isArray(f.results) || console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")), b(f) }, function () { "status" in d && (0 === d.status || "0" === d.status) || e.trigger("results:message", { message: "errorLoading" }) }); e._request = d } var e = this; null != this._request && (c.isFunction(this._request.abort) && this._request.abort(), this._request = null); var f = c.extend({ type: "GET" }, this.ajaxOptions); "function" == typeof f.url && (f.url = f.url.call(this.$element, a)), "function" == typeof f.data && (f.data = f.data.call(this.$element, a)), this.ajaxOptions.delay && null != a.term ? (this._queryTimeout && window.clearTimeout(this._queryTimeout), this._queryTimeout = window.setTimeout(d, this.ajaxOptions.delay)) : d() }, d }), b.define("select2/data/tags", ["jquery"], function (a) { function b(b, c, d) { var e = d.get("tags"), f = d.get("createTag"); void 0 !== f && (this.createTag = f); var g = d.get("insertTag"); if (void 0 !== g && (this.insertTag = g), b.call(this, c, d), a.isArray(e)) for (var h = 0; h < e.length; h++) { var i = e[h], j = this._normalizeItem(i), k = this.option(j); this.$element.append(k) } } return b.prototype.query = function (a, b, c) { function d(a, f) { for (var g = a.results, h = 0; h < g.length; h++) { var i = g[h], j = null != i.children && !d({ results: i.children }, !0); if ((i.text || "").toUpperCase() === (b.term || "").toUpperCase() || j) return !f && (a.data = g, void c(a)) } if (f) return !0; var k = e.createTag(b); if (null != k) { var l = e.option(k); l.attr("data-select2-tag", !0), e.addOptions([l]), e.insertTag(g, k) } a.results = g, c(a) } var e = this; if (this._removeOldTags(), null == b.term || null != b.page) return void a.call(this, b, c); a.call(this, b, d) }, b.prototype.createTag = function (b, c) { var d = a.trim(c.term); return "" === d ? null : { id: d, text: d } }, b.prototype.insertTag = function (a, b, c) { b.unshift(c) }, b.prototype._removeOldTags = function (b) { this._lastTag; this.$element.find("option[data-select2-tag]").each(function () { this.selected || a(this).remove() }) }, b }), b.define("select2/data/tokenizer", ["jquery"], function (a) { function b(a, b, c) { var d = c.get("tokenizer"); void 0 !== d && (this.tokenizer = d), a.call(this, b, c) } return b.prototype.bind = function (a, b, c) { a.call(this, b, c), this.$search = b.dropdown.$search || b.selection.$search || c.find(".select2-search__field") }, b.prototype.query = function (b, c, d) { function e(b) { var c = g._normalizeItem(b); if (!g.$element.find("option").filter(function () { return a(this).val() === c.id }).length) { var d = g.option(c); d.attr("data-select2-tag", !0), g._removeOldTags(), g.addOptions([d]) } f(c) } function f(a) { g.trigger("select", { data: a }) } var g = this; c.term = c.term || ""; var h = this.tokenizer(c, this.options, e); h.term !== c.term && (this.$search.length && (this.$search.val(h.term), this.$search.focus()), c.term = h.term), b.call(this, c, d) }, b.prototype.tokenizer = function (b, c, d, e) { for (var f = d.get("tokenSeparators") || [], g = c.term, h = 0, i = this.createTag || function (a) { return { id: a.term, text: a.term } }; h < g.length;) { var j = g[h]; if (-1 !== a.inArray(j, f)) { var k = g.substr(0, h), l = a.extend({}, c, { term: k }), m = i(l); null != m ? (e(m), g = g.substr(h + 1) || "", h = 0) : h++ } else h++ } return { term: g } }, b }), b.define("select2/data/minimumInputLength", [], function () { function a(a, b, c) { this.minimumInputLength = c.get("minimumInputLength"), a.call(this, b, c) } return a.prototype.query = function (a, b, c) { if (b.term = b.term || "", b.term.length < this.minimumInputLength) return void this.trigger("results:message", { message: "inputTooShort", args: { minimum: this.minimumInputLength, input: b.term, params: b } }); a.call(this, b, c) }, a }), b.define("select2/data/maximumInputLength", [], function () { function a(a, b, c) { this.maximumInputLength = c.get("maximumInputLength"), a.call(this, b, c) } return a.prototype.query = function (a, b, c) { if (b.term = b.term || "", this.maximumInputLength > 0 && b.term.length > this.maximumInputLength) return void this.trigger("results:message", { message: "inputTooLong", args: { maximum: this.maximumInputLength, input: b.term, params: b } }); a.call(this, b, c) }, a }), b.define("select2/data/maximumSelectionLength", [], function () { function a(a, b, c) { this.maximumSelectionLength = c.get("maximumSelectionLength"), a.call(this, b, c) } return a.prototype.query = function (a, b, c) { var d = this; this.current(function (e) { var f = null != e ? e.length : 0; if (d.maximumSelectionLength > 0 && f >= d.maximumSelectionLength) return void d.trigger("results:message", { message: "maximumSelected", args: { maximum: d.maximumSelectionLength } }); a.call(d, b, c) }) }, a }), b.define("select2/dropdown", ["jquery", "./utils"], function (a, b) { function c(a, b) { this.$element = a, this.options = b, c.__super__.constructor.call(this) } return b.Extend(c, b.Observable), c.prototype.render = function () { var b = a('<span class="select2-dropdown"><span class="select2-results"></span></span>'); return b.attr("dir", this.options.get("dir")), this.$dropdown = b, b }, c.prototype.bind = function () { }, c.prototype.position = function (a, b) { }, c.prototype.destroy = function () { this.$dropdown.remove() }, c }), b.define("select2/dropdown/search", ["jquery", "../utils"], function (a, b) { function c() { } return c.prototype.render = function (b) { var c = b.call(this), d = a('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" role="textbox" /></span>'); return this.$searchContainer = d, this.$search = d.find("input"), c.prepend(d), c }, c.prototype.bind = function (b, c, d) { var e = this; b.call(this, c, d), this.$search.on("keydown", function (a) { e.trigger("keypress", a), e._keyUpPrevented = a.isDefaultPrevented() }), this.$search.on("input", function (b) { a(this).off("keyup") }), this.$search.on("keyup input", function (a) { e.handleSearch(a) }), c.on("open", function () { e.$search.attr("tabindex", 0), e.$search.focus(), window.setTimeout(function () { e.$search.focus() }, 0) }), c.on("close", function () { e.$search.attr("tabindex", -1), e.$search.val(""), e.$search.blur() }), c.on("focus", function () { c.isOpen() || e.$search.focus() }), c.on("results:all", function (a) { if (null == a.query.term || "" === a.query.term) { e.showSearch(a) ? e.$searchContainer.removeClass("select2-search--hide") : e.$searchContainer.addClass("select2-search--hide") } }) }, c.prototype.handleSearch = function (a) { if (!this._keyUpPrevented) { var b = this.$search.val(); this.trigger("query", { term: b }) } this._keyUpPrevented = !1 }, c.prototype.showSearch = function (a, b) { return !0 }, c }), b.define("select2/dropdown/hidePlaceholder", [], function () { function a(a, b, c, d) { this.placeholder = this.normalizePlaceholder(c.get("placeholder")), a.call(this, b, c, d) } return a.prototype.append = function (a, b) { b.results = this.removePlaceholder(b.results), a.call(this, b) }, a.prototype.normalizePlaceholder = function (a, b) { return "string" == typeof b && (b = { id: "", text: b }), b }, a.prototype.removePlaceholder = function (a, b) { for (var c = b.slice(0), d = b.length - 1; d >= 0; d--) { var e = b[d]; this.placeholder.id === e.id && c.splice(d, 1) } return c }, a }), b.define("select2/dropdown/infiniteScroll", ["jquery"], function (a) { function b(a, b, c, d) { this.lastParams = {}, a.call(this, b, c, d), this.$loadingMore = this.createLoadingMore(), this.loading = !1 } return b.prototype.append = function (a, b) { this.$loadingMore.remove(), this.loading = !1, a.call(this, b), this.showLoadingMore(b) && this.$results.append(this.$loadingMore) }, b.prototype.bind = function (b, c, d) { var e = this; b.call(this, c, d), c.on("query", function (a) { e.lastParams = a, e.loading = !0 }), c.on("query:append", function (a) { e.lastParams = a, e.loading = !0 }), this.$results.on("scroll", function () { var b = a.contains(document.documentElement, e.$loadingMore[0]); if (!e.loading && b) { e.$results.offset().top + e.$results.outerHeight(!1) + 50 >= e.$loadingMore.offset().top + e.$loadingMore.outerHeight(!1) && e.loadMore() } }) }, b.prototype.loadMore = function () { this.loading = !0; var b = a.extend({}, { page: 1 }, this.lastParams); b.page++, this.trigger("query:append", b) }, b.prototype.showLoadingMore = function (a, b) { return b.pagination && b.pagination.more }, b.prototype.createLoadingMore = function () { var b = a('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'), c = this.options.get("translations").get("loadingMore"); return b.html(c(this.lastParams)), b }, b }), b.define("select2/dropdown/attachBody", ["jquery", "../utils"], function (a, b) { function c(b, c, d) { this.$dropdownParent = d.get("dropdownParent") || a(document.body), b.call(this, c, d) } return c.prototype.bind = function (a, b, c) { var d = this, e = !1; a.call(this, b, c), b.on("open", function () { d._showDropdown(), d._attachPositioningHandler(b), e || (e = !0, b.on("results:all", function () { d._positionDropdown(), d._resizeDropdown() }), b.on("results:append", function () { d._positionDropdown(), d._resizeDropdown() })) }), b.on("close", function () { d._hideDropdown(), d._detachPositioningHandler(b) }), this.$dropdownContainer.on("mousedown", function (a) { a.stopPropagation() }) }, c.prototype.destroy = function (a) { a.call(this), this.$dropdownContainer.remove() }, c.prototype.position = function (a, b, c) { b.attr("class", c.attr("class")), b.removeClass("select2"), b.addClass("select2-container--open"), b.css({ position: "absolute", top: -999999 }), this.$container = c }, c.prototype.render = function (b) { var c = a("<span></span>"), d = b.call(this); return c.append(d), this.$dropdownContainer = c, c }, c.prototype._hideDropdown = function (a) { this.$dropdownContainer.detach() }, c.prototype._attachPositioningHandler = function (c, d) { var e = this, f = "scroll.select2." + d.id, g = "resize.select2." + d.id, h = "orientationchange.select2." + d.id, i = this.$container.parents().filter(b.hasScroll); i.each(function () { b.StoreData(this, "select2-scroll-position", { x: a(this).scrollLeft(), y: a(this).scrollTop() }) }), i.on(f, function (c) { var d = b.GetData(this, "select2-scroll-position"); a(this).scrollTop(d.y) }), a(window).on(f + " " + g + " " + h, function (a) { e._positionDropdown(), e._resizeDropdown() }) }, c.prototype._detachPositioningHandler = function (c, d) { var e = "scroll.select2." + d.id, f = "resize.select2." + d.id, g = "orientationchange.select2." + d.id; this.$container.parents().filter(b.hasScroll).off(e), a(window).off(e + " " + f + " " + g) }, c.prototype._positionDropdown = function () { var b = a(window), c = this.$dropdown.hasClass("select2-dropdown--above"), d = this.$dropdown.hasClass("select2-dropdown--below"), e = null, f = this.$container.offset(); f.bottom = f.top + this.$container.outerHeight(!1); var g = { height: this.$container.outerHeight(!1) }; g.top = f.top, g.bottom = f.top + g.height; var h = { height: this.$dropdown.outerHeight(!1) }, i = { top: b.scrollTop(), bottom: b.scrollTop() + b.height() }, j = i.top < f.top - h.height, k = i.bottom > f.bottom + h.height, l = { left: f.left, top: g.bottom }, m = this.$dropdownParent; "static" === m.css("position") && (m = m.offsetParent()); var n = m.offset(); l.top -= n.top, l.left -= n.left, c || d || (e = "below"), k || !j || c ? !j && k && c && (e = "below") : e = "above", ("above" == e || c && "below" !== e) && (l.top = g.top - n.top - h.height), null != e && (this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--" + e), this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--" + e)), this.$dropdownContainer.css(l) }, c.prototype._resizeDropdown = function () { var a = { width: this.$container.outerWidth(!1) + "px" }; this.options.get("dropdownAutoWidth") && (a.minWidth = a.width, a.position = "relative", a.width = "auto"), this.$dropdown.css(a) }, c.prototype._showDropdown = function (a) { this.$dropdownContainer.appendTo(this.$dropdownParent), this._positionDropdown(), this._resizeDropdown() }, c }), b.define("select2/dropdown/minimumResultsForSearch", [], function () { function a(b) { for (var c = 0, d = 0; d < b.length; d++) { var e = b[d]; e.children ? c += a(e.children) : c++ } return c } function b(a, b, c, d) { this.minimumResultsForSearch = c.get("minimumResultsForSearch"), this.minimumResultsForSearch < 0 && (this.minimumResultsForSearch = 1 / 0), a.call(this, b, c, d) } return b.prototype.showSearch = function (b, c) { return !(a(c.data.results) < this.minimumResultsForSearch) && b.call(this, c) }, b }), b.define("select2/dropdown/selectOnClose", ["../utils"], function (a) { function b() { } return b.prototype.bind = function (a, b, c) { var d = this; a.call(this, b, c), b.on("close", function (a) { d._handleSelectOnClose(a) }) }, b.prototype._handleSelectOnClose = function (b, c) { if (c && null != c.originalSelect2Event) { var d = c.originalSelect2Event; if ("select" === d._type || "unselect" === d._type) return } var e = this.getHighlightedResults(); if (!(e.length < 1)) { var f = a.GetData(e[0], "data"); null != f.element && f.element.selected || null == f.element && f.selected || this.trigger("select", { data: f }) } }, b }), b.define("select2/dropdown/closeOnSelect", [], function () { function a() { } return a.prototype.bind = function (a, b, c) { var d = this; a.call(this, b, c), b.on("select", function (a) { d._selectTriggered(a) }), b.on("unselect", function (a) { d._selectTriggered(a) }) }, a.prototype._selectTriggered = function (a, b) { var c = b.originalEvent; c && (c.ctrlKey || c.metaKey) || this.trigger("close", { originalEvent: c, originalSelect2Event: b }) }, a }), b.define("select2/i18n/en", [], function () { return { errorLoading: function () { return "The results could not be loaded." }, inputTooLong: function (a) { var b = a.input.length - a.maximum, c = "Please delete " + b + " character"; return 1 != b && (c += "s"), c }, inputTooShort: function (a) { return "Please enter " + (a.minimum - a.input.length) + " or more characters" }, loadingMore: function () { return "Loading more results" }, maximumSelected: function (a) { var b = "You can only select " + a.maximum + " item"; return 1 != a.maximum && (b += "s"), b }, noResults: function () { return "No results found" }, searching: function () { return "Searching" }, removeAllItems: function () { return "Remove all items" } } }), b.define("select2/defaults", ["jquery", "require", "./results", "./selection/single", "./selection/multiple", "./selection/placeholder", "./selection/allowClear", "./selection/search", "./selection/eventRelay", "./utils", "./translation", "./diacritics", "./data/select", "./data/array", "./data/ajax", "./data/tags", "./data/tokenizer", "./data/minimumInputLength", "./data/maximumInputLength", "./data/maximumSelectionLength", "./dropdown", "./dropdown/search", "./dropdown/hidePlaceholder", "./dropdown/infiniteScroll", "./dropdown/attachBody", "./dropdown/minimumResultsForSearch", "./dropdown/selectOnClose", "./dropdown/closeOnSelect", "./i18n/en"], function (a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, A, B, C) { function D() { this.reset() } return D.prototype.apply = function (l) { if (l = a.extend(!0, {}, this.defaults, l), null == l.dataAdapter) { if (null != l.ajax ? l.dataAdapter = o : null != l.data ? l.dataAdapter = n : l.dataAdapter = m, l.minimumInputLength > 0 && (l.dataAdapter = j.Decorate(l.dataAdapter, r)), l.maximumInputLength > 0 && (l.dataAdapter = j.Decorate(l.dataAdapter, s)), l.maximumSelectionLength > 0 && (l.dataAdapter = j.Decorate(l.dataAdapter, t)), l.tags && (l.dataAdapter = j.Decorate(l.dataAdapter, p)), null == l.tokenSeparators && null == l.tokenizer || (l.dataAdapter = j.Decorate(l.dataAdapter, q)), null != l.query) { var C = b(l.amdBase + "compat/query"); l.dataAdapter = j.Decorate(l.dataAdapter, C) } if (null != l.initSelection) { var D = b(l.amdBase + "compat/initSelection"); l.dataAdapter = j.Decorate(l.dataAdapter, D) } } if (null == l.resultsAdapter && (l.resultsAdapter = c, null != l.ajax && (l.resultsAdapter = j.Decorate(l.resultsAdapter, x)), null != l.placeholder && (l.resultsAdapter = j.Decorate(l.resultsAdapter, w)), l.selectOnClose && (l.resultsAdapter = j.Decorate(l.resultsAdapter, A))), null == l.dropdownAdapter) { if (l.multiple) l.dropdownAdapter = u; else { var E = j.Decorate(u, v); l.dropdownAdapter = E } if (0 !== l.minimumResultsForSearch && (l.dropdownAdapter = j.Decorate(l.dropdownAdapter, z)), l.closeOnSelect && (l.dropdownAdapter = j.Decorate(l.dropdownAdapter, B)), null != l.dropdownCssClass || null != l.dropdownCss || null != l.adaptDropdownCssClass) { var F = b(l.amdBase + "compat/dropdownCss"); l.dropdownAdapter = j.Decorate(l.dropdownAdapter, F) } l.dropdownAdapter = j.Decorate(l.dropdownAdapter, y) } if (null == l.selectionAdapter) { if (l.multiple ? l.selectionAdapter = e : l.selectionAdapter = d, null != l.placeholder && (l.selectionAdapter = j.Decorate(l.selectionAdapter, f)), l.allowClear && (l.selectionAdapter = j.Decorate(l.selectionAdapter, g)), l.multiple && (l.selectionAdapter = j.Decorate(l.selectionAdapter, h)), null != l.containerCssClass || null != l.containerCss || null != l.adaptContainerCssClass) { var G = b(l.amdBase + "compat/containerCss"); l.selectionAdapter = j.Decorate(l.selectionAdapter, G) } l.selectionAdapter = j.Decorate(l.selectionAdapter, i) } if ("string" == typeof l.language) if (l.language.indexOf("-") > 0) { var H = l.language.split("-"), I = H[0]; l.language = [l.language, I] } else l.language = [l.language]; if (a.isArray(l.language)) { var J = new k; l.language.push("en"); for (var K = l.language, L = 0; L < K.length; L++) { var M = K[L], N = {}; try { N = k.loadPath(M) } catch (a) { try { M = this.defaults.amdLanguageBase + M, N = k.loadPath(M) } catch (a) { l.debug && window.console && console.warn && console.warn('Select2: The language file for "' + M + '" could not be automatically loaded. A fallback will be used instead.'); continue } } J.extend(N) } l.translations = J } else { var O = k.loadPath(this.defaults.amdLanguageBase + "en"), P = new k(l.language); P.extend(O), l.translations = P } return l }, D.prototype.reset = function () { function b(a) { function b(a) { return l[a] || a } return a.replace(/[^\u0000-\u007E]/g, b) } function c(d, e) { if ("" === a.trim(d.term)) return e; if (e.children && e.children.length > 0) { for (var f = a.extend(!0, {}, e), g = e.children.length - 1; g >= 0; g--) { null == c(d, e.children[g]) && f.children.splice(g, 1) } return f.children.length > 0 ? f : c(d, f) } var h = b(e.text).toUpperCase(), i = b(d.term).toUpperCase(); return h.indexOf(i) > -1 ? e : null } this.defaults = { amdBase: "./", amdLanguageBase: "./i18n/", closeOnSelect: !0, debug: !1, dropdownAutoWidth: !1, escapeMarkup: j.escapeMarkup, language: C, matcher: c, minimumInputLength: 0, maximumInputLength: 0, maximumSelectionLength: 0, minimumResultsForSearch: 0, selectOnClose: !1, scrollAfterSelect: !1, sorter: function (a) { return a }, templateResult: function (a) { return a.text }, templateSelection: function (a) { return a.text }, theme: "default", width: "resolve" } }, D.prototype.set = function (b, c) { var d = a.camelCase(b), e = {}; e[d] = c; var f = j._convertData(e); a.extend(!0, this.defaults, f) }, new D }), b.define("select2/options", ["require", "jquery", "./defaults", "./utils"], function (a, b, c, d) { function e(b, e) { if (this.options = b, null != e && this.fromElement(e), this.options = c.apply(this.options), e && e.is("input")) { var f = a(this.get("amdBase") + "compat/inputData"); this.options.dataAdapter = d.Decorate(this.options.dataAdapter, f) } } return e.prototype.fromElement = function (a) { function c(a, b) { return b.toUpperCase() } var e = ["select2"]; null == this.options.multiple && (this.options.multiple = a.prop("multiple")), null == this.options.disabled && (this.options.disabled = a.prop("disabled")), null == this.options.language && (a.prop("lang") ? this.options.language = a.prop("lang").toLowerCase() : a.closest("[lang]").prop("lang") && (this.options.language = a.closest("[lang]").prop("lang"))), null == this.options.dir && (a.prop("dir") ? this.options.dir = a.prop("dir") : a.closest("[dir]").prop("dir") ? this.options.dir = a.closest("[dir]").prop("dir") : this.options.dir = "ltr"), a.prop("disabled", this.options.disabled), a.prop("multiple", this.options.multiple), d.GetData(a[0], "select2Tags") && (this.options.debug && window.console && console.warn && console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'), d.StoreData(a[0], "data", d.GetData(a[0], "select2Tags")), d.StoreData(a[0], "tags", !0)), d.GetData(a[0], "ajaxUrl") && (this.options.debug && window.console && console.warn && console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."), a.attr("ajax--url", d.GetData(a[0], "ajaxUrl")), d.StoreData(a[0], "ajax-Url", d.GetData(a[0], "ajaxUrl"))); for (var f = {}, g = 0; g < a[0].attributes.length; g++) { var h = a[0].attributes[g].name, i = "data-"; if (h.substr(0, i.length) == i) { var j = h.substring(i.length), k = d.GetData(a[0], j); f[j.replace(/-([a-z])/g, c)] = k } } b.fn.jquery && "1." == b.fn.jquery.substr(0, 2) && a[0].dataset && (f = b.extend(!0, {}, a[0].dataset, f)); var l = b.extend(!0, {}, d.GetData(a[0]), f); l = d._convertData(l); for (var m in l) b.inArray(m, e) > -1 || (b.isPlainObject(this.options[m]) ? b.extend(this.options[m], l[m]) : this.options[m] = l[m]); return this }, e.prototype.get = function (a) { return this.options[a] }, e.prototype.set = function (a, b) { this.options[a] = b }, e }), b.define("select2/core", ["jquery", "./options", "./utils", "./keys"], function (a, b, c, d) { var e = function (a, d) { null != c.GetData(a[0], "select2") && c.GetData(a[0], "select2").destroy(), this.$element = a, this.id = this._generateId(a), d = d || {}, this.options = new b(d, a), e.__super__.constructor.call(this); var f = a.attr("tabindex") || 0; c.StoreData(a[0], "old-tabindex", f), a.attr("tabindex", "-1"); var g = this.options.get("dataAdapter"); this.dataAdapter = new g(a, this.options); var h = this.render(); this._placeContainer(h); var i = this.options.get("selectionAdapter"); this.selection = new i(a, this.options), this.$selection = this.selection.render(), this.selection.position(this.$selection, h); var j = this.options.get("dropdownAdapter"); this.dropdown = new j(a, this.options), this.$dropdown = this.dropdown.render(), this.dropdown.position(this.$dropdown, h); var k = this.options.get("resultsAdapter"); this.results = new k(a, this.options, this.dataAdapter), this.$results = this.results.render(), this.results.position(this.$results, this.$dropdown); var l = this; this._bindAdapters(), this._registerDomEvents(), this._registerDataEvents(), this._registerSelectionEvents(), this._registerDropdownEvents(), this._registerResultsEvents(), this._registerEvents(), this.dataAdapter.current(function (a) { l.trigger("selection:update", { data: a }) }), a.addClass("select2-hidden-accessible"), a.attr("aria-hidden", "true"), this._syncAttributes(), c.StoreData(a[0], "select2", this), a.data("select2", this) }; return c.Extend(e, c.Observable), e.prototype._generateId = function (a) { var b = ""; return b = null != a.attr("id") ? a.attr("id") : null != a.attr("name") ? a.attr("name") + "-" + c.generateChars(2) : c.generateChars(4), b = b.replace(/(:|\.|\[|\]|,)/g, ""), b = "select2-" + b }, e.prototype._placeContainer = function (a) { a.insertAfter(this.$element); var b = this._resolveWidth(this.$element, this.options.get("width")); null != b && a.css("width", b) }, e.prototype._resolveWidth = function (a, b) { var c = /^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i; if ("resolve" == b) { var d = this._resolveWidth(a, "style"); return null != d ? d : this._resolveWidth(a, "element") } if ("element" == b) { var e = a.outerWidth(!1); return e <= 0 ? "auto" : e + "px" } if ("style" == b) { var f = a.attr("style"); if ("string" != typeof f) return null; for (var g = f.split(";"), h = 0, i = g.length; h < i; h += 1) { var j = g[h].replace(/\s/g, ""), k = j.match(c); if (null !== k && k.length >= 1) return k[1] } return null } return b }, e.prototype._bindAdapters = function () { this.dataAdapter.bind(this, this.$container), this.selection.bind(this, this.$container), this.dropdown.bind(this, this.$container), this.results.bind(this, this.$container) }, e.prototype._registerDomEvents = function () { var b = this; this.$element.on("change.select2", function () { b.dataAdapter.current(function (a) { b.trigger("selection:update", { data: a }) }) }), this.$element.on("focus.select2", function (a) { b.trigger("focus", a) }), this._syncA = c.bind(this._syncAttributes, this), this._syncS = c.bind(this._syncSubtree, this), this.$element[0].attachEvent && this.$element[0].attachEvent("onpropertychange", this._syncA); var d = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver; null != d ? (this._observer = new d(function (c) { a.each(c, b._syncA), a.each(c, b._syncS) }), this._observer.observe(this.$element[0], { attributes: !0, childList: !0, subtree: !1 })) : this.$element[0].addEventListener && (this.$element[0].addEventListener("DOMAttrModified", b._syncA, !1), this.$element[0].addEventListener("DOMNodeInserted", b._syncS, !1), this.$element[0].addEventListener("DOMNodeRemoved", b._syncS, !1)) }, e.prototype._registerDataEvents = function () { var a = this; this.dataAdapter.on("*", function (b, c) { a.trigger(b, c) }) }, e.prototype._registerSelectionEvents = function () { var b = this, c = ["toggle", "focus"]; this.selection.on("toggle", function () { b.toggleDropdown() }), this.selection.on("focus", function (a) { b.focus(a) }), this.selection.on("*", function (d, e) { -1 === a.inArray(d, c) && b.trigger(d, e) }) }, e.prototype._registerDropdownEvents = function () { var a = this; this.dropdown.on("*", function (b, c) { a.trigger(b, c) }) }, e.prototype._registerResultsEvents = function () { var a = this; this.results.on("*", function (b, c) { a.trigger(b, c) }) }, e.prototype._registerEvents = function () { var a = this; this.on("open", function () { a.$container.addClass("select2-container--open") }), this.on("close", function () { a.$container.removeClass("select2-container--open") }), this.on("enable", function () { a.$container.removeClass("select2-container--disabled") }), this.on("disable", function () { a.$container.addClass("select2-container--disabled") }), this.on("blur", function () { a.$container.removeClass("select2-container--focus") }), this.on("query", function (b) { a.isOpen() || a.trigger("open", {}), this.dataAdapter.query(b, function (c) { a.trigger("results:all", { data: c, query: b }) }) }), this.on("query:append", function (b) { this.dataAdapter.query(b, function (c) { a.trigger("results:append", { data: c, query: b }) }) }), this.on("keypress", function (b) { var c = b.which; a.isOpen() ? c === d.ESC || c === d.TAB || c === d.UP && b.altKey ? (a.close(), b.preventDefault()) : c === d.ENTER ? (a.trigger("results:select", {}), b.preventDefault()) : c === d.SPACE && b.ctrlKey ? (a.trigger("results:toggle", {}), b.preventDefault()) : c === d.UP ? (a.trigger("results:previous", {}), b.preventDefault()) : c === d.DOWN && (a.trigger("results:next", {}), b.preventDefault()) : (c === d.ENTER || c === d.SPACE || c === d.DOWN && b.altKey) && (a.open(), b.preventDefault()) }) }, e.prototype._syncAttributes = function () { this.options.set("disabled", this.$element.prop("disabled")), this.options.get("disabled") ? (this.isOpen() && this.close(), this.trigger("disable", {})) : this.trigger("enable", {}) }, e.prototype._syncSubtree = function (a, b) { var c = !1, d = this; if (!a || !a.target || "OPTION" === a.target.nodeName || "OPTGROUP" === a.target.nodeName) { if (b) if (b.addedNodes && b.addedNodes.length > 0) for (var e = 0; e < b.addedNodes.length; e++) { var f = b.addedNodes[e]; f.selected && (c = !0) } else b.removedNodes && b.removedNodes.length > 0 && (c = !0); else c = !0; c && this.dataAdapter.current(function (a) { d.trigger("selection:update", { data: a }) }) } }, e.prototype.trigger = function (a, b) { var c = e.__super__.trigger, d = { open: "opening", close: "closing", select: "selecting", unselect: "unselecting", clear: "clearing" }; if (void 0 === b && (b = {}), a in d) { var f = d[a], g = { prevented: !1, name: a, args: b }; if (c.call(this, f, g), g.prevented) return void (b.prevented = !0) } c.call(this, a, b) }, e.prototype.toggleDropdown = function () { this.options.get("disabled") || (this.isOpen() ? this.close() : this.open()) }, e.prototype.open = function () { this.isOpen() || this.trigger("query", {}) }, e.prototype.close = function () { this.isOpen() && this.trigger("close", {}) }, e.prototype.isOpen = function () { return this.$container.hasClass("select2-container--open") }, e.prototype.hasFocus = function () { return this.$container.hasClass("select2-container--focus") }, e.prototype.focus = function (a) { this.hasFocus() || (this.$container.addClass("select2-container--focus"), this.trigger("focus", {})) }, e.prototype.enable = function (a) { this.options.get("debug") && window.console && console.warn && console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'), null != a && 0 !== a.length || (a = [!0]); var b = !a[0]; this.$element.prop("disabled", b) }, e.prototype.data = function () { this.options.get("debug") && arguments.length > 0 && window.console && console.warn && console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.'); var a = []; return this.dataAdapter.current(function (b) { a = b }), a }, e.prototype.val = function (b) { if (this.options.get("debug") && window.console && console.warn && console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'), null == b || 0 === b.length) return this.$element.val(); var c = b[0]; a.isArray(c) && (c = a.map(c, function (a) { return a.toString() })), this.$element.val(c).trigger("change") }, e.prototype.destroy = function () { this.$container.remove(), this.$element[0].detachEvent && this.$element[0].detachEvent("onpropertychange", this._syncA), null != this._observer ? (this._observer.disconnect(), this._observer = null) : this.$element[0].removeEventListener && (this.$element[0].removeEventListener("DOMAttrModified", this._syncA, !1), this.$element[0].removeEventListener("DOMNodeInserted", this._syncS, !1), this.$element[0].removeEventListener("DOMNodeRemoved", this._syncS, !1)), this._syncA = null, this._syncS = null, this.$element.off(".select2"), this.$element.attr("tabindex", c.GetData(this.$element[0], "old-tabindex")), this.$element.removeClass("select2-hidden-accessible"), this.$element.attr("aria-hidden", "false"), c.RemoveData(this.$element[0]), this.$element.removeData("select2"), this.dataAdapter.destroy(), this.selection.destroy(), this.dropdown.destroy(), this.results.destroy(), this.dataAdapter = null, this.selection = null, this.dropdown = null, this.results = null }, e.prototype.render = function () { var b = a('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>'); return b.attr("dir", this.options.get("dir")), this.$container = b, this.$container.addClass("select2-container--" + this.options.get("theme")), c.StoreData(b[0], "element", this.$element), b }, e }), b.define("jquery-mousewheel", ["jquery"], function (a) { return a }), b.define("jquery.select2", ["jquery", "jquery-mousewheel", "./select2/core", "./select2/defaults", "./select2/utils"], function (a, b, c, d, e) { if (null == a.fn.select2) { var f = ["open", "close", "destroy"]; a.fn.select2 = function (b) { if ("object" == typeof (b = b || {})) return this.each(function () { var d = a.extend(!0, {}, b); new c(a(this), d) }), this; if ("string" == typeof b) { var d, g = Array.prototype.slice.call(arguments, 1); return this.each(function () { var a = e.GetData(this, "select2"); null == a && window.console && console.error && console.error("The select2('" + b + "') method was called on an element that is not using Select2."), d = a[b].apply(a, g) }), a.inArray(b, f) > -1 ? this : d } throw new Error("Invalid arguments for Select2: " + b) } } return null == a.fn.select2.defaults && (a.fn.select2.defaults = d), c }), { define: b.define, require: b.require } }(), c = b.require("jquery.select2"); return a.fn.select2.amd = b, c });
    </script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JummBox</title>
    <meta name="application-name" content="JummBox" />
    <meta name="apple-mobile-web-app-title" content="JummBox">
    <meta name="description" content="JummBox is an online tool for sketching and sharing instrumental melodies." />
    <meta name="keywords"
        content="chiptune, instrumental, music, song, melody, composition, tool, free, square wave, NES, NSF, JummBox, jummbox, BeepBox, beepbox" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#444" />
    <meta name="msapplication-TileColor" content="#603cba" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="icon" type="image/png" sizes="32x32"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAAWJLR0QvI9QgEQAAAAd0SU1FB+MJDhMoAhz4BGEAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDktMTRUMTk6NDA6MDIrMDI6MDDOE0aoAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTA5LTE0VDE5OjQwOjAyKzAyOjAwv07+FAAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAABXelRYdFJhdyBwcm9maWxlIHR5cGUgaXB0YwAAeJzj8gwIcVYoKMpPy8xJ5VIAAyMLLmMLEyMTS5MUAxMgRIA0w2QDI7NUIMvY1MjEzMQcxAfLgEigSi4A6hcRdPJCNZUAAAHkSURBVFhHvZc9SMNAGIYvgosg4iQiQhFEUBfFpYvo5CCIFB3UpSjoJIirs6uIo1BwEBelUHBxcuwinUQQQQqi4Cy4OMR+Z97w9Xp/qb0+EPLTkve577uESxQ3EBmYnl0UudGCKPSvJVf+KH/diPpbWTzW7pMrfngL8OCJ8b7kajPPL9+ZRZwCFEwcTl4Zg1WyiBgFfEbswkekRaATwSo2kVQgRLCKTiSamlmI+awOFc7hItHyylkcctQmIBGVtj5kC7otkD96l/uutwDBF8VBuU8FQCgRBL/e5cTnw488pja0CIBOieiCgVUAtCtiCwZeAsBXRA0emuuV54DLOAWK+fXkqDFpqtdybxJxBXMgkUkAcJH5jQExtlSX5z7BHPovCfQk596QFG30Ejk4L8ng6vGI/E1XbozWhFUAo9Whqw6HB9sknBWwSXSCzC1oB9uTkAqgt67SElQVV2UoFBtHbYe2Aj4S7aIKBW0BjVY3AblEMAEerJMAqYDaU7QhZDtOnjabK2CS+C+6iUhvQaJlUUrYglXJ090deUM1xATCafS0MDUuywlVRPfo+QqowcD5YeLCJWAKBkYB4BIxCbiCgVMAmEQgwPEJBt7vAbrZbWVffkxgUaJCwXuVVbF9OewVLoQQv2MkgtalrG3zAAAAAElFTkSuQmCC" />
    <style>
        /* latin */
        @font-face {
            font-family: 'B612';
            font-style: normal;
            font-weight: 400;
            src: url(data:application/octet-stream;base64,d09GMgABAAAAAFL8ABIAAAAA6eAAAFKZAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG5Y2HAwGYBaLYACCXggqCYJzEQgKgu1Mgs5hC4M2ABKnTAE2AiQDhmgEIAWDUgeEFwwHG4PXR5ibGqugH2onipMy2f5NbQu468PGAdqGeVLAHe9xiCbTkf3//5+WdAzZAD9QNb3d10uSBJ1wigi4zCVQMxp6RnuNiSzK7PDAeS6fWG0VjDeKnAUlxWXOVElTR10Yg2ITN6LDxeeWX+GORyl6BBw/QVdp2thJ/Di/JsZLRBFVeoqnuOgKE62mlYWsDMejsRrC2syX/NN20XrrmclOLuGC6qTqNA+qA0QQLumCcrvbpqEbmD432ioTRPJT7dRzMqZ8azvUYByvWoOHWwXYLfEh0l04hjz/f37Ouu99T4JaCeZBvIIlWBhEAzMe8IqidVyDewUbcYbO7C7UODQLI2oZ4OfWP6kSeIza2MZgjLEmRmwsklVDL8lBj5JSogUMDEBQwTpPPTE/iolwNnjXeufd6UXqV+8aeaj2Q9/e3v3LRAIWSNhONaElYRB94qqqaizQ+DpRYSub3ZquRnLXFhJwnR79X+b6MJfwyPlOBReMx1ncELH6SxRATdvtPgAGxulCqSZvYhycV2qefGJQ9oODQlkrbX/I7JD9y86D/aANE4Eh3DAYzEiABPFU7sutrzskSHWCfLHDbU922z25VXeFsDuMw8x8k4S6kPf2BFf7ZsA3twbf/H77f06tP5H5wwwwaBBCIC1GwmAbWV5pszbm61J9ubsuxCqXRQrlXefy0uuvaG7ZoeqQQy6jiM651Py7pZ/WoXUk6sREPlxNpr683ajt3ZO6nKhDckhlagH8q4yJ7KLQk5YKMtl7ROa1gH3hhyJF4AJEGa9gePr+nh15VLCTJrBgCYeQwq9E7vhdZK78CbsjaUtoCMWinue5bxJrLsghz4Kl1a17tc//TVQkJLIQ1D67MUmcO9KZN2cCZhTM/5yVTWbm3uuoa4+xe8fCESg08p7/+f2T/iTldLtpswydLlGbZLopZYHbOUDOLAKpY3LEFh1VVq5dJ++EuxNSAgp78P//autL2VfifHq8uvVNyqromyTgjw3T0tND1U9PuoUbAxQwxrqiioZuGGvjWZNENogmCKMh/HE0/ze1pP9LW8arNKVKqQUuYHlBITwwgMz/kn3zZ2SvPN63zyXlrlu6am+KnVpoXiBY60JL6/gIggGf/kT+V6Bn0fIAKBaYWEUGBNPJ/rxXzsvq4J73PlFHEqzp3/T6AAtSkT0EaazkPlDNhop9ySPZuIoDnIJZhs75xrvvfF2rFJEhIl7W9zaMTcVX+QpnzCJKQrTZ636/0jf42fR7J0kr7u0NKrhcIuOBuDGWXpKIyP3l60pcq1X5c4CDO7pe0vkBBgSAJ0Qu58tXpUmAf8TKzAfkc+S5ExCEBAAqFYKTk6JiAMSzB2faIq48qIQYAr+9gZgn2iwBHIZIgFdRGW8CoOpzyOIRKkgelZGTk3PIYxEorEQQifnnGhGxYs2WiI8AIXgUlPRatWnX4aprqtWoVadeg0ZNmrVo1aZdh05duimMGjNuwqQpM2bNmbdgyTYnBixZIomIUAIEQEJwuAnD405CwEMUMSexFJwl0fKWQs9TumxeCrVyUa0BpU03moICo9cA1qAR2KhRhFkLOIsW8SxZQtn2wAb3rPGCGbBihceaNZItWwwREY4PH4QAAShp3AY5fidxi8nDRZO7S027uGwLBsC7mRq1MK2k5klj0Zhi05gpZoY5dpTPMK7z2LsiAWj3VzpNfJwbyeJPmzDOeGpb/9RHWtSwC9bnlztEmw079ly48+TNlx9/gcSERGTUNHK48iKnZZXN6iS5NVYbCsWdBBS2TX59YTMjAV5iiSMFBb300c8Ao4wxzgSTTDHDLHPMs8ByxmyMHluzpFHUBVGbsaRTSBHFlFBKGReppoZa6qi/rUEWgwwxzMhto3JYTEvgXuVE9KyQjccJWrdT2ming066fgrdoydjXCdyXBY6d7eOkEu9+qkm2Xh1Nev7/+QV/LkskQCWsrNGBax0Zm19a+v4X3KHZbYzT8/dAzRF1Fey4ljNCnMc4jBHOMZ7f5zIUvVqh++/+puLrgL3Y9bk2l5Yvt0IEoA0zUlPnxS1P+n3VNnWWm270k6Ey2EtMPZiJPoW6ZTRqSidZ+WRHcoQkNCD0x5hH4canuhL0ehhbc0m4vWBOV4Ja7EMWiSMcQamS5NjAKvtiA17mMt+mog3xpI6NdsfaqB/JRIghi4eIlamUOlyoDyAi2ahzedx0GqAm1FTDpuxLMS6O7HHQUnlXZhY8u/N6CA5Ec5KyHmMYdjRNeDLSHkMEyTmKgGhcJEthXOOIEREiicSctosi694uxq6HRP9LCmQOKaSkgwpQ35fnQfhpxU5/ukKunEe+mrITKoJxrifpbPMGZ9L9W3+ojvGIZHlJSybZSb8b4aiLygejQUi9fuxQHJqVkuvbg7J81RXzLd1/GnPru8SyvAFRLPgA3M4rt83AMRgUDMKUBujEIC2g1+IP6zxWlGYT9MUAEbuAzsA+Q5H+DcIAliuMbWHBoD51LZOAmgd/AAgb4/HABDCABB09wECv6+oACxRVU+q4uU6b/x8lo0q+2p+1NuIKvmrANQL1EA6BaEuRAumXwjqhGphjApHbagGY1oEasF1EPdEMl8kYahQI0qLZhUa1WM0DNtiUQ2rxXEIh6p4RUAVRI3ENTIqo2jx3EtAJYlaEq+oqChZS+FbKipIUzSUR9eVHmNQDlNjYcRGWRyNix0PZfA1AV5ClJahiQgToxSJkqIkmSYnTYESlJqKIjWK02ha6nQoRq8Z6MqEl7gD9QqSuYEHkRV0s8I0uNwQWJAaSkFozBgNyxwOE14RMBI1kqLIGCgaVWk09HSNoTwm/iyNrSoOflzFw5evCTgSej4imFhDkpO3VJNpTo6XQlOSpsJTrWko0uKhU3rcDZqRNhNuZs3CkBVXm2ZnzoGLU3Ox5cbZo7w4+TQ/9wncY5BnId7CH4eIFhUohi6uJYRLok2pNJqMlpUohzqvFaQromrQGuVqQtmstSjWiqJNtSPv0Dq11IWsW1dPvQVpn9avswEkg9qQnoYt1kb1N4ZoXE0gnNSmjDSNYEabNd4c2ue1BVMtom1JWzbbClpX1Rpa1rUNS22ieUvXdjsdTbvanvX20XigHdrqCA3H6gT1p9qZ/c5Rd6FdOuoKtdfajdNuUXOn3bvoAdWP6gl/PWsvbnvFn2/aO9+H549P2JfYd83vP9qv0h8O/lWJKmO/oqrYq2l1IPz2BnrEI1kNgC4OIZ2byIjaWP0IkQwBXHLQS7Z94Tcv/OstGrRbTdmSeYGxi1Nc4zOe8RWvoGEOLS1asK2orfoAAEJDxrxsx5deeOm/SCAdqiM0FJqen4fQv+zX63/5AapVoLqppHHoT4oC/4hBA3p1TyOs9GyHvNcljV+XYYOD2uMHE6KkpPDFfYPVUiNsYVFxSektsr28YnmOXlVdU/s+xwG97Y677un9QUT9v3nZ2x5a88hJDnoiZqSJmY3bPuMti5bckrb+ux42aHWpoLFvjhUBUUOA65oP2mAjQW/vcsL8L87JahkLFAHoi2JkjAWOBAowFkQEGRPorG9KBPakvbG3wgzOmz2T6IBKlnGwshRYormsLScZ5PPkxm0ciMqxIDnySdAIqDxcyflXamD+OwQqatAYZkzX9AxfUS6fV+QiguZXuhviFT8SNThpkZStdLvk5JKMmw6cjWXAgwkHDTXJbG2magl5f6rt2jOUTSdemZ5jADuxeMEmEGgd8x3dctxBrJsDTzC7yH37FVvFgosaA6OVi0gx9YCgqmsAAFACANBvgD6CQ0cAXM8BAACAKUj9DAaAYRiBgqFJPJzYCCzK0DQE8lt0PK0INUXy0VAyogOgSEI+QZISFCcxMhGIGEI4HUg3ooqTIjWZTYKkhM8TE7bQegoIq/0OkGnV4MDHCDreDfofybTio2jGT8LQURj3nY2GoTBT7nlV2dUmORiKWe/TJmc5T5Fz7P27QyKd233vEzNY4SMcOz8duf22TC+oUmdJGBlukPN1nuWNy9ukWuVTNFNZbGbeO5+N8+t1iaOkiO5xvdy+tcvyUa+6ffMOAqJy7iIKsKFqq8zPPYhxL7zgxwQytWudT4T34l6yTxjZwwWAWQ1c7af8ikD4WYw3sSs5u7BEjSvrnB8RSNSQxLa9fzyeW98PBwTaeMSgNJjV3vOQQPgJT6rsGQMLF1y/zJw/nwcmxzQifTHEa8ot9n/ZrjaW24TbFU82k0kS8tyeywuej6WUibVcq8mzo1lU4DynMRPGOp8Lazo8GkDvtqMNp9fIibpYth3Cq4qdMiK9WFvse+j6WHo0SC+IPJLkO4CqSrguWuN+Mil32y8N1QVgBgXIW/KJG6iXkCTMeWVEYoW6YLGZNSaM5UO537qt5JTdunQg9SVOiIJ4HliFjWI+rAnJfT2Oy0Ubol8EdZC8JpSQslOG5UDdVdJgnk60fJcr1+rVaMJ92Tpkulpx+00AmMkLqmqzpeK0eNGQwClxGACE16pNnz69Q7jiCS2WLwR2yM5XJs1MesSZTLvfqC6lW5/NZlxsDvsQ0IbV+pWkNtH+gjX5NwKSie84y+1+xlu46X6z2TgIYo3GoBiJzPzQ2kgSSKQRy15CWZ5wLUi4FJt8KayZ8BgAYzo/H27ZpiB9p9fYoBZ7oFqJOJGsdxdYLflMaNYR00hkMGJ2vzkkLBgyyPcQncFwWGelShGiqehICSVz+YnnJehTb6OBRp96Bp+khOYEU05sjlfB7rc9FDi0gbBzsUqeD9+qC5HBgkRWsg7RS2hLcdeVUqq1KdpxcHIiy+K37O0b0oCQeCjLdS1EWH9j+PwdvEbyUJ4rYHDBzRIAAorbS3FVyDI0R6/Qwk3Jt3DuXbx5RzSWCMgc+8pmMdgFQ3I8qCitBg5K0qsy4o9sSLZdEx1Pntrt5I5ozFA4sRz1ClGT5YLIC2mbRShXkVkpuw2MvABFl0RO4fKuJIIhxOjtVuBuu93Mc2j1yWoZy0Fox+w80WnOz5wOAlb9zQ/LmCBkiipgpmlTtbp16+z0a/oiIw9eJ5vLVXt+RDFRBIHrs+97AVtKx2ZzOTxkozOXhajvEq42Rb3A6PDfiftXuAqD54DVgrwD3FTl/9KfBmq4rJMXYUjHEN9dxZinjCmIrLZyImuhBxwU4MXlCyKeMng6MSq9wsnafcXJzjkUKddKxGPpuggbvlrbkYjswkgyD/trr1OrUa+BtfZYDvGwKM2p0jw/hFowp5iEekKxxA/17LgwP0iNMREZkCnit2NTLZGnMIJcSNlhtxxL5BYHfgfYRR0STzBZJLI7Dw9mEhI2BL9q7aHDZMwSZBcjO9hN1mNP43rgUE/BdOcrOtTWaoYUqaOXf8VSz25VsqY+FsZjV87mRpy0fOzsViUtfaipVcUSqxBNjVhFRfUCRQrlytLXZVKYNlgFnqYJTRVVjXhGhTY4NZrSrGd9xjTsmsLCEMfY5ISr0+iJLJR3Lliis9IzGXJlDhkmDY7DOrJmm8UQUAFkpzo1OYnAPoSxXsRIaOcDFFeHDNl035WmqeFLbqlbtO7Luma416qeo50kfWeNh6sqR0ct5B5rSnjb+YqyFa/jooLuqz6ncRESKxw1Eol6ZOSFAMJDNwkpYGyZzWEx1NJSpwlvsf/cMO3t66kqcKh/X6gWCPXzPP17C3nOO98GsMGJ5WASb1npOg8yFCgBLJXCdmQYdxBklrSuGsmKGte7ILtSlwyOkbPNBXaz28M4xbCJmoIGKTkhJGrpzBBPeze8iSOkkaXjSRQlWjIPIm9Ljh2q+yaNKt1OyCRof9vWBYv7USMVXiEt8M5gJVZH0MJ8o03WXl1XLNZWhMBOlOsna4OJOOh67qzexDR0rUJj9jL95+TDJnsgUS2wfjsglSTLQ5cpbeqOODG1HLLrKhs7Dk2N/tNU5mKpTCEMBf6/EFEBrwoWM5KZSSpqKlF1atUMhaNS8DD1HFgzd7V1WCGZJ9CQ+xRTV+PbvElBaAtEHNWmBsay8BtpvQhEXVzd+61RLkQyZKbaWJ9UU++2h+mievorG7PTwBEwCyhOi8EUddZQFxXVuI9+duTpoHOi6mbgimG0HvlKuyQP5dccHzIV6u1StahzQHG3Pq+Y0elabBqMCUOBema0nLg5XjJ4ab5fkzzdc5/WD+CJSQHyFXuMVUtF6d9p8/aWznalTnCq1Bm99TilXkhlvkJ404jkiTyppnIdyp787C69aZrSNKOqnnA/MUXtDp9zsNdZPDP50UNTyMDS2X72NlfOz3TIR/2It3qGngZ760/T54tVX97XcML+2DE7TNCciql3TJwGgdv9pHDglwcQSGDNFPXVHn3Wq2dPuBWQX7Y+Gyqbl+X46eKwe4SM3/50oo1w1e4qM6gdlB1RQALCdMiOFW2Y7WowWcHfzGOiBjTrcdQTOCnf7ilogaS8pLTp6wISpmtbE+iCut4e7/xOg+nsCRZRfR8Sa3+ivFGccyLb3EFXmymfiTd6+SX0lzV4EtzygbWmeE2RD9yyO0o/ixfesY1o1ElqC3g4IwPNp1I8nSLbGq9Tu+6V3L+Ic3kRYxDZeWb183vrN1BjE3pbot9Y3Utg/lRdbtjXIOIkaOVmCGbz04ZAhuAHsSXGTYXMJEVvrL6CkReh8Vot9FEVWvRE08lpvROxBIkZIC75OJSA0pAAnjIsxboFpUI609uUHI81pUzi0dSvX+8K9WY+2eT0/oo+f3+Ol5QyUm42HUPdfmm5AK/GKWi6dDok1nqdaMPuVgMaj2NiyMlSYZPDFzlIGPT5BTwx2dYYDAK+24xaLfmKnZ5KTjvhNEIyCaUhDegbyVR7jUfL1BNCsrxxNYFSoOugNLqg9AwzlZpcozgDvQZ3IaDSkNZoApqpKFbJIiZpWYJ36Ig91YBQ6pAV22PO9pHy20R95+7NKJijY3zpQSyzx8bDs3NQlE5tGfP7oTSPmfxDUVyTlpHS/Y6V3QRuDvULbcA9IkibTKxiIePegGFhZj1GH1kwE86N2pwamlIWQLFaTxY0VSLTywIMtElmAyTZcU6215RYPNj1CiNo+RWLrfS9pAQ4GL+GAiLirVqOyK2G7hJ4orOt0bhnQ9CrniegEyyCmPK/YvQrwT49+sAxY37Rr0lrAlzJVCcI6BVMNj9OQ4W3jslCipc8qQTaG5Ul0TVyCwIqBztylGAibqLUcDZc0iKuXol1v2Y9IT80gPr7TCjTT+3xpO6dgsgvabAdEoEe1uabZ+aSwjaBxLZ71V9mR9vMo6sxu7O9eheR0rUYdKBK86AclQLa1SmuTnOpbCVH54YPpGo9XYHer3TcrxlMBdWg9hLHM9tEKGPVpr53u3iHo8HsIHUqMJpsGEtR6cdKYhAdOQV5h0VttmszHt4QPj9Q1NQc6Dl+aDjfbJHfd9/FLw6Xlu6nVpWpEJLWd3Gctvtaq8oDyGzvy/rFtbiftK7QrEuNy8x46M6SaQ9zXRak2nlkSp/UFc2qCx7NP/hHDrPrnwJv8pEdkJ4Au3DQh8DY4CitiZTNaM4MA8B66FBr4xZweuMH94FFRryNSwcY5GXPO+y3IHJJSEU2OGV5eBut+v5QyLT4g/oRalfnmU0hvjp7cD6JfqFuj+D353mCyRPr1W53HXb393DCtyfEacvCkNcm/c/jKgc+3ufTUViWKkGIf5O2lfAOw0XsvOARCJCuLGsfldRC5Wo2RRmsKQlN2xq1ODUkMD72B+VAxVIC7I12zwR6gAymAjdf1frU0g91pcRhGLjdVR8sYA2FPg0wIQH1P+Om+0z1mGafelpaytb9S3rn+UqGcWKf2yhd5S6lv0LjS4C9N7wMz2hdXrjrA26HZy7Ov3gT+tk28ikl1689TAgV0hNgdBpYpZHUOJpJpU25IPLJ7z4sCufD4tjY/6A5H7D+UPAU/1j2/IlnhSoSnkGhrxMUUCgr6jkU9iaBNR2ke2yN8a10THlzDN6cKYdvZYw1oZOncT5HGeGAO5k85DUw6eASaWQVjD8YM54cP1KaCS0KufDxT2DiCbn20/3f+NMb5JEbgO9SkC/9D1GA2ZeH6BGVWtjdOfnJ2y3l/Xy1341t50ergwoRhtg3jiE6kwvTBCal8yJ7RSU57Dp5CWO0KLeXJHK/OAbeLnGdpfPiPbd/T4gU71MkrfzpoUAPwFXIzkhsJHuXgrD0qEeK+ChaA8gXE/iPzzAOPBU3pRps5AGVktinszQny0RNyQYLuU+pIg7obU2plioCaMDyOHFkAit6GJTFEUE9lsvBkl6JyUsxYVZX+T9CgOrA+4rQ3Yljyu4y5cauU18KjWLKYaKxaEk4sTn/bAUvtjWj3Jy3I5PcJ1JT202GPoKaWxGRFc9lb1M4Akm8uExYcrQguBzFI0aMMb7K5plqp45/27wfK449tiH7PJxZA69bMmsUaepeiYjhKNX0kwBP2+OTVrHgGN+A3yBxYnt7Bnr6cHy6JrMC9tCr6pmF4DbdD928VmWVMcAb7xksdM5LvJDonBcs9MR7+xurVLzW7h9028DCeia9KmBPFrBQiVCdsj8RcIpKPUzt14NXzFk77oUIF+C3gFrO9tssvNL5i4zwLb9I2QkQ1Y9dvv+GKdiUp8Kkppcxcifg/oJjbmKubqLu8MRhB2DrirB2G+ARvN4hTJKPOdYmKfmEWgb/NjQX3/FKrQOWDa97X/vqdqIm7h5FoS7enbgbJy8d+4DcvjsJwCxr+MLZFW+Dv26YVVWp3ZlyDHomMzvkfMJR5Y6q8m3MvKydzxqmbTszdD4uzX0gZCiuk1doTuelZxPZSmxpaJPnZkZw+GBcF89mUmDL/jdThyl/5s2t1K97Lz5aKGt8/+BOEHClv5l569d9hCSp2FbVV968hskx801YK40cpWUxsqKp6ZlIThKZwx6ihbGU9nL5IE5vmxLa61K2S2UpA9oWU/kIvciRX6Uq/nLfTImvg+43/dnQ+RS91JCt/6hTNPbUz3SI1GwU7LCZhFMtzYczF1PvQM0zaqfpkJG4pvRMNaWIlUEvKEneGqxGip1WJ4YLJCZ1rlYiTWDX78Lc467iz+DX8Jp34LywS2DYq67cwRO7Vv17blSHdX5kiaRwfLDFB1hVVWm79DbhsZa+Q0WXBMso44x4wx7kVmqLLDc/qZKZgCxgiU0EdoLKhxX48Q8tl17ORJanQVimGe+MXnyDylot7aNMuKvVdSMcmAgi8UEZZkgtFvFkuT3jaufoeU2VeZxRWSTuJg6B/akN5K9yb3UfOlZ/l1O/kTyGAXfCfCUtpZ+Qcnmc7OhURQWNb0a2spnRBVxGPiKNagvLxPFS36p8uh93bcGxeiyHHVfLbivueOVnuOiddFjxPThgda70KK8PLtXdty6WHNUNUIvgh4GYpF9yJihVecxuLQ2VQ8uQp10UIeu0ytK4TkWlYWa0+ALFVHAypadCNWtXEjYrisqV618r0+kClCreJB1qyN6Ko77+0coSqGOKuHSySSkoQaewalB6LsXC5qYV56vrmeClnFh7rSY+VvhEHIQiaMJfxnBjiTECToqB9Bbn7bTr3XqcxHyU1dogPFJs573X1nFGUGXdnV5pE3fihwMHaQ7i59k3OmePNN7NqHOBH2pwXbPNHDE/dWv3Pu4kRg/xK0o5GbwynEQWW85hIys5qkIiP8kYqUxJl7zV7+pCOBoECIS+wYZAFDYI4YiihvrIZCbA1nOWwjcdbqx5NxdOniiXgVLwZNnJFPb7q8BzC8gh5IzUA3jX36xu8cksqIAqaBjCSYDR1ciMtFBVAr6YI0OhKiPNjNWgrMhearFAGX2M0SojRaREjIRHyg1OilFCpFgB7UxXOZldo60n1QUk6abwzdmiIUydcbj6VRZgfPhLxxPO+aaRo6a7CT+1qT0nw4aJ9SJdCTkj2QQRkQny5PxKn/PXb4OSPmJhNr0nM0/cV5c9guen6r0/jt0bleyvv62AM6kWv+LPyoTd8+3/XQ9WVo2makuRO3Pfau70I4Lg8whVoNk7z1kWVIf4mP0/257h8rO06rITqX1Flq2sw4hLppKIh8zLlgOD9ee4tfF5foqQz9MVOw3Eq7jq7q8FF9qHTxs/Ir/u7CH9nv/R0IkLLc94kG8+mX91gO8ak5IL4ZLRshRChChJAMOCx/Yfxt09AzDCHUGo5U9ABPrFyvZrv41dC92pjHLe/2r4wKuaMJdNbhXsJlg+I9Ui5CQbshOqg1IDqrtsX3s/VwCuXhHLj+TuGheVE7LyPmxaUtBVVF48pcPuwW3zvWZPUamIlSIdoVtmK8loxHcEMZanhyw7YTZOfIVGklCSz+2Gq85s5yOLVewlav3o85bpD7URB3ZJ/abuvmyYq72bIeRllb5tXuc1H80pmyQ/dPAho/h+QZMxZ1OSjCBy5wVwYbZ7XnOPv9Y5ZztlApHTfrKlo5WeC9uSvzfPD3QcUi/EWKMAV6/VwS+Cxt6ndZnFHdH97r1p7bgPHLvXtIf8KS8DKD1s5Qw4rfZb5kSsqmfqwcuesDHYqOf85tE17hquOsDp7pSR6iTA0pBN3pQygtSMPm+ZofR075sPmkBhRFdgZxI49HrTHw/rP7wHUF6w1R/ATfUldwMA1xfdi4jcv4E6yyT/55++G8y5ev+vGy5HOjpzHHtKkx9EFpsn9h0CL3/uU15szHbDOr8IbD7CeDc19rtfYn/4cR3dPT3AbjX4dVCleTmZZOgAvscxWVZ82KtmfggY3DmqTDzQvQJQXtDVH0Bo7XGqM9U5/NHurzAO578Mk8bUudQhlWja9yvN9/MnMKbLsyFVSVJ8cT3/9V7f4oGAfX/VnribGzo3lxV6/O4/tfun/o7PUPyXSshe0oCkvljXR9ZvOpFfOZXwfpkqeII0JE72V9WJL5SJysgtwQMl8v2mCLX8gd7d5GpywtSuxe4vKJioHbJcOFu+7rzXu63xIrQ9g91ukzBKLNxN8PSAr18tfV1uuDqWUuFXkmAx4tRjGULPfqHMPY6ol1dJ9KJwtriXS7lZ/CzDhXT1AXEzGMP3/P6u5aLQlZQyklwUYqWZikiKfqYy7RHQZCuk9ifSOdfd6mpzxrU9SNxepNprK2FNO6oOCIz+w5j/Kb/8n/rdMx4NQW07crrjDXpcDVvHrLJxWsPTIQ9XZ///VkO1/h2KaUHLqIUQOZksT02hqYysFupmekuG0UzrzBZjWgQWk7iW0hHK/d75eGn2TjoLqYjIAomMenguK8XCZ9OMRmlL+ub0Fq5RR6uQmBQ7ttjmEvUfzjesy34DKPr0jPfMXru2s6X8x6t9qttbu29wapoXtO17OZ923YtY/RG8VUDZoS2sTGKK6nFqA35L5rPGjFepRaTUoNngy+FJsWHLb0A4+vF10EDtfjzln+jPLHIJLvLn+Z8MsT3+3veRA2Zj2gbm+9d6i6B/V3RtTYIUPfw9xU16hjTNg96COyMOXXoEQh4obqCmEV+unH4UEeXxn7MflnsYkXgVmqDvWeuGcg13QESS/E/V4l3kDDjtSol93XZ+3gPzXMs5/Ryr3fvekEXuc7GQZfp4Hbj8CbhcN04fn9B4l3OsFXzh7Bow/nn6J3Ldo9H3mwT4Cpy9QvBJnKjDH8BLJ6QAlndq/CnuDojavXYgr5d+ADTfvDiWMpJ78lSu3Zmuq4ycNK6/aHSmvzSe7D6GDu+Zh6XnYrgcfDbU6lWWYEX3sjTaKJJihL52mQHOr4I92mxMJTRFs41b0cW61jYg/qpn5oKhgtnkUeKnCsw0x9dWmEtxqVoHI6MscqtCDd8hqm7m5MpKo24Ihxw7CPmtC+aWWcZHtcX06y07F7M3546mMHhvz2Odj+d28wwO7HROFrabk6XDE0hKBJeUmdJ8/EB+FXQX5SeMelhZPEK/1dAofTg8sZLZMuFxGQRch8D5Jrpx82+ipKwYexC3eyGvfop6p1IYNpDQKisrkm3BK+xT/KJWyskyhLOIfEYSu1lkLKayWfmB3PB3zqcc8XL1Tg0rSBSoMCnc/DgWJ0axPcH+Xvg6wjlaOj6hi+5W5LZQMgliv+8ULK1DLoIT9NnG2jEUOO15fPH4eEH8TK++vNv33z9/cyYza3ez79Y6aA8aJt7LrkcLXH/MHz5wGWw2c95pbTsjqlHUY3b9E20qX6L8qgohM8rilQZCPc+0P+1bQ0wq3YD+LUYbnO9uJOiit3IK81NTExSQ134p3/YsAq6N4PIquC+zxlYWwRqfXl74bHGJG5w38RkGIwpkI+1pTT2LiMvgjSO3V27v9UE/fk6vb0/5wRAEOjiC65OdOHAZ3JEVvIdb1cg0p/Mgc4UrYpv3q+CB6j3Pq/ccZhymPaX+/CmesO7Z3cDxy7x1CBaceOObM7zGBtTLO1HZlez06qBx/fcULJn4nkXpZfA8vRSaxQ2S+WKrBu1BWkkdrp2skZbF8woQvdpfF59R/ZSCz4gR37y4PYd3QzzbDN4utOfBuQEcxJ8731LV92riBSlCFPZ4bgGsDvHr0pZxPiai+EEc5HfbhvX+lef0nbszHjY18e9vHr+grak8r+0cF91vahI83Lz7ov4mXIWakDQ3SLTKWraoHDUoDs3ETfVireLnR2KPGsztnp7N7aHry7F78szorexcPZ5C0YYK0K3R3s9JgBvrMngqv+1qKUyuGZPZRxh32jYp7m8bf6jZPPa6Nf7g4ShM9zw0t1bG3RS6V2pFjzBy1TgiRhIkRHEI3/cUl2IsELJmm7higLXSNiD6vHP3eVUFs9WrzE8dSAXcIhaHsa/OxMoQwiSm8PCvHH/H/JXlxLIR1gcnPPjWc+7ZogSr2RUakFcUVmpgMOPGc3BVMdlmRQKTjzEk27iDdfpJTBZK56MLliHG2J2b2EH8jTwPKFEbyMLGcCjo78T8KBlSheJFsUjQCDFZmmQ3cfsRmhiRNzewiV6nyDUXNj4zvnqhgqUFp2mv42ell0Hj4kF6KdTzA5EvVlmTKiqK2qr95DL4s13fmIdiQ1aLzP2MD4whiXX3wGCt9Bz469eJ31G+++G+nqF6ig3BhBwr2+8PavN2Wz86JDZoe3fga+k74Mn2uOxWdqx7arxb8Y4FrGvg8oTE9vYeflTEVKArnjLW/B2QvYL1C1llPl/O+4c9q4BrMuZytlSoeAmm2M6MUu/50Mi1FAXZQgkP2nTZP+BFwnf5ycAMOJ1Agb3y2LXnLoar5lfJMNB5fHoh9H1T1ex2+C1nkn/TwcckZW10I5Hlhu8QMZrjWBvD/D2q9yzEYtI7c59hBGFar4KEF8memW8nZbWHfxhrYxyjWdSBZ7kRjW10SRl8TBeMvBkIXHoBMB0rAGOP46Kqx3Gc9hdmLxK8CsK0F/lnc6R3in8rAtsO4P/mMKMmK6cylUFQQ2XYDLIAy4dGR49uu9c6tnEqrTXL5mByoyVQCVZGlmIl0GhExu61fuD6VtJqULjfkhXKSngDgz6PYkGhioTXUOizBAU+DhL7gHotA8rgmavMumOz8FdSlUt+bOLgy4kL2y4pPFmReZSe+THk41lwpecldv2JfnzDuRZwIfwwsPGgej8+zUuC2yLOK0+SWkfZF7OsPDyXwoIPButssagH4M6H1DO3DA37485tPw1uG4iSWVg3hwALerDgXOU4Stw/ctY1e45IvPryrUnUeNWccXB8cHRtdBAg84V/ZW9MpRggHFKMKDGeKJNxTPQilkksyyXWSfOErR81Iv5wkWiJZposqdmm204o0PTBObE0Y53bXer3++cn15NCdf+oF4/IsNm0BKJeInX+8Pf27+WxVp2+fVMBBC49XjHGkeUVfQjK9ovpmKi9XXTMZBZXe5uypjjRVmg2Ee1j6Abq5QP04qL0QYWCNlhcPEhTKAdoFtOwl5w+UPRbVvoChKSBxR1X+LOi0Bs5nPtEDOt75ilxEImRh2eI4MZEYoSBwc2PZROFYesAzUWOWkd3OJWovuvJybR5xnBD6BFcPDGad1wYjIqY+yboZgC8oqAKBQ2OtiZFcbLO17O9YtPE8MP+MvLb/JOrL1dRIOyz0BhY8LO9RIinLiOnu1wNYJ85UVp4qH5aH02ITOp5NDFI37/n7FUcyNyO9F9LWjm6cfHnGYDtJe9k+lR8yJu/34lC3pidTctAbyDFQ+CTDxWTq9FjznF7bEnMRQLc+bo2eGPAe4BP9+NL45eAwKVfUkzYDBHWlJIiVTMyTHHWYIorimNRfrDJxyN3H+uPjOw/tjvyfWsG3Lj5DtWEqq6lTj2hdlztGuoC0N2Pn4O/McdDZTPRfaq3srDcdl2wLpQ3tTXFBAamPP0Zvyg/A7ix5gOcsBDpT4JoCnJtSt+Z817AOt1Pc7A+PPQTIfBpj8i5JGJWiNLlEkv96tJKNCNbsidwQudPAMZ+FHD7oEeu9Cig699uWyg+pYi/w4Sx+GjJJ0oEPj43nHUgS2AZu9R8IAI9HReJ5KS131P3mNz6KzkHx5ZEFdPTUYUsSQ42NYVAaBZdmE6PKh67XJx5Y2yALO9sXOyowJ+PxvrLcmf1DacL4AMLxYOPJpJ6hMg+Wj+Nh6K00PfvSZQSKMX6G3bhCtLOnYQRG9LOmijs6gvvCEhMNmhdzmtfTWSTHcsXN2xHKijZ3quX7noet+yKMETorbvHT4YsgzvLfWI1xiXDJZ5r0RgudHUBAXmd/2FkgTMOqSLy0Bjk5y/Y0KjAByXrR4HqPt6C/U9ITyzGQNFFs1jROgqHYWdGOCYKMhfecWShW1+kFjEoaB2TpY8muB3rIfaHzb/Ah4XhgNMP42kAF4IHbgBZD5fun3g2Lv9tnr/2APlhEG75y5lGyKIHdAw66jl/69w/QT9kvNh8BYivFqvYZug/McVdHbBIrXkmD+fde7O3yjOPUsPYiEgG8COIIegZRSUzs0/0F9xVUjLjIE3k0pnbZGYLVXbqKRaueqc3QQT0WbjV8qToGmLHp+aBNN6FWhxqdU7lMHc73JS4XoJLIOVWg5lk02aCGNZ5gclc6oMpRvCeCSqX2kAa7xt3hZ1LQ43veORHv7VCZbJLh6awrXePryWV9P/6k2s3EDa9vhA+SAar0M1nVq4jhi4MNnA94EMaNxTB6xYiULjGzA+vugqUkL0hvHzXmNrR+xpeCEKtAD8Hv27REq12FefTRtSv1TDohrahbbWaqOcrxEnvk/lQUnQLMUpxR4HCtbJYx3yEhD0P/A3Xa0urix/dLqnUs3b5seO8rt2kTR+X5+/16eYwsBUiOkftE3IO30cherncbpkcvgnSuFhOt2YOr+G6BJDzP9huFpNQGfHsthnm8A0slX3RyhlBMCXawGDr0NZMj2az0QY0FegupXgGkFHu1OaR8tkLfFmvfLmj+EYOJY6PYPW+ayDb0TTKB9I9qYwVpvHmNOX+r1Inz3zAQo8sNHjCSg3Eg5t6D404eOh1U1elF3Ju0gqsCXBpZHnZR5mNv5wDPHf8U3TH3e7WGQ2LXhq1xW5364lX3biUaqfb3ToHQ2WPWrVd8OsJ24Y8v0VcHPCFxxzhDoFuLI5SgzJ83UcqawFs5PWCwhMOoRP7+/jmH/nozJugiKA1RAqdufqqGxHrIuzM7c3tEFGPqOKsHBMdomrdqgvxwW5PjMHBxiduD6P7PdOVVT9x35Ssr13qmuhC/Nhz4iIpss1ro78kRLGlFFDJx7CkG1rZ/joqgS2mpIq75REJQf6yx5vba95pIPOqANndA5scLRJqNAC8leKG2hOaoMGRouJG7WetrcE+kMbFcl2hGhyvUxnx7DNRajW14Vk5cCmzSqLqae915/We/Iw11VNjBJw2ePKB2UdZVG7o1ZPNhgRjAN6WhpbAcjcxmG3xYtggr7yWbVBGK8gJYVOtWKOV4Qia4BN3qkuneMUt8afszucJThi+QC7g87LR1HFMr+W0ksZDqBByltDHrdTGF6Z8XsUWwmVISYr0PTlAvnlTptd8DEJgHl4vAf7Z5O6xEjK/3/s9kNYKAIpWAADjLmEYzf96WNjVyPhInJc2UsfIVMxHf3s1SB7NqvrPGfB2Dcs1C+BE4r00uzIzmYUy9FV3Ak4WH5cMem8cgSLvJSMw2qJfVTfwIIZOLFXIS4l0ugBrIJaaEexyVQnpQZaRlCqSHdD/5KyXvIpMkfNQymxrjRK4OTAsH5dCBIJWY15bstyfwUtbf5qxJldflm7vL7kEqzqxa3tWOiZ2dHwupMJyaU//A3lX7T2xkMdo/HkqPs84llpSyBnyV+8gyHbGBsYEBYcHIzOBMOcuyAr3degKBJlGOboZF7sZRzmaZs0cavjLbucC1gVVnwlwjF9YrROTXxTCqdRC+BcTk1br5MQv8EIqFV74y+SE1TYx+SSbfAKCahP0fPtJ74nvbUKUckEZRSCIsIBSHhkUkygXaiEHDzH8xp24gvTpqvl7628g+oHWQc1I4dlLBh8iORGh4evXoYhT4VUz/IgH9YV8CC5BHpUFE8VgYLx9bsKptO87v1MoAbezFe6KcoHmTs5nFnY06wVD1oRcjRIlkKPkv2hw+TCbL0XZofAWQu6vdCKjf5MIvLH+qqdy+Rv2M90oTQICpx4om7+BVXFzS/Jyn62KPfdtUgK3esmOx21sjc/dWy3VnJY9XjKO1b0U5Hnev0bkf3yn2P2GubT2h1lCsDJ6vRFguhRVLn383nTDynzE6o9yHspLK3uuYRYnFmEXQwBo5tojhzdZ6+tTzQHm1azFevTw0SNm9Q2ppgATyCYGfkggomfvjDt/zfX2QeU/fry8QrQFWGKyGfyc2CZ5mt8mYo3OIkSFtCHyZsZWAApc3q6+LCqJ52UiG4UMrEnOqUDxAWjX8KPT9UFhxjCqbyQydOtL+MaKazQNtb/OWHN+ryNdPZq8P+LdLCrYix+SdFcU72Sa7e/wG9qZp+yVzGN1tftpZl5/5GV13TCmlVYvK79/aKjxchgnWUssgBP5RWSeNrKGy4mrlCiLCPR0IzZDSDIeOuScDYxgolNSJo+eOuOsIDDx52+H0u6eZXD9w6bcuEnJHQrgr0OI38XjAiA3nxws0vGL/E+HfFbA/ZGROfKbQsMccphLhHeROOUXHN5Sb2nA4X6iild5FkWsxFgxz/5vW2XNX6wvOq9r5l/rdTav/mczbzj69j9GaCTyV3QEp1+G3YyKQ+UCDUyvKdErA/EECu/yIffeH9ZPA4xe3zs4SkZsbURAjEdxdLvPNC5CyQUF/eB7xbth7mFVFZyqKi0zF14TzJKaJozf32yxB1E32jEJK/mUnzqb270bGQC+EfpyqLifqFAhsXHT7y1u8+Pbneoxgunl6Hf07tMXPeCl/mEniArewmGckYvcXYKiSln+j18eqFxGEgV3vCB2p6gvnfWB7IlGw9DPkFc8/EreNw3peR72zYbD1K2q1C5nZtP0iWwhMCn0cZreUS6Iv4nKUrgK6z+lmdL+Dbf4SoYFiS1++NB2TA/JRnqcoU0+tV9JsZrwfq80/wz1uxnmLr9kqs/lf6dVu6bwpcZqH05LfU1h6rji0B2rzs6PpWflu1N+royTiQEeHWI4hF/bhYB9Xbj5dqyN7CQ2scm0Y9IiBJ8jxzAWTCj+Q50gwD3GqFhlLpwJ4AGU6oX6Qx1p0ErH5bqqO/mwkp4nFI0g+V75SiFgVTM2jBLObe8s2BkYLenvx4hZd8CnqQpjguUcHVS3CyMOjtK97C2X6Pf4aHredWPtztb2+/2db+w5gZL+qdNhpKULiP5f3Kt2zVWJna93aOU4gQo7B3Yu23lk5xU7b9sJSnB6wfq6F+2N9uqB3BzN2dhg3+CCwX2DFw3eMAgqnTf4bEBLeqSvdrZhfl/nrN/Z29HNo5xNh6k8Jwkh6KBP/71BfVQxwx6YOEFZyVCwx48I0siZ0teWZqyfzOBW+wu1j8e4lAsdF3nAS7zZCpIu0PHnFxC0frKiGAVcyRcfyUWP+wypEvaT8TcNMxGqBt1NnZJx7dno3tTbPD51WmL+YlpsWT0W57qfcpFr8B9IHN+ASyx41BSeL/boz9QLHgL/kmcDAbUuCEcRKkXfONWpuJg+9eaz3L4KYNP6Ra5Gm8DdZlt13A0Gx4XPNW2lKof81z0aNVjS0NDQ0BRNas4/ba9rW0OOqnGp3uhto/j5RemYlZ2Zv6hkk7MYgjJXfe73cho0fXFeRcWjU4cdHR0dHR3dV93uW6E1f4caA5h9bTiJ4NMcfyvaQp1/02ifsTszj2Z84N3dNjD6awsBMBtz3Cdx1lZU5jCPhdYh9D8VHAoUZmMezHxYq3OstHpwbbMudF1eVuwsLC3TCYUEUlQGnjR2KCkngRwK2PUmwZixOMzZ+x3YWU346ZM2MMv/5qYAvgP4XYI/JeDaWjUnjSsnUssk4CGwutv5DFSz7Q2uV11Pfwh/Pc0eLKaD8/pazWo9ZPT76XATFdl+Oxi6VLnjwYdp4qbImetdGKDAguX/foNUt9+N9BUnEcRWXwQEYe6fhUPpJucyN/PUt6s5srMQhucoclTTCWRUO7zgAIL1FTmWDRY82ChcFsNJV18PO6fRSUdFCRysdox87sjiW+JBNbVvjY/HhCQR6YiKPs+UhjSYY+v3tuwDDocFbmKtGS/TTGF+vegtByy8Pez1sly6QagIKAgUDlxVfqEodK4ZKv+SbEOw1fI4tZUA5PkR4X2B1fl88DF0eWaDcOCYngloNj3wPfGCShJgtsL5Xo2/FJf6u1oIo7fQ7q07YKYH7cwmHACby+9NE8XRjlegOrVpPsRTuZNeBSrPp3ekxxmL63ir9zoiLuY8FTRZKiob6W02rD8X6TQoWnVl2Vf2Zuh14X5rgerx0GuYFPpTGZIWZd/JrVsfN0e8wH/Y76l8l/XaH2WuFP61EigFlvtf+TqNCWGFTXaPqPL3kFddJJ8ZPvWzcbfh7kHWsWxB4wdWiyvZEFdCWVMbom1fW4wuPtXbijomrkCO4rkwIvuz8sU6mL+zVzMLyzA5N9dQqeoKtFCSrBPRt7pVUv+VyY7aNup7bT6qFK00sQYKtZ8pT+Jk4x0gSR2Cy8p0iK57ebGSNK5O/xU8C3wTzID2zBWw2y5vuWCVs5UyJV//LMOgBfe/77lM68qorUnLJLogP7OPpZmkU6RioSYTGt09519knl6qlF6t7O7P1GPTxEs4/wv0+MKeuu/+4IpZkwQYTCP7yuNesMpnvn3T/8mGGAhzWdBRloaZZfHsK+qBJ2Objd1zbFcZDXsYzKaM3Qdev0K064XF8lWqsbRqVCIT339VBZp3FZxXJg1HbFDCfTP/jDOGdrvMq5nnPqhpV2ZuDOfvMZkMKSxypMP98j3uPx5vdSplKfG04jJ14/t6rxYb+W2UrUmIVoyhvQjkpzT3L/Y/QMXqUZ7ngWbcuHy9d37FI9l3cuskIeQyYL0oSS8OiX9vsdBsmQcxJUpuHbneEBPbBSXN7JfHGRd/namS7jgvuqzqEy1DLgUmwzRU3E6OCdj5ygEomoIQEUHE8XTP3Prw3PMfsGwP9UAQBEFQKBQK0Wg0Go0udToPQ7VYYo5x4D21lYxO5YLRkx+lKnq4WSo3OM2RJeZS4qcNk5AmDWBTYuep/zMUzhzi2mDCRPR6ZkvXj6TaCHgfsxzixagvZKy/fEpt6g6sbaBnc8bQ7sT8teFzK9BHpkeLLux6dLNr0D9kOqcsq4+hllOYKXTJXQQK84rQzXkNugmTs7kSfavtOpqVeXHswzqu4PMxXdAgxNu9gZGOZnL9neLafD3Jpu+iRzXpjnmZ1K064sNaVii2lnlAZhbaHxRZLMCNEFZh796m4Lv13QNfaKMezXFWR02T1Pt0pN33gKb5XITbCqeyuiZDKIne2fHacaxlZbZdISDAfARQZex7z1eYaWSoenvYotnlBtP1UD71zxkfx9HvON9lclCk8uqfxnqgTQUoX86SVg7yhK8ihDHhllrpL0gnDfoqo6e9clWVaok0WBQKhUKZIqFUS9XRqsWGlpaWlrZoaXFLBJttb9+m/5tCm8B9bxJxi4C6TdsipKampqZWTU0dVoMVQfi3daBeF9YzsKiZipzuuJO/PIHQz5TTfi6kKPB4C14GPlCsozqh2MUIE5DEFLxR6WKVGSyaebfjtbd5e1NSmiBDxW7maoAGmnRJbV4Nbt95P8c8vH51+TTnK1B0/pWQ2w5SEJG6gUT7dCCne1POi096LLdRDsK7Uq/4ULRgx+Xt3Ogj94qttWm4IpW1oRapwpZoNbLFXsEhCYOkcIndWF1KX8R+EKcilSLot1SnzVqkGyymSrfgFDaSy+fkOKjTwmEAS5qSys24DZbsTEyZWiZIu1THI5bmPPy20QzqHqzLTV1p655oUe9FKfQGjQJA4ehCwUdjjiDp9Gp7vzrON/MTmhR2FGtCAahRf3eG2MHLlsT1kGMtq41QLwYFnutgr+4CK23m4WD+8UFx8ZJ7IKi0rhFyVLo2Xm9CFF3rkRKz0oLvgYx0RyUKrK8HRhEv5PwtUE/tQ2m99oIWRVzm+XwD5GTRRGbDBRU7FokkkwG31el1NxWXxp04mbpusENHFLRDldRZIm3KQRsWFWmJIWb+JzM+oT6aTjdUoItdjx9CTLtCRZ2fE7bel1HoCn0ORryTNF3Kz6EcVKcFvVdrIgrTec3poD6FSktizeqg1hXoXCmuOCR/eRonBlXv86w+RSlY2lqsg6BOSUtzOqiDaOnorAJ0UCyuNy5GbpA0Y+iQmU0TxjA0S/4LBgIbZghgBXneNyfnOGcWppijvQ+oFS4lmFGFoBhi5uDpUObZa18aLR8sDJncT1TG+z6jt/GNk/Ntu0eWAfb3L8MtoUQjjuOTR+uJF04f7E7VOubXlKmv7RTjtThOuc0p0FczbOtc9s+ODJXdzes7NYfm7tE8yMge5nA4PWWT9/7rV0SQe9US27f9uO/TpJvG7MZkMuFUYY3QpnPK5BtYKE5VuPX2TFe9Dz7PpNB6PeGMIb7JeQfowTlJl0wq33Mn/H2+m3d3vaUjgKbSLW8Dsszy+IcW9WxBkso1WqKeYi+aDUX6H8/6l+ihL9XZxufFKmvhexaavcT42lwA7wOPek25WfJQ1JWjtHuazJhVAjem9DppXlyan1/IjDuc4zKmW17ur9rYbBqWT/6MWpG+/3x7DNkk/2sx8Mreuy3nBuiK4nKrkrJ4A5CuaYL8G2HrX8DHwDQfN26e32EcpocrvCuENrsc9DPL5HKx+MIXaNbciPdxylUNm+E3H5Mtzfiz4+iC8HDLlEt3XgqjWQ8bpwxJNatc+40qPolEwXBGI32t/ZZDtGV6250+Sf/LEc3pIlaB4otC69GMpN0a/WHdsvWCSv0JVlzOJJJL8MLWUNRQRRYE9720OoeMDWmeOuV2hkJTjDkd8dFR+XgKetvmxNl2htGfekpgCoIx0bmjuzVifjdC2TVm+KntYB7aW5rWJL1DVzPkQVaBkP5eK5L88qyRxW7OqoeVeJSGNJcnyUd1ISVxsdn2Epu2mSGTUzatsYGroX1NFX9dqDoC1o4mWfg9Vf+znkobv0zvgIkHW9HBBowjpF36khG40OAuEJ98SQDgtMrcHxEAo+MMaGJlcyCzDvloNdWsG3Q5iFondsj8lF7bM3964e5l4bA3oJ2IxQoUEISfcVUcQdyx7o69zWPZ9AjrKueqNuLYkyP6LPzDAJHNw9LAO7YA7AkbWI274lfa4g4gqzXlpdvatR/hResJj9yRQ6Zcr7nl5asMnVeWJlxyX75eyJnBU7028a1iX4dhPQu+F4IhaNwnB5zsFtzu6KpP7GSRoiytmh3tBH1q45T/hm4HHsH5HvOaYjnqHWW4zTrGJUyV5kep2DlWOCb8O5KZ6GUwpfHdNU6RFdUfvR6ndMnKfxb8xCk9+0R9elQzBoCF18N+98KHvg09vAU3nZ7G4h297PqdDIql4rdTd7sDE8tedzjZ+Lmc5CYMTg41dp79aFFrZlsY+m7OCFh+M89ZZ10Xhz/VBzY2bfQszCMtPQ4WmRnu6ZmlQv1bNukk51Pu4N/c7X9MOERzPu/wep3tBn9162JLNnN6/LN7Cn6TfX5OcbCywVjZWYGk3R8tEFokLQ43Xy6fx6Vzy3IZHk1z5cwSyY0+NZkQa6xZCq4I2/4xii8zCog56uEXwi83B7AGTWIj+/ORMMBVseYfyWq4dIZYf4nFekOALHCT+qjnJ85RcZbODpr9wCLLfIoinmQK8Rda4k4qIhc4OJ1bEi8aHaSDSAX2uvIujNePkJ2ltBS5zvbxNvNmNW6D25Ta/kaLcelyPU6XUAjysVkzVhTL4xqiUbQdKPTIUsEjbFucl4UMjUq9+uNvaZWy8G3UvM0NJTfGIbsLUGU6jSjbUihDyfCb2PbLZ5XuosyYCyCPxzzaoOKzhC++aFz5V6Us1csRTo8ypHjhANhYRgkH8bWmSgMKagAz6UzCLSmt0dup+2v/QAKcgtfmce0ZyUj53pAnbAmR8JFBXoccy3F9Vy3QIjz4pisE2go34kgnR2fd7HH9oDbGEE2h7XGkmpuU69GDMq2Mqc6LN6cXTMgyODWCt4nNVvrsqU1PiA/dlFM4iKW1gbSfeNsPvbtCPpXK1sS7KQrbk/x4pmr3u+0earrdjKNu+IUB8CgBvbRHLsXaXqAYXaqjKZXW1lBRKq1taUXVElEdKZFTHcGpRE51kVRORXRmi60ktQX1lzqLSfKOHo9SfxJp7sLOg2/TM7lqzRWo/8u1VrpR/7PdqHD1y5W+FuRWK93LTYP1mpCR/NWvA7lWDz22iQZkKW/2hIcRPD2TiZxnZCS6kSC/7AxnZcU36Ukp5ax+ndNDVTkNdQlTr1j/FeWrUvXK+dlZiehn3zpmpSyfYHokhbvo2sYkzHaCK8yCg46NjQHbR6JxbsjMGbQfL+hQlxJRMUVXxVCeGQ33B/LYo1ddI00aJoPdvPNFCfl3qG1fvK9jhfm5cP/oMno1z8YavGhC6b/4QY7Fw638F+Kl/+GE/VEAeRiv1yo3nVtPOiTDACQKaYnL2GhX2bb1y77u2f80fnxpacbMtLSte3bviJE2hbqfMnEgw/zg5YJ5o/Ugmm7QLan2/T7/BePHW8tgAAlNrIb7Tdst1rjvO0XoZ7ht6ig14A0/BJ2uPWcK81P7+6MM/8eelWU5KTzYniQkisvunmx9/nkNwzrrutnmk6WoE5H+t+9n3z0W6z/p40dz74NnCP3Cht3L++R2ud8PGnSzq10D5qfLL9MvR9/sQk/s8ImfUmB3+Sk/TT+dfJW6oK/8uj3/EsnO7CqNFOUBIiSaojwkSWoCJtaU7ZUQO6u7HYuUiIGMWUZMZO7MdrKrtdQjzZzxuPjb+cGLvZUEMUgAFUQokmqUIYl8ppyoDBCSUGuHCvrdKzxXKoMkkEGOcoUwkXxMyt3LvVUEpY1oIRcGmXogP/DUoKKmBSMlyQRSMEXz28nl9K42mT3Jk8u/FKOHCZwRVFpmQGlyAdGGWy/DTnwLcgsC34KK+i7IpzJ65etQVq7HysF/W3lyUgYDDgY6PiRKA893i1YdgIGTj9bUxC4LTrvwSbkgzDjzygY5y9l0tqXlLFUz5/394WuT3p8QLLtR8Pg0Luo5mE+Zyd4fCFazlTCfTpPkzz6Y61u48+/+UmTK5++pGBbxErcSM/DG+3vMbXv/kXfHJraJK+tQBdNg+rMAyAH8+9+qlGttBnPtHfHZKzIark8GKjQbiABWsSaY2LkjlRGUlWhQuc16N7VEKT2v5egTyHBEtxEjNM78tDF4Zroso8CrQUQZjvs5mxwTkcXHIeXsasFsYR+5gl7E1QQ7chY0+q7K6a0UUA5XrDPAIaK9EMrIdk+vnSnsHBsYyJAOfAFUbkox8Mk8HSXcO/imhOAWDNI29D2B9oJRgDB3xJfNJILD2E5Vm4hldQy6EmSSyUi3K7w2q7fMEHmUA0hTjlkRVgVsRUwfhALCfHBSqgNoK0A71xIAkBvMnjPgFCE7YCMRh85cAWxunADcREtA8H47Qh0bFSLMHph1MkNx74W0HecM3QJIZJgCVWRGM4T8sR97YxfYdUHyTHJB+57lCt8lgyxLC7SR85lsE8nIXFRPwJn9LoSum+8OX6jAFLJYrClnFijfMIcRUWjpCpLOVO/wBZDxUxESAjIxtLFNQAEmCXGAPopg5itPPbvoiNy+ioCodbl6ZrDmTG0Z/QHysK2r+ZmfDv0JmLeDzjx+kV3VNSGRhNH9FFTDU6vJ6AJhLT/QWLELmtvRFrgYEKdaHSeyD1MHZcF3knL0YzLc3ZxIPuKlIks5rcoaMkTX1oJsuDmzIVrXUeCQbp45u62reejvk4YPnVlWw5prsJeL7FWVW71HtTO+Wxu6gyOslszbV9GunmemxLobBiy33A6xRQjVUm7ZoiRh3p1J+eNsHSksgNbkDjNhXzM9OYY7Kw5oklyLH5W8/2GJW+5rzmWOC85Appv0er3j7k0Cx1WGpyWJXXLvg3a+o5WHaXzixF0P19fMhJwIxmJYHonWYqlimLxBu2hS1VoHqnzvVJBBeuZ0t2hDnURn7F8E/DLssSGbcvvpOq7qHoL/xdCtnvLybnpBhdLTk75PPhnt9o+6pjwnVX7l7purOv2lY550alDFw5lGhkaeiflpftcB7Mav4jzFWe4JLTz8/ENwkiY6N56i47r3FJ3HqibnIXu1f+7/sqf1ONAw6WQvO/XJveMOVzCv+t/lI/mln26pJ5Q9J/99Mk6d/i9nzvS5U9M/gF6puc+fzKjrgV41xZnMxpdR05wWDzh7nozqKerznmx6SGjR7v4r/3LT5TETg6FdVVVP9LdiuQlF80hrcUQL6UyVkoFEPXW5fbY3FiEGYdU5dbntwd3+NTXJY82sUAXY5L23E/hEXyVV5kKrDrN9QydAwLgytaQUupoS1Dnz1hvLk0iYlwj34ttGReCpRcf5NIL91wEjj1H3mNENjJmSY4TBep6CgtmfQyrnZoA+QLxWi00v2Uca+t7PKo8lE/G1bLWXoWf7R6TIsdVcmM3BZXZxvRy01WpVJU/n4bWPEzQ7fjvdqoSqQkyrWbnpfprWuqFqmlwSf0BUuxRB6zaUbh5S6EA9j4PVWEbRESjmuLoxRFmnMNuJmVRdT0qtHaQB0VIbGx3JrvHzrdfWKuS6iejzC9SFJkb8xwwreEfL/tsqN22YAAwYDa5iw+iDDaCNAwZjOmiHVqaO1r3aUS43xrRMDnGhPVivi6IIWBFT68oAWGi7Ak/QVKlM1Ae6CHRMCliFFmtjUz2xVlKDNljvOObGZLJr/CEQDIA2Be2qeNu6ptLlk/8v4q2U4uHQZf9tvR1wNjkHCNb5WppPA8GIBrwTB9A7Bms1arBda3XxejUE6JSbi/OuaGdT0enztuuXtbWHlFq4u48OTmqjzpmONHrljLGjixisly34RkALqU1i1bYBNMDQS782kMmuUbsRnBtdCwWwS3YtVi6X8F/Vo9TyCXOyHgsMlvuhQ+sDhp7MGCcY3DxF5UZ0tUGDoeg5QgQCsy1mS+ZoWmNBYFgfI3ZosI7mE4bI2R0mDMAQt5a5zC3AnoukdKwNgq6akxARv7KZ3R2GjuU1lrEwQ19ZjTnQv9vsZxtwN5AfPNLYWMctT0HI+XHIg/cGgRExQHBqjKYGv4/gvTIdkfzUMJR9ddzCA6J6ekVsegxjpUW4+3noJGmMWs+pTDIOBpdIPwM46zxWtTgcsmPc5VYmh455CJ55bpw3HsmuzW8yiB8G9JXW1vD1LSrFV9hPZWuBmsbjihwzvf47Xb2OGF5jpEghTp3PsJ+3tI2BpvgSiSC4FIInR8HQ2PHQ74nSQCAhuehiOd+UHqMIoZ7WEDoPaXQQYh6vkbCL3j5wimJwKwbrboYisH99kco3RXA0UAKY1g0x2TU+ddxSjIEa4+MIl5tobQ50TGVTze0hM3ZWbgtTTy9D6OIMX3Tqt577Y9Fxu/JOiGd5E2ZHIROFGHi0zL1MHDkyW7RMm08r1frUOhAHIpsORP2aklodkOTxQRh79fmV7tbdHAnFh2HE3q0ke2JK6fJG6qYhNHB2Lh02rGTX+NSyYxHi1mUMenws1sKJz7luukC6oesdRdr8u4rf58KPJckivGTVX/i8f5lflih5uS0igWnPHGcSRpmVLr/ILIIBhZMHUGpefqwlFswz5hOz8pBOuQJif1rgRJno5w9ztHB8GhmVfWntYOZExPy4DfnDElCD7EPIp4042TUOLy+y9H4T6ULn5M+fDOAuct/X5ympPyEZxbr5d3X/eWX5zDmtSda9HpLcjqd0ypL2+ZlTGiQeRXiJSXxKWgvc0pKSJ58keUDMzds/QJSEleL3FxGdJO975QqIRpecDOroeMJ9kaedu7SEdZdi7SXlqXw+Rf0AxIZ0HIb9ZZMq2TW+QT6lnCX1HTGK8y4bWus0vPGd97nzT94EpAvNE7YYLs6k828WkIxPociURgyJ8Igp+dBKCH1qU3Bpb0ywa2OHzrsZZLHF+yTWtqEIYcoagsmNkJ+0XYFX/FeMUTKl4zSSxXboOVTW8xQUgf3lKJWbNdA2JPGetUpd2TW+OY4JMaQnZ9o2vA0/fxPn6jPcpseuAzKdhaFMV5R/1xqJAp9FSAhksh3B7bXQOgBN8kGIOogLQHqJBDWxteA2JqK6qwmSB8ThgRbnIhAOQz2dZ2s9xGgB7v4sLRFr1FLStaxTJBCfE6ANqQD2nz9I5TdHEBto6brpXBFXdo3DspL0/kAytY0Rfv9X7/sP/KU8xch5Fx2rzkoXup2i8m9n8nnKS3FxnX4+bfkWJ7no90+XI+OJmTJm7vLoHPsv2ZRdDISTi6jP+eQ9chF4Wj4wu9NIy04Ldvcf9F9xRp02cxulQOnBMEYfXhjowlww+9/fpfK/J8CGfIqxfKhirew6WbhU9JZVOe86h8gleIAAoCb430E7yxr0fzSZOwCA3Qv0BQDA3pdFqMj/K314XgHAwQAAEBhgRCn4W1EVF149XlYOXfJ2CchvO51CncsYeZcqmR4QPBo1xqj6LLeV5UGSUh19iTxeQ2ExbWn0lWQESQe+id241ZUH66X2KlCr3U3j4m5+3rytS5XNh47j0WqoL5GRmbGksdRMlTYa7aJzM1kOqvqTbX/gvmNLkBbbG6gRRBB1KHGQcVSh045rxTuWQJkcyXJty5L8XsfY16wGoJmI6MYkNXtLElk5idqaSB5auepwS3MdqiipeUEOTxa2OIOePPCJtGhXECXTVQnHYxKWcLoYKj+XPrR9HM14+T3fu2Y7gSVZqkRSaOsHHhNlInXUK8uYB1kSttwiuqK6u2Dt6aJAxM8+SHMretjTlrKdr3s+sozxIPucja8apS1NOE4jpAdY+3rgmuBV8Gh1vdKlBGqZPdoDPWnnq4AgOuAiBvUAC18bUNqx+JXAdu6bO1qmvdl8TircWhYmAHvWUllEsJTm504Gp17Ql8Jx7DM8pBfcGEXIyxilAADb6M0SAADfJ+XASq2FGbKHbA30+cD7RMBb0oou6mlxhyWRnrPxfrY9ddYn3V1KsziHrsBLMOZodvgwVhZnqHMA0G4vuQdh7dyDqXvtHkKYtidJhrR7KMakQufWvUTdVwA56pY7qqRxmz3LokZJKHUaE50Vu5WTmd+rCEksASkOKnceXCSwKeJgZ1JDz6YGf7pSBeR/z8+LiPhtHkoYs5Xc38yhVtobwnD1azEfmr0WqkN2oQNFwKZJiSKFgsx0RcySFL3b1tVsnBqVStlZcKNgDuuKVUttuGNvUrd2PslW0jhyMJM811SVIznFuYiqVpNa6j7Lf8wBdnhEFe3IKaUeMQyzSw+Lw8MnoEadBk1atOnQpUefAUNGjJkwZeYQc0IWLFmxZsOWHXsOHDlx5sKVG91P9+TFm89AlSRg/l/isCOOOiYIGwcXD5+AUAYRMQkpGTkFJRU1DS0dPYNMWbLlyJUnXwEjk+NGlavQqVKjOv2mjaml1KlNgy7VXveFfWaMmHfHshOeZTFK7g6bFbc9cNc99xV65KFVJ2Ubs+sDHyrWL0+JMuXsKsw4qVqVGrUc6tRr0KhZk01atbhg2GVtOly1YcmyPU986rSbVqx6wxm3vanXrJe8HBjqg4AXfR4k/OiVl9547Xc/eOEnv/jRz34NCtGIQSzi4Lsu/nDmJCm/I5VytQ/P5RSfysk8QQ9qrKD79mUFPf7q9CFtyJje7jWFL44LuN9dPLyI8Xe7AQ==) format('woff2');
            unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
        }
    </style>
    <style>
        /* W3.CSS 4.15 December 2020 by Jan Egil and Borge Refsnes */
        html {
            box-sizing: border-box
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit
        }

        /* Extract from normalize.css by Nicolas Gallagher and Jonathan Neal git.io/normalize */
        html {
            -ms-text-size-adjust: 100%;
            -webkit-text-size-adjust: 100%
        }

        body {
            margin: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        main,
        menu,
        nav,
        section {
            display: block
        }

        summary {
            display: list-item
        }

        audio,
        canvas,
        progress,
        video {
            display: inline-block
        }

        progress {
            vertical-align: baseline
        }

        audio:not([controls]) {
            display: none;
            height: 0
        }

        [hidden],
        template {
            display: none
        }

        a {
            background-color: transparent
        }

        a:active,
        a:hover {
            outline-width: 0
        }

        abbr[title] {
            border-bottom: none;
            text-decoration: underline;
            text-decoration: underline dotted
        }

        b,
        strong {
            font-weight: bolder
        }

        dfn {
            font-style: italic
        }

        mark {
            background: #ff0;
            color: #000
        }

        small {
            font-size: 80%
        }

        sub,
        sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -0.25em
        }

        sup {
            top: -0.5em
        }

        figure {
            margin: 1em 40px
        }

        img {
            border-style: none
        }

        code,
        kbd,
        pre,
        samp {
            font-family: monospace, monospace;
            font-size: 1em
        }

        hr {
            box-sizing: content-box;
            height: 0;
            overflow: visible
        }

        button,
        input,
        select,
        textarea,
        optgroup {
            font: inherit;
            margin: 0
        }

        optgroup {
            font-weight: bold
        }

        button,
        input {
            overflow: visible
        }

        button,
        select {
            text-transform: none
        }

        button,
        [type=button],
        [type=reset],
        [type=submit] {
            -webkit-appearance: button
        }

        button::-moz-focus-inner,
        [type=button]::-moz-focus-inner,
        [type=reset]::-moz-focus-inner,
        [type=submit]::-moz-focus-inner {
            border-style: none;
            padding: 0
        }

        button:-moz-focusring,
        [type=button]:-moz-focusring,
        [type=reset]:-moz-focusring,
        [type=submit]:-moz-focusring {
            outline: 1px dotted ButtonText
        }

        fieldset {
            border: 1px solid #c0c0c0;
            margin: 0 2px;
            padding: .35em .625em .75em
        }

        legend {
            color: inherit;
            display: table;
            max-width: 100%;
            padding: 0;
            white-space: normal
        }

        textarea {
            overflow: auto
        }

        [type=checkbox],
        [type=radio] {
            padding: 0
        }

        [type=number]::-webkit-inner-spin-button,
        [type=number]::-webkit-outer-spin-button {
            height: auto
        }

        [type=search] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        [type=search]::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        /* End extract */
        html,
        body {
            font-family: Verdana, sans-serif;
            font-size: 15px;
            line-height: 1.5
        }

        html {
            overflow-x: hidden
        }

        h1 {
            font-size: 36px
        }

        h2 {
            font-size: 30px
        }

        h3 {
            font-size: 24px
        }

        h4 {
            font-size: 20px
        }

        h5 {
            font-size: 18px
        }

        h6 {
            font-size: 16px
        }

        .w3-serif {
            font-family: serif
        }

        .w3-sans-serif {
            font-family: sans-serif
        }

        .w3-cursive {
            font-family: cursive
        }

        .w3-monospace {
            font-family: monospace
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            font-family: "Segoe UI", Arial, sans-serif;
            font-weight: 400;
            margin: 10px 0
        }

        .w3-wide {
            letter-spacing: 4px
        }

        hr {
            border: 0;
            border-top: 1px solid #eee;
            margin: 20px 0
        }

        .w3-image {
            max-width: 100%;
            height: auto
        }

        img {
            vertical-align: middle
        }

        a {
            color: inherit
        }

        .w3-table,
        .w3-table-all {
            border-collapse: collapse;
            border-spacing: 0;
            width: 100%;
            display: table
        }

        .w3-table-all {
            border: 1px solid #ccc
        }

        .w3-bordered tr,
        .w3-table-all tr {
            border-bottom: 1px solid #ddd
        }

        .w3-striped tbody tr:nth-child(even) {
            background-color: #f1f1f1
        }

        .w3-table-all tr:nth-child(odd) {
            background-color: #fff
        }

        .w3-table-all tr:nth-child(even) {
            background-color: #f1f1f1
        }

        .w3-hoverable tbody tr:hover,
        .w3-ul.w3-hoverable li:hover {
            background-color: #ccc
        }

        .w3-centered tr th,
        .w3-centered tr td {
            text-align: center
        }

        .w3-table td,
        .w3-table th,
        .w3-table-all td,
        .w3-table-all th {
            padding: 8px 8px;
            display: table-cell;
            text-align: left;
            vertical-align: top
        }

        .w3-table th:first-child,
        .w3-table td:first-child,
        .w3-table-all th:first-child,
        .w3-table-all td:first-child {
            padding-left: 16px
        }

        .w3-btn,
        .w3-button {
            border: none;
            display: inline-block;
            padding: 8px 16px;
            vertical-align: middle;
            overflow: hidden;
            text-decoration: none;
            color: inherit;
            background-color: inherit;
            text-align: center;
            cursor: pointer;
            white-space: nowrap
        }

        .w3-btn:hover {
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)
        }

        .w3-btn,
        .w3-button {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        .w3-disabled,
        .w3-btn:disabled,
        .w3-button:disabled {
            cursor: not-allowed;
            opacity: 0.3
        }

        .w3-disabled *,
        :disabled * {
            pointer-events: none
        }

        .w3-btn.w3-disabled:hover,
        .w3-btn:disabled:hover {
            box-shadow: none
        }

        .w3-badge,
        .w3-tag {
            background-color: #000;
            color: #fff;
            display: inline-block;
            padding-left: 8px;
            padding-right: 8px;
            text-align: center
        }

        .w3-badge {
            border-radius: 50%
        }

        .w3-ul {
            list-style-type: none;
            padding: 0;
            margin: 0
        }

        .w3-ul li {
            padding: 8px 16px;
            border-bottom: 1px solid #ddd
        }

        .w3-ul li:last-child {
            border-bottom: none
        }

        .w3-tooltip,
        .w3-display-container {
            position: relative
        }

        .w3-tooltip .w3-text {
            display: none
        }

        .w3-tooltip:hover .w3-text {
            display: inline-block
        }

        .w3-ripple:active {
            opacity: 0.5
        }

        .w3-ripple {
            transition: opacity 0s
        }

        .w3-input {
            padding: 8px;
            display: block;
            border: none;
            border-bottom: 1px solid #ccc;
            width: 100%
        }

        .w3-select {
            padding: 9px 0;
            width: 100%;
            border: none;
            border-bottom: 1px solid #ccc
        }

        .w3-dropdown-click,
        .w3-dropdown-hover {
            position: relative;
            display: inline-block;
            cursor: pointer
        }

        .w3-dropdown-hover:hover .w3-dropdown-content {
            display: block
        }

        .w3-dropdown-hover:first-child,
        .w3-dropdown-click:hover {
            background-color: #ccc;
            color: #000
        }

        .w3-dropdown-hover:hover>.w3-button:first-child,
        .w3-dropdown-click:hover>.w3-button:first-child {
            background-color: #ccc;
            color: #000
        }

        .w3-dropdown-content {
            cursor: auto;
            color: #000;
            background-color: #fff;
            display: none;
            position: absolute;
            min-width: 160px;
            margin: 0;
            padding: 0;
            z-index: 1
        }

        .w3-check,
        .w3-radio {
            width: 24px;
            height: 24px;
            position: relative;
            top: 6px
        }

        .w3-sidebar {
            height: 100%;
            width: 200px;
            background-color: #fff;
            position: fixed !important;
            z-index: 1;
            overflow: auto
        }

        .w3-bar-block .w3-dropdown-hover,
        .w3-bar-block .w3-dropdown-click {
            width: 100%
        }

        .w3-bar-block .w3-dropdown-hover .w3-dropdown-content,
        .w3-bar-block .w3-dropdown-click .w3-dropdown-content {
            min-width: 100%
        }

        .w3-bar-block .w3-dropdown-hover .w3-button,
        .w3-bar-block .w3-dropdown-click .w3-button {
            width: 100%;
            text-align: left;
            padding: 8px 16px
        }

        .w3-main,
        #main {
            transition: margin-left .4s
        }

        .w3-modal {
            z-index: 3;
            display: none;
            padding-top: 100px;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4)
        }

        .w3-modal-content {
            margin: auto;
            background-color: #fff;
            position: relative;
            padding: 0;
            outline: 0;
            width: 600px
        }

        .w3-bar {
            width: 100%;
            overflow: hidden
        }

        .w3-center .w3-bar {
            display: inline-block;
            width: auto
        }

        .w3-bar .w3-bar-item {
            padding: 8px 16px;
            float: left;
            width: auto;
            border: none;
            display: block;
            outline: 0
        }

        .w3-bar .w3-dropdown-hover,
        .w3-bar .w3-dropdown-click {
            position: static;
            float: left
        }

        .w3-bar .w3-button {
            white-space: normal
        }

        .w3-bar-block .w3-bar-item {
            width: 100%;
            display: block;
            padding: 8px 16px;
            text-align: left;
            border: none;
            white-space: normal;
            float: none;
            outline: 0
        }

        .w3-bar-block.w3-center .w3-bar-item {
            text-align: center
        }

        .w3-block {
            display: block;
            width: 100%
        }

        .w3-responsive {
            display: block;
            overflow-x: auto
        }

        .w3-container:after,
        .w3-container:before,
        .w3-panel:after,
        .w3-panel:before,
        .w3-row:after,
        .w3-row:before,
        .w3-row-padding:after,
        .w3-row-padding:before,
        .w3-cell-row:before,
        .w3-cell-row:after,
        .w3-clear:after,
        .w3-clear:before,
        .w3-bar:before,
        .w3-bar:after {
            content: "";
            display: table;
            clear: both
        }

        .w3-col,
        .w3-half,
        .w3-third,
        .w3-twothird,
        .w3-threequarter,
        .w3-quarter {
            float: left;
            width: 100%
        }

        .w3-col.s1 {
            width: 8.33333%
        }

        .w3-col.s2 {
            width: 16.66666%
        }

        .w3-col.s3 {
            width: 24.99999%
        }

        .w3-col.s4 {
            width: 33.33333%
        }

        .w3-col.s5 {
            width: 41.66666%
        }

        .w3-col.s6 {
            width: 49.99999%
        }

        .w3-col.s7 {
            width: 58.33333%
        }

        .w3-col.s8 {
            width: 66.66666%
        }

        .w3-col.s9 {
            width: 74.99999%
        }

        .w3-col.s10 {
            width: 83.33333%
        }

        .w3-col.s11 {
            width: 91.66666%
        }

        .w3-col.s12 {
            width: 99.99999%
        }

        @media (min-width:601px) {
            .w3-col.m1 {
                width: 8.33333%
            }

            .w3-col.m2 {
                width: 16.66666%
            }

            .w3-col.m3,
            .w3-quarter {
                width: 24.99999%
            }

            .w3-col.m4,
            .w3-third {
                width: 33.33333%
            }

            .w3-col.m5 {
                width: 41.66666%
            }

            .w3-col.m6,
            .w3-half {
                width: 49.99999%
            }

            .w3-col.m7 {
                width: 58.33333%
            }

            .w3-col.m8,
            .w3-twothird {
                width: 66.66666%
            }

            .w3-col.m9,
            .w3-threequarter {
                width: 74.99999%
            }

            .w3-col.m10 {
                width: 83.33333%
            }

            .w3-col.m11 {
                width: 91.66666%
            }

            .w3-col.m12 {
                width: 99.99999%
            }
        }

        @media (min-width:993px) {
            .w3-col.l1 {
                width: 8.33333%
            }

            .w3-col.l2 {
                width: 16.66666%
            }

            .w3-col.l3 {
                width: 24.99999%
            }

            .w3-col.l4 {
                width: 33.33333%
            }

            .w3-col.l5 {
                width: 41.66666%
            }

            .w3-col.l6 {
                width: 49.99999%
            }

            .w3-col.l7 {
                width: 58.33333%
            }

            .w3-col.l8 {
                width: 66.66666%
            }

            .w3-col.l9 {
                width: 74.99999%
            }

            .w3-col.l10 {
                width: 83.33333%
            }

            .w3-col.l11 {
                width: 91.66666%
            }

            .w3-col.l12 {
                width: 99.99999%
            }
        }

        .w3-rest {
            overflow: hidden
        }

        .w3-stretch {
            margin-left: -16px;
            margin-right: -16px
        }

        .w3-content,
        .w3-auto {
            margin-left: auto;
            margin-right: auto
        }

        .w3-content {
            max-width: 980px
        }

        .w3-auto {
            max-width: 1140px
        }

        .w3-cell-row {
            display: table;
            width: 100%
        }

        .w3-cell {
            display: table-cell
        }

        .w3-cell-top {
            vertical-align: top
        }

        .w3-cell-middle {
            vertical-align: middle
        }

        .w3-cell-bottom {
            vertical-align: bottom
        }

        .w3-hide {
            display: none !important
        }

        .w3-show-block,
        .w3-show {
            display: block !important
        }

        .w3-show-inline-block {
            display: inline-block !important
        }

        @media (max-width:1205px) {
            .w3-auto {
                max-width: 95%
            }
        }

        @media (max-width:600px) {
            .w3-modal-content {
                margin: 0 10px;
                width: auto !important
            }

            .w3-modal {
                padding-top: 30px
            }

            .w3-dropdown-hover.w3-mobile .w3-dropdown-content,
            .w3-dropdown-click.w3-mobile .w3-dropdown-content {
                position: relative
            }

            .w3-hide-small {
                display: none !important
            }

            .w3-mobile {
                display: block;
                width: 100% !important
            }

            .w3-bar-item.w3-mobile,
            .w3-dropdown-hover.w3-mobile,
            .w3-dropdown-click.w3-mobile {
                text-align: center
            }

            .w3-dropdown-hover.w3-mobile,
            .w3-dropdown-hover.w3-mobile .w3-btn,
            .w3-dropdown-hover.w3-mobile .w3-button,
            .w3-dropdown-click.w3-mobile,
            .w3-dropdown-click.w3-mobile .w3-btn,
            .w3-dropdown-click.w3-mobile .w3-button {
                width: 100%
            }
        }

        @media (max-width:768px) {
            .w3-modal-content {
                width: 500px
            }

            .w3-modal {
                padding-top: 50px
            }
        }

        @media (min-width:993px) {
            .w3-modal-content {
                width: 900px
            }

            .w3-hide-large {
                display: none !important
            }

            .w3-sidebar.w3-collapse {
                display: block !important
            }
        }

        @media (max-width:992px) and (min-width:601px) {
            .w3-hide-medium {
                display: none !important
            }
        }

        @media (max-width:992px) {
            .w3-sidebar.w3-collapse {
                display: none
            }

            .w3-main {
                margin-left: 0 !important;
                margin-right: 0 !important
            }

            .w3-auto {
                max-width: 100%
            }
        }

        .w3-top,
        .w3-bottom {
            position: fixed;
            width: 100%;
            z-index: 1
        }

        .w3-top {
            top: 0
        }

        .w3-bottom {
            bottom: 0
        }

        .w3-overlay {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2
        }

        .w3-display-topleft {
            position: absolute;
            left: 0;
            top: 0
        }

        .w3-display-topright {
            position: absolute;
            right: 0;
            top: 0
        }

        .w3-display-bottomleft {
            position: absolute;
            left: 0;
            bottom: 0
        }

        .w3-display-bottomright {
            position: absolute;
            right: 0;
            bottom: 0
        }

        .w3-display-middle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            -ms-transform: translate(-50%, -50%)
        }

        .w3-display-left {
            position: absolute;
            top: 50%;
            left: 0%;
            transform: translate(0%, -50%);
            -ms-transform: translate(-0%, -50%)
        }

        .w3-display-right {
            position: absolute;
            top: 50%;
            right: 0%;
            transform: translate(0%, -50%);
            -ms-transform: translate(0%, -50%)
        }

        .w3-display-topmiddle {
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%, 0%);
            -ms-transform: translate(-50%, 0%)
        }

        .w3-display-bottommiddle {
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translate(-50%, 0%);
            -ms-transform: translate(-50%, 0%)
        }

        .w3-display-container:hover .w3-display-hover {
            display: block
        }

        .w3-display-container:hover span.w3-display-hover {
            display: inline-block
        }

        .w3-display-hover {
            display: none
        }

        .w3-display-position {
            position: absolute
        }

        .w3-circle {
            border-radius: 50%
        }

        .w3-round-small {
            border-radius: 2px
        }

        .w3-round,
        .w3-round-medium {
            border-radius: 4px
        }

        .w3-round-large {
            border-radius: 8px
        }

        .w3-round-xlarge {
            border-radius: 16px
        }

        .w3-round-xxlarge {
            border-radius: 32px
        }

        .w3-row-padding,
        .w3-row-padding>.w3-half,
        .w3-row-padding>.w3-third,
        .w3-row-padding>.w3-twothird,
        .w3-row-padding>.w3-threequarter,
        .w3-row-padding>.w3-quarter,
        .w3-row-padding>.w3-col {
            padding: 0 8px
        }

        .w3-container,
        .w3-panel {
            padding: 0.01em 16px
        }

        .w3-panel {
            margin-top: 16px;
            margin-bottom: 16px
        }

        .w3-code,
        .w3-codespan {
            font-family: Consolas, "courier new";
            font-size: 16px
        }

        .w3-code {
            width: auto;
            background-color: #fff;
            padding: 8px 12px;
            border-left: 4px solid #4CAF50;
            word-wrap: break-word
        }

        .w3-codespan {
            color: crimson;
            background-color: #f1f1f1;
            padding-left: 4px;
            padding-right: 4px;
            font-size: 110%
        }

        .w3-card,
        .w3-card-2 {
            box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.16), 0 2px 10px 0 rgba(0, 0, 0, 0.12)
        }

        .w3-card-4,
        .w3-hover-shadow:hover {
            box-shadow: 0 4px 10px 0 rgba(0, 0, 0, 0.2), 0 4px 20px 0 rgba(0, 0, 0, 0.19)
        }

        .w3-spin {
            animation: w3-spin 2s infinite linear
        }

        @keyframes w3-spin {
            0% {
                transform: rotate(0deg)
            }

            100% {
                transform: rotate(359deg)
            }
        }

        .w3-animate-fading {
            animation: fading 10s infinite
        }

        @keyframes fading {
            0% {
                opacity: 0
            }

            50% {
                opacity: 1
            }

            100% {
                opacity: 0
            }
        }

        .w3-animate-opacity {
            animation: opac 0.8s
        }

        @keyframes opac {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        .w3-animate-top {
            position: relative;
            animation: animatetop 0.4s
        }

        @keyframes animatetop {
            from {
                top: -300px;
                opacity: 0
            }

            to {
                top: 0;
                opacity: 1
            }
        }

        .w3-animate-left {
            position: relative;
            animation: animateleft 0.4s
        }

        @keyframes animateleft {
            from {
                left: -300px;
                opacity: 0
            }

            to {
                left: 0;
                opacity: 1
            }
        }

        .w3-animate-right {
            position: relative;
            animation: animateright 0.4s
        }

        @keyframes animateright {
            from {
                right: -300px;
                opacity: 0
            }

            to {
                right: 0;
                opacity: 1
            }
        }

        .w3-animate-bottom {
            position: relative;
            animation: animatebottom 0.4s
        }

        @keyframes animatebottom {
            from {
                bottom: -300px;
                opacity: 0
            }

            to {
                bottom: 0;
                opacity: 1
            }
        }

        .w3-animate-zoom {
            animation: animatezoom 0.6s
        }

        @keyframes animatezoom {
            from {
                transform: scale(0)
            }

            to {
                transform: scale(1)
            }
        }

        .w3-animate-input {
            transition: width 0.4s ease-in-out
        }

        .w3-animate-input:focus {
            width: 100% !important
        }

        .w3-opacity,
        .w3-hover-opacity:hover {
            opacity: 0.60
        }

        .w3-opacity-off,
        .w3-hover-opacity-off:hover {
            opacity: 1
        }

        .w3-opacity-max {
            opacity: 0.25
        }

        .w3-opacity-min {
            opacity: 0.75
        }

        .w3-greyscale-max,
        .w3-grayscale-max,
        .w3-hover-greyscale:hover,
        .w3-hover-grayscale:hover {
            filter: grayscale(100%)
        }

        .w3-greyscale,
        .w3-grayscale {
            filter: grayscale(75%)
        }

        .w3-greyscale-min,
        .w3-grayscale-min {
            filter: grayscale(50%)
        }

        .w3-sepia {
            filter: sepia(75%)
        }

        .w3-sepia-max,
        .w3-hover-sepia:hover {
            filter: sepia(100%)
        }

        .w3-sepia-min {
            filter: sepia(50%)
        }

        .w3-tiny {
            font-size: 10px !important
        }

        .w3-small {
            font-size: 12px !important
        }

        .w3-medium {
            font-size: 15px !important
        }

        .w3-large {
            font-size: 18px !important
        }

        .w3-xlarge {
            font-size: 24px !important
        }

        .w3-xxlarge {
            font-size: 36px !important
        }

        .w3-xxxlarge {
            font-size: 48px !important
        }

        .w3-jumbo {
            font-size: 64px !important
        }

        .w3-left-align {
            text-align: left !important
        }

        .w3-right-align {
            text-align: right !important
        }

        .w3-justify {
            text-align: justify !important
        }

        .w3-center {
            text-align: center !important
        }

        .w3-border-0 {
            border: 0 !important
        }

        .w3-border {
            border: 1px solid #ccc !important
        }

        .w3-border-top {
            border-top: 1px solid #ccc !important
        }

        .w3-border-bottom {
            border-bottom: 1px solid #ccc !important
        }

        .w3-border-left {
            border-left: 1px solid #ccc !important
        }

        .w3-border-right {
            border-right: 1px solid #ccc !important
        }

        .w3-topbar {
            border-top: 6px solid #ccc !important
        }

        .w3-bottombar {
            border-bottom: 6px solid #ccc !important
        }

        .w3-leftbar {
            border-left: 6px solid #ccc !important
        }

        .w3-rightbar {
            border-right: 6px solid #ccc !important
        }

        .w3-section,
        .w3-code {
            margin-top: 16px !important;
            margin-bottom: 16px !important
        }

        .w3-margin {
            margin: 16px !important
        }

        .w3-margin-top {
            margin-top: 16px !important
        }

        .w3-margin-bottom {
            margin-bottom: 16px !important
        }

        .w3-margin-left {
            margin-left: 16px !important
        }

        .w3-margin-right {
            margin-right: 16px !important
        }

        .w3-padding-small {
            padding: 4px 8px !important
        }

        .w3-padding {
            padding: 8px 16px !important
        }

        .w3-padding-large {
            padding: 12px 24px !important
        }

        .w3-padding-16 {
            padding-top: 16px !important;
            padding-bottom: 16px !important
        }

        .w3-padding-24 {
            padding-top: 24px !important;
            padding-bottom: 24px !important
        }

        .w3-padding-32 {
            padding-top: 32px !important;
            padding-bottom: 32px !important
        }

        .w3-padding-48 {
            padding-top: 48px !important;
            padding-bottom: 48px !important
        }

        .w3-padding-64 {
            padding-top: 64px !important;
            padding-bottom: 64px !important
        }

        .w3-padding-top-64 {
            padding-top: 64px !important
        }

        .w3-padding-top-48 {
            padding-top: 48px !important
        }

        .w3-padding-top-32 {
            padding-top: 32px !important
        }

        .w3-padding-top-24 {
            padding-top: 24px !important
        }

        .w3-left {
            float: left !important
        }

        .w3-right {
            float: right !important
        }

        .w3-button:hover {
            color: #000 !important;
            background-color: #ccc !important
        }

        .w3-transparent,
        .w3-hover-none:hover {
            background-color: transparent !important
        }

        .w3-hover-none:hover {
            box-shadow: none !important
        }

        /* Colors */
        .w3-amber,
        .w3-hover-amber:hover {
            color: #000 !important;
            background-color: #ffc107 !important
        }

        .w3-aqua,
        .w3-hover-aqua:hover {
            color: #000 !important;
            background-color: #00ffff !important
        }

        .w3-blue,
        .w3-hover-blue:hover {
            color: #fff !important;
            background-color: #2196F3 !important
        }

        .w3-light-blue,
        .w3-hover-light-blue:hover {
            color: #000 !important;
            background-color: #87CEEB !important
        }

        .w3-brown,
        .w3-hover-brown:hover {
            color: #fff !important;
            background-color: #795548 !important
        }

        .w3-cyan,
        .w3-hover-cyan:hover {
            color: #000 !important;
            background-color: #00bcd4 !important
        }

        .w3-blue-grey,
        .w3-hover-blue-grey:hover,
        .w3-blue-gray,
        .w3-hover-blue-gray:hover {
            color: #fff !important;
            background-color: #607d8b !important
        }

        .w3-green,
        .w3-hover-green:hover {
            color: #fff !important;
            background-color: #4CAF50 !important
        }

        .w3-light-green,
        .w3-hover-light-green:hover {
            color: #000 !important;
            background-color: #8bc34a !important
        }

        .w3-indigo,
        .w3-hover-indigo:hover {
            color: #fff !important;
            background-color: #3f51b5 !important
        }

        .w3-khaki,
        .w3-hover-khaki:hover {
            color: #000 !important;
            background-color: #f0e68c !important
        }

        .w3-lime,
        .w3-hover-lime:hover {
            color: #000 !important;
            background-color: #cddc39 !important
        }

        .w3-orange,
        .w3-hover-orange:hover {
            color: #000 !important;
            background-color: #ff9800 !important
        }

        .w3-deep-orange,
        .w3-hover-deep-orange:hover {
            color: #fff !important;
            background-color: #ff5722 !important
        }

        .w3-pink,
        .w3-hover-pink:hover {
            color: #fff !important;
            background-color: #e91e63 !important
        }

        .w3-purple,
        .w3-hover-purple:hover {
            color: #fff !important;
            background-color: #9c27b0 !important
        }

        .w3-deep-purple,
        .w3-hover-deep-purple:hover {
            color: #fff !important;
            background-color: #673ab7 !important
        }

        .w3-red,
        .w3-hover-red:hover {
            color: #fff !important;
            background-color: #f44336 !important
        }

        .w3-sand,
        .w3-hover-sand:hover {
            color: #000 !important;
            background-color: #fdf5e6 !important
        }

        .w3-teal,
        .w3-hover-teal:hover {
            color: #fff !important;
            background-color: #009688 !important
        }

        .w3-yellow,
        .w3-hover-yellow:hover {
            color: #000 !important;
            background-color: #ffeb3b !important
        }

        .w3-white,
        .w3-hover-white:hover {
            color: #000 !important;
            background-color: #fff !important
        }

        .w3-black,
        .w3-hover-black:hover {
            color: #fff !important;
            background-color: #000 !important
        }

        .w3-grey,
        .w3-hover-grey:hover,
        .w3-gray,
        .w3-hover-gray:hover {
            color: #000 !important;
            background-color: #9e9e9e !important
        }

        .w3-light-grey,
        .w3-hover-light-grey:hover,
        .w3-light-gray,
        .w3-hover-light-gray:hover {
            color: #000 !important;
            background-color: #f1f1f1 !important
        }

        .w3-dark-grey,
        .w3-hover-dark-grey:hover,
        .w3-dark-gray,
        .w3-hover-dark-gray:hover {
            color: #fff !important;
            background-color: #616161 !important
        }

        .w3-pale-red,
        .w3-hover-pale-red:hover {
            color: #000 !important;
            background-color: #ffdddd !important
        }

        .w3-pale-green,
        .w3-hover-pale-green:hover {
            color: #000 !important;
            background-color: #ddffdd !important
        }

        .w3-pale-yellow,
        .w3-hover-pale-yellow:hover {
            color: #000 !important;
            background-color: #ffffcc !important
        }

        .w3-pale-blue,
        .w3-hover-pale-blue:hover {
            color: #000 !important;
            background-color: #ddffff !important
        }

        .w3-text-amber,
        .w3-hover-text-amber:hover {
            color: #ffc107 !important
        }

        .w3-text-aqua,
        .w3-hover-text-aqua:hover {
            color: #00ffff !important
        }

        .w3-text-blue,
        .w3-hover-text-blue:hover {
            color: #2196F3 !important
        }

        .w3-text-light-blue,
        .w3-hover-text-light-blue:hover {
            color: #87CEEB !important
        }

        .w3-text-brown,
        .w3-hover-text-brown:hover {
            color: #795548 !important
        }

        .w3-text-cyan,
        .w3-hover-text-cyan:hover {
            color: #00bcd4 !important
        }

        .w3-text-blue-grey,
        .w3-hover-text-blue-grey:hover,
        .w3-text-blue-gray,
        .w3-hover-text-blue-gray:hover {
            color: #607d8b !important
        }

        .w3-text-green,
        .w3-hover-text-green:hover {
            color: #4CAF50 !important
        }

        .w3-text-light-green,
        .w3-hover-text-light-green:hover {
            color: #8bc34a !important
        }

        .w3-text-indigo,
        .w3-hover-text-indigo:hover {
            color: #3f51b5 !important
        }

        .w3-text-khaki,
        .w3-hover-text-khaki:hover {
            color: #b4aa50 !important
        }

        .w3-text-lime,
        .w3-hover-text-lime:hover {
            color: #cddc39 !important
        }

        .w3-text-orange,
        .w3-hover-text-orange:hover {
            color: #ff9800 !important
        }

        .w3-text-deep-orange,
        .w3-hover-text-deep-orange:hover {
            color: #ff5722 !important
        }

        .w3-text-pink,
        .w3-hover-text-pink:hover {
            color: #e91e63 !important
        }

        .w3-text-purple,
        .w3-hover-text-purple:hover {
            color: #9c27b0 !important
        }

        .w3-text-deep-purple,
        .w3-hover-text-deep-purple:hover {
            color: #673ab7 !important
        }

        .w3-text-red,
        .w3-hover-text-red:hover {
            color: #f44336 !important
        }

        .w3-text-sand,
        .w3-hover-text-sand:hover {
            color: #fdf5e6 !important
        }

        .w3-text-teal,
        .w3-hover-text-teal:hover {
            color: #009688 !important
        }

        .w3-text-yellow,
        .w3-hover-text-yellow:hover {
            color: #d2be0e !important
        }

        .w3-text-white,
        .w3-hover-text-white:hover {
            color: #fff !important
        }

        .w3-text-black,
        .w3-hover-text-black:hover {
            color: #000 !important
        }

        .w3-text-grey,
        .w3-hover-text-grey:hover,
        .w3-text-gray,
        .w3-hover-text-gray:hover {
            color: #757575 !important
        }

        .w3-text-light-grey,
        .w3-hover-text-light-grey:hover,
        .w3-text-light-gray,
        .w3-hover-text-light-gray:hover {
            color: #f1f1f1 !important
        }

        .w3-text-dark-grey,
        .w3-hover-text-dark-grey:hover,
        .w3-text-dark-gray,
        .w3-hover-text-dark-gray:hover {
            color: #3a3a3a !important
        }

        .w3-border-amber,
        .w3-hover-border-amber:hover {
            border-color: #ffc107 !important
        }

        .w3-border-aqua,
        .w3-hover-border-aqua:hover {
            border-color: #00ffff !important
        }

        .w3-border-blue,
        .w3-hover-border-blue:hover {
            border-color: #2196F3 !important
        }

        .w3-border-light-blue,
        .w3-hover-border-light-blue:hover {
            border-color: #87CEEB !important
        }

        .w3-border-brown,
        .w3-hover-border-brown:hover {
            border-color: #795548 !important
        }

        .w3-border-cyan,
        .w3-hover-border-cyan:hover {
            border-color: #00bcd4 !important
        }

        .w3-border-blue-grey,
        .w3-hover-border-blue-grey:hover,
        .w3-border-blue-gray,
        .w3-hover-border-blue-gray:hover {
            border-color: #607d8b !important
        }

        .w3-border-green,
        .w3-hover-border-green:hover {
            border-color: #4CAF50 !important
        }

        .w3-border-light-green,
        .w3-hover-border-light-green:hover {
            border-color: #8bc34a !important
        }

        .w3-border-indigo,
        .w3-hover-border-indigo:hover {
            border-color: #3f51b5 !important
        }

        .w3-border-khaki,
        .w3-hover-border-khaki:hover {
            border-color: #f0e68c !important
        }

        .w3-border-lime,
        .w3-hover-border-lime:hover {
            border-color: #cddc39 !important
        }

        .w3-border-orange,
        .w3-hover-border-orange:hover {
            border-color: #ff9800 !important
        }

        .w3-border-deep-orange,
        .w3-hover-border-deep-orange:hover {
            border-color: #ff5722 !important
        }

        .w3-border-pink,
        .w3-hover-border-pink:hover {
            border-color: #e91e63 !important
        }

        .w3-border-purple,
        .w3-hover-border-purple:hover {
            border-color: #9c27b0 !important
        }

        .w3-border-deep-purple,
        .w3-hover-border-deep-purple:hover {
            border-color: #673ab7 !important
        }

        .w3-border-red,
        .w3-hover-border-red:hover {
            border-color: #f44336 !important
        }

        .w3-border-sand,
        .w3-hover-border-sand:hover {
            border-color: #fdf5e6 !important
        }

        .w3-border-teal,
        .w3-hover-border-teal:hover {
            border-color: #009688 !important
        }

        .w3-border-yellow,
        .w3-hover-border-yellow:hover {
            border-color: #ffeb3b !important
        }

        .w3-border-white,
        .w3-hover-border-white:hover {
            border-color: #fff !important
        }

        .w3-border-black,
        .w3-hover-border-black:hover {
            border-color: #000 !important
        }

        .w3-border-grey,
        .w3-hover-border-grey:hover,
        .w3-border-gray,
        .w3-hover-border-gray:hover {
            border-color: #9e9e9e !important
        }

        .w3-border-light-grey,
        .w3-hover-border-light-grey:hover,
        .w3-border-light-gray,
        .w3-hover-border-light-gray:hover {
            border-color: #f1f1f1 !important
        }

        .w3-border-dark-grey,
        .w3-hover-border-dark-grey:hover,
        .w3-border-dark-gray,
        .w3-hover-border-dark-gray:hover {
            border-color: #616161 !important
        }

        .w3-border-pale-red,
        .w3-hover-border-pale-red:hover {
            border-color: #ffe7e7 !important
        }

        .w3-border-pale-green,
        .w3-hover-border-pale-green:hover {
            border-color: #e7ffe7 !important
        }

        .w3-border-pale-yellow,
        .w3-hover-border-pale-yellow:hover {
            border-color: #ffffcc !important
        }

        .w3-border-pale-blue,
        .w3-hover-border-pale-blue:hover {
            border-color: #e7ffff !important
        }
    </style>
    <meta name="robots" content="noindex, nofollow" />
    <style type="text/css">
        html {
            background: var(--page-margin, black);
            overflow-x: hidden;
            font-size: large;
            font-family: 'B612', sans-serif;
            line-height: 1.3;
            color: var(--primary-text, white);
        }

        body {
            margin: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            align-content: center;
        }

        #beepboxEditorContainer {
            min-height: 645px;
            overflow: auto;
            background: var(--editor-background, black);
            width: 100%;
            padding-left: 30px;
            padding-right: 30px;
        }

        #text-content {
            overflow: auto;
            background: var(--editor-background, black);
            width: 100%;
            max-width: 700px;
            padding-left: 30px;
            padding-right: 30px;
        }

        h1 {
            font-size: 1.7rem;
            text-align: center;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            -webkit-text-stroke-width: 0;
        }

        h2 {
            font-size: 1.5rem;
            text-align: center;
            margin-top: 0.5em;
            margin-bottom: 0.5em;
            -webkit-text-stroke-width: 0;
        }

        .centerDiv {
            margin: 0px auto;
        }

        a {
            color: var(--link-accent, #98f);
        }

        .donation form {
            display: inline;
        }

        .donation input[type="submit"] {
            -webkit-appearance: none;
            appearance: none;
            background: none;
            border: none;
            font-family: inherit;
            font-size: inherit;
            color: var(--link-accent, #98f);
            text-decoration: underline;
            cursor: pointer;
            padding: 0;
            margin: 0;
        }

        /* wide screen */
        @media (min-width: 701px) {
            html {
                width: 100%;
            }

            body {
                width: 100%;
            }

            .column-container {
                width: 700px;
                display: flex;
                justify-content: space-between;
            }

            /*.instructions-column {
                width: 375px;
            }

            .twitter-column {
                width: 300px;
            }*/
        }

        /* narrow screen */
        @media (max-width: 700px) {
            body {
                width: 100%;
            }

            p,
            .donation {
                margin: 1em 0.5em;
            }

            .column-container {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>

<body>
    <div class="sidebar w3-sidebar w3-bar-block w3-border-right w3-animate-left"
        style="display:none;left:0;position:absolute;z-index:11;color:#fff;background-color:#000;" id="mySidebar">
        <button onclick="w3_close()" class="w3-bar-item w3-large">Close &times;</button>
        <a style="cursor: pointer;" onclick="save()" class="w3-bar-item w3-button">Save</a>
        <a style="cursor: pointer;" onclick="w3_close();document.getElementById('songs').style.display = 'block'"
            class="w3-bar-item w3-button">Songs</a>
        <a style="cursor: pointer;" onclick="share()" class="w3-bar-item w3-button">Open Share Link</a>
    </div>
    <div class="sidebar w3-sidebar w3-bar-block w3-border-right w3-animate-left"
        style="display:none;left:0;position:absolute;z-index:11;color:#fff;background-color:#000;" id="songs"></div>
    <div id="songs-div"></div>
    <button class="w3-button w3-xlarge" onclick="document.getElementById('mySidebar').style.display = 'block'"
        style="position:absolute;top:0;left:0;z-index:10;"></button>
    <script>
        function w3_close() {
            Array.from(document.getElementsByClassName("sidebar")).forEach((e) => {
                e.style.display = "none";
            });
        }
    </script>
    <div id="beepboxEditorContainer">
        <noscript>
            Sorry, JummBox requires a JavaScript-enabled browser.
        </noscript>
    </div>
    <script type="text/javascript">

        // Randomize display of header
        // 1-in-10
        /*if (Math.floor(Math.random() * 10) == 0) {
            switch (Math.floor(Math.random() * 4)) {
                case 0:
                    document.getElementById("jummboxPlant").innerHTML = "  ";
                    break;
                case 1:
                    document.getElementById("jummboxPlant").innerHTML = "  ";
                    break;
                case 2:
                    document.getElementById("jummboxPlant").innerHTML = "  ";
                    break;
                case 3:
                    document.getElementById("jummboxPlant").innerHTML = "  ";
                    break;
            }
        }*/

        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent)) {
            document.getElementById("introduction").innerHTML = "JummBox is an online tool for sketching and sharing chiptune melodies. Make sure that your volume is turned up, then press the play button!";
            document.getElementById("keyboard-instructions").style.display = "none";
            document.getElementById("bar-editing").innerHTML = "Tap the other boxes to move to a different part of the song, or tap on the currently selected box to swap which pattern is played during that part of the song.";
            //document.getElementById("offline-instructions").innerHTML = 'You can use BeepBox when your device is offline if you put a shortcut to BeepBox on your home screen. <ul><li>Chrome: find the "Add to Home Screen" option in the  menu.</li><li>Firefox: find the "Add Page Shortcut" option in the  menu.</li><li>Safari: find the "Add to Home Screen" option in the bookmark menu.</li></ul>';
        }

        var beepbox = function (t) {
            "use strict";
/*!
    Copyright (c) 2012-2022 John Nesky and contributing authors

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.
    */class e { } function i(t) { let e = 0; for (let i = 0; i < t.length; i++)e += t[i]; const i = e / t.length; for (let e = 0; e < t.length; e++)t[e] -= i; return n(t), t.push(0), new Float32Array(t) } function s(t) { let e = 0; i(t); for (let i = 0; i < t.length - 1; i++)e += Math.abs(t[i]); const s = e / (t.length - 1); for (let e = 0; e < t.length - 1; e++)t[e] = t[e] / s; return new Float32Array(t) } function n(t) { let e = 0, i = new Float32Array(t.length); for (let s = 0; s < t.length; s++)i[s] = e, e += t[s]; return i } function o(t, i, s) { let n = e.chipNoises[t].samples; if (null == n) { if (n = new Float32Array(e.chipNoiseLength + 1), e.chipNoises[t].samples = n, 0 == t) { let t = 1; for (let i = 0; i < e.chipNoiseLength; i++) { n[i] = 2 * (1 & t) - 1; let e = t >> 1; 1 == (t + e & 1) && (e += 16384), t = e } } else if (1 == t) for (let t = 0; t < e.chipNoiseLength; t++)n[t] = 2 * Math.random() - 1; else if (2 == t) { let t = 1; for (let i = 0; i < e.chipNoiseLength; i++) { n[i] = 2 * (1 & t) - 1; let e = t >> 1; 1 == (t + e & 1) && (e += 32768), t = e } } else if (3 == t) { let t = 1; for (let i = 0; i < e.chipNoiseLength; i++) { n[i] = 2 * (1 & t) - 1; let e = t >> 1; 1 == (t + e & 1) && (e += 40), t = e } } else if (4 == t) h(n, e.chipNoiseLength, 10, 11, 1, 1, 0), h(n, e.chipNoiseLength, 11, 14, .6578, .6578, 0), i(n, e.chipNoiseLength), s(n, 1 / Math.sqrt(e.chipNoiseLength)); else if (5 == t) for (var o = 1, a = 0; a < e.chipNoiseLength; a++) { n[a] = 2 * (1 & o) - 1, 1 == (o + (r = o >> 1) & 1) && (r += 40), o = r } else if (6 == t) h(n, e.chipNoiseLength, 1, 10, 1, 1, 0), h(n, e.chipNoiseLength, 20, 14, -2, -2, 0), i(n, e.chipNoiseLength), s(n, 1 / Math.sqrt(e.chipNoiseLength)); else if (7 == t) for (o = 1, a = 0; a < e.chipNoiseLength; a++) { n[a] = 4 * (1 & o) * (14 * Math.random() + 1), 1 == (o + (r = o >> 1) & 1) && (r += 60), o = r } else { if (8 != t) throw new Error("Unrecognized drum index: " + t); for (o = 1, a = 0; a < 32768; a++) { var r; n[a] = (1 & o) / 2 + .5, 1 == (o + (r = o >> 1) & 1) && (r -= 40), o = r } } n[e.chipNoiseLength] = n[0] } return n } function h(t, e, i, s, n, h, a) { const r = 0 | Math.pow(2, i), l = Math.min(e >> 1, 0 | Math.pow(2, s)), c = o(0, null, null); let d = 0; for (let o = r; o < l; o++) { let r = n + (h - n) * (Math.log2(o) - i) / (s - i), l = Math.pow(2, 7 * (r - 1) + 1) * r; l *= Math.pow(o / 2048, a), d += l, l *= c[o]; const p = .61803398875 * o * o * Math.PI * 2; t[o] = Math.cos(p) * l, t[e - o] = Math.sin(p) * l } return d } function a(t = 0) { const i = new Float32Array(e.sineWaveLength + 1), s = e.sineWaveLength / 4; for (let n = 0; n < e.sineWaveLength + 1; n++)i[n] = 2 * +(Math.abs(n - s) < t * e.sineWaveLength / 2 || Math.abs(n - e.sineWaveLength - s) < t * e.sineWaveLength / 2) - 1; return i } function r(t = !1) { const i = new Float32Array(e.sineWaveLength + 1); for (let s = 0; s < e.sineWaveLength + 1; s++)i[s] = 2 * (s + e.sineWaveLength / 4) / e.sineWaveLength % 2 - 1, i[s] = t ? -i[s] : i[s]; return i } function l(t, i, s) { let n = e.arpeggioPatterns[t - 1]; return null != n ? (2 == t && 0 == i && (n = [0, 0, 1, 1]), n[s % n.length]) : s % t } function c(t) { const e = {}; for (let i = 0; i < t.length; i++) { const s = t[i]; s.index = i, e[s.name] = s } const i = t; return i.dictionary = e, i } function d(t) { return 0 != (1024 & t) } function p(t) { return 0 != (2048 & t) } function u(t) { return 0 != (128 & t) } function m(t) { return 0 != (256 & t) } function f(t) { return 0 != (512 & t) } function y(t) { return 0 != (32 & t) } function b(t) { return 0 != (8 & t) } function g(t) { return 0 != (16 & t) } function w(t) { return 0 != (4 & t) } function v(t) { return 0 != (2 & t) } function k(t) { return 0 != (64 & t) } function x(t) { return 0 != (1 & t) } e.thresholdVal = -10, e.kneeVal = 40, e.ratioVal = 12, e.attackVal = 0, e.releaseVal = .25, e.scales = c([{ name: "Free", realName: "chromatic", flags: [!0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0, !0] }, { name: "Major", realName: "ionian", flags: [!0, !1, !0, !1, !0, !0, !1, !0, !1, !0, !1, !0] }, { name: "Minor", realName: "aeolian", flags: [!0, !1, !0, !0, !1, !0, !1, !0, !0, !1, !0, !1] }, { name: "Mixolydian", realName: "mixolydian", flags: [!0, !1, !0, !1, !0, !0, !1, !0, !1, !0, !0, !1] }, { name: "Lydian", realName: "lydian", flags: [!0, !1, !0, !1, !0, !1, !0, !0, !1, !0, !1, !0] }, { name: "Dorian", realName: "dorian", flags: [!0, !1, !0, !0, !1, !0, !1, !0, !1, !0, !0, !1] }, { name: "Phrygian", realName: "phrygian", flags: [!0, !0, !1, !0, !1, !0, !1, !0, !0, !1, !0, !1] }, { name: "Locrian", realName: "locrian", flags: [!0, !0, !1, !0, !1, !0, !0, !1, !0, !1, !0, !1] }, { name: "Lydian Dominant", realName: "lydian dominant", flags: [!0, !1, !0, !1, !0, !1, !0, !0, !1, !0, !0, !1] }, { name: "Phrygian Dominant", realName: "phrygian dominant", flags: [!0, !0, !1, !1, !0, !0, !1, !0, !0, !1, !0, !1] }, { name: "Harmonic Major", realName: "harmonic major", flags: [!0, !1, !0, !1, !0, !0, !1, !0, !0, !1, !1, !0] }, { name: "Harmonic Minor", realName: "harmonic minor", flags: [!0, !1, !0, !0, !1, !0, !1, !0, !0, !1, !1, !0] }, { name: "Melodic Minor", realName: "melodic minor", flags: [!0, !1, !0, !0, !1, !0, !1, !0, !1, !0, !1, !0] }, { name: "Blues", realName: "blues", flags: [!0, !1, !1, !0, !1, !0, !0, !0, !1, !1, !0, !1] }, { name: "Altered", realName: "altered", flags: [!0, !0, !1, !0, !0, !1, !0, !1, !0, !1, !0, !1] }, { name: "Major Pentatonic", realName: "major pentatonic", flags: [!0, !1, !0, !1, !0, !1, !1, !0, !1, !0, !1, !1] }, { name: "Minor Pentatonic", realName: "minor pentatonic", flags: [!0, !1, !1, !0, !1, !0, !1, !0, !1, !1, !0, !1] }, { name: "Whole Tone", realName: "whole tone", flags: [!0, !1, !0, !1, !0, !1, !0, !1, !0, !1, !0, !1] }, { name: "Octatonic", realName: "octatonic", flags: [!0, !1, !0, !0, !1, !0, !0, !1, !0, !0, !1, !0] }, { name: "Hexatonic", realName: "hexatonic", flags: [!0, !1, !1, !0, !0, !1, !1, !0, !0, !1, !1, !0] }]), e.keys = c([{ name: "C", isWhiteKey: !0, basePitch: 12 }, { name: "C", isWhiteKey: !1, basePitch: 13 }, { name: "D", isWhiteKey: !0, basePitch: 14 }, { name: "D", isWhiteKey: !1, basePitch: 15 }, { name: "E", isWhiteKey: !0, basePitch: 16 }, { name: "F", isWhiteKey: !0, basePitch: 17 }, { name: "F", isWhiteKey: !1, basePitch: 18 }, { name: "G", isWhiteKey: !0, basePitch: 19 }, { name: "G", isWhiteKey: !1, basePitch: 20 }, { name: "A", isWhiteKey: !0, basePitch: 21 }, { name: "A", isWhiteKey: !1, basePitch: 22 }, { name: "B", isWhiteKey: !0, basePitch: 23 }]), e.blackKeyNameParents = [-1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1], e.tempoMin = 30, e.tempoMax = 320, e.echoDelayRange = 24, e.echoDelayStepTicks = 4, e.echoSustainRange = 8, e.echoShelfHz = 4e3, e.echoShelfGain = Math.pow(2, -.5), e.reverbShelfHz = 8e3, e.reverbShelfGain = Math.pow(2, -1.5), e.reverbRange = 32, e.reverbDelayBufferSize = 16384, e.reverbDelayBufferMask = e.reverbDelayBufferSize - 1, e.beatsPerBarMin = 3, e.beatsPerBarMax = 16, e.barCountMin = 1, e.barCountMax = 256, e.instrumentCountMin = 1, e.layeredInstrumentCountMax = 4, e.patternInstrumentCountMax = 10, e.partsPerBeat = 24, e.ticksPerPart = 2, e.ticksPerArpeggio = 3, e.arpeggioPatterns = [[0], [0, 1], [0, 1, 2, 1], [0, 1, 2, 3], [0, 1, 2, 3, 4], [0, 1, 2, 3, 4, 5], [0, 1, 2, 3, 4, 5, 6], [0, 1, 2, 3, 4, 5, 6, 7]], e.rhythms = c([{ name: "3 (triplets)", stepsPerBeat: 3, roundUpThresholds: [5, 12, 18] }, { name: "4 (standard)", stepsPerBeat: 4, roundUpThresholds: [3, 9, 17, 21] }, { name: "6", stepsPerBeat: 6, roundUpThresholds: null }, { name: "8", stepsPerBeat: 8, roundUpThresholds: null }, { name: "freehand", stepsPerBeat: 24, roundUpThresholds: null }]), e.instrumentTypeNames = ["chip", "FM", "noise", "spectrum", "drumset", "harmonics", "PWM", "Picked String", "custom chip", "mod"], e.instrumentTypeHasSpecialInterval = [!0, !0, !1, !1, !1, !0, !1, !1, !1], e.chipBaseExpression = .03375, e.fmBaseExpression = .03, e.noiseBaseExpression = .19, e.spectrumBaseExpression = .3, e.drumsetBaseExpression = .45, e.harmonicsBaseExpression = .025, e.pwmBaseExpression = .04725, e.pickedStringBaseExpression = .025, e.distortionBaseVolume = .011, e.bitcrusherBaseVolume = .01, e.rawChipWaves = c([{ name: "rounded", expression: .94, samples: i([0, .2, .4, .5, .6, .7, .8, .85, .9, .95, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, .95, .9, .85, .8, .7, .6, .5, .4, .2, 0, -.2, -.4, -.5, -.6, -.7, -.8, -.85, -.9, -.95, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -.95, -.9, -.85, -.8, -.7, -.6, -.5, -.4, -.2]) }, { name: "triangle", expression: 1, samples: i([1 / 15, .2, 5 / 15, 7 / 15, .6, 11 / 15, 13 / 15, 1, 1, 13 / 15, 11 / 15, .6, 7 / 15, 5 / 15, .2, 1 / 15, -1 / 15, -.2, -5 / 15, -7 / 15, -.6, -11 / 15, -13 / 15, -1, -1, -13 / 15, -11 / 15, -.6, -7 / 15, -5 / 15, -.2, -1 / 15]) }, { name: "square", expression: .5, samples: i([1, -1]) }, { name: "1/4 pulse", expression: .5, samples: i([1, -1, -1, -1]) }, { name: "1/8 pulse", expression: .5, samples: i([1, -1, -1, -1, -1, -1, -1, -1]) }, { name: "sawtooth", expression: .65, samples: i([1 / 31, 3 / 31, 5 / 31, 7 / 31, 9 / 31, 11 / 31, 13 / 31, 15 / 31, 17 / 31, 19 / 31, 21 / 31, 23 / 31, 25 / 31, 27 / 31, 29 / 31, 1, -1, -29 / 31, -27 / 31, -25 / 31, -23 / 31, -21 / 31, -19 / 31, -17 / 31, -15 / 31, -13 / 31, -11 / 31, -9 / 31, -7 / 31, -5 / 31, -3 / 31, -1 / 31]) }, { name: "double saw", expression: .5, samples: i([0, -.2, -.4, -.6, -.8, -1, 1, -.8, -.6, -.4, -.2, 1, .8, .6, .4, .2]) }, { name: "double pulse", expression: .4, samples: i([1, 1, 1, 1, 1, -1, -1, -1, 1, 1, 1, 1, -1, -1, -1, -1]) }, { name: "spiky", expression: .4, samples: i([1, -1, 1, -1, 1, 0]) }, { name: "sine", expression: .88, samples: s([8, 9, 11, 12, 13, 14, 15, 15, 15, 15, 14, 14, 13, 11, 10, 9, 7, 6, 4, 3, 2, 1, 0, 0, 0, 0, 1, 1, 2, 4, 5, 6]) }, { name: "flute", expression: .8, samples: s([3, 4, 6, 8, 10, 11, 13, 14, 15, 15, 14, 13, 11, 8, 5, 3]) }, { name: "harp", expression: .8, samples: s([0, 3, 3, 3, 4, 5, 5, 6, 7, 8, 9, 11, 11, 13, 13, 15, 15, 14, 12, 11, 10, 9, 8, 7, 7, 5, 4, 3, 2, 1, 0, 0]) }, { name: "sharp clarinet", expression: .38, samples: s([0, 0, 0, 1, 1, 8, 8, 9, 9, 9, 8, 8, 8, 8, 8, 9, 9, 7, 9, 9, 10, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]) }, { name: "soft clarinet", expression: .45, samples: s([0, 1, 5, 8, 9, 9, 9, 9, 9, 9, 9, 11, 11, 12, 13, 12, 10, 9, 7, 6, 4, 3, 3, 3, 1, 1, 1, 1, 1, 1, 1, 1]) }, { name: "alto sax", expression: .3, samples: s([5, 5, 6, 4, 3, 6, 8, 7, 2, 1, 5, 6, 5, 4, 5, 7, 9, 11, 13, 14, 14, 14, 14, 13, 10, 8, 7, 7, 4, 3, 4, 2]) }, { name: "bassoon", expression: .35, samples: s([9, 9, 7, 6, 5, 4, 4, 4, 4, 5, 7, 8, 9, 10, 11, 13, 13, 11, 10, 9, 7, 6, 4, 2, 1, 1, 1, 2, 2, 5, 11, 14]) }, { name: "trumpet", expression: .22, samples: s([10, 11, 8, 6, 5, 5, 5, 6, 7, 7, 7, 7, 6, 6, 7, 7, 7, 7, 7, 6, 6, 6, 6, 6, 6, 6, 6, 7, 8, 9, 11, 14]) }, { name: "electric guitar", expression: .2, samples: s([11, 12, 12, 10, 6, 6, 8, 0, 2, 4, 8, 10, 9, 10, 1, 7, 11, 3, 6, 6, 8, 13, 14, 2, 0, 12, 8, 4, 13, 11, 10, 13]) }, { name: "organ", expression: .2, samples: s([11, 10, 12, 11, 14, 7, 5, 5, 12, 10, 10, 9, 12, 6, 4, 5, 13, 12, 12, 10, 12, 5, 2, 2, 8, 6, 6, 5, 8, 3, 2, 1]) }, { name: "pan flute", expression: .35, samples: s([1, 4, 7, 6, 7, 9, 7, 7, 11, 12, 13, 15, 13, 11, 11, 12, 13, 10, 7, 5, 3, 6, 10, 7, 3, 3, 1, 0, 1, 0, 1, 0]) }, { name: "glitch", expression: .5, samples: i([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1, -1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, -1]) }]), e.chipWaves = function (t) { const e = new Array(t.length), i = {}; for (let s = 0; s < e.length; s++) { e[s] = Object.assign([], t[s]); const n = e[s]; n.index = s, i[n.name] = n } for (let t in i) i[t].samples = n(i[t].samples); const s = e; return s.dictionary = i, s }(e.rawChipWaves), e.chipNoises = c([{ name: "retro", expression: .25, basePitch: 69, pitchFilterMult: 1024, isSoft: !1, samples: null }, { name: "white", expression: 1, basePitch: 69, pitchFilterMult: 8, isSoft: !0, samples: null }, { name: "clang", expression: .4, basePitch: 69, pitchFilterMult: 1024, isSoft: !1, samples: null }, { name: "buzz", expression: .3, basePitch: 69, pitchFilterMult: 1024, isSoft: !1, samples: null }, { name: "hollow", expression: 1.5, basePitch: 96, pitchFilterMult: 1, isSoft: !0, samples: null }, { name: "shine", expression: 1, basePitch: 69, pitchFilterMult: 1024, isSoft: !1, samples: null }, { name: "deep", expression: 1.5, basePitch: 120, pitchFilterMult: 1024, isSoft: !0, samples: null }, { name: "cutter", expression: .005, basePitch: 96, pitchFilterMult: 1024, isSoft: !1, samples: null }, { name: "metallic", expression: 1, basePitch: 96, pitchFilterMult: 1024, isSoft: !1, samples: null }]), e.filterFreqStep = 1 / 4, e.filterFreqRange = 34, e.filterFreqReferenceSetting = 28, e.filterFreqReferenceHz = 8e3, e.filterFreqMaxHz = e.filterFreqReferenceHz * Math.pow(2, e.filterFreqStep * (e.filterFreqRange - 1 - e.filterFreqReferenceSetting)), e.filterFreqMinHz = 8, e.filterGainRange = 15, e.filterGainCenter = 7, e.filterGainStep = .5, e.filterMaxPoints = 8, e.filterTypeNames = ["low-pass", "high-pass", "peak"], e.filterMorphCount = 10, e.filterSimpleCutRange = 11, e.filterSimplePeakRange = 8, e.fadeInRange = 10, e.fadeOutTicks = [-24, -12, -6, -3, -1, 6, 12, 24, 48, 72, 96], e.fadeOutNeutral = 4, e.drumsetFadeOutTicks = 48, e.transitions = c([{ name: "normal", isSeamless: !1, continues: !1, slides: !1, slideTicks: 3, includeAdjacentPatterns: !1 }, { name: "interrupt", isSeamless: !0, continues: !1, slides: !1, slideTicks: 3, includeAdjacentPatterns: !0 }, { name: "continue", isSeamless: !0, continues: !0, slides: !1, slideTicks: 3, includeAdjacentPatterns: !0 }, { name: "slide", isSeamless: !0, continues: !1, slides: !0, slideTicks: 3, includeAdjacentPatterns: !0 }, { name: "slide in pattern", isSeamless: !0, continues: !1, slides: !0, slideTicks: 3, includeAdjacentPatterns: !1 }]), e.vibratos = c([{ name: "none", amplitude: 0, type: 0, delayTicks: 0 }, { name: "light", amplitude: .15, type: 0, delayTicks: 0 }, { name: "delayed", amplitude: .3, type: 0, delayTicks: 37 }, { name: "heavy", amplitude: .45, type: 0, delayTicks: 0 }, { name: "shaky", amplitude: .1, type: 1, delayTicks: 0 }]), e.vibratoTypes = c([{ name: "normal", periodsSeconds: [.14], period: .14 }, { name: "shaky", periodsSeconds: [.11, .17798, .33], period: 266.97 }]), e.arpSpeedScale = [0, .0625, .125, .2, .25, 1 / 3, .4, .5, 2 / 3, .75, .8, .9, 1, 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 1.8, 1.9, 2, 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8, 2.9, 3, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 4, 4.15, 4.3, 4.5, 4.8, 5, 5.5, 6, 8], e.unisons = c([{ name: "none", voices: 1, spread: 0, offset: 0, expression: 1.4, sign: 1 }, { name: "shimmer", voices: 2, spread: .018, offset: 0, expression: .8, sign: 1 }, { name: "hum", voices: 2, spread: .045, offset: 0, expression: 1, sign: 1 }, { name: "honky tonk", voices: 2, spread: .09, offset: 0, expression: 1, sign: 1 }, { name: "dissonant", voices: 2, spread: .25, offset: 0, expression: .9, sign: 1 }, { name: "fifth", voices: 2, spread: 3.5, offset: 3.5, expression: .9, sign: 1 }, { name: "octave", voices: 2, spread: 6, offset: 6, expression: .8, sign: 1 }, { name: "bowed", voices: 2, spread: .02, offset: 0, expression: 1, sign: -1 }, { name: "piano", voices: 2, spread: .01, offset: 0, expression: 1, sign: .7 }, { name: "warbled", voices: 2, spread: .25, offset: .05, expression: .9, sign: -.8 }]), e.effectNames = ["reverb", "chorus", "panning", "distortion", "bitcrusher", "note filter", "echo", "pitch shift", "detune", "vibrato", "transition type", "chord type"], e.effectOrder = [2, 10, 11, 7, 8, 9, 5, 3, 4, 1, 6, 0], e.noteSizeMax = 6, e.volumeRange = 50, e.volumeLogScale = .1428, e.panCenter = 50, e.panMax = 2 * e.panCenter, e.panDelaySecondsMax = .001, e.chorusRange = 8, e.chorusPeriodSeconds = 2, e.chorusDelayRange = .0034, e.chorusDelayOffsets = [[1.51, 2.1, 3.35], [1.47, 2.15, 3.25]], e.chorusPhaseOffsets = [[0, 2.1, 4.2], [3.2, 5.3, 1]], e.chorusMaxDelay = e.chorusDelayRange * (1 + e.chorusDelayOffsets[0].concat(e.chorusDelayOffsets[1]).reduce(((t, e) => Math.max(t, e)))), e.chords = c([{ name: "simultaneous", customInterval: !1, arpeggiates: !1, strumParts: 0, singleTone: !1 }, { name: "strum", customInterval: !1, arpeggiates: !1, strumParts: 1, singleTone: !1 }, { name: "arpeggio", customInterval: !1, arpeggiates: !0, strumParts: 0, singleTone: !0 }, { name: "custom interval", customInterval: !0, arpeggiates: !1, strumParts: 0, singleTone: !0 }]), e.maxChordSize = 9, e.operatorCount = 4, e.maxPitchOrOperatorCount = Math.max(e.maxChordSize, e.operatorCount), e.algorithms = c([{ name: "1(234)", carrierCount: 1, associatedCarrier: [1, 1, 1, 1], modulatedBy: [[2, 3, 4], [], [], []] }, { name: "1(234)", carrierCount: 1, associatedCarrier: [1, 1, 1, 1], modulatedBy: [[2, 3], [], [4], []] }, { name: "12(34)", carrierCount: 1, associatedCarrier: [1, 1, 1, 1], modulatedBy: [[2], [3, 4], [], []] }, { name: "1(23)4", carrierCount: 1, associatedCarrier: [1, 1, 1, 1], modulatedBy: [[2, 3], [4], [4], []] }, { name: "1234", carrierCount: 1, associatedCarrier: [1, 1, 1, 1], modulatedBy: [[2], [3], [4], []] }, { name: "1324", carrierCount: 2, associatedCarrier: [1, 2, 1, 2], modulatedBy: [[3], [4], [], []] }, { name: "12(34)", carrierCount: 2, associatedCarrier: [1, 2, 2, 2], modulatedBy: [[], [3, 4], [], []] }, { name: "1234", carrierCount: 2, associatedCarrier: [1, 2, 2, 2], modulatedBy: [[], [3], [4], []] }, { name: "(12)34", carrierCount: 2, associatedCarrier: [1, 2, 2, 2], modulatedBy: [[3], [3], [4], []] }, { name: "(12)(34)", carrierCount: 2, associatedCarrier: [1, 2, 2, 2], modulatedBy: [[3, 4], [3, 4], [], []] }, { name: "1234", carrierCount: 3, associatedCarrier: [1, 2, 3, 3], modulatedBy: [[], [], [4], []] }, { name: "(123)4", carrierCount: 3, associatedCarrier: [1, 2, 3, 3], modulatedBy: [[4], [4], [4], []] }, { name: "1234", carrierCount: 4, associatedCarrier: [1, 2, 3, 4], modulatedBy: [[], [], [], []] }]), e.operatorCarrierInterval = [0, .04, -.073, .091], e.operatorAmplitudeMax = 15, e.operatorFrequencies = c([{ name: "1", mult: 1, hzOffset: 0, amplitudeSign: 1 }, { name: "~1", mult: 1, hzOffset: 1.5, amplitudeSign: -1 }, { name: "2", mult: 2, hzOffset: 0, amplitudeSign: 1 }, { name: "~2", mult: 2, hzOffset: -1.3, amplitudeSign: -1 }, { name: "3", mult: 3, hzOffset: 0, amplitudeSign: 1 }, { name: "4", mult: 4, hzOffset: 0, amplitudeSign: 1 }, { name: "5", mult: 5, hzOffset: 0, amplitudeSign: 1 }, { name: "6", mult: 6, hzOffset: 0, amplitudeSign: 1 }, { name: "7", mult: 7, hzOffset: 0, amplitudeSign: 1 }, { name: "8", mult: 8, hzOffset: 0, amplitudeSign: 1 }, { name: "9", mult: 9, hzOffset: 0, amplitudeSign: 1 }, { name: "11", mult: 11, hzOffset: 0, amplitudeSign: 1 }, { name: "13", mult: 13, hzOffset: 0, amplitudeSign: 1 }, { name: "16", mult: 16, hzOffset: 0, amplitudeSign: 1 }, { name: "20", mult: 20, hzOffset: 0, amplitudeSign: 1 }]), e.envelopes = c([{ name: "none", type: 1, speed: 0 }, { name: "note size", type: 0, speed: 0 }, { name: "punch", type: 2, speed: 0 }, { name: "flare 1", type: 3, speed: 32 }, { name: "flare 2", type: 3, speed: 8 }, { name: "flare 3", type: 3, speed: 2 }, { name: "twang 1", type: 4, speed: 32 }, { name: "twang 2", type: 4, speed: 8 }, { name: "twang 3", type: 4, speed: 2 }, { name: "swell 1", type: 5, speed: 32 }, { name: "swell 2", type: 5, speed: 8 }, { name: "swell 3", type: 5, speed: 2 }, { name: "tremolo1", type: 6, speed: 4 }, { name: "tremolo2", type: 6, speed: 2 }, { name: "tremolo3", type: 6, speed: 1 }, { name: "tremolo4", type: 7, speed: 4 }, { name: "tremolo5", type: 7, speed: 2 }, { name: "tremolo6", type: 7, speed: 1 }, { name: "decay 1", type: 8, speed: 10 }, { name: "decay 2", type: 8, speed: 7 }, { name: "decay 3", type: 8, speed: 4 }]), e.feedbacks = c([{ name: "1", indices: [[1], [], [], []] }, { name: "2", indices: [[], [2], [], []] }, { name: "3", indices: [[], [], [3], []] }, { name: "4", indices: [[], [], [], [4]] }, { name: "12", indices: [[1], [2], [], []] }, { name: "34", indices: [[], [], [3], [4]] }, { name: "123", indices: [[1], [2], [3], []] }, { name: "234", indices: [[], [2], [3], [4]] }, { name: "1 2 3 4", indices: [[1], [2], [3], [4]] }, { name: "12", indices: [[], [1], [], []] }, { name: "13", indices: [[], [], [1], []] }, { name: "14", indices: [[], [], [], [1]] }, { name: "23", indices: [[], [], [2], []] }, { name: "24", indices: [[], [], [], [2]] }, { name: "34", indices: [[], [], [], [3]] }, { name: "1324", indices: [[], [], [1], [2]] }, { name: "1423", indices: [[], [], [2], [1]] }, { name: "1234", indices: [[], [1], [2], [3]] }]), e.chipNoiseLength = 32768, e.spectrumNoiseLength = 32768, e.spectrumBasePitch = 24, e.spectrumControlPoints = 30, e.spectrumControlPointsPerOctave = 7, e.spectrumControlPointBits = 3, e.spectrumMax = (1 << e.spectrumControlPointBits) - 1, e.harmonicsControlPoints = 28, e.harmonicsRendered = 64, e.harmonicsRenderedForPickedString = 256, e.harmonicsControlPointBits = 3, e.harmonicsMax = (1 << e.harmonicsControlPointBits) - 1, e.harmonicsWavelength = 2048, e.pulseWidthRange = 50, e.pulseWidthStepPower = .5, e.pitchChannelCountMin = 1, e.pitchChannelCountMax = 40, e.noiseChannelCountMin = 0, e.noiseChannelCountMax = 16, e.modChannelCountMin = 0, e.modChannelCountMax = 12, e.noiseInterval = 6, e.pitchesPerOctave = 12, e.drumCount = 12, e.pitchOctaves = 8, e.modCount = 6, e.maxPitch = e.pitchOctaves * e.pitchesPerOctave, e.maximumTonesPerChannel = 2 * e.maxChordSize, e.justIntonationSemitones = [.5, 8 / 15, 9 / 16, .6, 5 / 8, 2 / 3, 32 / 45, 3 / 4, .8, 5 / 6, 8 / 9, 15 / 16, 1, 16 / 15, 9 / 8, 1.2, 5 / 4, 4 / 3, 45 / 32, 1.5, 1.6, 5 / 3, 16 / 9, 15 / 8, 2].map((t => Math.log2(t) * e.pitchesPerOctave)), e.pitchShiftRange = e.justIntonationSemitones.length, e.pitchShiftCenter = e.pitchShiftRange >> 1, e.detuneCenter = 200, e.detuneMax = 400, e.detuneMin = 0, e.songDetuneMin = 0, e.songDetuneMax = 500, e.sineWaveLength = 256, e.sineWaveMask = e.sineWaveLength - 1, e.sineWave = function () { const t = new Float32Array(e.sineWaveLength + 1); for (let i = 0; i < e.sineWaveLength + 1; i++)t[i] = Math.sin(i * Math.PI * 2 / e.sineWaveLength); return t }(), e.pickedStringDispersionCenterFreq = 6e3, e.pickedStringDispersionFreqScale = .3, e.pickedStringDispersionFreqMult = 4, e.pickedStringShelfHz = 4e3, e.distortionRange = 8, e.stringSustainRange = 15, e.stringDecayRate = .12, e.bitcrusherFreqRange = 14, e.bitcrusherOctaveStep = .5, e.bitcrusherQuantizationRange = 8, e.maxEnvelopeCount = 12, e.defaultAutomationRange = 13, e.instrumentAutomationTargets = c([{ name: "none", computeIndex: null, displayName: "none", interleave: !1, isFilter: !1, maxCount: 1, effect: null, compatibleInstruments: null }, { name: "noteVolume", computeIndex: 0, displayName: "note volume", interleave: !1, isFilter: !1, maxCount: 1, effect: null, compatibleInstruments: null }, { name: "pulseWidth", computeIndex: 2, displayName: "pulse width", interleave: !1, isFilter: !1, maxCount: 1, effect: null, compatibleInstruments: [6] }, { name: "stringSustain", computeIndex: 3, displayName: "sustain", interleave: !1, isFilter: !1, maxCount: 1, effect: null, compatibleInstruments: [7] }, { name: "unison", computeIndex: 4, displayName: "unison", interleave: !1, isFilter: !1, maxCount: 1, effect: null, compatibleInstruments: [0, 5, 7] }, { name: "operatorFrequency", computeIndex: 5, displayName: "fm# freq", interleave: !0, isFilter: !1, maxCount: e.operatorCount, effect: null, compatibleInstruments: [1] }, { name: "operatorAmplitude", computeIndex: 9, displayName: "fm# volume", interleave: !1, isFilter: !1, maxCount: e.operatorCount, effect: null, compatibleInstruments: [1] }, { name: "feedbackAmplitude", computeIndex: 13, displayName: "fm feedback", interleave: !1, isFilter: !1, maxCount: 1, effect: null, compatibleInstruments: [1] }, { name: "pitchShift", computeIndex: 14, displayName: "pitch shift", interleave: !1, isFilter: !1, maxCount: 1, effect: 7, compatibleInstruments: null }, { name: "detune", computeIndex: 15, displayName: "detune", interleave: !1, isFilter: !1, maxCount: 1, effect: 8, compatibleInstruments: null }, { name: "vibratoDepth", computeIndex: 16, displayName: "vibrato range", interleave: !1, isFilter: !1, maxCount: 1, effect: 9, compatibleInstruments: null }, { name: "noteFilterAllFreqs", computeIndex: 1, displayName: "n. filter freqs", interleave: !1, isFilter: !0, maxCount: 1, effect: 5, compatibleInstruments: null }, { name: "noteFilterFreq", computeIndex: 17, displayName: "n. filter # freq", interleave: !1, isFilter: !0, maxCount: e.filterMaxPoints, effect: 5, compatibleInstruments: null }]), e.operatorWaves = c([{ name: "sine", samples: e.sineWave }, { name: "triangle", samples: function () { const t = new Float32Array(e.sineWaveLength + 1); for (let i = 0; i < e.sineWaveLength + 1; i++)t[i] = Math.asin(Math.sin(i * Math.PI * 2 / e.sineWaveLength)) / (Math.PI / 2); return t }() }, { name: "sawtooth", samples: r() }, { name: "pulse width", samples: a() }, { name: "ramp", samples: r(!0) }, { name: "trapezoid", samples: function (t = 2) { const i = new Float32Array(e.sineWaveLength + 1); for (let s = 0; s < e.sineWaveLength + 1; s++)i[s] = Math.max(-1, Math.min(1, Math.asin(Math.sin(s * Math.PI * 2 / e.sineWaveLength)) * t)); return i }(2) }]), e.pwmOperatorWaves = c([{ name: "1%", samples: a(.01) }, { name: "5%", samples: a(.05) }, { name: "12.5%", samples: a(.125) }, { name: "25%", samples: a(.25) }, { name: "33%", samples: a(1 / 3) }, { name: "50%", samples: a(.5) }, { name: "66%", samples: a(2 / 3) }, { name: "75%", samples: a(.75) }, { name: "87.5%", samples: a(.875) }, { name: "95%", samples: a(.95) }, { name: "99%", samples: a(.99) }]), e.barEditorHeight = 10, e.modulators = c([{ name: "none", pianoName: "None", maxRawVol: 6, newNoteVol: 6, forSong: !0, convertRealFactor: 0, associatedEffect: 12, promptName: "No Mod Setting", promptDesc: ["No setting has been chosen yet, so this modulator will have no effect. Try choosing a setting with the dropdown, then click this '?' again for more info.", "[$LO - $HI]"] }, { name: "song volume", pianoName: "Volume", maxRawVol: 100, newNoteVol: 100, forSong: !0, convertRealFactor: 0, associatedEffect: 12, promptName: "Song Volume", promptDesc: ["This setting affects the overall volume of the song, just like the main volume slider.", "At $HI, the volume will be unchanged from default, and it will get gradually quieter down to $LO.", "[MULTIPLICATIVE] [$LO - $HI] [%]"] }, { name: "tempo", pianoName: "Tempo", maxRawVol: e.tempoMax - e.tempoMin, newNoteVol: Math.ceil((e.tempoMax - e.tempoMin) / 2), forSong: !0, convertRealFactor: e.tempoMin, associatedEffect: 12, promptName: "Song Tempo", promptDesc: ["This setting controls the speed your song plays at, just like the tempo slider.", "When you first make a note for this setting, it will default to your current tempo. Raising it speeds up the song, up to $HI BPM, and lowering it slows it down, to a minimum of $LO BPM.", "Note that you can make a 'swing' effect by rapidly changing between two tempo values.", "[OVERWRITING] [$LO - $HI] [BPM]"] }, { name: "song reverb", pianoName: "Reverb", maxRawVol: 2 * e.reverbRange, newNoteVol: e.reverbRange, forSong: !0, convertRealFactor: -e.reverbRange, associatedEffect: 12, promptName: "Song Reverb", promptDesc: ["This setting affects the overall reverb of your song. It works by multiplying existing reverb for instruments, so those with no reverb set will be unaffected.", "At $MID, all instruments' reverb will be unchanged from default. This increases up to double the reverb value at $HI, or down to no reverb at $LO.", "[MULTIPLICATIVE] [$LO - $HI]"] }, { name: "next bar", pianoName: "Next Bar", maxRawVol: 1, newNoteVol: 1, forSong: !0, convertRealFactor: 0, associatedEffect: 12, promptName: "Go To Next Bar", promptDesc: ["This setting functions a little different from most. Wherever a note is placed, the song will jump immediately to the next bar when it is encountered.", "This jump happens at the very start of the note, so the length of a next-bar note is irrelevant. Also, the note can be value 0 or 1, but the value is also irrelevant - wherever you place a note, the song will jump.", "You can make mixed-meter songs or intro sections by cutting off unneeded beats with a next-bar modulator.", "[$LO - $HI]"] }, { name: "note volume", pianoName: "Note Vol.", maxRawVol: e.volumeRange, newNoteVol: Math.ceil(e.volumeRange / 2), forSong: !1, convertRealFactor: Math.ceil(-e.volumeRange / 2), associatedEffect: 12, promptName: "Note Volume", promptDesc: ["This setting affects the volume of your instrument as if its note size had been scaled.", "At $MID, an instrument's volume will be unchanged from default. This means you can still use the volume sliders to mix the base volume of instruments. The volume gradually increases up to $HI, or decreases down to mute at $LO.", "This setting was the default for volume modulation in JummBox for a long time. Due to some new effects like distortion and bitcrush, note volume doesn't always allow fine volume control. Also, this modulator affects the value of FM modulator waves instead of just carriers. This can distort the sound which may be useful, but also may be undesirable. In those cases, use the 'mix volume' modulator instead, which will always just scale the volume with no added effects.", "For display purposes, this mod will show up on the instrument volume slider, as long as there is not also an active 'mix volume' modulator anyhow. However, as mentioned, it works more like changing note volume.", "[MULTIPLICATIVE] [$LO - $HI]"] }, { name: "pan", pianoName: "Pan", maxRawVol: e.panMax, newNoteVol: Math.ceil(e.panMax / 2), forSong: !1, convertRealFactor: 0, associatedEffect: 2, promptName: "Instrument Panning", promptDesc: ["This setting controls the panning of your instrument, just like the panning slider.", "At $LO, your instrument will sound like it is coming fully from the left-ear side. At $MID it will be right in the middle, and at $HI, it will sound like it's on the right.", "[OVERWRITING] [$LO - $HI] [L-R]"] }, { name: "reverb", pianoName: "Reverb", maxRawVol: e.reverbRange, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 0, promptName: "Instrument Reverb", promptDesc: ["This setting controls the reverb of your insturment, just like the reverb slider.", "At $LO, your instrument will have no reverb. At $HI, it will be at maximum.", "[OVERWRITING] [$LO - $HI]"] }, { name: "distortion", pianoName: "Distortion", maxRawVol: e.distortionRange - 1, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 3, promptName: "Instrument Distortion", promptDesc: ["This setting controls the amount of distortion for your instrument, just like the distortion slider.", "At $LO, your instrument will have no distortion. At $HI, it will be at maximum.", "[OVERWRITING] [$LO - $HI]"] }, { name: "fm slider 1", pianoName: "FM 1", maxRawVol: 15, newNoteVol: 15, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "FM Slider 1", promptDesc: ["This setting affects the strength of the first FM slider, just like the corresponding slider on your instrument.", "It works in a multiplicative way, so at $HI your slider will sound the same is its default value, and at $LO it will sound like it has been moved all the way to the left.", "For the full range of control with this mod, move your underlying slider all the way to the right.", "[MULTIPLICATIVE] [$LO - $HI] [%]"] }, { name: "fm slider 2", pianoName: "FM 2", maxRawVol: 15, newNoteVol: 15, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "FM Slider 2", promptDesc: ["This setting affects the strength of the second FM slider, just like the corresponding slider on your instrument.", "It works in a multiplicative way, so at $HI your slider will sound the same is its default value, and at $LO it will sound like it has been moved all the way to the left.", "For the full range of control with this mod, move your underlying slider all the way to the right.", "[MULTIPLICATIVE] [$LO - $HI] [%]"] }, { name: "fm slider 3", pianoName: "FM 3", maxRawVol: 15, newNoteVol: 15, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "FM Slider 3", promptDesc: ["This setting affects the strength of the third FM slider, just like the corresponding slider on your instrument.", "It works in a multiplicative way, so at $HI your slider will sound the same is its default value, and at $LO it will sound like it has been moved all the way to the left.", "For the full range of control with this mod, move your underlying slider all the way to the right.", "[MULTIPLICATIVE] [$LO - $HI] [%]"] }, { name: "fm slider 4", pianoName: "FM 4", maxRawVol: 15, newNoteVol: 15, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "FM Slider 4", promptDesc: ["This setting affects the strength of the fourth FM slider, just like the corresponding slider on your instrument.", "It works in a multiplicative way, so at $HI your slider will sound the same is its default value, and at $LO it will sound like it has been moved all the way to the left.", "For the full range of control with this mod, move your underlying slider all the way to the right.", "[MULTIPLICATIVE] [$LO - $HI] [%]"] }, { name: "fm feedback", pianoName: "FM Feedback", maxRawVol: 15, newNoteVol: 15, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "FM Feedback", promptDesc: ["This setting affects the strength of the FM feedback slider, just like the corresponding slider on your instrument.", "It works in a multiplicative way, so at $HI your slider will sound the same is its default value, and at $LO it will sound like it has been moved all the way to the left.", "For the full range of control with this mod, move your underlying slider all the way to the right.", "[MULTIPLICATIVE] [$LO - $HI] [%]"] }, { name: "pulse width", pianoName: "Pulse Width", maxRawVol: e.pulseWidthRange, newNoteVol: e.pulseWidthRange, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "Pulse Width", promptDesc: ["This setting controls the width of this instrument's pulse wave, just like the pulse width slider.", "At $HI, your instrument will sound like a pure square wave (on 50% of the time). It will gradually sound narrower down to $LO, where it will be inaudible (as it is on 0% of the time).", "Changing pulse width randomly between a few values is a common strategy in chiptune music to lend some personality to a lead instrument.", "[OVERWRITING] [$LO - $HI] [%Duty]"] }, { name: "detune", pianoName: "Detune", maxRawVol: e.detuneMax - e.detuneMin, newNoteVol: e.detuneCenter, forSong: !1, convertRealFactor: -e.detuneCenter, associatedEffect: 8, promptName: "Instrument Detune", promptDesc: ["This setting controls the detune for this instrument, just like the detune slider.", "At $MID, your instrument will have no detune applied. Each tick corresponds to one cent, or one-hundredth of a pitch. Thus, each change of 100 ticks corresponds to one half-step of detune, up to two half-steps up at $HI, or two half-steps down at $LO.", "[OVERWRITING] [$LO - $HI] [cents]"] }, { name: "vibrato depth", pianoName: "Vibrato Depth", maxRawVol: 50, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 9, promptName: "Vibrato Depth", promptDesc: ["This setting controls the amount that your pitch moves up and down by during vibrato, just like the vibrato depth slider.", "At $LO, your instrument will have no vibrato depth so its vibrato would be inaudible. This increases up to $HI, where an extreme pitch change will be noticeable.", "[OVERWRITING] [$LO - $HI] [pitch 25]"] }, { name: "song detune", pianoName: "Detune", maxRawVol: e.songDetuneMax - e.songDetuneMin, newNoteVol: Math.ceil((e.songDetuneMax - e.songDetuneMin) / 2), forSong: !0, convertRealFactor: -250, associatedEffect: 12, promptName: "Song Detune", promptDesc: ["This setting controls the overall detune of the entire song. There is no associated slider.", "At $MID, your song will have no extra detune applied and sound unchanged from default. Each tick corresponds to four cents, or four hundredths of a pitch. Thus, each change of 25 ticks corresponds to one half-step of detune, up to 10 half-steps up at $HI, or 10 half-steps down at $LO.", "[MULTIPLICATIVE] [$LO - $HI] [cents x4]"] }, { name: "vibrato speed", pianoName: "Vibrato Speed", maxRawVol: 30, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 9, promptName: "Vibrato Speed", promptDesc: ["This setting controls the speed your instrument will vibrato at, just like the slider.", "A setting of $LO means there will be no oscillation, and vibrato will be disabled. Higher settings will increase the speed, up to a dramatic trill at the max value, $HI.", "[OVERWRITING] [$LO - $HI]"] }, { name: "vibrato delay", pianoName: "Vibrato Delay", maxRawVol: 50, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 9, promptName: "Vibrato Delay", promptDesc: ["This setting controls the amount of time vibrato will be held off for before triggering for every new note, just like the slider.", "A setting of $LO means there will be no delay. A setting of 24 corresponds to one full beat of delay. As a sole exception to this scale, setting delay to $HI will completely disable vibrato (as if it had infinite delay).", "[OVERWRITING] [$LO - $HI] [beats 24]"] }, { name: "arp speed", pianoName: "Arp Speed", maxRawVol: 50, newNoteVol: 10, forSong: !1, convertRealFactor: 0, associatedEffect: 11, promptName: "Arpeggio Speed", promptDesc: ["This setting controls the speed at which your instrument's chords arpeggiate, just like the arpeggio speed slider.", "Each setting corresponds to a different speed, from the slowest to the fastest. The speeds are listed below.", "[0-4]: x0, x1/16, x, x, x,", "[5-9]: x, x, x, x, x,", "[10-14]: x, x0.9, x1, x1.1, x1.2,", "[15-19]: x1.3, x1.4, x1.5, x1.6, x1.7,", "[20-24]: x1.8, x1.9, x2, x2.1, x2.2,", "[25-29]: x2.3, x2.4, x2.5, x2.6, x2.7,", "[30-34]: x2.8, x2.9, x3, x3.1, x3.2,", "[35-39]: x3.3, x3.4, x3.5, x3.6, x3.7,", "[40-44]: x3.8, x3.9, x4, x4.15, x4.3,", "[45-50]: x4.5, x4.8, x5, x5.5, x6, x8", "[OVERWRITING] [$LO - $HI]"] }, { name: "pan delay", pianoName: "Pan Delay", maxRawVol: 20, newNoteVol: 10, forSong: !1, convertRealFactor: 0, associatedEffect: 2, promptName: "Panning Delay", promptDesc: ["This setting controls the delay applied to panning for your instrument, just like the pan delay slider.", "With more delay, the panning effect will generally be more pronounced. $MID is the default value, whereas $LO will remove any delay at all. No delay can be desirable for chiptune songs.", "[OVERWRITING] [$LO - $HI]"] }, { name: "reset arp", pianoName: "Reset Arp", maxRawVol: 1, newNoteVol: 1, forSong: !1, convertRealFactor: 0, associatedEffect: 11, promptName: "Reset Arpeggio", promptDesc: ["This setting functions a little different from most. Wherever a note is placed, the arpeggio of this instrument will reset at the very start of that note. This is most noticeable with lower arpeggio speeds. The lengths and values of notes for this setting don't matter, just the note start times.", "This mod can be used to sync up your apreggios so that they always sound the same, even if you are using an odd-ratio arpeggio speed or modulating arpeggio speed.", "[$LO - $HI]"] }, { name: "eq filter", pianoName: "EQFlt", maxRawVol: 10, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "EQ Filter", promptDesc: ["This setting controls a few separate things for your instrument's EQ filter.", "When the option 'morph' is selected, your modulator values will indicate a sub-filter index of your EQ filter to 'morph' to over time. For example, a change from 0 to 1 means your main filter (default) will morph to sub-filter 1 over the specified duration. You can shape the main filter and sub-filters in the large filter editor ('+' button). If your two filters' number, type, and order of filter dots all match up, the morph will happen smoothly and you'll be able to hear them changing. If they do not match up, the filters will simply jump between each other.", "Note that filters will morph based on endpoints in the pattern editor. So, if you specify a morph from sub-filter 1 to 4 but do not specifically drag in new endpoints for 2 and 3, it will morph directly between 1 and 4 without going through the others.", "If you target Dot X or Dot Y, you can finely tune the coordinates of a single dot for your filter. The number of available dots to choose is dependent on your main filter's dot count.", "[OVERWRITING] [$LO - $HI]"] }, { name: "note filter", pianoName: "N.Flt", maxRawVol: 10, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 5, promptName: "Note Filter", promptDesc: ["This setting controls a few separate things for your instrument's note filter.", "When the option 'morph' is selected, your modulator values will indicate a sub-filter index of your note filter to 'morph' to over time. For example, a change from 0 to 1 means your main filter (default) will morph to sub-filter 1 over the specified duration. You can shape the main filter and sub-filters in the large filter editor ('+' button). If your two filters' number, type, and order of filter dots all match up, the morph will happen smoothly and you'll be able to hear them changing. If they do not match up, the filters will simply jump between each other.", "Note that filters will morph based on endpoints in the pattern editor. So, if you specify a morph from sub-filter 1 to 4 but do not specifically drag in new endpoints for 2 and 3, it will morph directly between 1 and 4 without going through the others.", "If you target Dot X or Dot Y, you can finely tune the coordinates of a single dot for your filter. The number of available dots to choose is dependent on your main filter's dot count.", "[OVERWRITING] [$LO - $HI]"] }, { name: "bit crush", pianoName: "Bitcrush", maxRawVol: e.bitcrusherQuantizationRange - 1, newNoteVol: Math.round(e.bitcrusherQuantizationRange / 2), forSong: !1, convertRealFactor: 0, associatedEffect: 4, promptName: "Instrument Bit Crush", promptDesc: ["This setting controls the bit crush of your instrument, just like the bit crush slider.", "At a value of $LO, no bit crush will be applied. This increases and the bit crush effect gets more noticeable up to the max value, $HI.", "[OVERWRITING] [$LO - $HI]"] }, { name: "freq crush", pianoName: "Freq Crush", maxRawVol: e.bitcrusherFreqRange - 1, newNoteVol: Math.round(e.bitcrusherFreqRange / 2), forSong: !1, convertRealFactor: 0, associatedEffect: 4, promptName: "Instrument Frequency Crush", promptDesc: ["This setting controls the frequency crush of your instrument, just like the freq crush slider.", "At a value of $LO, no frequency crush will be applied. This increases and the frequency crush effect gets more noticeable up to the max value, $HI.", "[OVERWRITING] [$LO - $HI]"] }, { name: "echo", pianoName: "Echo", maxRawVol: e.echoSustainRange - 1, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 6, promptName: "Instrument Echo Sustain", promptDesc: ["This setting controls the echo sustain (echo loudness) of your instrument, just like the echo slider.", "At $LO, your instrument will have no echo sustain and echo will not be audible. Echo sustain increases and the echo effect gets more noticeable up to the max value, $HI.", "[OVERWRITING] [$LO - $HI]"] }, { name: "echo delay", pianoName: "Echo Delay", maxRawVol: e.echoDelayRange, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "Instrument Echo Delay", promptDesc: ["This setting controls the echo delay of your instrument, just like the echo delay slider.", "At $LO, your instrument will have very little echo delay, and this increases up to 2 beats of delay at $HI.", "[OVERWRITING] [$LO - $HI] [~beats 12]"] }, { name: "chorus", pianoName: "Chorus", maxRawVol: e.chorusRange, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 1, promptName: "Instrument Chorus", promptDesc: ["This setting controls the chorus strength of your instrument, just like the chorus slider.", "At $LO, the chorus effect will be disabled. The strength of the chorus effect increases up to the max value, $HI.", "[OVERWRITING] [$LO - $HI]"] }, { name: "eq filt cut", pianoName: "EQFlt Cut", maxRawVol: e.filterSimpleCutRange - 1, newNoteVol: e.filterSimpleCutRange - 1, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "EQ Filter Cutoff Frequency", promptDesc: ["This setting controls the filter cut position of your instrument, just like the filter cut slider.", "This setting is roughly analagous to the horizontal position of a single low-pass dot on the advanced filter editor. At lower values, a wider range of frequencies is cut off.", "[OVERWRITING] [$LO - $HI]"] }, { name: "eq filt peak", pianoName: "EQFlt Peak", maxRawVol: e.filterSimplePeakRange - 1, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "EQ Filter Peak Gain", promptDesc: ["This setting controls the filter peak position of your instrument, just like the filter peak slider.", "This setting is roughly analagous to the vertical position of a single low-pass dot on the advanced filter editor. At lower values, the cutoff frequency will not be emphasized, and at higher values you will hear emphasis on the cutoff frequency.", "[OVERWRITING] [$LO - $HI]"] }, { name: "note filt cut", pianoName: "N.Flt Cut", maxRawVol: e.filterSimpleCutRange - 1, newNoteVol: e.filterSimpleCutRange - 1, forSong: !1, convertRealFactor: 0, associatedEffect: 5, promptName: "Note Filter Cutoff Frequency", promptDesc: ["This setting controls the filter cut position of your instrument, just like the filter cut slider.", "This setting is roughly analagous to the horizontal position of a single low-pass dot on the advanced filter editor. At lower values, a wider range of frequencies is cut off.", "[OVERWRITING] [$LO - $HI]"] }, { name: "note filt peak", pianoName: "N.Flt Peak", maxRawVol: e.filterSimplePeakRange - 1, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 5, promptName: "Note Filter Peak Gain", promptDesc: ["This setting controls the filter peak position of your instrument, just like the filter peak slider.", "This setting is roughly analagous to the vertical position of a single low-pass dot on the advanced filter editor. At lower values, the cutoff frequency will not be emphasized, and at higher values you will hear emphasis on the cutoff frequency.", "[OVERWRITING] [$LO - $HI]"] }, { name: "pitch shift", pianoName: "Pitch Shift", maxRawVol: e.pitchShiftRange - 1, newNoteVol: e.pitchShiftCenter, forSong: !1, convertRealFactor: -e.pitchShiftCenter, associatedEffect: 7, promptName: "Pitch Shift", promptDesc: ["This setting controls the pitch offset of your instrument, just like the pitch shift slider.", "At $MID your instrument will have no pitch shift. This increases as you decrease toward $LO pitches (half-steps) at the low end, or increases towards +$HI pitches at the high end.", "[OVERWRITING] [$LO - $HI] [pitch]"] }, { name: "sustain", pianoName: "Sustain", maxRawVol: e.stringSustainRange - 1, newNoteVol: 0, forSong: !1, convertRealFactor: 0, associatedEffect: 12, promptName: "Picked String Sustain", promptDesc: ["This setting controls the sustain of your picked string instrument, just like the sustain slider.", "At $LO, your instrument will have minimum sustain and sound 'plucky'. This increases to a more held sound as your modulator approaches the maximum, $HI.", "[OVERWRITING] [$LO - $HI]"] }, { name: "mix volume", pianoName: "Mix Vol.", maxRawVol: e.volumeRange, newNoteVol: Math.ceil(e.volumeRange / 2), forSong: !1, convertRealFactor: Math.ceil(-e.volumeRange / 2), associatedEffect: 12, promptName: "Mix Volume", promptDesc: ["This setting affects the volume of your instrument as if its volume slider had been moved.", "At $MID, an instrument's volume will be unchanged from default. This means you can still use the volume sliders to mix the base volume of instruments, since this setting and the default value work multiplicatively. The volume gradually increases up to $HI, or decreases down to mute at $LO.", "Unlike the 'note volume' setting, mix volume is very straightforward and simply affects the resultant instrument volume after all effects are applied.", "[MULTIPLICATIVE] [$LO - $HI]"] }]); const M = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent); function S(t) { return t.toFixed(2).replace(/\.?0*$/, "") } class F { static valueToPreset(t) { const e = t >> 6, i = 63 & t; return F.presetCategories[e].presets[i] } static midiProgramToPresetValue(t) { for (let e = 0; e < F.presetCategories.length; e++) { const i = F.presetCategories[e]; for (let s = 0; s < i.presets.length; s++) { const n = i.presets[s]; if (n.generalMidi && n.midiProgram == t) return (e << 6) + s } } return null } static nameToPresetValue(t) { for (let e = 0; e < F.presetCategories.length; e++) { const i = F.presetCategories[e]; for (let s = 0; s < i.presets.length; s++) { if (i.presets[s].name == t) return (e << 6) + s } } return null } } F.version = "2.5", F.versionDisplayName = "JummBox " + F.version, F.releaseNotesURL = "https://jummbus.bitbucket.io/patch_notes/" + F.version + ".html", F.isOnMac = /^Mac/i.test(navigator.platform) || /Mac OS X/i.test(navigator.userAgent) || /^(iPhone|iPad|iPod)/i.test(navigator.platform) || /(iPhone|iPad|iPod)/i.test(navigator.userAgent), F.ctrlSymbol = F.isOnMac ? "" : "Ctrl+", F.ctrlName = F.isOnMac ? "command" : "control", F.presetCategories = c([{ name: "Custom Instruments", presets: c([{ name: "chip wave", customType: 0 }, { name: "FM (expert)", customType: 1 }, { name: "basic noise", customType: 2 }, { name: "spectrum", customType: 3 }, { name: "drumset", customType: 4 }, { name: "harmonics", customType: 5 }, { name: "pulse width", customType: 6 }, { name: "picked string", customType: 7 }, { name: "custom chip", customType: 8 }]) }, { name: "Retro Presets", presets: c([{ name: "square wave", midiProgram: 80, settings: { type: "chip", eqFilter: [], effects: ["aliasing"], transition: "interrupt", fadeInSeconds: 0, fadeOutTicks: -1, chord: "arpeggio", wave: "square", unison: "none", envelopes: [] } }, { name: "triangle wave", midiProgram: 71, settings: { type: "chip", eqFilter: [], effects: ["aliasing"], transition: "interrupt", fadeInSeconds: 0, fadeOutTicks: -1, chord: "arpeggio", wave: "triangle", unison: "none", envelopes: [] } }, { name: "square lead", midiProgram: 80, generalMidi: !0, settings: { type: "chip", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .3536 }], effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "simultaneous", wave: "square", unison: "hum", envelopes: [] } }, { name: "sawtooth lead 1", midiProgram: 81, generalMidi: !0, settings: { type: "chip", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: .5 }], effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "simultaneous", wave: "sawtooth", unison: "shimmer", envelopes: [] } }, { name: "sawtooth lead 2", midiProgram: 81, settings: { type: "chip", eqFilter: [{ type: "low-pass", cutoffHz: 6727.17, linearGain: 1 }], effects: ["vibrato", "aliasing"], vibrato: "light", transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72, chord: "simultaneous", wave: "sawtooth", unison: "hum", envelopes: [] } }, { name: "chip noise", midiProgram: 116, isNoise: !0, settings: { type: "noise", transition: "hard", effects: ["aliasing"], chord: "arpeggio", filterCutoffHz: 4e3, filterResonance: 0, filterEnvelope: "steady", wave: "retro" } }, { name: "FM twang", midiProgram: 32, settings: { type: "FM", eqFilter: [], effects: [], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "simultaneous", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, operators: [{ frequency: "1", amplitude: 15 }, { frequency: "1", amplitude: 15 }, { frequency: "1", amplitude: 0 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "operatorAmplitude", envelope: "twang 2", index: 1 }] } }, { name: "FM bass", midiProgram: 36, settings: { type: "FM", eqFilter: [], effects: [], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "custom interval", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, operators: [{ frequency: "2", amplitude: 11 }, { frequency: "1", amplitude: 7 }, { frequency: "1", amplitude: 9 }, { frequency: "20", amplitude: 3 }], envelopes: [{ target: "operatorAmplitude", envelope: "twang 2", index: 1 }, { target: "operatorAmplitude", envelope: "twang 3", index: 2 }, { target: "operatorAmplitude", envelope: "twang 2", index: 3 }] } }, { name: "FM flute", midiProgram: 73, settings: { type: "FM", eqFilter: [], effects: [], transition: "normal", fadeInSeconds: .0263, fadeOutTicks: -3, chord: "simultaneous", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, operators: [{ frequency: "1", amplitude: 15 }, { frequency: "1", amplitude: 6 }, { frequency: "1", amplitude: 0 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "operatorAmplitude", envelope: "twang 2", index: 1 }] } }, { name: "FM organ", midiProgram: 16, settings: { type: "FM", eqFilter: [], effects: ["vibrato"], vibrato: "delayed", transition: "normal", fadeInSeconds: .0263, fadeOutTicks: -3, chord: "custom interval", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 0, operators: [{ frequency: "1", amplitude: 14 }, { frequency: "2", amplitude: 14 }, { frequency: "1", amplitude: 11 }, { frequency: "2", amplitude: 11 }], envelopes: [] } }, { name: "NES Pulse", midiProgram: 80, settings: { type: "custom chip", effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "arpeggio", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .5 }], unison: "none", vibrato: "none", envelopes: [], customChipWave: [-24, -24, -24, -24, -23, -23, -23, -23, -22, -22, -22, -22, -21, -21, -21, -21, -20, -20, -20, -20, -19, -19, -19, -19, -18, -18, -18, -18, -17, -17, -17, -17, 24, 24, 24, 24, 23, 23, 23, 23, 22, 22, 22, 22, 21, 21, 21, 21, 20, 20, 20, 20, 19, 19, 19, 19, 18, 18, 18, 18, 17, 17, 17, 17] } }, { name: "Gameboy Pulse", midiProgram: 80, settings: { type: "custom chip", effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "arpeggio", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .5 }], unison: "none", envelopes: [], customChipWave: [-24, -20, -17, -15, -13, -13, -11, -11, -11, -9, -9, -9, -9, -7, -7, -7, -7, -7, -5, -5, -5, -5, -5, -5, -3, -3, -3, -3, -3, -3, -3, -3, 24, 20, 17, 15, 13, 13, 11, 11, 11, 9, 9, 9, 9, 7, 7, 7, 7, 7, 5, 5, 5, 5, 5, 5, 3, 3, 3, 3, 3, 3, 3, 3] } }, { name: "VRC6 Sawtooth", midiProgram: 81, settings: { type: "custom chip", effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "arpeggio", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .5 }], unison: "none", envelopes: [], customChipWave: [-24, -20, -16, -13, -10, -8, -6, -5, -4, -4, 0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 8, 8, 8, 8, 8, 8, 8, 8, 12, 12, 12, 12, 12, 12, 12, 12, 16, 16, 16, 16, 16, 16, 16, 16, 20, 20, 20, 20, 20, 20, 20, 20, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24] } }, { name: "Atari Square", midiProgram: 80, settings: { type: "custom chip", effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "arpeggio", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: .5 }], unison: "none", envelopes: [], customChipWave: [-24, -24, -24, -23, -23, -23, -22, -22, -22, -21, -21, -21, -20, -20, -20, -19, -19, -19, -18, -18, -18, -17, -17, -17, -16, -16, -16, -15, -15, -15, -14, -14, -14, -13, -13, -13, 24, 24, 24, 23, 23, 23, 22, 22, 22, 21, 21, 21, 20, 20, 20, 19, 19, 19, 18, 18, 18, 17, 17, 17, 16, 16, 15, 15] } }, { name: "Atari Bass", midiProgram: 36, settings: { type: "custom chip", effects: ["aliasing"], transition: "interrupt", fadeInSeconds: 0, fadeOutTicks: -3, chord: "arpeggio", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: .5 }], unison: "none", envelopes: [], customChipWave: [-24, -24, -24, -24, -24, -24, -24, -24, -24, 24, 24, 24, 24, 24, 24, -24, -24, -24, 24, 24, 24, -24, -24, -24, 24, 24, 24, -24, -24, -24, 24, 24, -24, -24, -24, -24, -24, -24, -24, -24, -24, 24, 24, 24, 24, 24, 24, -24, -24, 24, 24, 24, 24, 24, -24, -24, -24, -24, 24, 24, -24, -24, 24, 24] } }, { name: "Sunsoft Bass", midiProgram: 36, settings: { type: "custom chip", effects: ["aliasing"], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "arpeggio", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: .5 }], unison: "none", envelopes: [], customChipWave: [24, 24, 15, 15, 9, 9, -4, -4, 0, 0, -13, -13, -19, -19, -24, -24, -24, -24, -10, -10, 0, 0, -7, -7, -7, -7, 0, 0, 6, 6, -4, -4, 3, 3, -4, -4, 3, 3, 3, 3, 9, 9, 15, 15, 15, 15, 6, 6, -4, -4, -4, -4, -4, -4, -4, -4, -4, -4, 3, 3, 12, 12, 24, 24] } }]) }, { name: "Keyboard Presets", presets: c([{ name: "grand piano 1", midiProgram: 0, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "high-pass", cutoffHz: 148.65, linearGain: .7071 }, { type: "peak", cutoffHz: 2e3, linearGain: 2.8284 }], effects: ["note filter", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .125 }], reverb: 67, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", harmonics: [100, 100, 86, 86, 86, 71, 71, 71, 0, 86, 71, 71, 71, 57, 57, 71, 57, 14, 57, 57, 57, 57, 57, 57, 57, 57, 29, 57], unison: "piano", stringSustain: 79, envelopes: [{ target: "noteFilterAllFreqs", envelope: "note size" }] } }, { name: "bright piano", midiProgram: 1, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 1681.79, linearGain: .7071 }, { type: "high-pass", cutoffHz: 148.65, linearGain: .5 }, { type: "peak", cutoffHz: 3363.59, linearGain: 1.4142 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 24, chord: "simultaneous", harmonics: [100, 100, 86, 86, 71, 71, 0, 71, 71, 71, 71, 71, 71, 14, 57, 57, 57, 57, 57, 57, 29, 57, 57, 57, 57, 57, 57, 57], unison: "piano", stringSustain: 86, envelopes: [] } }, { name: "electric grand", midiProgram: 2, generalMidi: !0, settings: { type: "chip", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 2378.41, linearGain: .5 }], transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", wave: "1/8 pulse", unison: "shimmer", envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }] } }, { name: "honky-tonk piano", midiProgram: 3, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 5656.85, linearGain: .3536 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", harmonics: [100, 100, 86, 71, 86, 71, 43, 71, 43, 43, 57, 57, 57, 29, 57, 57, 57, 57, 57, 57, 43, 57, 57, 57, 43, 43, 43, 43], unison: "honky tonk", stringSustain: 71, envelopes: [] } }, { name: "electric piano 1", midiProgram: 4, generalMidi: !0, settings: { type: "harmonics", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 3363.59, linearGain: .5 }], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "simultaneous", harmonics: [86, 100, 100, 71, 71, 57, 57, 43, 43, 43, 29, 29, 29, 14, 14, 14, 0, 0, 0, 0, 0, 57, 0, 0, 0, 0, 0, 0], unison: "none", envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 2" }] } }, { name: "electric piano 2", midiProgram: 5, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 13454.34, linearGain: .25 }], transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 0, operators: [{ frequency: "1", amplitude: 12 }, { frequency: "1", amplitude: 6 }, { frequency: "1", amplitude: 9 }, { frequency: "16", amplitude: 6 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }, { target: "operatorAmplitude", envelope: "twang 3", index: 3 }] } }, { name: "harpsichord", midiProgram: 6, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "high-pass", cutoffHz: 250, linearGain: .3536 }, { type: "peak", cutoffHz: 11313.71, linearGain: 2.8284 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 24, chord: "simultaneous", harmonics: [100, 100, 100, 86, 57, 86, 86, 86, 86, 57, 57, 71, 71, 86, 86, 71, 71, 86, 86, 71, 71, 71, 71, 71, 71, 71, 71, 71], unison: "none", stringSustain: 79, envelopes: [] } }, { name: "clavinet", midiProgram: 7, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 19027.31, linearGain: .3536 }], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "simultaneous", algorithm: "1(234)", feedbackType: "3", feedbackAmplitude: 6, operators: [{ frequency: "3", amplitude: 15 }, { frequency: "~1", amplitude: 6 }, { frequency: "8", amplitude: 4 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 2" }, { target: "feedbackAmplitude", envelope: "twang 2" }] } }, { name: "dulcimer", midiProgram: 15, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .3536 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "strum", harmonics: [100, 100, 100, 86, 100, 86, 57, 100, 100, 86, 100, 86, 100, 86, 100, 71, 57, 71, 71, 100, 86, 71, 86, 86, 100, 86, 86, 86], unison: "piano", stringSustain: 79, envelopes: [] } }, { name: "grand piano 2", midiProgram: 0, generalMidi: !0, settings: { type: "harmonics", eqFilter: [{ type: "high-pass", cutoffHz: 148.65, linearGain: .7071 }, { type: "peak", cutoffHz: 2e3, linearGain: 2.8284 }], effects: ["note filter", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .125 }], reverb: 67, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", harmonics: [100, 86, 86, 86, 86, 71, 71, 57, 0, 57, 29, 43, 57, 57, 57, 43, 43, 0, 29, 43, 43, 43, 43, 43, 43, 29, 0, 29], unison: "piano", stringSustain: 79, envelopes: [{ target: "noteFilterAllFreqs", envelope: "note size" }] } }]) }, { name: "Idiophone Presets", presets: c([{ name: "celesta", midiProgram: 8, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 5657, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "none", algorithm: "(12)(34)", feedbackType: "12", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "~1", amplitude: 11, envelope: "custom" }, { frequency: "8", amplitude: 6, envelope: "custom" }, { frequency: "20", amplitude: 3, envelope: "twang 1" }, { frequency: "3", amplitude: 1, envelope: "twang 2" }] } }, { name: "glockenspiel", midiProgram: 9, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 5657, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "none", algorithm: "(123)4", feedbackType: "123", feedbackAmplitude: 2, feedbackEnvelope: "decay 1", operators: [{ frequency: "1", amplitude: 7, envelope: "custom" }, { frequency: "5", amplitude: 11, envelope: "custom" }, { frequency: "8", amplitude: 7, envelope: "custom" }, { frequency: "20", amplitude: 2, envelope: "twang 1" }] } }, { name: "music box 1", midiProgram: 10, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: .5 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "strum", harmonics: [100, 0, 0, 100, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 0, 0, 0, 0, 0, 86, 0, 0, 0, 0, 0, 0, 71, 0], unison: "none", stringSustain: 64, envelopes: [] } }, { name: "music box 2", midiProgram: 10, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 2828.43, linearGain: .7071 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "strum", harmonics: [100, 57, 57, 0, 0, 0, 0, 0, 0, 57, 0, 0, 0, 0, 0, 0, 0, 0, 0, 43, 0, 0, 0, 0, 0, 0, 0, 0], unison: "none", stringSustain: 29, envelopes: [] } }, { name: "vibraphone", midiProgram: 11, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "none", algorithm: "1234", feedbackType: "1234", feedbackAmplitude: 3, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 9, envelope: "custom" }, { frequency: "~1", amplitude: 9, envelope: "custom" }, { frequency: "9", amplitude: 3, envelope: "custom" }, { frequency: "4", amplitude: 9, envelope: "custom" }] } }, { name: "marimba", midiProgram: 12, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2e3, filterResonance: 29, filterEnvelope: "decay 1", vibrato: "none", algorithm: "12(34)", feedbackType: "1", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 10, envelope: "custom" }, { frequency: "4", amplitude: 6, envelope: "custom" }, { frequency: "13", amplitude: 6, envelope: "twang 1" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "kalimba", midiProgram: 108, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "decay 1", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 11, envelope: "custom" }, { frequency: "5", amplitude: 3, envelope: "twang 2" }, { frequency: "20", amplitude: 3, envelope: "twang 1" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "xylophone", midiProgram: 13, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "twang 1", vibrato: "none", algorithm: "(123)4", feedbackType: "123", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 9, envelope: "custom" }, { frequency: "6", amplitude: 9, envelope: "custom" }, { frequency: "11", amplitude: 9, envelope: "custom" }, { frequency: "20", amplitude: 6, envelope: "twang 1" }] } }, { name: "tubular bell", midiProgram: 14, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: .5 }, { type: "high-pass", cutoffHz: 105.11, linearGain: .3536 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 96, chord: "strum", harmonics: [43, 71, 0, 100, 0, 100, 0, 86, 0, 0, 86, 0, 14, 71, 14, 14, 57, 14, 14, 43, 14, 14, 43, 14, 14, 43, 14, 14], unison: "shimmer", stringSustain: 86, envelopes: [] } }, { name: "bell synth", midiProgram: 14, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2e3, filterResonance: 29, filterEnvelope: "twang 3", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "~2", amplitude: 10, envelope: "custom" }, { frequency: "7", amplitude: 6, envelope: "twang 3" }, { frequency: "20", amplitude: 1, envelope: "twang 1" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "rain drop", midiProgram: 96, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "twang 1", vibrato: "none", algorithm: "(12)(34)", feedbackType: "12", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 12, envelope: "custom" }, { frequency: "6", amplitude: 4, envelope: "custom" }, { frequency: "20", amplitude: 3, envelope: "twang 1" }, { frequency: "1", amplitude: 6, envelope: "tremolo1" }] } }, { name: "crystal", midiProgram: 98, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "delayed", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 4, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 10, envelope: "custom" }, { frequency: "3", amplitude: 7, envelope: "custom" }, { frequency: "6", amplitude: 4, envelope: "custom" }, { frequency: "13", amplitude: 4, envelope: "custom" }] } }, { name: "tinkle bell", midiProgram: 112, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "none", algorithm: "1234", feedbackType: "1234", feedbackAmplitude: 5, feedbackEnvelope: "twang 3", operators: [{ frequency: "~2", amplitude: 7, envelope: "custom" }, { frequency: "5", amplitude: 7, envelope: "custom" }, { frequency: "7", amplitude: 7, envelope: "custom" }, { frequency: "16", amplitude: 7, envelope: "custom" }] } }, { name: "agogo", midiProgram: 113, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "decay 1", vibrato: "none", algorithm: "1234", feedbackType: "14", feedbackAmplitude: 15, feedbackEnvelope: "decay 1", operators: [{ frequency: "2", amplitude: 9, envelope: "custom" }, { frequency: "5", amplitude: 6, envelope: "custom" }, { frequency: "8", amplitude: 9, envelope: "custom" }, { frequency: "13", amplitude: 11, envelope: "custom" }] } }]) }, { name: "Guitar Presets", presets: c([{ name: "nylon guitar", midiProgram: 24, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 5657, filterResonance: 14, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1234", feedbackType: "3", feedbackAmplitude: 6, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 6, envelope: "steady" }, { frequency: "5", amplitude: 2, envelope: "steady" }, { frequency: "7", amplitude: 4, envelope: "steady" }] } }, { name: "steel guitar", midiProgram: 25, generalMidi: !0, settings: { type: "Picked String", eqFilter: [], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "strum", harmonics: [100, 100, 86, 71, 71, 71, 86, 86, 71, 57, 43, 43, 43, 57, 57, 57, 57, 57, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43], unison: "none", stringSustain: 71, envelopes: [] } }, { name: "jazz guitar", midiProgram: 26, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "twang 2", interval: "union", vibrato: "none", harmonics: [100, 100, 86, 71, 57, 71, 71, 43, 57, 71, 57, 43, 29, 29, 29, 29, 29, 29, 29, 29, 14, 14, 14, 14, 14, 14, 14, 0] } }, { name: "clean guitar", midiProgram: 27, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 2", interval: "union", vibrato: "none", harmonics: [86, 100, 100, 100, 86, 57, 86, 100, 100, 100, 71, 57, 43, 71, 86, 71, 57, 57, 71, 71, 71, 71, 57, 57, 57, 57, 57, 43] } }, { name: "muted guitar", midiProgram: 28, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 7, feedbackEnvelope: "twang 2", operators: [{ frequency: "1", amplitude: 13, envelope: "custom" }, { frequency: "1", amplitude: 4, envelope: "twang 3" }, { frequency: "4", amplitude: 4, envelope: "twang 2" }, { frequency: "16", amplitude: 4, envelope: "twang 1" }] } }]) }, { name: "Picked Bass Presets", presets: c([{ name: "acoustic bass", midiProgram: 32, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "twang 1", interval: "union", vibrato: "none", harmonics: [100, 86, 71, 71, 71, 71, 57, 57, 57, 57, 43, 43, 43, 43, 43, 29, 29, 29, 29, 29, 29, 14, 14, 14, 14, 14, 14, 14] } }, { name: "fingered bass", midiProgram: 33, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 1", interval: "union", vibrato: "none", harmonics: [100, 86, 71, 57, 71, 43, 57, 29, 29, 29, 29, 29, 29, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 0] } }, { name: "picked bass", midiProgram: 34, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 0, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1(234)", feedbackType: "3", feedbackAmplitude: 4, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 5, envelope: "steady" }, { frequency: "11", amplitude: 1, envelope: "twang 3" }, { frequency: "1", amplitude: 9, envelope: "steady" }] } }, { name: "fretless bass", midiProgram: 35, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 1e3, filterResonance: 14, filterEnvelope: "flare 2", interval: "union", vibrato: "none", harmonics: [100, 100, 86, 71, 71, 57, 57, 71, 71, 71, 57, 57, 57, 57, 57, 57, 57, 43, 43, 43, 43, 43, 43, 43, 43, 29, 29, 14] } }, { name: "slap bass 1", midiProgram: 36, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 4e3, filterResonance: 0, filterEnvelope: "twang 1", interval: "union", vibrato: "none", harmonics: [100, 100, 100, 100, 86, 71, 57, 29, 29, 43, 43, 57, 71, 57, 29, 29, 43, 57, 57, 57, 43, 43, 43, 57, 71, 71, 71, 71] } }, { name: "slap bass 2", midiProgram: 37, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 5657, filterResonance: 0, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1234", feedbackType: "3", feedbackAmplitude: 4, feedbackEnvelope: "steady", operators: [{ frequency: "3", amplitude: 13, envelope: "custom" }, { frequency: "1", amplitude: 7, envelope: "steady" }, { frequency: "13", amplitude: 3, envelope: "steady" }, { frequency: "1", amplitude: 11, envelope: "steady" }] } }, { name: "bass synth 1", midiProgram: 38, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard", chord: "strum", filterCutoffHz: 4e3, filterResonance: 43, filterEnvelope: "twang 2", vibrato: "none", algorithm: "1324", feedbackType: "34", feedbackAmplitude: 9, feedbackEnvelope: "twang 2", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "custom" }, { frequency: "1", amplitude: 14, envelope: "twang 1" }, { frequency: "~1", amplitude: 13, envelope: "twang 2" }] } }, { name: "bass synth 2", midiProgram: 39, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 1e3, filterResonance: 57, filterEnvelope: "punch", vibrato: "none", algorithm: "1(234)", feedbackType: "12", feedbackAmplitude: 4, feedbackEnvelope: "twang 3", operators: [{ frequency: "1", amplitude: 9, envelope: "custom" }, { frequency: "1", amplitude: 9, envelope: "steady" }, { frequency: "3", amplitude: 0, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "bass & lead", midiProgram: 87, generalMidi: !0, settings: { type: "chip", transition: "hard", effects: "reverb", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 86, filterEnvelope: "twang 2", wave: "sawtooth", interval: "shimmer", vibrato: "none" } }, { name: "dubstep yoi yoi", midiProgram: 87, settings: { type: "chip", eqFilter: [{ type: "low-pass", cutoffHz: 6727.17, linearGain: .7071 }], effects: ["note filter", "bitcrusher"], noteFilter: [{ type: "low-pass", cutoffHz: 594.6, linearGain: 11.3137 }], bitcrusherOctave: 1.5, bitcrusherQuantization: 0, transition: "slide", fadeInSeconds: .0263, fadeOutTicks: -3, chord: "arpeggio", wave: "sawtooth", unison: "none", envelopes: [{ target: "noteFilterFreq", envelope: "flare 2", index: 0 }] } }]) }, { name: "Picked String Presets", presets: c([{ name: "pizzicato strings", midiProgram: 45, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "medium fade", chord: "harmony", filterCutoffHz: 1e3, filterResonance: 14, filterEnvelope: "twang 1", vibrato: "none", algorithm: "(123)4", feedbackType: "1 2 3 4", feedbackAmplitude: 7, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "3", amplitude: 11, envelope: "custom" }, { frequency: "6", amplitude: 9, envelope: "custom" }, { frequency: "~1", amplitude: 10, envelope: "steady" }] } }, { name: "harp", midiProgram: 46, generalMidi: !0, settings: { type: "FM", transition: "hard fade", effects: "reverb", chord: "strum", filterCutoffHz: 2828, filterResonance: 0, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1324", feedbackType: "3", feedbackAmplitude: 6, feedbackEnvelope: "twang 2", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "4", amplitude: 6, envelope: "custom" }, { frequency: "~2", amplitude: 3, envelope: "steady" }, { frequency: "1", amplitude: 6, envelope: "steady" }] } }, { name: "sitar", midiProgram: 104, generalMidi: !0, settings: { type: "FM", transition: "hard fade", effects: "reverb", chord: "strum", filterCutoffHz: 8e3, filterResonance: 57, filterEnvelope: "twang 2", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 14, envelope: "twang 3" }, { frequency: "9", amplitude: 3, envelope: "twang 3" }, { frequency: "16", amplitude: 9, envelope: "swell 3" }] } }, { name: "banjo", midiProgram: 105, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "none", algorithm: "1(234)", feedbackType: "2", feedbackAmplitude: 4, feedbackEnvelope: "steady", operators: [{ frequency: "4", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "steady" }, { frequency: "11", amplitude: 3, envelope: "twang 3" }, { frequency: "1", amplitude: 11, envelope: "steady" }] } }, { name: "ukulele", midiProgram: 105, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2e3, filterResonance: 0, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1(234)", feedbackType: "3", feedbackAmplitude: 5, feedbackEnvelope: "twang 1", operators: [{ frequency: "2", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 6, envelope: "steady" }, { frequency: "9", amplitude: 4, envelope: "twang 2" }, { frequency: "1", amplitude: 11, envelope: "steady" }] } }, { name: "shamisen", midiProgram: 106, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 8e3, filterResonance: 14, filterEnvelope: "twang 1", vibrato: "none", algorithm: "1(234)", feedbackType: "3", feedbackAmplitude: 9, feedbackEnvelope: "twang 3", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 12, envelope: "steady" }, { frequency: "16", amplitude: 4, envelope: "twang 3" }, { frequency: "1", amplitude: 7, envelope: "steady" }] } }, { name: "koto", midiProgram: 107, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "twang 2", vibrato: "none", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 5, feedbackEnvelope: "twang 2", operators: [{ frequency: "~1", amplitude: 12, envelope: "custom" }, { frequency: "6", amplitude: 10, envelope: "custom" }, { frequency: "4", amplitude: 8, envelope: "twang 3" }, { frequency: "~2", amplitude: 8, envelope: "twang 3" }] } }]) }, { name: "Distortion Presets", presets: c([{ name: "overdrive guitar", midiProgram: 29, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: .7071 }, { type: "high-pass", cutoffHz: 210.22, linearGain: 1 }, { type: "low-pass", cutoffHz: 5656.85, linearGain: 1 }, { type: "peak", cutoffHz: 840.9, linearGain: .5 }], effects: ["note filter", "distortion"], noteFilter: [{ type: "high-pass", cutoffHz: 297.3, linearGain: 2 }, { type: "low-pass", cutoffHz: 2378.41, linearGain: .7071 }], distortion: 71, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 12, chord: "strum", harmonics: [86, 100, 100, 86, 86, 86, 86, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57], unison: "none", stringSustain: 71, envelopes: [{ target: "noteFilterFreq", envelope: "note size", index: 1 }] } }, { name: "distortion guitar", midiProgram: 30, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: .7071 }, { type: "high-pass", cutoffHz: 210.22, linearGain: 1 }, { type: "low-pass", cutoffHz: 5656.85, linearGain: 1 }, { type: "peak", cutoffHz: 594.6, linearGain: .3536 }, { type: "peak", cutoffHz: 1e3, linearGain: .25 }], effects: ["note filter", "distortion", "reverb"], noteFilter: [{ type: "high-pass", cutoffHz: 353.55, linearGain: 2 }, { type: "low-pass", cutoffHz: 2e3, linearGain: 1 }], distortion: 86, reverb: 67, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 12, chord: "strum", harmonics: [86, 100, 100, 86, 86, 86, 86, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57, 57], unison: "none", stringSustain: 71, envelopes: [{ target: "noteFilterFreq", envelope: "note size", index: 1 }] } }, { name: "charango synth", midiProgram: 84, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 11313.71, linearGain: 1 }], effects: [], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "strum", algorithm: "1(234)", feedbackType: "1234", feedbackAmplitude: 8, operators: [{ frequency: "3", amplitude: 13 }, { frequency: "~1", amplitude: 5 }, { frequency: "4", amplitude: 6 }, { frequency: "3", amplitude: 7 }], envelopes: [{ target: "feedbackAmplitude", envelope: "twang 3" }] } }, { name: "guitar harmonics", midiProgram: 31, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: 2 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "strum", algorithm: "1(23)4", feedbackType: "1", feedbackAmplitude: 2, operators: [{ frequency: "4", amplitude: 12 }, { frequency: "16", amplitude: 5 }, { frequency: "1", amplitude: 2 }, { frequency: "~1", amplitude: 12 }], envelopes: [{ target: "operatorAmplitude", envelope: "swell 1", index: 1 }, { target: "operatorAmplitude", envelope: "punch", index: 2 }, { target: "operatorAmplitude", envelope: "twang 1", index: 3 }] } }, { name: "PWM overdrive", midiProgram: 29, settings: { type: "PWM", eqFilter: [{ type: "low-pass", cutoffHz: 5656.85, linearGain: 1.4142 }], effects: [], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "strum", pulseWidth: 17.67767, envelopes: [{ target: "pulseWidth", envelope: "punch" }] } }, { name: "PWM distortion", midiProgram: 30, settings: { type: "PWM", eqFilter: [{ type: "low-pass", cutoffHz: 3363.59, linearGain: 2 }], effects: ["vibrato"], vibrato: "delayed", transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "strum", pulseWidth: 50, envelopes: [{ target: "pulseWidth", envelope: "swell 1" }] } }, { name: "FM overdrive", midiProgram: 29, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: 1 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "strum", algorithm: "1(234)", feedbackType: "12", feedbackAmplitude: 2, operators: [{ frequency: "~1", amplitude: 15 }, { frequency: "1", amplitude: 12 }, { frequency: "~2", amplitude: 6 }, { frequency: "1", amplitude: 12 }], envelopes: [{ target: "operatorAmplitude", envelope: "twang 1", index: 2 }, { target: "operatorAmplitude", envelope: "swell 3", index: 3 }, { target: "feedbackAmplitude", envelope: "punch" }] } }, { name: "FM distortion", midiProgram: 30, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: 2 }], effects: ["reverb"], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "strum", algorithm: "1(234)", feedbackType: "12", feedbackAmplitude: 4, operators: [{ frequency: "~1", amplitude: 15 }, { frequency: "1", amplitude: 11 }, { frequency: "1", amplitude: 9 }, { frequency: "~2", amplitude: 4 }], envelopes: [{ target: "operatorAmplitude", envelope: "swell 1", index: 2 }, { target: "operatorAmplitude", envelope: "swell 3", index: 3 }] } }]) }, { name: "Bellows Presets", presets: c([{ name: "drawbar organ 1", midiProgram: 16, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "harmonics", effects: "reverb", transition: "hard", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "steady", interval: "union", vibrato: "none", harmonics: [86, 86, 0, 86, 0, 0, 0, 86, 0, 0, 0, 0, 0, 0, 0, 86, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] } }, { name: "drawbar organ 2", midiProgram: 16, midiSubharmonicOctaves: 1, settings: { type: "harmonics", effects: "reverb", transition: "hard", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "steady", interval: "union", vibrato: "none", harmonics: [86, 29, 71, 86, 71, 14, 0, 100, 0, 0, 0, 86, 0, 0, 0, 71, 0, 0, 0, 57, 0, 0, 0, 29, 0, 0, 0, 0] } }, { name: "percussive organ", midiProgram: 17, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "FM", transition: "hard", effects: "reverb", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "punch", vibrato: "light", algorithm: "1234", feedbackType: "1324", feedbackAmplitude: 7, feedbackEnvelope: "decay 1", operators: [{ frequency: "1", amplitude: 7, envelope: "custom" }, { frequency: "2", amplitude: 7, envelope: "custom" }, { frequency: "3", amplitude: 8, envelope: "custom" }, { frequency: "4", amplitude: 8, envelope: "custom" }] } }, { name: "rock organ", midiProgram: 18, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "FM", effects: "chorus & reverb", transition: "hard", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "punch", vibrato: "delayed", algorithm: "(123)4", feedbackType: "123", feedbackAmplitude: 2, feedbackEnvelope: "flare 1", operators: [{ frequency: "1", amplitude: 9, envelope: "custom" }, { frequency: "4", amplitude: 9, envelope: "custom" }, { frequency: "6", amplitude: 9, envelope: "custom" }, { frequency: "2", amplitude: 5, envelope: "steady" }] } }, { name: "pipe organ", midiProgram: 19, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "FM", transition: "cross fade", effects: "reverb", chord: "harmony", filterCutoffHz: 5657, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 5, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 8, envelope: "custom" }, { frequency: "2", amplitude: 9, envelope: "custom" }, { frequency: "4", amplitude: 9, envelope: "custom" }, { frequency: "8", amplitude: 8, envelope: "custom" }] } }, { name: "reed organ", midiProgram: 20, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 29, filterEnvelope: "steady", interval: "union", vibrato: "none", harmonics: [71, 86, 100, 86, 71, 100, 57, 71, 71, 71, 43, 43, 43, 71, 43, 71, 57, 57, 57, 57, 57, 57, 57, 29, 43, 29, 29, 14] } }, { name: "accordion", midiProgram: 21, generalMidi: !0, settings: { type: "chip", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 5657, filterResonance: 0, filterEnvelope: "swell 1", wave: "double saw", interval: "honky tonk", vibrato: "none" } }, { name: "bandoneon", midiProgram: 23, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 29, filterEnvelope: "swell 1", interval: "hum", vibrato: "none", harmonics: [86, 86, 86, 57, 71, 86, 57, 71, 71, 71, 57, 43, 57, 43, 71, 43, 71, 57, 57, 43, 43, 43, 57, 43, 43, 29, 29, 29] } }, { name: "bagpipe", midiProgram: 109, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 5657, filterResonance: 43, filterEnvelope: "punch", interval: "hum", vibrato: "none", harmonics: [71, 86, 86, 100, 100, 86, 57, 100, 86, 71, 71, 71, 57, 57, 57, 71, 57, 71, 57, 71, 43, 57, 57, 43, 43, 43, 43, 43] } }]) }, { name: "String Presets", presets: c([{ name: "violin 1", midiProgram: 40, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: 1.4142 }, { type: "high-pass", cutoffHz: 105.11, linearGain: .3536 }], effects: ["vibrato", "reverb"], vibrato: "delayed", reverb: 67, transition: "normal", fadeInSeconds: .0413, fadeOutTicks: 6, chord: "simultaneous", algorithm: "(12)(34)", feedbackType: "12", feedbackAmplitude: 5, operators: [{ frequency: "4", amplitude: 9 }, { frequency: "3", amplitude: 9 }, { frequency: "2", amplitude: 7 }, { frequency: "7", amplitude: 5 }], envelopes: [{ target: "operatorAmplitude", envelope: "swell 1", index: 3 }, { target: "feedbackAmplitude", envelope: "twang 3" }] } }, { name: "viola", midiProgram: 41, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 29, filterEnvelope: "steady", vibrato: "delayed", algorithm: "(123)4", feedbackType: "123", feedbackAmplitude: 8, feedbackEnvelope: "swell 1", operators: [{ frequency: "2", amplitude: 11, envelope: "custom" }, { frequency: "7", amplitude: 7, envelope: "custom" }, { frequency: "13", amplitude: 4, envelope: "custom" }, { frequency: "1", amplitude: 5, envelope: "steady" }] } }, { name: "cello", midiProgram: 42, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: .1768 }, { type: "high-pass", cutoffHz: 297.3, linearGain: .7071 }, { type: "peak", cutoffHz: 4756.83, linearGain: 5.6569 }], effects: ["note filter", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 16e3, linearGain: .0884 }], reverb: 67, transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 12, chord: "simultaneous", algorithm: "(12)34", feedbackType: "12", feedbackAmplitude: 3, operators: [{ frequency: "16", amplitude: 5 }, { frequency: "~1", amplitude: 10 }, { frequency: "1", amplitude: 9 }, { frequency: "6", amplitude: 3 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "swell 1" }, { target: "operatorAmplitude", envelope: "swell 1", index: 3 }] } }, { name: "contrabass", midiProgram: 43, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 29, filterEnvelope: "steady", vibrato: "delayed", algorithm: "(12)34", feedbackType: "12", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "16", amplitude: 5, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "steady" }, { frequency: "6", amplitude: 3, envelope: "swell 1" }] } }, { name: "fiddle", midiProgram: 110, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2828, filterResonance: 29, filterEnvelope: "steady", vibrato: "delayed", algorithm: "(12)(34)", feedbackType: "34", feedbackAmplitude: 5, feedbackEnvelope: "twang 1", operators: [{ frequency: "2", amplitude: 10, envelope: "custom" }, { frequency: "8", amplitude: 8, envelope: "custom" }, { frequency: "1", amplitude: 8, envelope: "steady" }, { frequency: "16", amplitude: 3, envelope: "steady" }] } }, { name: "tremolo strings", midiProgram: 44, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "medium fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 0, filterEnvelope: "tremolo4", vibrato: "none", algorithm: "1234", feedbackType: "1234", feedbackAmplitude: 12, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 8, envelope: "custom" }, { frequency: "~2", amplitude: 8, envelope: "custom" }, { frequency: "4", amplitude: 8, envelope: "custom" }, { frequency: "7", amplitude: 8, envelope: "custom" }] } }, { name: "strings", midiProgram: 48, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 2828, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "(12)(34)", feedbackType: "4", feedbackAmplitude: 5, feedbackEnvelope: "twang 3", operators: [{ frequency: "4", amplitude: 9, envelope: "custom" }, { frequency: "3", amplitude: 9, envelope: "custom" }, { frequency: "2", amplitude: 7, envelope: "steady" }, { frequency: "7", amplitude: 3, envelope: "swell 1" }] } }, { name: "slow strings", midiProgram: 49, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "soft fade", chord: "harmony", filterCutoffHz: 1414, filterResonance: 0, filterEnvelope: "swell 2", vibrato: "none", algorithm: "(12)(34)", feedbackType: "4", feedbackAmplitude: 6, feedbackEnvelope: "flare 3", operators: [{ frequency: "4", amplitude: 10, envelope: "custom" }, { frequency: "3", amplitude: 10, envelope: "custom" }, { frequency: "2", amplitude: 7, envelope: "steady" }, { frequency: "7", amplitude: 4, envelope: "swell 1" }] } }, { name: "strings synth 1", midiProgram: 50, generalMidi: !0, settings: { type: "chip", transition: "soft fade", effects: "chorus & reverb", chord: "harmony", filterCutoffHz: 1414, filterResonance: 43, filterEnvelope: "steady", wave: "sawtooth", interval: "hum", vibrato: "delayed" } }, { name: "strings synth 2", midiProgram: 51, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "soft fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 12, feedbackEnvelope: "swell 1", operators: [{ frequency: "3", amplitude: 6, envelope: "custom" }, { frequency: "2", amplitude: 7, envelope: "custom" }, { frequency: "1", amplitude: 8, envelope: "custom" }, { frequency: "1", amplitude: 9, envelope: "custom" }] } }, { name: "orchestra hit 1", midiProgram: 55, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "FM", effects: "chorus & reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 8e3, filterResonance: 14, filterEnvelope: "custom", vibrato: "none", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 14, feedbackEnvelope: "twang 3", operators: [{ frequency: "1", amplitude: 15, envelope: "twang 3" }, { frequency: "2", amplitude: 15, envelope: "flare 3" }, { frequency: "4", amplitude: 15, envelope: "flare 2" }, { frequency: "8", amplitude: 15, envelope: "flare 1" }] } }, { name: "violin 2", midiProgram: 40, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 2828, linearGain: 1.4142 }, { type: "high-pass", cutoffHz: 105.11, linearGain: .3536 }], effects: ["vibrato", "reverb"], vibrato: "light", reverb: 67, transition: "normal", fadeInSeconds: .0413, fadeOutTicks: 6, chord: "simultaneous", algorithm: "(12)(34)", feedbackType: "4", feedbackAmplitude: 5, feedbackEnvelope: "twang 3", operators: [{ frequency: "4", amplitude: 15, envelope: "custom" }, { frequency: "3", amplitude: 13, envelope: "custom" }, { frequency: "2", amplitude: 7, envelope: "steady" }, { frequency: "7", amplitude: 8, envelope: "swell 1" }] } }, { name: "orchestra hit 2", midiProgram: 55, midiSubharmonicOctaves: 1, settings: { type: "FM", effects: "chorus & reverb", transition: "medium fade", chord: "harmony", filterCutoffHz: 8e3, filterResonance: 0, filterEnvelope: "decay 1", vibrato: "delayed", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 14, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 12, envelope: "custom" }, { frequency: "2", amplitude: 14, envelope: "custom" }, { frequency: "3", amplitude: 12, envelope: "custom" }, { frequency: "4", amplitude: 14, envelope: "custom" }] } }]) }, { name: "Vocal Presets", presets: c([{ name: "choir soprano", midiProgram: 94, generalMidi: !0, settings: { type: "harmonics", eqFilter: [{ type: "low-pass", cutoffHz: 2828.43, linearGain: 2 }, { type: "peak", cutoffHz: 1189.21, linearGain: 5.6569 }, { type: "high-pass", cutoffHz: 707.11, linearGain: 2.8284 }, { type: "peak", cutoffHz: 2e3, linearGain: .0884 }, { type: "peak", cutoffHz: 840.9, linearGain: .25 }, { type: "low-pass", cutoffHz: 6727.17, linearGain: 11.3137 }], effects: ["vibrato", "chorus", "reverb"], vibrato: "shaky", chorus: 100, reverb: 33, fadeInSeconds: .0413, fadeOutTicks: 24, harmonics: [100, 100, 86, 57, 29, 29, 57, 71, 57, 29, 14, 14, 14, 29, 43, 57, 43, 29, 14, 14, 14, 14, 14, 14, 0, 0, 0, 0], unison: "none", envelopes: [] } }, { name: "choir tenor", midiProgram: 52, generalMidi: !0, settings: { type: "harmonics", eqFilter: [{ type: "peak", cutoffHz: 1e3, linearGain: 11.3137 }, { type: "peak", cutoffHz: 707.11, linearGain: 5.6569 }, { type: "peak", cutoffHz: 840.9, linearGain: .0884 }, { type: "peak", cutoffHz: 1681.79, linearGain: .0884 }, { type: "high-pass", cutoffHz: 297.3, linearGain: .7071 }, { type: "low-pass", cutoffHz: 2828.43, linearGain: 11.3137 }], effects: ["vibrato", "chorus", "reverb"], vibrato: "shaky", chorus: 100, reverb: 67, transition: "normal", fadeInSeconds: .0413, fadeOutTicks: 48, chord: "simultaneous", harmonics: [86, 100, 100, 86, 71, 57, 43, 29, 29, 29, 29, 43, 43, 43, 29, 29, 29, 29, 29, 29, 29, 29, 29, 14, 14, 14, 14, 14], unison: "none", envelopes: [] } }, { name: "choir bass", midiProgram: 52, settings: { type: "harmonics", eqFilter: [{ type: "low-pass", cutoffHz: 2378.41, linearGain: 11.3137 }, { type: "peak", cutoffHz: 594.6, linearGain: 5.6569 }, { type: "peak", cutoffHz: 1681.79, linearGain: .0884 }, { type: "peak", cutoffHz: 707.11, linearGain: .0884 }, { type: "peak", cutoffHz: 840.9, linearGain: 11.3137 }], effects: ["vibrato", "chorus", "reverb"], vibrato: "shaky", chorus: 100, reverb: 67, transition: "normal", fadeInSeconds: .0413, fadeOutTicks: 48, chord: "simultaneous", harmonics: [71, 86, 100, 100, 86, 86, 57, 43, 29, 29, 29, 29, 29, 29, 43, 43, 43, 43, 43, 29, 29, 29, 29, 14, 14, 14, 14, 14], unison: "none", envelopes: [] } }, { name: "solo soprano", midiProgram: 85, settings: { type: "harmonics", eqFilter: [{ type: "low-pass", cutoffHz: 2828.43, linearGain: 2 }, { type: "peak", cutoffHz: 1189.21, linearGain: 5.6569 }, { type: "high-pass", cutoffHz: 707.11, linearGain: 2.8284 }, { type: "peak", cutoffHz: 2e3, linearGain: .0884 }, { type: "peak", cutoffHz: 840.9, linearGain: .25 }], effects: ["vibrato", "reverb"], vibrato: "shaky", reverb: 33, fadeInSeconds: .0413, fadeOutTicks: 12, harmonics: [86, 100, 86, 43, 14, 14, 57, 71, 57, 14, 14, 14, 14, 14, 43, 57, 43, 14, 14, 14, 14, 14, 14, 14, 0, 0, 0, 0], unison: "none", envelopes: [] } }, { name: "solo tenor", midiProgram: 85, settings: { type: "harmonics", eqFilter: [{ type: "peak", cutoffHz: 1e3, linearGain: 11.3137 }, { type: "peak", cutoffHz: 707.11, linearGain: 5.6569 }, { type: "peak", cutoffHz: 840.9, linearGain: .0884 }, { type: "peak", cutoffHz: 1681.79, linearGain: .0884 }, { type: "high-pass", cutoffHz: 297.3, linearGain: .7071 }, { type: "low-pass", cutoffHz: 2828.43, linearGain: 11.3137 }], effects: ["vibrato", "reverb"], vibrato: "shaky", reverb: 33, fadeInSeconds: .0413, fadeOutTicks: 12, harmonics: [86, 100, 100, 86, 71, 57, 43, 29, 29, 29, 29, 43, 43, 43, 29, 29, 29, 29, 29, 29, 29, 29, 29, 14, 14, 14, 14, 14], unison: "none", envelopes: [] } }, { name: "solo bass", midiProgram: 85, settings: { type: "harmonics", eqFilter: [{ type: "low-pass", cutoffHz: 2378.41, linearGain: 5.6569 }, { type: "peak", cutoffHz: 594.6, linearGain: 8 }, { type: "peak", cutoffHz: 1681.79, linearGain: .0884 }, { type: "peak", cutoffHz: 707.11, linearGain: .0884 }, { type: "peak", cutoffHz: 840.9, linearGain: 8 }, { type: "high-pass", cutoffHz: 210.22, linearGain: 1.4142 }], effects: ["vibrato", "reverb"], vibrato: "shaky", reverb: 33, transition: "normal", fadeInSeconds: .0263, fadeOutTicks: 12, chord: "simultaneous", harmonics: [71, 86, 100, 100, 86, 86, 57, 43, 29, 29, 29, 29, 29, 29, 43, 43, 43, 43, 43, 29, 29, 29, 29, 14, 14, 14, 14, 14], unison: "none", envelopes: [] } }, { name: "voice ooh", midiProgram: 53, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 1414, filterResonance: 57, filterEnvelope: "steady", interval: "union", vibrato: "shaky", harmonics: [100, 57, 43, 43, 14, 14, 0, 0, 0, 14, 29, 29, 14, 0, 14, 29, 29, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] } }, { name: "voice synth", midiProgram: 54, generalMidi: !0, settings: { type: "chip", transition: "medium fade", effects: "chorus & reverb", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 57, filterEnvelope: "steady", wave: "rounded", interval: "union", vibrato: "light" } }, { name: "vox synth lead", midiProgram: 85, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "steady", vibrato: "light", algorithm: "(123)4", feedbackType: "1234", feedbackAmplitude: 2, feedbackEnvelope: "punch", operators: [{ frequency: "2", amplitude: 10, envelope: "custom" }, { frequency: "9", amplitude: 5, envelope: "custom" }, { frequency: "20", amplitude: 1, envelope: "custom" }, { frequency: "~1", amplitude: 4, envelope: "steady" }] } }, { name: "tiny robot", midiProgram: 85, settings: { type: "FM", eqFilter: [], effects: ["vibrato", "reverb"], vibrato: "delayed", reverb: 33, transition: "slide", fadeInSeconds: .0263, fadeOutTicks: -3, chord: "simultaneous", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 2, operators: [{ frequency: "2", amplitude: 15 }, { frequency: "1", amplitude: 7 }, { frequency: "~1", amplitude: 7 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "operatorAmplitude", envelope: "punch", index: 1 }, { target: "feedbackAmplitude", envelope: "twang 3" }] } }, { name: "yowie", midiProgram: 85, settings: { type: "FM", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 86, filterEnvelope: "tremolo5", vibrato: "none", algorithm: "12(34)", feedbackType: "1", feedbackAmplitude: 12, feedbackEnvelope: "tremolo3", operators: [{ frequency: "2", amplitude: 12, envelope: "custom" }, { frequency: "16", amplitude: 5, envelope: "steady" }, { frequency: "1", amplitude: 5, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "mouse", midiProgram: 85, settings: { type: "FM", eqFilter: [], effects: ["vibrato", "reverb"], vibrato: "light", reverb: 33, transition: "slide in pattern", fadeInSeconds: .0263, fadeOutTicks: -3, chord: "simultaneous", algorithm: "1234", feedbackType: "12", feedbackAmplitude: 5, operators: [{ frequency: "2", amplitude: 13 }, { frequency: "5", amplitude: 12 }, { frequency: "1", amplitude: 0 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "noteVolume", envelope: "note size" }, { target: "feedbackAmplitude", envelope: "flare 2" }] } }, { name: "gumdrop", midiProgram: 85, settings: { type: "FM", effects: "reverb", transition: "hard", chord: "harmony", filterCutoffHz: 8e3, filterResonance: 0, filterEnvelope: "steady", vibrato: "none", algorithm: "(123)4", feedbackType: "123", feedbackAmplitude: 0, feedbackEnvelope: "steady", operators: [{ frequency: "2", amplitude: 15, envelope: "punch" }, { frequency: "4", amplitude: 15, envelope: "punch" }, { frequency: "7", amplitude: 15, envelope: "punch" }, { frequency: "1", amplitude: 10, envelope: "twang 1" }] } }, { name: "echo drop", midiProgram: 102, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "hard", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "punch", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 2, feedbackEnvelope: "steady", operators: [{ frequency: "~2", amplitude: 11, envelope: "custom" }, { frequency: "~1", amplitude: 5, envelope: "steady" }, { frequency: "11", amplitude: 2, envelope: "steady" }, { frequency: "16", amplitude: 5, envelope: "swell 3" }] } }, { name: "dark choir", midiProgram: 85, settings: { type: "spectrum", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 29, filterEnvelope: "swell 1", spectrum: [43, 14, 14, 14, 14, 14, 14, 100, 14, 14, 14, 57, 14, 14, 100, 14, 43, 14, 43, 14, 14, 43, 14, 29, 14, 29, 14, 14, 29, 0] } }]) }, { name: "Brass Presets", presets: c([{ name: "trumpet", midiProgram: 56, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2828, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 9, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 8, envelope: "steady" }, { frequency: "1", amplitude: 5, envelope: "flare 2" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "trombone", midiProgram: 57, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "2", feedbackAmplitude: 7, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 8, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "tuba", midiProgram: 58, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "2", feedbackAmplitude: 8, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 6, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "muted trumpet", midiProgram: 59, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: 2.8284 }, { type: "peak", cutoffHz: 4e3, linearGain: 2.8284 }], effects: ["note filter", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 3363.59, linearGain: 1 }], reverb: 33, fadeInSeconds: .0263, fadeOutTicks: -3, algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 5, operators: [{ frequency: "1", amplitude: 13 }, { frequency: "1", amplitude: 5 }, { frequency: "9", amplitude: 5 }, { frequency: "13", amplitude: 7 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "swell 1" }, { target: "operatorAmplitude", envelope: "swell 1", index: 3 }, { target: "feedbackAmplitude", envelope: "flare 2" }] } }, { name: "french horn", midiProgram: 60, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: 1 }, { type: "peak", cutoffHz: 2378.41, linearGain: 2.8284 }], effects: ["reverb"], reverb: 33, fadeInSeconds: .0263, fadeOutTicks: -3, algorithm: "1324", feedbackType: "12", feedbackAmplitude: 3, operators: [{ frequency: "1", amplitude: 15 }, { frequency: "1", amplitude: 12 }, { frequency: "1", amplitude: 10 }, { frequency: "~1", amplitude: 8 }], envelopes: [{ target: "operatorAmplitude", envelope: "swell 1", index: 2 }, { target: "operatorAmplitude", envelope: "flare 2", index: 3 }, { target: "feedbackAmplitude", envelope: "swell 1" }] } }, { name: "brass section", midiProgram: 61, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "punch", vibrato: "none", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 6, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 12, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "swell 1" }, { frequency: "~1", amplitude: 10, envelope: "swell 1" }] } }, { name: "brass synth 1", midiProgram: 62, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 29, filterEnvelope: "steady", vibrato: "none", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 11, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 12, envelope: "flare 1" }, { frequency: "~1", amplitude: 8, envelope: "flare 2" }] } }, { name: "brass synth 2", midiProgram: 63, generalMidi: !0, settings: { type: "FM", transition: "soft", effects: "reverb", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 43, filterEnvelope: "twang 3", vibrato: "none", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 9, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "flare 1" }, { frequency: "~1", amplitude: 7, envelope: "flare 1" }] } }, { name: "pulse brass", midiProgram: 62, settings: { type: "PWM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 29, filterEnvelope: "swell 1", pulseWidth: 50, pulseEnvelope: "flare 3", vibrato: "none" } }]) }, { name: "Reed Presets", presets: c([{ name: "soprano sax", midiProgram: 64, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 29, filterEnvelope: "steady", vibrato: "none", algorithm: "1234", feedbackType: "4", feedbackAmplitude: 5, feedbackEnvelope: "swell 1", operators: [{ frequency: "1", amplitude: 13, envelope: "custom" }, { frequency: "4", amplitude: 4, envelope: "swell 1" }, { frequency: "1", amplitude: 7, envelope: "steady" }, { frequency: "5", amplitude: 4, envelope: "punch" }] } }, { name: "alto sax", midiProgram: 65, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 4, feedbackEnvelope: "punch", operators: [{ frequency: "1", amplitude: 13, envelope: "custom" }, { frequency: "1", amplitude: 6, envelope: "steady" }, { frequency: "4", amplitude: 6, envelope: "swell 1" }, { frequency: "1", amplitude: 12, envelope: "steady" }] } }, { name: "tenor sax", midiProgram: 66, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2828, filterResonance: 29, filterEnvelope: "steady", vibrato: "none", algorithm: "1234", feedbackType: "1", feedbackAmplitude: 6, feedbackEnvelope: "swell 1", operators: [{ frequency: "2", amplitude: 12, envelope: "custom" }, { frequency: "3", amplitude: 7, envelope: "steady" }, { frequency: "1", amplitude: 3, envelope: "steady" }, { frequency: "8", amplitude: 3, envelope: "steady" }] } }, { name: "baritone sax", midiProgram: 67, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2828, filterResonance: 0, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 2, feedbackEnvelope: "swell 2", operators: [{ frequency: "1", amplitude: 12, envelope: "custom" }, { frequency: "8", amplitude: 4, envelope: "steady" }, { frequency: "4", amplitude: 5, envelope: "steady" }, { frequency: "1", amplitude: 4, envelope: "punch" }] } }, { name: "sax synth", midiProgram: 64, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 8e3, filterResonance: 0, filterEnvelope: "steady", vibrato: "light", algorithm: "1(234)", feedbackType: "12", feedbackAmplitude: 4, feedbackEnvelope: "steady", operators: [{ frequency: "4", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 15, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "shehnai", midiProgram: 111, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 8e3, filterResonance: 0, filterEnvelope: "steady", vibrato: "light", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 3, feedbackEnvelope: "steady", operators: [{ frequency: "4", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 8, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "oboe", midiProgram: 68, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "swell 1", vibrato: "none", algorithm: "12(34)", feedbackType: "2", feedbackAmplitude: 2, feedbackEnvelope: "tremolo5", operators: [{ frequency: "1", amplitude: 7, envelope: "custom" }, { frequency: "4", amplitude: 12, envelope: "custom" }, { frequency: "1", amplitude: 6, envelope: "steady" }, { frequency: "6", amplitude: 2, envelope: "steady" }] } }, { name: "english horn", midiProgram: 69, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "steady", vibrato: "none", algorithm: "12(34)", feedbackType: "2", feedbackAmplitude: 2, feedbackEnvelope: "steady", operators: [{ frequency: "4", amplitude: 12, envelope: "custom" }, { frequency: "2", amplitude: 10, envelope: "custom" }, { frequency: "1", amplitude: 8, envelope: "punch" }, { frequency: "8", amplitude: 4, envelope: "steady" }] } }, { name: "bassoon", midiProgram: 70, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 707, filterResonance: 57, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 2, feedbackEnvelope: "steady", operators: [{ frequency: "2", amplitude: 11, envelope: "custom" }, { frequency: "1", amplitude: 6, envelope: "steady" }, { frequency: "6", amplitude: 6, envelope: "swell 1" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }, { name: "clarinet", midiProgram: 71, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 1414, filterResonance: 14, filterEnvelope: "steady", interval: "union", vibrato: "none", harmonics: [100, 43, 86, 57, 86, 71, 86, 71, 71, 71, 71, 71, 71, 43, 71, 71, 57, 57, 57, 57, 57, 57, 43, 43, 43, 29, 14, 0] } }, { name: "harmonica", midiProgram: 22, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 5657, filterResonance: 29, filterEnvelope: "swell 1", vibrato: "none", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 9, feedbackEnvelope: "tremolo5", operators: [{ frequency: "2", amplitude: 14, envelope: "custom" }, { frequency: "1", amplitude: 15, envelope: "steady" }, { frequency: "~2", amplitude: 2, envelope: "twang 3" }, { frequency: "1", amplitude: 0, envelope: "steady" }] } }]) }, { name: "Flute Presets", presets: c([{ name: "flute 1", midiProgram: 73, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 5657, filterResonance: 14, filterEnvelope: "steady", vibrato: "none", algorithm: "1(234)", feedbackType: "4", feedbackAmplitude: 7, feedbackEnvelope: "decay 2", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "2", amplitude: 4, envelope: "steady" }, { frequency: "1", amplitude: 3, envelope: "steady" }, { frequency: "~1", amplitude: 1, envelope: "punch" }] } }, { name: "recorder", midiProgram: 74, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 29, filterEnvelope: "swell 2", interval: "union", vibrato: "none", harmonics: [100, 43, 57, 43, 57, 43, 43, 43, 43, 43, 43, 43, 43, 29, 29, 29, 29, 29, 29, 29, 14, 14, 14, 14, 14, 14, 14, 0] } }, { name: "whistle", midiProgram: 78, generalMidi: !0, settings: { type: "harmonics", effects: "chorus & reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 43, filterEnvelope: "steady", interval: "union", vibrato: "delayed", harmonics: [100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] } }, { name: "ocarina", midiProgram: 79, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 2828, filterResonance: 43, filterEnvelope: "steady", interval: "union", vibrato: "none", harmonics: [100, 14, 57, 14, 29, 14, 14, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] } }, { name: "piccolo", midiProgram: 72, generalMidi: !0, settings: { type: "FM", effects: "reverb", transition: "soft", chord: "harmony", filterCutoffHz: 5657, filterResonance: 43, filterEnvelope: "steady", vibrato: "none", algorithm: "1324", feedbackType: "4", feedbackAmplitude: 15, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "1", amplitude: 10, envelope: "custom" }, { frequency: "~2", amplitude: 3, envelope: "punch" }, { frequency: "~1", amplitude: 5, envelope: "punch" }] } }, { name: "shakuhachi", midiProgram: 77, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "steady", vibrato: "delayed", algorithm: "1(234)", feedbackType: "34", feedbackAmplitude: 15, feedbackEnvelope: "steady", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "2", amplitude: 3, envelope: "punch" }, { frequency: "~1", amplitude: 4, envelope: "twang 1" }, { frequency: "20", amplitude: 15, envelope: "steady" }] } }, { name: "pan flute", midiProgram: 75, generalMidi: !0, settings: { type: "spectrum", eqFilter: [{ type: "low-pass", cutoffHz: 9513.66, linearGain: 5.6569 }], effects: ["note filter", "reverb"], noteFilter: [{ type: "high-pass", cutoffHz: 4756.83, linearGain: .7071 }], reverb: 33, fadeInSeconds: .0125, fadeOutTicks: -3, spectrum: [100, 0, 0, 0, 0, 0, 0, 14, 0, 0, 0, 71, 0, 0, 14, 0, 57, 0, 29, 14, 29, 14, 14, 29, 14, 29, 14, 14, 29, 14], envelopes: [{ target: "noteFilterFreq", envelope: "twang 1", index: 0 }, { target: "noteVolume", envelope: "punch" }] } }, { name: "blown bottle", midiProgram: 76, generalMidi: !0, settings: { type: "FM", effects: "chorus & reverb", transition: "cross fade", chord: "harmony", filterCutoffHz: 5657, filterResonance: 57, filterEnvelope: "steady", vibrato: "none", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 7, feedbackEnvelope: "twang 1", operators: [{ frequency: "1", amplitude: 15, envelope: "custom" }, { frequency: "3", amplitude: 4, envelope: "custom" }, { frequency: "6", amplitude: 2, envelope: "custom" }, { frequency: "11", amplitude: 2, envelope: "custom" }] } }, { name: "calliope", midiProgram: 82, generalMidi: !0, settings: { type: "spectrum", transition: "cross fade", effects: "reverb", chord: "harmony", filterCutoffHz: 5657, filterResonance: 14, filterEnvelope: "steady", spectrum: [100, 0, 0, 0, 0, 0, 0, 86, 0, 0, 0, 71, 0, 0, 57, 0, 43, 0, 29, 14, 14, 29, 14, 14, 14, 14, 14, 14, 14, 14] } }, { name: "chiffer", midiProgram: 83, generalMidi: !0, settings: { type: "spectrum", effects: "reverb", transition: "hard", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "punch", spectrum: [86, 0, 0, 0, 0, 0, 0, 71, 0, 0, 0, 71, 0, 0, 57, 0, 57, 0, 43, 14, 14, 43, 14, 29, 14, 29, 29, 29, 29, 14] } }, { name: "breath noise", midiProgram: 121, generalMidi: !0, settings: { type: "spectrum", eqFilter: [], effects: ["chord type", "note filter", "reverb"], chord: "strum", noteFilter: [{ type: "high-pass", cutoffHz: 840.9, linearGain: .3536 }, { type: "low-pass", cutoffHz: 16e3, linearGain: .3536 }], reverb: 33, fadeInSeconds: .0413, fadeOutTicks: 12, spectrum: [71, 0, 0, 0, 0, 0, 0, 29, 0, 0, 0, 71, 0, 0, 29, 0, 100, 29, 14, 29, 100, 29, 100, 14, 14, 71, 0, 29, 0, 0], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 1" }] } }, { name: "flute 2", midiProgram: 73, generalMidi: !0, settings: { type: "harmonics", effects: "reverb", transition: "seamless", chord: "harmony", filterCutoffHz: 1414, filterResonance: 14, filterEnvelope: "steady", interval: "union", vibrato: "delayed", harmonics: [100, 43, 86, 57, 86, 71, 86, 71, 71, 71, 71, 71, 71, 43, 71, 71, 57, 57, 57, 57, 57, 57, 43, 43, 43, 29, 14, 0] } }]) }, { name: "Pad Presets", presets: c([{ name: "new age pad", midiProgram: 88, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["chorus"], chorus: 100, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", algorithm: "1(234)", feedbackType: "12", feedbackAmplitude: 3, operators: [{ frequency: "2", amplitude: 14 }, { frequency: "~1", amplitude: 4 }, { frequency: "6", amplitude: 3 }, { frequency: "13", amplitude: 3 }], envelopes: [{ target: "operatorAmplitude", envelope: "swell 2", index: 1 }, { target: "operatorAmplitude", envelope: "twang 3", index: 2 }, { target: "feedbackAmplitude", envelope: "swell 3" }] } }, { name: "warm pad", midiProgram: 89, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 3363.59, linearGain: 1 }], chorus: 100, transition: "normal", fadeInSeconds: .0575, fadeOutTicks: 96, chord: "simultaneous", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 7, operators: [{ frequency: "1", amplitude: 14 }, { frequency: "1", amplitude: 6 }, { frequency: "1", amplitude: 0 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "swell 3" }, { target: "operatorAmplitude", envelope: "swell 1", index: 1 }] } }, { name: "polysynth pad", midiProgram: 90, generalMidi: !0, settings: { type: "chip", eqFilter: [], effects: ["vibrato", "note filter", "chorus"], vibrato: "delayed", noteFilter: [{ type: "low-pass", cutoffHz: 2828.43, linearGain: 1 }], chorus: 100, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", wave: "sawtooth", unison: "honky tonk", envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }] } }, { name: "space voice pad", midiProgram: 91, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 6727.17, linearGain: 5.6569 }, { type: "peak", cutoffHz: 2828.43, linearGain: 5.6569 }, { type: "peak", cutoffHz: 1414.21, linearGain: .1768 }], effects: ["chorus"], chorus: 100, transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72, chord: "simultaneous", algorithm: "(123)4", feedbackType: "1 2 3 4", feedbackAmplitude: 5, operators: [{ frequency: "1", amplitude: 10 }, { frequency: "2", amplitude: 8 }, { frequency: "3", amplitude: 7 }, { frequency: "11", amplitude: 2 }], envelopes: [{ target: "operatorAmplitude", envelope: "punch", index: 3 }, { target: "feedbackAmplitude", envelope: "swell 2" }] } }, { name: "bowed glass pad", midiProgram: 92, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: .5 }], transition: "normal", fadeInSeconds: .0575, fadeOutTicks: 96, chord: "simultaneous", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 0, operators: [{ frequency: "1", amplitude: 10 }, { frequency: "2", amplitude: 12 }, { frequency: "3", amplitude: 7 }, { frequency: "7", amplitude: 4 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }, { target: "operatorAmplitude", envelope: "twang 3", index: 2 }, { target: "operatorAmplitude", envelope: "flare 3", index: 3 }] } }, { name: "metallic pad", midiProgram: 93, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 6727.17, linearGain: .5 }], transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72, chord: "simultaneous", algorithm: "1324", feedbackType: "12", feedbackAmplitude: 13, operators: [{ frequency: "1", amplitude: 15 }, { frequency: "~1", amplitude: 9 }, { frequency: "1", amplitude: 7 }, { frequency: "11", amplitude: 7 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }, { target: "operatorAmplitude", envelope: "swell 2", index: 2 }, { target: "feedbackAmplitude", envelope: "twang 3" }] } }, { name: "sweep pad", midiProgram: 95, generalMidi: !0, settings: { type: "chip", eqFilter: [], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: 4 }], chorus: 100, transition: "normal", fadeInSeconds: .0575, fadeOutTicks: 96, chord: "simultaneous", wave: "sawtooth", unison: "hum", envelopes: [{ target: "noteFilterAllFreqs", envelope: "flare 3" }] } }, { name: "atmosphere", midiProgram: 99, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: 1 }], effects: ["chorus", "reverb"], chorus: 100, reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "strum", algorithm: "1(234)", feedbackType: "34", feedbackAmplitude: 3, operators: [{ frequency: "1", amplitude: 14 }, { frequency: "~1", amplitude: 10 }, { frequency: "3", amplitude: 7 }, { frequency: "1", amplitude: 7 }], envelopes: [{ target: "operatorAmplitude", envelope: "swell 3", index: 1 }, { target: "operatorAmplitude", envelope: "twang 2", index: 2 }, { target: "operatorAmplitude", envelope: "twang 3", index: 3 }] } }, { name: "brightness", midiProgram: 100, generalMidi: !0, settings: { type: "Picked String", eqFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: 2 }], effects: ["chorus"], chorus: 100, transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72, chord: "simultaneous", harmonics: [100, 86, 86, 86, 43, 57, 43, 71, 43, 43, 43, 57, 43, 43, 57, 71, 57, 43, 29, 43, 57, 57, 43, 29, 29, 29, 29, 14], unison: "octave", stringSustain: 86, envelopes: [] } }, { name: "goblins", midiProgram: 101, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "peak", cutoffHz: 2828.43, linearGain: 11.3137 }], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 1681.79, linearGain: .5 }], chorus: 100, transition: "normal", fadeInSeconds: .0575, fadeOutTicks: 96, chord: "simultaneous", algorithm: "1234", feedbackType: "1", feedbackAmplitude: 10, operators: [{ frequency: "1", amplitude: 15 }, { frequency: "4", amplitude: 5 }, { frequency: "1", amplitude: 10 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "swell 2" }, { target: "operatorAmplitude", envelope: "swell 3", index: 1 }, { target: "operatorAmplitude", envelope: "tremolo1", index: 2 }, { target: "feedbackAmplitude", envelope: "flare 3" }] } }, { name: "sci-fi", midiProgram: 103, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "peak", cutoffHz: 9513.66, linearGain: 2.8284 }], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 6727.17, linearGain: .5 }], chorus: 100, transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 48, chord: "simultaneous", algorithm: "(12)34", feedbackType: "1 2 3 4", feedbackAmplitude: 8, operators: [{ frequency: "~1", amplitude: 13 }, { frequency: "2", amplitude: 10 }, { frequency: "5", amplitude: 5 }, { frequency: "11", amplitude: 8 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }, { target: "operatorAmplitude", envelope: "twang 3", index: 2 }, { target: "operatorAmplitude", envelope: "tremolo5", index: 3 }, { target: "feedbackAmplitude", envelope: "twang 3" }] } }, { name: "flutter pad", midiProgram: 90, settings: { type: "FM", eqFilter: [], effects: ["vibrato", "note filter", "chorus"], vibrato: "delayed", noteFilter: [{ type: "low-pass", cutoffHz: 4e3, linearGain: 4 }], chorus: 100, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", algorithm: "(12)(34)", feedbackType: "123", feedbackAmplitude: 9, operators: [{ frequency: "1", amplitude: 13 }, { frequency: "5", amplitude: 7 }, { frequency: "7", amplitude: 5 }, { frequency: "~1", amplitude: 6 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }, { target: "operatorAmplitude", envelope: "tremolo1", index: 2 }, { target: "operatorAmplitude", envelope: "punch", index: 3 }] } }, { name: "feedback pad", midiProgram: 89, settings: { type: "FM", eqFilter: [{ type: "peak", cutoffHz: 2378.41, linearGain: 8 }], effects: [], transition: "normal", fadeInSeconds: .0575, fadeOutTicks: 96, chord: "custom interval", algorithm: "1234", feedbackType: "1 2 3 4", feedbackAmplitude: 8, operators: [{ frequency: "1", amplitude: 15 }, { frequency: "1", amplitude: 15 }, { frequency: "1", amplitude: 15 }, { frequency: "~1", amplitude: 15 }], envelopes: [{ target: "feedbackAmplitude", envelope: "swell 2" }] } }]) }, { name: "Drum Presets", presets: c([{ name: "standard drumset", midiProgram: 116, isNoise: !0, settings: { type: "drumset", effects: "reverb", drums: [{ filterEnvelope: "twang 1", spectrum: [57, 71, 71, 86, 86, 86, 71, 71, 71, 71, 57, 57, 57, 57, 43, 43, 43, 43, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29] }, { filterEnvelope: "twang 1", spectrum: [0, 0, 0, 100, 71, 71, 57, 86, 57, 57, 57, 71, 43, 43, 57, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43, 43] }, { filterEnvelope: "twang 1", spectrum: [0, 0, 0, 0, 100, 57, 43, 43, 29, 57, 43, 29, 71, 43, 43, 43, 43, 57, 43, 43, 43, 43, 43, 43, 43, 43, 29, 43, 43, 43] }, { filterEnvelope: "twang 1", spectrum: [0, 0, 0, 0, 0, 71, 57, 43, 43, 43, 57, 57, 43, 29, 57, 43, 43, 43, 29, 43, 57, 43, 43, 43, 43, 43, 43, 29, 43, 43] }, { filterEnvelope: "decay 2", spectrum: [0, 14, 29, 43, 86, 71, 29, 43, 43, 43, 43, 29, 71, 29, 71, 29, 43, 43, 43, 43, 57, 43, 43, 57, 43, 43, 43, 57, 57, 57] }, { filterEnvelope: "decay 1", spectrum: [0, 0, 14, 14, 14, 14, 29, 29, 29, 43, 43, 43, 57, 57, 57, 71, 71, 71, 71, 71, 71, 71, 71, 57, 57, 57, 57, 43, 43, 43] }, { filterEnvelope: "twang 3", spectrum: [43, 43, 43, 71, 29, 29, 43, 43, 43, 29, 43, 43, 43, 29, 29, 43, 43, 29, 29, 29, 57, 14, 57, 43, 43, 57, 43, 43, 57, 57] }, { filterEnvelope: "decay 3", spectrum: [29, 43, 43, 43, 43, 29, 29, 43, 29, 29, 43, 29, 14, 29, 43, 29, 43, 29, 57, 29, 43, 57, 43, 71, 43, 71, 57, 57, 71, 71] }, { filterEnvelope: "twang 3", spectrum: [43, 29, 29, 43, 29, 29, 29, 57, 29, 29, 29, 57, 43, 43, 29, 29, 57, 43, 43, 43, 71, 43, 43, 71, 57, 71, 71, 71, 71, 71] }, { filterEnvelope: "decay 3", spectrum: [57, 57, 57, 43, 57, 57, 43, 43, 57, 43, 43, 43, 71, 57, 43, 57, 86, 71, 57, 86, 71, 57, 86, 100, 71, 86, 86, 86, 86, 86] }, { filterEnvelope: "flare 1", spectrum: [0, 0, 14, 14, 14, 14, 29, 29, 29, 43, 43, 43, 57, 57, 71, 71, 86, 86, 100, 100, 100, 100, 100, 100, 100, 100, 86, 57, 29, 0] }, { filterEnvelope: "decay 2", spectrum: [14, 14, 14, 14, 29, 14, 14, 29, 14, 43, 14, 43, 57, 86, 57, 57, 100, 57, 43, 43, 57, 100, 57, 43, 29, 14, 0, 0, 0, 0] }] } }, { name: "steel pan", midiProgram: 114, generalMidi: !0, settings: { type: "FM", eqFilter: [{ type: "high-pass", cutoffHz: 62.5, linearGain: .1768 }], effects: ["note filter", "chorus", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 13454.34, linearGain: .25 }], chorus: 67, reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 24, chord: "simultaneous", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, operators: [{ frequency: "~1", amplitude: 14 }, { frequency: "7", amplitude: 3 }, { frequency: "3", amplitude: 5 }, { frequency: "4", amplitude: 4 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "decay 2" }, { target: "operatorAmplitude", envelope: "flare 1", index: 1 }, { target: "operatorAmplitude", envelope: "flare 2", index: 2 }, { target: "operatorAmplitude", envelope: "swell 2", index: 3 }] } }, { name: "steel pan synth", midiProgram: 114, settings: { type: "FM", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 13454.34, linearGain: .25 }], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3, chord: "simultaneous", algorithm: "1234", feedbackType: "1", feedbackAmplitude: 5, operators: [{ frequency: "~1", amplitude: 12 }, { frequency: "2", amplitude: 15 }, { frequency: "4", amplitude: 14 }, { frequency: "~1", amplitude: 3 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 1" }, { target: "operatorAmplitude", envelope: "note size", index: 0 }, { target: "operatorAmplitude", envelope: "note size", index: 1 }, { target: "operatorAmplitude", envelope: "flare 1", index: 2 }, { target: "operatorAmplitude", envelope: "flare 2", index: 3 }, { target: "feedbackAmplitude", envelope: "flare 1" }] } }, { name: "timpani", midiProgram: 47, generalMidi: !0, settings: { type: "spectrum", eqFilter: [{ type: "peak", cutoffHz: 6727.17, linearGain: 5.6569 }], effects: ["pitch shift", "note filter", "reverb"], pitchShiftSemitones: 15, noteFilter: [{ type: "low-pass", cutoffHz: 19027.31, linearGain: .5 }], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", spectrum: [100, 0, 0, 0, 86, 0, 0, 71, 0, 14, 43, 14, 43, 43, 0, 29, 43, 29, 29, 29, 43, 29, 43, 29, 43, 43, 43, 43, 43, 43], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 1" }, { target: "pitchShift", envelope: "twang 1" }] } }, { name: "dark strike", midiProgram: 47, settings: { type: "spectrum", eqFilter: [], effects: ["note filter", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 4756.83, linearGain: .7071 }], reverb: 33, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", spectrum: [0, 0, 14, 14, 14, 29, 29, 43, 43, 86, 43, 43, 43, 29, 86, 29, 29, 29, 86, 29, 14, 14, 14, 14, 0, 0, 0, 0, 0, 0], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 2" }] } }, { name: "woodblock", midiProgram: 115, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -2.5, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 14, filterEnvelope: "twang 1", spectrum: [0, 14, 29, 43, 43, 57, 86, 86, 71, 57, 57, 43, 43, 57, 86, 86, 43, 43, 71, 57, 57, 57, 57, 57, 86, 86, 71, 71, 71, 71] } }, { name: "taiko drum", midiProgram: 116, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -.5, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 29, filterEnvelope: "twang 1", spectrum: [71, 100, 100, 43, 43, 71, 71, 43, 43, 43, 43, 43, 43, 57, 29, 57, 43, 57, 43, 43, 57, 43, 43, 43, 43, 43, 43, 43, 43, 43] } }, { name: "melodic drum", midiProgram: 117, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -1.5, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2828, filterResonance: 43, filterEnvelope: "twang 1", spectrum: [100, 71, 71, 57, 57, 43, 43, 71, 43, 43, 43, 57, 43, 43, 57, 43, 43, 43, 43, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29] } }, { name: "drum synth", midiProgram: 118, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -2, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 43, filterEnvelope: "decay 1", spectrum: [100, 86, 71, 57, 43, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29] } }, { name: "tom-tom", midiProgram: 116, isNoise: !0, midiSubharmonicOctaves: -1, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "twang 1", spectrum: [100, 29, 14, 0, 0, 86, 14, 43, 29, 86, 29, 14, 29, 57, 43, 43, 43, 43, 57, 43, 43, 43, 29, 57, 43, 43, 43, 43, 43, 43] } }, { name: "metal pipe", midiProgram: 117, isNoise: !0, midiSubharmonicOctaves: -1.5, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 8e3, filterResonance: 14, filterEnvelope: "twang 2", spectrum: [29, 43, 86, 43, 43, 43, 43, 43, 100, 29, 14, 14, 100, 14, 14, 0, 0, 0, 0, 0, 14, 29, 29, 14, 0, 0, 14, 29, 0, 0] } }, { name: "synth kick", midiProgram: 47, settings: { type: "FM", eqFilter: [], effects: [], transition: "normal", fadeInSeconds: 0, fadeOutTicks: -6, chord: "simultaneous", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, operators: [{ frequency: "8", amplitude: 15 }, { frequency: "1", amplitude: 0 }, { frequency: "1", amplitude: 0 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "operatorFrequency", envelope: "twang 1", index: 0 }, { target: "noteVolume", envelope: "twang 2" }] } }]) }, { name: "Novelty Presets", presets: c([{ name: "guitar fret noise", midiProgram: 120, generalMidi: !0, settings: { type: "spectrum", eqFilter: [{ type: "high-pass", cutoffHz: 1e3, linearGain: .1768 }], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 6727.17, linearGain: 5.6569 }], transition: "normal", fadeInSeconds: .0125, fadeOutTicks: -3, chord: "simultaneous", spectrum: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 0, 0, 0, 29, 14, 0, 0, 43, 0, 43, 0, 71, 43, 0, 57, 0], envelopes: [{ target: "noteFilterAllFreqs", envelope: "flare 1" }, { target: "noteVolume", envelope: "twang 2" }] } }, { name: "fifth saw lead", midiProgram: 86, generalMidi: !0, midiSubharmonicOctaves: 1, settings: { type: "chip", eqFilter: [], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 2828.43, linearGain: 1.4142 }], chorus: 67, transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48, chord: "simultaneous", wave: "sawtooth", unison: "fifth", envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 3" }] } }, { name: "fifth swell", midiProgram: 86, midiSubharmonicOctaves: 1, settings: { type: "chip", eqFilter: [], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 2e3, linearGain: 2 }], chorus: 100, transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72, chord: "simultaneous", wave: "sawtooth", unison: "fifth", envelopes: [{ target: "noteFilterAllFreqs", envelope: "swell 3" }] } }, { name: "soundtrack", midiProgram: 97, generalMidi: !0, settings: { type: "chip", eqFilter: [], effects: ["note filter", "chorus"], noteFilter: [{ type: "low-pass", cutoffHz: 2378.41, linearGain: .5 }], chorus: 67, transition: "normal", fadeInSeconds: .0413, fadeOutTicks: 72, chord: "simultaneous", wave: "sawtooth", unison: "fifth", envelopes: [{ target: "noteFilterAllFreqs", envelope: "flare 3" }] } }, { name: "reverse cymbal", midiProgram: 119, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -3, settings: { type: "spectrum", effects: "none", transition: "soft", chord: "harmony", filterCutoffHz: 4e3, filterResonance: 14, filterEnvelope: "swell 3", spectrum: [29, 57, 57, 29, 57, 57, 29, 29, 43, 29, 29, 43, 29, 29, 57, 57, 14, 57, 14, 57, 71, 71, 57, 86, 57, 100, 86, 86, 86, 86] } }, { name: "seashore", midiProgram: 122, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -3, settings: { type: "spectrum", transition: "soft fade", effects: "reverb", chord: "harmony", filterCutoffHz: 2828, filterResonance: 0, filterEnvelope: "swell 3", spectrum: [14, 14, 29, 29, 43, 43, 43, 57, 57, 57, 57, 57, 57, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 71, 57] } }, { name: "bird tweet", midiProgram: 123, generalMidi: !0, settings: { type: "harmonics", eqFilter: [], effects: ["chord type", "vibrato", "reverb"], chord: "strum", vibrato: "heavy", reverb: 67, fadeInSeconds: .0575, fadeOutTicks: -6, harmonics: [0, 0, 0, 100, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], unison: "hum", envelopes: [{ target: "noteVolume", envelope: "decay 1" }] } }, { name: "telephone ring", midiProgram: 124, generalMidi: !0, settings: { type: "FM", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 5656.85, linearGain: 1 }], transition: "normal", fadeInSeconds: .0125, fadeOutTicks: -3, chord: "arpeggio", algorithm: "1(234)", feedbackType: "1", feedbackAmplitude: 0, operators: [{ frequency: "2", amplitude: 12 }, { frequency: "1", amplitude: 4 }, { frequency: "20", amplitude: 1 }, { frequency: "1", amplitude: 0 }], envelopes: [{ target: "noteFilterAllFreqs", envelope: "tremolo4" }, { target: "operatorAmplitude", envelope: "tremolo1", index: 1 }] } }, { name: "helicopter", midiProgram: 125, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -.5, settings: { type: "spectrum", effects: "reverb", transition: "seamless", chord: "arpeggio", filterCutoffHz: 1414, filterResonance: 14, filterEnvelope: "tremolo4", spectrum: [14, 43, 43, 57, 57, 57, 71, 71, 71, 71, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 71, 71, 71, 71, 71, 71, 71, 57, 57] } }, { name: "applause", midiProgram: 126, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -3, settings: { type: "spectrum", effects: "reverb", transition: "soft fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "swell 3", spectrum: [14, 14, 29, 29, 29, 43, 43, 57, 71, 71, 86, 86, 86, 71, 71, 57, 57, 57, 71, 86, 86, 86, 86, 86, 71, 71, 57, 57, 57, 57] } }, { name: "gunshot", midiProgram: 127, generalMidi: !0, isNoise: !0, midiSubharmonicOctaves: -2, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "strum", filterCutoffHz: 1414, filterResonance: 29, filterEnvelope: "twang 1", spectrum: [14, 29, 43, 43, 57, 57, 57, 71, 71, 71, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 86, 71, 71, 71, 71, 57, 57, 57, 57, 43] } }, { name: "scoot", midiProgram: 92, settings: { type: "chip", eqFilter: [], effects: ["note filter"], noteFilter: [{ type: "low-pass", cutoffHz: 707.11, linearGain: 4 }], transition: "normal", fadeInSeconds: .0125, fadeOutTicks: -3, chord: "simultaneous", wave: "double saw", unison: "shimmer", envelopes: [{ target: "noteFilterAllFreqs", envelope: "flare 1" }] } }, { name: "buzz saw", midiProgram: 30, settings: { type: "FM", eqFilter: [{ type: "low-pass", cutoffHz: 9513.66, linearGain: .5 }], effects: [], transition: "normal", fadeInSeconds: .0263, fadeOutTicks: -3, chord: "custom interval", algorithm: "1234", feedbackType: "1", feedbackAmplitude: 4, operators: [{ frequency: "5", amplitude: 13 }, { frequency: "1", amplitude: 10 }, { frequency: "~1", amplitude: 6 }, { frequency: "11", amplitude: 12 }], envelopes: [] } }, { name: "mosquito", midiProgram: 93, settings: { type: "PWM", eqFilter: [{ type: "low-pass", cutoffHz: 2828.43, linearGain: 2 }], effects: ["vibrato"], vibrato: "shaky", transition: "normal", fadeInSeconds: .0575, fadeOutTicks: -6, chord: "simultaneous", pulseWidth: 4.41942, envelopes: [{ target: "pulseWidth", envelope: "tremolo6" }] } }, { name: "breathing", midiProgram: 126, isNoise: !0, midiSubharmonicOctaves: -1, settings: { type: "spectrum", effects: "reverb", transition: "hard fade", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 14, filterEnvelope: "swell 2", spectrum: [14, 14, 14, 29, 29, 29, 29, 29, 43, 29, 29, 43, 43, 43, 29, 29, 71, 43, 86, 86, 57, 100, 86, 86, 86, 86, 71, 86, 71, 57] } }, { name: "klaxon synth", midiProgram: 125, isNoise: !0, midiSubharmonicOctaves: -1, settings: { type: "noise", effects: "reverb", transition: "slide", chord: "harmony", filterCutoffHz: 2e3, filterResonance: 86, filterEnvelope: "steady", wave: "buzz" } }, { name: "theremin", midiProgram: 40, settings: { type: "harmonics", eqFilter: [{ type: "low-pass", cutoffHz: 8e3, linearGain: .7071 }], effects: ["vibrato", "reverb"], vibrato: "heavy", reverb: 33, transition: "slide in pattern", fadeInSeconds: .0263, fadeOutTicks: -6, chord: "simultaneous", harmonics: [100, 71, 57, 43, 29, 29, 14, 14, 14, 14, 14, 14, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], unison: "none", envelopes: [] } }, { name: "sonar ping", midiProgram: 121, settings: { type: "spectrum", eqFilter: [], effects: ["note filter", "reverb"], noteFilter: [{ type: "low-pass", cutoffHz: 1681.79, linearGain: .5 }], reverb: 33, transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72, chord: "simultaneous", spectrum: [100, 43, 29, 29, 14, 14, 14, 14, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], envelopes: [{ target: "noteFilterAllFreqs", envelope: "twang 2" }] } }]) }]); var C = t && t.t || function (t) { var e = "function" == typeof Symbol && Symbol.iterator, i = e && t[e], s = 0; if (i) return i.call(t); if (t && "number" == typeof t.length) return { next: function () { return t && s >= t.length && (t = void 0), { value: t && t[s++], done: !t } } }; throw new TypeError(e ? "Object is not iterable." : "Symbol.iterator is not defined.") }, E = t && t.i || function (t, e) { var i = "function" == typeof Symbol && t[Symbol.iterator]; if (!i) return t; var s, n, o = i.call(t), h = []; try { for (; (void 0 === e || e-- > 0) && !(s = o.next()).done;)h.push(s.value) } catch (t) { n = { error: t } } finally { try { s && !s.done && (i = o.return) && i.call(o) } finally { if (n) throw n.error } } return h }, T = t && t.o || function () { for (var t = [], e = 0; e < arguments.length; e++)t = t.concat(E(arguments[e])); return t }; function I(t, e) { var i, s, n, o, h, a; try { for (var r = C(e), l = r.next(); !l.done; l = r.next()) { var c = l.value; if (c instanceof Node) t.appendChild(c); else if ("string" == typeof c) t.appendChild(document.createTextNode(c)); else if ("function" == typeof c) I(t, [c()]); else if (Array.isArray(c)) I(t, c); else if (c && "undefined" != typeof Symbol && "function" == typeof c[Symbol.iterator]) I(t, T(c)); else if (c && c.constructor === Object && t instanceof Element) try { for (var d = (n = void 0, C(Object.keys(c))), p = d.next(); !p.done; p = d.next()) { var u = p.value, m = c[u]; if ("class" === u) "string" == typeof m ? t.setAttribute("class", m) : Array.isArray(c) || m && "undefined" != typeof Symbol && "function" == typeof m[Symbol.iterator] ? t.setAttribute("class", T(m).join(" ")) : console.warn("Invalid " + u + ' value "' + m + '" on ' + t.tagName + " element."); else if ("style" === u) if (m && m.constructor === Object) try { for (var f = (h = void 0, C(Object.keys(m))), y = f.next(); !y.done; y = f.next()) { var b = y.value; b in t.style ? t.style[b] = m[b] : t.style.setProperty(b, m[b]) } } catch (t) { h = { error: t } } finally { try { y && !y.done && (a = f.return) && a.call(f) } finally { if (h) throw h.error } } else t.setAttribute(u, m); else "function" == typeof m ? t[u] = m : "boolean" == typeof m ? m ? t.setAttribute(u, "") : t.removeAttribute(u) : t.setAttribute(u, m) } } catch (t) { n = { error: t } } finally { try { p && !p.done && (o = d.return) && o.call(d) } finally { if (n) throw n.error } } else t.appendChild(document.createTextNode(c)) } } catch (t) { i = { error: t } } finally { try { l && !l.done && (s = r.return) && s.call(r) } finally { if (i) throw i.error } } return t } var P = "http://www.w3.org/2000/svg"; var A, L, q, D, N = t && t.t || function (t) { var e = "function" == typeof Symbol && Symbol.iterator, i = e && t[e], s = 0; if (i) return i.call(t); if (t && "number" == typeof t.length) return { next: function () { return t && s >= t.length && (t = void 0), { value: t && t[s++], done: !t } } }; throw new TypeError(e ? "Object is not iterable." : "Symbol.iterator is not defined.") }, z = function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; return document.createRange().createContextualFragment(t.join()) }, B = function () { for (var t = [], e = 0; e < arguments.length; e++)t[e] = arguments[e]; for (var i = document.createDocumentFragment(), s = (new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg">' + t.join() + "</svg>", "image/svg+xml").documentElement; null !== s.firstChild;)document.importNode(s.firstChild, !0), i.appendChild(s.firstChild); return i }, R = function (t) { z[t] = function () { for (var e = [], i = 0; i < arguments.length; i++)e[i] = arguments[i]; return I(document.createElement(t), e) } }; try { for (var O = N("a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr".split(" ")), H = O.next(); !H.done; H = O.next()) { R(H.value) } } catch (t) { A = { error: t } } finally { try { H && !H.done && (L = O.return) && L.call(O) } finally { if (A) throw A.error } } var V = function (t) { if (B[t] = function () { for (var e = [], i = 0; i < arguments.length; i++)e[i] = arguments[i]; return I(document.createElementNS(P, t), e) }, /-/.test(t)) { var e = t.replace(/-/g, "_"); B[e] = function () { for (var e = [], i = 0; i < arguments.length; i++)e[i] = arguments[i]; return I(document.createElementNS(P, t), e) } } }; try { for (var G = N("a altGlyph altGlyphDef altGlyphItem animate animateMotion animateTransform circle clipPath color-profile cursor defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tref tspan use view vkern".split(" ")), _ = G.next(); !_.done; _ = G.next()) { V(_.value) } } catch (t) { q = { error: t } } finally { try { _ && !_.done && (D = G.return) && D.call(G) } finally { if (q) throw q.error } } class j { static resetColors() { this.colorLookup.clear() } static getComputedChannelColor(t, e) { if ("false" == getComputedStyle(this.h).getPropertyValue("--use-color-formula").trim()) { let s = j.getChannelColor(t, e); var i = /\(([^)]+)\)/; return { secondaryChannel: j.getComputed(i.exec(s.secondaryChannel)[1]), primaryChannel: j.getComputed(i.exec(s.primaryChannel)[1]), secondaryNote: j.getComputed(i.exec(s.secondaryNote)[1]), primaryNote: j.getComputed(i.exec(s.primaryNote)[1]) } } return j.getChannelColor(t, e) } static getChannelColor(t, i) { if ("false" == getComputedStyle(this.h).getPropertyValue("--use-color-formula").trim()) return i < t.pitchChannelCount ? j.pitchChannels[i % j.pitchChannels.length] : i < t.pitchChannelCount + t.noiseChannelCount ? j.noiseChannels[(i - t.pitchChannelCount) % j.noiseChannels.length] : j.modChannels[(i - t.pitchChannelCount - t.noiseChannelCount) % j.modChannels.length]; if (j.colorLookup.has(i)) return j.colorLookup.get(i); if (i < t.pitchChannelCount) { const t = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-channel-hue"), s = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-channel-hue-scale"), n = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-channel-sat"), o = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-channel-sat-scale"), h = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-channel-lum"), a = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-channel-lum-scale"), r = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-channel-hue"), l = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-channel-hue-scale"), c = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-channel-sat"), d = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-channel-sat-scale"), p = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-channel-lum"), u = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-channel-lum-scale"), m = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-note-hue"), f = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-note-hue-scale"), y = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-note-sat"), b = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-note-sat-scale"), g = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-note-lum"), w = +getComputedStyle(this.h).getPropertyValue("--pitch-secondary-note-lum-scale"), v = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-note-hue"), k = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-note-hue-scale"), x = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-note-sat"), M = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-note-sat-scale"), S = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-note-lum"), F = +getComputedStyle(this.h).getPropertyValue("--pitch-primary-note-lum-scale"); let C = { secondaryChannel: "hsl(" + (+t + i * +s / e.pitchChannelCountMax * 256) % 256 + "," + +n * (1 - +o * Math.floor(i / 7)) + "%," + +h * (1 - +a * Math.floor(i / 7)) + "%)", primaryChannel: "hsl(" + (+r + i * +l / e.pitchChannelCountMax * 256) % 256 + "," + +c * (1 - +d * Math.floor(i / 7)) + "%," + +p * (1 - +u * Math.floor(i / 7)) + "%)", secondaryNote: "hsl(" + (+m + i * +f / e.pitchChannelCountMax * 256) % 256 + "," + +y * (1 - +b * Math.floor(i / 7)) + "%," + +g * (1 - +w * Math.floor(i / 7)) + "%)", primaryNote: "hsl(" + (+v + i * +k / e.pitchChannelCountMax * 256) % 256 + "," + +x * (1 - +M * Math.floor(i / 7)) + "%," + +S * (1 - +F * Math.floor(i / 7)) + "%)" }; return j.colorLookup.set(i, C), C } if (i < t.pitchChannelCount + t.noiseChannelCount) { const s = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-channel-hue"), n = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-channel-hue-scale"), o = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-channel-sat"), h = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-channel-sat-scale"), a = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-channel-lum"), r = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-channel-lum-scale"), l = +getComputedStyle(this.h).getPropertyValue("--noise-primary-channel-hue"), c = +getComputedStyle(this.h).getPropertyValue("--noise-primary-channel-hue-scale"), d = +getComputedStyle(this.h).getPropertyValue("--noise-primary-channel-sat"), p = +getComputedStyle(this.h).getPropertyValue("--noise-primary-channel-sat-scale"), u = +getComputedStyle(this.h).getPropertyValue("--noise-primary-channel-lum"), m = +getComputedStyle(this.h).getPropertyValue("--noise-primary-channel-lum-scale"), f = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-note-hue"), y = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-note-hue-scale"), b = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-note-sat"), g = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-note-sat-scale"), w = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-note-lum"), v = +getComputedStyle(this.h).getPropertyValue("--noise-secondary-note-lum-scale"), k = +getComputedStyle(this.h).getPropertyValue("--noise-primary-note-hue"), x = +getComputedStyle(this.h).getPropertyValue("--noise-primary-note-hue-scale"), M = +getComputedStyle(this.h).getPropertyValue("--noise-primary-note-sat"), S = +getComputedStyle(this.h).getPropertyValue("--noise-primary-note-sat-scale"), F = +getComputedStyle(this.h).getPropertyValue("--noise-primary-note-lum"), C = +getComputedStyle(this.h).getPropertyValue("--noise-primary-note-lum-scale"); let E = { secondaryChannel: "hsl(" + (+s + (i - t.pitchChannelCount) * +n / e.noiseChannelCountMax * 256) % 256 + "," + (+o + i * +h) + "%," + (+a + i * +r) + "%)", primaryChannel: "hsl(" + (+l + (i - t.pitchChannelCount) * +c / e.noiseChannelCountMax * 256) % 256 + "," + (+d + i * +p) + "%," + (+u + i * +m) + "%)", secondaryNote: "hsl(" + (+f + (i - t.pitchChannelCount) * +y / e.noiseChannelCountMax * 256) % 256 + "," + (+b + i * +g) + "%," + (+w + i * +v) + "%)", primaryNote: "hsl(" + (+k + (i - t.pitchChannelCount) * +x / e.noiseChannelCountMax * 256) % 256 + "," + (+M + i * +S) + "%," + (+F + i * +C) + "%)" }; return j.colorLookup.set(i, E), E } { const s = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-channel-hue"), n = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-channel-hue-scale"), o = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-channel-sat"), h = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-channel-sat-scale"), a = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-channel-lum"), r = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-channel-lum-scale"), l = +getComputedStyle(this.h).getPropertyValue("--mod-primary-channel-hue"), c = +getComputedStyle(this.h).getPropertyValue("--mod-primary-channel-hue-scale"), d = +getComputedStyle(this.h).getPropertyValue("--mod-primary-channel-sat"), p = +getComputedStyle(this.h).getPropertyValue("--mod-primary-channel-sat-scale"), u = +getComputedStyle(this.h).getPropertyValue("--mod-primary-channel-lum"), m = +getComputedStyle(this.h).getPropertyValue("--mod-primary-channel-lum-scale"), f = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-note-hue"), y = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-note-hue-scale"), b = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-note-sat"), g = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-note-sat-scale"), w = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-note-lum"), v = +getComputedStyle(this.h).getPropertyValue("--mod-secondary-note-lum-scale"), k = +getComputedStyle(this.h).getPropertyValue("--mod-primary-note-hue"), x = +getComputedStyle(this.h).getPropertyValue("--mod-primary-note-hue-scale"), M = +getComputedStyle(this.h).getPropertyValue("--mod-primary-note-sat"), S = +getComputedStyle(this.h).getPropertyValue("--mod-primary-note-sat-scale"), F = +getComputedStyle(this.h).getPropertyValue("--mod-primary-note-lum"), C = +getComputedStyle(this.h).getPropertyValue("--mod-primary-note-lum-scale"); let E = { secondaryChannel: "hsl(" + (+s + (i - t.pitchChannelCount - t.noiseChannelCount) * +n / e.modChannelCountMax * 256) % 256 + "," + (+o + i * +h) + "%," + (+a + i * +r) + "%)", primaryChannel: "hsl(" + (+l + (i - t.pitchChannelCount - t.noiseChannelCount) * +c / e.modChannelCountMax * 256) % 256 + "," + (+d + i * +p) + "%," + (+u + i * +m) + "%)", secondaryNote: "hsl(" + (+f + (i - t.pitchChannelCount - t.noiseChannelCount) * +y / e.modChannelCountMax * 256) % 256 + "," + (+b + i * +g) + "%," + (+w + i * +v) + "%)", primaryNote: "hsl(" + (+k + (i - t.pitchChannelCount - t.noiseChannelCount) * +x / e.modChannelCountMax * 256) % 256 + "," + (+M + i * +S) + "%," + (+F + i * +C) + "%)" }; return j.colorLookup.set(i, E), E } } static setTheme(t) { let e = this.themes[t]; null == e && (e = this.themes["dark classic"]), this.h.textContent = e; const i = document.querySelector("meta[name='theme-color']"); null != i && i.setAttribute("content", getComputedStyle(document.documentElement).getPropertyValue("--ui-widget-background")), this.resetColors() } static getComputed(t) { return getComputedStyle(this.h).getPropertyValue(t) } } j.colorLookup = new Map, j.themes = { "dark classic": "\n\t\t\t:root {\n\t\t\t\t--page-margin: black;\n\t\t\t\t--editor-background: black;\n\t\t\t\t--hover-preview: white;\n\t\t\t\t--playhead: white;\n\t\t\t\t--primary-text: white;\n\t\t\t\t--secondary-text: #999;\n\t\t\t\t--inverted-text: black;\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\n\t\t\t\t--loop-accent: #74f;\n\t\t\t\t--link-accent: #98f;\n\t\t\t\t--ui-widget-background: #444;\n\t\t\t\t--ui-widget-focus: #777;\n\t\t\t\t--pitch-background: #444;\n\t\t\t\t--tonic: #864;\n\t\t\t\t--fifth-note: #468;\n\t\t\t\t--white-piano-key: #bbb;\n\t\t\t\t--black-piano-key: #444;\n\t\t\t\t\t--use-color-formula: false;\n\t\t\t\t\t--track-editor-bg-pitch: #444;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #333;\n\t\t\t\t\t--track-editor-bg-noise: #444;\n\t\t\t\t\t--track-editor-bg-noise-dim: #333;\n\t\t\t\t\t--track-editor-bg-mod: #234;\n\t\t\t\t\t--track-editor-bg-mod-dim: #123;\n\t\t\t\t\t--multiplicative-mod-slider: #456;\n\t\t\t\t\t--overwriting-mod-slider: #654;\n\t\t\t\t\t--indicator-primary: #74f;\n\t\t\t\t\t--indicator-secondary: #444;\n\t\t\t\t\t--select2-opt-group: #585858;\n\t\t\t\t\t--input-box-outline: #333;\n\t\t\t\t\t--mute-button-normal: #ffa033;\n\t\t\t\t\t--mute-button-mod: #9a6bff;\n\t\t\t\t--pitch1-secondary-channel: #0099A1;\n\t\t\t\t--pitch1-primary-channel:   #25F3FF;\n\t\t\t\t--pitch1-secondary-note:    #00BDC7;\n\t\t\t\t--pitch1-primary-note:      #92F9FF;\n\t\t\t\t--pitch2-secondary-channel: #A1A100;\n\t\t\t\t--pitch2-primary-channel:   #FFFF25;\n\t\t\t\t--pitch2-secondary-note:    #C7C700;\n\t\t\t\t--pitch2-primary-note:      #FFFF92;\n\t\t\t\t--pitch3-secondary-channel: #C75000;\n\t\t\t\t--pitch3-primary-channel:   #FF9752;\n\t\t\t\t--pitch3-secondary-note:    #FF771C;\n\t\t\t\t--pitch3-primary-note:      #FFCDAB;\n\t\t\t\t--pitch4-secondary-channel: #00A100;\n\t\t\t\t--pitch4-primary-channel:   #50FF50;\n\t\t\t\t--pitch4-secondary-note:    #00C700;\n\t\t\t\t--pitch4-primary-note:      #A0FFA0;\n\t\t\t\t--pitch5-secondary-channel: #D020D0;\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\n\t\t\t\t--pitch5-secondary-note:    #E040E0;\n\t\t\t\t--pitch5-primary-note:      #FFC0FF;\n\t\t\t\t--pitch6-secondary-channel: #7777B0;\n\t\t\t\t--pitch6-primary-channel:   #A0A0FF;\n\t\t\t\t--pitch6-secondary-note:    #8888D0;\n\t\t\t\t--pitch6-primary-note:      #D0D0FF;\n\t\t\t\t--pitch7-secondary-channel: #8AA100;\n\t\t\t\t--pitch7-primary-channel:   #DEFF25;\n\t\t\t\t--pitch7-secondary-note:    #AAC700;\n\t\t\t\t--pitch7-primary-note:      #E6FF92;\n\t\t\t\t--pitch8-secondary-channel: #DF0019;\n\t\t\t\t--pitch8-primary-channel:   #FF98A4;\n\t\t\t\t--pitch8-secondary-note:    #FF4E63;\n\t\t\t\t--pitch8-primary-note:      #FFB2BB;\n\t\t\t\t--pitch9-secondary-channel: #00A170;\n\t\t\t\t--pitch9-primary-channel:   #50FFC9;\n\t\t\t\t--pitch9-secondary-note:    #00C78A;\n\t\t\t\t--pitch9-primary-note:      #83FFD9;\n\t\t\t\t--pitch10-secondary-channel:#A11FFF;\n\t\t\t\t--pitch10-primary-channel:  #CE8BFF;\n\t\t\t\t--pitch10-secondary-note:   #B757FF;\n\t\t\t\t--pitch10-primary-note:     #DFACFF;\n\t\t\t\t--noise1-secondary-channel: #6F6F6F;\n\t\t\t\t--noise1-primary-channel:   #AAAAAA;\n\t\t\t\t--noise1-secondary-note:    #A7A7A7;\n\t\t\t\t--noise1-primary-note:      #E0E0E0;\n\t\t\t\t--noise2-secondary-channel: #996633;\n\t\t\t\t--noise2-primary-channel:   #DDAA77;\n\t\t\t\t--noise2-secondary-note:    #CC9966;\n\t\t\t\t--noise2-primary-note:      #F0D0BB;\n\t\t\t\t--noise3-secondary-channel: #4A6D8F;\n\t\t\t\t--noise3-primary-channel:   #77AADD;\n\t\t\t\t--noise3-secondary-note:    #6F9FCF;\n\t\t\t\t--noise3-primary-note:      #BBD7FF;\n\t\t\t\t--noise4-secondary-channel: #7A4F9A;\n\t\t\t\t--noise4-primary-channel:   #AF82D2;\n\t\t\t\t--noise4-secondary-note:    #9E71C1;\n\t\t\t\t--noise4-primary-note:      #D4C1EA;\n\t\t\t\t--noise5-secondary-channel: #607837;\n\t\t\t\t--noise5-primary-channel:   #A2BB77;\n\t\t\t\t--noise5-secondary-note:    #91AA66;\n\t\t\t\t--noise5-primary-note:      #C5E2B2;\n          --mod1-secondary-channel:   #339955;\n\t\t\t\t\t--mod1-primary-channel:     #77fc55;\n\t\t\t\t\t--mod1-secondary-note:      #77ff8a;\n\t\t\t\t\t--mod1-primary-note:        #cdffee;\n\t\t\t\t\t--mod2-secondary-channel:   #993355;\n\t\t\t\t\t--mod2-primary-channel:     #f04960;\n\t\t\t\t\t--mod2-secondary-note:      #f057a0;\n\t\t\t\t\t--mod2-primary-note:        #ffb8de;\n\t\t\t\t\t--mod3-secondary-channel:   #553399;\n\t\t\t\t\t--mod3-primary-channel:     #8855fc;\n\t\t\t\t\t--mod3-secondary-note:      #aa64ff;\n\t\t\t\t\t--mod3-primary-note:\t    #f8ddff;\n\t\t\t\t\t--mod4-secondary-channel:   #a86436;\n\t\t\t\t\t--mod4-primary-channel:     #c8a825;\n\t\t\t\t\t--mod4-secondary-note:      #e8ba46;\n\t\t\t\t\t--mod4-primary-note:        #fff6d3;\n\t\t\t\t\t--mod-label-primary:        #999;\n\t\t\t\t\t--mod-label-secondary-text: #333;\n\t\t\t\t\t--mod-label-primary-text:   black;\n\t\t\t\t\t--disabled-note-primary:    #999;\n\t\t\t\t\t--disabled-note-secondary:  #666;\n\t\t\t\t}\n\t\t\t", "dark competition": "\n\t\t\t\t:root {\n\t\t\t\t\t--page-margin: black;\n\t\t\t\t\t--editor-background: black;\n\t\t\t\t\t--hover-preview: #ddd;\n\t\t\t\t\t--playhead: #ddd;\n\t\t\t\t\t--primary-text: #ddd;\n\t\t\t\t\t--secondary-text: #8e695b;\n\t\t\t\t\t--inverted-text: black;\n\t\t\t\t\t--text-selection: rgba(169,0,255,0.99);\n\t\t\t\t\t--box-selection-fill: rgba(221,221,221,0.2);\n\t\t\t\t\t--loop-accent: #bf15ba;\n\t\t\t\t\t--link-accent: #f888ff;\n\t\t\t\t\t--ui-widget-background: #443a3a;\n\t\t\t\t\t--ui-widget-focus: #777;\n\t\t\t\t\t--pitch-background: #353333;\n\t\t\t\t\t--tonic: #884a44;\n\t\t\t\t\t--fifth-note: #415498;\n\t\t\t\t\t--white-piano-key: #bbb;\n\t\t\t\t\t--black-piano-key: #444;\n\t\t\t\t\t--use-color-formula: false;\n\t\t\t\t\t--track-editor-bg-pitch: #444;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #333;\n\t\t\t\t\t--track-editor-bg-noise: #444;\n\t\t\t\t\t--track-editor-bg-noise-dim: #333;\n\t\t\t\t\t--track-editor-bg-mod: #234;\n\t\t\t\t\t--track-editor-bg-mod-dim: #123;\n\t\t\t\t\t--multiplicative-mod-slider: #456;\n\t\t\t\t\t--overwriting-mod-slider: #654;\n\t\t\t\t\t--indicator-primary: #74f;\n\t\t\t\t\t--indicator-secondary: #444;\n\t\t\t\t\t--select2-opt-group: #585858;\n\t\t\t\t\t--input-box-outline: #333;\n\t\t\t\t\t--mute-button-normal: #ffa033;\n\t\t\t\t\t--mute-button-mod: #9a6bff;\n\t\t\t\t\t--pitch1-secondary-channel: #0099a1;\n\t\t\t\t\t--pitch1-primary-channel:   #25f3ff;\n\t\t\t\t\t--pitch1-secondary-note:    #00bdc7;\n\t\t\t\t\t--pitch1-primary-note:      #92f9ff;\n\t\t\t\t\t--pitch2-secondary-channel: #a1a100;\n\t\t\t\t\t--pitch2-primary-channel:   #ffff25;\n\t\t\t\t\t--pitch2-secondary-note:    #c7c700;\n\t\t\t\t\t--pitch2-primary-note:      #ffff92;\n\t\t\t\t\t--pitch3-secondary-channel: #c75000;\n\t\t\t\t\t--pitch3-primary-channel:   #ff9752;\n\t\t\t\t\t--pitch3-secondary-note:    #ff771c;\n\t\t\t\t\t--pitch3-primary-note:      #ffcdab;\n\t\t\t\t\t--pitch4-secondary-channel: #00a100;\n\t\t\t\t\t--pitch4-primary-channel:   #50ff50;\n\t\t\t\t\t--pitch4-secondary-note:    #00c700;\n\t\t\t\t\t--pitch4-primary-note:      #a0ffa0;\n\t\t\t\t\t--pitch5-secondary-channel: #d020d0;\n\t\t\t\t\t--pitch5-primary-channel:   #ff90ff;\n\t\t\t\t\t--pitch5-secondary-note:    #e040e0;\n\t\t\t\t\t--pitch5-primary-note:      #ffc0ff;\n\t\t\t\t\t--pitch6-secondary-channel: #7777b0;\n\t\t\t\t\t--pitch6-primary-channel:   #a0a0ff;\n\t\t\t\t\t--pitch6-secondary-note:    #8888d0;\n\t\t\t\t\t--pitch6-primary-note:      #d0d0ff;\n\t\t\t\t\t--pitch7-secondary-channel: #8AA100;\n\t\t\t\t\t--pitch7-primary-channel:   #DEFF25;\n\t\t\t\t\t--pitch7-secondary-note:\t  #AAC700;\n\t\t\t\t\t--pitch7-primary-note:\t\t\t#E6FF92;\n\t\t\t\t\t--pitch8-secondary-channel: #DF0019;\n\t\t\t\t\t--pitch8-primary-channel:   #FF98A4;\n\t\t\t\t\t--pitch8-secondary-note:    #FF4E63;\n\t\t\t\t\t--pitch8-primary-note:      #FFB2BB;\n\t\t\t\t\t--pitch9-secondary-channel: #00A170;\n\t\t\t\t\t--pitch9-primary-channel:   #50FFC9;\n\t\t\t\t\t--pitch9-secondary-note:    #00C78A;\n\t\t\t\t\t--pitch9-primary-note:\t\t\t#83FFD9;\n\t\t\t\t\t--pitch10-secondary-channel:#A11FFF;\n\t\t\t\t\t--pitch10-primary-channel:  #CE8BFF;\n\t\t\t\t\t--pitch10-secondary-note:   #B757FF;\n\t\t\t\t\t--pitch10-primary-note:     #DFACFF;\n\t\t\t\t\t--noise1-secondary-channel: #6f6f6f;\n\t\t\t\t\t--noise1-primary-channel:   #aaaaaa;\n\t\t\t\t\t--noise1-secondary-note:    #a7a7a7;\n\t\t\t\t\t--noise1-primary-note:      #e0e0e0;\n\t\t\t\t\t--noise2-secondary-channel: #996633;\n\t\t\t\t\t--noise2-primary-channel:   #ddaa77;\n\t\t\t\t\t--noise2-secondary-note:    #cc9966;\n\t\t\t\t\t--noise2-primary-note:      #f0d0bb;\n\t\t\t\t\t--noise3-secondary-channel: #4a6d8f;\n\t\t\t\t\t--noise3-primary-channel:   #77aadd;\n\t\t\t\t\t--noise3-secondary-note:    #6f9fcf;\n\t\t\t\t\t--noise3-primary-note:      #bbd7ff;\n\t\t\t\t\t--noise4-secondary-channel: #6B3E8E;\n\t\t\t\t\t--noise4-primary-channel:   #AF82D2;\n\t\t\t\t\t--noise4-secondary-note:    #9E71C1;\n\t\t\t\t\t--noise5-secondary-channel: #607837;\n\t\t\t\t\t--noise5-primary-channel:   #A2BB77;\n\t\t\t\t\t--noise5-secondary-note:    #91AA66;\n\t\t\t\t\t--noise5-primary-note:      #C5E2B2;\n\t\t\t\t\t--mod1-secondary-channel:   #339955;\n\t\t\t\t\t--mod1-primary-channel:     #77fc55;\n\t\t\t\t\t--mod1-secondary-note:      #77ff8a;\n\t\t\t\t\t--mod1-primary-note:        #cdffee;\n\t\t\t\t\t--mod2-secondary-channel:   #993355;\n\t\t\t\t\t--mod2-primary-channel:     #f04960;\n\t\t\t\t\t--mod2-secondary-note:      #f057a0;\n\t\t\t\t\t--mod2-primary-note:        #ffb8de;\n\t\t\t\t\t--mod3-secondary-channel:   #553399;\n\t\t\t\t\t--mod3-primary-channel:     #8855fc;\n\t\t\t\t\t--mod3-secondary-note:      #aa64ff;\n\t\t\t\t\t--mod3-primary-note:\t\t\t  #f8ddff;\n\t\t\t\t\t--mod4-secondary-channel:   #a86436;\n\t\t\t\t\t--mod4-primary-channel:     #c8a825;\n\t\t\t\t\t--mod4-secondary-note:      #e8ba46;\n\t\t\t\t\t--mod4-primary-note:        #fff6d3;\n\t\t\t\t\t--mod-label-primary:        #999;\n\t\t\t\t\t--mod-label-secondary-text: #333;\n\t\t\t\t\t--mod-label-primary-text:   black;\n\t\t\t\t\t--disabled-note-primary:    #999;\n\t\t\t\t\t--disabled-note-secondary:  #666;\n\n\t\t\t}\n\t\t", "light classic": "\n\t\t\t:root {\n\t\t\t\t-webkit-text-stroke-width: 0.5px;\n\t\t\t\t--page-margin: #685d88;\n\t\t\t\t--editor-background: white;\n\t\t\t\t--hover-preview: black;\n\t\t\t\t--playhead: rgba(0,0,0,0.5);\n\t\t\t\t--primary-text: black;\n\t\t\t\t--secondary-text: #777;\n\t\t\t\t--inverted-text: white;\n\t\t\t\t--text-selection: rgba(200,170,255,0.99);\n\t\t\t\t--box-selection-fill: rgba(0,0,0,0.1);\n\t\t\t\t--loop-accent: #98f;\n\t\t\t\t--link-accent: #74f;\n\t\t\t\t--ui-widget-background: #ececec;\n\t\t\t\t--ui-widget-focus: #eee;\n\t\t\t\t--pitch-background: #ececec;\n\t\t\t\t--tonic: #f0d6b6;\n\t\t\t\t--fifth-note: #bbddf0;\n\t\t\t\t--white-piano-key: #eee;\n\t\t\t\t--black-piano-key: #666;\n\t\t\t\t\t--use-color-formula: false;\n\t\t\t\t\t--track-editor-bg-pitch: #ececec;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #fdfdfd;\n\t\t\t\t\t--track-editor-bg-noise: #ececec;\n\t\t\t\t\t--track-editor-bg-noise-dim: #fdfdfd;\n\t\t\t\t\t--track-editor-bg-mod: #dbecfd;\n\t\t\t\t\t--track-editor-bg-mod-dim: #ecfdff;\n\t\t\t\t\t--multiplicative-mod-slider: #789;\n\t\t\t\t\t--overwriting-mod-slider: #987;\n\t\t\t\t\t--indicator-primary: #98f;\n\t\t\t\t\t--indicator-secondary: #cde;\n\t\t\t\t\t--select2-opt-group: #cecece;\n\t\t\t\t\t--input-box-outline: #ddd;\n\t\t\t\t\t--mute-button-normal: #c0b47f;\n\t\t\t\t\t--mute-button-mod: #bd7fc0;\n\t\t\t\t--pitch1-secondary-channel: #6CD9ED;\n\t\t\t\t--pitch1-primary-channel:   #00A0BD;\n\t\t\t\t--pitch1-secondary-note:    #34C2DC;\n\t\t\t\t--pitch1-primary-note:      #00758A;\n\t\t\t\t--pitch2-secondary-channel: #E3C941;\n\t\t\t\t--pitch2-primary-channel:   #B49700;\n\t\t\t\t--pitch2-secondary-note:    #D1B628;\n\t\t\t\t--pitch2-primary-note:      #836E00;\n\t\t\t\t--pitch3-secondary-channel: #FF9D61;\n\t\t\t\t--pitch3-primary-channel:   #E14E00;\n\t\t\t\t--pitch3-secondary-note:    #F67D3C;\n\t\t\t\t--pitch3-primary-note:      #B64000;\n\t\t\t\t--pitch4-secondary-channel: #4BE24B;\n\t\t\t\t--pitch4-primary-channel:   #00A800;\n\t\t\t\t--pitch4-secondary-note:    #2DC82D;\n\t\t\t\t--pitch4-primary-note:      #008000;\n\t\t\t\t--pitch5-secondary-channel: #FF90FF;\n\t\t\t\t--pitch5-primary-channel:   #E12EDF;\n\t\t\t\t--pitch5-secondary-note:    #EC6EEC;\n\t\t\t\t--pitch5-primary-note:      #A600A5;\n\t\t\t\t--pitch6-secondary-channel: #B5B5FE;\n\t\t\t\t--pitch6-primary-channel:   #6969FD;\n\t\t\t\t--pitch6-secondary-note:    #9393FE;\n\t\t\t\t--pitch6-primary-note:      #4A4AD7;\n\t\t\t\t--pitch7-secondary-channel: #C2D848;\n\t\t\t\t--pitch7-primary-channel:   #8EA800;\n\t\t\t\t--pitch7-secondary-note:    #B0C82D;\n\t\t\t\t--pitch7-primary-note:      #6C8000;\n\t\t\t\t--pitch8-secondary-channel: #FF90A4;\n\t\t\t\t--pitch8-primary-channel:   #E12E4D;\n\t\t\t\t--pitch8-secondary-note:    #EC6E85;\n\t\t\t\t--pitch8-primary-note:      #A6001D;\n\t\t\t\t--pitch9-secondary-channel: #41E3B5;\n\t\t\t\t--pitch9-primary-channel:   #00B481;\n\t\t\t\t--pitch9-secondary-note:    #28D1A1;\n\t\t\t\t--pitch9-primary-note:      #00835E;\n\t\t\t\t--pitch10-secondary-channel:#CA77FF;\n\t\t\t\t--pitch10-primary-channel:  #9609FF;\n\t\t\t\t--pitch10-secondary-note:   #B54FFF;\n\t\t\t\t--pitch10-primary-note:     #8400E3;\n\t\t\t\t--noise1-secondary-channel: #C1C1C1;\n\t\t\t\t--noise1-primary-channel:   #898989;\n\t\t\t\t--noise1-secondary-note:    #ADADAD;\n\t\t\t\t--noise1-primary-note:      #6C6C6C;\n\t\t\t\t--noise2-secondary-channel: #E8BB8C;\n\t\t\t\t--noise2-primary-channel:   #BD7D3A;\n\t\t\t\t--noise2-secondary-note:    #D1A374;\n\t\t\t\t--noise2-primary-note:      #836342;\n\t\t\t\t--noise3-secondary-channel: #9BC4EB;\n\t\t\t\t--noise3-primary-channel:   #4481BE;\n\t\t\t\t--noise3-secondary-note:    #7CA7D3;\n\t\t\t\t--noise3-primary-note:      #476685;\n\t\t\t\t--noise4-secondary-channel: #C5A5E0;\n\t\t\t\t--noise4-primary-channel:   #8553AE;\n\t\t\t\t--noise4-secondary-note:    #B290CC;\n\t\t\t\t--noise4-primary-note:      #684F7D;\n\t\t\t\t--noise5-secondary-channel: #B8CE93;\n\t\t\t\t--noise5-primary-channel:   #87A74F;\n\t\t\t\t--noise5-secondary-note:    #ABC183;\n\t\t\t\t--noise5-primary-note:      #68784C;\n\t\t\t\t\t--mod1-secondary-channel:   #339955;\n\t\t\t\t\t--mod1-primary-channel:     #77dd55;\n\t\t\t\t\t--mod1-secondary-note:      #77ff8a;\n\t\t\t\t\t--mod1-primary-note:        #2ad84a;\n\t\t\t\t\t--mod2-secondary-channel:   #993355;\n\t\t\t\t\t--mod2-primary-channel:     #f04960;\n\t\t\t\t\t--mod2-secondary-note:      #f057a0;\n\t\t\t\t\t--mod2-primary-note:        #ba124a;\n\t\t\t\t\t--mod3-secondary-channel:   #553399;\n\t\t\t\t\t--mod3-primary-channel:     #8855fc;\n\t\t\t\t\t--mod3-secondary-note:      #aa64ff;\n\t\t\t\t\t--mod3-primary-note:        #7a1caa;\n\t\t\t\t\t--mod4-secondary-channel:   #a86436;\n\t\t\t\t\t--mod4-primary-channel:     #c8a825;\n\t\t\t\t\t--mod4-secondary-note:      #e8ba46;\n\t\t\t\t\t--mod4-primary-note:        #a86810;\n\t\t\t\t\t--mod-label-primary:        #dddddd;\n\t\t\t\t\t--mod-label-secondary-text: #777;\n\t\t\t\t\t--mod-label-primary-text:   black;\n\t\t\t\t\t--disabled-note-primary:    #666;\n\t\t\t\t\t--disabled-note-secondary:  #aaa;\n\t\t\t}\n\t\t\t\n\t\t\t.beepboxEditor button, .beepboxEditor select {\n\t\t\t\tbox-shadow: inset 0 0 0 1px var(--secondary-text);\n\t\t\t}\n\n\t\t\t\t.select2-selection__rendered {\n\t\t\t\t\tbox-shadow: inset 0 0 0 1px var(--secondary-text);\n\t\t\t\t}\n\t\t", "jummbox classic": "\n\t\t\t\t:root {\n\t\t\t\t\t--page-margin: #040410;\n\t\t\t\t\t--editor-background: #040410;\n\t\t\t\t\t--hover-preview: white;\n\t\t\t\t\t--playhead: rgba(255, 255, 255, 0.9);\n\t\t\t\t\t--primary-text: white;\n\t\t\t\t\t--secondary-text: #84859a;\n\t\t\t\t\t--inverted-text: black;\n\t\t\t\t\t--text-selection: rgba(119,68,255,0.99);\n\t\t\t\t\t--box-selection-fill: #044b94;\n\t\t\t\t\t--loop-accent: #74f;\n\t\t\t\t\t--link-accent: #98f;\n\t\t\t\t\t--ui-widget-background: #393e4f;\n\t\t\t\t\t--ui-widget-focus: #6d6886;\n\t\t\t\t\t--pitch-background: #393e4f;\n\t\t\t\t\t--tonic: #725491;\n\t\t\t\t\t--fifth-note: #54547a;\n\t\t\t\t\t--white-piano-key: #eee;\n\t\t\t\t\t--black-piano-key: #666;\n\t\t\t\t\t--use-color-formula: true;\n\t\t\t\t\t--track-editor-bg-pitch: #393e4f;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #1c1d28;\n\t\t\t\t\t--track-editor-bg-noise: #3d3535;\n\t\t\t\t\t--track-editor-bg-noise-dim: #161313;\n\t\t\t\t\t--track-editor-bg-mod: #283560;\n\t\t\t\t\t--track-editor-bg-mod-dim: #0a101f;\n\t\t\t\t\t--multiplicative-mod-slider: #606c9f;\n\t\t\t\t\t--overwriting-mod-slider: #6850b5;\n\t\t\t\t\t--indicator-primary: #9c64f7;\n\t\t\t\t\t--indicator-secondary: #393e4f;\n\t\t\t\t\t--select2-opt-group: #5d576f;\n\t\t\t\t\t--input-box-outline: #222;\n\t\t\t\t\t--mute-button-normal: #dda85d;\n\t\t\t\t\t--mute-button-mod: #886eae;\n\t\t\t\t\t--mod-label-primary: #282840;\n\t\t\t\t\t--mod-label-secondary-text: rgb(87, 86, 120);\n\t\t\t\t\t--mod-label-primary-text: white;\n\t\t\t\t\t--pitch-secondary-channel-hue: 0;\n\t\t\t\t\t--pitch-secondary-channel-hue-scale: 6.1;\n\t\t\t\t\t--pitch-secondary-channel-sat: 83.3;\n\t\t\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t\t\t--pitch-secondary-channel-lum: 40;\n\t\t\t\t\t--pitch-secondary-channel-lum-scale: 0.05;\n\t\t\t\t\t--pitch-primary-channel-hue: 0;\n\t\t\t\t\t--pitch-primary-channel-hue-scale: 6.1;\n\t\t\t\t\t--pitch-primary-channel-sat: 100;\n\t\t\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t\t\t--pitch-primary-channel-lum: 67.5;\n\t\t\t\t\t--pitch-primary-channel-lum-scale: 0.05;\n\t\t\t\t\t--pitch-secondary-note-hue: 0;\n\t\t\t\t\t--pitch-secondary-note-hue-scale: 6.1;\n\t\t\t\t\t--pitch-secondary-note-sat: 93.9;\n\t\t\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t\t\t--pitch-secondary-note-lum: 25;\n\t\t\t\t\t--pitch-secondary-note-lum-scale: 0.05;\n\t\t\t\t\t--pitch-primary-note-hue: 0;\n\t\t\t\t\t--pitch-primary-note-hue-scale: 6.1;\n\t\t\t\t\t--pitch-primary-note-sat: 100;\n\t\t\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t\t\t--pitch-primary-note-lum: 85.6;\n\t\t\t\t\t--pitch-primary-note-lum-scale: 0.025;\n\t\t\t\t\t--noise-secondary-channel-hue: 0;\n\t\t\t\t\t--noise-secondary-channel-hue-scale: 2;\n\t\t\t\t\t--noise-secondary-channel-sat: 25;\n\t\t\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-channel-lum: 42;\n\t\t\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--noise-primary-channel-hue: 0;\n\t\t\t\t\t--noise-primary-channel-hue-scale: 2;\n\t\t\t\t\t--noise-primary-channel-sat: 33;\n\t\t\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-primary-channel-lum: 63.5;\n\t\t\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t\t\t--noise-secondary-note-hue: 0;\n\t\t\t\t\t--noise-secondary-note-hue-scale: 2;\n\t\t\t\t\t--noise-secondary-note-sat: 33.5;\n\t\t\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-note-lum: 55;\n\t\t\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t\t\t--noise-primary-note-hue: 0;\n\t\t\t\t\t--noise-primary-note-hue-scale: 2;\n\t\t\t\t\t--noise-primary-note-sat: 46.5;\n\t\t\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t\t\t--noise-primary-note-lum: 74;\n\t\t\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-hue: 192;\n\t\t\t\t\t--mod-secondary-channel-hue-scale: 1.5;\n\t\t\t\t\t--mod-secondary-channel-sat: 88;\n\t\t\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-lum: 50;\n\t\t\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-primary-channel-hue: 192;\n\t\t\t\t\t--mod-primary-channel-hue-scale: 1.5;\n\t\t\t\t\t--mod-primary-channel-sat: 96;\n\t\t\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-primary-channel-lum: 80;\n\t\t\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-note-hue: 192;\n\t\t\t\t\t--mod-secondary-note-hue-scale: 1.5;\n\t\t\t\t\t--mod-secondary-note-sat: 92;\n\t\t\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-note-lum: 45;\n\t\t\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t\t\t--mod-primary-note-hue: 192;\n\t\t\t\t\t--mod-primary-note-hue-scale: 1.5;\n\t\t\t\t\t--mod-primary-note-sat: 96;\n\t\t\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t\t\t--mod-primary-note-lum: 85;\n\t\t\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t\t\t--disabled-note-primary:    #91879f;\n\t\t\t\t\t--disabled-note-secondary:  #6a677a;\n\t\t\t\t}\n\t\t\t", forest: "\n\t\t\t\t:root {\n\t\t\t\t\t--page-margin: #010c03;\n\t\t\t\t\t--editor-background: #010c03;\n\t\t\t\t\t--hover-preview: #efe;\n\t\t\t\t\t--playhead: rgba(232, 255, 232, 0.9);\n\t\t\t\t\t--primary-text: #efe;\n\t\t\t\t\t--secondary-text: #70A070;\n\t\t\t\t\t--inverted-text: #280228;\n\t\t\t\t\t--text-selection: rgba(255,68,199,0.99);\n\t\t\t\t\t--box-selection-fill: #267aa3;\n\t\t\t\t\t--loop-accent: #ffe845;\n\t\t\t\t\t--link-accent: #9f8;\n\t\t\t\t\t--ui-widget-background: #203829;\n\t\t\t\t\t--ui-widget-focus: #487860;\n\t\t\t\t\t--pitch-background: #203829;\n\t\t\t\t\t--tonic: #2b8d20;\n\t\t\t\t\t--fifth-note: #385840;\n\t\t\t\t\t--white-piano-key: #bda;\n\t\t\t\t\t--black-piano-key: #573;\n\t\t\t\t\t--use-color-formula: true;\n\t\t\t\t\t--track-editor-bg-pitch: #254820;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #102819;\n\t\t\t\t\t--track-editor-bg-noise: #304050;\n\t\t\t\t\t--track-editor-bg-noise-dim: #102030;\n\t\t\t\t\t--track-editor-bg-mod: #506030;\n\t\t\t\t\t--track-editor-bg-mod-dim: #2a300a;\n\t\t\t\t\t--multiplicative-mod-slider: #205c8f;\n\t\t\t\t\t--overwriting-mod-slider: #20ac6f;\n\t\t\t\t\t--indicator-primary: #dcd866;\n\t\t\t\t\t--indicator-secondary: #203829;\n\t\t\t\t\t--select2-opt-group: #1a6f5a;\n\t\t\t\t\t--input-box-outline: #242;\n\t\t\t\t\t--mute-button-normal: #49e980;\n\t\t\t\t\t--mute-button-mod: #c2e502;\n\t\t\t\t\t--mod-label-primary: #133613;\n\t\t\t\t\t--mod-label-secondary-text: rgb(27, 126, 40);\n\t\t\t\t\t--mod-label-primary-text: #efe;\n\t\t\t\t\t--pitch-secondary-channel-hue: 120;\n\t\t\t\t\t--pitch-secondary-channel-hue-scale: 8.1;\n\t\t\t\t\t--pitch-secondary-channel-sat: 59;\n\t\t\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t\t\t--pitch-secondary-channel-lum: 50;\n\t\t\t\t\t--pitch-secondary-channel-lum-scale: 0.04;\n\t\t\t\t\t--pitch-primary-channel-hue: 120;\n\t\t\t\t\t--pitch-primary-channel-hue-scale: 8.1;\n\t\t\t\t\t--pitch-primary-channel-sat: 86;\n\t\t\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t\t\t--pitch-primary-channel-lum: 70;\n\t\t\t\t\t--pitch-primary-channel-lum-scale: 0.04;\n\t\t\t\t\t--pitch-secondary-note-hue: 120;\n\t\t\t\t\t--pitch-secondary-note-hue-scale: 8.1;\n\t\t\t\t\t--pitch-secondary-note-sat: 85;\n\t\t\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t\t\t--pitch-secondary-note-lum: 30;\n\t\t\t\t\t--pitch-secondary-note-lum-scale: 0.04;\n\t\t\t\t\t--pitch-primary-note-hue: 120;\n\t\t\t\t\t--pitch-primary-note-hue-scale: 8.1;\n\t\t\t\t\t--pitch-primary-note-sat: 90;\n\t\t\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t\t\t--pitch-primary-note-lum: 80;\n\t\t\t\t\t--pitch-primary-note-lum-scale: 0.025;\n\t\t\t\t\t--noise-secondary-channel-hue: 200;\n\t\t\t\t\t--noise-secondary-channel-hue-scale: 1.1;\n\t\t\t\t\t--noise-secondary-channel-sat: 25;\n\t\t\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-channel-lum: 22;\n\t\t\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--noise-primary-channel-hue: 200;\n\t\t\t\t\t--noise-primary-channel-hue-scale: 1.1;\n\t\t\t\t\t--noise-primary-channel-sat: 48;\n\t\t\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-primary-channel-lum: 65;\n\t\t\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t\t\t--noise-secondary-note-hue: 200;\n\t\t\t\t\t--noise-secondary-note-hue-scale: 1.1;\n\t\t\t\t\t--noise-secondary-note-sat: 33.5;\n\t\t\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-note-lum: 33;\n\t\t\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t\t\t--noise-primary-note-hue: 200;\n\t\t\t\t\t--noise-primary-note-hue-scale: 1.1;\n\t\t\t\t\t--noise-primary-note-sat: 46.5;\n\t\t\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t\t\t--noise-primary-note-lum: 64;\n\t\t\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-hue: 40;\n\t\t\t\t\t--mod-secondary-channel-hue-scale: 1.8;\n\t\t\t\t\t--mod-secondary-channel-sat: 44;\n\t\t\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-lum: 50;\n\t\t\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-primary-channel-hue: 40;\n\t\t\t\t\t--mod-primary-channel-hue-scale: 1.8;\n\t\t\t\t\t--mod-primary-channel-sat: 60;\n\t\t\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-primary-channel-lum: 80;\n\t\t\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-note-hue: 40;\n\t\t\t\t\t--mod-secondary-note-hue-scale: 1.8;\n\t\t\t\t\t--mod-secondary-note-sat: 62;\n\t\t\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-note-lum: 55;\n\t\t\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t\t\t--mod-primary-note-hue: 40;\n\t\t\t\t\t--mod-primary-note-hue-scale: 1.8;\n\t\t\t\t\t--mod-primary-note-sat: 66;\n\t\t\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t\t\t--mod-primary-note-lum: 85;\n\t\t\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t\t\t--disabled-note-primary:    #536e5c;\n\t\t\t\t\t--disabled-note-secondary:  #395440;\n\t\t\t\t}\n\t\t\t", canyon: "\n\t\t\t\t:root {\n\t\t\t\t\t--page-margin: #0a0000;\n\t\t\t\t\t--editor-background: #0a0000;\n\t\t\t\t\t--hover-preview: white;\n\t\t\t\t\t--playhead: rgba(247, 172, 196, 0.9);\n\t\t\t\t\t--primary-text: #f5d6bf;\n\t\t\t\t\t--secondary-text: #934050;\n\t\t\t\t\t--inverted-text: #290505;\n\t\t\t\t\t--text-selection: rgba(255, 208, 68, 0.99);\n\t\t\t\t\t--box-selection-fill: #94044870;\n\t\t\t\t\t--loop-accent: #ff1e1e;\n\t\t\t\t\t--link-accent: #da7b76;\n\t\t\t\t\t--ui-widget-background: #533137;\n\t\t\t\t\t--ui-widget-focus: #743e4b;\n\t\t\t\t\t--pitch-background: #4f3939;\n\t\t\t\t\t--tonic: #9e4145;\n\t\t\t\t\t--fifth-note: #5b3e6b;\n\t\t\t\t\t--white-piano-key: #d89898;\n\t\t\t\t\t--black-piano-key: #572b29;\n\t\t\t\t\t--use-color-formula: true;\n\t\t\t\t\t--track-editor-bg-pitch: #5e3a41;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #281d1c;\n\t\t\t\t\t--track-editor-bg-noise: #3a3551;\n\t\t\t\t\t--track-editor-bg-noise-dim: #272732;\n\t\t\t\t\t--track-editor-bg-mod: #552045;\n\t\t\t\t\t--track-editor-bg-mod-dim: #3e1442;\n\t\t\t\t\t--multiplicative-mod-slider: #9f6095;\n\t\t\t\t\t--overwriting-mod-slider: #b55050;\n\t\t\t\t\t--indicator-primary: #f2f764;\n\t\t\t\t\t--indicator-secondary: #4f3939;\n\t\t\t\t\t--select2-opt-group: #673030;\n\t\t\t\t\t--input-box-outline: #443131;\n\t\t\t\t\t--mute-button-normal: #d81833;\n\t\t\t\t\t--mute-button-mod: #9e2691;\n\t\t\t\t\t--mod-label-primary: #5f2b39;\n\t\t\t\t\t--mod-label-secondary-text: rgb(158, 66, 122);\n\t\t\t\t\t--mod-label-primary-text: #e6caed;\n\t\t\t\t\t--pitch-secondary-channel-hue: 0;\n\t\t\t\t\t--pitch-secondary-channel-hue-scale: 11.8;\n\t\t\t\t\t--pitch-secondary-channel-sat: 73.3;\n\t\t\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t\t\t--pitch-secondary-channel-lum: 40;\n\t\t\t\t\t--pitch-secondary-channel-lum-scale: 0.05;\n\t\t\t\t\t--pitch-primary-channel-hue: 0;\n\t\t\t\t\t--pitch-primary-channel-hue-scale: 11.8;\n\t\t\t\t\t--pitch-primary-channel-sat: 90;\n\t\t\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t\t\t--pitch-primary-channel-lum: 67.5;\n\t\t\t\t\t--pitch-primary-channel-lum-scale: 0.05;\n\t\t\t\t\t--pitch-secondary-note-hue: 0;\n\t\t\t\t\t--pitch-secondary-note-hue-scale: 11.8;\n\t\t\t\t\t--pitch-secondary-note-sat: 83.9;\n\t\t\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t\t\t--pitch-secondary-note-lum: 35;\n\t\t\t\t\t--pitch-secondary-note-lum-scale: 0.05;\n\t\t\t\t\t--pitch-primary-note-hue: 0;\n\t\t\t\t\t--pitch-primary-note-hue-scale: 11.8;\n\t\t\t\t\t--pitch-primary-note-sat: 100;\n\t\t\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t\t\t--pitch-primary-note-lum: 85.6;\n\t\t\t\t\t--pitch-primary-note-lum-scale: 0.025;\n\t\t\t\t\t--noise-secondary-channel-hue: 60;\n\t\t\t\t\t--noise-secondary-channel-hue-scale: 2;\n\t\t\t\t\t--noise-secondary-channel-sat: 25;\n\t\t\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-channel-lum: 42;\n\t\t\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--noise-primary-channel-hue: 60;\n\t\t\t\t\t--noise-primary-channel-hue-scale: 2;\n\t\t\t\t\t--noise-primary-channel-sat: 33;\n\t\t\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-primary-channel-lum: 63.5;\n\t\t\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t\t\t--noise-secondary-note-hue: 60;\n\t\t\t\t\t--noise-secondary-note-hue-scale: 2;\n\t\t\t\t\t--noise-secondary-note-sat: 33.5;\n\t\t\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-note-lum: 55;\n\t\t\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t\t\t--noise-primary-note-hue: 60;\n\t\t\t\t\t--noise-primary-note-hue-scale: 2;\n\t\t\t\t\t--noise-primary-note-sat: 46.5;\n\t\t\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t\t\t--noise-primary-note-lum: 74;\n\t\t\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-hue: 222;\n\t\t\t\t\t--mod-secondary-channel-hue-scale: 1.5;\n\t\t\t\t\t--mod-secondary-channel-sat: 88;\n\t\t\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-lum: 50;\n\t\t\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-primary-channel-hue: 222;\n\t\t\t\t\t--mod-primary-channel-hue-scale: 1.5;\n\t\t\t\t\t--mod-primary-channel-sat: 96;\n\t\t\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-primary-channel-lum: 80;\n\t\t\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-note-hue: 222;\n\t\t\t\t\t--mod-secondary-note-hue-scale: 1.5;\n\t\t\t\t\t--mod-secondary-note-sat: 92;\n\t\t\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-note-lum: 54;\n\t\t\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t\t\t--mod-primary-note-hue: 222;\n\t\t\t\t\t--mod-primary-note-hue-scale: 1.5;\n\t\t\t\t\t--mod-primary-note-sat: 96;\n\t\t\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t\t\t--mod-primary-note-lum: 75;\n\t\t\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t\t\t--disabled-note-primary:    #515164;\n\t\t\t\t\t--disabled-note-secondary:  #2a2a3a;\n\t\t\t\t}\n\t\t\t", midnight: "\n\t\t:root {\n\t\t\t--page-margin: #000;\n\t\t\t--editor-background: #000;\n\t\t\t--hover-preview: #757575;\n\t\t\t--playhead: #fff;\n\t\t\t--primary-text: #fff;\n\t\t\t--secondary-text: #acacac;\n\t\t\t--inverted-text: #290505;\n\t\t\t--text-selection: rgba(155, 155, 155, 0.99);\n\t\t\t--box-selection-fill: #79797970;\n\t\t\t--loop-accent: #646464;\n\t\t\t--link-accent: #707070;\n\t\t\t--ui-widget-background: #353535;\n\t\t\t--ui-widget-focus: #464646;\n\t\t\t--pitch-background: #222121;\n\t\t\t--tonic: #555955;\n\t\t\t--fifth-note: #1a1818;\n\t\t\t--white-piano-key: #a89e9e;\n\t\t\t--black-piano-key: #2d2424;\n\t\t\t--use-color-formula: true;\n\t\t\t--track-editor-bg-pitch: #373737;\n\t\t\t--track-editor-bg-pitch-dim: #131313;\n\t\t\t--track-editor-bg-noise: #484848;\n\t\t\t--track-editor-bg-noise-dim: #131313;\n\t\t\t--track-editor-bg-mod: #373737;\n\t\t\t--track-editor-bg-mod-dim: #131313;\n\t\t\t--multiplicative-mod-slider: #555;\n\t\t\t--overwriting-mod-slider: #464545;\n\t\t\t--indicator-primary: #e0e0e0;\n\t\t\t--indicator-secondary: #404040;\n\t\t\t--select2-opt-group: #3c3b3b;\n\t\t\t--input-box-outline: #757575;\n\t\t\t--mute-button-normal: #8e8d8d;\n\t\t\t--mute-button-mod: #ddd;\n\t\t\t--mod-label-primary: #262526;\n\t\t\t--mod-label-secondary-text: rgb(227, 222, 225);\n\t\t\t--mod-label-primary-text: #b9b9b9;\n\t\t\t--pitch-secondary-channel-hue: 240;\n\t\t\t--pitch-secondary-channel-hue-scale: 228;\n\t\t\t--pitch-secondary-channel-sat: 73.3;\n\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t--pitch-secondary-channel-lum: 25;\n\t\t\t--pitch-secondary-channel-lum-scale: 0.05;\n\t\t\t--pitch-primary-channel-hue: 240;\n\t\t\t--pitch-primary-channel-hue-scale: 228;\n\t\t\t--pitch-primary-channel-sat: 80;\n\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t--pitch-primary-channel-lum: 60.5;\n\t\t\t--pitch-primary-channel-lum-scale: 0.05;\n\t\t\t--pitch-secondary-note-hue: 240;\n\t\t\t--pitch-secondary-note-hue-scale: 228;\n\t\t\t--pitch-secondary-note-sat: 73.9;\n\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t--pitch-secondary-note-lum: 32;\n\t\t\t--pitch-secondary-note-lum-scale: 0.05;\n\t\t\t--pitch-primary-note-hue: 240;\n\t\t\t--pitch-primary-note-hue-scale: 228;\n\t\t\t--pitch-primary-note-sat: 90;\n\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t--pitch-primary-note-lum: 80.6;\n\t\t\t--pitch-primary-note-lum-scale: 0.025;\n\t\t\t--noise-secondary-channel-hue: 160;\n\t\t\t--noise-secondary-channel-hue-scale: 2;\n\t\t\t--noise-secondary-channel-sat: 25;\n\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t--noise-secondary-channel-lum: 42;\n\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t--noise-primary-channel-hue: 160;\n\t\t\t--noise-primary-channel-hue-scale: 2;\n\t\t\t--noise-primary-channel-sat: 33;\n\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t--noise-primary-channel-lum: 63.5;\n\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t--noise-secondary-note-hue: 160;\n\t\t\t--noise-secondary-note-hue-scale: 2;\n\t\t\t--noise-secondary-note-sat: 33.5;\n\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t--noise-secondary-note-lum: 55;\n\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t--noise-primary-note-hue: 160;\n\t\t\t--noise-primary-note-hue-scale: 2;\n\t\t\t--noise-primary-note-sat: 46.5;\n\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t--noise-primary-note-lum: 74;\n\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t--mod-secondary-channel-hue: 62;\n\t\t\t--mod-secondary-channel-hue-scale: 1.5;\n\t\t\t--mod-secondary-channel-sat: 88;\n\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t--mod-secondary-channel-lum: 30;\n\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t--mod-primary-channel-hue: 62;\n\t\t\t--mod-primary-channel-hue-scale: 1.5;\n\t\t\t--mod-primary-channel-sat: 96;\n\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t--mod-primary-channel-lum: 80;\n\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t--mod-secondary-note-hue: 62;\n\t\t\t--mod-secondary-note-hue-scale: 1.5;\n\t\t\t--mod-secondary-note-sat: 92;\n\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t--mod-secondary-note-lum: 34;\n\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t--mod-primary-note-hue: 62;\n\t\t\t--mod-primary-note-hue-scale: 1.5;\n\t\t\t--mod-primary-note-sat: 96;\n\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t--mod-primary-note-lum: 75;\n\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t--disabled-note-primary:    #66a;\n\t\t\t--disabled-note-secondary:  #447;\n\t\t}\n\t", "jummbox light": "\n\t\t\t\t:root {\n\t\t\t\t\t-webkit-text-stroke-width: 0.5px;\n\t\t\t\t\t--page-margin: #fefdff;\n\t\t\t\t\t--editor-background: #fefdff;\n\t\t\t\t\t--hover-preview: #302880;\n\t\t\t\t\t--playhead: rgba(62, 32, 120, 0.9);\n\t\t\t\t\t--primary-text: #401890;\n\t\t\t\t\t--secondary-text: #8769af;\n\t\t\t\t\t--inverted-text: #fefdff;\n\t\t\t\t\t--text-selection: rgba(255,160,235,0.99);\n\t\t\t\t\t--box-selection-fill: rgba(30,62,220,0.5);\n\t\t\t\t\t--loop-accent: #4c35d4;\n\t\t\t\t\t--link-accent: #7af;\n\t\t\t\t\t--ui-widget-background: #bf9cec;\n\t\t\t\t\t--ui-widget-focus: #e9c4ff;\n\t\t\t\t\t--pitch-background: #e2d9f9;\n\t\t\t\t\t--tonic: #c288cc;\n\t\t\t\t\t--fifth-note: #d8c9fd;\n\t\t\t\t\t--white-piano-key: #e2e2ff;\n\t\t\t\t\t--black-piano-key: #66667a;\n\t\t\t\t\t--use-color-formula: true;\n\t\t\t\t\t--track-editor-bg-pitch: #d9e5ec;\n\t\t\t\t\t--track-editor-bg-pitch-dim: #eaeef5;\n\t\t\t\t\t--track-editor-bg-noise: #ffc3ae;\n\t\t\t\t\t--track-editor-bg-noise-dim: #ffe0cf;\n\t\t\t\t\t--track-editor-bg-mod: #c9accc;\n\t\t\t\t\t--track-editor-bg-mod-dim: #ebe3ef;\n\t\t\t\t\t--multiplicative-mod-slider: #807caf;\n\t\t\t\t\t--overwriting-mod-slider: #909cdf;\n\t\t\t\t\t--indicator-primary: #ae38ff;\n\t\t\t\t\t--indicator-secondary: #bbd4ec;\n\t\t\t\t\t--select2-opt-group: #c1b7f1;\n\t\t\t\t\t--input-box-outline: #bbb;\n\t\t\t\t\t--mute-button-normal: #e9b752;\n\t\t\t\t\t--mute-button-mod: #9558ee;\n\t\t\t\t\t--mod-label-primary: #ececff;\n\t\t\t\t\t--mod-label-secondary-text: rgb(197, 145, 247);\n\t\t\t\t\t--mod-label-primary-text: #302880;\n\t\t\t\t\t--pitch-secondary-channel-hue: 0;\n\t\t\t\t\t--pitch-secondary-channel-hue-scale: 8.1;\n\t\t\t\t\t--pitch-secondary-channel-sat: 53.3;\n\t\t\t\t\t--pitch-secondary-channel-sat-scale: -0.1;\n\t\t\t\t\t--pitch-secondary-channel-lum: 72;\n\t\t\t\t\t--pitch-secondary-channel-lum-scale: -0.05;\n\t\t\t\t\t--pitch-primary-channel-hue: 0;\n\t\t\t\t\t--pitch-primary-channel-hue-scale: 8.1;\n\t\t\t\t\t--pitch-primary-channel-sat: 97;\n\t\t\t\t\t--pitch-primary-channel-sat-scale: -0.1;\n\t\t\t\t\t--pitch-primary-channel-lum: 45.5;\n\t\t\t\t\t--pitch-primary-channel-lum-scale: -0.05;\n\t\t\t\t\t--pitch-secondary-note-hue: 0;\n\t\t\t\t\t--pitch-secondary-note-hue-scale: 8.1;\n\t\t\t\t\t--pitch-secondary-note-sat: 93.9;\n\t\t\t\t\t--pitch-secondary-note-sat-scale: -0.1;\n\t\t\t\t\t--pitch-secondary-note-lum: 95;\n\t\t\t\t\t--pitch-secondary-note-lum-scale: -0.05;\n\t\t\t\t\t--pitch-primary-note-hue: 0;\n\t\t\t\t\t--pitch-primary-note-hue-scale: 8.1;\n\t\t\t\t\t--pitch-primary-note-sat: 100;\n\t\t\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t\t\t--pitch-primary-note-lum: 43.6;\n\t\t\t\t\t--pitch-primary-note-lum-scale: -0.025;\n\t\t\t\t\t--noise-secondary-channel-hue: 220;\n\t\t\t\t\t--noise-secondary-channel-hue-scale: 2;\n\t\t\t\t\t--noise-secondary-channel-sat: 25;\n\t\t\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-channel-lum: 62;\n\t\t\t\t\t--noise-secondary-channel-lum-scale: -0.1;\n\t\t\t\t\t--noise-primary-channel-hue: 220;\n\t\t\t\t\t--noise-primary-channel-hue-scale: 2;\n\t\t\t\t\t--noise-primary-channel-sat: 53;\n\t\t\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t\t\t--noise-primary-channel-lum: 53.5;\n\t\t\t\t\t--noise-primary-channel-lum-scale: -0.1;\n\t\t\t\t\t--noise-secondary-note-hue: 220;\n\t\t\t\t\t--noise-secondary-note-hue-scale: 2;\n\t\t\t\t\t--noise-secondary-note-sat: 58.5;\n\t\t\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t\t\t--noise-secondary-note-lum: 85;\n\t\t\t\t\t--noise-secondary-note-lum-scale: -1;\n\t\t\t\t\t--noise-primary-note-hue: 220;\n\t\t\t\t\t--noise-primary-note-hue-scale: 2;\n\t\t\t\t\t--noise-primary-note-sat: 56.5;\n\t\t\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t\t\t--noise-primary-note-lum: 54;\n\t\t\t\t\t--noise-primary-note-lum-scale: -1;\n\t\t\t\t\t--mod-secondary-channel-hue: 90;\n\t\t\t\t\t--mod-secondary-channel-hue-scale: 1.5;\n\t\t\t\t\t--mod-secondary-channel-sat: 88;\n\t\t\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-channel-lum: 60;\n\t\t\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-primary-channel-hue: 90;\n\t\t\t\t\t--mod-primary-channel-hue-scale: 1.5;\n\t\t\t\t\t--mod-primary-channel-sat: 100;\n\t\t\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t\t\t--mod-primary-channel-lum: 65;\n\t\t\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t\t\t--mod-secondary-note-hue: 90;\n\t\t\t\t\t--mod-secondary-note-hue-scale: 1.5;\n\t\t\t\t\t--mod-secondary-note-sat: 92;\n\t\t\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t\t\t--mod-secondary-note-lum: 95;\n\t\t\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t\t\t--mod-primary-note-hue: 90;\n\t\t\t\t\t--mod-primary-note-hue-scale: 1.5;\n\t\t\t\t\t--mod-primary-note-sat: 96;\n\t\t\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t\t\t--mod-primary-note-lum: 55;\n\t\t\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t\t\t--disabled-note-primary:    #868;\n\t\t\t\t\t--disabled-note-secondary:  #767;\n\t\t\t\t}\n\n\t\t\t\t.beepboxEditor button, .beepboxEditor select {\n\t\t\t\t\tbox-shadow: inset 0 0 0 1px var(--secondary-text);\n\t\t\t\t}\n\n\t\t\t\t.select2-selection__rendered {\n\t\t\t\t\tbox-shadow: inset 0 0 0 1px var(--secondary-text);\n\t\t\t\t}\n\t\t\t", beachcombing: "\n\t\t\t:root {\n\t\t\t--page-margin: #010121;\n\t\t\t--editor-background: #020222;\n\t\t\t--hover-preview: #f3ffff;\n\t\t\t--playhead: #fff;\n\t\t\t--primary-text: #c1f1ff;\n\t\t\t--secondary-text: #546775;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgba(119,68,255,0.99);\n\t\t\t--box-selection-fill: #3e0028;\n\t\t\t--loop-accent: #5a00ff;\n\t\t\t--link-accent: #ff00c8fc;\n\t\t\t--ui-widget-background: #1f2b52;\n\t\t\t--ui-widget-focus: #384e91;\n\t\t\t--pitch-background: #2c3155;\n\t\t\t--tonic: #a32f6e;\n\t\t\t--fifth-note: #0044a0;\n\t\t\t--white-piano-key: #fff;\n\t\t\t--black-piano-key: #202d42;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #34406c;\n\t\t\t--track-editor-bg-pitch-dim: #1c1d28;\n\t\t\t--track-editor-bg-noise: #562e3b;\n\t\t\t--track-editor-bg-noise-dim: #161313;\n\t\t\t--track-editor-bg-mod: #372e66;\n\t\t\t--track-editor-bg-mod-dim: #2a1640;\n\t\t\t--multiplicative-mod-slider: #606c9f;\n\t\t\t--overwriting-mod-slider: #6850b5;\n\t\t\t--indicator-primary: #ff67c2;\n\t\t\t--indicator-secondary: #393e4f;\n\t\t\t--select2-opt-group: #5d576f;\n\t\t\t--input-box-outline: #222;\n\t\t\t--mute-button-normal: #7ce1ff;\n\t\t\t--mute-button-mod: #db519d;\n\t\t\t--pitch1-secondary-channel: #329b70;\n\t\t\t--pitch1-primary-channel: #53ffb8;\n\t\t\t--pitch1-secondary-note: #4cb98c;\n\t\t\t--pitch1-primary-note: #98ffd4;\n\t\t\t--pitch2-secondary-channel: #8e8632;\n\t\t\t--pitch2-primary-channel: #fff36a;\n\t\t\t--pitch2-secondary-note: #afaf22;\n\t\t\t--pitch2-primary-note: #f9f93f;\n\t\t\t--pitch3-secondary-channel: #018e8e;\n\t\t\t--pitch3-primary-channel: #00ffff;\n\t\t\t--pitch3-secondary-note: #24b7b7;\n\t\t\t--pitch3-primary-note: #a7ffff;\n\t\t\t--pitch4-secondary-channel: #6c003d;\n\t\t\t--pitch4-primary-channel: #ff0090;\n\t\t\t--pitch4-secondary-note: #a73c78;\n\t\t\t--pitch4-primary-note: #ff98d2;\n\t\t\t--pitch5-secondary-channel: #0e8153;\n\t\t\t--pitch5-primary-channel: #59ffbd;\n\t\t\t--pitch5-secondary-note: #489979;\n\t\t\t--pitch5-primary-note: #b0ffe0;\n\t\t\t--pitch6-secondary-channel: #185aab;\n\t\t\t--pitch6-primary-channel: #4e7ce5;\n\t\t\t--pitch6-secondary-note: #3e99d9;\n\t\t\t--pitch6-primary-note: #b3e3ff;\n\t\t\t--pitch7-secondary-channel: #4f007d;\n\t\t\t--pitch7-primary-channel: #a200ff;\n\t\t\t--pitch7-secondary-note: #9741c9;\n\t\t\t--pitch7-primary-note: #d386ff;\n\t\t\t--pitch8-secondary-channel: #101c8d;\n\t\t\t--pitch8-primary-channel: #1c5df1;\n\t\t\t--pitch8-secondary-note: #FF4E63;\n\t\t\t--pitch8-primary-note: #FFB2BB;\n\t\t\t--pitch9-secondary-channel: #00A170;\n\t\t\t--pitch9-primary-channel: #50FFC9;\n\t\t\t--pitch9-secondary-note: #00C78A;\n\t\t\t--pitch9-primary-note: #83FFD9;\n\t\t\t--pitch10-secondary-channel: #A11FFF;\n\t\t\t--pitch10-primary-channel: #CE8BFF;\n\t\t\t--pitch10-secondary-note: #B757FF;\n\t\t\t--pitch10-primary-note: #DFACFF;\n\t\t\t--noise1-secondary-channel: #635070;\n\t\t\t--noise1-primary-channel: #9071db;\n\t\t\t--noise1-secondary-note: #915dc1;\n\t\t\t--noise1-primary-note: #c5a5ff;\n\t\t\t--noise2-secondary-channel: #993367;\n\t\t\t--noise2-primary-channel: #dd777c;\n\t\t\t--noise2-secondary-note: #cc6695;\n\t\t\t--noise2-primary-note: #f0bbd1;\n\t\t\t--noise3-secondary-channel: #4a8c8f;\n\t\t\t--noise3-primary-channel: #77c5dd;\n\t\t\t--noise3-secondary-note: #6fb4cf;\n\t\t\t--noise3-primary-note: #bbf2ff;\n\t\t\t--noise4-secondary-channel: #8e3e7d;\n\t\t\t--noise4-primary-channel: #c682d2;\n\t\t\t--noise4-secondary-note: #b871c1;\n\t\t\t--noise4-primary-note: #ffb8f0;\n\t\t\t--noise5-secondary-channel: #785e37;\n\t\t\t--noise5-primary-channel: #bb9d77;\n\t\t\t--noise5-secondary-note: #aa8c66;\n\t\t\t--noise5-primary-note: #e2d1b2;\n\t\t\t--mod1-secondary-channel: #4e8397;\n\t\t\t--mod1-primary-channel: #92e6f3;\n\t\t\t--mod1-secondary-note: #76b9d9;\n\t\t\t--mod1-primary-note: #cde3ff;\n\t\t\t--mod2-secondary-channel: #ad5774;\n\t\t\t--mod2-primary-channel: #eba4ae;\n\t\t\t--mod2-secondary-note: #c9719b;\n\t\t\t--mod2-primary-note: #fdcee7;\n\t\t\t--mod3-secondary-channel: #6f579f;\n\t\t\t--mod3-primary-channel: #b192f7;\n\t\t\t--mod3-secondary-note: #a778e1;\n\t\t\t--mod3-primary-note: #f8ddff;\n\t\t\t--mod4-secondary-channel: #a88a36;\n\t\t\t--mod4-primary-channel: #bec825;\n\t\t\t--mod4-secondary-note: #aecb57;\n\t\t\t--mod4-primary-note: #dee9bd;\n\t\t\t--mod-label-primary: #2c2c56;\n\t\t\t--mod-label-secondary-text: rgb(71,69,147);\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #91879f;\n\t\t\t--disabled-note-secondary: #6a677a;\n\n\n\t\t\t}\n\t\t", roe: "\n\t\t\t:root {\n\t\t\t--page-margin: #050000;\n\t\t\t--editor-background: #050000;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: #b8cee0;\n\t\t\t--secondary-text: #cb3434;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgb(255 68 68 / 99%);\n\t\t\t--box-selection-fill: rgb(255 0 0 / 30%);\n\t\t\t--loop-accent: #7744FF;\n\t\t\t--link-accent: #FF2A2A;\n\t\t\t--ui-widget-background: #1a2642;\n\t\t\t--ui-widget-focus: #2c3f6d;\n\t\t\t--pitch-background: #15111a;\n\t\t\t--tonic: #1b3041;\n\t\t\t--fifth-note: #381818;\n\t\t\t--white-piano-key: #cdcdcd;\n\t\t\t--black-piano-key: #232323;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #302938;\n\t\t\t--track-editor-bg-pitch-dim: #211c26;\n\t\t\t--track-editor-bg-noise: #261f42;\n\t\t\t--track-editor-bg-noise-dim: #1a152d;\n\t\t\t--track-editor-bg-mod: #183049;\n\t\t\t--track-editor-bg-mod-dim: #102132;\n\t\t\t--multiplicative-mod-slider: #344a7f;\n\t\t\t--overwriting-mod-slider: #344a7f;\n\t\t\t--indicator-primary: #FF2A2A;\n\t\t\t--indicator-secondary: #800000;\n\t\t\t--select2-opt-group: #141e34;\n\t\t\t--input-box-outline: #141e34;\n\t\t\t--mute-button-normal: #299eff;\n\t\t\t--mute-button-mod: #165a93;\n\t\t\t--pitch1-secondary-channel: #273c90;\n\t\t\t--pitch1-primary-channel: #476BFF;\n\t\t\t--pitch1-secondary-note: #273c90;\n\t\t\t--pitch1-primary-note: #476BFF;\n\t\t\t--pitch2-secondary-channel: #3a3898;\n\t\t\t--pitch2-primary-channel: #625FFB;\n\t\t\t--pitch2-secondary-note: #3a3898;\n\t\t\t--pitch2-primary-note: #625FFB;\n\t\t\t--pitch3-secondary-channel: #542780;\n\t\t\t--pitch3-primary-channel: #9C49EC;\n\t\t\t--pitch3-secondary-note: #542780;\n\t\t\t--pitch3-primary-note: #9C49EC;\n\t\t\t--pitch4-secondary-channel: #84225d;\n\t\t\t--pitch4-primary-channel: #fd3fb1;\n\t\t\t--pitch4-secondary-note: #84225d;\n\t\t\t--pitch4-primary-note: #fd3fb1;\n\t\t\t--pitch5-secondary-channel: #8d2323;\n\t\t\t--pitch5-primary-channel: #ff3f3f;\n\t\t\t--pitch5-secondary-note: #8d2323;\n\t\t\t--pitch5-primary-note: #ff3f3f;\n\t\t\t--pitch6-secondary-channel: #84225d;\n\t\t\t--pitch6-primary-channel: #fd3fb1;\n\t\t\t--pitch6-secondary-note: #84225d;\n\t\t\t--pitch6-primary-note: #fd3fb1;\n\t\t\t--pitch7-secondary-channel: #542780;\n\t\t\t--pitch7-primary-channel: #9C49EC;\n\t\t\t--pitch7-secondary-note: #542780;\n\t\t\t--pitch7-primary-note: #9C49EC;\n\t\t\t--pitch8-secondary-channel: #3a3898;\n\t\t\t--pitch8-primary-channel: #625FFB;\n\t\t\t--pitch8-secondary-note: #3a3898;\n\t\t\t--pitch8-primary-note: #625FFB;\n\t\t\t--pitch9-secondary-channel: #273c90;\n\t\t\t--pitch9-primary-channel: #476BFF;\n\t\t\t--pitch9-secondary-note: #273c90;\n\t\t\t--pitch9-primary-note: #476BFF;\n\t\t\t--pitch10-secondary-channel: #165a93;\n\t\t\t--pitch10-primary-channel: #299EFF;\n\t\t\t--pitch10-secondary-note: #165a93;\n\t\t\t--pitch10-primary-note: #299EFF;\n\t\t\t--noise1-secondary-channel: #4281FF;\n\t\t\t--noise1-primary-channel: #96b9ff;\n\t\t\t--noise1-secondary-note: #4281FF;\n\t\t\t--noise1-primary-note: #96b9ff;\n\t\t\t--noise2-secondary-channel: #7347FF;\n\t\t\t--noise2-primary-channel: #c3b0ff;\n\t\t\t--noise2-secondary-note: #7347FF;\n\t\t\t--noise2-primary-note: #c3b0ff;\n\t\t\t--noise3-secondary-channel: #9F3CBF;\n\t\t\t--noise3-primary-channel: #e29cf9;\n\t\t\t--noise3-secondary-note: #9F3CBF;\n\t\t\t--noise3-primary-note: #e29cf9;\n\t\t\t--noise4-secondary-channel: #D3326F;\n\t\t\t--noise4-primary-channel: #fb9bbf;\n\t\t\t--noise4-secondary-note: #D3326F;\n\t\t\t--noise4-primary-note: #fb9bbf;\n\t\t\t--noise5-secondary-channel: #FF2A2A;\n\t\t\t--noise5-primary-channel: #ffa2a2;\n\t\t\t--noise5-secondary-note: #FF2A2A;\n\t\t\t--noise5-primary-note: #ffa2a2;\n\t\t\t--mod1-secondary-channel: #47587a;\n\t\t\t--mod1-primary-channel: #96b9ff;\n\t\t\t--mod1-secondary-note: #47587a;\n\t\t\t--mod1-primary-note: #96b9ff;\n\t\t\t--mod2-secondary-channel: #716791;\n\t\t\t--mod2-primary-channel: #c3b0ff;\n\t\t\t--mod2-secondary-note: #716791;\n\t\t\t--mod2-primary-note: #c3b0ff;\n\t\t\t--mod3-secondary-channel: #6f4c7b;\n\t\t\t--mod3-primary-channel: #e29cf9;\n\t\t\t--mod3-secondary-note: #6f4c7b;\n\t\t\t--mod3-primary-note: #e29cf9;\n\t\t\t--mod4-secondary-channel: #9e6279;\n\t\t\t--mod4-primary-channel: #fb9bbf;\n\t\t\t--mod4-secondary-note: #9e6279;\n\t\t\t--mod4-primary-note: #fb9bbf;\n\t\t\t--mod-label-primary: #15111a;\n\t\t\t--mod-label-secondary-text: #cb3434;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #c9c9c9;\n\t\t\t--disabled-note-secondary: #616161;\n\t\t}", moonlight: "\n\t\t\t:root {\n\t\t\t--page-margin: #020514;\n\t\t\t--editor-background: #020514;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: #D4DCE9;\n\t\t\t--secondary-text: #3E87DA;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: #03599bd9;\n\t\t\t--box-selection-fill: hsl(206deg 66% 41% / 85%);\n\t\t\t--loop-accent: #639BD6;\n\t\t\t--link-accent: #A8C6E8;\n\t\t\t--ui-widget-background: #1e2940;\n\t\t\t--ui-widget-focus: #324b81;\n\t\t\t--pitch-background: #223849;\n\t\t\t--tonic: #33536c;\n\t\t\t--fifth-note: hsl(206deg 36% 16%);\n\t\t\t--white-piano-key: #c1bfe9;\n\t\t\t--black-piano-key: #454354;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #25568d80;\n\t\t\t--track-editor-bg-pitch-dim: #10253c80;\n\t\t\t--track-editor-bg-noise: #25568d80;\n\t\t\t--track-editor-bg-noise-dim: #10253c80;\n\t\t\t--track-editor-bg-mod: #25568d80;\n\t\t\t--track-editor-bg-mod-dim: #10253c80;\n\t\t\t--multiplicative-mod-slider: #0476cd;\n\t\t\t--overwriting-mod-slider: #035899;\n\t\t\t--indicator-primary: #57a1f4;\n\t\t\t--indicator-secondary: #2e5684;\n\t\t\t--select2-opt-group: #24355c;\n\t\t\t--input-box-outline: #141e34;\n\t\t\t--mute-button-normal: #6ebffc;\n\t\t\t--mute-button-mod: #0a92fa;\n\t\t\t--pitch1-secondary-channel: #47425c;\n\t\t\t--pitch1-primary-channel: #918bac;\n\t\t\t--pitch1-secondary-note: #6b6489;\n\t\t\t--pitch1-primary-note: #a8a3bf;\n\t\t\t--pitch2-secondary-channel: #626493;\n\t\t\t--pitch2-primary-channel: #bdbed3;\n\t\t\t--pitch2-secondary-note: #626493;\n\t\t\t--pitch2-primary-note: #bdbed3;\n\t\t\t--pitch3-secondary-channel: #6e89b4;\n\t\t\t--pitch3-primary-channel: #d4dce9;\n\t\t\t--pitch3-secondary-note: #6e89b4;\n\t\t\t--pitch3-primary-note: #d4dce9;\n\t\t\t--pitch4-secondary-channel: #4c77a9;\n\t\t\t--pitch4-primary-channel: #a8c6e8;\n\t\t\t--pitch4-secondary-note: #4c77a9;\n\t\t\t--pitch4-primary-note: #a8c6e8;\n\t\t\t--pitch5-secondary-channel: #314e6d;\n\t\t\t--pitch5-primary-channel: #639bd6;\n\t\t\t--pitch5-secondary-note: #46698f;\n\t\t\t--pitch5-primary-note: #639bd6;\n\t\t\t--pitch6-secondary-channel: #143d6b;\n\t\t\t--pitch6-primary-channel: #3e87da;\n\t\t\t--pitch6-secondary-note: #143d6b;\n\t\t\t--pitch6-primary-note: #3e87da;\n\t\t\t--pitch7-secondary-channel: #314e6d;\n\t\t\t--pitch7-primary-channel: #639bd6;\n\t\t\t--pitch7-secondary-note: #314e6d;\n\t\t\t--pitch7-primary-note: #639bd6;\n\t\t\t--pitch8-secondary-channel: #4c77a9;\n\t\t\t--pitch8-primary-channel: #a8c6e8;\n\t\t\t--pitch8-secondary-note: #4c77a9;\n\t\t\t--pitch8-primary-note: #a8c6e8;\n\t\t\t--pitch9-secondary-channel: #6e89b4;\n\t\t\t--pitch9-primary-channel: #d4dce9;\n\t\t\t--pitch9-secondary-note: #6e89b4;\n\t\t\t--pitch9-primary-note: #d4dce9;\n\t\t\t--pitch10-secondary-channel: #626493;\n\t\t\t--pitch10-primary-channel: #bdbed3;\n\t\t\t--pitch10-secondary-note: #626493;\n\t\t\t--pitch10-primary-note: #bdbed3;\n\t\t\t--noise1-secondary-channel: #4b4a55;\n\t\t\t--noise1-primary-channel: #9795a3;\n\t\t\t--noise1-secondary-note: #4b4a55;\n\t\t\t--noise1-primary-note: #9795a3;\n\t\t\t--noise2-secondary-channel: #858e9d;\n\t\t\t--noise2-primary-channel: #d7dce5;\n\t\t\t--noise2-secondary-note: #858e9d;\n\t\t\t--noise2-primary-note: #d7dce5;\n\t\t\t--noise3-secondary-channel: #394e65;\n\t\t\t--noise3-primary-channel: #809bb7;\n\t\t\t--noise3-secondary-note: #394e65;\n\t\t\t--noise3-primary-note: #809bb7;\n\t\t\t--noise4-secondary-channel: #37577b;\n\t\t\t--noise4-primary-channel: #6189b8;\n\t\t\t--noise4-secondary-note: #37577b;\n\t\t\t--noise4-primary-note: #6189b8;\n\t\t\t--noise5-secondary-channel: #223849;\n\t\t\t--noise5-primary-channel: #5588af;\n\t\t\t--noise5-secondary-note: #223849;\n\t\t\t--noise5-primary-note: #5588af;\n\t\t\t--mod1-secondary-channel: #3e336c;\n\t\t\t--mod1-primary-channel: #6d60a4;\n\t\t\t--mod1-secondary-note: #3e336c;\n\t\t\t--mod1-primary-note: #6d60a4;\n\t\t\t--mod2-secondary-channel: #716791;\n\t\t\t--mod2-primary-channel: #bdbed3;\n\t\t\t--mod2-secondary-note: #716791;\n\t\t\t--mod2-primary-note: #bdbed3;\n\t\t\t--mod3-secondary-channel: #6b91bd;\n\t\t\t--mod3-primary-channel: #4b8fdd;\n\t\t\t--mod3-secondary-note: #597ca7;\n\t\t\t--mod3-primary-note: #7eade3;\n\t\t\t--mod4-secondary-channel: #14559f;\n\t\t\t--mod4-primary-channel: #3386e6;\n\t\t\t--mod4-secondary-note: #14559f;\n\t\t\t--mod4-primary-note: #3386e6;\n\t\t\t--mod-label-primary: #1e2940;\n\t\t\t--mod-label-secondary-text: #748ebe;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #828282;\n\t\t\t--disabled-note-secondary: #4f4f4f;\n\t\t\t}", autumn: "\n\t\t:root {\n\t\t\t--page-margin: #060304;\n\t\t\t--editor-background: #060304;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #999;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgb(115 80 76);\n\t\t\t--box-selection-fill: rgb(174 73 81 / 45%);\n\t\t\t--loop-accent: #834A69;\n\t\t\t--link-accent: #98f;\n\t\t\t--ui-widget-background: #2a2523;\n\t\t\t--ui-widget-focus: #4e4c44;\n\t\t\t--pitch-background: #121212;\n\t\t\t--tonic: #4f4f4f;\n\t\t\t--fifth-note: #222;\n\t\t\t--white-piano-key: #b59b9b;\n\t\t\t--black-piano-key: #231e1e;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #352f38;\n\t\t\t--track-editor-bg-pitch-dim: #232025;\n\t\t\t--track-editor-bg-noise: #3c3029;\n\t\t\t--track-editor-bg-noise-dim: #251d19;\n\t\t\t--track-editor-bg-mod: #202623;\n\t\t\t--track-editor-bg-mod-dim: #131715;\n\t\t\t--multiplicative-mod-slider: #D9D16E;\n\t\t\t--overwriting-mod-slider: #2D826F;\n\t\t\t--indicator-primary: #D9D16E;\n\t\t\t--indicator-secondary: #444226;\n\t\t\t--select2-opt-group: #20191c;\n\t\t\t--input-box-outline: #20191c;\n\t\t\t--mute-button-normal: var(--pitch2-primary-channel);\n\t\t\t--mute-button-mod: var(--pitch4-primary-channel);\n\t\t\t--pitch1-secondary-channel: #704a34;\n\t\t\t--pitch1-primary-channel: #D9895A;\n\t\t\t--pitch1-secondary-note: #704a34;\n\t\t\t--pitch1-primary-note: #D9895A;\n\t\t\t--pitch2-secondary-channel: #5f3538;\n\t\t\t--pitch2-primary-channel: #AE4951;\n\t\t\t--pitch2-secondary-note: #5f3538;\n\t\t\t--pitch2-primary-note: #AE4951;\n\t\t\t--pitch3-secondary-channel: #5c4336;\n\t\t\t--pitch3-primary-channel: #CA9A81;\n\t\t\t--pitch3-secondary-note: #5c4336;\n\t\t\t--pitch3-primary-note: #CA9A81;\n\t\t\t--pitch4-secondary-channel: #1d3143;\n\t\t\t--pitch4-primary-channel: #386995;\n\t\t\t--pitch4-secondary-note: #1d3143;\n\t\t\t--pitch4-primary-note: #386995;\n\t\t\t--pitch5-secondary-channel: #9c8a58;\n\t\t\t--pitch5-primary-channel: #D9D16E;\n\t\t\t--pitch5-secondary-note: #7c783f;\n\t\t\t--pitch5-primary-note: #D9D16E;\n\t\t\t--pitch6-secondary-channel: #886562;\n\t\t\t--pitch6-primary-channel: #D3A9A5;\n\t\t\t--pitch6-secondary-note: #886562;\n\t\t\t--pitch6-primary-note: #D3A9A5;\n\t\t\t--pitch7-secondary-channel: #1c3f37;\n\t\t\t--pitch7-primary-channel: #2D826F;\n\t\t\t--pitch7-secondary-note: #1c3f37;\n\t\t\t--pitch7-primary-note: #2D826F;\n\t\t\t--pitch8-secondary-channel: #442e2d;\n\t\t\t--pitch8-primary-channel: #815150;\n\t\t\t--pitch8-secondary-note: #442e2d;\n\t\t\t--pitch8-primary-note: #815150;\n\t\t\t--pitch9-secondary-channel: #8e6f60;\n\t\t\t--pitch9-primary-channel: #E5B8A1;\n\t\t\t--pitch9-secondary-note: #8e6f60;\n\t\t\t--pitch9-primary-note: #E5B8A1;\n\t\t\t--pitch10-secondary-channel: #4f3142;\n\t\t\t--pitch10-primary-channel: #834A69;\n\t\t\t--pitch10-secondary-note: #4f3142;\n\t\t\t--pitch10-primary-note: #834A69;\n\t\t\t--noise1-secondary-channel: #6b5346;\n\t\t\t--noise1-primary-channel: #b99c89;\n\t\t\t--noise1-secondary-note: #6b5346;\n\t\t\t--noise1-primary-note: #F0D0BB;\n\t\t\t--noise2-secondary-channel: #4a3839;\n\t\t\t--noise2-primary-channel: #9c6b6e;\n\t\t\t--noise2-secondary-note: #4a3839;\n\t\t\t--noise2-primary-note: #c18b8f;\n\t\t\t--noise3-secondary-channel: #2d3c4a;\n\t\t\t--noise3-primary-channel: #536e86;\n\t\t\t--noise3-secondary-note: #2d3c4a;\n\t\t\t--noise3-primary-note: #8fa8c0;\n\t\t\t--noise4-secondary-channel: #273f3a;\n\t\t\t--noise4-primary-channel: #4e8377;\n\t\t\t--noise4-secondary-note: #273f3a;\n\t\t\t--noise4-primary-note: #87baae;\n\t\t\t--noise5-secondary-channel: #372730;\n\t\t\t--noise5-primary-channel: #7f5e70;\n\t\t\t--noise5-secondary-note: #372730;\n\t\t\t--noise5-primary-note: #cc96b3;\n\t\t\t--mod1-secondary-channel: #783f1f;\n\t\t\t--mod1-primary-channel: #dc6d2c;\n\t\t\t--mod1-secondary-note: #783f1f;\n\t\t\t--mod1-primary-note: #dc6d2c;\n\t\t\t--mod2-secondary-channel: #0b3153;\n\t\t\t--mod2-primary-channel: #1464ac;\n\t\t\t--mod2-secondary-note: #0b3153;\n\t\t\t--mod2-primary-note: #1464ac;\n\t\t\t--mod3-secondary-channel: #075040;\n\t\t\t--mod3-primary-channel: #08a17f;\n\t\t\t--mod3-secondary-note: #075040;\n\t\t\t--mod3-primary-note: #08a17f;\n\t\t\t--mod4-secondary-channel: #631640;\n\t\t\t--mod4-primary-channel: #b4186d;\n\t\t\t--mod4-secondary-note: #631640;\n\t\t\t--mod4-primary-note: #b4186d;\n\t\t\t--mod-label-primary: #000;\n\t\t\t--mod-label-secondary-text: #707070;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #5d5d5d;\n\t\t\t--disabled-note-secondary: #292929;\n\t\t}", fruit: "\n\t\t:root {\n\t\t\t--page-margin: #040507;\n\t\t\t--editor-background: #040507;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #999;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgb(115 103 76);\n\t\t\t--box-selection-fill: rgb(174 109 73 / 45%);\n\t\t\t--loop-accent: #EC897D;\n\t\t\t--link-accent: #FDE484;\n\t\t\t--ui-widget-background: #22222c;\n\t\t\t--ui-widget-focus: #39394c;\n\t\t\t--pitch-background: #101010;\n\t\t\t--tonic: #2c2d34;\n\t\t\t--fifth-note: #191a20;\n\t\t\t--white-piano-key: #bbbaba;\n\t\t\t--black-piano-key: #2d2d2d;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #2b2d40;\n\t\t\t--track-editor-bg-pitch-dim: #191a25;\n\t\t\t--track-editor-bg-noise: #3c3644;\n\t\t\t--track-editor-bg-noise-dim: #26222b;\n\t\t\t--track-editor-bg-mod: #322a2a;\n\t\t\t--track-editor-bg-mod-dim: #191515;\n\t\t\t--multiplicative-mod-slider: #977da9;\n\t\t\t--overwriting-mod-slider: #798FA7;\n\t\t\t--indicator-primary: #EAAC9D;\n\t\t\t--indicator-secondary: #5e413a;\n\t\t\t--select2-opt-group: #191920;\n\t\t\t--input-box-outline: #191920;\n\t\t\t--mute-button-normal: #798FA7;\n\t\t\t--mute-button-mod: #354457;\n\t\t\t--pitch1-secondary-channel: #91655a;\n\t\t\t--pitch1-primary-channel: #EAAC9D;\n\t\t\t--pitch1-secondary-note: #91655a;\n\t\t\t--pitch1-primary-note: #EAAC9D;\n\t\t\t--pitch2-secondary-channel: #8f6513;\n\t\t\t--pitch2-primary-channel: #FFAF12;\n\t\t\t--pitch2-secondary-note: #8f6513;\n\t\t\t--pitch2-primary-note: #FFAF12;\n\t\t\t--pitch3-secondary-channel: #212f46;\n\t\t\t--pitch3-primary-channel: #34558B;\n\t\t\t--pitch3-secondary-note: #212f46;\n\t\t\t--pitch3-primary-note: #34558B;\n\t\t\t--pitch4-secondary-channel: #2e6b5b;\n\t\t\t--pitch4-primary-channel: #4EC5A7;\n\t\t\t--pitch4-secondary-note: #2e6b5b;\n\t\t\t--pitch4-primary-note: #4EC5A7;\n\t\t\t--pitch5-secondary-channel: #555D46;\n\t\t\t--pitch5-primary-channel: #aabf84;\n\t\t\t--pitch5-secondary-note: #555D46;\n\t\t\t--pitch5-primary-note: #aabf84;\n\t\t\t--pitch6-secondary-channel: #A2553B;\n\t\t\t--pitch6-primary-channel: #e59a81;\n\t\t\t--pitch6-secondary-note: #A2553B;\n\t\t\t--pitch6-primary-note: #e59a81;\n\t\t\t--pitch7-secondary-channel: #7b4021;\n\t\t\t--pitch7-primary-channel: #FE813E;\n\t\t\t--pitch7-secondary-note: #7b4021;\n\t\t\t--pitch7-primary-note: #FE813E;\n\t\t\t--pitch8-secondary-channel: #847753;\n\t\t\t--pitch8-primary-channel: #EFDAA3;\n\t\t\t--pitch8-secondary-note: #847753;\n\t\t\t--pitch8-primary-note: #EFDAA3;\n\t\t\t--pitch9-secondary-channel: #2c3642;\n\t\t\t--pitch9-primary-channel: #798FA7;\n\t\t\t--pitch9-secondary-note: #2c3642;\n\t\t\t--pitch9-primary-note: #798FA7;\n\t\t\t--pitch10-secondary-channel: #0d4453;\n\t\t\t--pitch10-primary-channel: #107895;\n\t\t\t--pitch10-secondary-note: #0d4453;\n\t\t\t--pitch10-primary-note: #107895;\n\t\t\t--noise1-secondary-channel: #71617C;\n\t\t\t--noise1-primary-channel: #977da9;\n\t\t\t--noise1-secondary-note: #71617C;\n\t\t\t--noise1-primary-note: #977da9;\n\t\t\t--noise2-secondary-channel: #3B3D4A;\n\t\t\t--noise2-primary-channel: #707591;\n\t\t\t--noise2-secondary-note: #3B3D4A;\n\t\t\t--noise2-primary-note: #707591;\n\t\t\t--noise3-secondary-channel: #625f5e;\n\t\t\t--noise3-primary-channel: #A19D9C;\n\t\t\t--noise3-secondary-note: #625f5e;\n\t\t\t--noise3-primary-note: #A19D9C;\n\t\t\t--noise4-secondary-channel: #ab847b;\n\t\t\t--noise4-primary-channel: #EAAC9D;\n\t\t\t--noise4-secondary-note: #ab847b;\n\t\t\t--noise4-primary-note: #EAAC9D;\n\t\t\t--noise5-secondary-channel: #B49D74;\n\t\t\t--noise5-primary-channel: #dec69b;\n\t\t\t--noise5-secondary-note: #B49D74;\n\t\t\t--noise5-primary-note: #dec69b;\n\t\t\t--mod1-secondary-channel: #722124;\n\t\t\t--mod1-primary-channel: #D13A41;\n\t\t\t--mod1-secondary-note: #722124;\n\t\t\t--mod1-primary-note: #D13A41;\n\t\t\t--mod2-secondary-channel: #213657;\n\t\t\t--mod2-primary-channel: #34558B;\n\t\t\t--mod2-secondary-note: #213657;\n\t\t\t--mod2-primary-note: #34558B;\n\t\t\t--mod3-secondary-channel: #555D46;\n\t\t\t--mod3-primary-channel: #848f6d;\n\t\t\t--mod3-secondary-note: #555D46;\n\t\t\t--mod3-primary-note: #848f6d;\n\t\t\t--mod4-secondary-channel: #71617C;\n\t\t\t--mod4-primary-channel: #a68ab9;\n\t\t\t--mod4-secondary-note: #71617C;\n\t\t\t--mod4-primary-note: #a68ab9;\n\t\t\t--mod-label-primary: #282828;\n\t\t\t--mod-label-secondary-text: #707070;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #5d5d5d;\n\t\t\t--disabled-note-secondary: #292929;\n\t\t}", sunset: "\n\t\t:root {\n\t\t\t--page-margin: #040300;\n\t\t\t--editor-background: #040300;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #999;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgb(94 0 157);\n\t\t\t--box-selection-fill: rgb(174 173 73 / 45%);\n\t\t\t--loop-accent: #EC897D;\n\t\t\t--link-accent: #FDE484;\n\t\t\t--ui-widget-background: #241b24;\n\t\t\t--ui-widget-focus: #3a2e39;\n\t\t\t--pitch-background: #141414;\n\t\t\t--tonic: #2C212B;\n\t\t\t--fifth-note: #2E2A15;\n\t\t\t--white-piano-key: #bbbaba;\n\t\t\t--black-piano-key: #2d2d2d;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #2d2e42;\n\t\t\t--track-editor-bg-pitch-dim: #191a25;\n\t\t\t--track-editor-bg-noise: #393340;\n\t\t\t--track-editor-bg-noise-dim: #26222b;\n\t\t\t--track-editor-bg-mod: #232a2c;\n\t\t\t--track-editor-bg-mod-dim: #151819;\n\t\t\t--multiplicative-mod-slider: #977da9;\n\t\t\t--overwriting-mod-slider: #798FA7;\n\t\t\t--indicator-primary: #F28891;\n\t\t\t--indicator-secondary: #601d23;\n\t\t\t--select2-opt-group: #151015;\n\t\t\t--input-box-outline: #151015;\n\t\t\t--mute-button-normal: #E4739D;\n\t\t\t--mute-button-mod: #9650A6;\n\t\t\t--pitch1-secondary-channel: #7F7721;\n\t\t\t--pitch1-primary-channel: #F3E79A;\n\t\t\t--pitch1-secondary-note: #7F7721;\n\t\t\t--pitch1-primary-note: #F3E79A;\n\t\t\t--pitch2-secondary-channel: #785E20;\n\t\t\t--pitch2-primary-channel: #F7D086;\n\t\t\t--pitch2-secondary-note: #785E20;\n\t\t\t--pitch2-primary-note: #F7D086;\n\t\t\t--pitch3-secondary-channel: #6E4219;\n\t\t\t--pitch3-primary-channel: #F9B881;\n\t\t\t--pitch3-secondary-note: #6E4219;\n\t\t\t--pitch3-primary-note: #F9B881;\n\t\t\t--pitch4-secondary-channel: #79351F;\n\t\t\t--pitch4-primary-channel: #F7A086;\n\t\t\t--pitch4-secondary-note: #79351F;\n\t\t\t--pitch4-primary-note: #F7A086;\n\t\t\t--pitch5-secondary-channel: #81272F;\n\t\t\t--pitch5-primary-channel: #F28891;\n\t\t\t--pitch5-secondary-note: #81272F;\n\t\t\t--pitch5-primary-note: #F28891;\n\t\t\t--pitch6-secondary-channel: #8F224D;\n\t\t\t--pitch6-primary-channel: #E4739D;\n\t\t\t--pitch6-secondary-note: #8F224D;\n\t\t\t--pitch6-primary-note: #E4739D;\n\t\t\t--pitch7-secondary-channel: #611548;\n\t\t\t--pitch7-primary-channel: #CF63A6;\n\t\t\t--pitch7-secondary-note: #611548;\n\t\t\t--pitch7-primary-note: #CF63A6;\n\t\t\t--pitch8-secondary-channel: #561253;\n\t\t\t--pitch8-primary-channel: #B557A9;\n\t\t\t--pitch8-secondary-note: #4D104A;\n\t\t\t--pitch8-primary-note: #B557A9;\n\t\t\t--pitch9-secondary-channel: #4c1260;\n\t\t\t--pitch9-primary-channel: #9650A6;\n\t\t\t--pitch9-secondary-note: #3C0F4C;\n\t\t\t--pitch9-primary-note: #9650A6;\n\t\t\t--pitch10-secondary-channel: #3e1d78;\n\t\t\t--pitch10-primary-channel: #704D9E;\n\t\t\t--pitch10-secondary-note: #27124C;\n\t\t\t--pitch10-primary-note: #704D9E;\n\t\t\t--noise1-secondary-channel: #A7A578;\n\t\t\t--noise1-primary-channel: #EFE9AC;\n\t\t\t--noise1-secondary-note: #A7A578;\n\t\t\t--noise1-primary-note: #EFE9AC;\n\t\t\t--noise2-secondary-channel: #947A5F;\n\t\t\t--noise2-primary-channel: #FBCEA8;\n\t\t\t--noise2-secondary-note: #947A5F;\n\t\t\t--noise2-primary-note: #FBCEA8;\n\t\t\t--noise3-secondary-channel: #A3635D;\n\t\t\t--noise3-primary-channel: #F4A5AB;\n\t\t\t--noise3-secondary-note: #A3635D;\n\t\t\t--noise3-primary-note: #F4A5AB;\n\t\t\t--noise4-secondary-channel: #724D60;\n\t\t\t--noise4-primary-channel: #CD90B6;\n\t\t\t--noise4-secondary-note: #724D60;\n\t\t\t--noise4-primary-note: #CD90B6;\n\t\t\t--noise5-secondary-channel: #503F5C;\n\t\t\t--noise5-primary-channel: #7C6A9E;\n\t\t\t--noise5-secondary-note: #503F5C;\n\t\t\t--noise5-primary-note: #7C6A9E;\n\t\t\t--mod1-secondary-channel: #371883;\n\t\t\t--mod1-primary-channel: #6416C6;\n\t\t\t--mod1-secondary-note: #1F0A52;\n\t\t\t--mod1-primary-note: #6416C6;\n\t\t\t--mod2-secondary-channel: #690645;\n\t\t\t--mod2-primary-channel: #E52FA2;\n\t\t\t--mod2-secondary-note: #690645;\n\t\t\t--mod2-primary-note: #E52FA2;\n\t\t\t--mod3-secondary-channel: #943618;\n\t\t\t--mod3-primary-channel: #eb5b2c;\n\t\t\t--mod3-secondary-note: #943618;\n\t\t\t--mod3-primary-note: #eb5b2c;\n\t\t\t--mod4-secondary-channel: #928409;\n\t\t\t--mod4-primary-channel: #ecd50e;\n\t\t\t--mod4-secondary-note: #928409;\n\t\t\t--mod4-primary-note: #ecd50e;\n\t\t\t--mod-label-primary: #282828;\n\t\t\t--mod-label-secondary-text: #707070;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #5d5d5d;\n\t\t\t--disabled-note-secondary: #292929;\n\t\t}", toxic: "\n\t\t:root {\n\t\t\t--page-margin: #010003;\n\t\t\t--editor-background: #010003;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #999;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgb(147 195 0);\n\t\t\t--box-selection-fill: rgb(145 174 73 / 49%);\n\t\t\t--loop-accent: #BCDE2C;\n\t\t\t--link-accent: #edff9f;\n\t\t\t--ui-widget-background: #261e2e;\n\t\t\t--ui-widget-focus: #322042;\n\t\t\t--pitch-background: #141c15;\n\t\t\t--tonic: #282c21;\n\t\t\t--fifth-note: #18221a;\n\t\t\t--white-piano-key: #e3e3e3;\n\t\t\t--black-piano-key: #2d2d2d;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #38293e;\n\t\t\t--track-editor-bg-pitch-dim: #251c29;\n\t\t\t--track-editor-bg-noise: #2c304c;\n\t\t\t--track-editor-bg-noise-dim: #191b2b;\n\t\t\t--track-editor-bg-mod: #311b32;\n\t\t\t--track-editor-bg-mod-dim: #1d101e;\n\t\t\t--multiplicative-mod-slider: #977da9;\n\t\t\t--overwriting-mod-slider: #798FA7;\n\t\t\t--indicator-primary: #aae9ff;\n\t\t\t--indicator-secondary: #253e46;\n\t\t\t--select2-opt-group: #110d15;\n\t\t\t--input-box-outline: #110d15;\n\t\t\t--mute-button-normal: #8f5ad1;\n\t\t\t--mute-button-mod: #482574;\n\t\t\t--pitch1-secondary-channel: #6b7f19;\n\t\t\t--pitch1-primary-channel: #BCDE2C;\n\t\t\t--pitch1-secondary-note: #6b7f19;\n\t\t\t--pitch1-primary-note: #BCDE2C;\n\t\t\t--pitch2-secondary-channel: #497a31;\n\t\t\t--pitch2-primary-channel: #7BD152;\n\t\t\t--pitch2-secondary-note: #497a31;\n\t\t\t--pitch2-primary-note: #7BD152;\n\t\t\t--pitch3-secondary-channel: #286b40;\n\t\t\t--pitch3-primary-channel: #45BE71;\n\t\t\t--pitch3-secondary-note: #286b40;\n\t\t\t--pitch3-primary-note: #45BE71;\n\t\t\t--pitch4-secondary-channel: #125140;\n\t\t\t--pitch4-primary-channel: #25A884;\n\t\t\t--pitch4-secondary-note: #125140;\n\t\t\t--pitch4-primary-note: #25A884;\n\t\t\t--pitch5-secondary-channel: #114c49;\n\t\t\t--pitch5-primary-channel: #21908C;\n\t\t\t--pitch5-secondary-note: #114c49;\n\t\t\t--pitch5-primary-note: #21908C;\n\t\t\t--pitch6-secondary-channel: #143843;\n\t\t\t--pitch6-primary-channel: #2B788E;\n\t\t\t--pitch6-secondary-note: #143843;\n\t\t\t--pitch6-primary-note: #2B788E;\n\t\t\t--pitch7-secondary-channel: #1d354e;\n\t\t\t--pitch7-primary-channel: #355F8D;\n\t\t\t--pitch7-secondary-note: #1a2f46;\n\t\t\t--pitch7-primary-note: #355F8D;\n\t\t\t--pitch8-secondary-channel: #2c2e5a;\n\t\t\t--pitch8-primary-channel: #414486;\n\t\t\t--pitch8-secondary-note: #1e1f3d;\n\t\t\t--pitch8-primary-note: #414486;\n\t\t\t--pitch9-secondary-channel: #3c1f5e;\n\t\t\t--pitch9-primary-channel: #5e3b89;\n\t\t\t--pitch9-secondary-note: #25133b;\n\t\t\t--pitch9-primary-note: #5e3b89;\n\t\t\t--pitch10-secondary-channel: #510264;\n\t\t\t--pitch10-primary-channel: #720d8a;\n\t\t\t--pitch10-secondary-note: #440154;\n\t\t\t--pitch10-primary-note: #720d8a;\n\t\t\t--noise1-secondary-channel: #BCDE2C;\n\t\t\t--noise1-primary-channel: #edff9f;\n\t\t\t--noise1-secondary-note: #BCDE2C;\n\t\t\t--noise1-primary-note: #edff9f;\n\t\t\t--noise2-secondary-channel: #45BE71;\n\t\t\t--noise2-primary-channel: #89ffb4;\n\t\t\t--noise2-secondary-note: #45BE71;\n\t\t\t--noise2-primary-note: #89ffb4;\n\t\t\t--noise3-secondary-channel: #21908C;\n\t\t\t--noise3-primary-channel: #72fffa;\n\t\t\t--noise3-secondary-note: #21908C;\n\t\t\t--noise3-primary-note: #72fffa;\n\t\t\t--noise4-secondary-channel: #355F8D;\n\t\t\t--noise4-primary-channel: #7cb6f5;\n\t\t\t--noise4-secondary-note: #355F8D;\n\t\t\t--noise4-primary-note: #7cb6f5;\n\t\t\t--noise5-secondary-channel: #482574;\n\t\t\t--noise5-primary-channel: #8f5ad1;\n\t\t\t--noise5-secondary-note: #48257A;\n\t\t\t--noise5-primary-note: #8f5ad1;\n\t\t\t--mod1-secondary-channel: #815a16;\n\t\t\t--mod1-primary-channel: #F5AB29;\n\t\t\t--mod1-secondary-note: #815a16;\n\t\t\t--mod1-primary-note: #F5AB29;\n\t\t\t--mod2-secondary-channel: #4d341a;\n\t\t\t--mod2-primary-channel: #C98540;\n\t\t\t--mod2-secondary-note: #4d341a;\n\t\t\t--mod2-primary-note: #C98540;\n\t\t\t--mod3-secondary-channel: #643734;\n\t\t\t--mod3-primary-channel: #A75D58;\n\t\t\t--mod3-secondary-note: #643734;\n\t\t\t--mod3-primary-note: #A75D58;\n\t\t\t--mod4-secondary-channel: #461430;\n\t\t\t--mod4-primary-channel: #812359;\n\t\t\t--mod4-secondary-note: #3f112b;\n\t\t\t--mod4-primary-note: #812359;\n\t\t\t--mod-label-primary: #282828;\n\t\t\t--mod-label-secondary-text: #707070;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #5d5d5d;\n\t\t\t--disabled-note-secondary: #292929;\n\t\t}", "violet verdant": "\n\t\t:root {\n\t\t\t--page-margin: #0e031a;\n\t\t\t--editor-background: #0e031a;\n\t\t\t--hover-preview: #e5ffea;\n\t\t\t--playhead: rgba(255, 255, 255, 0.9);\n\t\t\t--primary-text: #f0e0ff;\n\t\t\t--secondary-text: #706087;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgba(119,68,255,0.99);\n\t\t\t--box-selection-fill: #225835;\n\t\t\t--loop-accent: #8f00fb;\n\t\t\t--link-accent: #82dd5d;\n\t\t\t--ui-widget-background: #303c66;\n\t\t\t--ui-widget-focus: #62559b;\n\t\t\t--pitch-background: #293b52;\n\t\t\t--tonic: #5b46ad;\n\t\t\t--fifth-note: #42604d;\n\t\t\t--white-piano-key: #f6e8ff;\n\t\t\t--black-piano-key: #5a4972;\n\t\t\t--use-color-formula: true;\n\t\t\t--track-editor-bg-pitch: #392a46;\n\t\t\t--track-editor-bg-pitch-dim: #1c1d28;\n\t\t\t--track-editor-bg-noise: #403150;\n\t\t\t--track-editor-bg-noise-dim: #161313;\n\t\t\t--track-editor-bg-mod: #253c25;\n\t\t\t--track-editor-bg-mod-dim: #0c1811;\n\t\t\t--multiplicative-mod-slider: #606c9f;\n\t\t\t--overwriting-mod-slider: #6850b5;\n\t\t\t--indicator-primary: #9c64f7;\n\t\t\t--indicator-secondary: #393e4f;\n\t\t\t--select2-opt-group: #5d576f;\n\t\t\t--input-box-outline: #403150;\n\t\t\t--mute-button-normal: #82dd5d;\n\t\t\t--mute-button-mod: #945de5;\n\t\t\t--mod-label-primary: #312840;\n\t\t\t--mod-label-secondary-text: rgb(88 70 104);\n\t\t\t--mod-label-primary-text: #82dd5d;\n\t\t\t--pitch-secondary-channel-hue: 64;\n\t\t\t--pitch-secondary-channel-hue-scale: 6.1;\n\t\t\t--pitch-secondary-channel-sat: 63.3;\n\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t--pitch-secondary-channel-lum: 40;\n\t\t\t--pitch-secondary-channel-lum-scale: 0.05;\n\t\t\t--pitch-primary-channel-hue: 64;\n\t\t\t--pitch-primary-channel-hue-scale: 6.1;\n\t\t\t--pitch-primary-channel-sat: 90;\n\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t--pitch-primary-channel-lum: 67.5;\n\t\t\t--pitch-primary-channel-lum-scale: 0.05;\n\t\t\t--pitch-secondary-note-hue: 32;\n\t\t\t--pitch-secondary-note-hue-scale: 6.1;\n\t\t\t--pitch-secondary-note-sat: 87.9;\n\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t--pitch-secondary-note-lum: 25;\n\t\t\t--pitch-secondary-note-lum-scale: 0.05;\n\t\t\t--pitch-primary-note-hue: 64;\n\t\t\t--pitch-primary-note-hue-scale: 6.1;\n\t\t\t--pitch-primary-note-sat: 90;\n\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t--pitch-primary-note-lum: 85.6;\n\t\t\t--pitch-primary-note-lum-scale: 0.025;\n\t\t\t--noise-secondary-channel-hue: 192;\n\t\t\t--noise-secondary-channel-hue-scale: 2;\n\t\t\t--noise-secondary-channel-sat: 45;\n\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t--noise-secondary-channel-lum: 32;\n\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t--noise-primary-channel-hue: 192;\n\t\t\t--noise-primary-channel-hue-scale: 2;\n\t\t\t--noise-primary-channel-sat: 33;\n\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t--noise-primary-channel-lum: 43.5;\n\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t--noise-secondary-note-hue: 160;\n\t\t\t--noise-secondary-note-hue-scale: 2;\n\t\t\t--noise-secondary-note-sat: 33.5;\n\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t--noise-secondary-note-lum: 45;\n\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t--noise-primary-note-hue: 192;\n\t\t\t--noise-primary-note-hue-scale: 2;\n\t\t\t--noise-primary-note-sat: 46.5;\n\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t--noise-primary-note-lum: 74;\n\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t--mod-secondary-channel-hue: 132;\n\t\t\t--mod-secondary-channel-hue-scale: 1.5;\n\t\t\t--mod-secondary-channel-sat: 88;\n\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t--mod-secondary-channel-lum: 50;\n\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t--mod-primary-channel-hue: 132;\n\t\t\t--mod-primary-channel-hue-scale: 1.5;\n\t\t\t--mod-primary-channel-sat: 96;\n\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t--mod-primary-channel-lum: 80;\n\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t--mod-secondary-note-hue: 100;\n\t\t\t--mod-secondary-note-hue-scale: 1.5;\n\t\t\t--mod-secondary-note-sat: 92;\n\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t--mod-secondary-note-lum: 45;\n\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t--mod-primary-note-hue: 132;\n\t\t\t--mod-primary-note-hue-scale: 1.5;\n\t\t\t--mod-primary-note-sat: 96;\n\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t--mod-primary-note-lum: 85;\n\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t--disabled-note-primary: #91879f;\n\t\t\t--disabled-note-secondary: #6a677a;\n\t\t}", portal: "\n\t\t:root {\n\t\t\t--page-margin: #04081a;\n\t\t\t--editor-background: #04081a;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #999;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgba(119,68,255,0.99);\n\t\t\t--box-selection-fill: rgb(0 72 181);\n\t\t\t--loop-accent: #44d4ff;\n\t\t\t--link-accent: #ffa500;\n\t\t\t--ui-widget-background: #212c4a;\n\t\t\t--ui-widget-focus: #121f42;\n\t\t\t--pitch-background: #1b263e;\n\t\t\t--tonic: #995d00;\n\t\t\t--fifth-note: #0898a1;\n\t\t\t--white-piano-key: #ffffff;\n\t\t\t--black-piano-key: #516d7a;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #213352;\n\t\t\t--track-editor-bg-pitch-dim: #152032;\n\t\t\t--track-editor-bg-noise: #403524;\n\t\t\t--track-editor-bg-noise-dim: #2a1f0e;\n\t\t\t--track-editor-bg-mod: #234;\n\t\t\t--track-editor-bg-mod-dim: #123;\n\t\t\t--multiplicative-mod-slider: #456;\n\t\t\t--overwriting-mod-slider: #654;\n\t\t\t--indicator-primary: #5490ff;\n\t\t\t--indicator-secondary: #444;\n\t\t\t--select2-opt-group: #585858;\n\t\t\t--input-box-outline: #333;\n\t\t\t--mute-button-normal: #3372ff;\n\t\t\t--mute-button-mod: #dd872f;\n\t\t\t--pitch1-secondary-channel: #0099A1;\n\t\t\t--pitch1-primary-channel: #77f7ff;\n\t\t\t--pitch1-secondary-note: #00BDC7;\n\t\t\t--pitch1-primary-note: #92F9FF;\n\t\t\t--pitch2-secondary-channel: #0083a1;\n\t\t\t--pitch2-primary-channel: #35d9ff;\n\t\t\t--pitch2-secondary-note: #0083a1;\n\t\t\t--pitch2-primary-note: #a4eeff;\n\t\t\t--pitch3-secondary-channel: #0074c7;\n\t\t\t--pitch3-primary-channel: #3caeff;\n\t\t\t--pitch3-secondary-note: #00477a;\n\t\t\t--pitch3-primary-note: #aadcff;\n\t\t\t--pitch4-secondary-channel: #0039a1;\n\t\t\t--pitch4-primary-channel: #2673ff;\n\t\t\t--pitch4-secondary-note: #001f56;\n\t\t\t--pitch4-primary-note: #9bbeff;\n\t\t\t--pitch5-secondary-channel: #31148b;\n\t\t\t--pitch5-primary-channel: #7042ff;\n\t\t\t--pitch5-secondary-note: #190656;\n\t\t\t--pitch5-primary-note: #b79fff;\n\t\t\t--pitch6-secondary-channel: #979934;\n\t\t\t--pitch6-primary-channel: #fbff2f;\n\t\t\t--pitch6-secondary-note: #5d5e0a;\n\t\t\t--pitch6-primary-note: #fdff9a;\n\t\t\t--pitch7-secondary-channel: #b78f00;\n\t\t\t--pitch7-primary-channel: #ffd747;\n\t\t\t--pitch7-secondary-note: #5e3d00;\n\t\t\t--pitch7-primary-note: #ffe381;\n\t\t\t--pitch8-secondary-channel: #9d6500;\n\t\t\t--pitch8-primary-channel: #ffa400;\n\t\t\t--pitch8-secondary-note: #583900;\n\t\t\t--pitch8-primary-note: #ffd07c;\n\t\t\t--pitch9-secondary-channel: #744203;\n\t\t\t--pitch9-primary-channel: #ff8e00;\n\t\t\t--pitch9-secondary-note: #502d00;\n\t\t\t--pitch9-primary-note: #ffcb89;\n\t\t\t--pitch10-secondary-channel: #a32d00;\n\t\t\t--pitch10-primary-channel: #ff885b;\n\t\t\t--pitch10-secondary-note: #521700;\n\t\t\t--pitch10-primary-note: #ffb397;\n\t\t\t--noise1-secondary-channel: #6e2210;\n\t\t\t--noise1-primary-channel: #ff4600;\n\t\t\t--noise1-secondary-note: #4c1a08;\n\t\t\t--noise1-primary-note: #ffc9b4;\n\t\t\t--noise2-secondary-channel: #6a3110;\n\t\t\t--noise2-primary-channel: #ff782a;\n\t\t\t--noise2-secondary-note: #4c1f05;\n\t\t\t--noise2-primary-note: #ffb488;\n\t\t\t--noise3-secondary-channel: #72460e;\n\t\t\t--noise3-primary-channel: #d9871f;\n\t\t\t--noise3-secondary-note: #442905;\n\t\t\t--noise3-primary-note: #ffdcae;\n\t\t\t--noise4-secondary-channel: #837a0f;\n\t\t\t--noise4-primary-channel: #f7ea55;\n\t\t\t--noise4-secondary-note: #605906;\n\t\t\t--noise4-primary-note: #fff9ab;\n\t\t\t--noise5-secondary-channel: #8c8f00;\n\t\t\t--noise5-primary-channel: #fdff90;\n\t\t\t--noise5-secondary-note: #606200;\n\t\t\t--noise5-primary-note: #feffbc;\n\t\t\t--mod1-secondary-channel: #561b97;\n\t\t\t--mod1-primary-channel: #aa66f5;\n\t\t\t--mod1-secondary-note: #30075c;\n\t\t\t--mod1-primary-note: #cd9fff;\n\t\t\t--mod2-secondary-channel: #5116df;\n\t\t\t--mod2-primary-channel: #6b2dff;\n\t\t\t--mod2-secondary-note: #36138b;\n\t\t\t--mod2-primary-note: #bea3ff;\n\t\t\t--mod3-secondary-channel: #2535a1;\n\t\t\t--mod3-primary-channel: #3f57ff;\n\t\t\t--mod3-secondary-note: #0e185c;\n\t\t\t--mod3-primary-note: #8494ff;\n\t\t\t--mod4-secondary-channel: #1b5883;\n\t\t\t--mod4-primary-channel: #5eb7f5;\n\t\t\t--mod4-secondary-note: #072f4a;\n\t\t\t--mod4-primary-note: #63beff;\n\t\t\t--mod-label-primary: #24293a;\n\t\t\t--mod-label-secondary-text: #454d4e;\n\t\t\t--mod-label-primary-text: #7bd4ff;\n\t\t\t--disabled-note-primary: #072f4a;\n\t\t\t--disabled-note-secondary: #6585a7;\n\t\t}", fusion: ":root {\n\t\t\t--page-margin: #0c0306;\n\t\t\t--editor-background: #0c0306;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: white;\n\t\t\t--primary-text: #26d9cd;\n\t\t\t--secondary-text: #ff6666;\n\t\t\t--inverted-text: white;\n\t\t\t--text-selection: #ffffff;\n\t\t\t--box-selection-fill: #ff00004d;\n\t\t\t--loop-accent: #ff6666;\n\t\t\t--link-accent: white;\n\t\t\t--ui-widget-background: #232323;\n\t\t\t--ui-widget-focus: #303030;\n\t\t\t--pitch-background: hsl(61deg 100% 70% / 25%);\n\t\t\t--tonic: #66a3ff40;\n\t\t\t--fifth-note: #ff666640;\n\t\t\t--white-piano-key: #cdcdcd;\n\t\t\t--black-piano-key: #232323;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #404040bf;\n\t\t\t--track-editor-bg-pitch-dim: #151515;\n\t\t\t--track-editor-bg-noise: #404040bf;\n\t\t\t--track-editor-bg-noise-dim: #151515;\n\t\t\t--track-editor-bg-mod: #404040bf;\n\t\t\t--track-editor-bg-mod-dim: #151515;\n\t\t\t--multiplicative-mod-slider: #ef7692;\n\t\t\t--overwriting-mod-slider: #f43e69;\n\t\t\t--indicator-primary: #26d9cd;\n\t\t\t--indicator-secondary: hsl(176deg 70% 25%);\n\t\t\t--select2-opt-group: #232323;\n\t\t\t--input-box-outline: #141e34;\n\t\t\t--mute-button-normal: #26d9cd;\n\t\t\t--mute-button-mod: hsl(346deg 70% 50%);\n\t\t\t--pitch1-secondary-channel: #bf4040;\n\t\t\t--pitch1-primary-channel: #ff6666;\n\t\t\t--pitch1-secondary-note: #bf4040;\n\t\t\t--pitch1-primary-note: #ff6666;\n\t\t\t--pitch2-secondary-channel: #bf5b40;\n\t\t\t--pitch2-primary-channel: #ff8766;\n\t\t\t--pitch2-secondary-note: #bf5b40;\n\t\t\t--pitch2-primary-note: #ff8766;\n\t\t\t--pitch3-secondary-channel: #bf7940;\n\t\t\t--pitch3-primary-channel: #ffab66;\n\t\t\t--pitch3-secondary-note: #bf7940;\n\t\t\t--pitch3-primary-note: #ffab66;\n\t\t\t--pitch4-secondary-channel: #bf9b40;\n\t\t\t--pitch4-primary-channel: #ffd466;\n\t\t\t--pitch4-secondary-note: #bf9b40;\n\t\t\t--pitch4-primary-note: #ffd466;\n\t\t\t--pitch5-secondary-channel: #bdbf40;\n\t\t\t--pitch5-primary-channel: #fcff66;\n\t\t\t--pitch5-secondary-note: #bdbf40;\n\t\t\t--pitch5-primary-note: #fcff66;\n\t\t\t--pitch6-secondary-channel: #9dbf40;\n\t\t\t--pitch6-primary-channel: #d6ff66;\n\t\t\t--pitch6-secondary-note: #9dbf40;\n\t\t\t--pitch6-primary-note: #d6ff66;\n\t\t\t--pitch7-secondary-channel: #9dbf40;\n\t\t\t--pitch7-primary-channel: #fcff66;\n\t\t\t--pitch7-secondary-note: #9dbf40;\n\t\t\t--pitch7-primary-note: #fcff66;\n\t\t\t--pitch8-secondary-channel: #bf9b40;\n\t\t\t--pitch8-primary-channel: #ffd466;\n\t\t\t--pitch8-secondary-note: #bf9b40;\n\t\t\t--pitch8-primary-note: #ffd466;\n\t\t\t--pitch9-secondary-channel: #bf5b40;\n\t\t\t--pitch9-primary-channel: #ffab66;\n\t\t\t--pitch9-secondary-note: #bf5b40;\n\t\t\t--pitch9-primary-note: #ffab66;\n\t\t\t--pitch10-secondary-channel: #d15a1f;\n\t\t\t--pitch10-primary-channel: #ff8766;\n\t\t\t--pitch10-secondary-note: #d15a1f;\n\t\t\t--pitch10-primary-note: #ff8766;\n\t\t\t--noise1-secondary-channel: #4073bf;\n\t\t\t--noise1-primary-channel: #66a3ff;\n\t\t\t--noise1-secondary-note: #4073bf;\n\t\t\t--noise1-primary-note: #66a3ff;\n\t\t\t--noise2-secondary-channel: #405dbf;\n\t\t\t--noise2-primary-channel: #668aff;\n\t\t\t--noise2-secondary-note: #405dbf;\n\t\t\t--noise2-primary-note: #668aff;\n\t\t\t--noise3-secondary-channel: #4f40bf;\n\t\t\t--noise3-primary-channel: #7866ff;\n\t\t\t--noise3-secondary-note: #4f40bf;\n\t\t\t--noise3-primary-note: #7866ff;\n\t\t\t--noise4-secondary-channel: #8840bf;\n\t\t\t--noise4-primary-channel: #bd66ff;\n\t\t\t--noise4-secondary-note: #8840bf;\n\t\t\t--noise4-primary-note: #bd66ff;\n\t\t\t--noise5-secondary-channel: #bf40b5;\n\t\t\t--noise5-primary-channel: #ff66f2;\n\t\t\t--noise5-secondary-note: #bf40b5;\n\t\t\t--noise5-primary-note: #ff66f2;\n\t\t\t--mod1-secondary-channel: #cc6666;\n\t\t\t--mod1-primary-channel: #ff9999;\n\t\t\t--mod1-secondary-note: #cc6666;\n\t\t\t--mod1-primary-note: #ff9999;\n\t\t\t--mod2-secondary-channel: #cc7766;\n\t\t\t--mod2-primary-channel: #ffaa99;\n\t\t\t--mod2-secondary-note: #bf5540;\n\t\t\t--mod2-primary-note: #ffaa99;\n\t\t\t--mod3-secondary-channel: #cc8866;\n\t\t\t--mod3-primary-channel: #ffbb99;\n\t\t\t--mod3-secondary-note: #cc8866;\n\t\t\t--mod3-primary-note: #ffbb99;\n\t\t\t--mod4-secondary-channel: #cc9966;\n\t\t\t--mod4-primary-channel: #ffcc99;\n\t\t\t--mod4-secondary-note: #cc9966;\n\t\t\t--mod4-primary-note: #ffcc99;\n\t\t\t--mod-label-primary: #999;\n\t\t\t--mod-label-secondary-text: #333;\n\t\t\t--mod-label-primary-text: black;\n\t\t\t--disabled-note-primary: #696969;\n\t\t\t--disabled-note-secondary: #232323;\n\t\t}", inverse: ":root {\n\t\t\t--page-margin: #c4c8e3;\n\t\t\t--editor-background: #c4c8e3;\n\t\t\t--hover-preview: #000000;\n\t\t\t--playhead: #243953;\n\t\t\t--primary-text: black;\n\t\t\t--secondary-text: #855b95;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgb(132 125 255);\n\t\t\t--box-selection-fill: rgb(174 109 73 / 65%);\n\t\t\t--loop-accent: #EC897D;\n\t\t\t--link-accent: #4e00c8;\n\t\t\t--ui-widget-background: #e7e7ff;\n\t\t\t--ui-widget-focus: #d0d3e9;\n\t\t\t--pitch-background: #ffffff;\n\t\t\t--tonic: #bbbbbb;\n\t\t\t--fifth-note: #dcdcdc;\n\t\t\t--white-piano-key: #ffffff;\n\t\t\t--black-piano-key: #615f66;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #e9ebff;\n\t\t\t--track-editor-bg-pitch-dim: #e9ebff;\n\t\t\t--track-editor-bg-noise: #fdf2fe;\n\t\t\t--track-editor-bg-noise-dim: #fdf2fe;\n\t\t\t--track-editor-bg-mod: #dbdefe;\n\t\t\t--track-editor-bg-mod-dim: #dbdefe;\n\t\t\t--multiplicative-mod-slider: #6900b3;\n\t\t\t--overwriting-mod-slider: #004b9d;\n\t\t\t--indicator-primary: #ff633d;\n\t\t\t--indicator-secondary: #933822;\n\t\t\t--select2-opt-group: #e7e7ff;\n\t\t\t--input-box-outline: #e7e7ff;\n\t\t\t--mute-button-normal: #0072ef;\n\t\t\t--mute-button-mod: #002e67;\n\t\t\t--pitch1-secondary-channel: #b77d6e;\n\t\t\t--pitch1-primary-channel: #ff9d85;\n\t\t\t--pitch1-secondary-note: #b77d6e;\n\t\t\t--pitch1-primary-note: #ff9d85;\n\t\t\t--pitch2-secondary-channel: #be8821;\n\t\t\t--pitch2-primary-channel: #FFAF12;\n\t\t\t--pitch2-secondary-note: #be8821;\n\t\t\t--pitch2-primary-note: #FFAF12;\n\t\t\t--pitch3-secondary-channel: #3a62a4;\n\t\t\t--pitch3-primary-channel: #528ae6;\n\t\t\t--pitch3-secondary-note: #3a62a4;\n\t\t\t--pitch3-primary-note: #528ae6;\n\t\t\t--pitch4-secondary-channel: #3e8d78;\n\t\t\t--pitch4-primary-channel: #4EC5A7;\n\t\t\t--pitch4-secondary-note: #3e8d78;\n\t\t\t--pitch4-primary-note: #4EC5A7;\n\t\t\t--pitch5-secondary-channel: #84906d;\n\t\t\t--pitch5-primary-channel: #aabf84;\n\t\t\t--pitch5-secondary-note: #84906d;\n\t\t\t--pitch5-primary-note: #aabf84;\n\t\t\t--pitch6-secondary-channel: #bd6345;\n\t\t\t--pitch6-primary-channel: #e59a81;\n\t\t\t--pitch6-secondary-note: #bd6345;\n\t\t\t--pitch6-primary-note: #e59a81;\n\t\t\t--pitch7-secondary-channel: #aa592f;\n\t\t\t--pitch7-primary-channel: #FE813E;\n\t\t\t--pitch7-secondary-note: #aa592f;\n\t\t\t--pitch7-primary-note: #FE813E;\n\t\t\t--pitch8-secondary-channel: #b2a171;\n\t\t\t--pitch8-primary-channel: #ffd76d;\n\t\t\t--pitch8-secondary-note: #b2a171;\n\t\t\t--pitch8-primary-note: #ffd76d;\n\t\t\t--pitch9-secondary-channel: #4f6177;\n\t\t\t--pitch9-primary-channel: #798FA7;\n\t\t\t--pitch9-secondary-note: #4f6177;\n\t\t\t--pitch9-primary-note: #798FA7;\n\t\t\t--pitch10-secondary-channel: #165162;\n\t\t\t--pitch10-primary-channel: #107895;\n\t\t\t--pitch10-secondary-note: #165162;\n\t\t\t--pitch10-primary-note: #107895;\n\t\t\t--noise1-secondary-channel: #71617C;\n\t\t\t--noise1-primary-channel: #977da9;\n\t\t\t--noise1-secondary-note: #71617C;\n\t\t\t--noise1-primary-note: #977da9;\n\t\t\t--noise2-secondary-channel: #4a4c5b;\n\t\t\t--noise2-primary-channel: #707591;\n\t\t\t--noise2-secondary-note: #4a4c5b;\n\t\t\t--noise2-primary-note: #707591;\n\t\t\t--noise3-secondary-channel: #817c7b;\n\t\t\t--noise3-primary-channel: #A19D9C;\n\t\t\t--noise3-secondary-note: #817c7b;\n\t\t\t--noise3-primary-note: #A19D9C;\n\t\t\t--noise4-secondary-channel: #ab847b;\n\t\t\t--noise4-primary-channel: #EAAC9D;\n\t\t\t--noise4-secondary-note: #ab847b;\n\t\t\t--noise4-primary-note: #EAAC9D;\n\t\t\t--noise5-secondary-channel: #B49D74;\n\t\t\t--noise5-primary-channel: #dec69b;\n\t\t\t--noise5-secondary-note: #B49D74;\n\t\t\t--noise5-primary-note: #dec69b;\n\t\t\t--mod1-secondary-channel: #722124;\n\t\t\t--mod1-primary-channel: #D13A41;\n\t\t\t--mod1-secondary-note: #722124;\n\t\t\t--mod1-primary-note: #D13A41;\n\t\t\t--mod2-secondary-channel: #213657;\n\t\t\t--mod2-primary-channel: #34558B;\n\t\t\t--mod2-secondary-note: #213657;\n\t\t\t--mod2-primary-note: #34558B;\n\t\t\t--mod3-secondary-channel: #555D46;\n\t\t\t--mod3-primary-channel: #848f6d;\n\t\t\t--mod3-secondary-note: #555D46;\n\t\t\t--mod3-primary-note: #848f6d;\n\t\t\t--mod4-secondary-channel: #71617C;\n\t\t\t--mod4-primary-channel: #a68ab9;\n\t\t\t--mod4-secondary-note: #71617C;\n\t\t\t--mod4-primary-note: #a68ab9;\n\t\t\t--mod-label-primary: #e9e9e9;\n\t\t\t--mod-label-secondary-text: #707070;\n\t\t\t--mod-label-primary-text: black;\n\t\t\t--disabled-note-primary: #959595;\n\t\t\t--disabled-note-secondary: #6e6e6e;\n\t\t\t}", nebula: "\n\t\t:root {\n\t\t\t--page-margin: #040410;\n\t\t\t--editor-background: #150e1f;\n\t\t\t--hover-preview: white;\n\t\t\t--playhead: rgba(255, 255, 255, 0.9);\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #8C849A;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: rgba(141,79,201,0.99);\n\t\t\t--box-selection-fill: #311E44;\n\t\t\t--loop-accent: #CC688C;\n\t\t\t--link-accent: #817DC9;\n\t\t\t--ui-widget-background: #44394F;\n\t\t\t--ui-widget-focus: #7A6386;\n\t\t\t--pitch-background: #393e4f40;\n\t\t\t--tonic: #7D5C9EC0;\n\t\t\t--fifth-note: #ab77bd50;\n\t\t\t--white-piano-key: #EEEEEE;\n\t\t\t--black-piano-key: #5F5566;\n\t\t\t--use-color-formula: true;\n\t\t\t--track-editor-bg-pitch: #46374C;\n\t\t\t--track-editor-bg-pitch-dim: #1F1C2850;\n\t\t\t--track-editor-bg-noise: #3D353B;\n\t\t\t--track-editor-bg-noise-dim: #16131550;\n\t\t\t--track-editor-bg-mod: #623F4C;\n\t\t\t--track-editor-bg-mod-dim: #361A2450;\n\t\t\t--multiplicative-mod-slider: #9F6E6A;\n\t\t\t--overwriting-mod-slider: #A664B5;\n\t\t\t--indicator-primary: #CC6B8E;\n\t\t\t--indicator-secondary: #44394F;\n\t\t\t--select2-opt-group: #6A576F;\n\t\t\t--input-box-outline: #222;\n\t\t\t--mute-button-normal: #BF91DC;\n\t\t\t--mute-button-mod: #DC8C9A;\n\t\t\t--mod-label-primary: #3A2840;\n\t\t\t--mod-label-secondary-text: #62485E;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--pitch-secondary-channel-hue: -96;\n\t\t\t--pitch-secondary-channel-hue-scale: 4.2;\n\t\t\t--pitch-secondary-channel-sat: 50.3;\n\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t--pitch-secondary-channel-lum: 40;\n\t\t\t--pitch-secondary-channel-lum-scale: 0.05;\n\t\t\t--pitch-primary-channel-hue: -96;\n\t\t\t--pitch-primary-channel-hue-scale: 4.2;\n\t\t\t--pitch-primary-channel-sat: 70;\n\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t--pitch-primary-channel-lum: 67.5;\n\t\t\t--pitch-primary-channel-lum-scale: 0.05;\n\t\t\t--pitch-secondary-note-hue: -96;\n\t\t\t--pitch-secondary-note-hue-scale: 4.2;\n\t\t\t--pitch-secondary-note-sat: 70.9;\n\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t--pitch-secondary-note-lum: 25;\n\t\t\t--pitch-secondary-note-lum-scale: 0.05;\n\t\t\t--pitch-primary-note-hue: -96;\n\t\t\t--pitch-primary-note-hue-scale: 4.2;\n\t\t\t--pitch-primary-note-sat: 90;\n\t\t\t--pitch-primary-note-sat-scale: 0.05;\n\t\t\t--pitch-primary-note-lum: 85.6;\n\t\t\t--pitch-primary-note-lum-scale: 0.025;\n\t\t\t--noise-secondary-channel-hue: 16;\n\t\t\t--noise-secondary-channel-hue-scale: -1.33;\n\t\t\t--noise-secondary-channel-sat: 25;\n\t\t\t--noise-secondary-channel-sat-scale: 0;\n\t\t\t--noise-secondary-channel-lum: 42;\n\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t--noise-primary-channel-hue: 16;\n\t\t\t--noise-primary-channel-hue-scale: -1.33;\n\t\t\t--noise-primary-channel-sat: 33;\n\t\t\t--noise-primary-channel-sat-scale: 0;\n\t\t\t--noise-primary-channel-lum: 63.5;\n\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t--noise-secondary-note-hue: 12;\n\t\t\t--noise-secondary-note-hue-scale: -1.33;\n\t\t\t--noise-secondary-note-sat: 33.5;\n\t\t\t--noise-secondary-note-sat-scale: 0;\n\t\t\t--noise-secondary-note-lum: 55;\n\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t--noise-primary-note-hue: 12;\n\t\t\t--noise-primary-note-hue-scale: -1.33;\n\t\t\t--noise-primary-note-sat: 46.5;\n\t\t\t--noise-primary-note-sat-scale: 0;\n\t\t\t--noise-primary-note-lum: 74;\n\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t--mod-secondary-channel-hue: 12;\n\t\t\t--mod-secondary-channel-hue-scale: -.75;\n\t\t\t--mod-secondary-channel-sat: 50;\n\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t--mod-secondary-channel-lum: 50;\n\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t--mod-primary-channel-hue: 12;\n\t\t\t--mod-primary-channel-hue-scale: -.75;\n\t\t\t--mod-primary-channel-sat: 70;\n\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t--mod-primary-channel-lum: 80;\n\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t--mod-secondary-note-hue: 12;\n\t\t\t--mod-secondary-note-hue-scale: -.75;\n\t\t\t--mod-secondary-note-sat: 75;\n\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t--mod-secondary-note-lum: 45;\n\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t--mod-primary-note-hue: 12;\n\t\t\t--mod-primary-note-hue-scale: -.75;\n\t\t\t--mod-primary-note-sat: 85;\n\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t--mod-primary-note-lum: 85;\n\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t--disabled-note-primary: #aaa;\n\t\t\t--disabled-note-secondary: #666;\n\t\t}", "roe light": "\n\t\t:root {\n\t\t\t--page-margin: #fff5f5;\n\t\t\t--editor-background: #fff5f5;\n\t\t\t--hover-preview: #0e8bf1;\n\t\t\t--playhead: 000;\n\t\t\t--primary-text: #0e8bf1;\n\t\t\t--secondary-text: #f10e0e;\n\t\t\t--inverted-text: white;\n\t\t\t--text-selection: #ff4444fc;\n\t\t\t--box-selection-fill: #ff00004d;\n\t\t\t--loop-accent: #9a75ff;\n\t\t\t--link-accent: #ff7070;\n\t\t\t--ui-widget-background: #bdc9e5;\n\t\t\t--ui-widget-focus: #a3b7e5;\n\t\t\t--pitch-background: #d0c7db;\n\t\t\t--tonic: #bed3e4;\n\t\t\t--fifth-note: #e7c6c6;\n\t\t\t--white-piano-key: #cdcdcd;\n\t\t\t--black-piano-key: #232323;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #e5e1ea;\n\t\t\t--track-editor-bg-pitch-dim: #cbc4d4;\n\t\t\t--track-editor-bg-noise: #e0ddee;\n\t\t\t--track-editor-bg-noise-dim: #c1bade;\n\t\t\t--track-editor-bg-mod: #d8e6f3;\n\t\t\t--track-editor-bg-mod-dim: #b1cce7;\n\t\t\t--multiplicative-mod-slider: #8097cb;\n\t\t\t--overwriting-mod-slider: #8097cb;\n\t\t\t--indicator-primary: #FF2A2A;\n\t\t\t--indicator-secondary: #92a6d3;\n\t\t\t--select2-opt-group: #b6c4e2;\n\t\t\t--input-box-outline: #bdc9e5;\n\t\t\t--mute-button-normal: #66baff;\n\t\t\t--mute-button-mod: #1a98ff;\n\t\t\t--pitch1-secondary-channel: #273c90;\n\t\t\t--pitch1-primary-channel: #476BFF;\n\t\t\t--pitch1-secondary-note: #273c90;\n\t\t\t--pitch1-primary-note: #476BFF;\n\t\t\t--pitch2-secondary-channel: #3a3898;\n\t\t\t--pitch2-primary-channel: #625FFB;\n\t\t\t--pitch2-secondary-note: #3a3898;\n\t\t\t--pitch2-primary-note: #625FFB;\n\t\t\t--pitch3-secondary-channel: #542780;\n\t\t\t--pitch3-primary-channel: #9C49EC;\n\t\t\t--pitch3-secondary-note: #542780;\n\t\t\t--pitch3-primary-note: #9C49EC;\n\t\t\t--pitch4-secondary-channel: #84225d;\n\t\t\t--pitch4-primary-channel: #fd3fb1;\n\t\t\t--pitch4-secondary-note: #84225d;\n\t\t\t--pitch4-primary-note: #fd3fb1;\n\t\t\t--pitch5-secondary-channel: #8d2323;\n\t\t\t--pitch5-primary-channel: #ff3f3f;\n\t\t\t--pitch5-secondary-note: #8d2323;\n\t\t\t--pitch5-primary-note: #ff3f3f;\n\t\t\t--pitch6-secondary-channel: #84225d;\n\t\t\t--pitch6-primary-channel: #fd3fb1;\n\t\t\t--pitch6-secondary-note: #84225d;\n\t\t\t--pitch6-primary-note: #fd3fb1;\n\t\t\t--pitch7-secondary-channel: #542780;\n\t\t\t--pitch7-primary-channel: #9C49EC;\n\t\t\t--pitch7-secondary-note: #542780;\n\t\t\t--pitch7-primary-note: #9C49EC;\n\t\t\t--pitch8-secondary-channel: #3a3898;\n\t\t\t--pitch8-primary-channel: #625FFB;\n\t\t\t--pitch8-secondary-note: #3a3898;\n\t\t\t--pitch8-primary-note: #625FFB;\n\t\t\t--pitch9-secondary-channel: #273c90;\n\t\t\t--pitch9-primary-channel: #476BFF;\n\t\t\t--pitch9-secondary-note: #273c90;\n\t\t\t--pitch9-primary-note: #476BFF;\n\t\t\t--pitch10-secondary-channel: #165a93;\n\t\t\t--pitch10-primary-channel: #299EFF;\n\t\t\t--pitch10-secondary-note: #165a93;\n\t\t\t--pitch10-primary-note: #299EFF;\n\t\t\t--noise1-secondary-channel: #336bdb;\n\t\t\t--noise1-primary-channel: #4281FF;\n\t\t\t--noise1-secondary-note: #336bdb;\n\t\t\t--noise1-primary-note: #4281FF;\n\t\t\t--noise2-secondary-channel: #5e38dc;\n\t\t\t--noise2-primary-channel: #7347FF;\n\t\t\t--noise2-secondary-note: #5e38dc;\n\t\t\t--noise2-primary-note: #7347FF;\n\t\t\t--noise3-secondary-channel: #7d3097;\n\t\t\t--noise3-primary-channel: #9F3CBF;\n\t\t\t--noise3-secondary-note: #7d3097;\n\t\t\t--noise3-primary-note: #9F3CBF;\n\t\t\t--noise4-secondary-channel: #ad2559;\n\t\t\t--noise4-primary-channel: #D3326F;\n\t\t\t--noise4-secondary-note: #ad2559;\n\t\t\t--noise4-primary-note: #D3326F;\n\t\t\t--noise5-secondary-channel: #d02525;\n\t\t\t--noise5-primary-channel: #FF2A2A;\n\t\t\t--noise5-secondary-note: #d02525;\n\t\t\t--noise5-primary-note: #FF2A2A;\n\t\t\t--mod1-secondary-channel: #35415a;\n\t\t\t--mod1-primary-channel: #47587a;\n\t\t\t--mod1-secondary-note: #35415a;\n\t\t\t--mod1-primary-note: #47587a;\n\t\t\t--mod2-secondary-channel: #5a5374;\n\t\t\t--mod2-primary-channel: #716791;\n\t\t\t--mod2-secondary-note: #5a5374;\n\t\t\t--mod2-primary-note: #716791;\n\t\t\t--mod3-secondary-channel: #53385c;\n\t\t\t--mod3-primary-channel: #6f4c7b;\n\t\t\t--mod3-secondary-note: #53385c;\n\t\t\t--mod3-primary-note: #6f4c7b;\n\t\t\t--mod4-secondary-channel: #7e4e60;\n\t\t\t--mod4-primary-channel: #9e6279;\n\t\t\t--mod4-secondary-note: #7e4e60;\n\t\t\t--mod4-primary-note: #9e6279;\n\t\t\t--mod-label-primary: #d0c7db;\n\t\t\t--mod-label-secondary-text: #cb3434;\n\t\t\t--mod-label-primary-text: black;\n\t\t\t--disabled-note-primary: #616161;\n\t\t\t--disabled-note-secondary: #474747;\n\t\t}", energized: "\n\t\t:root {\n\t\t\t--page-margin: #000a08;\n\t\t\t--editor-background: #000a08;\n\t\t\t--hover-preview: #ffffcc;\n\t\t\t--playhead: #ccfff5;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #d9d98c;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: #ffff6659;\n\t\t\t--box-selection-fill: #ffffff33;\n\t\t\t--loop-accent: #ffff00;\n\t\t\t--link-accent: #00ffcc;\n\t\t\t--ui-widget-background: #141f1d;\n\t\t\t--ui-widget-focus: #24423d;\n\t\t\t--pitch-background: #001410;\n\t\t\t--tonic: #00241d;\n\t\t\t--fifth-note: #ffff6633;\n\t\t\t--white-piano-key: #66998f;\n\t\t\t--black-piano-key: #141f1d;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #66998f40;\n\t\t\t--track-editor-bg-pitch-dim: #293d3940;\n\t\t\t--track-editor-bg-noise: #66998f40;\n\t\t\t--track-editor-bg-noise-dim: #293d3940;\n\t\t\t--track-editor-bg-mod: #99996640;\n\t\t\t--track-editor-bg-mod-dim: #3d3d2940;\n\t\t\t--multiplicative-mod-slider: #ffff00;\n\t\t\t--overwriting-mod-slider: #00ffcc;\n\t\t\t--indicator-primary: #ffff00;\n\t\t\t--indicator-secondary: #141f1d;\n\t\t\t--select2-opt-group: #1b312e;\n\t\t\t--input-box-outline: #141f1d;\n\t\t\t--mute-button-normal: #00ffcc;\n\t\t\t--mute-button-mod: #00997a;\n\t\t\t--pitch1-secondary-channel: #bfbf40;\n\t\t\t--pitch1-primary-channel: #ffff64;\n\t\t\t--pitch1-secondary-note: #bfbf40;\n\t\t\t--pitch1-primary-note: #ffff64;\n\t\t\t--pitch2-secondary-channel: #a2bf40;\n\t\t\t--pitch2-primary-channel: #e0ff7d;\n\t\t\t--pitch2-secondary-note: #a2bf40;\n\t\t\t--pitch2-primary-note: #e0ff7d;\n\t\t\t--pitch3-secondary-channel: #75bf40;\n\t\t\t--pitch3-primary-channel: #c1ff96;\n\t\t\t--pitch3-secondary-note: #75bf40;\n\t\t\t--pitch3-primary-note: #c1ff96;\n\t\t\t--pitch4-secondary-channel: #40bf51;\n\t\t\t--pitch4-primary-channel: #a2ffaf;\n\t\t\t--pitch4-secondary-note: #40bf51;\n\t\t\t--pitch4-primary-note: #a2ffaf;\n\t\t\t--pitch5-secondary-channel: #40bf86;\n\t\t\t--pitch5-primary-channel: #83ffc8;\n\t\t\t--pitch5-secondary-note: #40bf86;\n\t\t\t--pitch5-primary-note: #83ffc8;\n\t\t\t--pitch6-secondary-channel: #40bfa6;\n\t\t\t--pitch6-primary-channel: #64ffe1;\n\t\t\t--pitch6-secondary-note: #40bfa6;\n\t\t\t--pitch6-primary-note: #64ffe1;\n\t\t\t--pitch7-secondary-channel: #40bf86;\n\t\t\t--pitch7-primary-channel: #83ffc8;\n\t\t\t--pitch7-secondary-note: #40bf86;\n\t\t\t--pitch7-primary-note: #83ffc8;\n\t\t\t--pitch8-secondary-channel: #40bf51;\n\t\t\t--pitch8-primary-channel: #a2ffaf;\n\t\t\t--pitch8-secondary-note: #40bf51;\n\t\t\t--pitch8-primary-note: #a2ffaf;\n\t\t\t--pitch9-secondary-channel: #75bf40;\n\t\t\t--pitch9-primary-channel: #c1ff96;\n\t\t\t--pitch9-secondary-note: #75bf40;\n\t\t\t--pitch9-primary-note: #c1ff96;\n\t\t\t--pitch10-secondary-channel: #a2bf40;\n\t\t\t--pitch10-primary-channel: #e0ff7d;\n\t\t\t--pitch10-secondary-note: #a2bf40;\n\t\t\t--pitch10-primary-note: #e0ff7d;\n\t\t\t--noise1-secondary-channel: #a6a659;\n\t\t\t--noise1-primary-channel: #ffffcc;\n\t\t\t--noise1-secondary-note: #a6a659;\n\t\t\t--noise1-primary-note: #ffffcc;\n\t\t\t--noise2-secondary-channel: #94a659;\n\t\t\t--noise2-primary-channel: #f3ffcc;\n\t\t\t--noise2-secondary-note: #94a659;\n\t\t\t--noise2-primary-note: #f3ffcc;\n\t\t\t--noise3-secondary-channel: #79a659;\n\t\t\t--noise3-primary-channel: #e1ffcc;\n\t\t\t--noise3-secondary-note: #79a659;\n\t\t\t--noise3-primary-note: #e1ffcc;\n\t\t\t--noise4-secondary-channel: #94a659;\n\t\t\t--noise4-primary-channel: #f3ffcc;\n\t\t\t--noise4-secondary-note: #94a659;\n\t\t\t--noise4-primary-note: #f3ffcc;\n\t\t\t--noise5-secondary-channel: #a6a659;\n\t\t\t--noise5-primary-channel: #ffffcc;\n\t\t\t--noise5-secondary-note: #a6a659;\n\t\t\t--noise5-primary-note: #ffffcc;\n\t\t\t--mod1-secondary-channel: #a3a329;\n\t\t\t--mod1-primary-channel: #ffff00;\n\t\t\t--mod1-secondary-note: #a3a329;\n\t\t\t--mod1-primary-note: #ffff00;\n\t\t\t--mod2-secondary-channel: #a38529;\n\t\t\t--mod2-primary-channel: #ffbf00;\n\t\t\t--mod2-secondary-note: #a38529;\n\t\t\t--mod2-primary-note: #ffbf00;\n\t\t\t--mod3-secondary-channel: #a36629;\n\t\t\t--mod3-primary-channel: #ff7f00;\n\t\t\t--mod3-secondary-note: #a36629;\n\t\t\t--mod3-primary-note: #ff7f00;\n\t\t\t--mod4-secondary-channel: #a38529;\n\t\t\t--mod4-primary-channel: #ffbf00;\n\t\t\t--mod4-secondary-note: #a38529;\n\t\t\t--mod4-primary-note: #ffbf00;\n\t\t\t--mod-label-primary: #141f1d;\n\t\t\t--mod-label-secondary-text: #d9d98c;\n\t\t\t--mod-label-primary-text: white;\n\t\t\t--disabled-note-primary: #808080;\n\t\t\t--disabled-note-secondary: #666666;\n\t\t}", neapolitan: ":root {\n\t\t\t--page-margin: #120807;\n\t\t\t--editor-background: #120807;\n\t\t\t--hover-preview: #e79a82;\n\t\t\t--playhead: #e79a82;\n\t\t\t--primary-text: #decdbf;\n\t\t\t--secondary-text: #fa99bb;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: #990036;\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\n\t\t\t--loop-accent: #f6377a;\n\t\t\t--link-accent: #f6377a;\n\t\t\t--ui-widget-background: #24160f;\n\t\t\t--ui-widget-focus: #362217;\n\t\t\t--pitch-background: #1e1106;\n\t\t\t--tonic: #382414;\n\t\t\t--fifth-note: #41240c;\n\t\t\t--white-piano-key: #e1c5b7;\n\t\t\t--black-piano-key: #482c1e;\n\t\t\t--use-color-formula: false;\n\t\t\t--track-editor-bg-pitch: #4d2a19;\n\t\t\t--track-editor-bg-pitch-dim: #27150c;\n\t\t\t--track-editor-bg-noise: #4d2a19;\n\t\t\t--track-editor-bg-noise-dim: #27150c;\n\t\t\t--track-editor-bg-mod: #4d2a19;\n\t\t\t--track-editor-bg-mod-dim: #27150c;\n\t\t\t--multiplicative-mod-slider: #decdbf;\n\t\t\t--overwriting-mod-slider: #decdbf;\n\t\t\t--indicator-primary: #decdbf;\n\t\t\t--indicator-secondary: #362217;\n\t\t\t--select2-opt-group: #24160f;\n\t\t\t--input-box-outline: #24160f;\n\t\t\t--mute-button-normal: #ff66a1;\n\t\t\t--mute-button-mod: #e61968;\n\t\t\t--pitch1-secondary-channel: #680029;\n\t\t\t--pitch1-primary-channel: #cc0052;\n\t\t\t--pitch1-secondary-note: #660029;\n\t\t\t--pitch1-primary-note: #cc0052;\n\t\t\t--pitch2-secondary-channel: #7e1b43;\n\t\t\t--pitch2-primary-channel: #d32e71;\n\t\t\t--pitch2-secondary-note: #7e1b43;\n\t\t\t--pitch2-primary-note: #d32e71;\n\t\t\t--pitch3-secondary-channel: #aa275e;\n\t\t\t--pitch3-primary-channel: #da5d91;\n\t\t\t--pitch3-secondary-note: #aa275e;\n\t\t\t--pitch3-primary-note: #da5d91;\n\t\t\t--pitch4-secondary-channel: #cc3878;\n\t\t\t--pitch4-primary-channel: #e18bb0;\n\t\t\t--pitch4-secondary-note: #cc3878;\n\t\t\t--pitch4-primary-note: #e18bb0;\n\t\t\t--pitch5-secondary-channel: #d06c9b;\n\t\t\t--pitch5-primary-channel: #e9bad0;\n\t\t\t--pitch5-secondary-note: #d06c9b;\n\t\t\t--pitch5-primary-note: #e9bad0;\n\t\t\t--pitch6-secondary-channel: #c9acc5;\n\t\t\t--pitch6-primary-channel: #f0e8ef;\n\t\t\t--pitch6-secondary-note: #c9acc5;\n\t\t\t--pitch6-primary-note: #f0e8ef;\n\t\t\t--pitch7-secondary-channel: #d06c9b;\n\t\t\t--pitch7-primary-channel: #e9bad0;\n\t\t\t--pitch7-secondary-note: #d06c9b;\n\t\t\t--pitch7-primary-note: #e9bad0;\n\t\t\t--pitch8-secondary-channel: #cc3878;\n\t\t\t--pitch8-primary-channel: #e18bb0;\n\t\t\t--pitch8-secondary-note: #cc3878;\n\t\t\t--pitch8-primary-note: #e18bb0;\n\t\t\t--pitch9-secondary-channel: #aa275e;\n\t\t\t--pitch9-primary-channel: #da5d91;\n\t\t\t--pitch9-secondary-note: #aa275e;\n\t\t\t--pitch9-primary-note: #da5d91;\n\t\t\t--pitch10-secondary-channel: #7e1b43;\n\t\t\t--pitch10-primary-channel: #d32e71;\n\t\t\t--pitch10-secondary-note: #7e1b43;\n\t\t\t--pitch10-primary-note: #d32e71;\n\t\t\t--noise1-secondary-channel: #683a37;\n\t\t\t--noise1-primary-channel: #A85F5A;\n\t\t\t--noise1-secondary-note: #683a37;\n\t\t\t--noise1-primary-note: #A85F5A;\n\t\t\t--noise2-secondary-channel: #7c4a41;\n\t\t\t--noise2-primary-channel: #B47A70;\n\t\t\t--noise2-secondary-note: #7c4a41;\n\t\t\t--noise2-primary-note: #B47A70;\n\t\t\t--noise3-secondary-channel: #935f4d;\n\t\t\t--noise3-primary-channel: #c09587;\n\t\t\t--noise3-secondary-note: #935f4d;\n\t\t\t--noise3-primary-note: #C09587;\n\t\t\t--noise4-secondary-channel: #aa795a;\n\t\t\t--noise4-primary-channel: #cdb09d;\n\t\t\t--noise4-secondary-note: #aa795a;\n\t\t\t--noise4-primary-note: #CDAF9D;\n\t\t\t--noise5-secondary-channel: #bb987c;\n\t\t\t--noise5-primary-channel: #decdbf;\n\t\t\t--noise5-secondary-note: #bb987c;\n\t\t\t--noise5-primary-note: #decdbf;\n\t\t\t--mod1-secondary-channel: #6ca784;\n\t\t\t--mod1-primary-channel: #accdb9;\n\t\t\t--mod1-secondary-note: #6ca784;\n\t\t\t--mod1-primary-note: #accdb9;\n\t\t\t--mod2-secondary-channel: #7daa9f;\n\t\t\t--mod2-primary-channel: #bbd3cd;\n\t\t\t--mod2-secondary-note: #7daa9f;\n\t\t\t--mod2-primary-note: #bbd3cd;\n\t\t\t--mod3-secondary-channel: #70a3a9;\n\t\t\t--mod3-primary-channel: #afcccf;\n\t\t\t--mod3-secondary-note: #70a3a9;\n\t\t\t--mod3-primary-note: #afcccf;\n\t\t\t--mod4-secondary-channel: #5698b8;\n\t\t\t--mod4-primary-channel: #9ec3d6;\n\t\t\t--mod4-secondary-note: #5698b8;\n\t\t\t--mod4-primary-note: #9ec3d6;\n\t\t\t--mod-label-primary: #24160f;\n\t\t\t--mod-label-secondary-text: #E5AFC2;\n\t\t\t--mod-label-primary-text: #decdbf;\n\t\t\t--disabled-note-primary: #bababa;\n\t\t\t--disabled-note-secondary: #878787;\n\t\t}", mono: ":root {\n\t\t\t--page-margin: #000;\n\t\t\t--editor-background: #000;\n\t\t\t--hover-preview: #808080;\n\t\t\t--playhead: #808080;\n\t\t\t--primary-text: white;\n\t\t\t--secondary-text: #cccccc;\n\t\t\t--inverted-text: black;\n\t\t\t--text-selection: #696969;\n\t\t\t--box-selection-fill: #cccccc40;\n\t\t\t--loop-accent: #808080;\n\t\t\t--link-accent: white;\n\t\t\t--ui-widget-background: #232323;\n\t\t\t--ui-widget-focus: #303030;\n\t\t\t--pitch-background: #1a1a1a;\n\t\t\t--tonic: #262626;\n\t\t\t--fifth-note: #0d0d0d;\n\t\t\t--white-piano-key: #808080;\n\t\t\t--black-piano-key: #232323;\n\t\t\t--use-color-formula: true;\n\t\t\t--track-editor-bg-pitch: #262626;\n\t\t\t--track-editor-bg-pitch-dim: #1a1a1a;\n\t\t\t--track-editor-bg-noise: #262626;\n\t\t\t--track-editor-bg-noise-dim: #1a1a1a;\n\t\t\t--track-editor-bg-mod: #262626;\n\t\t\t--track-editor-bg-mod-dim: #1a1a1a;\n\t\t\t--multiplicative-mod-slider: #808080;\n\t\t\t--overwriting-mod-slider: #808080;\n\t\t\t--indicator-primary: #808080;\n\t\t\t--indicator-secondary: #333333;\n\t\t\t--select2-opt-group: #232323;\n\t\t\t--input-box-outline: #222;\n\t\t\t--mute-button-normal: #808080;\n\t\t\t--mute-button-mod: #808080;\n\t\t\t--mod-label-primary: #232323;\n\t\t\t--mod-label-secondary-text: #696969;\n\t\t\t--mod-label-primary-text: #cdcdcd;\n\t\t\t--pitch-secondary-channel-hue: 0;\n\t\t\t--pitch-secondary-channel-hue-scale: 25;\n\t\t\t--pitch-secondary-channel-sat: 10;\n\t\t\t--pitch-secondary-channel-sat-scale: 0.1;\n\t\t\t--pitch-secondary-channel-lum: 70;\n\t\t\t--pitch-secondary-channel-lum-scale: 0;\n\t\t\t--pitch-primary-channel-hue: 0;\n\t\t\t--pitch-primary-channel-hue-scale: 25;\n\t\t\t--pitch-primary-channel-sat: 50;\n\t\t\t--pitch-primary-channel-sat-scale: 0.1;\n\t\t\t--pitch-primary-channel-lum: 95;\n\t\t\t--pitch-primary-channel-lum-scale: 0;\n\t\t\t--pitch-secondary-note-hue: 0;\n\t\t\t--pitch-secondary-note-hue-scale: 25;\n\t\t\t--pitch-secondary-note-sat: 10;\n\t\t\t--pitch-secondary-note-sat-scale: 0.1;\n\t\t\t--pitch-secondary-note-lum: 70;\n\t\t\t--pitch-secondary-note-lum-scale: 0;\n\t\t\t--pitch-primary-note-hue: 0;\n\t\t\t--pitch-primary-note-hue-scale: 25;\n\t\t\t--pitch-primary-note-sat: 50;\n\t\t\t--pitch-primary-note-sat-scale: 0.1;\n\t\t\t--pitch-primary-note-lum: 95;\n\t\t\t--pitch-primary-note-lum-scale: 0;\n\t\t\t--noise-secondary-channel-hue: 125;\n\t\t\t--noise-secondary-channel-hue-scale: 50;\n\t\t\t--noise-secondary-channel-sat: 10;\n\t\t\t--noise-secondary-channel-sat-scale: 0.1;\n\t\t\t--noise-secondary-channel-lum: 70;\n\t\t\t--noise-secondary-channel-lum-scale: 0;\n\t\t\t--noise-primary-channel-hue: 125;\n\t\t\t--noise-primary-channel-hue-scale: 50;\n\t\t\t--noise-primary-channel-sat: 50;\n\t\t\t--noise-primary-channel-sat-scale: 0.1;\n\t\t\t--noise-primary-channel-lum: 95;\n\t\t\t--noise-primary-channel-lum-scale: 0;\n\t\t\t--noise-secondary-note-hue: 125;\n\t\t\t--noise-secondary-note-hue-scale: 50;\n\t\t\t--noise-secondary-note-sat: 10;\n\t\t\t--noise-secondary-note-sat-scale: 0.1;\n\t\t\t--noise-secondary-note-lum: 70;\n\t\t\t--noise-secondary-note-lum-scale: 0;\n\t\t\t--noise-primary-note-hue: 125;\n\t\t\t--noise-primary-note-hue-scale: 50;\n\t\t\t--noise-primary-note-sat: 50;\n\t\t\t--noise-primary-note-sat-scale: 0.1;\n\t\t\t--noise-primary-note-lum: 95;\n\t\t\t--noise-primary-note-lum-scale: 0;\n\t\t\t--mod-secondary-channel-hue: 255;\n\t\t\t--mod-secondary-channel-hue-scale: 75;\n\t\t\t--mod-secondary-channel-sat: 10;\n\t\t\t--mod-secondary-channel-sat-scale: 0;\n\t\t\t--mod-secondary-channel-lum: 70;\n\t\t\t--mod-secondary-channel-lum-scale: 0;\n\t\t\t--mod-primary-channel-hue: 255;\n\t\t\t--mod-primary-channel-hue-scale: 75;\n\t\t\t--mod-primary-channel-sat: 50;\n\t\t\t--mod-primary-channel-sat-scale: 0;\n\t\t\t--mod-primary-channel-lum: 95;\n\t\t\t--mod-primary-channel-lum-scale: 0;\n\t\t\t--mod-secondary-note-hue: 255;\n\t\t\t--mod-secondary-note-hue-scale: 75;\n\t\t\t--mod-secondary-note-sat: 10;\n\t\t\t--mod-secondary-note-sat-scale: 0;\n\t\t\t--mod-secondary-note-lum: 70;\n\t\t\t--mod-secondary-note-lum-scale: 0;\n\t\t\t--mod-primary-note-hue: 255;\n\t\t\t--mod-primary-note-hue-scale: 75;\n\t\t\t--mod-primary-note-sat: 50;\n\t\t\t--mod-primary-note-sat-scale: 0;\n\t\t\t--mod-primary-note-lum: 95;\n\t\t\t--mod-primary-note-lum-scale: 0;\n\t\t\t--disabled-note-primary: #c6c6c6;\n\t\t\t--disabled-note-secondary: #8c8c8c;\n\t\t}" }, j.pageMargin = "var(--page-margin)", j.editorBackground = "var(--editor-background)", j.hoverPreview = "var(--hover-preview)", j.playhead = "var(--playhead)", j.primaryText = "var(--primary-text)", j.secondaryText = "var(--secondary-text)", j.invertedText = "var(--inverted-text)", j.textSelection = "var(--text-selection)", j.boxSelectionFill = "var(--box-selection-fill)", j.loopAccent = "var(--loop-accent)", j.linkAccent = "var(--link-accent)", j.uiWidgetBackground = "var(--ui-widget-background)", j.uiWidgetFocus = "var(--ui-widget-focus)", j.pitchBackground = "var(--pitch-background)", j.tonic = "var(--tonic)", j.fifthNote = "var(--fifth-note)", j.whitePianoKey = "var(--white-piano-key)", j.blackPianoKey = "var(--black-piano-key)", j.useColorFormula = "var(--use-color-formula)", j.pitchSecondaryChannelHue = "var(--pitch-secondary-channel-hue)", j.pitchSecondaryChannelHueScale = "var(--pitch-secondary-channel-hue-scale)", j.pitchSecondaryChannelSat = "var(--pitch-secondary-channel-sat)", j.pitchSecondaryChannelSatScale = "var(--pitch-secondary-channel-sat-scale)", j.pitchSecondaryChannelLum = "var(--pitch-secondary-channel-lum)", j.pitchSecondaryChannelLumScale = "var(--pitch-secondary-channel-lum-scale)", j.pitchPrimaryChannelHue = "var(--pitch-primary-channel-hue)", j.pitchPrimaryChannelHueScale = "var(--pitch-primary-channel-hue-scale)", j.pitchPrimaryChannelSat = "var(--pitch-primary-channel-sat)", j.pitchPrimaryChannelSatScale = "var(--pitch-primary-channel-sat-scale)", j.pitchPrimaryChannelLum = "var(--pitch-primary-channel-lum)", j.pitchPrimaryChannelLumScale = "var(--pitch-primary-channel-lum-scale)", j.pitchSecondaryNoteHue = "var(--pitch-secondary-note-hue)", j.pitchSecondaryNoteHueScale = "var(--pitch-secondary-note-hue-scale)", j.pitchSecondaryNoteSat = "var(--pitch-secondary-note-sat)", j.pitchSecondaryNoteSatScale = "var(--pitch-secondary-note-sat-scale)", j.pitchSecondaryNoteLum = "var(--pitch-secondary-note-lum)", j.pitchSecondaryNoteLumScale = "var(--pitch-secondary-note-lum-scale)", j.pitchPrimaryNoteHue = "var(--pitch-primary-note-hue)", j.pitchPrimaryNoteHueScale = "var(--pitch-primary-note-hue-scale)", j.pitchPrimaryNoteSat = "var(--pitch-primary-note-sat)", j.pitchPrimaryNoteSatScale = "var(--pitch-primary-note-sat-scale)", j.pitchPrimaryNoteLum = "var(--pitch-primary-note-lum)", j.pitchPrimaryNoteLumScale = "var(--pitch-primary-note-lum-scale)", j.modSecondaryChannelHue = "var(--mod-secondary-channel-hue)", j.modSecondaryChannelHueScale = "var(--mod-secondary-channel-hue-scale)", j.modSecondaryChannelSat = "var(--mod-secondary-channel-sat)", j.modSecondaryChannelSatScale = "var(--mod-secondary-channel-sat-scale)", j.modSecondaryChannelLum = "var(--mod-secondary-channel-lum)", j.modSecondaryChannelLumScale = "var(--mod-secondary-channel-lum-scale)", j.modPrimaryChannelHue = "var(--mod-primary-channel-hue)", j.modPrimaryChannelHueScale = "var(--mod-primary-channel-hue-scale)", j.modPrimaryChannelSat = "var(--mod-primary-channel-sat)", j.modPrimaryChannelSatScale = "var(--mod-primary-channel-sat-scale)", j.modPrimaryChannelLum = "var(--mod-primary-channel-lum)", j.modPrimaryChannelLumScale = "var(--mod-primary-channel-lum-scale)", j.modSecondaryNoteHue = "var(--mod-secondary-note-hue)", j.modSecondaryNoteHueScale = "var(--mod-secondary-note-hue-scale)", j.modSecondaryNoteSat = "var(--mod-secondary-note-sat)", j.modSecondaryNoteSatScale = "var(--mod-secondary-note-sat-scale)", j.modSecondaryNoteLum = "var(--mod-secondary-note-lum)", j.modSecondaryNoteLumScale = "var(--mod-secondary-note-lum-scale)", j.modPrimaryNoteHue = "var(--mod-primary-note-hue)", j.modPrimaryNoteHueScale = "var(--mod-primary-note-hue-scale)", j.modPrimaryNoteSat = "var(--mod-primary-note-sat)", j.modPrimaryNoteSatScale = "var(--mod-primary-note-sat-scale)", j.modPrimaryNoteLum = "var(--mod-primary-note-lum)", j.modPrimaryNoteLumScale = "var(--mod-primary-note-lum-scale)", j.noiseSecondaryChannelHue = "var(--noise-secondary-channel-hue)", j.noiseSecondaryChannelHueScale = "var(--noise-secondary-channel-hue-scale)", j.noiseSecondaryChannelSat = "var(--noise-secondary-channel-sat)", j.noiseSecondaryChannelSatScale = "var(--noise-secondary-channel-sat-scale)", j.noiseSecondaryChannelLum = "var(--noise-secondary-channel-lum)", j.noiseSecondaryChannelLumScale = "var(--noise-secondary-channel-lum-scale)", j.noisePrimaryChannelHue = "var(--noise-primary-channel-hue)", j.noisePrimaryChannelHueScale = "var(--noise-primary-channel-hue-scale)", j.noisePrimaryChannelSat = "var(--noise-primary-channel-sat)", j.noisePrimaryChannelSatScale = "var(--noise-primary-channel-sat-scale)", j.noisePrimaryChannelLum = "var(--noise-primary-channel-lum)", j.noisePrimaryChannelLumScale = "var(--noise-primary-channel-lum-scale)", j.noiseSecondaryNoteHue = "var(--noise-secondary-note-hue)", j.noiseSecondaryNoteHueScale = "var(--noise-secondary-note-hue-scale)", j.noiseSecondaryNoteSat = "var(--noise-secondary-note-sat)", j.noiseSecondaryNoteSatScale = "var(--noise-secondary-note-sat-scale)", j.noiseSecondaryNoteLum = "var(--noise-secondary-note-lum)", j.noiseSecondaryNoteLumScale = "var(--noise-secondary-note-lum-scale)", j.noisePrimaryNoteHue = "var(--noise-primary-note-hue)", j.noisePrimaryNoteHueScale = "var(--noise-primary-note-hue-scale)", j.noisePrimaryNoteSat = "var(--noise-primary-note-sat)", j.noisePrimaryNoteSatScale = "var(--noise-primary-note-sat-scale)", j.noisePrimaryNoteLum = "var(--noise-primary-note-lum)", j.noisePrimaryNoteLumScale = "var(--noise-primary-note-lum-scale)", j.trackEditorBgPitch = "var(--track-editor-bg-pitch)", j.trackEditorBgPitchDim = "var(--track-editor-bg-pitch-dim)", j.trackEditorBgNoise = "var(--track-editor-bg-noise)", j.trackEditorBgNoiseDim = "var(--track-editor-bg-noise-dim)", j.trackEditorBgMod = "var(--track-editor-bg-mod)", j.trackEditorBgModDim = "var(--track-editor-bg-mod-dim)", j.multiplicativeModSlider = "var(--multiplicative-mod-slider)", j.overwritingModSlider = "var(--overwriting-mod-slider)", j.indicatorPrimary = "var(--indicator-primary)", j.indicatorSecondary = "var(--indicator-secondary)", j.select2OptGroup = "var(--select2-opt-group)", j.inputBoxOutline = "var(--input-box-outline)", j.muteButtonNormal = "var(--mute-button-normal)", j.muteButtonMod = "var(--mute-button-mod)", j.modLabelPrimary = "var(--mod-label-primary)", j.modLabelSecondaryText = "var(--mod-label-secondary-text)", j.modLabelPrimaryText = "var(--mod-label-primary-text)", j.disabledNotePrimary = "var(--disabled-note-primary)", j.disabledNoteSecondary = "var(--disabled-note-secondary)", j.pitchChannels = c([{ name: "pitch1", secondaryChannel: "var(--pitch1-secondary-channel)", primaryChannel: "var(--pitch1-primary-channel)", secondaryNote: "var(--pitch1-secondary-note)", primaryNote: "var(--pitch1-primary-note)" }, { name: "pitch2", secondaryChannel: "var(--pitch2-secondary-channel)", primaryChannel: "var(--pitch2-primary-channel)", secondaryNote: "var(--pitch2-secondary-note)", primaryNote: "var(--pitch2-primary-note)" }, { name: "pitch3", secondaryChannel: "var(--pitch3-secondary-channel)", primaryChannel: "var(--pitch3-primary-channel)", secondaryNote: "var(--pitch3-secondary-note)", primaryNote: "var(--pitch3-primary-note)" }, { name: "pitch4", secondaryChannel: "var(--pitch4-secondary-channel)", primaryChannel: "var(--pitch4-primary-channel)", secondaryNote: "var(--pitch4-secondary-note)", primaryNote: "var(--pitch4-primary-note)" }, { name: "pitch5", secondaryChannel: "var(--pitch5-secondary-channel)", primaryChannel: "var(--pitch5-primary-channel)", secondaryNote: "var(--pitch5-secondary-note)", primaryNote: "var(--pitch5-primary-note)" }, { name: "pitch6", secondaryChannel: "var(--pitch6-secondary-channel)", primaryChannel: "var(--pitch6-primary-channel)", secondaryNote: "var(--pitch6-secondary-note)", primaryNote: "var(--pitch6-primary-note)" }, { name: "pitch7", secondaryChannel: "var(--pitch7-secondary-channel)", primaryChannel: "var(--pitch7-primary-channel)", secondaryNote: "var(--pitch7-secondary-note)", primaryNote: "var(--pitch7-primary-note)" }, { name: "pitch8", secondaryChannel: "var(--pitch8-secondary-channel)", primaryChannel: "var(--pitch8-primary-channel)", secondaryNote: "var(--pitch8-secondary-note)", primaryNote: "var(--pitch8-primary-note)" }, { name: "pitch9", secondaryChannel: "var(--pitch9-secondary-channel)", primaryChannel: "var(--pitch9-primary-channel)", secondaryNote: "var(--pitch9-secondary-note)", primaryNote: "var(--pitch9-primary-note)" }, { name: "pitch10", secondaryChannel: "var(--pitch10-secondary-channel)", primaryChannel: "var(--pitch10-primary-channel)", secondaryNote: "var(--pitch10-secondary-note)", primaryNote: "var(--pitch10-primary-note)" }]), j.noiseChannels = c([{ name: "noise1", secondaryChannel: "var(--noise1-secondary-channel)", primaryChannel: "var(--noise1-primary-channel)", secondaryNote: "var(--noise1-secondary-note)", primaryNote: "var(--noise1-primary-note)" }, { name: "noise2", secondaryChannel: "var(--noise2-secondary-channel)", primaryChannel: "var(--noise2-primary-channel)", secondaryNote: "var(--noise2-secondary-note)", primaryNote: "var(--noise2-primary-note)" }, { name: "noise3", secondaryChannel: "var(--noise3-secondary-channel)", primaryChannel: "var(--noise3-primary-channel)", secondaryNote: "var(--noise3-secondary-note)", primaryNote: "var(--noise3-primary-note)" }, { name: "noise4", secondaryChannel: "var(--noise4-secondary-channel)", primaryChannel: "var(--noise4-primary-channel)", secondaryNote: "var(--noise4-secondary-note)", primaryNote: "var(--noise4-primary-note)" }, { name: "noise5", secondaryChannel: "var(--noise5-secondary-channel)", primaryChannel: "var(--noise5-primary-channel)", secondaryNote: "var(--noise5-secondary-note)", primaryNote: "var(--noise5-primary-note)" }]), j.modChannels = c([{ name: "mod1", secondaryChannel: "var(--mod1-secondary-channel)", primaryChannel: "var(--mod1-primary-channel)", secondaryNote: "var(--mod1-secondary-note)", primaryNote: "var(--mod1-primary-note)" }, { name: "mod2", secondaryChannel: "var(--mod2-secondary-channel)", primaryChannel: "var(--mod2-primary-channel)", secondaryNote: "var(--mod2-secondary-note)", primaryNote: "var(--mod2-primary-note)" }, { name: "mod3", secondaryChannel: "var(--mod3-secondary-channel)", primaryChannel: "var(--mod3-primary-channel)", secondaryNote: "var(--mod3-secondary-note)", primaryNote: "var(--mod3-primary-note)" }, { name: "mod4", secondaryChannel: "var(--mod4-secondary-channel)", primaryChannel: "var(--mod4-primary-channel)", secondaryNote: "var(--mod4-secondary-note)", primaryNote: "var(--mod4-primary-note)" }]), j.h = document.head.appendChild(z.style({ type: "text/css" })); const U = document.body.appendChild(z.div({ style: "width:30px; height:30px; overflow: auto;" }, z.div({ style: "width:100%;height:40px" }))); U.firstChild.clientWidth < 30 && document.documentElement.classList.add("obtrusive-scrollbars"), document.body.removeChild(U), document.head.appendChild(z.style({ type: "text/css" }, `\n\n/* Note: "#" symbols need to be encoded as "%23" in SVG data urls, otherwise they are interpreted as fragment identifiers! */\n:root {\n\t--button-size: 26px;\n\t--settings-area-width: 192px;\n\t--play-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M -5 -8 L -5 8 L 8 0 z" fill="gray"/></svg>');\n\t--pause-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="-5" y="-7" width="4" height="14" fill="gray"/><rect x="3" y="-7" width="4" height="14" fill="gray"/></svg>');\n\t--record-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><circle cx="0" cy="0" r="6" fill="gray"/></svg>');\n\t--stop-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="-6" y="-6" width="12" height="12" fill="gray"/></svg>');\n\t--prev-bar-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="-6" y="-6" width="2" height="12" fill="gray"/><path d="M 6 -6 L 6 6 L -3 0 z" fill="gray"/></svg>');\n\t--next-bar-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><rect x="4" y="-6" width="2" height="12" fill="gray"/><path d="M -6 -6 L -6 6 L 3 0 z" fill="gray"/></svg>');\n\t--volume-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z" fill="gray"/></svg>');\n\t--unmuted-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="3 3 20 20"><path d="M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z" fill="gray"/></svg>');\n\t--muted-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="3 3 20 20"><path d="M 4 16 L 4 10 L 8 10 L 13 5 L 13 21 L 8 16 z" fill="gray"/></svg>');\n\t--menu-down-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M -4 -2 L 4 -2 L 0 3 z" fill="gray"/></svg>');\n\t--select-arrows-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M -4 -3 L 4 -3 L 0 -8 z M -4 3 L 4 3 L 0 8 z" fill="gray"/></svg>');\n\t--file-page-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-5 -21 26 26"><path d="M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z" fill="gray"/></svg>');\n\t--edit-pencil-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-5 -21 26 26"><path d="M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z" fill="gray"/></svg>');\n\t--preferences-gear-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path d="M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z" fill="gray"/></svg>');\n\t--customize-dial-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"> \t\t\t<g transform="translate(0,1)" fill="gray"> \t\t\t\t<circle cx="0" cy="0" r="6.5" stroke="gray" stroke-width="1" fill="none"/> \t\t\t\t<rect x="-1" y="-5" width="2" height="4" transform="rotate(30)"/> \t\t\t\t<circle cx="-7.79" cy="4.5" r="0.75"/> \t\t\t\t<circle cx="-9" cy="0" r="0.75"/> \t\t\t\t<circle cx="-7.79" cy="-4.5" r="0.75"/> \t\t\t\t<circle cx="-4.5" cy="-7.79" r="0.75"/> \t\t\t\t<circle cx="0" cy="-9" r="0.75"/> \t\t\t\t<circle cx="4.5" cy="-7.79" r="0.75"/> \t\t\t\t<circle cx="7.79" cy="-4.5" r="0.75"/> \t\t\t\t<circle cx="9" cy="0" r="0.75"/> \t\t\t\t<circle cx="7.79" cy="4.5" r="0.75"/> \t\t\t</g> \t\t</svg>');\n\t--instrument-copy-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-5 -21 26 26"><path d="M 0 -15 L 1 -15 L 1 0 L 13 0 L 13 1 L 0 1 L 0 -15 z M 2 -1 L 2 -17 L 10 -17 L 14 -13 L 14 -1 z M 3 -2 L 13 -2 L 13 -12 L 9 -12 L 9 -16 L 3 -16 z" fill="currentColor"></path></svg>');\n\t--instrument-paste-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M 8 18 L 6 18 L 6 5 L 17 5 L 17 7 M 9 8 L 16 8 L 20 12 L 20 22 L 9 22 z" stroke="currentColor" fill="none"></path><path d="M 9 3 L 14 3 L 14 6 L 9 6 L 9 3 z M 16 8 L 20 12 L 16 12 L 16 8 z" fill="currentColor"></path></svg>');\n\t--export-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z"/></svg>');\n\t--close-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -7.07 -5.66 L -5.66 -7.07 L 0 -1.4 L 5.66 -7.07 L 7.07 -5.66 L 1.4 0 L 7.07 5.66 L 5.66 7.07 L 0 1.4 L -5.66 7.07 L -7.07 5.66 L -1.4 0 z"/></svg>');\n\t--add-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -8 -1 L -1 -1 L -1 -8  L 1 -8 L 1 -1 L 8 -1 L 8 1 L 1 1 L 1 8 L -1 8 L -1 1 L -8 1 z"/></svg>');\n\t--zoom-in-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="-10 -10 20 20"><circle cx="-1" cy="-1" r="6" stroke-width="2" stroke="gray" fill="none"></circle><path stroke="gray" stroke-width="2" d="M 3 3 L 7 7 M -1 -4 L -1 2 M -4 -1 L 2 -1" fill="none"></path></svg>');\n\t--zoom-out-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="-10 -10 20 20"><circle cx="-1" cy="-1" r="6" stroke-width="2" stroke="gray" fill="none"></circle><path stroke="gray" stroke-width="2" d="M 3 3 L 7 7 M -4 -1 L 2 -1" fill="none"></path></svg>');\n\t--checkmark-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="-13 -13 26 26"><path fill="gray" d="M -9 -2 L -8 -3 L -3 2 L 9 -8 L 10 -7 L -3 8 z"/></svg>');\n\t--drum-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="40" viewBox="0 0 32 40"> \t\t\t<defs> \t\t\t\t<linearGradient id="gold1" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="%237e3302"/> \t\t\t\t\t<stop offset="40%" stop-color="%23ffec6b"/> \t\t\t\t\t<stop offset="100%" stop-color="%237e3302"/> \t\t\t\t</linearGradient> \t\t\t\t<linearGradient id="gold2" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="%23faaf7d"/> \t\t\t\t\t<stop offset="15%" stop-color="%23fffba9"/> \t\t\t\t\t<stop offset="40%" stop-color="%23ffffe3"/> \t\t\t\t\t<stop offset="65%" stop-color="%23fffba9"/> \t\t\t\t\t<stop offset="100%" stop-color="%23faaf7d"/> \t\t\t\t</linearGradient> \t\t\t\t<radialGradient id="gold3" cx="0%" cy="0%" r="100%"> \t\t\t\t\t<stop offset="0%" stop-color="%23ffffe3"/> \t\t\t\t\t<stop offset="50%" stop-color="%23ffec6b"/> \t\t\t\t\t<stop offset="100%" stop-color="%237e3302"/> \t\t\t\t</radialGradient> \t\t\t\t<linearGradient id="red" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="%23641919"/> \t\t\t\t\t<stop offset="40%" stop-color="%23cd2c2c"/> \t\t\t\t\t<stop offset="100%" stop-color="%23641919"/> \t\t\t\t</linearGradient> \t\t\t\t<radialGradient id="membrane"> \t\t\t\t\t<stop offset="10%" stop-color="%23cccccc" /> \t\t\t\t\t<stop offset="90%" stop-color="%23f6f6f7" /> \t\t\t\t\t<stop offset="100%" stop-color="%23999" /> \t\t\t\t</radialGradient> \t\t\t</defs> \t\t\t<ellipse cx="16" cy="26" rx="16" ry="14" fill="rgba(0,0,0,0.5)"/> \t\t\t<ellipse cx="16" cy="25" rx="16" ry="14" fill="url(%23gold1)"/> \t\t\t<rect x="0" y="23" width="32" height="2" fill="url(%23gold1)"/> \t\t\t<ellipse cx="16" cy="23" rx="16" ry="14" fill="url(%23gold2)"/> \t\t\t<ellipse cx="16" cy="23" rx="15" ry="13" fill="url(%23red)"/> \t\t\t<rect x="1" y="17" width="30" height="6" fill="url(%23red)"/> \t\t\t<rect x="5" y="27" width="1" height="5" rx="0.5" fill="rgba(0,0,0,0.5)"/> \t\t\t<rect x="15" y="31" width="2" height="5" rx="1" fill="rgba(0,0,0,0.5)"/> \t\t\t<rect x="26" y="27" width="1" height="5" rx="0.5" fill="rgba(0,0,0,0.5)"/> \t\t\t<rect x="5" y="26" width="1" height="5" rx="0.5" fill="url(%23gold3)"/> \t\t\t<rect x="15" y="30" width="2" height="5" rx="1" fill="url(%23gold3)"/> \t\t\t<rect x="26" y="26" width="1" height="5" rx="0.5" fill="url(%23gold3)"/> \t\t\t<ellipse cx="16" cy="18" rx="15" ry="13" fill="rgba(0,0,0,0.5)"/> \t\t\t<ellipse cx="16" cy="16" rx="16" ry="14" fill="url(%23gold1)"/> \t\t\t<rect x="0" y="14" width="32" height="2" fill="url(%23gold1)"/> \t\t\t<ellipse cx="16" cy="14" rx="16" ry="14" fill="url(%23gold2)"/> \t\t\t<ellipse cx="16" cy="14" rx="15" ry="13" fill="url(%23membrane)"/> \t\t</svg>');\n\t--piano-key-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="15" preserveAspectRatio="none" viewBox="0 -1 32 15"> \t\t\t<defs> \t\t\t\t<linearGradient id="shadow" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="rgba(0,0,0,0.5)"/> \t\t\t\t\t<stop offset="100%" stop-color="transparent"/> \t\t\t\t</linearGradient> \t\t\t</defs> \t\t\t<rect x="-1" y="1" width="31" height="1" rx="0.6" fill="rgba(255,255,255,0.4)"/> \t\t\t<path d="M -1 11 L 30 11 L 30 2 L 33 -1 L 33 14 L -1 14 z" fill="rgba(0,0,0,0.7)"/> \t\t\t<rect x="-1" y="-1" width="19" height="15" fill="url(%23shadow)"/> \t\t</svg>');\n  --mod-key-symbol: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="80" preserveAspectRatio="none" viewBox="0 -1 32 80"> \t\t\t<defs> \t\t\t\t<linearGradient id="shadow" x1="0%" y1="0%" x2="100%" y2="0%"> \t\t\t\t\t<stop offset="0%" stop-color="rgba(0,0,0,0.4)"/> \t\t\t\t\t<stop offset="100%" stop-color="transparent"/> \t\t\t\t</linearGradient> \t\t\t</defs> \t\t\t<rect x="-1" y="1" width="31" height="1" rx="0.6" fill="rgba(255,255,255,0.2)"/> \t\t\t<path d="M -1 76 L 30 76 L 30 1 L 33 -1 L 33 80 L -1 80 z" fill="rgba(0,0,0,0.7)"/> \t\t\t<rect x="-1" y="-1" width="19" height="80" fill="url(%23shadow)"/> \t\t</svg>');\n}\n\n\n.obtrusive-scrollbars, .obtrusive-scrollbars * {\n\tscrollbar-width: thin;\n\tscrollbar-color: ${j.uiWidgetBackground} ${j.editorBackground};\n}\n.obtrusive-scrollbars::-webkit-scrollbar, .obtrusive-scrollbars *::-webkit-scrollbar {\n\twidth: 12px;\n}\n.obtrusive-scrollbars::-webkit-scrollbar-track, .obtrusive-scrollbars *::-webkit-scrollbar-track {\n\tbackground: ${j.editorBackground};\n}\n.obtrusive-scrollbars::-webkit-scrollbar-thumb, .obtrusive-scrollbars *::-webkit-scrollbar-thumb {\n\tbackground-color: ${j.uiWidgetBackground};\n\tborder: 3px solid ${j.editorBackground};\n}\n\n@-moz-document url-prefix() {\n\t.muteButtonText {\n\t\ttransform: translate(3px, 1px) !important;\n\t}\n}\n\n.beepboxEditor {\n\tdisplay: grid;\n    grid-template-columns: minmax(0, 1fr) max-content;\n    grid-template-rows: max-content 1fr; /* max-content minmax(0, 1fr); Chrome 80 grid layout regression. https://bugs.chromium.org/p/chromium/issues/detail?id=1050307 */\n    grid-template-areas: "pattern-area settings-area" "track-area settings-area";\n\tgrid-column-gap: 6px;\n\tgrid-row-gap: 6px;\n\tposition: relative;\n\ttouch-action: manipulation;\n\tcursor: default;\n\tfont-size: 13px;\n\toverflow: hidden;\n\tcolor: ${j.primaryText};\n\tbackground: ${j.editorBackground};\n    opacity: 0;\n    -webkit-transition: opacity 0.2s ease-in;\n    -moz-transition: opacity 0.2s ease-in;\n    -o-transition: opacity 0.2s ease-in;\n    -ms-transition: opacity 0.2s ease-in;\n    transition: opacity 0.2s ease-in;\n    transition-delay: 0s;\n}\n\n.beepboxEditor .operatorRow {\n\tmargin: 2px 0;\n\theight: 2em;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n}\n\n.beepboxEditor .operatorRow > * {\n\tflex-grow: 1;\n\tflex-shrink: 1;\n}\n\n.pattern-area {\n     opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0s;\n}\n\n.settings-area {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.15s;\n}\n\n.editor-song-settings {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.35s;\n}\n\n.instrument-settings-area {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.45s;\n}\n\n.trackAndMuteContainer {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.4s;\n}\n\n.barScrollBar {\n    opacity: 0;\n    -webkit-transition: opacity 0.5s ease-in;\n    -moz-transition: opacity 0.5s ease-in;\n    -o-transition: opacity 0.5s ease-in;\n    -ms-transition: opacity 0.5s ease-in;\n    transition: opacity 0.5s ease-in;\n    transition-delay: 0.5s;\n}\n\n\n\n.load {\n    opacity: 1;\n}\n\n.beepboxEditor .noSelection {\n\t-webkit-touch-callout: none;\n\t-webkit-user-select: none;\n\t-moz-user-select: none;\n\t-ms-user-select: none;\n\tuser-select: none;\n}\n\n.beepboxEditor div {\n\tmargin: 0;\n\tpadding: 0;\n}\n\n.beepboxEditor .pattern-area {\n\tgrid-area: pattern-area;\n\theight: 481px;\n\tdisplay: flex;\n\tflex-direction: row;\n\tposition: relative;\n}\n\n.beepboxEditor .track-area {\n\tgrid-area: track-area;\n}\n\n.beepboxEditor .loopEditor {\n\theight: 20px;\n\tposition: sticky;\n\tbottom: 0;\n\tpadding: 5px 0;\n\tbackground-color: ${j.editorBackground};\n}\n\n.beepboxEditor .settings-area {\n\tgrid-area: settings-area;\n\tdisplay: grid;\n    grid-template-columns: auto;\n    grid-template-rows: min-content min-content min-content min-content min-content;\n    grid-template-areas: "version-area" "play-pause-area" "menu-area" "song-settings-area" "instrument-settings-area";\n\tgrid-column-gap: 6px;\n}\n\n.beepboxEditor .version-area{ grid-area: version-area; }\n.beepboxEditor .play-pause-area{ grid-area: play-pause-area; }\n.beepboxEditor .menu-area{ grid-area: menu-area; }\n.beepboxEditor .song-settings-area{ grid-area: song-settings-area; }\n.beepboxEditor .instrument-settings-area{ grid-area: instrument-settings-area; }\n\n.beepboxEditor .tip {\n\tcursor: help;\n\tcolor: ${j.secondaryText};\n\ttext-decoration: none;\n}\n\n.beepboxEditor .tip:hover {\n\tcolor: ${j.linkAccent};\n\ttext-decoration: underline;\n}\n.beepboxEditor .tip:active {\n\tcolor: ${j.primaryText};\n}\n\n.beepboxEditor .volume-speaker {\n\tflex-shrink: 0;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: ${j.secondaryText};\n\t-webkit-mask-image: var(--volume-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--volume-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .drum-button {\n\tflex: 1;\n\tbackground-color: transparent;\n\tbackground-image: var(--drum-symbol);\n\tbackground-repeat: no-repeat;\n\tbackground-position: center;\n}\n\n.beepboxEditor .modulator-button {\n\tflex: 1;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n}\n.beepboxEditor .modulator-button::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: none;\n\tbackground-image: var(--mod-key-symbol);\n\tbackground-repeat: no-repeat;\n\tbackground-position: center;\n\tbackground-size: 100% 102%;\n}\n\n.beepboxEditor .piano-button {\n\tflex: 1;\n\tposition: relative;\n\tdisplay: flex;\n\talign-items: center;\n}\n.beepboxEditor .piano-button::before {\n\tcontent: "";\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: none;\n\tbackground-image: var(--piano-key-symbol);\n\tbackground-repeat: no-repeat;\n\tbackground-position: center;\n\tbackground-size: 100% 115.38%;\n}\n.beepboxEditor .piano-button.disabled::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\twidth: 70%;\n\theight: 100%;\n\tpointer-events: none;\n\tbackground: ${j.editorBackground};\n\t-webkit-mask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .piano-button.pressed, .beepboxEditor .drum-button.pressed {\n\tfilter: brightness(0.5);\n}\n\n.beepboxEditor .customize-instrument {\n\tmargin: 2px 0;\n}\n.beepboxEditor .customize-instrument::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--customize-dial-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--customize-dial-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .instrumentCopyPasteRow {\n\tgap: 2px;\n}\n\n.beepboxEditor .copy-instrument {\n\tmargin: 2px 0;\n\tflex-grow: 1;\n}\n.beepboxEditor .copy-instrument::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--instrument-copy-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--instrument-copy-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .paste-instrument {\n\tmargin: 2px 0;\n\tflex-grow: 1;\n}\n.beepboxEditor .paste-instrument::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--instrument-paste-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--instrument-paste-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .envelopeEditor {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .envelope-row {\n\tdisplay: flex;\n\tmargin: 2px 0;\n\tgap: 2px;\n}\n\n.beepboxEditor .add-envelope {\n\twidth: var(--button-size);\n}\n.beepboxEditor .add-envelope::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--add-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--add-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n.beepboxEditor .add-envelope:disabled {\n\tvisibility: hidden;\n}\n\n.beepboxEditor .effects-menu {\n\twidth: var(--button-size);\n\tposition: relative;\n}\n.beepboxEditor .effects-menu::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--menu-down-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--menu-down-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor .zoomInButton, .beepboxEditor .zoomOutButton {\n\twidth: var(--button-size);\n\tposition: absolute;\n\tright: 10px;\n}\n.beepboxEditor .zoomInButton {\n\ttop: 10px;\n}\n.beepboxEditor .zoomOutButton {\n\ttop: 50px;\n}\n.beepboxEditor .zoomInButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--zoom-in-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--zoom-in-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n.beepboxEditor .zoomOutButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--zoom-out-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--zoom-out-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor .delete-envelope {\n\twidth: var(--button-size);\n\tflex-shrink: 0;\n\tflex-grow: 0;\n}\n.beepboxEditor .delete-envelope::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--close-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--close-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n.beepboxEditor .delete-envelope:disabled {\n\tvisibility: hidden;\n}\n\n.beepboxEditor .menu.file::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--file-page-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--file-page-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .menu.edit::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--edit-pencil-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--edit-pencil-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .menu.preferences::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--preferences-gear-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--preferences-gear-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor .mute-button {\n\tbackground: transparent;\n\tborder: none;\n  padding-right: 0px;\n  padding-left: 0px;\n  box-shadow: none;\n}\n\n.beepboxEditor .mute-button:focus {\n  background: transparent;\n\tborder: none;\n}\n\n.beepboxEditor .mute-button::before {\n\tcontent: "";\n\tpointer-events: none;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: inline-block;\n  background: var(--mute-button-normal);\n\t-webkit-mask-image: var(--unmuted-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\t-webkit-mask-size: cover;\n  mask-repeat: no-repeat;\n\tmask-position: center;\n\tmask-size: cover;\n  mask-image: var(--unmuted-symbol);\n}\n\n.beepboxEditor .mute-button.muted::before {\n  background: var(--ui-widget-background);\n\t-webkit-mask-image: var(--muted-symbol);\n  mask-image: var(--muted-symbol);\n}\n\n.beepboxEditor .mute-button.modMute.muted::before {\n  background: var(--ui-widget-background);\n\t-webkit-mask-image: var(--muted-symbol);\n  mask-image: var(--muted-symbol);\n}\n\n.beepboxEditor .mute-button.modMute::before {\n  background: var(--mute-button-mod);\n}\n\n\n.beepboxEditor .promptContainer {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tz-index: 100;\n}\n\n.beepboxEditor .promptContainer::before {\n\tcontent: "";\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n\tbackground: ${j.editorBackground};\n\topacity: 0.5;\n\tdisplay: flex;\n}\n\n.beepboxEditor .prompt {\n\tmargin: auto;\n\ttext-align: center;\n\tbackground: ${j.editorBackground};\n\tborder-radius: 15px;\n\tborder: 4px solid ${j.uiWidgetBackground};\n\tcolor: ${j.primaryText};\n\tpadding: 20px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\tbox-shadow: 5px 5px 20px 10px rgba(0,0,0,0.5);\n}\n\n.beepboxEditor .prompt > *:not(:first-child):not(.cancelButton) {\n\tmargin-top: 1.5em;\n}\n\n.beepboxEditor .prompt h2 {\n\tfont-size: 2em;\n\tmargin: 0 16px;\n\tfont-weight: normal;\n}\n\n.beepboxEditor .prompt p {\n\ttext-align: left;\n\tmargin: 1em 0;\n}\n\n.beepboxEditor .prompt label {\n\tcursor: pointer;\n}\n\n.beepboxEditor .prompt.recordingSetupPrompt p {\n\tmargin-top: 0.75em;\n\tmargin-bottom: 0;\n}\n\n.beepboxEditor .prompt.recordingSetupPrompt > label:not(:first-child):not(.cancelButton) {\n\tmargin: 2px 0;\n}\n\n.beepboxEditor .layout-option {\n\tdisplay: flex;\n\tflex-direction: column;\n\tflex: 1;\n\tcursor: pointer;\n\tcolor: ${j.secondaryText};\n}\n\n.beepboxEditor .layout-option input {\n\tdisplay: none;\n}\n\n.beepboxEditor .layout-option input:checked ~ * {\n\tcolor: ${j.primaryText};\n}\n.beepboxEditor select.invalidSetting {\n\tborder: solid 1px red;\n}\n.beepboxEditor .selectContainer {\n\tposition: relative;\n}\n.beepboxEditor .selectContainer:not(.menu)::after {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tright: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: 14px;\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--select-arrows-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--select-arrows-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor .selectContainer.menu::after {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tright: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--menu-down-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--menu-down-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor select {\n\tmargin: 0;\n\tpadding: 0 4px;\n\tdisplay: block;\n\theight: var(--button-size);\n\tborder: none;\n\tborder-radius: 5px;\n\tbackground: ${j.uiWidgetBackground};\n\tcolor: inherit;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\tfont-weight: inherit;\n\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n.beepboxEditor select option:disabled {\n\tcolor: ${j.linkAccent};\n\tfont-weight: bold;\n}\n\n.select2-container .select2-selection--single {\n  height: auto;\n}\n\n.select2-container {\n  width: -moz-available !important;\n  width: -webkit-fill-available !important;\n}\n\n.select2-container--default .select2-selection--single{\n  border-radius: 0px;\n  border: 0px;\n  background-color: transparent;\n  outline: none;\n}\n\n.select2-selection__rendered:not(.menu)::before {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\ttop: 0.4em;\n\tborder-bottom: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.select2-selection__rendered:not(.menu)::after {\n\tcontent: "";\n\tposition: absolute;\n\tright: 0.3em;\n\tbottom: 0.4em;\n\tborder-top: 0.4em solid currentColor;\n\tborder-left: 0.3em solid transparent;\n\tborder-right: 0.3em solid transparent;\n\tpointer-events: none;\n}\n.select2-selection__rendered {\n\tmargin: 0;\n\tpadding: 0 0.3em;\n\tdisplay: block;\n\theight: 2em;\n\tborder: none;\n\tborder-radius: 0.4em;\n\tbackground: ${j.uiWidgetBackground};\n\tcolor: inherit !important;\n\tfont-size: inherit;\n\tcursor: pointer;\n\tfont-family: inherit;\n\t-webkit-appearance:none;\n\t-moz-appearance: none;\n\tappearance: none;\n}\n.select2-selection__arrow b{\n    display:none !important;\n}\n\n.select2-selection__rendered--focus {\n\tbackground: ${j.uiWidgetFocus};\n\toutline: none;\n}\n.select2-search__field {\n    background: ${j.uiWidgetBackground};\n    color: inherit !important;\n    font-size: small;\n    font-family: inherit;\n    border: 0px !important;\n    padding: 1px !important;\n}\n.select2-dropdown {\n    box-sizing: border-box;\n    display: inline-block;\n    margin: 0;\n    font-size: small;\n    position: relative;\n    vertical-align: middle;\n    background-color: ${j.uiWidgetFocus};\n}\n\n.select2-container--default .select2-results>.select2-results__options {\n    max-height: 430px;\n    overflow-x: hidden;\n}\n.select2-container--default .select2-results__group {\n    cursor: default;\n    display: block;\n    padding: 1px;\n    background: ${j.select2OptGroup};\n}\n.select2-results__option {\n    padding: 2px;\n    user-select: none;\n    -webkit-user-select: none;\n}\n.select2-container--default .select2-results__option .select2-results__option {\n    padding-left: 0.1em;\n}\n.select2-container--default .select2-results__option[aria-selected=true] {\n  background-color: transparent !important;\n}\n\n.select2-results__option--highlighted[aria-selected] {\n\tcolor: white !important;\n}\n\n.beepboxEditor .menu select {\n\tpadding: 0 var(--button-size);\n}\n.beepboxEditor select:focus {\n\tbackground: ${j.uiWidgetFocus};\n\toutline: none;\n}\n.beepboxEditor .menu select {\n\ttext-align: center;\n\ttext-align-last: center;\n}\n.beepboxEditor .settings-area select {\n       width: 100%;\n}\n\n/* This makes it look better in firefox on my computer... What about others?\n@-moz-document url-prefix() {\n\t.beepboxEditor select { padding: 0 2px; }\n}\n*/\n.beepboxEditor button {\n\tmargin: 0;\n\tposition: relative;\n\theight: var(--button-size);\n\tborder: none;\n\tborder-radius: 5px;\n\tbackground: ${j.uiWidgetBackground};\n\tcolor: inherit;\n\tfont-size: inherit;\n\tfont-family: inherit;\n\tfont-weight: inherit;\n\tcursor: pointer;\n}\n.beepboxEditor button:focus {\n\tbackground: ${j.uiWidgetFocus};\n\toutline: none;\n}\n\n.beepboxEditor button.cancelButton {\n\tfloat: right;\n\twidth: var(--button-size);\n\tposition: absolute;\n\ttop: 8px;\n\tright: 8px;\n}\n\n.beepboxEditor .playback-bar-controls {\n\tdisplay: grid;\n\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr);\n\tgrid-template-rows: min-content;\n\tgrid-column-gap: 4px;\n}\n\n.beepboxEditor button.playButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--play-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--play-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor button.pauseButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--pause-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--pause-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor button.recordButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--record-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--record-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n.beepboxEditor button.stopButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 0;\n\ttop: 50%;\n\ttransform: translateY(-50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--stop-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--stop-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.prevBarButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\ttransform: translate(-50%, -50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--prev-bar-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--prev-bar-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.nextBarButton::before {\n\tcontent: "";\n\tflex-shrink: 0;\n\tposition: absolute;\n\tleft: 50%;\n\ttop: 50%;\n\ttransform: translate(-50%, -50%);\n\tpointer-events: none;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--next-bar-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--next-bar-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton, .beepboxEditor button.recordButton, .beepboxEditor button.stopButton, .beepboxEditor button.okayButton, .beepboxEditor button.exportButton {\n\tpadding-left: var(--button-size);\n}\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton, .beepboxEditor button.recordButton {\n\tgrid-column-start: 1;\n\tgrid-column-end: 3;\n}\n.beepboxEditor button.stopButton {\n\tgrid-column-start: 1;\n\tgrid-column-end: 5;\n}\n.beepboxEditor button.prevBarButton {\n\tgrid-column-start: 3;\n\tgrid-column-end: 4;\n}\n.beepboxEditor button.nextBarButton {\n\tgrid-column-start: 4;\n\tgrid-column-end: 5;\n}\n\n.beepboxEditor button.playButton.shrunk, .beepboxEditor button.recordButton.shrunk {\n\tpadding: 0;\n}\n.beepboxEditor button.playButton.shrunk::before, .beepboxEditor button.recordButton.shrunk::before {\n\tleft: 50%;\n\ttop: 50%;\n\ttransform: translate(-50%, -50%);\n}\n.beepboxEditor button.playButton.shrunk span, .beepboxEditor button.recordButton.shrunk span {\n\tdisplay: none;\n}\n.beepboxEditor button.playButton.shrunk {\n\tgrid-column-start: 1;\n\tgrid-column-end: 2;\n}\n.beepboxEditor button.recordButton.shrunk {\n\tgrid-column-start: 2;\n\tgrid-column-end: 3;\n}\n\n.beepboxEditor button.cancelButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--close-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--close-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor button.okayButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\t-webkit-mask-image: var(--checkmark-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n\tmask-image: var(--checkmark-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n}\n\n.beepboxEditor button.exportButton::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: var(--button-size);\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--export-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--export-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor .instrument-bar {\n\tdisplay: flex;\n\tgap: 2px;\n}\n\n.beepboxEditor .instrument-bar button {\n\tflex-grow: 1;\n\tmin-width: 0;\n\tpadding: 0;\n\tflex-basis: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcolor: var(--text-color-lit);\n}\n\n.beepboxEditor .instrument-bar .remove-instrument, .beepboxEditor .instrument-bar .add-instrument {\n\tmax-width: var(--button-size);\n}\n\n.beepboxEditor .instrument-bar > :not(:first-child) {\n\tborder-top-left-radius: 0;\n\tborder-bottom-left-radius: 0;\n}\n\n.beepboxEditor .instrument-bar > :not(.last-button) {\n\tborder-top-right-radius: 0;\n\tborder-bottom-right-radius: 0;\n\tborder-bottom: inset;\n\tborder-color: var(--background-color-dim);\n}\n\n.beepboxEditor .instrument-bar .selected-instrument {\n\tbackground: var(--background-color-lit);\n\tcolor: ${j.invertedText};\n}\n\n.beepboxEditor .instrument-bar .deactivated {\n\tbackground: ${j.editorBackground};\n\tcolor: var(--text-color-dim);\n\tborder-bottom: unset;\n}\n\n.beepboxEditor .instrument-bar .deactivated.selected-instrument {\n\tbackground: var(--background-color-dim);\n\tcolor: ${j.invertedText};\n}\n\n.beepboxEditor .instrument-bar .remove-instrument {\n\tborder-bottom: unset;\n}\n\n.beepboxEditor .instrument-bar .remove-instrument::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 100%;\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--close-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--close-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor .instrument-bar .add-instrument {\n\tborder-bottom: unset;\n}\n\n.beepboxEditor .instrument-bar .no-underline {\n\tborder-bottom: unset;\n}\n\n.beepboxEditor .instrument-bar .add-instrument::before {\n\tcontent: "";\n\tposition: absolute;\n\twidth: 100%;\n\theight: var(--button-size);\n\tleft: 0;\n\ttop: 0;\n\tpointer-events: none;\n\tbackground: currentColor;\n\tmask-image: var(--add-symbol);\n\tmask-repeat: no-repeat;\n\tmask-position: center;\n\t-webkit-mask-image: var(--add-symbol);\n\t-webkit-mask-repeat: no-repeat;\n\t-webkit-mask-position: center;\n}\n\n.beepboxEditor canvas {\n\toverflow: hidden;\n\tposition: absolute;\n\tdisplay: block;\n  cursor: crosshair;\n}\n\n@keyframes dash-animation {\n  to {\n    stroke-dashoffset: -100;\n  }\n}\n\n.beepboxEditor .dash-move {\n  animation: dash-animation 20s infinite linear;\n}\n\n.beepboxEditor .trackContainer {\n\tflex-grow: 1;\n}\n\n.beepboxEditor .trackAndMuteContainer {\n\tdisplay: flex;\n\talign-items: flex-start;\n\twidth: 100%;\n\tmin-height: 0;\n\tflex: 1;\n\toverflow-x: hidden;\n\tposition: relative;\n}\n\n.beepboxEditor .muteEditor {\n\twidth: 32px;\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: stretch;\n\tposition: sticky;\n\tleft: 0;\n\tz-index: 1;\n\tbackground: ${j.editorBackground};\n}\n\n.beepboxEditor .selectRow, .beepboxEditor .instrumentCopyPasteRow {\n\tmargin: 2px 0;\n\theight: var(--button-size);\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\tjustify-content: space-between;\n}\n\n.beepboxEditor .selectRow > :last-child {\n\twidth: 62.5%;\n\tflex-shrink: 0;\n}\n\n.beepboxEditor .menu-area {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n.beepboxEditor .menu-area > * {\n\tmargin: 2px 0;\n}\n.beepboxEditor .menu-area > button {\n\tpadding: 0 var(--button-size);\n\twhite-space: nowrap;\n}\n\n.beepboxEditor .song-settings-area {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-controls {\n\tflex-shrink: 0;\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .instrument-settings-area {\n\tdisplay: flex;\n\tflex-direction: column;\n}\n\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\n\tflex-shrink: 0;\n}\n\n.beepboxEditor .pitchShiftMarkerContainer {\n\tbox-sizing: border-box;\n\tdisplay: flex;\n\theight: 100%;\n\tleft: 3px;\n\tright: 3px;\n\tposition: absolute;\n\talign-items: center;\n\tpointer-events: none;\n}\n\n.beepboxEditor .pitchShiftMarker {\n\twidth: 0;\n\theight: 0;\n\tposition: absolute;\n}\n\n.beepboxEditor .pitchShiftMarker::before {\n\tcontent: "";\n\twidth: 2px;\n\theight: 20px;\n\ttransform: translate(-50%, -50%);\n\tposition: absolute;\n\tbackground: currentColor;\n\tborder-radius: 3px;\n}\n\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\n\tfont-size: inherit;\n\tfont-weight: inherit;\n\tfont-family: inherit;\n\tbackground: transparent;\n\ttext-align: center;\n\tborder: 1px solid ${j.inputBoxOutline};\n\tcolor: ${j.primaryText};\n}\n\n.beepboxEditor input[type=text]::selection, .beepboxEditor input[type=number]::selection {\n\tbackground-color: ${j.textSelection};\n\tcolor: ${j.primaryText};\n}\n\n.beepboxEditor input[type=checkbox] {\n  transform: scale(1.5);\n}\n\n.beepboxEditor input[type=range] {\n\t-webkit-appearance: none;\n\tcolor: inherit;\n\twidth: 100%;\n\theight: var(--button-size);\n\tfont-size: inherit;\n\tmargin: 0;\n\tcursor: pointer;\n\tbackground: none;\n\ttouch-action: pan-y;\n  position: relative;\n}\n.beepboxEditor input[type=range]:focus {\n\toutline: none;\n}\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\n\twidth: 100%;\n\theight: 6px;\n\tcursor: pointer;\n\tbackground: ${j.uiWidgetBackground};\n}\n\n.modTarget:hover {\n\tfill: ${j.hoverPreview} !important;\n}\n\n.beepboxEditor span.midTick:after {\n    content: "";\n    display:inline-block;\n    position: absolute;\n    background: currentColor;\n    width: 2%;\n    left: 49%;\n    height: 0.5em;\n    top: 32%;\n    z-index: 1;\n\t\tpointer-events: none;\n}\n.beepboxEditor span.modSlider {\n\t--mod-position: 20%;\n\t--mod-color: ${j.overwritingModSlider};\n  --mod-border-radius: 0%;\n}\n.beepboxEditor span.modSlider:before {\n\tcontent: "";\n    display:inline-block;\n    position: absolute;\n    background: var(--mod-color);\n    width: 4%;\n    left: var(--mod-position);\n    height: 0.8em;\n    top: 28%;\n    z-index: 2;\n\t\ttransform: translate(-50%, 0%);\n\t\tpointer-events: none;\n\t\tborder: 40%;\n\t\tborder-radius: var(--mod-border-radius);\n}\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\n\theight: var(--button-size);\n\twidth: 6px;\n\tborder-radius: 3px;\n\tbackground: currentColor;\n\tcursor: pointer;\n\t-webkit-appearance: none;\n\tmargin-top: -10px;\n}\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\n\tbackground: ${j.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-moz-range-track {\n\twidth: 100%;\n\theight: 6px;\n\tcursor: pointer;\n\tbackground: ${j.uiWidgetBackground};\n}\n.beepboxEditor input[type=range]:focus::-moz-range-track {\n\tbackground: ${j.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-moz-range-thumb {\n\theight: var(--button-size);\n\twidth: 6px;\n\tborder-radius: 3px;\n\tborder: none;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n.beepboxEditor input[type=range]::-ms-track {\n\twidth: 100%;\n\theight: 6px;\n\tcursor: pointer;\n\tbackground: ${j.uiWidgetBackground};\n\tborder-color: transparent;\n}\n.beepboxEditor input[type=range]:focus::-ms-track {\n\tbackground: ${j.uiWidgetFocus};\n}\n.beepboxEditor input[type=range]::-ms-thumb {\n\theight: var(--button-size);\n\twidth: 6px;\n\tborder-radius: 3px;\n\tbackground: currentColor;\n\tcursor: pointer;\n}\n\nli.select2-results__option[role=group] > strong:hover {\n  background-color: #516fbb;\n}\n\n/* wide screen */\n@media (min-width: 711px) {\n\t#beepboxEditorContainer {\n\t\tdisplay: table;\n\t}\n\t.beepboxEditor {\n\t\tflex-direction: row;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: 3px solid ${j.uiWidgetBackground};\n\t}\n\t.beepboxEditor .trackAndMuteContainer {\n\t\twidth: 512px;\n\t}\n\t.beepboxEditor .trackSelectBox {\n\t\tdisplay: none;\n\t}\n    .beepboxEditor .muteButtonSelectBox {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .play-pause-area {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tmargin: 2px 0;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\tmargin: 2px 0;\n\t\talign-items: center;\n\t}\n\t.beepboxEditor .settings-area {\n\t\twidth: var(--settings-area-width);\n\t}\n}\n\n/* narrow screen */\n@media (max-width: 710px) {\n\t.beepboxEditor {\n\t\tgrid-template-columns: minmax(0, 1fr);\n\t\tgrid-template-rows: min-content 6px min-content min-content;\n\t\tgrid-template-areas: "pattern-area" "." "track-area" "settings-area";\n\t\tgrid-row-gap: 0;\n\t}\n\t.beepboxEditor .settings-area {\n\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr);\n\t\tgrid-template-rows: min-content min-content 1fr min-content;\n\t\tgrid-template-areas:\n\t\t\t"play-pause-area play-pause-area"\n\t\t\t"menu-area instrument-settings-area"\n\t\t\t"song-settings-area instrument-settings-area"\n\t\t\t"version-area version-area";\n\t\tgrid-column-gap: 8px;\n\t\tmargin: 0 4px;\n\t}\n\t.beepboxEditor:focus-within {\n\t\toutline: none;\n\t}\n\t.beepboxEditor .pattern-area {\n\t\tmax-height: 75vh;\n\t}\n\t.beepboxEditor .trackAndMuteContainer {\n\t\toverflow-x: auto;\n\t}\n\t.beepboxEditor .barScrollBar {\n\t\tdisplay: none;\n\t}\n\t.beepboxEditor .play-pause-area {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr);\n\t\tgrid-column-gap: 8px;\n\t\tmargin: 2px 0;\n\t}\n\t.beepboxEditor .playback-bar-controls {\n\t\tflex-grow: 1;\n\t}\n\t.beepboxEditor .playback-volume-controls {\n\t\tdisplay: flex;\n\t\tflex-direction: row;\n\t\talign-items: center;\n\t\tflex-grow: 1;\n\t}\n\t\n\t.beepboxEditor .soundIcon {\n\t  background: ${j.editorBackground};\n\t  display: inline-block;\n\t  height: 10px;\n\t  margin-left: 0px;\n\t  margin-top: 8px;\n\t\tposition: relative;\n\t\twidth: 10px;\n\t}\n\t.beepboxEditor .soundIcon:before {\n\t  border-bottom: 6px solid transparent;\n\t  border-top: 6px solid transparent;\n\t  border-right: 10px solid ${j.editorBackground};\n\t  content: "";\n\t  height: 10px;\n\t  left: 6px;\n\t  position: absolute;\n\t  top: -6px;\n\t  width: 0;\n\t}\n}\n\n`)); class W { constructor(t, e) { this.l = t, this.u = e, this.m = 512, this.v = 20, this.k = B.rect("rect", { fill: j.playhead, x: 0, y: 0, width: 2, height: this.v }), this.M = B.svg({ "pointer-events": "none" }), this.S = B.rect({ fill: j.uiWidgetBackground, x: 0, y: 2, width: 10, height: this.v - 4 }), this.T = B.rect({ fill: "none", stroke: j.hoverPreview, "stroke-width": 2, "pointer-events": "none", x: 0, y: 1, width: 10, height: this.v - 2 }), this.I = B.path({ fill: j.hoverPreview, "pointer-events": "none" }), this.P = B.path({ fill: j.hoverPreview, "pointer-events": "none" }), this.L = -1, this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: pan-y; position: absolute;`, width: this.m, height: this.v }, this.M, this.S, this.T, this.I, this.P, this.k), this.container = z.div({ class: "barScrollBar", style: "width: 512px; height: 20px; overflow: hidden; position: relative;" }, this.q), this.N = 0, this.R = !1, this.O = !1, this.$ = !1, this.H = -1, this.V = -1, this.animatePlayhead = () => { const t = Math.min(512, Math.max(0, this._ * this.l.synth.playhead - 2)); this.L != t && (this.L = t, this.k.setAttribute("x", "" + t)) }, this.j = t => { this.l.barScrollPos = this.u.scrollLeft / this.l.getBarWidth() }, this.U = t => { this.O || (this.O = !0, this.W()) }, this.K = t => { this.O && (this.O = !1, this.W()) }, this.J = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - e.left, this.W(), this.N >= this.l.barScrollPos * this._ && this.N <= (this.l.barScrollPos + this.l.trackVisibleBars) * this._ && (this.$ = !0, this.Y = this.N) }, this.X = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - e.left, this.W(), this.N >= this.l.barScrollPos * this._ && this.N <= (this.l.barScrollPos + this.l.trackVisibleBars) * this._ && (this.$ = !0, this.Y = this.N) }, this.Z = t => { const e = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - e.left, this.tt() }, this.et = t => { if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - e.left, this.tt() }, this.it = t => { !this.$ && this.R && (this.N < (this.l.barScrollPos + 8) * this._ ? (this.l.barScrollPos > 0 && this.l.barScrollPos--, this.l.notifier.changed()) : (this.l.barScrollPos < this.l.song.barCount - this.l.trackVisibleBars && this.l.barScrollPos++, this.l.notifier.changed())), this.R = !1, this.$ = !1, this.W() }; const i = .5 * this.v; this.I.setAttribute("d", `M 9 ${i} L 20 ${i + 6} L 20 ${i - 6} z`), this.P.setAttribute("d", `M ${this.m - 9} ${i} L ${this.m - 20} ${i + 6} L ${this.m - 20} ${i - 6} z`), this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("mouseover", this.U), this.container.addEventListener("mouseout", this.K), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it), this.u.addEventListener("scroll", this.j, { capture: !1, passive: !0 }) } tt() { if (this.$) { for (; this.N - this.Y < .5 * -this._ && this.l.barScrollPos > 0;)this.l.barScrollPos--, this.Y -= this._, this.l.notifier.changed(); for (; this.N - this.Y > .5 * this._ && this.l.barScrollPos < this.l.song.barCount - this.l.trackVisibleBars;)this.l.barScrollPos++, this.Y += this._, this.l.notifier.changed() } this.O && this.W() } changePos(t) { for (; Math.abs(t) >= 1;)t < 0 ? this.l.barScrollPos > 0 && (this.l.barScrollPos--, this.Y += this._, this.l.notifier.changed()) : this.l.barScrollPos < this.l.song.barCount - this.l.trackVisibleBars && (this.l.barScrollPos++, this.Y += this._, this.l.notifier.changed()), t += t > 0 ? -1 : 1 } W() { let t = !1, e = !1, i = !1; this.O && !this.R && (this.N < this.l.barScrollPos * this._ ? t = !0 : this.N > (this.l.barScrollPos + this.l.trackVisibleBars) * this._ ? e = !0 : i = !0), this.I.style.visibility = t ? "visible" : "hidden", this.P.style.visibility = e ? "visible" : "hidden", this.T.style.visibility = i ? "visible" : "hidden" } render() { this._ = (this.m - 1) / Math.max(this.l.trackVisibleBars, this.l.song.barCount); const t = this.H != this.l.song.barCount; if (t) { for (this.H = this.l.song.barCount; this.M.firstChild;)this.M.removeChild(this.M.firstChild); for (let t = 0; t <= this.l.song.barCount; t++) { const e = t % 16 == 0 ? 0 : t % 4 == 0 ? this.v / 8 : this.v / 3; this.M.appendChild(B.rect({ fill: j.uiWidgetBackground, x: t * this._ - 1, y: e, width: 2, height: this.v - 2 * e })) } } this.l.barScrollPos = Math.max(0, Math.min(this.l.song.barCount - this.l.trackVisibleBars, this.l.barScrollPos)), this.l.channelScrollPos = Math.max(0, Math.min(this.l.song.getChannelCount() - this.l.trackVisibleChannels, this.l.channelScrollPos)), (t || this.V != this.l.barScrollPos) && (this.V = this.l.barScrollPos, this.S.setAttribute("x", String(this._ * this.l.barScrollPos)), this.S.setAttribute("width", String(this._ * this.l.trackVisibleBars)), this.T.setAttribute("x", String(this._ * this.l.barScrollPos)), this.T.setAttribute("width", String(this._ * this.l.trackVisibleBars))), this.W(), this.u.scrollLeft = this.l.barScrollPos * this.l.getBarWidth(), this.u.scrollTop = this.l.channelScrollPos * this.l.getChannelHeight() } } function K(t, e) { for (let i = 0; i < t.length; i++)t[i] *= e } function J(t) { if (!function (t) { return !(!t || t & t - 1) }(t)) throw new Error("FFT array length must be a power of 2."); return Math.round(Math.log(t) / Math.log(2)) } function Y(t, e) { const i = J(e); if (e < 4) throw new Error("FFT array length must be at least 4."); for (let s = i - 1; s >= 2; s--) { const i = 1 << s, n = i >> 1, o = i << 1, h = 2 * Math.PI / o, a = Math.cos(h), r = Math.sin(h), l = 2 * a; for (let s = 0; s < e; s += o) { const e = s, o = e + n, h = e + i, c = h + n, d = h + i, p = t[e], u = t[h]; t[e] = p + u, t[o] *= 2, t[h] = p - u, t[c] *= 2; let m = a, f = -r, y = 1, b = 0; for (let i = 1; i < n; i++) { const s = e + i, n = h - i, o = h + i, a = d - i, r = t[s], c = t[n], p = t[o], u = t[a], g = r - c, w = p + u; t[s] = r + c, t[n] = u - p, t[o] = g * m - w * f, t[a] = w * m + g * f; const v = l * m - y, k = l * f - b; y = m, b = f, m = v, f = k } } } for (let i = 0; i < e; i += 4) { const e = i + 1, s = i + 2, n = i + 3, o = t[i], h = 2 * t[e], a = t[s], r = 2 * t[n], l = o + a, c = o - a; t[i] = l + h, t[e] = l - h, t[s] = c + r, t[n] = c - r } !function (t, e) { const i = J(e); if (i > 16) throw new Error("FFT array length must not be greater than 2^16."); const s = 16 - i; for (let i = 0; i < e; i++) { let e; if (e = (43690 & i) >> 1 | (21845 & i) << 1, e = (52428 & e) >> 2 | (13107 & e) << 2, e = (61680 & e) >> 4 | (3855 & e) << 4, e = (e >> 8 | (255 & e) << 8) >> s, e > i) { let s = t[i]; t[i] = t[e], t[e] = s } } }(t, e) } class Q { constructor() { this.st = 1, this.nt = [void 0], this.ot = 0, this.ht = 0, this.at = 0 } pushFront(t) { this.at >= this.st && this.rt(), this.ht = this.ht - 1 & this.ot, this.nt[this.ht] = t, this.at++ } pushBack(t) { this.at >= this.st && this.rt(), this.nt[this.ht + this.at & this.ot] = t, this.at++ } popFront() { if (this.at <= 0) throw new Error("No elements left to pop."); const t = this.nt[this.ht]; return this.nt[this.ht] = void 0, this.ht = this.ht + 1 & this.ot, this.at--, t } popBack() { if (this.at <= 0) throw new Error("No elements left to pop."); this.at--; const t = this.ht + this.at & this.ot, e = this.nt[t]; return this.nt[t] = void 0, e } peakFront() { if (this.at <= 0) throw new Error("No elements left to pop."); return this.nt[this.ht] } peakBack() { if (this.at <= 0) throw new Error("No elements left to pop."); return this.nt[this.ht + this.at - 1 & this.ot] } count() { return this.at } set(t, e) { if (t < 0 || t >= this.at) throw new Error("Invalid index"); this.nt[this.ht + t & this.ot] = e } get(t) { if (t < 0 || t >= this.at) throw new Error("Invalid index"); return this.nt[this.ht + t & this.ot] } remove(t) { if (t < 0 || t >= this.at) throw new Error("Invalid index"); if (t <= this.at >> 1) { for (; t > 0;)this.set(t, this.get(t - 1)), t--; this.popFront() } else { for (t++; t < this.at;)this.set(t - 1, this.get(t)), t++; this.popBack() } } rt() { if (this.st >= 1073741824) throw new Error("Capacity too big."); this.st = this.st << 1; const t = this.nt, e = new Array(this.st), i = 0 | this.at, s = 0 | this.ht; for (let n = 0; n < i; n++)e[n] = t[s + n & this.ot]; for (let t = i; t < this.st; t++)e[t] = void 0; this.ht = 0, this.nt = e, this.ot = this.st - 1 } } class X { constructor() { this.a = [1], this.b = [1], this.order = 0 } linearGain0thOrder(t) { this.b[0] = t, this.order = 0 } lowPass1stOrderButterworth(t) { const e = 1 / Math.tan(.5 * t), i = 1 + e; this.a[1] = (1 - e) / i, this.b[1] = this.b[0] = 1 / i, this.order = 1 } lowPass1stOrderSimplified(t) { const e = 2 * Math.sin(.5 * t); this.a[1] = e - 1, this.b[0] = e, this.b[1] = 0, this.order = 1 } highPass1stOrderButterworth(t) { const e = 1 / Math.tan(.5 * t), i = 1 + e; this.a[1] = (1 - e) / i, this.b[0] = e / i, this.b[1] = -e / i, this.order = 1 } highShelf1stOrder(t, e) { const i = Math.tan(.5 * t), s = Math.sqrt(e), n = (i * s - 1) / (i * s + 1); this.a[1] = n / 1, this.b[0] = (1 + n + e * (1 - n)) / 2, this.b[1] = (1 + n - e * (1 - n)) / 2, this.order = 1 } allPass1stOrderInvertPhaseAbove(t) { const e = (Math.sin(t) - 1) / Math.cos(t); this.a[1] = e, this.b[0] = e, this.b[1] = 1, this.order = 1 } allPass1stOrderFractionalDelay(t) { const e = (1 - t) / (1 + t); this.a[1] = e, this.b[0] = e, this.b[1] = 1, this.order = 1 } lowPass2ndOrderButterworth(t, e) { const i = Math.sin(t) / (2 * e), s = Math.cos(t), n = 1 + i; this.a[1] = -2 * s / n, this.a[2] = (1 - i) / n, this.b[2] = this.b[0] = (1 - s) / (2 * n), this.b[1] = (1 - s) / n, this.order = 2 } lowPass2ndOrderSimplified(t, e) { const i = 2 * Math.sin(t / 2), s = 1 - 1 / (2 * e), n = s + s / (1 - i); this.a[1] = 2 * i + (i - 1) * i * n - 2, this.a[2] = (i - 1) * (i - i * n - 1), this.b[0] = i * i, this.b[1] = 0, this.b[2] = 0, this.order = 2 } highPass2ndOrderButterworth(t, e) { const i = Math.sin(t) / (2 * e), s = Math.cos(t), n = 1 + i; this.a[1] = -2 * s / n, this.a[2] = (1 - i) / n, this.b[2] = this.b[0] = (1 + s) / (2 * n), this.b[1] = -(1 + s) / n, this.order = 2 } peak2ndOrder(t, e, i) { const s = Math.sqrt(e), n = i * t / (s >= 1 ? s : 1 / s), o = Math.tan(.5 * n), h = 1 + o / s; this.b[0] = (1 + o * s) / h, this.b[1] = this.a[1] = -2 * Math.cos(t) / h, this.b[2] = (1 - o * s) / h, this.a[2] = (1 - o / s) / h, this.order = 2 } } class Z { constructor() { this.real = 0, this.imag = 0, this.denom = 1 } analyze(t, e) { this.analyzeComplex(t, Math.cos(e), Math.sin(e)) } analyzeComplex(t, e, i) { const s = t.a, n = t.b, o = e, h = -i; let a = n[0] + n[1] * o, r = n[1] * h, l = 1 + s[1] * o, c = s[1] * h, d = o, p = h; for (let e = 2; e <= t.order; e++) { const t = d * h + p * o; d = d * o - p * h, p = t, a += n[e] * d, r += n[e] * p, l += s[e] * d, c += s[e] * p } this.denom = l * l + c * c, this.real = a * l + r * c, this.imag = r * l - a * c } magnitude() { return Math.sqrt(this.real * this.real + this.imag * this.imag) / this.denom } angle() { return Math.atan2(this.imag, this.real) } } class tt { constructor() { this.a1 = 0, this.a2 = 0, this.b0 = 1, this.b1 = 0, this.b2 = 0, this.a1Delta = 0, this.a2Delta = 0, this.b0Delta = 0, this.b1Delta = 0, this.b2Delta = 0, this.output1 = 0, this.output2 = 0, this.useMultiplicativeInputCoefficients = !1 } resetOutput() { this.output1 = 0, this.output2 = 0 } loadCoefficientsWithGradient(t, e, i, s) { if (2 != t.order || 2 != e.order) throw new Error; this.a1 = t.a[1], this.a2 = t.a[2], this.b0 = t.b[0], this.b1 = t.b[1], this.b2 = t.b[2], this.a1Delta = (e.a[1] - t.a[1]) * i, this.a2Delta = (e.a[2] - t.a[2]) * i, s ? (this.b0Delta = Math.pow(e.b[0] / t.b[0], i), this.b1Delta = Math.pow(e.b[1] / t.b[1], i), this.b2Delta = Math.pow(e.b[2] / t.b[2], i)) : (this.b0Delta = (e.b[0] - t.b[0]) * i, this.b1Delta = (e.b[1] - t.b[1]) * i, this.b2Delta = (e.b[2] - t.b[2]) * i), this.useMultiplicativeInputCoefficients = s } } const et = 1e-24; function it(t, e, i) { return i <= (e -= 1) ? i >= t ? i : t : e } function st(t, e, i) { if (t <= i && i <= e) return i; throw new Error(`Value ${i} not in range [${t}, ${e}]`) } const nt = [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 45, 95], ot = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 62, 62, 0, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0, 0, 0, 0, 0, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 0, 0, 0, 0, 63, 0, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 0, 0, 0, 0, 0]; class ht { constructor(t, e, i) { this.lt = [], this.ct = 0; for (let s = e; s < i; s++) { const e = ot[t.charCodeAt(s)]; this.lt.push(e >> 5 & 1), this.lt.push(e >> 4 & 1), this.lt.push(e >> 3 & 1), this.lt.push(e >> 2 & 1), this.lt.push(e >> 1 & 1), this.lt.push(1 & e) } } read(t) { let e = 0; for (; t > 0;)e <<= 1, e += this.lt[this.ct++], t--; return e } readLongTail(t, e) { let i = t, s = e; for (; this.lt[this.ct++];)i += 1 << s, s++; for (; s > 0;)s--, this.lt[this.ct++] && (i += 1 << s); return i } readPartDuration() { return this.readLongTail(1, 3) } readLegacyPartDuration() { return this.readLongTail(1, 2) } readPinCount() { return this.readLongTail(1, 0) } readPitchInterval() { return this.read(1) ? -this.readLongTail(1, 3) : this.readLongTail(1, 3) } } class at { constructor() { this.dt = 0, this.lt = [] } clear() { this.dt = 0 } write(t, e) { for (t--; t >= 0;)this.lt[this.dt++] = e >>> t & 1, t-- } writeLongTail(t, e, i) { if (i < t) throw new Error("value out of bounds"); i -= t; let s = e; for (; i >= 1 << s;)this.lt[this.dt++] = 1, i -= 1 << s, s++; for (this.lt[this.dt++] = 0; s > 0;)s--, this.lt[this.dt++] = i >>> s & 1 } writePartDuration(t) { this.writeLongTail(1, 3, t) } writePinCount(t) { this.writeLongTail(1, 0, t) } writePitchInterval(t) { t < 0 ? (this.write(1, 1), this.writeLongTail(1, 3, -t)) : (this.write(1, 0), this.writeLongTail(1, 3, t)) } concat(t) { for (let e = 0; e < t.dt; e++)this.lt[this.dt++] = t.lt[e] } encodeBase64(t) { for (let e = 0; e < this.dt; e += 6) { const i = this.lt[e] << 5 | this.lt[e + 1] << 4 | this.lt[e + 2] << 3 | this.lt[e + 3] << 2 | this.lt[e + 4] << 1 | this.lt[e + 5]; t.push(nt[i]) } return t } lengthBase64() { return Math.ceil(this.dt / 6) } } function rt(t, e, i) { return { interval: t, time: e, size: i } } class lt { constructor(t, e, i, s, n = !1) { this.pitches = [t], this.pins = [rt(0, 0, s), rt(0, i - e, n ? 0 : s)], this.start = e, this.end = i, this.continuesLastPattern = !1 } pickMainInterval() { let t = 0, e = 0; for (let i = 1; i < this.pins.length; i++) { const s = this.pins[i - 1], n = this.pins[i]; if (s.interval == n.interval) { const i = n.time - s.time; t < i && (t = i, e = s.interval) } } if (0 == t) { let t = 0; for (let i = 0; i < this.pins.length; i++) { const s = this.pins[i]; t < s.size && (t = s.size, e = s.interval) } } return e } clone() { const t = new lt(-1, this.start, this.end, 3); t.pitches = this.pitches.concat(), t.pins = []; for (const e of this.pins) t.pins.push(rt(e.interval, e.time, e.size)); return t.continuesLastPattern = this.continuesLastPattern, t } getEndPinIndex(t) { let e; for (e = 1; e < this.pins.length - 1 && !(this.pins[e].time + this.start > t); e++); return e } } class ct { constructor() { this.notes = [], this.instruments = [0] } cloneNotes() { const t = []; for (const e of this.notes) t.push(e.clone()); return t } reset() { this.notes.length = 0, this.instruments[0] = 0, this.instruments.length = 1 } toJsonObject(t, i, s) { const n = []; for (const o of this.notes) { let h = i.instruments[this.instruments[0]], a = Math.max(0, e.modCount - o.pitches[0] - 1), r = t.getVolumeCapForSetting(s, h.modulators[a], h.modFilterTypes[a]); const l = []; for (const i of o.pins) { let n = s ? Math.round(i.size) : Math.round(100 * i.size / r); l.push({ tick: (i.time + o.start) * e.rhythms[t.rhythm].stepsPerBeat / e.partsPerBeat, pitchBend: i.interval, volume: n, forMod: s }) } const c = { pitches: o.pitches, points: l }; 0 == o.start && (c.continuesLastPattern = o.continuesLastPattern), n.push(c) } const o = { notes: n }; return t.patternInstruments && (o.instruments = this.instruments.map((t => t + 1))), o } fromJsonObject(t, i, s, n, o, h) { if (i.patternInstruments) if (Array.isArray(t.instruments)) { const n = t.instruments, o = it(e.instrumentCountMin, i.getMaxInstrumentsPerPatternForChannel(s) + 1, n.length); for (let t = 0; t < o; t++)this.instruments[t] = it(0, s.instruments.length, (0 | n[t]) - 1); this.instruments.length = o } else this.instruments[0] = it(0, s.instruments.length, (0 | t.instrument) - 1), this.instruments.length = 1; if (t.notes && t.notes.length > 0) { const a = Math.min(i.beatsPerBar * e.partsPerBeat * (h ? e.modCount : 1), t.notes.length >>> 0); for (let r = 0; r < t.notes.length && !(r >= a); r++) { const a = t.notes[r]; if (!(a && a.pitches && a.pitches.length >= 1 && a.points && a.points.length >= 2)) continue; const l = new lt(0, 0, 0, 0); l.pitches = [], l.pins = []; for (let t = 0; t < a.pitches.length; t++) { const i = 0 | a.pitches[t]; if (-1 == l.pitches.indexOf(i) && (l.pitches.push(i), l.pitches.length >= e.maxChordSize)) break } if (l.pitches.length < 1) continue; let c = 0; for (let t = 0; t < a.points.length; t++) { const o = a.points[t]; if (null == o || null == o.tick) continue; const r = null == o.pitchBend ? 0 : 0 | o.pitchBend, d = Math.round(+o.tick * e.partsPerBeat / n); let p, u = s.instruments[this.instruments[0]], m = Math.max(0, e.modCount - l.pitches[0] - 1), f = i.getVolumeCapForSetting(h, u.modulators[m], u.modFilterTypes[m]); p = null == o.volume ? f : null == o.forMod ? Math.max(0, Math.min(f, Math.round((0 | o.volume) * f / 100))) : (0 | o.forMod) > 0 ? Math.round(0 | o.volume) : Math.max(0, Math.min(f, Math.round((0 | o.volume) * f / 100))), d > i.beatsPerBar * e.partsPerBeat || (0 == l.pins.length && (l.start = d, c = r), l.pins.push(rt(r - c, d - l.start, p))) } if (l.pins.length < 2) continue; l.end = l.pins[l.pins.length - 1].time + l.start; const d = o ? e.drumCount - 1 : e.maxPitch; let p = d, u = 0; for (let t = 0; t < l.pitches.length; t++)l.pitches[t] += c, (l.pitches[t] < 0 || l.pitches[t] > d) && (l.pitches.splice(t, 1), t--), l.pitches[t] < p && (p = l.pitches[t]), l.pitches[t] > u && (u = l.pitches[t]); if (!(l.pitches.length < 1)) { for (let t = 0; t < l.pins.length; t++) { const e = l.pins[t]; e.interval + p < 0 && (e.interval = -p), e.interval + u > d && (e.interval = d - u), t >= 2 && e.interval == l.pins[t - 1].interval && e.interval == l.pins[t - 2].interval && e.size == l.pins[t - 1].size && e.size == l.pins[t - 2].size && (l.pins.splice(t - 1, 1), t--) } 0 == l.start ? l.continuesLastPattern = !0 === a.continuesLastPattern : l.continuesLastPattern = !1, this.notes.push(l) } } } } } class dt { constructor(t) { this.frequency = 0, this.amplitude = 0, this.waveform = 0, this.pulseWidth = .5, this.reset(t) } reset(t) { this.frequency = 0, this.amplitude = t <= 1 ? e.operatorAmplitudeMax : 0, this.waveform = 0, this.pulseWidth = 5 } copy(t) { this.frequency = t.frequency, this.amplitude = t.amplitude, this.waveform = t.waveform, this.pulseWidth = t.pulseWidth } } class pt { constructor(t) { this.spectrum = [], this.hash = -1, this.reset(t) } reset(t) { for (let i = 0; i < e.spectrumControlPoints; i++)if (t) this.spectrum[i] = Math.round(e.spectrumMax * (1 / Math.sqrt(1 + i / 3))); else { const t = 0 == i || 7 == i || 11 == i || 14 == i || 16 == i || 18 == i || 21 == i || 23 == i || i >= 25; this.spectrum[i] = t ? Math.max(0, Math.round(e.spectrumMax * (1 - i / 30))) : 0 } this.markCustomWaveDirty() } markCustomWaveDirty() { const t = Et.fittingPowerOfTwo(e.spectrumMax + 2) - 1; let i = 0; for (const e of this.spectrum) i = i * t + e >>> 0; this.hash = i } } class ut { constructor() { this.wave = null, this.ut = -1 } getCustomWave(t, i) { if (this.ut == t.hash) return this.wave; this.ut = t.hash; const s = e.spectrumNoiseLength; null != this.wave && this.wave.length == s + 1 || (this.wave = new Float32Array(s + 1)); const n = this.wave; for (let t = 0; t < s; t++)n[t] = 0; const o = [0, 1 / 7, Math.log2(5 / 4), 3 / 7, Math.log2(1.5), 5 / 7, 6 / 7]; function a(t) { return i + Math.floor(t / e.spectrumControlPointsPerOctave) + o[(t + e.spectrumControlPointsPerOctave) % e.spectrumControlPointsPerOctave] } let r = 1; for (let i = 0; i < e.spectrumControlPoints + 1; i++) { const o = i <= 0 ? 0 : t.spectrum[i - 1], l = i >= e.spectrumControlPoints ? t.spectrum[e.spectrumControlPoints - 1] : t.spectrum[i], c = a(i - 1); let d = a(i); i >= e.spectrumControlPoints && (d = 14 + .25 * (d - 14)), 0 == o && 0 == l || (r += .02 * h(n, s, c, d, o / e.spectrumMax, l / e.spectrumMax, -.5)) } return t.spectrum[e.spectrumControlPoints - 1] > 0 && (r += .02 * h(n, s, 14 + .25 * (a(e.spectrumControlPoints) - 14), 14, t.spectrum[e.spectrumControlPoints - 1] / e.spectrumMax, 0, -.5)), Y(n, s), K(n, 5 / (Math.sqrt(s) * Math.pow(r, .75))), n[s] = n[0], n } } class mt { constructor() { this.harmonics = [], this.hash = -1, this.reset() } reset() { for (let t = 0; t < e.harmonicsControlPoints; t++)this.harmonics[t] = 0; this.harmonics[0] = e.harmonicsMax, this.harmonics[3] = e.harmonicsMax, this.harmonics[6] = e.harmonicsMax, this.markCustomWaveDirty() } markCustomWaveDirty() { const t = Et.fittingPowerOfTwo(e.harmonicsMax + 2) - 1; let i = 0; for (const e of this.harmonics) i = i * t + e >>> 0; this.hash = i } } class ft { constructor() { this.wave = null, this.ut = -1 } getCustomWave(t, i) { if (this.ut == t.hash && this.ft == i) return this.wave; this.ut = t.hash, this.ft = i; const s = 7 == i ? e.harmonicsRenderedForPickedString : e.harmonicsRendered, n = e.harmonicsWavelength, h = o(0, null, null); null != this.wave && this.wave.length == n + 1 || (this.wave = new Float32Array(n + 1)); const a = this.wave; for (let t = 0; t < n; t++)a[t] = 0; let r = 1; for (let i = 0; i < s; i++) { const o = i + 1; let l = i < e.harmonicsControlPoints ? t.harmonics[i] : t.harmonics[e.harmonicsControlPoints - 1]; i >= e.harmonicsControlPoints && (l *= 1 - (i - e.harmonicsControlPoints) / (s - e.harmonicsControlPoints)); const c = l / e.harmonicsMax; let d = Math.pow(2, l - e.harmonicsMax + 1) * Math.sqrt(c); i < e.harmonicsControlPoints && (r += d), d *= Math.pow(o, -.25), d *= h[i + 589], a[n - o] = d } Y(a, n); const l = 1 / Math.pow(r, .7); for (let t = 0; t < a.length; t++)a[t] *= l; return function (t) { let e = 0; for (let i = 0; i < t.length; i++) { const s = t[i]; t[i] = e, e += s } }(a), a[n] = a[0], a } } class yt { constructor() { this.freq = 0, this.gain = e.filterGainCenter, this.type = 2 } set(t, e) { this.freq = t, this.gain = e } getHz() { return yt.getHzFromSettingValue(this.freq) } static getHzFromSettingValue(t) { return e.filterFreqReferenceHz * Math.pow(2, (t - e.filterFreqReferenceSetting) * e.filterFreqStep) } static getSettingValueFromHz(t) { return Math.log2(t / e.filterFreqReferenceHz) / e.filterFreqStep + e.filterFreqReferenceSetting } static getRoundedSettingValueFromHz(t) { return Math.max(0, Math.min(e.filterFreqRange - 1, Math.round(yt.getSettingValueFromHz(t)))) } getLinearGain(t = 1) { const i = (this.gain - e.filterGainCenter) * e.filterGainStep, s = 2 == this.type ? 0 : -.5, n = s + (i - s) * t; return Math.pow(2, n) } static getRoundedSettingValueFromLinearGain(t) { return Math.max(0, Math.min(e.filterGainRange - 1, Math.round(Math.log2(t) / e.filterGainStep + e.filterGainCenter))) } toCoefficients(t, i, s = 1, n = 1) { const o = 2 * Math.PI * Math.max(e.filterFreqMinHz, Math.min(e.filterFreqMaxHz, s * this.getHz())) / i, h = this.getLinearGain(n); switch (this.type) { case 0: t.lowPass2ndOrderButterworth(o, h); break; case 1: t.highPass2ndOrderButterworth(o, h); break; case 2: t.peak2ndOrder(o, h, 1); break; default: throw new Error } } getVolumeCompensationMult() { const t = (this.freq - e.filterFreqReferenceSetting) * e.filterFreqStep, i = (this.gain - e.filterGainCenter) * e.filterGainStep; switch (this.type) { case 0: const s = Math.pow(2, t) * e.filterFreqReferenceHz / 8e3, n = (Math.sqrt(1 + 4 * s) - 1) / 2, o = Math.log2(n); return Math.pow(.5, .2 * Math.max(0, i + 1) + Math.min(0, Math.max(-3, .595 * o + .35 * Math.min(0, i + 1)))); case 1: return Math.pow(.5, .125 * Math.max(0, i + 1) + Math.min(0, .3 * (-t - Math.log2(e.filterFreqReferenceHz / 125)) + .2 * Math.min(0, i + 1))); case 2: const h = t + Math.log2(e.filterFreqReferenceHz / 2e3), a = Math.pow(1 / (1 + Math.pow(h / 3, 2)), 2); return Math.pow(.5, .125 * Math.max(0, i) + .1 * a * Math.min(0, i)); default: throw new Error } } } class bt { constructor() { this.controlPoints = [], this.controlPointCount = 0, this.reset() } reset() { this.controlPointCount = 0 } addPoint(t, e, i) { let s; this.controlPoints.length <= this.controlPointCount ? (s = new yt, this.controlPoints[this.controlPointCount] = s) : s = this.controlPoints[this.controlPointCount], this.controlPointCount++, s.type = t, s.set(e, i) } toJsonObject() { const t = []; for (let i = 0; i < this.controlPointCount; i++) { const s = this.controlPoints[i]; t.push({ type: e.filterTypeNames[s.type], cutoffHz: Math.round(100 * s.getHz()) / 100, linearGain: Math.round(1e4 * s.getLinearGain()) / 1e4 }) } return t } fromJsonObject(t) { if (this.controlPoints.length = 0, t) for (const i of t) { const t = new yt; t.type = e.filterTypeNames.indexOf(i.type), -1 == t.type && (t.type = 2), null != i.cutoffHz ? t.freq = yt.getRoundedSettingValueFromHz(i.cutoffHz) : t.freq = 0, null != i.linearGain ? t.gain = yt.getRoundedSettingValueFromLinearGain(i.linearGain) : t.gain = e.filterGainCenter, this.controlPoints.push(t) } this.controlPointCount = this.controlPoints.length } static filtersCanMorph(t, e) { if (t.controlPointCount != e.controlPointCount) return !1; for (let i = 0; i < t.controlPointCount; i++)if (t.controlPoints[i].type != e.controlPoints[i].type) return !1; return !0 } static lerpFilters(t, e, i) { let s = new bt; if (null == t) return t; if (null == e) return e; if (i = Math.max(0, Math.min(1, i)), this.filtersCanMorph(t, e)) { for (let n = 0; n < t.controlPointCount; n++)s.controlPoints[n] = new yt, s.controlPoints[n].type = t.controlPoints[n].type, s.controlPoints[n].freq = t.controlPoints[n].freq + (e.controlPoints[n].freq - t.controlPoints[n].freq) * i, s.controlPoints[n].gain = t.controlPoints[n].gain + (e.controlPoints[n].gain - t.controlPoints[n].gain) * i; return s.controlPointCount = t.controlPointCount, s } return i >= 1 ? e : t } convertLegacySettings(t, e, i) { this.reset(); const s = 2 * Math.asin(.475), n = e > 1, o = 0 == e, h = 10 == t, a = 3 == i.type || 4 == i.type || 8 == i.type || 0 == i.type, r = 48e3, l = 8e3 * Math.pow(2, .5 * (t - 10)), c = Math.min(s, 2 * Math.PI * l / r); if (1 == i.type && !n && h); else if (o) { const t = 3.5, e = c * Math.pow(2, t), i = r * (e / (1 + e / Math.PI)) / (2 * Math.PI), s = yt.getRoundedSettingValueFromHz(i), n = yt.getHzFromSettingValue(s), o = 2 * Math.PI * n / r, h = new X; h.lowPass1stOrderSimplified(c); const l = new Z; l.analyze(h, o); const d = l.magnitude(); let p = Math.log2(d); p = .82 * (p + t) - t, a && (p = Math.min(p, -1)); const u = Math.pow(2, p), m = yt.getRoundedSettingValueFromLinearGain(u); this.addPoint(0, s, m) } else { const t = .5 / (1 - .95 * Math.sqrt(Math.max(0, e - 1) / 6)), i = .5 / t, s = c + (c * (c / (2 * Math.PI * 8e3 / r) * Math.pow(i, .9) + 1) - c) * i; let o; o = a ? r * Math.min(s, c * Math.pow(2, .25)) / (2 * Math.PI) : r * s / (2 * Math.PI); const h = yt.getRoundedSettingValueFromHz(o); let l; if (a) l = t; else { const e = new X; e.lowPass2ndOrderSimplified(c, t); const i = new Z; i.analyze(e, s), l = i.magnitude() } n || (l = Math.min(l, Math.sqrt(.5))); const d = yt.getRoundedSettingValueFromLinearGain(l); this.addPoint(0, h, d) } this.controlPoints.length = this.controlPointCount } convertLegacySettingsForSynth(t, e, i = !1) { this.reset(); const s = 2 * Math.asin(.475), n = 0 == e && i, o = 48e3, h = 8e3 * Math.pow(2, .5 * (t - 10)), a = Math.min(s, 2 * Math.PI * h / o); if (n) { const t = 3.5, e = a * Math.pow(2, t), i = o * (e / (1 + e / Math.PI)) / (2 * Math.PI), s = yt.getRoundedSettingValueFromHz(i), n = yt.getHzFromSettingValue(s), h = 2 * Math.PI * n / o, r = new X; r.lowPass1stOrderSimplified(a); const l = new Z; l.analyze(r, h); const c = l.magnitude(); let d = Math.log2(c); d = .82 * (d + t) - t; const p = Math.pow(2, d), u = yt.getRoundedSettingValueFromLinearGain(p); this.addPoint(0, s, u) } else { const t = .5 / (1 - .95 * Math.sqrt(Math.max(0, e - 1) / 6)), i = .5 / t, s = a + (a * (a / (2 * Math.PI * 8e3 / o) * Math.pow(i, .9) + 1) - a) * i; let n; n = o * s / (2 * Math.PI); const h = yt.getSettingValueFromHz(n); let r; const l = new X; l.lowPass2ndOrderSimplified(a, t); const c = new Z; c.analyze(l, s), r = c.magnitude(); const d = yt.getRoundedSettingValueFromLinearGain(r); this.addPoint(0, h, d) } } } class gt { constructor() { this.target = 0, this.index = 0, this.envelope = 0, this.reset() } reset() { this.target = 0, this.index = 0, this.envelope = 0 } toJsonObject() { const t = { target: e.instrumentAutomationTargets[this.target].name, envelope: e.envelopes[this.envelope].name }; return e.instrumentAutomationTargets[this.target].maxCount > 1 && (t.index = this.index), t } fromJsonObject(t) { this.reset(); let i = e.instrumentAutomationTargets.dictionary[t.target]; null == i && (i = e.instrumentAutomationTargets.dictionary.noteVolume), this.target = i.index; let s = e.envelopes.dictionary[t.envelope]; null == s && (s = e.envelopes.dictionary.none), this.envelope = s.index, null != t.index ? this.index = it(0, e.instrumentAutomationTargets[this.target].maxCount, 0 | t.index) : this.index = 0 } } class wt { constructor(t, i) { if (this.type = 0, this.preset = 0, this.chipWave = 2, this.chipNoise = 1, this.eqFilter = new bt, this.eqFilterType = !1, this.eqFilterSimpleCut = e.filterSimpleCutRange - 1, this.eqFilterSimplePeak = 0, this.noteFilter = new bt, this.noteFilterType = !1, this.noteFilterSimpleCut = e.filterSimpleCutRange - 1, this.noteFilterSimplePeak = 0, this.eqSubFilters = [], this.noteSubFilters = [], this.envelopes = [], this.fadeIn = 0, this.fadeOut = e.fadeOutNeutral, this.envelopeCount = 0, this.transition = e.transitions.dictionary.normal.index, this.pitchShift = 0, this.detune = 0, this.vibrato = 0, this.interval = 0, this.vibratoDepth = 0, this.vibratoSpeed = 10, this.vibratoDelay = 0, this.vibratoType = 0, this.unison = 0, this.effects = 0, this.chord = 1, this.volume = 0, this.pan = e.panCenter, this.panDelay = 10, this.arpeggioSpeed = 12, this.fastTwoNoteArp = !1, this.legacyTieOver = !1, this.clicklessTransition = !1, this.aliases = !1, this.pulseWidth = e.pulseWidthRange, this.stringSustain = 10, this.distortion = 0, this.bitcrusherFreq = 0, this.bitcrusherQuantization = 0, this.chorus = 0, this.reverb = 0, this.echoSustain = 0, this.echoDelay = 0, this.algorithm = 0, this.feedbackType = 0, this.feedbackAmplitude = 0, this.LFOtime = 0, this.nextLFOtime = 0, this.arpTime = 0, this.customChipWave = new Float32Array(64), this.customChipWaveIntegral = new Float32Array(65), this.operators = [], this.harmonicsWave = new mt, this.drumsetEnvelopes = [], this.drumsetSpectrumWaves = [], this.modChannels = [], this.modInstruments = [], this.modulators = [], this.modFilterTypes = [], this.invalidModulators = [], i) for (let t = 0; t < e.modCount; t++)this.modChannels.push(0), this.modInstruments.push(0), this.modulators.push(e.modulators.dictionary.none.index); this.spectrumWave = new pt(t); for (let t = 0; t < e.operatorCount; t++)this.operators[t] = new dt(t); for (let t = 0; t < e.drumCount; t++)this.drumsetEnvelopes[t] = e.envelopes.dictionary["twang 2"].index, this.drumsetSpectrumWaves[t] = new pt(!0); for (let t = 0; t < 64; t++)this.customChipWave[t] = 24 - Math.floor(.75 * t); let s = 0; for (let t = 0; t < this.customChipWave.length; t++)s += this.customChipWave[t]; const n = s / this.customChipWave.length; let o = 0, h = 0; for (let t = 0; t < this.customChipWave.length; t++)o += h, h = this.customChipWave[t] - n, this.customChipWaveIntegral[t] = o; this.customChipWaveIntegral[64] = 0 } setTypeAndReset(t, i, s) { s && (t = 9), this.type = t, this.preset = t, this.volume = 0, this.effects = 4, this.chorus = e.chorusRange - 1, this.reverb = 0, this.echoSustain = Math.floor(.5 * (e.echoSustainRange - 1)), this.echoDelay = Math.floor(.5 * (e.echoDelayRange - 1)), this.eqFilter.reset(), this.eqFilterType = !1, this.eqFilterSimpleCut = e.filterSimpleCutRange - 1, this.eqFilterSimplePeak = 0; for (let t = 0; t < e.filterMorphCount; t++)this.eqSubFilters[t] = null, this.noteSubFilters[t] = null; switch (this.noteFilter.reset(), this.noteFilterType = !1, this.noteFilterSimpleCut = e.filterSimpleCutRange - 1, this.noteFilterSimplePeak = 0, this.distortion = Math.floor(.75 * (e.distortionRange - 1)), this.bitcrusherFreq = Math.floor(.5 * (e.bitcrusherFreqRange - 1)), this.bitcrusherQuantization = Math.floor(.5 * (e.bitcrusherQuantizationRange - 1)), this.pan = e.panCenter, this.panDelay = 10, this.pitchShift = e.pitchShiftCenter, this.detune = e.detuneCenter, this.vibrato = 0, this.unison = 0, this.stringSustain = 10, this.clicklessTransition = !1, this.arpeggioSpeed = 12, this.legacyTieOver = !1, this.aliases = !1, this.fadeIn = 0, this.fadeOut = e.fadeOutNeutral, this.transition = e.transitions.dictionary.normal.index, this.envelopeCount = 0, t) { case 0: this.chipWave = 2, this.chord = e.chords.dictionary.arpeggio.index; break; case 8: this.chipWave = 2, this.chord = e.chords.dictionary.arpeggio.index; for (let t = 0; t < 64; t++)this.customChipWave[t] = 24 - Math.floor(.75 * t); let s = 0; for (let t = 0; t < this.customChipWave.length; t++)s += this.customChipWave[t]; const n = s / this.customChipWave.length; let o = 0, h = 0; for (let t = 0; t < this.customChipWave.length; t++)o += h, h = this.customChipWave[t] - n, this.customChipWaveIntegral[t] = o; this.customChipWaveIntegral[64] = 0; break; case 1: this.chord = e.chords.dictionary["custom interval"].index, this.algorithm = 0, this.feedbackType = 0, this.feedbackAmplitude = 0; for (let t = 0; t < this.operators.length; t++)this.operators[t].reset(t); break; case 2: this.chipNoise = 1, this.chord = e.chords.dictionary.arpeggio.index; break; case 3: this.chord = e.chords.dictionary.simultaneous.index, this.spectrumWave.reset(i); break; case 4: this.chord = e.chords.dictionary.simultaneous.index; for (let t = 0; t < e.drumCount; t++)this.drumsetEnvelopes[t] = e.envelopes.dictionary["twang 2"].index, null == this.drumsetSpectrumWaves[t] && (this.drumsetSpectrumWaves[t] = new pt(!0)), this.drumsetSpectrumWaves[t].reset(i); break; case 5: this.chord = e.chords.dictionary.simultaneous.index, this.harmonicsWave.reset(); break; case 6: this.chord = e.chords.dictionary.arpeggio.index, this.pulseWidth = e.pulseWidthRange; break; case 7: this.chord = e.chords.dictionary.strum.index, this.harmonicsWave.reset(); break; case 9: this.transition = 0, this.vibrato = 0, this.interval = 0, this.effects = 0, this.chord = 0, this.modChannels = [], this.modInstruments = [], this.modulators = []; for (let t = 0; t < e.modCount; t++)this.modChannels.push(-2), this.modInstruments.push(0), this.modulators.push(e.modulators.dictionary.none.index), this.invalidModulators[t] = !1, this.modFilterTypes[t] = 0; break; default: throw new Error("Unrecognized instrument type: " + t) }this.chord != e.chords.dictionary.simultaneous.index && (this.effects = 2048 | this.effects) } convertLegacySettings(t, i) { let s = t.filterCutoff, n = t.filterResonance, o = t.filterEnvelope, h = t.pulseEnvelope, a = t.operatorEnvelopes, r = t.feedbackEnvelope; null == s && (s = 0 == this.type ? 6 : 10), null == n && (n = 0), null == o && (o = e.envelopes.dictionary.none), null == h && (h = e.envelopes.dictionary[6 == this.type ? "twang 2" : "none"]), null == a && (a = [e.envelopes.dictionary[1 == this.type ? "note size" : "none"], e.envelopes.dictionary.none, e.envelopes.dictionary.none, e.envelopes.dictionary.none]), null == r && (r = e.envelopes.dictionary.none); 10 == s && 2 == o.type && (o = e.envelopes.dictionary.none); const l = e.algorithms[this.algorithm].carrierCount; let c = !0, d = !0, p = 0 == o.type || 0 == h.type; if (1 == this.type) { p = p || 0 == r.type; for (let t = 0; t < a.length; t++)t < l ? 0 != a[t].type ? d = !1 : c = !1 : p = p || 0 == a[t].type } this.envelopeCount = 0, 1 == this.type && (d && p ? this.addEnvelope(e.instrumentAutomationTargets.dictionary.noteVolume.index, 0, e.envelopes.dictionary["note size"].index) : c && !p && this.addEnvelope(e.instrumentAutomationTargets.dictionary.none.index, 0, e.envelopes.dictionary["note size"].index)), 1 == o.type ? (this.noteFilter.reset(), this.noteFilterType = !1, this.eqFilter.convertLegacySettings(s, n, o), this.effects &= -33, (i || this.eqFilterType) && (this.eqFilterType = !0, this.eqFilterSimpleCut = s, this.eqFilterSimplePeak = n)) : (this.eqFilter.reset(), this.eqFilterType = !1, this.noteFilterType = !1, this.noteFilter.convertLegacySettings(s, n, o), this.effects |= 32, this.addEnvelope(e.instrumentAutomationTargets.dictionary.noteFilterAllFreqs.index, 0, o.index), (i || this.noteFilterType) && (this.noteFilterType = !0, this.noteFilterSimpleCut = s, this.noteFilterSimplePeak = n)), 1 != h.type && this.addEnvelope(e.instrumentAutomationTargets.dictionary.pulseWidth.index, 0, h.index); for (let t = 0; t < a.length; t++)t < l && d || 1 != a[t].type && this.addEnvelope(e.instrumentAutomationTargets.dictionary.operatorAmplitude.index, t, a[t].index); 1 != r.type && this.addEnvelope(e.instrumentAutomationTargets.dictionary.feedbackAmplitude.index, 0, r.index) } toJsonObject() { const t = { type: e.instrumentTypeNames[this.type], volume: this.volume, eqFilter: this.eqFilter.toJsonObject(), eqFilterType: this.eqFilterType, eqSimpleCut: this.eqFilterSimpleCut, eqSimplePeak: this.eqFilterSimplePeak }; this.preset != this.type && (t.preset = this.preset); for (let i = 0; i < e.filterMorphCount; i++)null != this.eqSubFilters[i] && (t["eqSubFilters" + i] = this.eqSubFilters[i].toJsonObject()); const i = []; for (const t of e.effectOrder) this.effects & 1 << t && i.push(e.effectNames[t]); if (t.effects = i, d(this.effects) && (t.transition = e.transitions[this.transition].name, t.clicklessTransition = this.clicklessTransition), p(this.effects) && (t.chord = this.getChord().name, t.fastTwoNoteArp = this.fastTwoNoteArp, t.arpeggioSpeed = this.arpeggioSpeed), u(this.effects) && (t.pitchShiftSemitones = this.pitchShift), m(this.effects) && (t.detuneCents = Et.detuneToCents(this.detune)), f(this.effects) && (-1 == this.vibrato && (this.vibrato = 5), 5 != this.vibrato ? t.vibrato = e.vibratos[this.vibrato].name : t.vibrato = "custom", t.vibratoDepth = this.vibratoDepth, t.vibratoDelay = this.vibratoDelay, t.vibratoSpeed = this.vibratoSpeed, t.vibratoType = this.vibratoType), y(this.effects)) { t.noteFilterType = this.noteFilterType, t.noteSimpleCut = this.noteFilterSimpleCut, t.noteSimplePeak = this.noteFilterSimplePeak, t.noteFilter = this.noteFilter.toJsonObject(); for (let i = 0; i < e.filterMorphCount; i++)null != this.noteSubFilters[i] && (t["noteSubFilters" + i] = this.noteSubFilters[i].toJsonObject()) } if (b(this.effects) && (t.distortion = Math.round(100 * this.distortion / (e.distortionRange - 1)), t.aliases = this.aliases), g(this.effects) && (t.bitcrusherOctave = (e.bitcrusherFreqRange - 1 - this.bitcrusherFreq) * e.bitcrusherOctaveStep, t.bitcrusherQuantization = Math.round(100 * this.bitcrusherQuantization / (e.bitcrusherQuantizationRange - 1))), w(this.effects) && (t.pan = Math.round(100 * (this.pan - e.panCenter) / e.panCenter), t.panDelay = this.panDelay), v(this.effects) && (t.chorus = Math.round(100 * this.chorus / (e.chorusRange - 1))), k(this.effects) && (t.echoSustain = Math.round(100 * this.echoSustain / (e.echoSustainRange - 1)), t.echoDelayBeats = Math.round(1e3 * (this.echoDelay + 1) * e.echoDelayStepTicks / (e.ticksPerPart * e.partsPerBeat)) / 1e3), x(this.effects) && (t.reverb = Math.round(100 * this.reverb / (e.reverbRange - 1))), 4 != this.type && (t.fadeInSeconds = Math.round(1e4 * Et.fadeInSettingToSeconds(this.fadeIn)) / 1e4, t.fadeOutTicks = Et.fadeOutSettingToTicks(this.fadeOut)), 5 == this.type || 7 == this.type) { t.harmonics = []; for (let i = 0; i < e.harmonicsControlPoints; i++)t.harmonics[i] = Math.round(100 * this.harmonicsWave.harmonics[i] / e.harmonicsMax) } if (2 == this.type) t.wave = e.chipNoises[this.chipNoise].name; else if (3 == this.type) { t.spectrum = []; for (let i = 0; i < e.spectrumControlPoints; i++)t.spectrum[i] = Math.round(100 * this.spectrumWave.spectrum[i] / e.spectrumMax) } else if (4 == this.type) { t.drums = []; for (let i = 0; i < e.drumCount; i++) { const s = []; for (let t = 0; t < e.spectrumControlPoints; t++)s[t] = Math.round(100 * this.drumsetSpectrumWaves[i].spectrum[t] / e.spectrumMax); t.drums[i] = { filterEnvelope: this.getDrumsetEnvelope(i).name, spectrum: s } } } else if (0 == this.type) t.wave = e.chipWaves[this.chipWave].name, t.unison = e.unisons[this.unison].name; else if (6 == this.type) t.pulseWidth = this.pulseWidth; else if (7 == this.type) t.unison = e.unisons[this.unison].name, t.stringSustain = Math.round(100 * this.stringSustain / (e.stringSustainRange - 1)); else if (5 == this.type) t.unison = e.unisons[this.unison].name; else if (1 == this.type) { const i = []; for (const t of this.operators) i.push({ frequency: e.operatorFrequencies[t.frequency].name, amplitude: t.amplitude, waveform: e.operatorWaves[t.waveform].name, pulseWidth: t.pulseWidth }); t.algorithm = e.algorithms[this.algorithm].name, t.feedbackType = e.feedbacks[this.feedbackType].name, t.feedbackAmplitude = this.feedbackAmplitude, t.operators = i } else if (8 == this.type) { t.wave = e.chipWaves[this.chipWave].name, t.unison = e.unisons[this.unison].name, t.customChipWave = new Float64Array(64), t.customChipWaveIntegral = new Float64Array(65); for (let e = 0; e < this.customChipWave.length; e++)t.customChipWave[e] = this.customChipWave[e] } else { if (9 != this.type) throw new Error("Unrecognized instrument type"); t.modChannels = [], t.modInstruments = [], t.modSettings = [], t.modStatuses = []; for (let i = 0; i < e.modCount; i++)t.modChannels[i] = this.modChannels[i], t.modInstruments[i] = this.modInstruments[i], t.modSettings[i] = this.modulators[i] } const s = []; for (let t = 0; t < this.envelopeCount; t++)s.push(this.envelopes[t].toJsonObject()); return t.envelopes = s, t } fromJsonObject(t, i, s, n, o, h = 0) { null == t && (t = {}); let a = e.instrumentTypeNames.indexOf(t.type); if (-1 == a && (a = s ? 9 : i ? 2 : 0), this.setTypeAndReset(a, i, s), null != t.preset && (this.preset = t.preset >>> 0), null != t.volume ? this.volume = it(-e.volumeRange / 2, e.volumeRange / 2 + 1, 0 | t.volume) : this.volume = 0, Array.isArray(t.effects)) { let i = 0; for (let s = 0; s < t.effects.length; s++)i |= 1 << e.effectNames.indexOf(t.effects[s]); this.effects = 4095 & i } else { const e = ["none", "reverb", "chorus", "chorus & reverb"]; this.effects = e.indexOf(t.effects), -1 == this.effects && (this.effects = 2 == this.type ? 0 : 1) } this.transition = e.transitions.dictionary.normal.index; const r = t.transition || t.envelope; if (null != r) { let i = e.transitions.dictionary[r]; if (null == t.fadeInSeconds || null == t.fadeOutTicks) { const t = { binary: { transition: "interrupt", fadeInSeconds: 0, fadeOutTicks: -1 }, seamless: { transition: "interrupt", fadeInSeconds: 0, fadeOutTicks: -1 }, sudden: { transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3 }, hard: { transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3 }, smooth: { transition: "normal", fadeInSeconds: .025, fadeOutTicks: -3 }, soft: { transition: "normal", fadeInSeconds: .025, fadeOutTicks: -3 }, slide: { transition: "slide in pattern", fadeInSeconds: .025, fadeOutTicks: -3 }, "cross fade": { transition: "normal", fadeInSeconds: .04, fadeOutTicks: 6 }, "hard fade": { transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48 }, "medium fade": { transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72 }, "soft fade": { transition: "normal", fadeInSeconds: .06, fadeOutTicks: 96 } }[r]; null != t && (i = e.transitions.dictionary[t.transition], this.fadeIn = Et.secondsToFadeInSetting(t.fadeInSeconds), this.fadeOut = Et.ticksToFadeOutSetting(t.fadeOutTicks)) } null != i && (this.transition = i.index), this.transition != e.transitions.dictionary.normal.index && (this.effects = 1024 | this.effects) } null != t.fadeInSeconds && (this.fadeIn = Et.secondsToFadeInSetting(+t.fadeInSeconds)), null != t.fadeOutTicks && (this.fadeOut = Et.ticksToFadeOutSetting(+t.fadeOutTicks)); { const i = t.chord, s = { harmony: "simultaneous" }, n = e.chords.dictionary[s[i]] || e.chords.dictionary[i]; null != n ? this.chord = n.index : 2 == this.type ? this.chord = e.chords.dictionary.arpeggio.index : 7 == this.type ? this.chord = e.chords.dictionary.strum.index : 0 == this.type ? this.chord = e.chords.dictionary.arpeggio.index : 1 == this.type ? this.chord = e.chords.dictionary["custom interval"].index : this.chord = e.chords.dictionary.simultaneous.index } this.unison = e.unisons.dictionary.none.index; const l = t.unison || t.interval || t.chorus; if (null != l) { const t = { union: "none", fifths: "fifth", octaves: "octave" }, i = e.unisons.dictionary[t[l]] || e.unisons.dictionary[l]; null != i && (this.unison = i.index) } "custom harmony" == t.chorus && (this.unison = e.unisons.dictionary.hum.index, this.chord = e.chords.dictionary["custom interval"].index), this.chord == e.chords.dictionary.simultaneous.index || Array.isArray(t.effects) || (this.effects = 2048 | this.effects), null != t.pitchShiftSemitones && (this.pitchShift = it(0, e.pitchShiftRange, Math.round(+t.pitchShiftSemitones))), null != t.detuneCents && (this.detune = it(e.detuneMin, e.detuneMax + 1, Math.round(Et.centsToDetune(+t.detuneCents)))), this.vibrato = e.vibratos.dictionary.none.index; const c = t.vibrato || t.effect; if (null != c) { const i = { "vibrato light": "light", "vibrato delayed": "delayed", "vibrato heavy": "heavy" }, s = e.vibratos.dictionary[i[l]] || e.vibratos.dictionary[c]; null != s ? this.vibrato = s.index : "custom" == c && (this.vibrato = e.vibratos.length), this.vibrato == e.vibratos.length ? (this.vibratoDepth = t.vibratoDepth, this.vibratoSpeed = t.vibratoSpeed, this.vibratoDelay = t.vibratoDelay, this.vibratoType = t.vibratoType) : (this.vibratoDepth = e.vibratos[this.vibrato].amplitude, this.vibratoDelay = e.vibratos[this.vibrato].delayTicks / 2, this.vibratoSpeed = 10, this.vibratoType = e.vibratos[this.vibrato].type), s != e.vibratos.dictionary.none && (this.effects = 512 | this.effects) } if (null != t.pan ? (this.pan = it(0, e.panMax + 1, Math.round(e.panCenter + (0 | t.pan) * e.panCenter / 100)), this.pan != e.panCenter && (this.effects = 4 | this.effects)) : (this.pan = e.panCenter, this.effects = 4 | this.effects), null != t.panDelay ? this.panDelay = 0 | t.panDelay : this.panDelay = 10, null != t.detune ? this.detune = it(e.detuneMin, e.detuneMax + 1, 0 | t.detune) : null == t.detuneCents && (this.detune = e.detuneCenter), null != t.distortion && (this.distortion = it(0, e.distortionRange, Math.round((e.distortionRange - 1) * (0 | t.distortion) / 100))), null != t.bitcrusherOctave && (this.bitcrusherFreq = e.bitcrusherFreqRange - 1 - +t.bitcrusherOctave / e.bitcrusherOctaveStep), null != t.bitcrusherQuantization && (this.bitcrusherQuantization = it(0, e.bitcrusherQuantizationRange, Math.round((e.bitcrusherQuantizationRange - 1) * (0 | t.bitcrusherQuantization) / 100))), null != t.echoSustain && (this.echoSustain = it(0, e.echoSustainRange, Math.round((e.echoSustainRange - 1) * (0 | t.echoSustain) / 100))), null != t.echoDelayBeats && (this.echoDelay = it(0, e.echoDelayRange, Math.round(+t.echoDelayBeats * (e.ticksPerPart * e.partsPerBeat) / e.echoDelayStepTicks - 1))), isNaN(t.chorus) || (this.chorus = it(0, e.chorusRange, Math.round((e.chorusRange - 1) * (0 | t.chorus) / 100))), null != t.reverb ? this.reverb = it(0, e.reverbRange, Math.round((e.reverbRange - 1) * (0 | t.reverb) / 100)) : this.reverb = h, null != t.pulseWidth ? this.pulseWidth = it(1, e.pulseWidthRange + 1, Math.round(t.pulseWidth)) : this.pulseWidth = e.pulseWidthRange, null != t.harmonics) { for (let i = 0; i < e.harmonicsControlPoints; i++)this.harmonicsWave.harmonics[i] = Math.max(0, Math.min(e.harmonicsMax, Math.round(e.harmonicsMax * +t.harmonics[i] / 100))); this.harmonicsWave.markCustomWaveDirty() } else this.harmonicsWave.reset(); if (null != t.spectrum) for (let i = 0; i < e.spectrumControlPoints; i++)this.spectrumWave.spectrum[i] = Math.max(0, Math.min(e.spectrumMax, Math.round(e.spectrumMax * +t.spectrum[i] / 100))); else this.spectrumWave.reset(i); null != t.stringSustain ? this.stringSustain = it(0, e.stringSustainRange, Math.round((e.stringSustainRange - 1) * (0 | t.stringSustain) / 100)) : this.stringSustain = 10, 2 == this.type && (this.chipNoise = e.chipNoises.findIndex((e => e.name == t.wave)), -1 == this.chipNoise && (this.chipNoise = 1)); const d = { custom: "note size", steady: "none", "pluck 1": "twang 1", "pluck 2": "twang 2", "pluck 3": "twang 3" }, p = t => null != d[t] ? e.envelopes.dictionary[d[t]] : e.envelopes.dictionary[t]; if (4 == this.type && null != t.drums) for (let i = 0; i < e.drumCount; i++) { const s = t.drums[i]; if (null != s) { if (this.drumsetEnvelopes[i] = e.envelopes.dictionary["twang 2"].index, null != s.filterEnvelope) { const t = p(s.filterEnvelope); null != t && (this.drumsetEnvelopes[i] = t.index) } if (null != s.spectrum) for (let t = 0; t < e.spectrumControlPoints; t++)this.drumsetSpectrumWaves[i].spectrum[t] = Math.max(0, Math.min(e.spectrumMax, Math.round(e.spectrumMax * +s.spectrum[t] / 100))) } } if (0 == this.type) { const i = { triangle: 1, square: 2, "pulse wide": 3, "pulse narrow": 4, sawtooth: 5, "double saw": 6, "double pulse": 7, spiky: 8, plateau: 0 }; this.chipWave = null != i[t.wave] ? i[t.wave] : e.chipWaves.findIndex((e => e.name == t.wave)), -1 == this.chipWave && (this.chipWave = 1) } if (1 == this.type) { this.algorithm = e.algorithms.findIndex((e => e.name == t.algorithm)), -1 == this.algorithm && (this.algorithm = 0), this.feedbackType = e.feedbacks.findIndex((e => e.name == t.feedbackType)), -1 == this.feedbackType && (this.feedbackType = 0), null != t.feedbackAmplitude ? this.feedbackAmplitude = it(0, e.operatorAmplitudeMax + 1, 0 | t.feedbackAmplitude) : this.feedbackAmplitude = 0; for (let i = 0; i < e.operatorCount; i++) { const s = this.operators[i]; let n = void 0; null != t.operators && (n = t.operators[i]), null == n && (n = {}), s.frequency = e.operatorFrequencies.findIndex((t => t.name == n.frequency)), -1 == s.frequency && (s.frequency = 0), null != n.amplitude ? s.amplitude = it(0, e.operatorAmplitudeMax + 1, 0 | n.amplitude) : s.amplitude = 0, null != n.waveform ? (s.waveform = e.operatorWaves.findIndex((t => t.name == n.waveform)), -1 == s.waveform && ("square" == n.waveform ? (s.waveform = e.operatorWaves.dictionary["pulse width"].index, s.pulseWidth = 5) : s.waveform = 0)) : s.waveform = 0, null != n.pulseWidth ? s.pulseWidth = 0 | n.pulseWidth : s.pulseWidth = 5 } } else if (8 == this.type) { if (t.customChipWave) { for (let e = 0; e < 64; e++)this.customChipWave[e] = t.customChipWave[e]; let e = 0; for (let t = 0; t < this.customChipWave.length; t++)e += this.customChipWave[t]; const i = e / this.customChipWave.length; let s = 0, n = 0; for (let t = 0; t < this.customChipWave.length; t++)s += n, n = this.customChipWave[t] - i, this.customChipWaveIntegral[t] = s; this.customChipWaveIntegral[64] = 0 } } else if (9 == this.type && null != t.modChannels) for (let i = 0; i < e.modCount; i++)this.modChannels[i] = t.modChannels[i], this.modInstruments[i] = t.modInstruments[i], this.modulators[i] = t.modSettings[i]; if (9 != this.type) { this.chord == e.chords.dictionary.arpeggio.index && null != t.arpeggioSpeed ? this.arpeggioSpeed = t.arpeggioSpeed : this.arpeggioSpeed = n ? 9 : 12, null != t.fastTwoNoteArp ? this.fastTwoNoteArp = t.fastTwoNoteArp : this.fastTwoNoteArp = o, null != t.clicklessTransition ? this.clicklessTransition = t.clicklessTransition : this.clicklessTransition = !1, null != t.aliases ? this.aliases = t.aliases : this.aliases = !1, null != t.noteFilterType && (this.noteFilterType = t.noteFilterType), null != t.noteSimpleCut && (this.noteFilterSimpleCut = t.noteSimpleCut), null != t.noteSimplePeak && (this.noteFilterSimplePeak = t.noteSimplePeak), null != t.noteFilter ? this.noteFilter.fromJsonObject(t.noteFilter) : this.noteFilter.reset(); for (let i = 0; i < e.filterMorphCount; i++)Array.isArray(t["noteSubFilters" + i]) && (this.noteSubFilters[i] = new bt, this.noteSubFilters[i].fromJsonObject(t["noteSubFilters" + i])); if (null != t.eqFilterType && (this.eqFilterType = t.eqFilterType), null != t.eqSimpleCut && (this.eqFilterSimpleCut = t.eqSimpleCut), null != t.eqSimplePeak && (this.eqFilterSimplePeak = t.eqSimplePeak), Array.isArray(t.eqFilter)) this.eqFilter.fromJsonObject(t.eqFilter); else { this.eqFilter.reset(); const i = {}, s = 8e3, n = 11, o = 8; if (null != t.filterCutoffHz ? i.filterCutoff = it(0, n, Math.round(n - 1 + 2 * Math.log((0 | t.filterCutoffHz) / s) / Math.LN2)) : i.filterCutoff = 0 == this.type ? 6 : 10, null != t.filterResonance ? i.filterResonance = it(0, o, Math.round((o - 1) * (0 | t.filterResonance) / 100)) : i.filterResonance = 0, i.filterEnvelope = p(t.filterEnvelope), i.pulseEnvelope = p(t.pulseEnvelope), i.feedbackEnvelope = p(t.feedbackEnvelope), Array.isArray(t.operators)) { i.operatorEnvelopes = []; for (let s = 0; s < e.operatorCount; s++) { let n; null != t.operators[s] && (n = p(t.operators[s].envelope)), i.operatorEnvelopes[s] = null != n ? n : e.envelopes.dictionary.none } } if (null != t.filter) { const e = [10, 6, 3, 0, 8, 5, 2], s = ["none", "none", "none", "none", "decay 1", "decay 2", "decay 3"], n = ["none", "bright", "medium", "soft", "decay bright", "decay medium", "decay soft"], o = { "sustain sharp": 1, "sustain medium": 2, "sustain soft": 3, "decay sharp": 4 }; let h = null != o[t.filter] ? o[t.filter] : n.indexOf(t.filter); -1 == h && (h = 0), i.filterCutoff = e[h], i.filterEnvelope = p(s[h]), i.filterResonance = 0 } this.convertLegacySettings(i, !0) } for (let i = 0; i < e.filterMorphCount; i++)Array.isArray(t["eqSubFilters" + i]) && (this.eqSubFilters[i] = new bt, this.eqSubFilters[i].fromJsonObject(t["eqSubFilters" + i])); if (Array.isArray(t.envelopes)) { const i = t.envelopes; for (let t = 0; t < i.length && !(this.envelopeCount >= e.maxEnvelopeCount); t++) { const e = new gt; e.fromJsonObject(i[t]), this.addEnvelope(e.target, e.index, e.envelope) } } } } static frequencyFromPitch(t) { return 440 * Math.pow(2, (t - 69) / 12) } addEnvelope(t, i, s) { let n = !1; if (this.supportsEnvelopeTarget(t, i) || (n = !0), this.envelopeCount >= e.maxEnvelopeCount) throw new Error; for (; this.envelopes.length <= this.envelopeCount;)this.envelopes[this.envelopes.length] = new gt; const o = this.envelopes[this.envelopeCount]; o.target = n ? e.instrumentAutomationTargets.dictionary.none.index : t, o.index = n ? 0 : i, o.envelope = s, this.envelopeCount++ } supportsEnvelopeTarget(t, i) { const s = e.instrumentAutomationTargets[t]; if (i >= s.maxCount) return !1; if (null != s.compatibleInstruments && -1 == s.compatibleInstruments.indexOf(this.type)) return !1; if (null != s.effect && 0 == (this.effects & 1 << s.effect)) return !1; if (s.isFilter) { let t = this.noteFilter.controlPointCount; if (this.noteFilterType && (t = 1), i >= t) return !1 } return !0 } clearInvalidEnvelopeTargets() { for (let t = 0; t < this.envelopeCount; t++) { const i = this.envelopes[t].target, s = this.envelopes[t].index; this.supportsEnvelopeTarget(i, s) || (this.envelopes[t].target = e.instrumentAutomationTargets.dictionary.none.index, this.envelopes[t].index = 0) } } getTransition() { return d(this.effects) ? e.transitions[this.transition] : 9 == this.type ? e.transitions.dictionary.interrupt : e.transitions.dictionary.normal } getFadeInSeconds() { return 4 == this.type ? 0 : Et.fadeInSettingToSeconds(this.fadeIn) } getFadeOutTicks() { return 4 == this.type ? e.drumsetFadeOutTicks : Et.fadeOutSettingToTicks(this.fadeOut) } getChord() { return p(this.effects) ? e.chords[this.chord] : e.chords.dictionary.simultaneous } getDrumsetEnvelope(t) { if (4 != this.type) throw new Error("Can't getDrumsetEnvelope() for non-drumset."); return e.envelopes[this.drumsetEnvelopes[t]] } } class vt { constructor() { this.octave = 0, this.instruments = [], this.patterns = [], this.bars = [], this.muted = !1, this.name = "" } } class kt { constructor(t) { this.channels = [], this.limitDecay = 4, this.limitRise = 4e3, this.compressionThreshold = 1, this.limitThreshold = 1, this.compressionRatio = 1, this.limitRatio = 1, this.masterGain = 1, this.inVolumeCap = 0, this.outVolumeCap = 0, this.getNewNoteVolume = (t, i, s, n) => { if (t && null != i && null != s && null != n) { n = e.modCount - n - 1; let t = e.modulators[this.channels[i].instruments[s].modulators[n]].newNoteVol, o = e.modulators.dictionary.tempo.index; return this.channels[i].instruments[s].modulators[n] == o && (t = this.tempo - e.modulators[o].convertRealFactor), null != t ? t : 6 } return 6 }, this.getVolumeCap = (t, i, s, n) => { if (t && null != i && null != s && null != n) { n = e.modCount - n - 1; let t = this.channels[i].instruments[s], o = e.modulators[t.modulators[n]], h = o.maxRawVol; return null != h ? ("eq filter" != o.name && "note filter" != o.name || (h = e.filterMorphCount - 1, t.modFilterTypes[n] > 0 && t.modFilterTypes[n] % 2 ? h = e.filterFreqRange : t.modFilterTypes[n] > 0 && (h = e.filterGainRange)), h) : 6 } return 6 }, this.getVolumeCapForSetting = (t, i, s) => { if (t) { let t = e.modulators[i].maxRawVol; return null != t ? (null == s || "eq filter" != e.modulators[i].name && "note filter" != e.modulators[i].name || (t = e.filterMorphCount - 1, s > 0 && s % 2 ? t = e.filterFreqRange : s > 0 && (t = e.filterGainRange)), t) : e.noteSizeMax } return e.noteSizeMax }, null != t ? this.fromBase64String(t) : this.initToDefault(!0) } getChannelCount() { return this.pitchChannelCount + this.noiseChannelCount + this.modChannelCount } getMaxInstrumentsPerChannel() { return Math.max(this.layeredInstruments ? e.layeredInstrumentCountMax : e.instrumentCountMin, this.patternInstruments ? e.patternInstrumentCountMax : e.instrumentCountMin) } getMaxInstrumentsPerPattern(t) { return this.getMaxInstrumentsPerPatternForChannel(this.channels[t]) } getMaxInstrumentsPerPatternForChannel(t) { return this.layeredInstruments ? Math.min(e.layeredInstrumentCountMax, t.instruments.length) : 1 } getChannelIsNoise(t) { return t >= this.pitchChannelCount && t < this.pitchChannelCount + this.noiseChannelCount } getChannelIsMod(t) { return t >= this.pitchChannelCount + this.noiseChannelCount } initToDefault(t = !0) { if (this.scale = 0, this.key = 0, this.loopStart = 0, this.loopLength = 4, this.tempo = 150, this.reverb = 0, this.beatsPerBar = 8, this.barCount = 16, this.patternsPerChannel = 8, this.rhythm = 1, this.layeredInstruments = !1, this.patternInstruments = !1, this.title = Math.floor(Date.now() / 1000), document.title = F.versionDisplayName, t) { this.pitchChannelCount = 3, this.noiseChannelCount = 1, this.modChannelCount = 0; for (let t = 0; t < this.getChannelCount(); t++) { const i = t >= this.pitchChannelCount && t < this.pitchChannelCount + this.noiseChannelCount, s = t >= this.pitchChannelCount + this.noiseChannelCount; this.channels.length <= t && (this.channels[t] = new vt); const n = this.channels[t]; n.octave = Math.max(3 - t, 0); for (let t = 0; t < this.patternsPerChannel; t++)n.patterns.length <= t ? n.patterns[t] = new ct : n.patterns[t].reset(); n.patterns.length = this.patternsPerChannel; for (let t = 0; t < e.instrumentCountMin; t++)n.instruments.length <= t && (n.instruments[t] = new wt(i, s)), n.instruments[t].setTypeAndReset(s ? 9 : i ? 2 : 0, i, s); n.instruments.length = e.instrumentCountMin; for (let t = 0; t < this.barCount; t++)n.bars[t] = t < 4 ? 1 : 0; n.bars.length = this.barCount } this.channels.length = this.getChannelCount() } } toBase64String() { let t, i = []; i.push(kt.yt), i.push(nt[kt.bt]), i.push(78); var s = encodeURIComponent(this.title); i.push(nt[s.length >> 6], nt[63 & s.length]); for (let t = 0; t < s.length; t++)i.push(s.charCodeAt(t)); i.push(110, nt[this.pitchChannelCount], nt[this.noiseChannelCount], nt[this.modChannelCount]), i.push(115, nt[this.scale]), i.push(107, nt[this.key]), i.push(108, nt[this.loopStart >> 6], nt[63 & this.loopStart]), i.push(101, nt[this.loopLength - 1 >> 6], nt[this.loopLength - 1 & 63]), i.push(116, nt[this.tempo >> 6], nt[63 & this.tempo]), i.push(97, nt[this.beatsPerBar - 1]), i.push(103, nt[this.barCount - 1 >> 6], nt[this.barCount - 1 & 63]), i.push(106, nt[this.patternsPerChannel - 1 >> 6], nt[this.patternsPerChannel - 1 & 63]), i.push(114, nt[this.rhythm]), i.push(79), 1 != this.compressionRatio || 1 != this.limitRatio || 4e3 != this.limitRise || 4 != this.limitDecay || 1 != this.limitThreshold || 1 != this.compressionThreshold || 1 != this.masterGain ? (i.push(nt[Math.round(this.compressionRatio < 1 ? 10 * this.compressionRatio : 10 + 60 * (this.compressionRatio - 1))]), i.push(nt[Math.round(this.limitRatio < 1 ? 10 * this.limitRatio : 9 + this.limitRatio)]), i.push(nt[this.limitDecay]), i.push(nt[Math.round((this.limitRise - 2e3) / 250)]), i.push(nt[Math.round(20 * this.compressionThreshold)]), i.push(nt[Math.round(20 * this.limitThreshold)]), i.push(nt[Math.round(50 * this.masterGain) >> 6], nt[63 & Math.round(50 * this.masterGain)])) : i.push(nt[63]), i.push(85); for (let t = 0; t < this.getChannelCount(); t++) { var n = encodeURIComponent(this.channels[t].name); i.push(nt[n.length >> 6], nt[63 & n.length]); for (let t = 0; t < n.length; t++)i.push(n.charCodeAt(t)) } if (i.push(105, nt[this.layeredInstruments << 1 | this.patternInstruments]), this.layeredInstruments || this.patternInstruments) for (let t = 0; t < this.getChannelCount(); t++)i.push(nt[this.channels[t].instruments.length - e.instrumentCountMin]); i.push(111); for (let t = 0; t < this.pitchChannelCount; t++)i.push(nt[this.channels[t].octave]); for (let t = 0; t < this.getChannelCount(); t++)for (let s = 0; s < this.channels[t].instruments.length; s++) { const n = this.channels[t].instruments[s]; if (i.push(84, nt[n.type]), i.push(118, nt[n.volume + e.volumeRange / 2 >> 6], nt[n.volume + e.volumeRange / 2 & 63]), i.push(117, nt[n.preset >> 6], nt[63 & n.preset]), i.push(102), i.push(nt[+n.eqFilterType]), n.eqFilterType) i.push(nt[n.eqFilterSimpleCut]), i.push(nt[n.eqFilterSimplePeak]); else { if (null == n.eqFilter) i.push(nt[0]), console.log("Null EQ filter settings detected in toBase64String for channelIndex " + t + ", instrumentIndex " + s); else { i.push(nt[n.eqFilter.controlPointCount]); for (let t = 0; t < n.eqFilter.controlPointCount; t++) { const e = n.eqFilter.controlPoints[t]; i.push(nt[e.type], nt[Math.round(e.freq)], nt[Math.round(e.gain)]) } } let o = 0; for (let t = 0; t < e.filterMorphCount - 1; t++)o |= +(null != n.eqSubFilters[t + 1]) << t; i.push(nt[o >> 6], nt[63 & o]); for (let t = 0; t < e.filterMorphCount - 1; t++)if (o & 1 << t) { i.push(nt[n.eqSubFilters[t + 1].controlPointCount]); for (let e = 0; e < n.eqSubFilters[t + 1].controlPointCount; e++) { const s = n.eqSubFilters[t + 1].controlPoints[e]; i.push(nt[s.type], nt[Math.round(s.freq)], nt[Math.round(s.gain)]) } } } if (i.push(113, nt[n.effects >> 6], nt[63 & n.effects]), y(n.effects)) if (i.push(nt[+n.noteFilterType]), n.noteFilterType) i.push(nt[n.noteFilterSimpleCut]), i.push(nt[n.noteFilterSimplePeak]); else { if (null == n.noteFilter) i.push(nt[0]), console.log("Null note filter settings detected in toBase64String for channelIndex " + t + ", instrumentIndex " + s); else { i.push(nt[n.noteFilter.controlPointCount]); for (let t = 0; t < n.noteFilter.controlPointCount; t++) { const e = n.noteFilter.controlPoints[t]; i.push(nt[e.type], nt[Math.round(e.freq)], nt[Math.round(e.gain)]) } } let o = 0; for (let t = 0; t < e.filterMorphCount - 1; t++)o |= +(null != n.noteSubFilters[t + 1]) << t; i.push(nt[o >> 6], nt[63 & o]); for (let t = 0; t < e.filterMorphCount - 1; t++)if (o & 1 << t) { i.push(nt[n.noteSubFilters[t + 1].controlPointCount]); for (let e = 0; e < n.noteSubFilters[t + 1].controlPointCount; e++) { const s = n.noteSubFilters[t + 1].controlPoints[e]; i.push(nt[s.type], nt[Math.round(s.freq)], nt[Math.round(s.gain)]) } } } if (d(n.effects) && i.push(nt[n.transition]), p(n.effects) && (i.push(nt[n.chord]), n.chord == e.chords.dictionary.arpeggio.index && (i.push(nt[n.arpeggioSpeed]), i.push(nt[+n.fastTwoNoteArp]))), u(n.effects) && i.push(nt[n.pitchShift]), m(n.effects) && i.push(nt[n.detune - e.detuneMin >> 6], nt[n.detune - e.detuneMin & 63]), f(n.effects) && (i.push(nt[n.vibrato]), n.vibrato == e.vibratos.length && (i.push(nt[Math.round(25 * n.vibratoDepth)]), i.push(nt[n.vibratoSpeed]), i.push(nt[Math.round(n.vibratoDelay)]), i.push(nt[n.vibratoType]))), b(n.effects) && (i.push(nt[n.distortion]), i.push(nt[+n.aliases])), g(n.effects) && i.push(nt[n.bitcrusherFreq], nt[n.bitcrusherQuantization]), w(n.effects) && (i.push(nt[n.pan >> 6], nt[63 & n.pan]), i.push(nt[n.panDelay])), v(n.effects) && i.push(nt[n.chorus]), k(n.effects) && i.push(nt[n.echoSustain], nt[n.echoDelay]), x(n.effects) && i.push(nt[n.reverb]), 4 != n.type && (i.push(100, nt[n.fadeIn], nt[n.fadeOut]), i.push(nt[+n.clicklessTransition])), 5 == n.type || 7 == n.type) { i.push(72); const t = new at; for (let i = 0; i < e.harmonicsControlPoints; i++)t.write(e.harmonicsControlPointBits, n.harmonicsWave.harmonics[i]); t.encodeBase64(i) } if (0 == n.type) i.push(119, nt[n.chipWave]), i.push(104, nt[n.unison]); else if (1 == n.type) { i.push(65, nt[n.algorithm]), i.push(70, nt[n.feedbackType]), i.push(66, nt[n.feedbackAmplitude]), i.push(81); for (let t = 0; t < e.operatorCount; t++)i.push(nt[n.operators[t].frequency]); i.push(80); for (let t = 0; t < e.operatorCount; t++)i.push(nt[n.operators[t].amplitude]); i.push(82); for (let t = 0; t < e.operatorCount; t++)i.push(nt[n.operators[t].waveform]), 3 == n.operators[t].waveform && i.push(nt[n.operators[t].pulseWidth]) } else if (8 == n.type) { i.push(119, nt[n.chipWave]), i.push(104, nt[n.unison]), i.push(77); for (let t = 0; t < 64; t++)i.push(nt[n.customChipWave[t] + 24]) } else if (2 == n.type) i.push(119, nt[n.chipNoise]); else if (3 == n.type) { i.push(83); const t = new at; for (let i = 0; i < e.spectrumControlPoints; i++)t.write(e.spectrumControlPointBits, n.spectrumWave.spectrum[i]); t.encodeBase64(i) } else if (4 == n.type) { i.push(122); for (let t = 0; t < e.drumCount; t++)i.push(nt[n.drumsetEnvelopes[t]]); i.push(83); const t = new at; for (let i = 0; i < e.drumCount; i++)for (let s = 0; s < e.spectrumControlPoints; s++)t.write(e.spectrumControlPointBits, n.drumsetSpectrumWaves[i].spectrum[s]); t.encodeBase64(i) } else if (5 == n.type) i.push(104, nt[n.unison]); else if (6 == n.type) i.push(87, nt[n.pulseWidth]); else if (7 == n.type) i.push(104, nt[n.unison]), i.push(73, nt[n.stringSustain]); else if (9 != n.type) throw new Error("Unknown instrument type."); i.push(69, nt[n.envelopeCount]); for (let t = 0; t < n.envelopeCount; t++)i.push(nt[n.envelopes[t].target]), e.instrumentAutomationTargets[n.envelopes[t].target].maxCount > 1 && i.push(nt[n.envelopes[t].index]), i.push(nt[n.envelopes[t].envelope]) } i.push(98), t = new at; let o = 0; for (; 1 << o < this.patternsPerChannel + 1;)o++; for (let e = 0; e < this.getChannelCount(); e++)for (let i = 0; i < this.barCount; i++)t.write(o, this.channels[e].bars[i]); t.encodeBase64(i), i.push(112), t = new at; const h = new at, a = kt.getNeededBits(e.noteSizeMax); for (let i = 0; i < this.getChannelCount(); i++) { const s = this.channels[i], n = this.getMaxInstrumentsPerPattern(i), o = this.getChannelIsNoise(i), r = this.getChannelIsMod(i), l = kt.getNeededBits(n - e.instrumentCountMin), c = kt.getNeededBits(s.instruments.length - 1); if (r) { const n = kt.getNeededBits(this.getMaxInstrumentsPerChannel() + 2); for (let o = 0; o < s.instruments.length; o++) { let s = this.channels[i].instruments[o]; for (let i = 0; i < e.modCount; i++) { const o = s.modChannels[i], h = s.modInstruments[i], a = s.modulators[i], r = s.modFilterTypes[i]; let l = e.modulators[a].forSong ? 2 : 0; a == e.modulators.dictionary.none.index && (l = 3), t.write(2, l), 0 != l && 1 != l || (t.write(8, o), t.write(n, h)), 3 != l && t.write(6, a), "eq filter" != e.modulators[s.modulators[i]].name && "note filter" != e.modulators[s.modulators[i]].name || t.write(6, r) } } } const d = o || r ? 0 : s.octave * e.pitchesPerOctave; let p = o ? 4 : d; const u = r ? [0, 1, 2, 3, 4, 5] : o ? [4, 6, 7, 2, 3, 8, 0, 10] : [0, 7, 12, 19, 24, -5, -12], m = []; for (let t = 0; t < u.length; t++)u[t] += d; for (const i of s.patterns) { if (this.patternInstruments) { const s = st(e.instrumentCountMin, n, i.instruments.length); t.write(l, s - e.instrumentCountMin); for (let e = 0; e < s; e++)t.write(c, i.instruments[e]) } if (i.notes.length > 0) { t.write(1, 1); let s = 0; for (const e of i.notes) { e.start < s && r && (t.write(2, 0), t.write(1, 1), t.writePartDuration(s - e.start)), e.start > s && (t.write(2, 0), r && t.write(1, 0), t.writePartDuration(e.start - s)), h.clear(), 1 == e.pitches.length ? h.write(1, 0) : (h.write(1, 1), h.write(3, e.pitches.length - 2)), h.writePinCount(e.pins.length - 1), r ? h.write(9, e.pins[0].size) : h.write(a, e.pins[0].size); let i = 0, n = e.pitches[0], o = n; const l = []; for (let t = 1; t < e.pins.length; t++) { const s = e.pins[t], c = n + s.interval; o != c ? (h.write(1, 1), l.push(c), o = c) : h.write(1, 0), h.writePartDuration(s.time - i), i = s.time, r ? h.write(9, s.size) : h.write(a, s.size) } const c = String.fromCharCode.apply(null, h.encodeBase64([])), d = m.indexOf(c); -1 == d ? (t.write(2, 1), t.concat(h)) : (t.write(1, 1), t.writeLongTail(0, 0, d), m.splice(d, 1)), m.unshift(c), m.length > 10 && m.pop(); const f = e.pitches.concat(l); for (let i = 0; i < f.length; i++) { const s = f[i], n = u.indexOf(s); if (-1 == n) { let e = 0, i = p; if (i < s) for (; i != s;)i++, -1 == u.indexOf(i) && e++; else for (; i != s;)i--, -1 == u.indexOf(i) && e--; t.write(1, 0), t.writePitchInterval(e) } else t.write(1, 1), t.write(4, n), u.splice(n, 1); u.unshift(s), u.length > 16 && u.pop(), p = i == e.pitches.length - 1 ? e.pitches[0] : s } 0 == e.start && t.write(1, e.continuesLastPattern ? 1 : 0), s = e.end } s < this.beatsPerBar * e.partsPerBeat + +r && (t.write(2, 0), r && t.write(1, 0), t.writePartDuration(this.beatsPerBar * e.partsPerBeat + +r - s)) } else t.write(1, 0) } } let r = t.lengthBase64(), l = []; for (; r > 0;)l.unshift(nt[63 & r]), r >>= 6; i.push(nt[l.length]), Array.prototype.push.apply(i, l), t.encodeBase64(i); const c = 64e3; if (i.length < c) return String.fromCharCode.apply(null, i); { let t = ""; for (let e = 0; e < i.length; e += c)t += String.fromCharCode.apply(null, i.slice(e, e + c)); return t } } static gt(t) { return 0 == t ? t = 1 : 1 == t && (t = 0), e.envelopes[it(0, e.envelopes.length, t)] } fromBase64String(t) { if (null == t || "" == t) return void this.initToDefault(!0); let i = 0; for (; t.charCodeAt(i) <= 32;)i++; if (35 == t.charCodeAt(i) && i++, 123 == t.charCodeAt(i)) return void this.fromJsonObject(JSON.parse(0 == i ? t : t.substring(i))); let s, n; 106 == t.charCodeAt(i) ? (s = !1, n = !0, i++) : (s = !0, n = !1); const o = ot[t.charCodeAt(i++)]; if (s && (-1 == o || o > kt.wt || o < kt.vt)) return; if (n && (-1 == o || o > kt.bt || o < kt.kt)) return; const h = o < 2, a = o < 3, r = o < 4, l = o < 5, c = o < 6, M = o < 7, S = o < 8, C = o < 9; this.initToDefault(s && C || n && l); const E = s && C || n && l; if (a && s) { for (const t of this.channels) t.instruments[0].transition = e.transitions.dictionary.interrupt.index, t.instruments[0].effects |= 1024; this.channels[3].instruments[0].chipNoise = 0 } let T = null; if (s && C || n && l) { T = []; for (let t = T.length; t < this.getChannelCount(); t++) { T[t] = []; for (let i = 0; i < e.instrumentCountMin; i++)T[t][i] = {} } } let I, P = 0, A = 0, L = -1, q = !1, D = !1; for (; i < t.length;)switch (I = t.charCodeAt(i++)) { case 78: var N = (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)]; this.title = decodeURIComponent(t.substring(i, i + N)), document.title = this.title + " - " + F.versionDisplayName, i += N; break; case 110: this.pitchChannelCount = ot[t.charCodeAt(i++)], this.noiseChannelCount = ot[t.charCodeAt(i++)], this.modChannelCount = s || h ? 0 : ot[t.charCodeAt(i++)], this.pitchChannelCount = st(e.pitchChannelCountMin, e.pitchChannelCountMax, this.pitchChannelCount), this.noiseChannelCount = st(e.noiseChannelCountMin, e.noiseChannelCountMax, this.noiseChannelCount), this.modChannelCount = st(e.modChannelCountMin, e.modChannelCountMax, this.modChannelCount); for (let t = this.channels.length; t < this.getChannelCount(); t++)this.channels[t] = new vt; if (this.channels.length = this.getChannelCount(), s && C || n && l) for (let t = T.length; t < this.getChannelCount(); t++) { T[t] = []; for (let i = 0; i < e.instrumentCountMin; i++)T[t][i] = {} } break; case 115: this.scale = ot[t.charCodeAt(i++)], s && (this.scale = 0); break; case 107: this.key = it(0, e.keys.length, M && s ? 11 - ot[t.charCodeAt(i++)] : ot[t.charCodeAt(i++)]); break; case 108: this.loopStart = l && s ? ot[t.charCodeAt(i++)] : (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)]; break; case 101: this.loopLength = l && s ? ot[t.charCodeAt(i++)] : (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)] + 1; break; case 116: this.tempo = r && s ? [95, 120, 151, 190][ot[t.charCodeAt(i++)]] : M && s ? [88, 95, 103, 111, 120, 130, 140, 151, 163, 176, 190, 206, 222, 240, 259][ot[t.charCodeAt(i++)]] : ot[t.charCodeAt(i++)] << 6 | ot[t.charCodeAt(i++)], this.tempo = it(e.tempoMin, e.tempoMax + 1, this.tempo); break; case 109: C && s ? (P = 12 * ot[t.charCodeAt(i++)], P = it(0, e.reverbRange, P)) : l && n && (P = ot[t.charCodeAt(i++)], P = it(0, e.reverbRange, P)); break; case 97: this.beatsPerBar = a && s ? [6, 7, 8, 9, 10][ot[t.charCodeAt(i++)]] : ot[t.charCodeAt(i++)] + 1, this.beatsPerBar = Math.max(e.beatsPerBarMin, Math.min(e.beatsPerBarMax, this.beatsPerBar)); break; case 103: { const s = (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)] + 1; this.barCount = st(e.barCountMin, e.barCountMax, s); for (let t = 0; t < this.getChannelCount(); t++) { for (let e = this.channels[t].bars.length; e < this.barCount; e++)this.channels[t].bars[e] = e < 4 ? 1 : 0; this.channels[t].bars.length = this.barCount } } break; case 106: { let n; n = S && s ? ot[t.charCodeAt(i++)] + 1 : (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)] + 1, this.patternsPerChannel = st(1, e.barCountMax, n); const o = this.getChannelCount(); for (let t = 0; t < o; t++) { const e = this.channels[t].patterns; for (let t = e.length; t < this.patternsPerChannel; t++)e[t] = new ct; e.length = this.patternsPerChannel } } break; case 105: if (C && s || l && n) { const n = st(e.instrumentCountMin, e.patternInstrumentCountMax, ot[t.charCodeAt(i++)] + e.instrumentCountMin); this.layeredInstruments = !1, this.patternInstruments = n > 1; for (let t = 0; t < this.getChannelCount(); t++) { const e = t >= this.pitchChannelCount && t < this.pitchChannelCount + this.noiseChannelCount, i = t >= this.pitchChannelCount + this.noiseChannelCount; for (let s = this.channels[t].instruments.length; s < n; s++)this.channels[t].instruments[s] = new wt(e, i); if (this.channels[t].instruments.length = n, c && s) for (let s = 0; s < n; s++)this.channels[t].instruments[s].setTypeAndReset(e ? 2 : 0, e, i); for (let e = T[t].length; e < n; e++)T[t][e] = {} } } else { const s = ot[t.charCodeAt(i++)]; this.layeredInstruments = 0 != (2 & s), this.patternInstruments = 0 != (1 & s); for (let s = 0; s < this.getChannelCount(); s++) { let n = 1; (this.layeredInstruments || this.patternInstruments) && (n = st(e.instrumentCountMin, this.getMaxInstrumentsPerChannel(), ot[t.charCodeAt(i++)] + e.instrumentCountMin)); const o = this.channels[s], h = this.getChannelIsNoise(s), a = this.getChannelIsMod(s); for (let t = o.instruments.length; t < n; t++)o.instruments[t] = new wt(h, a); o.instruments.length = n } } break; case 114: this.rhythm = ot[t.charCodeAt(i++)], (n && a || s) && (this.rhythm != e.rhythms.dictionary["3 (triplets)"].index && this.rhythm != e.rhythms.dictionary["6"].index || (q = !0), this.rhythm >= e.rhythms.dictionary["6"].index && (D = !0)); break; case 111: if (a && s) { const s = ot[t.charCodeAt(i++)]; this.channels[s].octave = it(0, e.pitchOctaves, ot[t.charCodeAt(i++)] + 1), s >= this.pitchChannelCount && (this.channels[s].octave = 0) } else if (C && s || l && n) for (let s = 0; s < this.getChannelCount(); s++)this.channels[s].octave = it(0, e.pitchOctaves, ot[t.charCodeAt(i++)] + 1), s >= this.pitchChannelCount && (this.channels[s].octave = 0); else { for (let s = 0; s < this.pitchChannelCount; s++)this.channels[s].octave = it(0, e.pitchOctaves, ot[t.charCodeAt(i++)]); for (let t = this.pitchChannelCount; t < this.getChannelCount(); t++)this.channels[t].octave = 0 } break; case 84: { L++, L >= this.channels[A].instruments.length && (A++, L = 0), st(0, this.channels.length - 1, A); const o = this.channels[A].instruments[L]; let a = st(0, 9, ot[t.charCodeAt(i++)]); n && l && (7 == a ? a = 8 : 8 == a && (a = 9)), o.setTypeAndReset(a, A >= this.pitchChannelCount && A < this.pitchChannelCount + this.noiseChannelCount, A >= this.pitchChannelCount + this.noiseChannelCount), !(M && s || h && n) || 0 != a && 8 != a && 6 != a || (o.aliases = !0, o.distortion = 0, o.effects |= 8), q && (o.arpeggioSpeed = 9), D && (o.fastTwoNoteArp = !0), M && s && (o.effects = 0, o.chord != e.chords.dictionary.simultaneous.index && (o.effects |= 2048)) } break; case 117: { const e = ot[t.charCodeAt(i++)] << 6 | ot[t.charCodeAt(i++)]; this.channels[A].instruments[L].preset = e, n && l && 7 == this.channels[A].instruments[L].preset && (this.channels[A].instruments[L].preset = 8) } break; case 119: if (a && s) { const s = [1, 2, 3, 4, 5, 6, 7, 8, 0], n = ot[t.charCodeAt(i++)], o = this.channels[n].instruments[0]; o.chipWave = it(0, e.chipWaves.length, 0 | s[ot[t.charCodeAt(i++)]]), o.convertLegacySettings(T[n][0], E) } else if (c && s) { const s = [1, 2, 3, 4, 5, 6, 7, 8, 0]; for (let n = 0; n < this.getChannelCount(); n++)for (const o of this.channels[n].instruments) n >= this.pitchChannelCount ? o.chipNoise = it(0, e.chipNoises.length, ot[t.charCodeAt(i++)]) : o.chipWave = it(0, e.chipWaves.length, 0 | s[ot[t.charCodeAt(i++)]]) } else if (M && s) { const s = [1, 2, 3, 4, 5, 6, 7, 8, 0]; A >= this.pitchChannelCount ? this.channels[A].instruments[L].chipNoise = it(0, e.chipNoises.length, ot[t.charCodeAt(i++)]) : this.channels[A].instruments[L].chipWave = it(0, e.chipWaves.length, 0 | s[ot[t.charCodeAt(i++)]]) } else A >= this.pitchChannelCount ? this.channels[A].instruments[L].chipNoise = it(0, e.chipNoises.length, ot[t.charCodeAt(i++)]) : this.channels[A].instruments[L].chipWave = it(0, e.chipWaves.length, ot[t.charCodeAt(i++)]); break; case 102: if (C && s || l && n) if (M && s) { const n = [10, 6, 3, 0, 8, 5, 2], o = ["none", "none", "none", "none", "decay 1", "decay 2", "decay 3"]; if (a && s) { const s = ot[t.charCodeAt(i++)], h = this.channels[s].instruments[0], a = T[s][0], r = [1, 3, 4, 5][it(0, n.length, ot[t.charCodeAt(i++)])]; a.filterCutoff = n[r], a.filterResonance = 0, a.filterEnvelope = e.envelopes.dictionary[o[r]], h.convertLegacySettings(a, E) } else if (c && s) for (let s = 0; s < this.getChannelCount(); s++)for (let h = 0; h < this.channels[s].instruments.length; h++) { const a = this.channels[s].instruments[h], r = T[s][h], l = it(0, n.length, ot[t.charCodeAt(i++)] + 1); s < this.pitchChannelCount ? (r.filterCutoff = n[l], r.filterResonance = 0, r.filterEnvelope = e.envelopes.dictionary[o[l]]) : (r.filterCutoff = 10, r.filterResonance = 0, r.filterEnvelope = e.envelopes.dictionary.none), a.convertLegacySettings(r, E) } else { const s = it(0, n.length, ot[t.charCodeAt(i++)]), h = this.channels[A].instruments[L], a = T[A][L]; a.filterCutoff = n[s], a.filterResonance = 0, a.filterEnvelope = e.envelopes.dictionary[o[s]], h.convertLegacySettings(a, E) } } else { const e = 11, s = this.channels[A].instruments[L], n = T[A][L]; n.filterCutoff = it(0, e, ot[t.charCodeAt(i++)]), s.convertLegacySettings(n, E) } else { const o = this.channels[A].instruments[L]; let h = ot[t.charCodeAt(i++)]; if (s || 0 == h) { o.eqFilterType = !1, n && (h = ot[t.charCodeAt(i++)]); const s = h; o.eqFilter.controlPointCount = it(0, e.filterMaxPoints + 1, s); for (let t = o.eqFilter.controlPoints.length; t < o.eqFilter.controlPointCount; t++)o.eqFilter.controlPoints[t] = new yt; for (let s = 0; s < o.eqFilter.controlPointCount; s++) { const n = o.eqFilter.controlPoints[s]; n.type = it(0, 3, ot[t.charCodeAt(i++)]), n.freq = it(0, e.filterFreqRange, ot[t.charCodeAt(i++)]), n.gain = it(0, e.filterGainRange, ot[t.charCodeAt(i++)]) } for (let t = o.eqFilter.controlPointCount; t < s; t++)i += 3; if (o.eqSubFilters[0] = o.eqFilter, n && !l) { let s = ot[t.charCodeAt(i++)] << 6 | ot[t.charCodeAt(i++)]; for (let n = 0; n < e.filterMorphCount - 1; n++)if (s & 1 << n) { const s = ot[t.charCodeAt(i++)]; null == o.eqSubFilters[n + 1] && (o.eqSubFilters[n + 1] = new bt), o.eqSubFilters[n + 1].controlPointCount = it(0, e.filterMaxPoints + 1, s); for (let t = o.eqSubFilters[n + 1].controlPoints.length; t < o.eqSubFilters[n + 1].controlPointCount; t++)o.eqSubFilters[n + 1].controlPoints[t] = new yt; for (let s = 0; s < o.eqSubFilters[n + 1].controlPointCount; s++) { const h = o.eqSubFilters[n + 1].controlPoints[s]; h.type = it(0, 3, ot[t.charCodeAt(i++)]), h.freq = it(0, e.filterFreqRange, ot[t.charCodeAt(i++)]), h.gain = it(0, e.filterGainRange, ot[t.charCodeAt(i++)]) } for (let t = o.eqSubFilters[n + 1].controlPointCount; t < s; t++)i += 3 } } } else o.eqFilterType = !0, o.eqFilterSimpleCut = it(0, e.filterSimpleCutRange, ot[t.charCodeAt(i++)]), o.eqFilterSimplePeak = it(0, e.filterSimplePeakRange, ot[t.charCodeAt(i++)]) } break; case 121: if (C && s || l && n) { const e = 8, s = this.channels[A].instruments[L], n = T[A][L]; n.filterResonance = it(0, e, ot[t.charCodeAt(i++)]), s.convertLegacySettings(n, E) } break; case 122: { const o = this.channels[A].instruments[L]; if (C && s || l && n) if (4 == o.type) for (let s = 0; s < e.drumCount; s++)o.drumsetEnvelopes[s] = kt.gt(ot[t.charCodeAt(i++)]).index; else { const e = T[A][L]; e.filterEnvelope = kt.gt(ot[t.charCodeAt(i++)]), o.convertLegacySettings(e, E) } else for (let s = 0; s < e.drumCount; s++)o.drumsetEnvelopes[s] = it(0, e.envelopes.length, ot[t.charCodeAt(i++)]) } break; case 87: { const o = this.channels[A].instruments[L]; if (o.pulseWidth = it(0, e.pulseWidthRange + +n, ot[t.charCodeAt(i++)]), s && (o.pulseWidth = Math.round(Math.pow(.5, (7 - o.pulseWidth) * e.pulseWidthStepPower) * e.pulseWidthRange)), C && s || l && n) { const e = T[A][L]; e.pulseEnvelope = kt.gt(ot[t.charCodeAt(i++)]), o.convertLegacySettings(e, E) } } break; case 73: this.channels[A].instruments[L].stringSustain = it(0, e.stringSustainRange, ot[t.charCodeAt(i++)]); break; case 100: if (C && s || l && n) { const n = [{ transition: "interrupt", fadeInSeconds: 0, fadeOutTicks: -1 }, { transition: "normal", fadeInSeconds: 0, fadeOutTicks: -3 }, { transition: "normal", fadeInSeconds: .025, fadeOutTicks: -3 }, { transition: "slide in pattern", fadeInSeconds: .025, fadeOutTicks: -3 }, { transition: "normal", fadeInSeconds: .04, fadeOutTicks: 6 }, { transition: "normal", fadeInSeconds: 0, fadeOutTicks: 48 }, { transition: "normal", fadeInSeconds: .0125, fadeOutTicks: 72 }, { transition: "normal", fadeInSeconds: .06, fadeOutTicks: 96 }]; if (a && s) { const s = ot[t.charCodeAt(i++)], o = n[it(0, n.length, ot[t.charCodeAt(i++)])], h = this.channels[s].instruments[0]; h.fadeIn = Et.secondsToFadeInSetting(o.fadeInSeconds), h.fadeOut = Et.ticksToFadeOutSetting(o.fadeOutTicks), h.transition = e.transitions.dictionary[o.transition].index, h.transition != e.transitions.dictionary.normal.index && (h.effects |= 1024) } else if (c && s) for (let s = 0; s < this.getChannelCount(); s++)for (const o of this.channels[s].instruments) { const s = n[it(0, n.length, ot[t.charCodeAt(i++)])]; o.fadeIn = Et.secondsToFadeInSetting(s.fadeInSeconds), o.fadeOut = Et.ticksToFadeOutSetting(s.fadeOutTicks), o.transition = e.transitions.dictionary[s.transition].index, o.transition != e.transitions.dictionary.normal.index && (o.effects |= 1024) } else if (r || s) { const s = n[it(0, n.length, ot[t.charCodeAt(i++)])], o = this.channels[A].instruments[L]; o.fadeIn = Et.secondsToFadeInSetting(s.fadeInSeconds), o.fadeOut = Et.ticksToFadeOutSetting(s.fadeOutTicks), o.transition = e.transitions.dictionary[s.transition].index, o.transition != e.transitions.dictionary.normal.index && (o.effects |= 1024) } else { const s = n[it(0, n.length, ot[t.charCodeAt(i++)])], o = this.channels[A].instruments[L]; o.fadeIn = Et.secondsToFadeInSetting(s.fadeInSeconds), o.fadeOut = Et.ticksToFadeOutSetting(s.fadeOutTicks), o.transition = e.transitions.dictionary[s.transition].index, ot[t.charCodeAt(i++)] > 0 && (o.legacyTieOver = !0), o.clicklessTransition = !!ot[t.charCodeAt(i++)], (o.transition != e.transitions.dictionary.normal.index || o.clicklessTransition) && (o.effects |= 1024) } } else { const s = this.channels[A].instruments[L]; s.fadeIn = it(0, e.fadeInRange, ot[t.charCodeAt(i++)]), s.fadeOut = it(0, e.fadeOutTicks.length, ot[t.charCodeAt(i++)]), n && (s.clicklessTransition = !!ot[t.charCodeAt(i++)]) } break; case 99: if (C && s || l && n) if (M && s) if (a && s) { const s = [0, 3, 2, 0], n = ["none", "none", "none", "tremolo2"], o = ot[t.charCodeAt(i++)], h = it(0, s.length, ot[t.charCodeAt(i++)]), a = this.channels[o].instruments[0], r = T[o][0]; a.vibrato = s[h], null != r.filterEnvelope && 1 != r.filterEnvelope.type || (r.filterEnvelope = e.envelopes.dictionary[n[h]], a.convertLegacySettings(r, E)), a.vibrato != e.vibratos.dictionary.none.index && (a.effects |= 512) } else if (c && s) { const s = [0, 1, 2, 3, 0, 0], o = ["none", "none", "none", "none", "tremolo5", "tremolo2"]; for (let h = 0; h < this.getChannelCount(); h++)for (let a = 0; a < this.channels[h].instruments.length; a++) { const r = it(0, s.length, ot[t.charCodeAt(i++)]), c = this.channels[h].instruments[a], d = T[h][a]; c.vibrato = s[r], null != d.filterEnvelope && 1 != d.filterEnvelope.type || (d.filterEnvelope = e.envelopes.dictionary[o[r]], c.convertLegacySettings(d, E)), c.vibrato != e.vibratos.dictionary.none.index && (c.effects |= 512), (0 != P || n && l) && !this.getChannelIsNoise(h) && (c.effects |= 1, c.reverb = P) } } else { const s = [0, 1, 2, 3, 0, 0], o = ["none", "none", "none", "none", "tremolo5", "tremolo2"], h = it(0, s.length, ot[t.charCodeAt(i++)]), a = this.channels[A].instruments[L], r = T[A][L]; a.vibrato = s[h], null != r.filterEnvelope && 1 != r.filterEnvelope.type || (r.filterEnvelope = e.envelopes.dictionary[o[h]], a.convertLegacySettings(r, E)), a.vibrato != e.vibratos.dictionary.none.index && (a.effects |= 512), (0 != P || n && l) && (a.effects |= 1, a.reverb = P) } else { const s = this.channels[A].instruments[L], n = it(0, e.vibratos.length + 1, ot[t.charCodeAt(i++)]); s.vibrato = n, s.vibrato != e.vibratos.dictionary.none.index && (s.effects |= 512), n == e.vibratos.length ? (s.vibratoDepth = it(0, e.modulators.dictionary["vibrato depth"].maxRawVol + 1, ot[t.charCodeAt(i++)]) / 50, s.vibratoSpeed = it(0, e.modulators.dictionary["vibrato speed"].maxRawVol + 1, ot[t.charCodeAt(i++)]), s.vibratoDelay = it(0, e.modulators.dictionary["vibrato delay"].maxRawVol + 1, ot[t.charCodeAt(i++)]) / 2, s.vibratoType = it(0, e.vibratoTypes.length, ot[t.charCodeAt(i++)]), s.effects |= 512) : (s.vibratoDepth = e.vibratos[s.vibrato].amplitude, s.vibratoSpeed = 10, s.vibratoDelay = e.vibratos[s.vibrato].delayTicks / 2, s.vibratoType = e.vibratos[s.vibrato].type) } break; case 71: if (n && l) { const s = this.channels[A].instruments[L]; s.arpeggioSpeed = it(0, e.modulators.dictionary["arp speed"].maxRawVol + 1, ot[t.charCodeAt(i++)]), s.fastTwoNoteArp = !!ot[t.charCodeAt(i++)] } break; case 104: if (a && s) { const s = ot[t.charCodeAt(i++)]; this.channels[s].instruments[0].unison = it(0, e.unisons.length, ot[t.charCodeAt(i++)]) } else if (c && s) for (let s = 0; s < this.getChannelCount(); s++)for (const n of this.channels[s].instruments) { const s = ot[t.charCodeAt(i++)]; let o = it(0, e.unisons.length, s); 8 == s && (o = 2, n.chord = 3), n.unison = o } else if (M && s) { const s = ot[t.charCodeAt(i++)]; let n = it(0, e.unisons.length, s); 8 == s && (n = 2, this.channels[A].instruments[L].chord = 3), this.channels[A].instruments[L].unison = n } else this.channels[A].instruments[L].unison = it(0, e.unisons.length, ot[t.charCodeAt(i++)]); break; case 67: if (C && s || l && n) { const s = this.channels[A].instruments[L]; s.chord = it(0, e.chords.length, ot[t.charCodeAt(i++)]), s.chord != e.chords.dictionary.simultaneous.index && (s.effects |= 2048) } break; case 113: { const o = this.channels[A].instruments[L]; if (C && s || l && n) { o.effects = 4095 & ot[t.charCodeAt(i++)], 0 != P || n && l ? x(o.effects) && (o.reverb = P) : o.effects &= -2, o.effects |= 4, o.vibrato != e.vibratos.dictionary.none.index && (o.effects |= 512), o.detune != e.detuneCenter && (o.effects |= 256), o.aliases ? o.effects |= 8 : o.effects &= -9; const s = T[A][L]; o.convertLegacySettings(s, E) } else { if (o.effects = ot[t.charCodeAt(i++)] << 6 | ot[t.charCodeAt(i++)], y(o.effects)) { let h = ot[t.charCodeAt(i++)]; if (s || 0 == h) { o.noteFilterType = !1, n && (h = ot[t.charCodeAt(i++)]), o.noteFilter.controlPointCount = it(0, e.filterMaxPoints + 1, h); for (let t = o.noteFilter.controlPoints.length; t < o.noteFilter.controlPointCount; t++)o.noteFilter.controlPoints[t] = new yt; for (let s = 0; s < o.noteFilter.controlPointCount; s++) { const n = o.noteFilter.controlPoints[s]; n.type = it(0, 3, ot[t.charCodeAt(i++)]), n.freq = it(0, e.filterFreqRange, ot[t.charCodeAt(i++)]), n.gain = it(0, e.filterGainRange, ot[t.charCodeAt(i++)]) } for (let t = o.noteFilter.controlPointCount; t < h; t++)i += 3; if (o.noteSubFilters[0] = o.noteFilter, n && !l) { let s = ot[t.charCodeAt(i++)] << 6 | ot[t.charCodeAt(i++)]; for (let n = 0; n < e.filterMorphCount - 1; n++)if (s & 1 << n) { const s = ot[t.charCodeAt(i++)]; null == o.noteSubFilters[n + 1] && (o.noteSubFilters[n + 1] = new bt), o.noteSubFilters[n + 1].controlPointCount = it(0, e.filterMaxPoints + 1, s); for (let t = o.noteSubFilters[n + 1].controlPoints.length; t < o.noteSubFilters[n + 1].controlPointCount; t++)o.noteSubFilters[n + 1].controlPoints[t] = new yt; for (let s = 0; s < o.noteSubFilters[n + 1].controlPointCount; s++) { const h = o.noteSubFilters[n + 1].controlPoints[s]; h.type = it(0, 3, ot[t.charCodeAt(i++)]), h.freq = it(0, e.filterFreqRange, ot[t.charCodeAt(i++)]), h.gain = it(0, e.filterGainRange, ot[t.charCodeAt(i++)]) } for (let t = o.noteSubFilters[n + 1].controlPointCount; t < s; t++)i += 3 } } } else o.noteFilterType = !0, o.noteFilter.reset(), o.noteFilterSimpleCut = it(0, e.filterSimpleCutRange, ot[t.charCodeAt(i++)]), o.noteFilterSimplePeak = it(0, e.filterSimplePeakRange, ot[t.charCodeAt(i++)]) } d(o.effects) && (o.transition = it(0, e.transitions.length, ot[t.charCodeAt(i++)])), p(o.effects) && (o.chord = it(0, e.chords.length, ot[t.charCodeAt(i++)]), o.chord == e.chords.dictionary.arpeggio.index && n && (o.arpeggioSpeed = ot[t.charCodeAt(i++)], o.fastTwoNoteArp = !!ot[t.charCodeAt(i++)])), u(o.effects) && (o.pitchShift = it(0, e.pitchShiftRange, ot[t.charCodeAt(i++)])), m(o.effects) && (s ? (o.detune = it(e.detuneMin, e.detuneMax + 1, ot[t.charCodeAt(i++)]), o.detune = Math.round((o.detune - 9) * (Math.abs(o.detune - 9) + 1) / 2 + e.detuneCenter)) : o.detune = it(e.detuneMin, e.detuneMax + 1, (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)])), f(o.effects) && (o.vibrato = it(0, e.vibratos.length + 1, ot[t.charCodeAt(i++)]), o.vibrato == e.vibratos.length && n ? (o.vibratoDepth = it(0, e.modulators.dictionary["vibrato depth"].maxRawVol + 1, ot[t.charCodeAt(i++)]) / 25, o.vibratoSpeed = it(0, e.modulators.dictionary["vibrato speed"].maxRawVol + 1, ot[t.charCodeAt(i++)]), o.vibratoDelay = it(0, e.modulators.dictionary["vibrato delay"].maxRawVol + 1, ot[t.charCodeAt(i++)]), o.vibratoType = it(0, e.vibratoTypes.length, ot[t.charCodeAt(i++)])) : (o.vibratoDepth = e.vibratos[o.vibrato].amplitude, o.vibratoSpeed = 10, o.vibratoDelay = e.vibratos[o.vibrato].delayTicks / 2, o.vibratoType = e.vibratos[o.vibrato].type)), b(o.effects) && (o.distortion = it(0, e.distortionRange, ot[t.charCodeAt(i++)]), n && !l && (o.aliases = !!ot[t.charCodeAt(i++)])), g(o.effects) && (o.bitcrusherFreq = it(0, e.bitcrusherFreqRange, ot[t.charCodeAt(i++)]), o.bitcrusherQuantization = it(0, e.bitcrusherQuantizationRange, ot[t.charCodeAt(i++)])), w(o.effects) && (o.pan = it(0, e.panMax + 1, s ? Math.round(ot[t.charCodeAt(i++)] * (e.panMax / 8)) : (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)]), n && !h && (o.panDelay = ot[t.charCodeAt(i++)])), v(o.effects) && (o.chorus = s ? 2 * it(0, e.chorusRange / 2 + 1, ot[t.charCodeAt(i++)]) : it(0, e.chorusRange, ot[t.charCodeAt(i++)])), k(o.effects) && (o.echoSustain = it(0, e.echoSustainRange, ot[t.charCodeAt(i++)]), o.echoDelay = it(0, e.echoDelayRange, ot[t.charCodeAt(i++)])), x(o.effects) && (o.reverb = it(0, e.reverbRange, s ? Math.round(ot[t.charCodeAt(i++)] * e.reverbRange / 3) : ot[t.charCodeAt(i++)])) } o.effects &= 4095 } break; case 118: if (a && s) { const s = ot[t.charCodeAt(i++)]; this.channels[s].instruments[0].volume = Math.round(it(-e.volumeRange / 2, 1, 5 * -ot[t.charCodeAt(i++)])) } else if (c && s) for (let s = 0; s < this.getChannelCount(); s++)for (const n of this.channels[s].instruments) n.volume = Math.round(it(-e.volumeRange / 2, 1, 5 * -ot[t.charCodeAt(i++)])); else if (M && s) { this.channels[A].instruments[L].volume = Math.round(it(-e.volumeRange / 2, 1, 5 * -ot[t.charCodeAt(i++)])) } else if (s) { this.channels[A].instruments[L].volume = Math.round(it(-e.volumeRange / 2, 1, 25 * -ot[t.charCodeAt(i++)] / 7)) } else { this.channels[A].instruments[L].volume = Math.round(it(-e.volumeRange / 2, e.volumeRange / 2 + 1, (ot[t.charCodeAt(i++)] << 6 | ot[t.charCodeAt(i++)]) - e.volumeRange / 2)) } break; case 76: if (C && s) { this.channels[A].instruments[L].pan = it(0, e.panMax + 1, ot[t.charCodeAt(i++)] * (e.panMax / 8)) } else if (l && n) { const s = this.channels[A].instruments[L]; s.pan = it(0, e.panMax + 1, (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)]), n && !a && (s.panDelay = ot[t.charCodeAt(i++)]) } break; case 68: { const s = this.channels[A].instruments[L]; n && l && (s.detune = it(e.detuneMin, e.detuneMax + 1, 4 * ((ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)])), s.effects |= 256) } break; case 77: { let e = this.channels[A].instruments[L]; for (let s = 0; s < 64; s++)e.customChipWave[s] = it(-24, 25, ot[t.charCodeAt(i++)] - 24); let s = 0; for (let t = 0; t < e.customChipWave.length; t++)s += e.customChipWave[t]; const n = s / e.customChipWave.length; let o = 0, h = 0; for (let t = 0; t < e.customChipWave.length; t++)o += h, h = e.customChipWave[t] - n, e.customChipWaveIntegral[t] = o; e.customChipWaveIntegral[64] = 0 } break; case 79: { let e = ot[t.charCodeAt(i++)]; 63 == e ? this.restoreLimiterDefaults() : (this.compressionRatio = e < 10 ? e / 10 : 1 + (e - 10) / 60, e = ot[t.charCodeAt(i++)], this.limitRatio = e < 10 ? e / 10 : e - 9, this.limitDecay = ot[t.charCodeAt(i++)], this.limitRise = 250 * ot[t.charCodeAt(i++)] + 2e3, this.compressionThreshold = ot[t.charCodeAt(i++)] / 20, this.limitThreshold = ot[t.charCodeAt(i++)] / 20, this.masterGain = ((ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)]) / 50) } break; case 85: for (let e = 0; e < this.getChannelCount(); e++) { var z; z = r ? ot[t.charCodeAt(i++)] : (ot[t.charCodeAt(i++)] << 6) + ot[t.charCodeAt(i++)], this.channels[e].name = decodeURIComponent(t.substring(i, i + z)), i += z } break; case 65: { const o = this.channels[A].instruments[L]; if (o.algorithm = it(0, e.algorithms.length, ot[t.charCodeAt(i++)]), C && s || l && n) { const t = T[A][L]; o.convertLegacySettings(t, E) } } break; case 70: this.channels[A].instruments[L].feedbackType = it(0, e.feedbacks.length, ot[t.charCodeAt(i++)]); break; case 66: this.channels[A].instruments[L].feedbackAmplitude = it(0, e.operatorAmplitudeMax + 1, ot[t.charCodeAt(i++)]); break; case 86: if (C && s || l && n) { const e = this.channels[A].instruments[L], s = T[A][L]; s.feedbackEnvelope = kt.gt(ot[t.charCodeAt(i++)]), e.convertLegacySettings(s, E) } break; case 81: for (let s = 0; s < e.operatorCount; s++)this.channels[A].instruments[L].operators[s].frequency = it(0, e.operatorFrequencies.length, ot[t.charCodeAt(i++)]); break; case 80: for (let s = 0; s < e.operatorCount; s++)this.channels[A].instruments[L].operators[s].amplitude = it(0, e.operatorAmplitudeMax + 1, ot[t.charCodeAt(i++)]); break; case 69: { const o = this.channels[A].instruments[L]; if (C && s || l && n) { const s = T[A][L]; s.operatorEnvelopes = []; for (let n = 0; n < e.operatorCount; n++)s.operatorEnvelopes[n] = kt.gt(ot[t.charCodeAt(i++)]); o.convertLegacySettings(s, E) } else { const s = it(0, e.maxEnvelopeCount + 1, ot[t.charCodeAt(i++)]); for (let n = 0; n < s; n++) { const s = it(0, e.instrumentAutomationTargets.length, ot[t.charCodeAt(i++)]); let n = 0; const h = e.instrumentAutomationTargets[s].maxCount; h > 1 && (n = it(0, h, ot[t.charCodeAt(i++)])); const a = it(0, e.envelopes.length, ot[t.charCodeAt(i++)]); o.addEnvelope(s, n, a) } } } break; case 82: { const s = this.channels[A].instruments[L]; for (let n = 0; n < e.operatorCount; n++)s.operators[n].waveform = it(0, e.operatorWaves.length, ot[t.charCodeAt(i++)]), 3 == s.operators[n].waveform && (s.operators[n].pulseWidth = it(0, e.pwmOperatorWaves.length, ot[t.charCodeAt(i++)])) } break; case 83: { const s = this.channels[A].instruments[L]; if (3 == s.type) { const n = Math.ceil(e.spectrumControlPoints * e.spectrumControlPointBits / 6), o = new ht(t, i, i + n); for (let t = 0; t < e.spectrumControlPoints; t++)s.spectrumWave.spectrum[t] = o.read(e.spectrumControlPointBits); s.spectrumWave.markCustomWaveDirty(), i += n } else { if (4 != s.type) throw new Error("Unhandled instrument type for spectrum song tag code."); { const n = Math.ceil(e.drumCount * e.spectrumControlPoints * e.spectrumControlPointBits / 6), o = new ht(t, i, i + n); for (let t = 0; t < e.drumCount; t++) { for (let i = 0; i < e.spectrumControlPoints; i++)s.drumsetSpectrumWaves[t].spectrum[i] = o.read(e.spectrumControlPointBits); s.drumsetSpectrumWaves[t].markCustomWaveDirty() } i += n } } } break; case 72: { const s = this.channels[A].instruments[L], n = Math.ceil(e.harmonicsControlPoints * e.harmonicsControlPointBits / 6), o = new ht(t, i, i + n); for (let t = 0; t < e.harmonicsControlPoints; t++)s.harmonicsWave.harmonics[t] = o.read(e.harmonicsControlPointBits); s.harmonicsWave.markCustomWaveDirty(), i += n } break; case 88: if (n && l) { const e = this.channels[A].instruments[L]; e.aliases = !!ot[t.charCodeAt(i++)], e.aliases && (e.distortion = 0, e.effects |= 8) } break; case 98: { let e; if (a && s) { const s = ot[t.charCodeAt(i++)], n = ot[t.charCodeAt(i++)]; e = Math.ceil(.5 * n); const o = new ht(t, i, i + e); for (let t = 0; t < n; t++)this.channels[s].bars[t] = o.read(3) + 1 } else if (l && s) { let s = 0; for (; 1 << s < this.patternsPerChannel;)s++; e = Math.ceil(this.getChannelCount() * this.barCount * s / 6); const n = new ht(t, i, i + e); for (let t = 0; t < this.getChannelCount(); t++)for (let e = 0; e < this.barCount; e++)this.channels[t].bars[e] = n.read(s) + 1 } else { let s = 0; for (; 1 << s < this.patternsPerChannel + 1;)s++; e = Math.ceil(this.getChannelCount() * this.barCount * s / 6); const n = new ht(t, i, i + e); for (let t = 0; t < this.getChannelCount(); t++)for (let e = 0; e < this.barCount; e++)this.channels[t].bars[e] = n.read(s) } i += e } break; case 112: { let o, h = 0, c = !(r && n || s), d = c ? 4 : 3, p = c ? 16 : 8; if (a && s) o = ot[t.charCodeAt(i++)], i++, h = ot[t.charCodeAt(i++)], h <<= 6, h += ot[t.charCodeAt(i++)]; else { o = 0; let e = st(1, 4, ot[t.charCodeAt(i++)]); for (; e > 0;)h <<= 6, h += ot[t.charCodeAt(i++)], e-- } const u = new ht(t, i, i + h); i += h; const m = kt.getNeededBits(e.noteSizeMax); let f = -1, b = -1, g = -1; for (; ;) { const t = this.channels[o], i = this.getChannelIsNoise(o), h = this.getChannelIsMod(o), w = this.getMaxInstrumentsPerPattern(o), v = kt.getNeededBits(w - e.instrumentCountMin), k = kt.getNeededBits(t.instruments.length - 1); if (h) { const i = l ? k : kt.getNeededBits(this.getMaxInstrumentsPerChannel() + 2); for (let s = 0; s < t.instruments.length; s++) { let n = t.instruments[s]; for (let t = 0; t < e.modCount; t++) { let h = u.read(2); switch (h) { case 0: n.modChannels[t] = it(0, this.pitchChannelCount + this.noiseChannelCount + 1, u.read(8)), n.modInstruments[t] = it(0, this.channels[n.modChannels[t]].instruments.length + 2, u.read(i)); break; case 1: n.modChannels[t] = this.pitchChannelCount + it(0, this.noiseChannelCount + 1, u.read(8)), n.modInstruments[t] = it(0, this.channels[n.modChannels[t]].instruments.length + 2, u.read(k)); break; case 2: n.modChannels[t] = -1; break; case 3: n.modChannels[t] = -2 }if (3 != h && (n.modulators[t] = u.read(6)), l || "eq filter" != e.modulators[n.modulators[t]].name && "note filter" != e.modulators[n.modulators[t]].name || (n.modFilterTypes[t] = u.read(6)), l && n.modChannels[t] >= 0) { let i = y(this.channels[n.modChannels[t]].instruments[n.modInstruments[t]].effects); 7 == n.modulators[t] ? (n.modulators[t] = i ? e.modulators.dictionary["note filt cut"].index : e.modulators.dictionary["eq filt cut"].index, n.modFilterTypes[t] = 1) : 8 == n.modulators[t] && (n.modulators[t] = i ? e.modulators.dictionary["note filt peak"].index : e.modulators.dictionary["eq filt peak"].index, n.modFilterTypes[t] = 2) } else l && n.modulators[t] == e.modulators.dictionary["song reverb"].index && (f = o, b = s, g = t); l && 12 != e.modulators[n.modulators[t]].associatedEffect && (this.channels[n.modChannels[t]].instruments[n.modInstruments[t]].effects |= 1 << e.modulators[n.modulators[t]].associatedEffect) } } } const x = []; for (let i = 0; i < t.instruments.length; i++) { x[i] = []; for (let s = 0; s < e.modCount; s++)x[i][e.modCount - 1 - s] = 1 + 3 * +(l && n && h && t.instruments[i].modulators[s] == e.modulators.dictionary.detune.index) } const S = i || h ? 0 : 12 * t.octave; let F = i || h ? 4 : S; const E = h ? [0, 1, 2, 3, 4, 5] : i ? [4, 6, 7, 2, 3, 8, 0, 10] : [0, 7, 12, 19, 24, -5, -12], T = []; for (let t = 0; t < E.length; t++)E[t] += S; for (let i = 0; i < this.patternsPerChannel; i++) { const o = t.patterns[i]; if (C && s || l && n) o.instruments[0] = st(0, t.instruments.length - 1, u.read(k)), o.instruments.length = 1; else if (this.patternInstruments) { const i = st(e.instrumentCountMin, w, u.read(v) + e.instrumentCountMin); for (let e = 0; e < i; e++)o.instruments[e] = st(0, t.instruments.length - 1 + 2 * +h, u.read(k)); o.instruments.length = i } else o.instruments[0] = 0, o.instruments.length = e.instrumentCountMin; if (!(s && a || 0 != u.read(1))) { o.notes.length = 0; continue } let f = 0; const y = o.notes; let b = 0; for (; f < this.beatsPerBar * e.partsPerBeat + +h;) { const i = 1 == u.read(1); let a = !1, g = 0; if (i ? g = st(0, T.length - 1, u.readLongTail(0, 0)) : a = 1 == u.read(1), i || a) { let a, w, v; if (i) a = T[g], T.splice(g, 1); else { if (a = {}, c) 1 == u.read(1) ? a.pitchCount = u.read(3) + 2 : a.pitchCount = 1; else for (a.pitchCount = 1; a.pitchCount < 4 && 1 == u.read(1);)a.pitchCount++; a.pinCount = u.readPinCount(), a.initialSize = s ? 2 * u.read(2) : h ? u.read(9) : u.read(m), a.pins = [], a.length = 0, a.bendCount = 0; for (let t = 0; t < a.pinCount; t++) { let t = {}; t.pitchBend = 1 == u.read(1), t.pitchBend && a.bendCount++, a.length += M && s ? u.readLegacyPartDuration() * e.partsPerBeat / e.rhythms[this.rhythm].stepsPerBeat : u.readPartDuration(), t.time = a.length, t.size = s ? 2 * u.read(2) : h ? u.read(9) : u.read(m), a.pins.push(t) } } T.unshift(a), T.length > 10 && T.pop(), y.length <= b ? (w = new lt(0, f, f + a.length, a.initialSize), y[b++] = w) : (w = y[b++], w.start = f, w.end = f + a.length, w.pins[0].size = a.initialSize); let k = 0; const S = []; for (let t = 0; t < a.pitchCount + a.bendCount; t++) { if (1 == u.read(1)) { const t = st(0, E.length - 1, u.read(d)); v = E[t], E.splice(t, 1) } else { const t = u.readPitchInterval(); v = F; let e = t; for (; e > 0;) { for (v++; -1 != E.indexOf(v);)v++; e-- } for (; e < 0;) { for (v--; -1 != E.indexOf(v);)v--; e++ } } E.unshift(v), E.length > p && E.pop(), t < a.pitchCount ? w.pitches[k++] = v : S.push(v), F = t == a.pitchCount - 1 ? w.pitches[0] : v } w.pitches.length = k, S.unshift(w.pitches[0]), h && (w.pins[0].size *= x[o.instruments[0]][w.pitches[0]]); let I = 1; for (const t of a.pins) { t.pitchBend && S.shift(); const e = S[0] - w.pitches[0]; if (w.pins.length <= I) w.pins[I++] = rt(e, t.time, h ? t.size * x[o.instruments[0]][w.pitches[0]] : t.size); else { const i = w.pins[I++]; i.interval = e, i.time = t.time, i.size = h ? t.size * x[o.instruments[0]][w.pitches[0]] : t.size } } w.pins.length = I, 0 == w.start && (w.continuesLastPattern = C && s || l && n ? !r && !s && t.instruments[o.instruments[0]].legacyTieOver : 1 == u.read(1)), f = st(0, this.beatsPerBar * e.partsPerBeat, w.end) } else if (h) { const t = 1 == u.read(1), e = u.readPartDuration(); t ? f -= e : f += e } else { f += M && s ? u.readLegacyPartDuration() * e.partsPerBeat / e.rhythms[this.rhythm].stepsPerBeat : u.readPartDuration() } } y.length = b } if (a && s) break; if (o++, o >= this.getChannelCount()) break } if (n && l && g >= 0) for (let t = 0; t < this.channels.length; t++)for (let i = 0; i < this.channels[t].instruments.length; i++) { const s = this.channels[t].instruments[i]; if (x(s.effects) && (s.reverb = e.reverbRange - 1), f == t && b == i) { const i = this.channels[t].bars[0]; if (i > 0) { const s = this.channels[t].patterns[i - 1]; let n = 6; for (const t of s.notes) t.pitches[0] == e.modCount - 1 - g && (n = Math.min(n, t.start)); n > 0 && s.notes.push(new lt(e.modCount - 1 - g, 0, n, P)) } else if (this.channels[t].patterns.length < e.barCountMax) { const i = new ct; if (this.channels[t].patterns.push(i), this.channels[t].bars[0] = this.channels[t].patterns.length, this.channels[t].patterns.length > this.patternsPerChannel) { for (let t = 0; t < this.channels.length; t++)this.channels[t].patterns.length <= this.patternsPerChannel && this.channels[t].patterns.push(new ct); this.patternsPerChannel++ } i.instruments.length = 1, i.instruments[0] = b, i.notes.length = 0, i.notes.push(new lt(e.modCount - 1 - g, 0, 6, P)) } } } } break; default: throw new Error("Unrecognized song tag code " + String.fromCharCode(I) + " at index " + (i - 1)) } } toJsonObject(t = !0, i = 1, s = !0) { const n = []; for (let e = 0; e < this.getChannelCount(); e++) { const o = this.channels[e], h = [], a = this.getChannelIsNoise(e), r = this.getChannelIsMod(e); for (const t of o.instruments) h.push(t.toJsonObject()); const l = []; for (const t of o.patterns) l.push(t.toJsonObject(this, o, r)); const c = []; if (t) for (let t = 0; t < this.loopStart; t++)c.push(o.bars[t]); for (let t = 0; t < i; t++)for (let t = this.loopStart; t < this.loopStart + this.loopLength; t++)c.push(o.bars[t]); if (s) for (let t = this.loopStart + this.loopLength; t < this.barCount; t++)c.push(o.bars[t]); const d = { type: r ? "mod" : a ? "drum" : "pitch", name: o.name, instruments: h, patterns: l, sequence: c }; a || (d.octaveScrollBar = o.octave - 1), n.push(d) } return { name: this.title, format: kt.xt, version: kt.bt, scale: e.scales[this.scale].name, key: e.keys[this.key].name, introBars: this.loopStart, loopBars: this.loopLength, beatsPerBar: this.beatsPerBar, ticksPerBeat: e.rhythms[this.rhythm].stepsPerBeat, beatsPerMinute: this.tempo, reverb: this.reverb, masterGain: this.masterGain, compressionThreshold: this.compressionThreshold, limitThreshold: this.limitThreshold, limitDecay: this.limitDecay, limitRise: this.limitRise, limitRatio: this.limitRatio, compressionRatio: this.compressionRatio, layeredInstruments: this.layeredInstruments, patternInstruments: this.patternInstruments, channels: n } } fromJsonObject(t) { if (this.initToDefault(!0), !t) return; if (null != t.name && (this.title = t.name), this.scale = 0, null != t.scale) { const i = { "romani :)": "dbl harmonic :)", "romani :(": "dbl harmonic :(", enigma: "strange" }, s = null != i[t.scale] ? i[t.scale] : t.scale, n = e.scales.findIndex((t => t.name == s)); -1 != n && (this.scale = n) } if (null != t.key) if ("number" == typeof t.key) this.key = (t.key + 1200 >>> 0) % e.keys.length; else if ("string" == typeof t.key) { const e = t.key, i = e.charAt(0).toUpperCase(), s = e.charAt(1).toLowerCase(); let n = { C: 0, D: 2, E: 4, F: 5, G: 7, A: 9, B: 11 }[i]; const o = { "#": 1, "": 1, b: -1, "": -1 }[s]; null != n && (null != o && (n += o), n < 0 && (n += 12), n %= 12, this.key = n) } null != t.beatsPerMinute && (this.tempo = it(e.tempoMin, e.tempoMax + 1, 0 | t.beatsPerMinute)); let i = 0; null != t.reverb && (i = it(0, 32, 0 | t.reverb)), null != t.beatsPerBar && (this.beatsPerBar = Math.max(e.beatsPerBarMin, Math.min(e.beatsPerBarMax, 0 | t.beatsPerBar))); let s = 4; null != t.ticksPerBeat && (s = 0 | t.ticksPerBeat || 4, this.rhythm = e.rhythms.findIndex((t => t.stepsPerBeat == s)), -1 == this.rhythm && (this.rhythm = 1)), null != t.masterGain ? this.masterGain = Math.max(0, Math.min(5, t.masterGain || 0)) : this.masterGain = 1, null != t.limitThreshold ? this.limitThreshold = Math.max(0, Math.min(2, t.limitThreshold || 0)) : this.limitThreshold = 1, null != t.compressionThreshold ? this.compressionThreshold = Math.max(0, Math.min(1.1, t.compressionThreshold || 0)) : this.compressionThreshold = 1, null != t.limitRise ? this.limitRise = Math.max(2e3, Math.min(1e4, t.limitRise || 0)) : this.limitRise = 4e3, null != t.limitDecay ? this.limitDecay = Math.max(1, Math.min(30, t.limitDecay || 0)) : this.limitDecay = 4, null != t.limitRatio ? this.limitRatio = Math.max(0, Math.min(11, t.limitRatio || 0)) : this.limitRatio = 1, null != t.compressionRatio ? this.compressionRatio = Math.max(0, Math.min(1.168, t.compressionRatio || 0)) : this.compressionRatio = 1; let n = 1, o = 1, h = 1; if (null != t.channels) for (const e of t.channels) e.instruments && (n = Math.max(n, 0 | e.instruments.length)), e.patterns && (o = Math.max(o, 0 | e.patterns.length)), e.sequence && (h = Math.max(h, 0 | e.sequence.length)); null != t.layeredInstruments ? this.layeredInstruments = !!t.layeredInstruments : this.layeredInstruments = !1, null != t.patternInstruments ? this.patternInstruments = !!t.patternInstruments : this.patternInstruments = n > 1, this.patternsPerChannel = Math.min(o, e.barCountMax), this.barCount = Math.min(h, e.barCountMax), null != t.introBars && (this.loopStart = it(0, this.barCount, 0 | t.introBars)), null != t.loopBars && (this.loopLength = it(1, this.barCount - this.loopStart + 1, 0 | t.loopBars)); const a = [], r = [], l = []; if (null != t.channels) for (let n = 0; n < t.channels.length; n++) { let o = t.channels[n]; const h = new vt; let c = !1, d = !1; if (null != o.type ? (c = "drum" == o.type, d = "mod" == o.type) : c = n >= 3, c ? r.push(h) : d ? l.push(h) : a.push(h), null != o.octaveScrollBar && (h.octave = it(0, e.pitchOctaves, 1 + (0 | o.octaveScrollBar)), c && (h.octave = 0)), null != o.name ? h.name = o.name : h.name = "", Array.isArray(o.instruments)) { const t = o.instruments; for (let e = 0; e < t.length && !(e >= this.getMaxInstrumentsPerChannel()); e++) { const s = new wt(c, d); h.instruments[e] = s, s.fromJsonObject(t[e], c, d, !1, !1, i) } } for (let t = 0; t < this.patternsPerChannel; t++) { const e = new ct; h.patterns[t] = e; let i = void 0; o.patterns && (i = o.patterns[t]), null != i && e.fromJsonObject(i, this, h, s, c, d) } h.patterns.length = this.patternsPerChannel; for (let t = 0; t < this.barCount; t++)h.bars[t] = null != o.sequence ? Math.min(this.patternsPerChannel, o.sequence[t] >>> 0) : 0; h.bars.length = this.barCount } a.length > e.pitchChannelCountMax && (a.length = e.pitchChannelCountMax), r.length > e.noiseChannelCountMax && (r.length = e.noiseChannelCountMax), l.length > e.modChannelCountMax && (l.length = e.modChannelCountMax), this.pitchChannelCount = a.length, this.noiseChannelCount = r.length, this.modChannelCount = l.length, this.channels.length = 0, Array.prototype.push.apply(this.channels, a), Array.prototype.push.apply(this.channels, r), Array.prototype.push.apply(this.channels, l) } getPattern(t, e) { if (e < 0 || e >= this.barCount) return null; const i = this.channels[t].bars[e]; return 0 == i ? null : this.channels[t].patterns[i - 1] } getBeatsPerMinute() { return this.tempo } static getNeededBits(t) { return 32 - Math.clz32(Math.ceil(t + 1) - 1) } restoreLimiterDefaults() { this.compressionRatio = 1, this.limitRatio = 1, this.limitRise = 4e3, this.limitDecay = 4, this.limitThreshold = 1, this.compressionThreshold = 1, this.masterGain = 1 } } kt.xt = "BeepBox", kt.vt = 2, kt.wt = 9, kt.kt = 1, kt.bt = 5, kt.yt = 106; class xt { constructor() { this.delayLine = null, this.allPassG = 0, this.allPassGDelta = 0, this.shelfA1 = 0, this.shelfA1Delta = 0, this.shelfB0 = 0, this.shelfB0Delta = 0, this.shelfB1 = 0, this.shelfB1Delta = 0, this.reset() } reset() { this.delayIndex = -1, this.allPassSample = 0, this.allPassPrevInput = 0, this.shelfSample = 0, this.shelfPrevInput = 0, this.fractionalDelaySample = 0, this.prevDelayLength = -1, this.delayResetOffset = 0 } update(t, i, s, n, o, h, a) { const r = 2 * Math.PI * e.pickedStringDispersionCenterFreq / t.samplesPerSecond, l = 2 * Math.PI * e.pickedStringShelfHz / t.samplesPerSecond, c = (Math.pow(100, h) - 1) / 99, d = (Math.pow(100, a) - 1) / 99, p = this.prevDelayLength, u = s.phaseDeltas[n], m = s.phaseDeltaScales[n], f = u * Math.pow(m, o), y = 2 * Math.PI * u, b = 2 * Math.PI * f, g = 2 * y, w = 2 * b, v = Math.min(Math.PI, y * e.pickedStringDispersionFreqMult * Math.pow(r / y, e.pickedStringDispersionFreqScale)), k = Math.min(Math.PI, b * e.pickedStringDispersionFreqMult * Math.pow(r / b, e.pickedStringDispersionFreqScale)), x = Math.pow(.5, c * l / y), M = Math.pow(.5, d * l / b), S = Math.pow(x, e.stringDecayRate), F = Math.pow(M, e.stringDecayRate), C = Math.pow(x, .002), E = Math.pow(M, .002); Et.tempFilterStartCoefficients.allPass1stOrderInvertPhaseAbove(v), t.tempFrequencyResponse.analyze(Et.tempFilterStartCoefficients, g); const T = Et.tempFilterStartCoefficients.b[0], I = -t.tempFrequencyResponse.angle() / g; Et.tempFilterEndCoefficients.allPass1stOrderInvertPhaseAbove(k), t.tempFrequencyResponse.analyze(Et.tempFilterEndCoefficients, w); const P = Et.tempFilterEndCoefficients.b[0], A = -t.tempFrequencyResponse.angle() / w; Et.tempFilterStartCoefficients.highShelf1stOrder(l, S), t.tempFrequencyResponse.analyze(Et.tempFilterStartCoefficients, g); const L = Et.tempFilterStartCoefficients.a[1], q = Et.tempFilterStartCoefficients.b[0] * C, D = Et.tempFilterStartCoefficients.b[1] * C, N = -t.tempFrequencyResponse.angle() / g; Et.tempFilterEndCoefficients.highShelf1stOrder(l, F), t.tempFrequencyResponse.analyze(Et.tempFilterEndCoefficients, w); const z = Et.tempFilterEndCoefficients.a[1], B = Et.tempFilterEndCoefficients.b[0] * E, R = Et.tempFilterEndCoefficients.b[1] * E, O = -t.tempFrequencyResponse.angle() / w, $ = 1 / u, H = 1 / f, V = Math.ceil(2 * Math.max($, H)), G = $ - I - N, _ = H - A - O; this.prevDelayLength = G, this.delayLengthDelta = (_ - G) / o, this.allPassG = T, this.shelfA1 = L, this.shelfB0 = q, this.shelfB1 = D, this.allPassGDelta = (P - T) / o, this.shelfA1Delta = (z - L) / o, this.shelfB0Delta = (B - q) / o, this.shelfB1Delta = (R - D) / o; const j = Math.abs(Math.log2(G / p)) > .01, U = -1 == this.delayIndex || j; if (null == this.delayLine || this.delayLine.length <= V) { const e = Math.ceil(2 * t.samplesPerSecond / wt.frequencyFromPitch(12)), i = new Float32Array(Et.fittingPowerOfTwo(Math.max(e, V))); if (!U && null != this.delayLine) { const t = this.delayLine.length - 1 >> 0, e = this.delayIndex + this.delayResetOffset; this.delayIndex = this.delayLine.length - this.delayResetOffset; for (let s = 0; s < this.delayLine.length; s++)i[s] = this.delayLine[e + s & t] } this.delayLine = i } const W = this.delayLine, K = W.length - 1 >> 0; if (U) { this.delayIndex = 0, this.allPassSample = 0, this.allPassPrevInput = 0, this.shelfSample = 0, this.shelfPrevInput = 0, this.fractionalDelaySample = 0; const e = -G, s = Math.floor(e - $ / 2), n = Math.ceil(s + 2 * $); this.delayResetOffset = n; for (let t = s; t <= n; t++)W[t & K] = 0; const o = i.wave, h = o.length - 1, a = h / $, r = Math.min(.2 * $, .003 * t.samplesPerSecond), l = Math.ceil(e), c = e + $ + r, d = c; let p = (l - e) * a, u = 0; for (let t = l; t <= d; t++) { const i = 0 | p, s = i % h; let n = o[s]; const l = p - i; n += (o[s + 1] - n) * l; const d = (n - u) / a, m = Math.min(1, (t - e) / r) * Math.min(1, (c - t) / r), f = m * m * (3 - 2 * m); W[t & K] += d * f, u = n, p += a } } } } class Mt { constructor() { this.noteSecondsStart = 0, this.noteSecondsEnd = 0, this.noteTicksStart = 0, this.noteTicksEnd = 0, this.noteSizeStart = e.noteSizeMax, this.noteSizeEnd = e.noteSizeMax, this.prevNoteSize = e.noteSizeMax, this.nextNoteSize = e.noteSizeMax, this.Mt = e.noteSizeMax, this.prevNoteSecondsStart = 0, this.prevNoteSecondsEnd = 0, this.prevNoteTicksStart = 0, this.prevNoteTicksEnd = 0, this.St = e.noteSizeMax, this.prevSlideStart = !1, this.prevSlideEnd = !1, this.nextSlideStart = !1, this.nextSlideEnd = !1, this.prevSlideRatioStart = 0, this.prevSlideRatioEnd = 0, this.nextSlideRatioStart = 0, this.nextSlideRatioEnd = 0, this.envelopeStarts = [], this.envelopeEnds = [], this.Ft = [], this.Ct = 0, this.lowpassCutoffDecayVolumeCompensation = 1; for (let t = 0; t < 33; t++)this.envelopeStarts[t] = 1, this.envelopeEnds[t] = 1; this.reset() } reset() { this.noteSecondsEnd = 0, this.noteTicksEnd = 0, this.Mt = e.noteSizeMax, this.prevNoteSecondsEnd = 0, this.prevNoteTicksEnd = 0, this.St = e.noteSizeMax, this.Ct = 0 } computeEnvelopes(t, i, s, n, o) { const h = t.getTransition(); null == o || !o.atNoteStart || h.continues || o.forceContinueAtStart || (this.prevNoteSecondsEnd = this.noteSecondsEnd, this.prevNoteTicksEnd = this.noteTicksEnd, this.St = this.Mt, this.noteSecondsEnd = 0, this.noteTicksEnd = 0), null != o && (null != o.note ? this.Mt = o.note.pins[o.note.pins.length - 1].size : this.Mt = e.noteSizeMax); const a = s + 1, r = this.noteSecondsEnd, l = r + n, c = this.noteTicksEnd, d = c + 1, p = this.prevNoteSecondsEnd, u = p + n, m = this.prevNoteTicksEnd, f = m + 1, y = 1 / (e.ticksPerPart * e.partsPerBeat), b = y * s, g = y * a; let w = this.Mt, v = this.Mt, k = this.St, x = 0, M = !1, S = !1, F = !1, C = !1, E = 0, T = 0, I = 0, P = 0; if (null != o && null != o.note && !o.passedEndOfNote) { const t = o.note.getEndPinIndex(i), n = o.note.pins[t - 1], r = o.note.pins[t], l = (o.note.start + n.time) * e.ticksPerPart, c = (o.note.start + r.time) * e.ticksPerPart, d = (s - l) / (c - l), p = (a - l) / (c - l); if (w = n.size + (r.size - n.size) * d, v = n.size + (r.size - n.size) * p, h.slides) { const t = o.noteStartPart * e.ticksPerPart, i = o.noteEndPart * e.ticksPerPart, n = .5 * (i - t), r = Math.min(n, h.slideTicks); null == o.prevNote || o.forceContinueAtStart || (s - t < r && (M = !0, E = .5 * (1 - (s - t) / r)), a - t < r && (S = !0, T = .5 * (1 - (a - t) / r))), null == o.nextNote || o.forceContinueAtEnd || (x = o.nextNote.pins[0].size, i - s < r && (F = !0, I = .5 * (1 - (i - s) / r)), i - a < r && (C = !0, P = .5 * (1 - (i - a) / r))) } } let A = 1, L = !1; for (let i = 0; i <= t.envelopeCount; i++) { let s, n, o; if (i == t.envelopeCount) { if (L) break; s = e.instrumentAutomationTargets.dictionary.noteVolume, n = 0, o = e.envelopes.dictionary["note size"] } else { let h = t.envelopes[i]; s = e.instrumentAutomationTargets[h.target], n = h.index, o = e.envelopes[h.envelope], 0 == o.type && (L = !0) } if (null != s.computeIndex) { const e = s.computeIndex + n; let i = Mt.computeEnvelope(o, r, b, w), h = Mt.computeEnvelope(o, l, g, v); if (M) { i += (Mt.computeEnvelope(o, p, b, k) - i) * E } if (S) { h += (Mt.computeEnvelope(o, u, g, k) - h) * T } if (F) { i += (Mt.computeEnvelope(o, 0, b, x) - i) * I } if (C) { h += (Mt.computeEnvelope(o, 0, g, x) - h) * P } if (this.envelopeStarts[e] *= i, this.envelopeEnds[e] *= h, this.Ft[this.Ct++] = e, s.isFilter) { const e = null != t.tmpNoteFilterStart ? t.tmpNoteFilterStart : t.noteFilter; e.controlPointCount > n && 0 == e.controlPoints[n].type && (A = Math.max(A, Mt.getLowpassCutoffDecayVolumeCompensation(o))) } } } this.noteSecondsStart = r, this.noteSecondsEnd = l, this.noteTicksStart = c, this.noteTicksEnd = d, this.prevNoteSecondsStart = p, this.prevNoteSecondsEnd = u, this.prevNoteTicksStart = m, this.prevNoteTicksEnd = f, this.prevNoteSize = k, this.nextNoteSize = x, this.noteSizeStart = w, this.noteSizeEnd = v, this.prevSlideStart = M, this.prevSlideEnd = S, this.nextSlideStart = F, this.nextSlideEnd = C, this.prevSlideRatioStart = E, this.prevSlideRatioEnd = T, this.nextSlideRatioStart = I, this.nextSlideRatioEnd = P, this.lowpassCutoffDecayVolumeCompensation = A } clearEnvelopes() { for (let t = 0; t < this.Ct; t++) { const e = this.Ft[t]; this.envelopeStarts[e] = 1, this.envelopeEnds[e] = 1 } this.Ct = 0 } static computeEnvelope(t, e, i, s) { switch (t.type) { case 0: return Et.noteSizeToVolumeMult(s); case 1: return 1; case 4: return 1 / (1 + e * t.speed); case 5: return 1 - 1 / (1 + e * t.speed); case 6: return .5 - .5 * Math.cos(2 * i * Math.PI * t.speed); case 7: return .75 - .25 * Math.cos(2 * i * Math.PI * t.speed); case 2: return Math.max(1, 2 - 10 * e); case 3: const n = .25 / Math.sqrt(t.speed); return e < n ? e / n : 1 / (1 + (e - n) * t.speed); case 8: return Math.pow(2, -t.speed * e); default: throw new Error("Unrecognized operator envelope type.") } } static getLowpassCutoffDecayVolumeCompensation(t) { return 8 == t.type ? 1.25 + .025 * t.speed : 4 == t.type ? 1 + .02 * t.speed : 1 } } class St { constructor() { this.pitches = Array(e.maxChordSize).fill(0), this.pitchCount = 0, this.chordSize = 0, this.drumsetPitch = null, this.note = null, this.prevNote = null, this.nextNote = null, this.prevNotePitchIndex = 0, this.nextNotePitchIndex = 0, this.freshlyAllocated = !0, this.atNoteStart = !1, this.isOnLastTick = !1, this.passedEndOfNote = !1, this.forceContinueAtStart = !1, this.forceContinueAtEnd = !1, this.noteStartPart = 0, this.noteEndPart = 0, this.ticksSinceReleased = 0, this.liveInputSamplesHeld = 0, this.lastInterval = 0, this.noiseSample = 0, this.stringSustainStart = 0, this.stringSustainEnd = 0, this.phases = [], this.operatorWaves = [], this.phaseDeltas = [], this.phaseDeltaScales = [], this.expression = 0, this.expressionDelta = 0, this.operatorExpressions = [], this.operatorExpressionDeltas = [], this.prevPitchExpressions = Array(e.maxPitchOrOperatorCount).fill(null), this.prevVibrato = null, this.prevStringDecay = null, this.pulseWidth = 0, this.pulseWidthDelta = 0, this.pickedStrings = [], this.noteFilters = [], this.noteFilterCount = 0, this.initialNoteFilterInput1 = 0, this.initialNoteFilterInput2 = 0, this.specialIntervalExpressionMult = 1, this.feedbackOutputs = [], this.feedbackMult = 0, this.feedbackDelta = 0, this.stereoVolumeLStart = 0, this.stereoVolumeRStart = 0, this.stereoVolumeLDelta = 0, this.stereoVolumeRDelta = 0, this.stereoDelayStart = 0, this.stereoDelayEnd = 0, this.stereoDelayDelta = 0, this.customVolumeStart = 0, this.customVolumeEnd = 0, this.filterResonanceStart = 0, this.filterResonanceDelta = 0, this.isFirstOrder = !1, this.envelopeComputer = new Mt, this.reset() } reset() { this.noiseSample = 0; for (let t = 0; t < e.maxPitchOrOperatorCount; t++)this.phases[t] = 0, this.operatorWaves[t] = e.operatorWaves[0], this.feedbackOutputs[t] = 0, this.prevPitchExpressions[t] = null; for (let t = 0; t < this.noteFilterCount; t++)this.noteFilters[t].resetOutput(); this.noteFilterCount = 0, this.initialNoteFilterInput1 = 0, this.initialNoteFilterInput2 = 0, this.liveInputSamplesHeld = 0; for (const t of this.pickedStrings) t.reset(); this.envelopeComputer.reset(), this.prevVibrato = null, this.prevStringDecay = null, this.drumsetPitch = null } } class Ft { constructor() { this.awake = !1, this.computed = !1, this.tonesAddedInThisTick = !1, this.flushingDelayLines = !1, this.deactivateAfterThisTick = !1, this.attentuationProgress = 0, this.flushedSamples = 0, this.activeTones = new Q, this.activeModTones = new Q, this.releasedTones = new Q, this.liveInputTones = new Q, this.type = 0, this.synthesizer = null, this.wave = null, this.noisePitchFilterMult = 1, this.unison = null, this.chord = null, this.effects = 0, this.volumeScale = 0, this.aliases = !1, this.eqFilterVolume = 1, this.eqFilterVolumeDelta = 0, this.mixVolume = 1, this.mixVolumeDelta = 0, this.delayInputMult = 0, this.delayInputMultDelta = 0, this.distortion = 0, this.distortionDelta = 0, this.distortionDrive = 0, this.distortionDriveDelta = 0, this.distortionFractionalInput1 = 0, this.distortionFractionalInput2 = 0, this.distortionFractionalInput3 = 0, this.distortionPrevInput = 0, this.distortionNextOutput = 0, this.bitcrusherPrevInput = 0, this.bitcrusherCurrentOutput = 0, this.bitcrusherPhase = 1, this.bitcrusherPhaseDelta = 0, this.bitcrusherPhaseDeltaScale = 1, this.bitcrusherScale = 1, this.bitcrusherScaleScale = 1, this.bitcrusherFoldLevel = 1, this.bitcrusherFoldLevelScale = 1, this.eqFilters = [], this.eqFilterCount = 0, this.initialEqFilterInput1 = 0, this.initialEqFilterInput2 = 0, this.panningDelayLine = null, this.panningDelayPos = 0, this.panningVolumeL = 0, this.panningVolumeR = 0, this.panningVolumeDeltaL = 0, this.panningVolumeDeltaR = 0, this.panningOffsetL = 0, this.panningOffsetR = 0, this.panningOffsetDeltaL = 0, this.panningOffsetDeltaR = 0, this.chorusDelayLineL = null, this.chorusDelayLineR = null, this.chorusDelayLineDirty = !1, this.chorusDelayPos = 0, this.chorusPhase = 0, this.chorusVoiceMult = 0, this.chorusVoiceMultDelta = 0, this.chorusCombinedMult = 0, this.chorusCombinedMultDelta = 0, this.echoDelayLineL = null, this.echoDelayLineR = null, this.echoDelayLineDirty = !1, this.echoDelayPos = 0, this.echoDelayOffsetStart = 0, this.echoDelayOffsetEnd = null, this.echoDelayOffsetRatio = 0, this.echoDelayOffsetRatioDelta = 0, this.echoMult = 0, this.echoMultDelta = 0, this.echoShelfA1 = 0, this.echoShelfB0 = 0, this.echoShelfB1 = 0, this.echoShelfSampleL = 0, this.echoShelfSampleR = 0, this.echoShelfPrevInputL = 0, this.echoShelfPrevInputR = 0, this.reverbDelayLine = null, this.reverbDelayLineDirty = !1, this.reverbDelayPos = 0, this.reverbMult = 0, this.reverbMultDelta = 0, this.reverbShelfA1 = 0, this.reverbShelfB0 = 0, this.reverbShelfB1 = 0, this.reverbShelfSample0 = 0, this.reverbShelfSample1 = 0, this.reverbShelfSample2 = 0, this.reverbShelfSample3 = 0, this.reverbShelfPrevInput0 = 0, this.reverbShelfPrevInput1 = 0, this.reverbShelfPrevInput2 = 0, this.reverbShelfPrevInput3 = 0, this.spectrumWave = new ut, this.harmonicsWave = new ft, this.drumsetSpectrumWaves = []; for (let t = 0; t < e.drumCount; t++)this.drumsetSpectrumWaves[t] = new ut } allocateNecessaryBuffers(t, i, s) { if (w(i.effects) && (null == this.panningDelayLine || this.panningDelayLine.length < t.panningDelayBufferSize) && (this.panningDelayLine = new Float32Array(t.panningDelayBufferSize)), v(i.effects) && ((null == this.chorusDelayLineL || this.chorusDelayLineL.length < t.chorusDelayBufferSize) && (this.chorusDelayLineL = new Float32Array(t.chorusDelayBufferSize)), (null == this.chorusDelayLineR || this.chorusDelayLineR.length < t.chorusDelayBufferSize) && (this.chorusDelayLineR = new Float32Array(t.chorusDelayBufferSize))), k(i.effects)) { const t = Math.max(e.echoDelayRange >> 1, i.echoDelay + 1), n = 2 * Et.fittingPowerOfTwo(t * e.echoDelayStepTicks * s); if (null == this.echoDelayLineL || null == this.echoDelayLineR) this.echoDelayLineL = new Float32Array(n), this.echoDelayLineR = new Float32Array(n); else if (this.echoDelayLineL.length < n || this.echoDelayLineR.length < n) { const t = new Float32Array(n), e = new Float32Array(n), i = this.echoDelayLineL.length - 1; for (let s = 0; s < this.echoDelayLineL.length; s++)t[s] = this.echoDelayLineL[this.echoDelayPos + s & i], e[s] = this.echoDelayLineL[this.echoDelayPos + s & i]; this.echoDelayPos = this.echoDelayLineL.length, this.echoDelayLineL = t, this.echoDelayLineR = e } } x(i.effects) && null == this.reverbDelayLine && (this.reverbDelayLine = new Float32Array(e.reverbDelayBufferSize)) } deactivate() { this.bitcrusherPrevInput = 0, this.bitcrusherCurrentOutput = 0, this.bitcrusherPhase = 1; for (let t = 0; t < this.eqFilterCount; t++)this.eqFilters[t].resetOutput(); if (this.eqFilterCount = 0, this.initialEqFilterInput1 = 0, this.initialEqFilterInput2 = 0, this.distortionFractionalInput1 = 0, this.distortionFractionalInput2 = 0, this.distortionFractionalInput3 = 0, this.distortionPrevInput = 0, this.distortionNextOutput = 0, this.panningDelayPos = 0, null != this.panningDelayLine) for (let t = 0; t < this.panningDelayLine.length; t++)this.panningDelayLine[t] = 0; this.echoDelayOffsetEnd = null, this.echoShelfSampleL = 0, this.echoShelfSampleR = 0, this.echoShelfPrevInputL = 0, this.echoShelfPrevInputR = 0, this.reverbShelfSample0 = 0, this.reverbShelfSample1 = 0, this.reverbShelfSample2 = 0, this.reverbShelfSample3 = 0, this.reverbShelfPrevInput0 = 0, this.reverbShelfPrevInput1 = 0, this.reverbShelfPrevInput2 = 0, this.reverbShelfPrevInput3 = 0, this.volumeScale = 1, this.aliases = !1, this.awake = !1, this.flushingDelayLines = !1, this.deactivateAfterThisTick = !1, this.attentuationProgress = 0, this.flushedSamples = 0 } resetAllEffects() { if (this.deactivate(), this.chorusDelayLineDirty) { for (let t = 0; t < this.chorusDelayLineL.length; t++)this.chorusDelayLineL[t] = 0; for (let t = 0; t < this.chorusDelayLineR.length; t++)this.chorusDelayLineR[t] = 0 } if (this.echoDelayLineDirty) { for (let t = 0; t < this.echoDelayLineL.length; t++)this.echoDelayLineL[t] = 0; for (let t = 0; t < this.echoDelayLineR.length; t++)this.echoDelayLineR[t] = 0 } if (this.reverbDelayLineDirty) for (let t = 0; t < this.reverbDelayLine.length; t++)this.reverbDelayLine[t] = 0; this.chorusPhase = 0 } compute(t, i, s, n, o, h, a) { this.computed = !0, this.type = i.type, this.synthesizer = Et.getInstrumentSynthFunction(i), this.unison = e.unisons[i.unison], this.chord = i.getChord(), this.noisePitchFilterMult = e.chipNoises[i.chipNoise].pitchFilterMult, this.effects = i.effects, this.aliases = i.aliases, this.volumeScale = 1, this.allocateNecessaryBuffers(t, i, s); const r = t.samplesPerSecond; this.updateWaves(i, r); const l = b(this.effects), c = g(this.effects), d = w(this.effects), p = v(this.effects), u = k(this.effects), m = x(this.effects); if (l) { let s = i.distortion, o = i.distortion; t.isModActive(e.modulators.dictionary.distortion.index, h, a) && (s = t.getModValue(e.modulators.dictionary.distortion.index, h, a, !1), o = t.getModValue(e.modulators.dictionary.distortion.index, h, a, !0)); const r = Math.min(1, s / (e.distortionRange - 1)), l = Math.min(1, o / (e.distortionRange - 1)), c = Math.pow(1 - .895 * (Math.pow(20, r) - 1) / 19, 2), d = Math.pow(1 - .895 * (Math.pow(20, l) - 1) / 19, 2), p = (1 + 2 * r) / e.distortionBaseVolume, u = (1 + 2 * l) / e.distortionBaseVolume; this.distortion = c, this.distortionDelta = (d - c) / n, this.distortionDrive = p, this.distortionDriveDelta = (u - p) / n } if (c) { let s = i.bitcrusherFreq, o = i.bitcrusherFreq; t.isModActive(e.modulators.dictionary["freq crush"].index, h, a) && (s = t.getModValue(e.modulators.dictionary["freq crush"].index, h, a, !1), o = t.getModValue(e.modulators.dictionary["freq crush"].index, h, a, !0)); let l = i.bitcrusherQuantization, c = i.bitcrusherQuantization; t.isModActive(e.modulators.dictionary["bit crush"].index, h, a) && (l = t.getModValue(e.modulators.dictionary["bit crush"].index, h, a, !1), c = t.getModValue(e.modulators.dictionary["bit crush"].index, h, a, !0)); const d = e.keys[t.song.key].basePitch, p = wt.frequencyFromPitch(d + 60) * Math.pow(2, (e.bitcrusherFreqRange - 1 - s) * e.bitcrusherOctaveStep), u = wt.frequencyFromPitch(d + 60) * Math.pow(2, (e.bitcrusherFreqRange - 1 - o) * e.bitcrusherOctaveStep), m = Math.min(1, p / r), f = Math.min(1, u / r); this.bitcrusherPhaseDelta = m, this.bitcrusherPhaseDeltaScale = Math.pow(f / m, 1 / n); const y = 2 * e.bitcrusherBaseVolume * Math.pow(2, 1 - Math.pow(2, .5 * (e.bitcrusherQuantizationRange - 1 - l))), b = 2 * e.bitcrusherBaseVolume * Math.pow(2, 1 - Math.pow(2, .5 * (e.bitcrusherQuantizationRange - 1 - c))); this.bitcrusherScale = y, this.bitcrusherScaleScale = Math.pow(b / y, 1 / n); const g = 2 * e.bitcrusherBaseVolume * Math.pow(1.5, e.bitcrusherQuantizationRange - 1 - l), w = 2 * e.bitcrusherBaseVolume * Math.pow(1.5, e.bitcrusherQuantizationRange - 1 - c); this.bitcrusherFoldLevel = g, this.bitcrusherFoldLevelScale = Math.pow(w / g, 1 / n) } let f = 1; if (i.eqFilterType) { const s = i.eqFilter; null == i.eqSubFilters[1] && (i.eqSubFilters[1] = new bt); const o = i.eqSubFilters[1]; let l, c = i.eqFilterSimpleCut, d = i.eqFilterSimplePeak, p = i.eqFilterSimpleCut, u = i.eqFilterSimplePeak, m = !1; if (t.isModActive(e.modulators.dictionary["eq filt cut"].index, h, a) && (c = t.getModValue(e.modulators.dictionary["eq filt cut"].index, h, a, !1), p = t.getModValue(e.modulators.dictionary["eq filt cut"].index, h, a, !0), m = !0), t.isModActive(e.modulators.dictionary["eq filt peak"].index, h, a) && (d = t.getModValue(e.modulators.dictionary["eq filt peak"].index, h, a, !1), u = t.getModValue(e.modulators.dictionary["eq filt peak"].index, h, a, !0), m = !0), m) { s.convertLegacySettingsForSynth(c, d), o.convertLegacySettingsForSynth(p, u), l = s.controlPoints[0]; let t = o.controlPoints[0]; l.toCoefficients(Et.tempFilterStartCoefficients, r, 1, 1), t.toCoefficients(Et.tempFilterEndCoefficients, r, 1, 1), this.eqFilters.length < 1 && (this.eqFilters[0] = new tt), this.eqFilters[0].loadCoefficientsWithGradient(Et.tempFilterStartCoefficients, Et.tempFilterEndCoefficients, 1 / n, 0 == l.type) } else s.convertLegacySettingsForSynth(c, d, !0), l = s.controlPoints[0], l.toCoefficients(Et.tempFilterStartCoefficients, r, 1, 1), this.eqFilters.length < 1 && (this.eqFilters[0] = new tt), this.eqFilters[0].loadCoefficientsWithGradient(Et.tempFilterStartCoefficients, Et.tempFilterStartCoefficients, 1 / n, 0 == l.type); f *= l.getVolumeCompensationMult(), this.eqFilterCount = 1, f = Math.min(3, f) } else { const t = null != i.tmpEqFilterStart ? i.tmpEqFilterStart : i.eqFilter; for (let e = 0; e < t.controlPointCount; e++) { let s = t.controlPoints[e], o = null != i.tmpEqFilterEnd && null != i.tmpEqFilterEnd.controlPoints[e] ? i.tmpEqFilterEnd.controlPoints[e] : t.controlPoints[e]; s.type != o.type && (s = o), s.toCoefficients(Et.tempFilterStartCoefficients, r, 1, 1), o.toCoefficients(Et.tempFilterEndCoefficients, r, 1, 1), this.eqFilters.length <= e && (this.eqFilters[e] = new tt), this.eqFilters[e].loadCoefficientsWithGradient(Et.tempFilterStartCoefficients, Et.tempFilterEndCoefficients, 1 / n, 0 == s.type), f *= s.getVolumeCompensationMult() } this.eqFilterCount = t.controlPointCount, f = Math.min(3, f) } const y = Et.instrumentVolumeToVolumeMult(i.volume); this.mixVolume = y; let M = y; if (t.isModActive(e.modulators.dictionary["mix volume"].index, h, a)) { const i = t.getModValue(e.modulators.dictionary["mix volume"].index, h, a, !1), s = t.getModValue(e.modulators.dictionary["mix volume"].index, h, a, !0); this.mixVolume *= i <= 0 ? (i + e.volumeRange / 2) / (e.volumeRange / 2) : Et.instrumentVolumeToVolumeMult(i), M *= s <= 0 ? (s + e.volumeRange / 2) / (e.volumeRange / 2) : Et.instrumentVolumeToVolumeMult(s) } t.isModActive(e.modulators.dictionary["song volume"].index) && (this.mixVolume *= t.getModValue(e.modulators.dictionary["song volume"].index, void 0, void 0, !1) / 100, M *= t.getModValue(e.modulators.dictionary["song volume"].index, void 0, void 0, !0) / 100), this.mixVolumeDelta = (M - this.mixVolume) / n; let S = f, F = f, C = 1, E = 1; if (d) { let s = i.pan, o = i.pan; t.isModActive(e.modulators.dictionary.pan.index, h, a) && (s = t.getModValue(e.modulators.dictionary.pan.index, h, a, !1), o = t.getModValue(e.modulators.dictionary.pan.index, h, a, !0)); let l = Math.max(-1, Math.min(1, (s - e.panCenter) / e.panCenter)), c = Math.max(-1, Math.min(1, (o - e.panCenter) / e.panCenter)); const d = 1.414 * Math.cos((1 + l) * Math.PI * .25), p = 1.414 * Math.cos((1 - l) * Math.PI * .25), u = 1.414 * Math.cos((1 + c) * Math.PI * .25), m = 1.414 * Math.cos((1 - c) * Math.PI * .25), f = r * e.panDelaySecondsMax; let y = i.panDelay, b = i.panDelay; t.isModActive(e.modulators.dictionary["pan delay"].index, h, a) && (y = t.getModValue(e.modulators.dictionary["pan delay"].index, h, a, !1), b = t.getModValue(e.modulators.dictionary["pan delay"].index, h, a, !0)); const g = l * y * f / 10, w = c * b * f / 10, v = Math.max(0, g), k = Math.max(0, -g), x = Math.max(0, w), M = Math.max(0, -w); this.panningVolumeL = d, this.panningVolumeR = p, this.panningVolumeDeltaL = (u - d) / n, this.panningVolumeDeltaR = (m - p) / n, this.panningOffsetL = this.panningDelayPos - v + t.panningDelayBufferSize, this.panningOffsetR = this.panningDelayPos - k + t.panningDelayBufferSize, this.panningOffsetDeltaL = (x - v) / n, this.panningOffsetDeltaR = (M - k) / n } if (p) { let s = i.chorus, o = i.chorus; t.isModActive(e.modulators.dictionary.chorus.index, h, a) && (s = t.getModValue(e.modulators.dictionary.chorus.index, h, a, !1), o = t.getModValue(e.modulators.dictionary.chorus.index, h, a, !0)); let r = Math.min(1, s / (e.chorusRange - 1)), l = Math.min(1, o / (e.chorusRange - 1)); r = .6 * r + .4 * Math.pow(r, 6), l = .6 * l + .4 * Math.pow(l, 6); const c = 1 / Math.sqrt(3 * r * r + 1), d = 1 / Math.sqrt(3 * l * l + 1); this.chorusVoiceMult = r, this.chorusVoiceMultDelta = (l - r) / n, this.chorusCombinedMult = c, this.chorusCombinedMultDelta = (d - c) / n } let T = 0, I = 0; if (u) { let o = i.echoSustain, l = i.echoSustain; t.isModActive(e.modulators.dictionary.echo.index, h, a) && (o = Math.max(0, t.getModValue(e.modulators.dictionary.echo.index, h, a, !1)), l = Math.max(0, t.getModValue(e.modulators.dictionary.echo.index, h, a, !0))); const c = .9 * Math.min(1, Math.pow(o / e.echoSustainRange, 1.1)), d = .9 * Math.min(1, Math.pow(l / e.echoSustainRange, 1.1)); this.echoMult = c, this.echoMultDelta = Math.max(0, (d - c) / n), T = Math.max(c, d); let p = i.echoDelay, u = i.echoDelay, m = !1; t.isModActive(e.modulators.dictionary["echo delay"].index, h, a) && (p = t.getModValue(e.modulators.dictionary["echo delay"].index, h, a, !1), u = t.getModValue(e.modulators.dictionary["echo delay"].index, h, a, !0), m = !0); const f = Math.round((p + 1) * e.echoDelayStepTicks * s), y = Math.round((u + 1) * e.echoDelayStepTicks * s); null == this.echoDelayOffsetEnd || m ? this.echoDelayOffsetStart = f : this.echoDelayOffsetStart = this.echoDelayOffsetEnd, this.echoDelayOffsetEnd = y, I = .5 * (this.echoDelayOffsetStart + this.echoDelayOffsetEnd) / r, this.echoDelayOffsetRatio = 0, this.echoDelayOffsetRatioDelta = 1 / n; const b = 2 * Math.PI * e.echoShelfHz / t.samplesPerSecond; Et.tempFilterStartCoefficients.highShelf1stOrder(b, e.echoShelfGain), this.echoShelfA1 = Et.tempFilterStartCoefficients.a[1], this.echoShelfB0 = Et.tempFilterStartCoefficients.b[0], this.echoShelfB1 = Et.tempFilterStartCoefficients.b[1] } let P = 0; if (m) { let s = i.reverb, o = i.reverb; t.isModActive(e.modulators.dictionary.reverb.index, h, a) && (s = t.getModValue(e.modulators.dictionary.reverb.index, h, a, !1), o = t.getModValue(e.modulators.dictionary.reverb.index, h, a, !0)), t.isModActive(e.modulators.dictionary["song reverb"].index, h, a) && (s *= (t.getModValue(e.modulators.dictionary["song reverb"].index, void 0, void 0, !1) - e.modulators.dictionary["song reverb"].convertRealFactor) / e.reverbRange, o *= (t.getModValue(e.modulators.dictionary["song reverb"].index, void 0, void 0, !0) - e.modulators.dictionary["song reverb"].convertRealFactor) / e.reverbRange); const r = .425 * Math.min(1, Math.pow(s / e.reverbRange, .667)), l = .425 * Math.min(1, Math.pow(o / e.reverbRange, .667)); this.reverbMult = r, this.reverbMultDelta = (l - r) / n, P = Math.max(r, l); const c = 2 * Math.PI * e.reverbShelfHz / t.samplesPerSecond; Et.tempFilterStartCoefficients.highShelf1stOrder(c, e.reverbShelfGain), this.reverbShelfA1 = Et.tempFilterStartCoefficients.a[1], this.reverbShelfB0 = Et.tempFilterStartCoefficients.b[0], this.reverbShelfB1 = Et.tempFilterStartCoefficients.b[1] } if (this.tonesAddedInThisTick) this.attentuationProgress = 0, this.flushedSamples = 0, this.flushingDelayLines = !1; else if (this.flushingDelayLines) { S = 0, F = 0, C = 0, E = 0; let i = 0; p && (i += t.chorusDelayBufferSize), u && (i += this.echoDelayLineL.length), m && (i += e.reverbDelayBufferSize), this.flushedSamples += n, this.flushedSamples >= i && (this.deactivateAfterThisTick = !0) } else { 0 == this.attentuationProgress || (S = 0), F = 0; const t = 1 / 256, i = -Math.log2(t); let n = 0; if (p && (n += e.chorusMaxDelay), u) { const t = Math.pow(T, 1 / I); n += -1 / Math.log2(t) * i } if (m) { const t = 2 * P, s = e.reverbDelayBufferSize / 4 / r, o = Math.pow(t, 1 / s); n += -1 / Math.log2(o) * i } const o = s / r / n, h = this.attentuationProgress + o; h >= 1 && (E = 0), this.attentuationProgress = h, this.attentuationProgress >= 1 && (this.flushingDelayLines = !0) } this.eqFilterVolume = S, this.eqFilterVolumeDelta = (F - S) / n, this.delayInputMult = C, this.delayInputMultDelta = (E - C) / n } updateWaves(t, i) { if (this.volumeScale = 1, 0 == t.type) this.wave = this.aliases ? e.rawChipWaves[t.chipWave].samples : e.chipWaves[t.chipWave].samples; else if (8 == t.type) this.wave = this.aliases ? t.customChipWave : t.customChipWaveIntegral, this.volumeScale = .05; else if (2 == t.type) this.wave = o(t.chipNoise, Y, K); else if (5 == t.type) this.wave = this.harmonicsWave.getCustomWave(t.harmonicsWave, t.type); else if (7 == t.type) this.wave = this.harmonicsWave.getCustomWave(t.harmonicsWave, t.type); else if (3 == t.type) this.wave = this.spectrumWave.getCustomWave(t.spectrumWave, 8); else if (4 == t.type) { for (let i = 0; i < e.drumCount; i++)this.drumsetSpectrumWaves[i].getCustomWave(t.drumsetSpectrumWaves[i], Ft.Et(i)); this.wave = null } else this.wave = null } getDrumsetWave(t) { if (4 == this.type) return this.drumsetSpectrumWaves[t].wave; throw new Error("Unhandled instrument type in getDrumsetWave") } static drumsetIndexReferenceDelta(t) { return wt.frequencyFromPitch(e.spectrumBasePitch + 6 * t) / 44100 } static Et(t) { return 15 + Math.log2(Ft.drumsetIndexReferenceDelta(t)) } } class Ct { constructor() { this.instruments = [], this.muted = !1, this.singleSeamlessInstrument = null } } class Et { constructor(t = null) { this.samplesPerSecond = 44100, this.song = null, this.preferLowerLatency = !1, this.anticipatePoorPerformance = !1, this.liveInputDuration = 0, this.liveInputStarted = !1, this.liveInputPitches = [], this.liveInputChannel = 0, this.liveInputInstruments = [], this.loopRepeatCount = -1, this.volume = 1, this.enableMetronome = !1, this.countInMetronome = !1, this.renderingSong = !1, this.wantToSkip = !1, this.playheadInternal = 0, this.bar = 0, this.prevBar = null, this.nextBar = null, this.beat = 0, this.part = 0, this.tick = 0, this.isAtStartOfTick = !0, this.isAtEndOfTick = !0, this.tickSampleCountdown = 0, this.modValues = [], this.modInsValues = [], this.nextModValues = [], this.nextModInsValues = [], this.isPlayingSong = !1, this.isRecording = !1, this.liveInputEndTime = 0, this.browserAutomaticallyClearsAudioBuffer = !0, this.tempDrumSetControlPoint = new yt, this.tempFrequencyResponse = new Z, this.channels = [], this.tonePool = new Q, this.tempMatchedPitchTones = Array(e.maxChordSize).fill(null), this.startedMetronome = !1, this.metronomeSamplesRemaining = -1, this.metronomeAmplitude = 0, this.metronomePrevAmplitude = 0, this.metronomeFilter = 0, this.limit = 0, this.tempMonoInstrumentSampleBuffer = null, this.audioCtx = null, this.scriptNode = null, this.audioProcessCallback = t => { const e = t.outputBuffer, i = e.getChannelData(0), s = e.getChannelData(1); if (!this.browserAutomaticallyClearsAudioBuffer || 0 == i[0] && 0 == s[0] && 0 == i[e.length - 1] && 0 == s[e.length - 1] || (this.browserAutomaticallyClearsAudioBuffer = !1), !this.browserAutomaticallyClearsAudioBuffer) { const t = e.length; for (let e = 0; e < t; e++)i[e] = 0, s[e] = 0 } !this.isPlayingSong && performance.now() >= this.liveInputEndTime ? this.deactivateAudio() : this.synthesize(i, s, e.length, this.isPlayingSong) }, this.computeDelayBufferSizes(), null != t && this.setSong(t) } syncSongState() { const t = this.song.getChannelCount(); for (let e = this.channels.length; e < t; e++)this.channels[e] = new Ct; this.channels.length = t; for (let e = 0; e < t; e++) { const t = this.song.channels[e], i = this.channels[e]; for (let e = i.instruments.length; e < t.instruments.length; e++)i.instruments[e] = new Ft; if (i.instruments.length = t.instruments.length, i.muted != t.muted && (i.muted = t.muted, i.muted)) for (const t of i.instruments) t.resetAllEffects() } } warmUpSynthesizer(t) { if (null != t) { this.syncSongState(); const e = this.getSamplesPerTick(); for (let i = 0; i < t.getChannelCount(); i++)for (let s = 0; s < t.channels[i].instruments.length; s++) { const n = t.channels[i].instruments[s], o = this.channels[i].instruments[s]; Et.getInstrumentSynthFunction(n), n.LFOtime = 0, n.nextLFOtime = 0, n.arpTime = 0, n.tmpEqFilterStart = n.eqFilter, n.tmpEqFilterEnd = null, n.tmpNoteFilterStart = n.noteFilter, n.tmpNoteFilterEnd = null, o.updateWaves(n, this.samplesPerSecond), o.allocateNecessaryBuffers(this, n, e) } } var e = new Float32Array(1); this.isPlayingSong = !0, this.synthesize(e, e, 1, !0), this.isPlayingSong = !1 } computeLatestModValues() { if (null != this.song && this.song.modChannelCount > 0) { let t = [], i = []; this.modValues = [], this.nextModValues = [], this.modInsValues = [], this.nextModInsValues = []; for (let t = 0; t < this.song.pitchChannelCount + this.song.noiseChannelCount; t++) { i[t] = [], this.modInsValues[t] = [], this.nextModInsValues[t] = []; for (let e = 0; e < this.song.channels[t].instruments.length; e++)this.modInsValues[t][e] = [], this.nextModInsValues[t][e] = [], i[t][e] = [] } let s = this.beat * e.partsPerBeat + this.part; for (let n = this.song.pitchChannelCount + this.song.noiseChannelCount; n < this.song.getChannelCount(); n++)if (!this.song.channels[n].muted) { let o; for (let h = this.bar; h >= 0; h--)if (o = this.song.getPattern(n, h), null != o) { let a = o.instruments[0], r = this.song.channels[n].instruments[a], l = [], c = [], d = h == this.bar ? s : this.findPartsInBar(h); for (const t of o.notes) if (t.start < d && (null == l[e.modCount - 1 - t.pitches[0]] || t.end > l[e.modCount - 1 - t.pitches[0]])) if (t.end <= d) l[e.modCount - 1 - t.pitches[0]] = t.end, c[e.modCount - 1 - t.pitches[0]] = t.pins[t.pins.length - 1].size; else { l[e.modCount - 1 - t.pitches[0]] = d; for (let i = 0; i < t.pins.length; i++)if (t.pins[i].time + t.start > d) { const s = t.pins[i].time - t.pins[i - 1].time, n = d - t.start - t.pins[i - 1].time, o = t.pins[i].size - t.pins[i - 1].size; c[e.modCount - 1 - t.pitches[0]] = Math.round(t.pins[i - 1].size + o * n / s), i = t.pins.length } } for (let s = 0; s < e.modCount; s++)if (null != l[s]) if (e.modulators[r.modulators[s]].forSong) (null == t[r.modulators[s]] || h * e.partsPerBeat * this.song.beatsPerBar + l[s] > t[r.modulators[s]]) && (this.setModValue(c[s], c[s], s, r.modChannels[s], r.modInstruments[s], r.modulators[s]), t[r.modulators[s]] = h * e.partsPerBeat * this.song.beatsPerBar + l[s]); else { let t = []; if (r.modInstruments[s] == this.song.channels[r.modChannels[s]].instruments.length) for (let e = 0; e < this.song.channels[r.modChannels[s]].instruments.length; e++)t.push(e); else if (r.modInstruments[s] > this.song.channels[r.modChannels[s]].instruments.length) { const e = this.song.getPattern(r.modChannels[s], h); null != e && (t = e.instruments) } else t.push(r.modInstruments[s]); for (let n = 0; n < t.length; n++) { const o = r.modulators[s] == e.modulators.dictionary["eq filter"].index, a = r.modulators[s] == e.modulators.dictionary["note filter"].index; let d = r.modulators[s]; if (o ? d = e.modulators.length + r.modFilterTypes[s] : a && (d = e.modulators.length + 1 + 2 * e.filterMaxPoints + r.modFilterTypes[s]), null == i[r.modChannels[s]][t[n]][d] || h * e.partsPerBeat * this.song.beatsPerBar + l[s] > i[r.modChannels[s]][t[n]][d]) { if (o) { let i = this.song.channels[r.modChannels[s]].instruments[t[n]]; if (0 == r.modFilterTypes[s]) i.tmpEqFilterStart = i.eqSubFilters[c[s]]; else { for (let t = 0; t < e.filterMorphCount; t++)i.tmpEqFilterStart == i.eqSubFilters[t] && (i.tmpEqFilterStart = new bt, i.tmpEqFilterStart.fromJsonObject(i.eqSubFilters[t].toJsonObject()), t = e.filterMorphCount); Math.floor((r.modFilterTypes[s] - 1) / 2) < i.tmpEqFilterStart.controlPointCount && (r.modFilterTypes[s] % 2 ? i.tmpEqFilterStart.controlPoints[Math.floor((r.modFilterTypes[s] - 1) / 2)].freq = c[s] : i.tmpEqFilterStart.controlPoints[Math.floor((r.modFilterTypes[s] - 1) / 2)].gain = c[s]) } i.tmpEqFilterEnd = i.tmpEqFilterStart } else if (a) { let i = this.song.channels[r.modChannels[s]].instruments[t[n]]; if (0 == r.modFilterTypes[s]) i.tmpNoteFilterStart = i.noteSubFilters[c[s]]; else { for (let t = 0; t < e.filterMorphCount; t++)i.tmpNoteFilterStart == i.noteSubFilters[t] && (i.tmpNoteFilterStart = new bt, i.tmpNoteFilterStart.fromJsonObject(i.noteSubFilters[t].toJsonObject()), t = e.filterMorphCount); Math.floor((r.modFilterTypes[s] - 1) / 2) < i.tmpNoteFilterStart.controlPointCount && (r.modFilterTypes[s] % 2 ? i.tmpNoteFilterStart.controlPoints[Math.floor((r.modFilterTypes[s] - 1) / 2)].freq = c[s] : i.tmpNoteFilterStart.controlPoints[Math.floor((r.modFilterTypes[s] - 1) / 2)].gain = c[s]) } i.tmpNoteFilterEnd = i.tmpNoteFilterStart } else this.setModValue(c[s], c[s], s, r.modChannels[s], t[n], d); i[r.modChannels[s]][t[n]][d] = h * e.partsPerBeat * this.song.beatsPerBar + l[s] } } } } } } } determineInvalidModulators(t) { if (null != this.song) for (let i = 0; i < e.modCount; i++) { if (t.invalidModulators[i] = !0, -1 == t.modChannels[i]) { 0 != t.modulators[i] && (t.invalidModulators[i] = !1); continue } const s = this.song.channels[t.modChannels[i]]; if (null == s) continue; let n = []; n = t.modInstruments[i] >= s.instruments.length ? s.instruments : [s.instruments[t.modInstruments[i]]]; for (let s = 0; s < n.length; s++) { const o = n[s]; if (null == o) continue; const h = e.modulators[t.modulators[i]].name; 12 != e.modulators[t.modulators[i]].associatedEffect && !(o.effects & 1 << e.modulators[t.modulators[i]].associatedEffect) || 1 != o.type && ("fm slider 1" == h || "fm slider 2" == h || "fm slider 3" == h || "fm slider 4" == h || "fm feedback" == h) || 6 != o.type && "pulse width" == h || !o.getChord().arpeggiates && ("arp speed" == h || "reset arp" == h) || o.eqFilterType && "eq filter" == h || !o.eqFilterType && ("eq filt cut" == h || "eq filt peak" == h) || "eq filter" == h && Math.floor((t.modFilterTypes[i] + 1) / 2) > o.eqFilter.controlPointCount || o.noteFilterType && "note filter" == h || !o.noteFilterType && ("note filt cut" == h || "note filt peak" == h) || "note filter" == h && Math.floor((t.modFilterTypes[i] + 1) / 2) > o.noteFilter.controlPointCount || (t.invalidModulators[i] = !1, s = n.length) } } } static operatorAmplitudeCurve(t) { return (Math.pow(16, t / 15) - 1) / 15 } get playing() { return this.isPlayingSong } get recording() { return this.isRecording } get playhead() { return this.playheadInternal } set playhead(t) { if (null != this.song) { this.playheadInternal = Math.max(0, Math.min(this.song.barCount, t)); let i = this.playheadInternal; this.bar = Math.floor(i), i = this.song.beatsPerBar * (i - this.bar), this.beat = Math.floor(i), i = e.partsPerBeat * (i - this.beat), this.part = Math.floor(i), i = e.ticksPerPart * (i - this.part), this.tick = Math.floor(i), this.tickSampleCountdown = 0, this.isAtStartOfTick = !0, this.prevBar = null } } getSamplesPerBar() { if (null == this.song) throw new Error; return this.getSamplesPerTick() * e.ticksPerPart * e.partsPerBeat * this.song.beatsPerBar } getTicksIntoBar() { return (this.beat * e.partsPerBeat + this.part) * e.ticksPerPart + this.tick } getCurrentPart() { return this.beat * e.partsPerBeat + this.part } findPartsInBar(t) { if (null == this.song) return 0; let i = e.partsPerBeat * this.song.beatsPerBar; for (let s = this.song.pitchChannelCount + this.song.noiseChannelCount; s < this.song.getChannelCount(); s++) { let n = this.song.getPattern(s, t); if (null != n) { let t = this.song.channels[s].instruments[n.instruments[0]]; for (let s = 0; s < e.modCount; s++)if (t.modulators[s] == e.modulators.dictionary["next bar"].index) for (const t of n.notes) t.pitches[0] == e.modCount - 1 - s && i > t.start && (i = t.start) } } return i } getTotalSamples(t, i, s) { if (null == this.song) return -1; let n = t ? 0 : this.song.loopStart, o = i ? this.song.barCount : this.song.loopStart + this.song.loopLength, h = !1, a = !1, r = this.song.tempo; for (let t = this.song.pitchChannelCount + this.song.noiseChannelCount; t < this.song.getChannelCount(); t++)for (let i = n; i < o; i++) { let s = this.song.getPattern(t, i); if (null != s) { let i = this.song.channels[t].instruments[s.instruments[0]]; for (let t = 0; t < e.modCount; t++)i.modulators[t] == e.modulators.dictionary.tempo.index && (h = !0), i.modulators[t] == e.modulators.dictionary["next bar"].index && (a = !0) } } if (n > 0) { let t = null, i = 0; for (let s = n - 1; s >= 0; s--) { for (let n = this.song.pitchChannelCount + this.song.noiseChannelCount; n < this.song.getChannelCount(); n++) { let o = this.song.getPattern(n, s); if (null != o) { let h = o.instruments[0], a = this.song.channels[n].instruments[h], r = this.findPartsInBar(s); for (const s of o.notes) if (a.modulators[e.modCount - 1 - s.pitches[0]] == e.modulators.dictionary.tempo.index && s.start < r && (null == t || s.end > t)) if (s.end <= r) t = s.end, i = s.pins[s.pins.length - 1].size; else { t = r; for (let t = 0; t < s.pins.length; t++)if (s.pins[t].time + s.start > r) { const e = s.pins[t].time - s.pins[t - 1].time, n = r - s.start - s.pins[t - 1].time, o = s.pins[t].size - s.pins[t - 1].size; i = Math.round(s.pins[t - 1].size + o * n / e), t = s.pins.length } } } } null != t && (r = i + e.modulators.dictionary.tempo.convertRealFactor, s = -1) } } if (h || a) { let t = n, i = !1, l = 0; for (; !i;) { let n = e.partsPerBeat * this.song.beatsPerBar, c = 0; if (a && (n = this.findPartsInBar(t)), h) { let i = !1; for (let s = this.song.pitchChannelCount + this.song.noiseChannelCount; s < this.song.getChannelCount(); s++)if (0 == i) { let o = this.song.getPattern(s, t); if (null != o) { let t = this.song.channels[s].instruments[o.instruments[0]]; for (let s = 0; s < e.modCount; s++)if (0 == i && t.modulators[s] == e.modulators.dictionary.tempo.index && o.notes.find((t => t.pitches[0] == e.modCount - 1 - s))) { i = !0, o.notes.sort((function (t, e) { return t.start == e.start ? t.pitches[0] - e.pitches[0] : t.start - e.start })); for (const t of o.notes) if (t.pitches[0] == e.modCount - 1 - s && (l += Math.min(n - c, t.start - c) * e.ticksPerPart * this.getSamplesPerTickSpecificBPM(r), t.start < n)) for (let i = 1; i < t.pins.length; i++) { if (t.pins[i - 1].time + t.start <= n) { const s = e.ticksPerPart * Math.min(n - (t.start + t.pins[i - 1].time), t.pins[i].time - t.pins[i - 1].time), o = t.pins[i - 1].size + e.modulators.dictionary.tempo.convertRealFactor; let h = t.pins[i].size + e.modulators.dictionary.tempo.convertRealFactor; t.pins[i].time + t.start > n && (h = t.pins[i - 1].size + (t.pins[i].size - t.pins[i - 1].size) * (n - (t.start + t.pins[i - 1].time)) / (t.pins[i].time - t.pins[i - 1].time) + e.modulators.dictionary.tempo.convertRealFactor); let a = e.partsPerBeat * e.ticksPerPart / 60; l += h != o ? -this.samplesPerSecond * s * (Math.log(a * h * s) - Math.log(a * o * s)) / (a * (o - h)) : s * this.getSamplesPerTickSpecificBPM(h), r = h } c = Math.min(t.start + t.pins[i].time, n) } } } } } l += (n - c) * e.ticksPerPart * this.getSamplesPerTickSpecificBPM(r), t++, 0 != s && t == this.song.loopStart + this.song.loopLength && (t = this.song.loopStart, s > 0 && s--), t >= o && (i = !0) } return Math.ceil(l) } return this.getSamplesPerBar() * this.getTotalBars(t, i, s) } getTotalBars(t, e, i = this.loopRepeatCount) { if (null == this.song) throw new Error; let s = this.song.loopLength * (i + 1); return t && (s += this.song.loopStart), e && (s += this.song.barCount - (this.song.loopStart + this.song.loopLength)), s } setSong(t) { "string" == typeof t ? this.song = new kt(t) : t instanceof kt && (this.song = t), this.prevBar = null } computeDelayBufferSizes() { this.panningDelayBufferSize = Et.fittingPowerOfTwo(this.samplesPerSecond * e.panDelaySecondsMax), this.panningDelayBufferMask = this.panningDelayBufferSize - 1, this.chorusDelayBufferSize = Et.fittingPowerOfTwo(this.samplesPerSecond * e.chorusMaxDelay), this.chorusDelayBufferMask = this.chorusDelayBufferSize - 1 } activateAudio() { const t = this.anticipatePoorPerformance ? this.preferLowerLatency ? 2048 : 4096 : this.preferLowerLatency ? 512 : 2048; if (null == this.audioCtx || null == this.scriptNode || this.scriptNode.bufferSize != t) { null != this.scriptNode && this.deactivateAudio(); const e = this.anticipatePoorPerformance ? this.preferLowerLatency ? "balanced" : "playback" : this.preferLowerLatency ? "interactive" : "balanced"; this.audioCtx = this.audioCtx || new (window.AudioContext || window.webkitAudioContext)({ latencyHint: e }), this.samplesPerSecond = this.audioCtx.sampleRate, this.scriptNode = this.audioCtx.createScriptProcessor ? this.audioCtx.createScriptProcessor(t, 0, 2) : this.audioCtx.createJavaScriptNode(t, 0, 2), this.scriptNode.onaudioprocess = this.audioProcessCallback, this.scriptNode.channelCountMode = "explicit", this.scriptNode.channelInterpretation = "speakers", this.scriptNode.connect(this.audioCtx.destination), this.computeDelayBufferSizes() } this.audioCtx.resume() } deactivateAudio() { null != this.audioCtx && null != this.scriptNode && (this.scriptNode.disconnect(this.audioCtx.destination), this.scriptNode = null, this.audioCtx.close && this.audioCtx.close(), this.audioCtx = null) } maintainLiveInput() { this.activateAudio(), this.liveInputEndTime = performance.now() + 1e4 } play() { this.isPlayingSong || (this.computeLatestModValues(), this.warmUpSynthesizer(this.song), this.isPlayingSong = !0, this.activateAudio()) } pause() { if (this.isPlayingSong && (this.isPlayingSong = !1, this.isRecording = !1, this.modValues = [], this.nextModValues = [], null != this.song)) { this.song.inVolumeCap = 0, this.song.outVolumeCap = 0; for (let t = 0; t < this.song.pitchChannelCount + this.song.noiseChannelCount; t++)this.modInsValues[t] = [], this.nextModInsValues[t] = [] } } startRecording() { this.preferLowerLatency = !0, this.isRecording = !0, this.play() } resetEffects() { if (this.limit = 0, this.freeAllTones(), null != this.song) for (const t of this.channels) for (const e of t.instruments) e.resetAllEffects() } setModValue(t, i, s, n, o, h) { let a = t + e.modulators[h].convertRealFactor, r = i + e.modulators[h].convertRealFactor; return e.modulators[h].forSong ? null != this.modValues[h] && this.modValues[h] == a && this.nextModValues[h] == r || (this.modValues[h] = a, this.nextModValues[h] = r) : null != this.modInsValues[n][o][h] && this.modInsValues[n][o][h] == a && this.nextModInsValues[n][o][h] == r || (this.modInsValues[n][o][h] = a, this.nextModInsValues[n][o][h] = r), a } getModValue(t, i, s, n) { if (e.modulators[t].forSong) { if (null != this.modValues[t] && null != this.nextModValues[t]) return n ? this.nextModValues[t] : this.modValues[t] } else if (null != i && null != s && null != this.modInsValues[i][s][t] && null != this.nextModInsValues[i][s][t]) return n ? this.nextModInsValues[i][s][t] : this.modInsValues[i][s][t]; return -1 } isAnyModActive(t, i) { for (let s = 0; s < e.modulators.length; s++)if (null != this.modValues && null != this.modValues[s] || null != this.modInsValues && null != this.modInsValues[t] && null != this.modInsValues[t][i] && null != this.modInsValues[t][i][s]) return !0; return !1 } unsetMod(t, e, i) { (this.isModActive(t) || null != e && null != i && this.isModActive(t, e, i)) && (this.modValues[t] = null, this.nextModValues[t] = null, null != e && null != i && (this.modInsValues[e][i][t] = null, this.nextModInsValues[e][i][t] = null)) } isFilterModActive(t, e, i) { const s = this.song.channels[e].instruments[i]; if (t) { if (s.noteFilterType) return !1; if (null != s.tmpNoteFilterEnd) return !0 } else { if (s.eqFilterType) return !1; if (null != s.tmpEqFilterEnd) return !0 } return !1 } isModActive(t, i, s) { return e.modulators[t].forSong ? null != this.modValues && null != this.modValues[t] : null != i && null != s && null != this.modInsValues && null != this.modInsValues[i] && null != this.modInsValues[i][s] && null != this.modInsValues[i][s][t] } snapToStart() { this.bar = 0, this.resetEffects(), this.snapToBar() } goToBar(t) { this.bar = t, this.resetEffects(), this.playheadInternal = this.bar } snapToBar() { this.playheadInternal = this.bar, this.beat = 0, this.part = 0, this.tick = 0, this.tickSampleCountdown = 0 } jumpIntoLoop() { if (this.song && (this.bar < this.song.loopStart || this.bar >= this.song.loopStart + this.song.loopLength)) { const t = this.bar; this.bar = this.song.loopStart, this.playheadInternal += this.bar - t, this.playing && this.computeLatestModValues() } } goToNextBar() { if (!this.song) return; this.prevBar = this.bar; const t = this.bar; this.bar++, this.bar >= this.song.barCount && (this.bar = 0), this.playheadInternal += this.bar - t, this.playing && this.computeLatestModValues() } goToPrevBar() { if (!this.song) return; this.prevBar = null; const t = this.bar; this.bar--, (this.bar < 0 || this.bar >= this.song.barCount) && (this.bar = this.song.barCount - 1), this.playheadInternal += this.bar - t, this.playing && this.computeLatestModValues() } getNextBar() { let t = this.bar + 1; return this.isRecording ? t >= this.song.barCount && (t = this.song.barCount - 1) : 0 != this.loopRepeatCount && t == this.song.loopStart + this.song.loopLength && (t = this.song.loopStart), t } skipBar() { if (!this.song) return; const t = this.getSamplesPerTick(); this.bar++, this.beat = 0, this.part = 0, this.tick = 0, this.tickSampleCountdown = t, this.isAtStartOfTick = !0, 0 != this.loopRepeatCount && this.bar == this.song.loopStart + this.song.loopLength && (this.bar = this.song.loopStart, this.loopRepeatCount > 0 && this.loopRepeatCount--) } synthesize(t, i, s, n = !0) { if (null == this.song) { for (let e = 0; e < s; e++)t[e] = 0, i[e] = 0; return void this.deactivateAudio() } const o = this.song; this.song.inVolumeCap = 0, this.song.outVolumeCap = 0; let h = this.getSamplesPerTick(), a = !1; (this.tickSampleCountdown <= 0 || this.tickSampleCountdown > h) && (this.tickSampleCountdown = h, this.isAtStartOfTick = !0), n && (this.beat >= o.beatsPerBar && (this.beat = 0, this.part = 0, this.tick = 0, this.tickSampleCountdown = h, this.isAtStartOfTick = !0, this.prevBar = this.bar, this.bar = this.getNextBar(), this.bar <= this.prevBar && this.loopRepeatCount > 0 && this.loopRepeatCount--), this.bar >= o.barCount && (this.bar = 0, -1 != this.loopRepeatCount && (a = !0, this.pause()))), this.syncSongState(), (null == this.tempMonoInstrumentSampleBuffer || this.tempMonoInstrumentSampleBuffer.length < s) && (this.tempMonoInstrumentSampleBuffer = new Float32Array(s)); const r = +this.volume, l = 1 - Math.pow(.5, 4 / this.samplesPerSecond), c = 1 - Math.pow(.5, 4e3 / this.samplesPerSecond); let d = +this.limit, p = [], u = -1, m = 0; for (; m < s && !a;) { this.nextBar = this.getNextBar(), this.nextBar >= o.barCount && (this.nextBar = null); const f = s - m, y = Math.ceil(this.tickSampleCountdown), b = Math.min(y, f), g = m + b; if (this.isPlayingSong || this.renderingSong) for (let t = o.pitchChannelCount + o.noiseChannelCount; t < o.getChannelCount(); t++) { const e = o.channels[t], i = this.channels[t]; this.determineCurrentActiveTones(o, t, h, n); for (let s = 0; s < e.instruments.length; s++) { const e = i.instruments[s]; for (let i = 0; i < e.activeModTones.count(); i++) { const s = e.activeModTones.get(i); this.playModTone(o, t, h, m, b, s, !1, !1) } } } if (this.wantToSkip) { let t = p.includes(this.bar); if (t && m == u) return; -1 == u && (u = m), t || p.push(this.bar), this.wantToSkip = !1, this.skipBar() } else { for (let s = 0; s < o.pitchChannelCount + o.noiseChannelCount; s++) { const a = o.channels[s], r = this.channels[s]; this.isAtStartOfTick && (this.determineCurrentActiveTones(o, s, h, n && !this.countInMetronome), this.determineLiveInputTones(o, s, h)); for (let n = 0; n < a.instruments.length; n++) { const l = a.instruments[n], c = r.instruments[n]; if (this.isAtStartOfTick) { let t = c.activeTones.count() + c.liveInputTones.count(); for (let i = 0; i < c.releasedTones.count(); i++) { const n = c.releasedTones.get(i); if (n.ticksSinceReleased >= Math.abs(l.getFadeOutTicks())) { this.freeReleasedTone(c, i), i--; continue } const a = t >= e.maximumTonesPerChannel; this.computeTone(o, s, h, n, !0, a), t++ } c.awake && (c.computed || c.compute(this, l, h, Math.ceil(h), null, s, n), c.computed = !1) } for (let t = 0; t < c.activeTones.count(); t++) { const e = c.activeTones.get(t); this.playTone(s, m, b, e) } for (let t = 0; t < c.liveInputTones.count(); t++) { const e = c.liveInputTones.get(t); this.playTone(s, m, b, e) } for (let t = 0; t < c.releasedTones.count(); t++) { const e = c.releasedTones.get(t); this.playTone(s, m, b, e) } c.awake && Et.effectsSynth(this, t, i, m, b, c); const d = this.tickSampleCountdown, p = 1 - d / h, u = 1 - (d - b) / h, f = (this.beat * e.partsPerBeat + this.part) * e.ticksPerPart + this.tick, y = f / e.ticksPerPart, g = (f + 1) / e.ticksPerPart, w = y + (g - y) * p, v = y + (g - y) * u; let k = l.vibratoSpeed; l.LFOtime = l.nextLFOtime, this.isModActive(e.modulators.dictionary["vibrato speed"].index, s, n) && (k = this.getModValue(e.modulators.dictionary["vibrato speed"].index, s, n)), 0 == k ? (l.LFOtime = 0, l.nextLFOtime = 0) : l.nextLFOtime += .1 * k * (v - w) } } if (this.enableMetronome || this.countInMetronome) if (0 == this.part) { if (!this.startedMetronome) { const t = o.beatsPerBar > 4 && o.beatsPerBar % 2 == 0 && this.beat == o.beatsPerBar / 2, e = 0 == this.beat ? 8 : t ? 6 : 4, i = 0 == this.beat ? 1600 : t ? 1200 : 800, s = 0 == this.beat ? .06 : t ? .05 : .04, n = this.samplesPerSecond / i, h = 2 * Math.PI / n; this.metronomeSamplesRemaining = Math.floor(n * e), this.metronomeFilter = 2 * Math.cos(h), this.metronomeAmplitude = s * Math.sin(h), this.metronomePrevAmplitude = 0, this.startedMetronome = !0 } if (this.metronomeSamplesRemaining > 0) { const e = Math.min(g, m + this.metronomeSamplesRemaining); this.metronomeSamplesRemaining -= e - m; for (let s = m; s < e; s++) { t[s] += this.metronomeAmplitude, i[s] += this.metronomeAmplitude; const e = this.metronomeFilter * this.metronomeAmplitude - this.metronomePrevAmplitude; this.metronomePrevAmplitude = this.metronomeAmplitude, this.metronomeAmplitude = e } } } else this.startedMetronome = !1; for (let e = m; e < g; e++) { const s = t[e] * o.masterGain * o.masterGain, n = i[e] * o.masterGain * o.masterGain, h = s < 0 ? -s : s, a = n < 0 ? -n : n, p = h > a ? h : a; this.song.inVolumeCap = this.song.inVolumeCap > p ? this.song.inVolumeCap : p; const u = +(p > o.compressionThreshold) + +(p > o.limitThreshold), m = +(0 == u) * ((.8 * (p + 1 - o.compressionThreshold) + .25) * o.compressionRatio + 1.05 * (1 - o.compressionRatio)) + 1.05 * +(1 == u) + +(2 == u) * (1.05 * ((p + 1 - o.limitThreshold) * o.limitRatio + (1 - o.limitThreshold))); d += (m - d) * (d < m ? c : l); const f = r / (d >= 1 ? 1.05 * d : .8 * d + .25); t[e] = s * f, i[e] = n * f, this.song.outVolumeCap = this.song.outVolumeCap > p * f ? this.song.outVolumeCap : p * f } if (m += b, this.isAtStartOfTick = !1, this.tickSampleCountdown -= b, this.tickSampleCountdown <= 0) { this.isAtStartOfTick = !0; for (const t of this.channels) for (const e of t.instruments) { for (let t = 0; t < e.releasedTones.count(); t++) { const i = e.releasedTones.get(t); i.isOnLastTick ? (this.freeReleasedTone(e, t), t--) : i.ticksSinceReleased++ } e.deactivateAfterThisTick && e.deactivate(), e.tonesAddedInThisTick = !1 } for (let t = 0; t < this.song.pitchChannelCount + this.song.noiseChannelCount; t++)for (let i = 0; i < this.song.channels[t].instruments.length; i++) { let s = this.song.channels[t].instruments[i], n = s.arpeggioSpeed; this.isModActive(e.modulators.dictionary["arp speed"].index, t, i) ? (n = this.getModValue(e.modulators.dictionary["arp speed"].index, t, i, !1), Number.isInteger(n) ? s.arpTime += e.arpSpeedScale[n] : s.arpTime += (1 - n % 1) * e.arpSpeedScale[Math.floor(n)] + n % 1 * e.arpSpeedScale[Math.ceil(n)]) : s.arpTime += e.arpSpeedScale[n] } for (let t = 0; t < this.song.pitchChannelCount + this.song.noiseChannelCount; t++)for (let e = 0; e < this.song.channels[t].instruments.length; e++) { let i = this.song.channels[t].instruments[e]; null != i.tmpEqFilterEnd ? i.tmpEqFilterStart = i.tmpEqFilterEnd : i.tmpEqFilterStart = i.eqFilter, null != i.tmpNoteFilterEnd ? i.tmpNoteFilterStart = i.tmpNoteFilterEnd : i.tmpNoteFilterStart = i.noteFilter } this.tick++, this.tickSampleCountdown += h, this.tick == e.ticksPerPart && (this.tick = 0, this.part++, this.liveInputDuration--, this.part == e.partsPerBeat && (this.part = 0, n && (this.beat++, this.beat == o.beatsPerBar && (this.beat = 0, this.countInMetronome ? this.countInMetronome = !1 : (this.prevBar = this.bar, this.bar = this.getNextBar(), this.bar <= this.prevBar && this.loopRepeatCount > 0 && this.loopRepeatCount--, this.bar >= o.barCount && (this.bar = 0, -1 != this.loopRepeatCount && (a = !0, this.resetEffects(), this.pause()))))))) } for (let t = 0; t < e.modulators.length; t++)null != this.nextModValues && null != this.nextModValues[t] && (this.modValues[t] = this.nextModValues[t]); this.isModActive(e.modulators.dictionary.tempo.index) && (h = this.getSamplesPerTick(), this.tickSampleCountdown = Math.min(this.tickSampleCountdown, h)); for (let t = 0; t < this.song.pitchChannelCount; t++)for (let i of this.song.channels[t].instruments) i.nextLFOtime = i.nextLFOtime % (e.vibratoTypes[i.vibratoType].period / (e.ticksPerPart * h / this.samplesPerSecond)), i.arpTime = i.arpTime % (2520 * e.ticksPerArpeggio); for (let t = 0; t < e.modulators.length; t++)for (let e = 0; e < this.song.pitchChannelCount + this.song.noiseChannelCount; e++)for (let i = 0; i < this.song.getMaxInstrumentsPerChannel(); i++)null != this.nextModInsValues && null != this.nextModInsValues[e] && null != this.nextModInsValues[e][i] && null != this.nextModInsValues[e][i][t] && (this.modInsValues[e][i][t] = this.nextModInsValues[e][i][t]) } } (!Number.isFinite(d) || Math.abs(d) < et) && (d = 0), this.limit = d, n && !this.countInMetronome && (this.playheadInternal = (((this.tick + 1 - this.tickSampleCountdown / h) / 2 + this.part) / e.partsPerBeat + this.beat) / o.beatsPerBar + this.bar) } freeTone(t) { this.tonePool.pushBack(t) } newTone() { if (this.tonePool.count() > 0) { const t = this.tonePool.popBack(); return t.freshlyAllocated = !0, t } return new St } releaseTone(t, e) { t.releasedTones.pushFront(e), e.atNoteStart = !1, e.passedEndOfNote = !0 } freeReleasedTone(t, e) { this.freeTone(t.releasedTones.get(e)), t.releasedTones.remove(e) } freeAllTones() { for (const t of this.channels) for (const e of t.instruments) { for (; e.activeTones.count() > 0;)this.freeTone(e.activeTones.popBack()); for (; e.activeModTones.count() > 0;)this.freeTone(e.activeModTones.popBack()); for (; e.releasedTones.count() > 0;)this.freeTone(e.releasedTones.popBack()); for (; e.liveInputTones.count() > 0;)this.freeTone(e.liveInputTones.popBack()) } } determineLiveInputTones(t, e, i) { const s = t.channels[e], n = this.channels[e], o = this.liveInputPitches; for (let h = 0; h < s.instruments.length; h++) { const a = n.instruments[h], r = a.liveInputTones; let l = 0; if (this.liveInputDuration > 0 && e == this.liveInputChannel && o.length > 0 && -1 != this.liveInputInstruments.indexOf(h)) { const n = s.instruments[h]; if (n.getChord().singleTone) { let s; r.count() <= l ? (s = this.newTone(), r.pushBack(s)) : !n.getTransition().isSeamless && this.liveInputStarted ? (this.releaseTone(a, r.get(l)), s = this.newTone(), r.set(l, s)) : s = r.get(l), l++; for (let t = 0; t < o.length; t++)s.pitches[t] = o[t]; s.pitchCount = o.length, s.chordSize = 1, s.instrumentIndex = h, s.note = s.prevNote = s.nextNote = null, s.atNoteStart = this.liveInputStarted, s.forceContinueAtStart = !1, s.forceContinueAtEnd = !1, this.computeTone(t, e, i, s, !1, !1) } else { this.moveTonesIntoOrderedTempMatchedList(r, o); for (let s = 0; s < o.length; s++) { let n; null != this.tempMatchedPitchTones[l] ? (n = this.tempMatchedPitchTones[l], this.tempMatchedPitchTones[l] = null, 1 == n.pitchCount && n.pitches[0] == o[s] || (this.releaseTone(a, n), n = this.newTone()), r.pushBack(n)) : (n = this.newTone(), r.pushBack(n)), l++, n.pitches[0] = o[s], n.pitchCount = 1, n.chordSize = o.length, n.instrumentIndex = h, n.note = n.prevNote = n.nextNote = null, n.atNoteStart = this.liveInputStarted, n.forceContinueAtStart = !1, n.forceContinueAtEnd = !1, this.computeTone(t, e, i, n, !1, !1) } } } for (; r.count() > l;)this.releaseTone(a, r.popBack()); this.clearTempMatchedPitchTones(l, a) } this.liveInputStarted = !1 } adjacentPatternHasCompatibleInstrumentTransition(t, e, i, s, n, o, h, a, r, l) { if (t.patternInstruments && -1 == s.instruments.indexOf(n)) { if (i.instruments.length > 1 || s.instruments.length > 1) return null; const t = e.instruments[s.instruments[0]]; if (l) return t.getChord(); const n = t.getTransition(); return o.includeAdjacentPatterns && n.includeAdjacentPatterns && n.slides == o.slides ? t.getChord() : null } return l || o.includeAdjacentPatterns ? h : null } static adjacentNotesHaveMatchingPitches(t, e) { if (t.pitches.length != e.pitches.length) return !1; const i = t.pins[t.pins.length - 1].interval; for (const s of t.pitches) if (-1 == e.pitches.indexOf(s + i)) return !1; return !0 } moveTonesIntoOrderedTempMatchedList(t, e) { for (let i = 0; i < t.count(); i++) { const s = t.get(i), n = s.pitches[0] + s.lastInterval; for (let o = 0; o < e.length; o++)if (e[o] == n) { this.tempMatchedPitchTones[o] = s, t.remove(i), i--; break } } for (; t.count() > 0;) { const e = t.popFront(); for (let t = 0; t < this.tempMatchedPitchTones.length; t++)if (null == this.tempMatchedPitchTones[t]) { this.tempMatchedPitchTones[t] = e; break } } } determineCurrentActiveTones(t, i, s, n) { const o = t.channels[i], h = this.channels[i], a = t.getPattern(i, this.bar), r = this.getCurrentPart(), l = this.tick + e.ticksPerPart * r; if (n && t.getChannelIsMod(i)) { let s = [], n = [], c = [], d = e.modCount; for (; d--;)s.push(null), n.push(null), c.push(null); if (null != a && !o.muted) for (let t = 0; t < a.notes.length; t++)a.notes[t].end <= r ? (null == n[a.notes[t].pitches[0]] || a.notes[t].end > n[a.notes[t].pitches[0]].start) && (n[a.notes[t].pitches[0]] = a.notes[t]) : a.notes[t].start <= r && a.notes[t].end > r ? s[a.notes[t].pitches[0]] = a.notes[t] : a.notes[t].start > r && (null == c[a.notes[t].pitches[0]] || a.notes[t].start < c[a.notes[t].pitches[0]].start) && (c[a.notes[t].pitches[0]] = a.notes[t]); let p = 0; const u = t.patternInstruments && null != a ? a.instruments[0] : 0, m = h.instruments[u], f = m.activeModTones; for (let t = 0; t < e.modCount; t++) { if (null != s[t] && (null != n[t] && n[t].end != s[t].start && (n[t] = null), null != c[t] && c[t].start != s[t].end && (c[t] = null)), null != h.singleSeamlessInstrument && h.singleSeamlessInstrument != u && h.singleSeamlessInstrument < h.instruments.length) { const t = h.instruments[h.singleSeamlessInstrument], e = h.instruments[u]; for (; t.activeModTones.count() > 0;)e.activeModTones.pushFront(t.activeModTones.popBack()) } if (h.singleSeamlessInstrument = u, null != s[t]) { let i = n[t], o = c[t], h = !1, a = !1; const r = e.ticksPerPart * s[t].start == l && this.isAtStartOfTick; let d; if (f.count() <= p) d = this.newTone(), f.pushBack(d); else if (r && null == i) { const t = f.get(p); t.isOnLastTick ? this.freeTone(t) : this.releaseTone(m, t), d = this.newTone(), f.set(p, d) } else d = f.get(p); p++; for (let e = 0; e < s[t].pitches.length; e++)d.pitches[e] = s[t].pitches[e]; d.pitchCount = s[t].pitches.length, d.chordSize = 1, d.instrumentIndex = u, d.note = s[t], d.noteStartPart = s[t].start, d.noteEndPart = s[t].end, d.prevNote = i, d.nextNote = o, d.prevNotePitchIndex = 0, d.nextNotePitchIndex = 0, d.atNoteStart = r, d.passedEndOfNote = !1, d.forceContinueAtStart = h, d.forceContinueAtEnd = a } } for (; f.count() > p;) { const e = f.popBack(), s = t.channels[i]; if (e.instrumentIndex < s.instruments.length && !e.isOnLastTick) { const t = this.channels[i].instruments[e.instrumentIndex]; this.releaseTone(t, e) } else this.freeTone(e) } } else if (!t.getChannelIsMod(i)) { let c = null, d = null, p = null; if (n && null != a && !o.muted && (!this.isRecording || this.liveInputChannel != i)) { for (let t = 0; t < a.notes.length; t++)if (a.notes[t].end <= r) d = a.notes[t]; else if (a.notes[t].start <= r && a.notes[t].end > r) c = a.notes[t]; else if (a.notes[t].start > r) { p = a.notes[t]; break } null != c && (null != d && d.end != c.start && (d = null), null != p && p.start != c.end && (p = null)) } if (null != a && (!t.layeredInstruments || 1 == o.instruments.length || t.patternInstruments && 1 == a.instruments.length)) { const e = t.patternInstruments ? a.instruments[0] : 0; if (null != h.singleSeamlessInstrument && h.singleSeamlessInstrument != e && h.singleSeamlessInstrument < h.instruments.length) { const t = h.instruments[h.singleSeamlessInstrument], i = h.instruments[e]; for (; t.activeTones.count() > 0;)i.activeTones.pushFront(t.activeTones.popBack()) } h.singleSeamlessInstrument = e } else h.singleSeamlessInstrument = null; for (let n = 0; n < o.instruments.length; n++) { const u = h.instruments[n], m = u.activeTones; let f = 0; if (null != c && (!t.patternInstruments || -1 != a.instruments.indexOf(n))) { const h = o.instruments[n]; let y = d, b = p; const g = e.partsPerBeat * t.beatsPerBar, w = h.getTransition(), v = h.getChord(); let k = !1, x = !1, M = 0, S = 0; if (0 == c.start) { let e = null == this.prevBar ? null : t.getPattern(i, this.prevBar); if (null != e) { const i = e.notes.length <= 0 ? null : e.notes[e.notes.length - 1]; if (null != i && i.end == g) { const s = c.continuesLastPattern && Et.adjacentNotesHaveMatchingPitches(i, c), h = this.adjacentPatternHasCompatibleInstrumentTransition(t, o, a, e, n, w, v, c, i, s); null != h && (y = i, M = h.singleTone ? 1 : y.pitches.length, k = s) } } } else null != y && (M = v.singleTone ? 1 : y.pitches.length); if (c.end == g) { let e = null == this.nextBar ? null : t.getPattern(i, this.nextBar); if (null != e) { const i = e.notes.length <= 0 ? null : e.notes[0]; if (null != i && 0 == i.start) { const s = i.continuesLastPattern && Et.adjacentNotesHaveMatchingPitches(c, i), h = this.adjacentPatternHasCompatibleInstrumentTransition(t, o, a, e, n, w, v, c, i, s); null != h && (b = i, S = h.singleTone ? 1 : b.pitches.length, x = s) } } } else null != b && (S = v.singleTone ? 1 : b.pitches.length); if (v.singleTone) { const o = e.ticksPerPart * c.start == l; let a; if (m.count() <= f) a = this.newTone(), m.pushBack(a); else if (!o || (w.isSeamless || h.clicklessTransition || k) && null != y) a = m.get(f); else { const t = m.get(f); t.isOnLastTick ? this.freeTone(t) : this.releaseTone(u, t), a = this.newTone(), m.set(f, a) } f++; for (let t = 0; t < c.pitches.length; t++)a.pitches[t] = c.pitches[t]; a.pitchCount = c.pitches.length, a.chordSize = 1, a.instrumentIndex = n, a.note = c, a.noteStartPart = c.start, a.noteEndPart = c.end, a.prevNote = y, a.nextNote = b, a.prevNotePitchIndex = 0, a.nextNotePitchIndex = 0, a.atNoteStart = o, a.passedEndOfNote = !1, a.forceContinueAtStart = k, a.forceContinueAtEnd = x, this.computeTone(t, i, s, a, !1, !1) } else { const o = h.getTransition(); (o.isSeamless && !o.slides && 0 == v.strumParts || k) && e.ticksPerPart * c.start == l && null != y && this.moveTonesIntoOrderedTempMatchedList(m, c.pitches); let a = 0; for (let h = 0; h < c.pitches.length; h++) { let d = M > h ? y : null, p = c, g = S > h ? b : null, w = p.start + a, F = !1; if (w > r) { if (!(m.count() > h && (o.isSeamless || k) && null != d)) break; g = p, p = d, d = null, w = p.start + a, F = !0 } let C = p.end; (o.isSeamless || k) && null != g && (C = Math.min(e.partsPerBeat * this.song.beatsPerBar, C + a)), (o.continues || k) && null != d || (a += v.strumParts); const E = e.ticksPerPart * w == l; let T; if (null != this.tempMatchedPitchTones[f]) T = this.tempMatchedPitchTones[f], this.tempMatchedPitchTones[f] = null, m.pushBack(T); else if (m.count() <= f) T = this.newTone(), m.pushBack(T); else if (!E || (o.isSeamless || k) && null != d) T = m.get(f); else { const t = m.get(f); t.isOnLastTick ? this.freeTone(t) : this.releaseTone(u, t), T = this.newTone(), m.set(f, T) } f++, T.pitches[0] = p.pitches[h], T.pitchCount = 1, T.chordSize = p.pitches.length, T.instrumentIndex = n, T.note = p, T.noteStartPart = w, T.noteEndPart = C, T.prevNote = d, T.nextNote = g, T.prevNotePitchIndex = h, T.nextNotePitchIndex = h, T.atNoteStart = E, T.passedEndOfNote = F, T.forceContinueAtStart = k && null != d, T.forceContinueAtEnd = x && null != g, this.computeTone(t, i, s, T, !1, !1) } } } for (; m.count() > f;) { const e = m.popBack(), s = t.channels[i]; if (e.instrumentIndex < s.instruments.length && !e.isOnLastTick) { const t = h.instruments[e.instrumentIndex]; this.releaseTone(t, e) } else this.freeTone(e) } this.clearTempMatchedPitchTones(f, u) } } } clearTempMatchedPitchTones(t, e) { for (let i = t; i < this.tempMatchedPitchTones.length; i++) { const t = this.tempMatchedPitchTones[i]; null != t && (t.isOnLastTick ? this.freeTone(t) : this.releaseTone(e, t), this.tempMatchedPitchTones[i] = null) } } playTone(t, e, i, s) { const n = this.channels[t].instruments[s.instrumentIndex]; null != n.synthesizer && n.synthesizer(this, e, i, s, n), s.envelopeComputer.clearEnvelopes() } playModTone(t, i, s, n, o, h, a, r) { const l = t.channels[i].instruments[h.instrumentIndex]; if (null != h.note) { const t = this.getTicksIntoBar(), i = t / e.ticksPerPart, a = (t + 1) / e.ticksPerPart, r = this.tickSampleCountdown, c = i + (a - i) * (1 - r / s), d = i + (a - i) * (1 - (r - o) / s), p = e.ticksPerPart * c, u = e.ticksPerPart * d, m = h.note.getEndPinIndex(this.getCurrentPart()), f = h.note.pins[m - 1], y = h.note.pins[m], b = (h.note.start + f.time) * e.ticksPerPart, g = (h.note.start + y.time) * e.ticksPerPart, w = (p - b) / (g - b), v = (u - b) / (g - b); h.expression = f.size + (y.size - f.size) * w, h.expressionDelta = f.size + (y.size - f.size) * v - h.expression, Et.modSynth(this, n, o, h, l) } } static computeChordExpression(t) { return 1 / (.25 * (t - 1) + 1) } computeTone(t, i, s, n, o, h) { const a = Math.ceil(s), r = t.channels[i], c = this.channels[i], d = r.instruments[n.instrumentIndex], p = c.instruments[n.instrumentIndex]; p.awake = !0, p.tonesAddedInThisTick = !0, p.computed || p.compute(this, d, s, a, n, i, n.instrumentIndex); const b = d.getTransition(), g = d.getChord(), w = g.singleTone ? 1 : Et.computeChordExpression(n.chordSize), v = t.getChannelIsNoise(i), k = v ? e.noiseInterval : 1, x = e.ticksPerPart * s / this.samplesPerSecond, M = 1 / this.samplesPerSecond, S = 1 / e.partsPerBeat, F = this.getTicksIntoBar(), C = F / e.ticksPerPart, E = (F + 1) / e.ticksPerPart, T = this.getCurrentPart(); let I = 1; n.specialIntervalExpressionMult = 1; let P = h, A = 0, L = 0, q = 1, D = 1, N = w, z = w, B = 16, R = e.keys[t.key].basePitch, O = 1, $ = 48; if (3 == d.type) O = e.spectrumBaseExpression, v && (R = e.spectrumBasePitch, O *= 2), B = e.spectrumBasePitch, $ = 28; else if (4 == d.type) R = e.spectrumBasePitch, O = e.drumsetBaseExpression, B = R; else if (2 == d.type) R = e.chipNoises[d.chipNoise].basePitch, O = e.noiseBaseExpression, B = R, $ = e.chipNoises[d.chipNoise].isSoft ? 24 : 60; else if (1 == d.type) O = e.fmBaseExpression; else if (0 == d.type || 8 == d.type) O = e.chipBaseExpression; else if (5 == d.type) O = e.harmonicsBaseExpression; else if (6 == d.type) O = e.pwmBaseExpression; else if (7 == d.type) O = e.pickedStringBaseExpression; else { if (9 != d.type) throw new Error("Unknown instrument type in computeTone."); O = 1, B = 0, $ = 1, R = 0 } (n.atNoteStart && !b.isSeamless && !n.forceContinueAtStart || n.freshlyAllocated) && n.reset(), n.freshlyAllocated = !1; for (let t = 0; t < e.maxPitchOrOperatorCount; t++)n.phaseDeltas[t] = 0, n.phaseDeltaScales[t] = 0, n.operatorExpressions[t] = 0, n.operatorExpressionDeltas[t] = 0; n.expression = 0, n.expressionDelta = 0; for (let t = 0; t < e.operatorCount; t++)n.operatorWaves[t] = Et.getOperatorWave(d.operators[t].waveform, d.operators[t].pulseWidth); if (o) { const t = n.ticksSinceReleased, i = n.ticksSinceReleased + 1; A = L = n.lastInterval; const s = Math.abs(d.getFadeOutTicks()); q = Et.noteSizeToVolumeMult((1 - t / s) * e.noteSizeMax), D = Et.noteSizeToVolumeMult((1 - i / s) * e.noteSizeMax), h && (D = 0), n.ticksSinceReleased + 1 >= s && (P = !0) } else if (null == n.note) q = D = 1, n.lastInterval = 0, n.ticksSinceReleased = 0, n.liveInputSamplesHeld += a; else { const t = n.note, i = n.nextNote, s = n.noteStartPart, o = n.noteEndPart, h = t.getEndPinIndex(T), a = t.pins[h - 1], r = t.pins[h], l = s * e.ticksPerPart, c = o * e.ticksPerPart, p = (t.start + a.time) * e.ticksPerPart, u = (t.start + r.time) * e.ticksPerPart; n.ticksSinceReleased = 0; const m = T * e.ticksPerPart + this.tick, f = m + 1, y = m - l, g = f - l, w = Math.min(1, (m - p) / (u - p)), v = Math.min(1, (f - p) / (u - p)); if (q = 1, D = 1, A = a.interval + (r.interval - a.interval) * w, L = a.interval + (r.interval - a.interval) * v, n.lastInterval = L, !b.isSeamless && !n.forceContinueAtEnd || null == i) { const t = -d.getFadeOutTicks(); if (t > 0) { const e = c - l; q *= Math.min(1, (e - y) / t), D *= Math.min(1, (e - g) / t), f >= l + e && (P = !0) } } } n.isOnLastTick = P; let H, V, G = d.noteFilter; if (d.noteFilterType) { const t = d.noteFilter; null == d.noteSubFilters[1] && (d.noteSubFilters[1] = new bt); const s = d.noteSubFilters[1]; let o = d.noteFilterSimpleCut, h = d.noteFilterSimplePeak, a = d.noteFilterSimpleCut, r = d.noteFilterSimplePeak, l = !1; this.isModActive(e.modulators.dictionary["note filt cut"].index, i, n.instrumentIndex) && (o = this.getModValue(e.modulators.dictionary["note filt cut"].index, i, n.instrumentIndex, !1), a = this.getModValue(e.modulators.dictionary["note filt cut"].index, i, n.instrumentIndex, !0), l = !0), this.isModActive(e.modulators.dictionary["note filt peak"].index, i, n.instrumentIndex) && (h = this.getModValue(e.modulators.dictionary["note filt peak"].index, i, n.instrumentIndex, !1), r = this.getModValue(e.modulators.dictionary["note filt peak"].index, i, n.instrumentIndex, !0), l = !0), t.convertLegacySettingsForSynth(o, h, !l), s.convertLegacySettingsForSynth(a, r, !l), H = t.controlPoints[0], V = s.controlPoints[0], d.noteFilter = t, d.tmpNoteFilterStart = t } const _ = n.envelopeComputer; _.computeEnvelopes(d, T, e.ticksPerPart * C, s / this.samplesPerSecond, n); const j = n.envelopeComputer.envelopeStarts, U = n.envelopeComputer.envelopeEnds; if (d.noteFilter = G, null != n.note && b.slides) { const t = n.prevNote, e = n.nextNote; if (null != t) { const e = t.pitches[n.prevNotePitchIndex] + t.pins[t.pins.length - 1].interval - n.pitches[0]; if (_.prevSlideStart && (A += e * _.prevSlideRatioStart), _.prevSlideEnd && (L += e * _.prevSlideRatioEnd), !g.singleTone) { const e = t.pitches.length - n.chordSize; _.prevSlideStart && (N = Et.computeChordExpression(n.chordSize + e * _.prevSlideRatioStart)), _.prevSlideEnd && (z = Et.computeChordExpression(n.chordSize + e * _.prevSlideRatioEnd)) } } if (null != e) { const t = e.pitches[n.nextNotePitchIndex] - (n.pitches[0] + n.note.pins[n.note.pins.length - 1].interval); if (_.nextSlideStart && (A += t * _.nextSlideRatioStart), _.nextSlideEnd && (L += t * _.nextSlideRatioEnd), !g.singleTone) { const t = e.pitches.length - n.chordSize; _.nextSlideStart && (N = Et.computeChordExpression(n.chordSize + t * _.nextSlideRatioStart)), _.nextSlideEnd && (z = Et.computeChordExpression(n.chordSize + t * _.nextSlideRatioEnd)) } } } if (u(d.effects)) { let t = e.justIntonationSemitones[d.pitchShift] / k, s = 1, o = 1; this.isModActive(e.modulators.dictionary["pitch shift"].index, i, n.instrumentIndex) && (t = e.justIntonationSemitones[e.justIntonationSemitones.length - 1], s = this.getModValue(e.modulators.dictionary["pitch shift"].index, i, n.instrumentIndex, !1) / e.pitchShiftCenter, o = this.getModValue(e.modulators.dictionary["pitch shift"].index, i, n.instrumentIndex, !0) / e.pitchShiftCenter); A += t * j[14] * s, L += t * U[14] * o } if (m(d.effects) || this.isModActive(e.modulators.dictionary["song detune"].index, i, n.instrumentIndex)) { const t = j[15], s = U[15]; let o = d.detune, h = d.detune; this.isModActive(e.modulators.dictionary.detune.index, i, n.instrumentIndex) && (o = this.getModValue(e.modulators.dictionary.detune.index, i, n.instrumentIndex, !1) + e.detuneCenter, h = this.getModValue(e.modulators.dictionary.detune.index, i, n.instrumentIndex, !0) + e.detuneCenter), this.isModActive(e.modulators.dictionary["song detune"].index, i, n.instrumentIndex) && (o += 4 * this.getModValue(e.modulators.dictionary["song detune"].index, i, n.instrumentIndex, !1), h += 4 * this.getModValue(e.modulators.dictionary["song detune"].index, i, n.instrumentIndex, !0)), A += Et.detuneToCents(o * t) * e.pitchesPerOctave / 1200, L += Et.detuneToCents(h * s) * e.pitchesPerOctave / 1200 } if (f(d.effects)) { let t, s, o, h; if (d.vibrato == e.vibratos.length ? (t = 2 * d.vibratoDelay, d.vibratoDelay == e.modulators.dictionary["vibrato delay"].maxRawVol && (t = Number.POSITIVE_INFINITY), s = d.vibratoDepth, o = s) : (t = e.vibratos[d.vibrato].delayTicks, s = e.vibratos[d.vibrato].amplitude, o = s), this.isModActive(e.modulators.dictionary["vibrato delay"].index, i, n.instrumentIndex) && (t = 2 * this.getModValue(e.modulators.dictionary["vibrato delay"].index, i, n.instrumentIndex, !1), t == 2 * e.modulators.dictionary["vibrato delay"].maxRawVol && (t = Number.POSITIVE_INFINITY)), this.isModActive(e.modulators.dictionary["vibrato depth"].index, i, n.instrumentIndex) && (s = this.getModValue(e.modulators.dictionary["vibrato depth"].index, i, n.instrumentIndex, !1) / 25, o = this.getModValue(e.modulators.dictionary["vibrato depth"].index, i, n.instrumentIndex, !0) / 25), null != n.prevVibrato) h = n.prevVibrato; else { if (h = s * Et.getLFOAmplitude(d, x * d.LFOtime) * j[16], t > 0) { const e = t - _.noteTicksStart; h *= Math.max(0, Math.min(1, 1 - e / 2)) } } let a = Et.getLFOAmplitude(d, x * d.nextLFOtime); const r = U[16]; if (9 != d.type) { let e = o * a * r; if (t > 0) { const i = t - _.noteTicksEnd; e *= Math.max(0, Math.min(1, 1 - i / 2)) } n.prevVibrato = e, A += h, L += e } } if (!b.isSeamless && !n.forceContinueAtStart || null == n.prevNote) { const t = d.getFadeInSeconds(); t > 0 && (q *= Math.min(1, _.noteSecondsStart / t), D *= Math.min(1, _.noteSecondsEnd / t)) } 4 == d.type && null == n.drumsetPitch && (n.drumsetPitch = n.pitches[0], null != n.note && (n.drumsetPitch += n.note.pickMainInterval()), n.drumsetPitch = Math.max(0, Math.min(e.drumCount - 1, n.drumsetPitch))); let W = _.lowpassCutoffDecayVolumeCompensation; if (y(d.effects)) { const t = j[1], e = U[1]; if (d.noteFilterType) { const i = j[17], s = U[17], o = j[25], h = U[25]; H.toCoefficients(Et.tempFilterStartCoefficients, this.samplesPerSecond, t * i, o), V.toCoefficients(Et.tempFilterEndCoefficients, this.samplesPerSecond, e * s, h), n.noteFilters.length < 1 && (n.noteFilters[0] = new tt), n.noteFilters[0].loadCoefficientsWithGradient(Et.tempFilterStartCoefficients, Et.tempFilterEndCoefficients, 1 / a, 0 == H.type), W *= H.getVolumeCompensationMult(), n.noteFilterCount = 1 } else { const i = null != d.tmpNoteFilterStart ? d.tmpNoteFilterStart : d.noteFilter; for (let s = 0; s < i.controlPointCount; s++) { const o = j[17 + s], h = U[17 + s], r = j[25 + s], l = U[25 + s]; let c = i.controlPoints[s]; const p = null != d.tmpNoteFilterEnd && null != d.tmpNoteFilterEnd.controlPoints[s] ? d.tmpNoteFilterEnd.controlPoints[s] : i.controlPoints[s]; c.type != p.type && (c = p), c.toCoefficients(Et.tempFilterStartCoefficients, this.samplesPerSecond, t * o, r), p.toCoefficients(Et.tempFilterEndCoefficients, this.samplesPerSecond, e * h, l), n.noteFilters.length <= s && (n.noteFilters[s] = new tt), n.noteFilters[s].loadCoefficientsWithGradient(Et.tempFilterStartCoefficients, Et.tempFilterEndCoefficients, 1 / a, 0 == c.type), W *= c.getVolumeCompensationMult() } n.noteFilterCount = i.controlPointCount } } else n.noteFilterCount = 0; if (4 == d.type) { const t = d.getDrumsetEnvelope(n.drumsetPitch); W *= Mt.getLowpassCutoffDecayVolumeCompensation(t); let e = Mt.computeEnvelope(t, _.noteSecondsStart, S * C, _.noteSizeStart), i = Mt.computeEnvelope(t, _.noteSecondsEnd, S * E, _.noteSizeEnd); if (_.prevSlideStart) { e += (Mt.computeEnvelope(t, _.prevNoteSecondsStart, S * C, _.prevNoteSize) - e) * _.prevSlideRatioStart } if (_.prevSlideEnd) { i += (Mt.computeEnvelope(t, _.prevNoteSecondsEnd, S * E, _.prevNoteSize) - i) * _.prevSlideRatioEnd } if (_.nextSlideStart) { e += (Mt.computeEnvelope(t, 0, S * C, _.nextNoteSize) - e) * _.nextSlideRatioStart } if (_.nextSlideEnd) { i += (Mt.computeEnvelope(t, 0, S * E, _.nextNoteSize) - i) * _.nextSlideRatioEnd } const s = this.tempDrumSetControlPoint; s.type = 0, s.gain = yt.getRoundedSettingValueFromLinearGain(.5), s.freq = yt.getRoundedSettingValueFromHz(8e3), s.toCoefficients(Et.tempFilterStartCoefficients, this.samplesPerSecond, e * (1 + e), 1), s.toCoefficients(Et.tempFilterEndCoefficients, this.samplesPerSecond, i * (1 + i), 1), n.noteFilters.length == n.noteFilterCount && (n.noteFilters[n.noteFilterCount] = new tt), n.noteFilters[n.noteFilterCount].loadCoefficientsWithGradient(Et.tempFilterStartCoefficients, Et.tempFilterEndCoefficients, 1 / a, !0), n.noteFilterCount++ } if (W = Math.min(3, W), 1 == d.type) { let t = 1, s = 0, o = 0; const h = g.arpeggiates; if (n.pitchCount > 1 && h) { const t = Math.floor(d.arpTime / e.ticksPerArpeggio); o = n.pitches[l(n.pitchCount, d.fastTwoNoteArp, t)] - n.pitches[0] } const r = e.algorithms[d.algorithm].carrierCount; for (let l = 0; l < e.operatorCount; l++) { const c = e.algorithms[d.algorithm].associatedCarrier[l] - 1, p = n.pitches[h ? 0 : l < n.pitchCount ? l : c < n.pitchCount ? c : 0], u = e.operatorFrequencies[d.operators[l].frequency].mult, m = e.operatorCarrierInterval[c] + o, f = R + (p + A) * k + m, y = R + (p + L) * k + m, b = wt.frequencyFromPitch(f), g = wt.frequencyFromPitch(y), w = e.operatorFrequencies[d.operators[l].frequency].hzOffset, v = u * b + w, x = u * g + w, S = j[5 + l], F = U[5 + l]; let C, E; 1 != S || 1 != F ? (C = Math.pow(2, Math.log2(v / b) * S) * b, E = Math.pow(2, Math.log2(x / g) * F) * g) : (C = v, E = x), n.phaseDeltas[l] = C * M, n.phaseDeltaScales[l] = Math.pow(E / C, 1 / a); let T = d.operators[l].amplitude, I = d.operators[l].amplitude; this.isModActive(e.modulators.dictionary["fm slider 1"].index + l, i, n.instrumentIndex) && (T *= this.getModValue(e.modulators.dictionary["fm slider 1"].index + l, i, n.instrumentIndex, !1) / 15, I *= this.getModValue(e.modulators.dictionary["fm slider 1"].index + l, i, n.instrumentIndex, !0) / 15); const P = Et.operatorAmplitudeCurve(T), q = Et.operatorAmplitudeCurve(I); let D = P * e.operatorFrequencies[d.operators[l].frequency].amplitudeSign, N = q * e.operatorFrequencies[d.operators[l].frequency].amplitudeSign; if (l < r) { let t; t = null != n.prevPitchExpressions[l] ? n.prevPitchExpressions[l] : Math.pow(2, -(f - B) / $); const e = Math.pow(2, -(y - B) / $); n.prevPitchExpressions[l] = e, D *= t, N *= e, s += q } else D *= 1.5 * e.sineWaveLength, N *= 1.5 * e.sineWaveLength, t *= 1 - Math.min(1, d.operators[l].amplitude / 15); if (D *= j[9 + l], N *= U[9 + l], this.isModActive(e.modulators.dictionary["note volume"].index, i, n.instrumentIndex)) { const t = this.getModValue(e.modulators.dictionary["note volume"].index, i, n.instrumentIndex, !1), s = this.getModValue(e.modulators.dictionary["note volume"].index, i, n.instrumentIndex, !0); D *= t <= 0 ? (t + e.volumeRange / 2) / (e.volumeRange / 2) : Et.instrumentVolumeToVolumeMult(t), N *= s <= 0 ? (s + e.volumeRange / 2) / (e.volumeRange / 2) : Et.instrumentVolumeToVolumeMult(s) } n.operatorExpressions[l] = D, n.operatorExpressionDeltas[l] = (N - D) / a } t *= (Math.pow(2, 2 - 1.4 * d.feedbackAmplitude / 15) - 1) / 3, t *= 1 - Math.min(1, Math.max(0, s - 1) / 2), t = 1 + 3 * t; const c = O * t * W * q * N * j[0], p = O * t * W * D * z * U[0]; n.expression = c, n.expressionDelta = (p - c) / a; let u = d.feedbackAmplitude, m = d.feedbackAmplitude; this.isModActive(e.modulators.dictionary["fm feedback"].index, i, n.instrumentIndex) && (u *= this.getModValue(e.modulators.dictionary["fm feedback"].index, i, n.instrumentIndex, !1) / 15, m *= this.getModValue(e.modulators.dictionary["fm feedback"].index, i, n.instrumentIndex, !0) / 15); let f = .3 * e.sineWaveLength * u / 15; const y = .3 * e.sineWaveLength * m / 15; let b = f * j[13], w = y * U[13]; n.feedbackMult = b, n.feedbackDelta = (w - b) / a } else { const t = Math.pow(2, (L - A) * k / 12 / a); let s = n.pitches[0]; if (n.pitchCount > 1 && (g.arpeggiates || g.customInterval)) { const t = Math.floor(d.arpTime / e.ticksPerArpeggio); if (g.customInterval) { const e = n.pitches[1 + l(n.pitchCount - 1, d.fastTwoNoteArp, t)] - n.pitches[0]; I = Math.pow(2, e / 12), n.specialIntervalExpressionMult = Math.pow(2, -e / $) } else s = n.pitches[l(n.pitchCount, d.fastTwoNoteArp, t)] } const o = R + (s + A) * k, h = R + (s + L) * k; let r; r = null != n.prevPitchExpressions[0] ? n.prevPitchExpressions[0] : Math.pow(2, -(o - B) / $); const c = Math.pow(2, -(h - B) / $); n.prevPitchExpressions[0] = c; let u = O * W; if (2 == d.type && (u *= e.chipNoises[d.chipNoise].expression), 0 == d.type && (u *= e.chipWaves[d.chipWave].expression), 6 == d.type) { const t = d.pulseWidth / (2 * e.pulseWidthRange); let s = t, o = t; this.isModActive(e.modulators.dictionary["pulse width"].index, i, n.instrumentIndex) && (s = this.getModValue(e.modulators.dictionary["pulse width"].index, i, n.instrumentIndex, !1) / (2 * e.pulseWidthRange), o = this.getModValue(e.modulators.dictionary["pulse width"].index, i, n.instrumentIndex, !0) / (2 * e.pulseWidthRange)); const h = s * j[2], r = o * U[2]; n.pulseWidth = h, n.pulseWidthDelta = (r - h) / a } if (7 == d.type) { let t = d.stringSustain, s = d.stringSustain; this.isModActive(e.modulators.dictionary.sustain.index, i, n.instrumentIndex) && (t = this.getModValue(e.modulators.dictionary.sustain.index, i, n.instrumentIndex, !1), s = this.getModValue(e.modulators.dictionary.sustain.index, i, n.instrumentIndex, !0)), n.stringSustainStart = t, n.stringSustainEnd = s, u *= Math.pow(2, .7 * (1 - t / (e.stringSustainRange - 1))) } const m = wt.frequencyFromPitch(o); if (0 == d.type || 8 == d.type || 5 == d.type || 7 == d.type) { const i = e.unisons[d.unison], s = 7 == d.type ? 1 : i.voices / 2; u *= i.expression * s; const o = j[4], h = U[4], r = Math.pow(2, (i.offset + i.spread) * o / 12), l = Math.pow(2, (i.offset + i.spread) * h / 12), c = Math.pow(2, (i.offset - i.spread) * o / 12) * I, p = Math.pow(2, (i.offset - i.spread) * h / 12) * I; n.phaseDeltas[0] = m * M * r, n.phaseDeltas[1] = m * M * c, n.phaseDeltaScales[0] = t * Math.pow(l / r, 1 / a), n.phaseDeltaScales[1] = t * Math.pow(p / c, 1 / a) } else n.phaseDeltas[0] = m * M, n.phaseDeltaScales[0] = t; let f = u * q * N * r * j[0], y = u * D * z * c * U[0]; if (this.isModActive(e.modulators.dictionary["note volume"].index, i, n.instrumentIndex)) { const t = this.getModValue(e.modulators.dictionary["note volume"].index, i, n.instrumentIndex, !1), s = this.getModValue(e.modulators.dictionary["note volume"].index, i, n.instrumentIndex, !0); f *= t <= 0 ? (t + e.volumeRange / 2) / (e.volumeRange / 2) : Et.instrumentVolumeToVolumeMult(t), y *= s <= 0 ? (s + e.volumeRange / 2) / (e.volumeRange / 2) : Et.instrumentVolumeToVolumeMult(s) } if (n.expression = f, n.expressionDelta = (y - f) / a, 7 == d.type) { let t; if (null != n.prevStringDecay) t = n.prevStringDecay; else { const i = n.envelopeComputer.envelopeStarts[3]; t = 1 - Math.min(1, i * n.stringSustainStart / (e.stringSustainRange - 1)) } const i = n.envelopeComputer.envelopeEnds[3]; let s = 1 - Math.min(1, i * n.stringSustainEnd / (e.stringSustainRange - 1)); n.prevStringDecay = s; const o = e.unisons[d.unison]; for (let t = n.pickedStrings.length; t < o.voices; t++)n.pickedStrings[t] = new xt; if (n.atNoteStart && !b.continues && !n.forceContinueAtStart) for (const t of n.pickedStrings) t.delayIndex = -1; for (let e = 0; e < o.voices; e++)n.pickedStrings[e].update(this, p, n, e, a, t, s) } } } static getLFOAmplitude(t, i) { let s = 0; for (const n of e.vibratoTypes[t.vibratoType].periodsSeconds) s += Math.sin(2 * Math.PI * i / n); return s } static getInstrumentSynthFunction(t) { if (1 == t.type) { const i = t.algorithm + "_" + t.feedbackType; if (null == Et.fmSynthFunctionCache[i]) { const s = []; for (const i of Et.fmSourceTemplate) if (-1 != i.indexOf("// CARRIER OUTPUTS")) { const n = []; for (let i = 0; i < e.algorithms[t.algorithm].carrierCount; i++)n.push("operator" + i + "Scaled"); s.push(i.replace("/*operator#Scaled*/", n.join(" + "))) } else if (-1 != i.indexOf("// INSERT OPERATOR COMPUTATION HERE")) for (let i = e.operatorCount - 1; i >= 0; i--)for (const n of Et.operatorSourceTemplate) if (-1 != n.indexOf("/* + operator@Scaled*/")) { let o = ""; for (const s of e.algorithms[t.algorithm].modulatedBy[i]) o += " + operator" + (s - 1) + "Scaled"; const h = e.feedbacks[t.feedbackType].indices[i]; if (h.length > 0) { o += " + feedbackMult * ("; const t = []; for (const e of h) t.push("operator" + (e - 1) + "Output"); o += t.join(" + ") + ")" } s.push(n.replace(/\#/g, i + "").replace("/* + operator@Scaled*/", o)) } else s.push(n.replace(/\#/g, i + "")); else if (-1 != i.indexOf("#")) for (let t = 0; t < e.operatorCount; t++)s.push(i.replace(/\#/g, t + "")); else s.push(i); Et.fmSynthFunctionCache[i] = new Function("synth", "bufferIndex", "roundedSamplesPerTick", "tone", "instrumentState", s.join("\n")) } return Et.fmSynthFunctionCache[i] } if (0 == t.type) return Et.chipSynth; if (8 == t.type) return Et.chipSynth; if (5 == t.type) return Et.harmonicsSynth; if (6 == t.type) return Et.pulseWidthSynth; if (7 == t.type) return Et.pickedStringSynth; if (2 == t.type) return Et.noiseSynth; if (3 == t.type) return Et.spectrumSynth; if (4 == t.type) return Et.drumsetSynth; if (9 == t.type) return Et.modSynth; throw new Error("Unrecognized instrument type: " + t.type) } static chipSynth(t, e, i, s, n) { const o = b(n.effects) && n.aliases, h = t.tempMonoInstrumentSampleBuffer, a = n.wave, r = n.volumeScale, l = o && 8 == n.type ? a.length : a.length - 1, c = s.specialIntervalExpressionMult * n.unison.sign; 1 != n.unison.voices || n.chord.customInterval || (s.phases[1] = s.phases[0]); let d = s.phaseDeltas[0] * l, p = s.phaseDeltas[1] * l; const u = +s.phaseDeltaScales[0], m = +s.phaseDeltaScales[1]; let f = +s.expression; const y = +s.expressionDelta; let g = s.phases[0] % 1 * l, w = s.phases[1] % 1 * l; const v = s.noteFilters, k = 0 | s.noteFilterCount; let x = +s.initialNoteFilterInput1, M = +s.initialNoteFilterInput2; const S = Et.applyFilters; let F = 0, C = 0; if (!o) { const t = 0 | g, e = 0 | w, i = t % l, s = e % l, n = g - t, o = w - e; F = +a[i], C = +a[s], F += (a[i + 1] - F) * n, C += (a[s + 1] - C) * o } const E = e + i; for (let t = e; t < E; t++) { let e, i, s; if (g += d, w += p, o) e = a[(0 | g) % l], i = a[(0 | w) % l], s = e + i; else { const t = 0 | g, n = 0 | w, o = t % l, h = n % l; let r = a[o], u = a[h]; const m = g - t, f = w - n; r += (a[o + 1] - r) * m, u += (a[h + 1] - u) * f, e = (r - F) / d, i = (u - C) / p, F = r, C = u, s = e + i * c } const n = S(s * r, x, M, k, v); M = x, x = s * r, d *= u, p *= m; const b = n * f; f += y, h[t] += b } s.phases[0] = g / l, s.phases[1] = w / l, s.phaseDeltas[0] = d / l, s.phaseDeltas[1] = p / l, s.expression = f, t.sanitizeFilters(v), s.initialNoteFilterInput1 = x, s.initialNoteFilterInput2 = M } static harmonicsSynth(t, e, i, s, n) { const o = t.tempMonoInstrumentSampleBuffer, h = n.wave, a = h.length - 1, r = s.specialIntervalExpressionMult * n.unison.sign; 1 != n.unison.voices || n.chord.customInterval || (s.phases[1] = s.phases[0]); let l = s.phaseDeltas[0] * a, c = s.phaseDeltas[1] * a; const d = +s.phaseDeltaScales[0], p = +s.phaseDeltaScales[1]; let u = +s.expression; const m = +s.expressionDelta; let f = s.phases[0] % 1 * a, y = s.phases[1] % 1 * a; const b = s.noteFilters, g = 0 | s.noteFilterCount; let w = +s.initialNoteFilterInput1, v = +s.initialNoteFilterInput2; const k = Et.applyFilters, x = 0 | f, M = 0 | y, S = x % a, F = M % a, C = f - x, E = y - M; let T = +h[S], I = +h[F]; T += (h[S + 1] - T) * C, I += (h[F + 1] - I) * E; const P = e + i; for (let t = e; t < P; t++) { f += l, y += c; const e = 0 | f, i = 0 | y, s = e % a, n = i % a; let x = h[s], M = h[n]; const S = f - e, F = y - i; x += (h[s + 1] - x) * S, M += (h[n + 1] - M) * F; const C = (x - T) / l, E = (M - I) / c; T = x, I = M; const P = C + E * r, A = k(P, w, v, g, b); v = w, w = P, l *= d, c *= p; const L = A * u; u += m, o[t] += L } s.phases[0] = f / a, s.phases[1] = y / a, s.phaseDeltas[0] = l / a, s.phaseDeltas[1] = c / a, s.expression = u, t.sanitizeFilters(b), s.initialNoteFilterInput1 = w, s.initialNoteFilterInput2 = v } static pickedStringSynth(t, e, i, s, n) { const o = n.unison.voices; let h = Et.pickedStringFunctionCache[o]; if (null == h) { let t = ""; t += "\n\t\t\t\tconst Config = beepbox.Config;\n\t\t\t\tconst Synth = beepbox.Synth;\n\t\t\t\tconst data = synth.tempMonoInstrumentSampleBuffer;\n\t\t\t\t\n\t\t\t\tlet pickedString# = tone.pickedStrings[#];\n\t\t\t\tlet allPassSample# = +pickedString#.allPassSample;\n\t\t\t\tlet allPassPrevInput# = +pickedString#.allPassPrevInput;\n\t\t\t\tlet shelfSample# = +pickedString#.shelfSample;\n\t\t\t\tlet shelfPrevInput# = +pickedString#.shelfPrevInput;\n\t\t\t\tlet fractionalDelaySample# = +pickedString#.fractionalDelaySample;\n\t\t\t\tconst delayLine# = pickedString#.delayLine;\n\t\t\t\tconst delayBufferMask# = (delayLine#.length - 1) >> 0;\n\t\t\t\tlet delayIndex# = pickedString#.delayIndex|0;\n\t\t\t\tdelayIndex# = (delayIndex# & delayBufferMask#) + delayLine#.length;\n\t\t\t\tlet delayLength# = +pickedString#.prevDelayLength;\n\t\t\t\tconst delayLengthDelta# = +pickedString#.delayLengthDelta;\n\t\t\t\tlet allPassG# = +pickedString#.allPassG;\n\t\t\t\tlet shelfA1# = +pickedString#.shelfA1;\n\t\t\t\tlet shelfB0# = +pickedString#.shelfB0;\n\t\t\t\tlet shelfB1# = +pickedString#.shelfB1;\n\t\t\t\tconst allPassGDelta# = +pickedString#.allPassGDelta;\n\t\t\t\tconst shelfA1Delta# = +pickedString#.shelfA1Delta;\n\t\t\t\tconst shelfB0Delta# = +pickedString#.shelfB0Delta;\n\t\t\t\tconst shelfB1Delta# = +pickedString#.shelfB1Delta;\n\t\t\t\t\n\t\t\t\tlet expression = +tone.expression;\n\t\t\t\tconst expressionDelta = +tone.expressionDelta;\n\t\t\t\t\n\t\t\t\tconst unisonSign = tone.specialIntervalExpressionMult * instrumentState.unison.sign;\n\t\t\t\tconst delayResetOffset# = pickedString#.delayResetOffset|0;\n\t\t\t\t\n\t\t\t\tconst filters = tone.noteFilters;\n\t\t\t\tconst filterCount = tone.noteFilterCount|0;\n\t\t\t\tlet initialFilterInput1 = +tone.initialNoteFilterInput1;\n\t\t\t\tlet initialFilterInput2 = +tone.initialNoteFilterInput2;\n\t\t\t\tconst applyFilters = Synth.applyFilters;\n\t\t\t\t\n\t\t\t\tconst stopIndex = bufferIndex + runLength;\n\t\t\t\tfor (let sampleIndex = bufferIndex; sampleIndex < stopIndex; sampleIndex++) {\n\t\t\t\t\tconst targetSampleTime# = delayIndex# - delayLength#;\n\t\t\t\t\tconst lowerIndex# = (targetSampleTime# + 0.125) | 0; // Offset to improve stability of all-pass filter.\n\t\t\t\t\tconst upperIndex# = lowerIndex# + 1;\n\t\t\t\t\tconst fractionalDelay# = upperIndex# - targetSampleTime#;\n\t\t\t\t\tconst fractionalDelayG# = (1.0 - fractionalDelay#) / (1.0 + fractionalDelay#); // Inlined version of FilterCoefficients.prototype.allPass1stOrderFractionalDelay\n\t\t\t\t\tconst prevInput# = delayLine#[lowerIndex# & delayBufferMask#];\n\t\t\t\t\tconst input# = delayLine#[upperIndex# & delayBufferMask#];\n\t\t\t\t\tfractionalDelaySample# = fractionalDelayG# * input# + prevInput# - fractionalDelayG# * fractionalDelaySample#;\n\t\t\t\t\t\n\t\t\t\t\tallPassSample# = fractionalDelaySample# * allPassG# + allPassPrevInput# - allPassG# * allPassSample#;\n\t\t\t\t\tallPassPrevInput# = fractionalDelaySample#;\n\t\t\t\t\t\n\t\t\t\t\tshelfSample# = shelfB0# * allPassSample# + shelfB1# * shelfPrevInput# - shelfA1# * shelfSample#;\n\t\t\t\t\tshelfPrevInput# = allPassSample#;\n\t\t\t\t\t\n\t\t\t\t\tdelayLine#[delayIndex# & delayBufferMask#] += shelfSample#;\n\t\t\t\t\tdelayLine#[(delayIndex# + delayResetOffset#) & delayBufferMask#] = 0.0;\n\t\t\t\t\tdelayIndex#++;\n\t\t\t\t\t\n\t\t\t\t\tconst inputSample = ("; const e = []; for (let t = 0; t < o; t++)e.push("fractionalDelaySample" + t + (1 == t ? " * unisonSign" : "")); t += e.join(" + "), t += ") * expression;\n\t\t\t\t\tconst sample = applyFilters(inputSample, initialFilterInput1, initialFilterInput2, filterCount, filters);\n\t\t\t\t\tinitialFilterInput2 = initialFilterInput1;\n\t\t\t\t\tinitialFilterInput1 = inputSample;\n\t\t\t\t\tdata[sampleIndex] += sample;\n\t\t\t\t\t\n\t\t\t\t\texpression += expressionDelta;\n\t\t\t\t\tdelayLength# += delayLengthDelta#;\n\t\t\t\t\tallPassG# += allPassGDelta#;\n\t\t\t\t\tshelfA1# += shelfA1Delta#;\n\t\t\t\t\tshelfB0# += shelfB0Delta#;\n\t\t\t\t\tshelfB1# += shelfB1Delta#;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Avoid persistent denormal or NaN values in the delay buffers and filter history.\n\t\t\t\tconst epsilon = (1.0e-24);\n\t\t\t\tif (!Number.isFinite(allPassSample#) || Math.abs(allPassSample#) < epsilon) allPassSample# = 0.0;\n\t\t\t\tif (!Number.isFinite(allPassPrevInput#) || Math.abs(allPassPrevInput#) < epsilon) allPassPrevInput# = 0.0;\n\t\t\t\tif (!Number.isFinite(shelfSample#) || Math.abs(shelfSample#) < epsilon) shelfSample# = 0.0;\n\t\t\t\tif (!Number.isFinite(shelfPrevInput#) || Math.abs(shelfPrevInput#) < epsilon) shelfPrevInput# = 0.0;\n\t\t\t\tif (!Number.isFinite(fractionalDelaySample#) || Math.abs(fractionalDelaySample#) < epsilon) fractionalDelaySample# = 0.0;\n\t\t\t\tpickedString#.allPassSample = allPassSample#;\n\t\t\t\tpickedString#.allPassPrevInput = allPassPrevInput#;\n\t\t\t\tpickedString#.shelfSample = shelfSample#;\n\t\t\t\tpickedString#.shelfPrevInput = shelfPrevInput#;\n\t\t\t\tpickedString#.fractionalDelaySample = fractionalDelaySample#;\n\t\t\t\tpickedString#.delayIndex = delayIndex#;\n\t\t\t\tpickedString#.prevDelayLength = delayLength#;\n\t\t\t\tpickedString#.allPassG = allPassG#;\n\t\t\t\tpickedString#.shelfA1 = shelfA1#;\n\t\t\t\tpickedString#.shelfB0 = shelfB0#;\n\t\t\t\tpickedString#.shelfB1 = shelfB1#;\n\t\t\t\t\n\t\t\t\ttone.expression = expression;\n\t\t\t\t\n\t\t\t\tsynth.sanitizeFilters(filters);\n\t\t\t\ttone.initialNoteFilterInput1 = initialFilterInput1;\n\t\t\t\ttone.initialNoteFilterInput2 = initialFilterInput2;", t = t.replace(/^.*\#.*$/gm, (t => { const e = []; for (let i = 0; i < o; i++)e.push(t.replace(/\#/g, String(i))); return e.join("\n") })), h = new Function("synth", "bufferIndex", "runLength", "tone", "instrumentState", t), Et.pickedStringFunctionCache[o] = h } h(t, e, i, s, n) } static effectsSynth(t, e, i, s, n, o) { const h = b(o.effects), a = g(o.effects), r = o.eqFilterCount > 0, l = w(o.effects), c = v(o.effects), d = k(o.effects), p = x(o.effects); let u = 0; h && (u |= 1), u <<= 1, a && (u |= 1), u <<= 1, r && (u |= 1), u <<= 1, l && (u |= 1), u <<= 1, c && (u |= 1), u <<= 1, d && (u |= 1), u <<= 1, p && (u |= 1); let m = Et.effectsFunctionCache[u]; if (null == m) { let t = ""; const e = c || p || d; t += "\n\t\t\t\tconst Config = beepbox.Config;\n\t\t\t\tconst tempMonoInstrumentSampleBuffer = synth.tempMonoInstrumentSampleBuffer;\n\t\t\t\t\n\t\t\t\tlet mixVolume = +instrumentState.mixVolume;\n\t\t\t\tconst mixVolumeDelta = +instrumentState.mixVolumeDelta;", e && (t += "\n\t\t\t\t\n\t\t\t\tlet delayInputMult = +instrumentState.delayInputMult;\n\t\t\t\tconst delayInputMultDelta = +instrumentState.delayInputMultDelta;"), h && (t += "\n\t\t\t\t\n\t\t\t\tconst distortionBaseVolume = +Config.distortionBaseVolume;\n\t\t\t\tlet distortion = instrumentState.distortion;\n\t\t\t\tconst distortionDelta = instrumentState.distortionDelta;\n\t\t\t\tlet distortionDrive = instrumentState.distortionDrive;\n\t\t\t\tconst distortionDriveDelta = instrumentState.distortionDriveDelta;\n\t\t\t\tconst distortionFractionalResolution = 4.0;\n\t\t\t\tconst distortionOversampleCompensation = distortionBaseVolume / distortionFractionalResolution;\n\t\t\t\tconst distortionFractionalDelay1 = 1.0 / distortionFractionalResolution;\n\t\t\t\tconst distortionFractionalDelay2 = 2.0 / distortionFractionalResolution;\n\t\t\t\tconst distortionFractionalDelay3 = 3.0 / distortionFractionalResolution;\n\t\t\t\tconst distortionFractionalDelayG1 = (1.0 - distortionFractionalDelay1) / (1.0 + distortionFractionalDelay1); // Inlined version of FilterCoefficients.prototype.allPass1stOrderFractionalDelay\n\t\t\t\tconst distortionFractionalDelayG2 = (1.0 - distortionFractionalDelay2) / (1.0 + distortionFractionalDelay2); // Inlined version of FilterCoefficients.prototype.allPass1stOrderFractionalDelay\n\t\t\t\tconst distortionFractionalDelayG3 = (1.0 - distortionFractionalDelay3) / (1.0 + distortionFractionalDelay3); // Inlined version of FilterCoefficients.prototype.allPass1stOrderFractionalDelay\n\t\t\t\tconst distortionNextOutputWeight1 = Math.cos(Math.PI * distortionFractionalDelay1) * 0.5 + 0.5;\n\t\t\t\tconst distortionNextOutputWeight2 = Math.cos(Math.PI * distortionFractionalDelay2) * 0.5 + 0.5;\n\t\t\t\tconst distortionNextOutputWeight3 = Math.cos(Math.PI * distortionFractionalDelay3) * 0.5 + 0.5;\n\t\t\t\tconst distortionPrevOutputWeight1 = 1.0 - distortionNextOutputWeight1;\n\t\t\t\tconst distortionPrevOutputWeight2 = 1.0 - distortionNextOutputWeight2;\n\t\t\t\tconst distortionPrevOutputWeight3 = 1.0 - distortionNextOutputWeight3;\n\t\t\t\t\n\t\t\t\tlet distortionFractionalInput1 = +instrumentState.distortionFractionalInput1;\n\t\t\t\tlet distortionFractionalInput2 = +instrumentState.distortionFractionalInput2;\n\t\t\t\tlet distortionFractionalInput3 = +instrumentState.distortionFractionalInput3;\n\t\t\t\tlet distortionPrevInput = +instrumentState.distortionPrevInput;\n\t\t\t\tlet distortionNextOutput = +instrumentState.distortionNextOutput;"), a && (t += "\n\t\t\t\t\n\t\t\t\tlet bitcrusherPrevInput = +instrumentState.bitcrusherPrevInput;\n\t\t\t\tlet bitcrusherCurrentOutput = +instrumentState.bitcrusherCurrentOutput;\n\t\t\t\tlet bitcrusherPhase = +instrumentState.bitcrusherPhase;\n\t\t\t\tlet bitcrusherPhaseDelta = +instrumentState.bitcrusherPhaseDelta;\n\t\t\t\tconst bitcrusherPhaseDeltaScale = +instrumentState.bitcrusherPhaseDeltaScale;\n\t\t\t\tlet bitcrusherScale = +instrumentState.bitcrusherScale;\n\t\t\t\tconst bitcrusherScaleScale = +instrumentState.bitcrusherScaleScale;\n\t\t\t\tlet bitcrusherFoldLevel = +instrumentState.bitcrusherFoldLevel;\n\t\t\t\tconst bitcrusherFoldLevelScale = +instrumentState.bitcrusherFoldLevelScale;"), r && (t += "\n\t\t\t\t\n\t\t\t\tlet filters = instrumentState.eqFilters;\n\t\t\t\tconst filterCount = instrumentState.eqFilterCount|0;\n\t\t\t\tlet initialFilterInput1 = +instrumentState.initialEqFilterInput1;\n\t\t\t\tlet initialFilterInput2 = +instrumentState.initialEqFilterInput2;\n\t\t\t\tconst applyFilters = beepbox.Synth.applyFilters;"), t += "\n\t\t\t\t\n\t\t\t\tlet eqFilterVolume = +instrumentState.eqFilterVolume;\n\t\t\t\tconst eqFilterVolumeDelta = +instrumentState.eqFilterVolumeDelta;", l && (t += "\n\t\t\t\t\n\t\t\t\tconst panningMask = synth.panningDelayBufferMask >>> 0;\n\t\t\t\tconst panningDelayLine = instrumentState.panningDelayLine;\n\t\t\t\tlet panningDelayPos = instrumentState.panningDelayPos & panningMask;\n\t\t\t\tlet   panningVolumeL      = +instrumentState.panningVolumeL;\n\t\t\t\tlet   panningVolumeR      = +instrumentState.panningVolumeR;\n\t\t\t\tconst panningVolumeDeltaL = +instrumentState.panningVolumeDeltaL;\n\t\t\t\tconst panningVolumeDeltaR = +instrumentState.panningVolumeDeltaR;\n\t\t\t\tlet   panningOffsetL      = +instrumentState.panningOffsetL;\n\t\t\t\tlet   panningOffsetR      = +instrumentState.panningOffsetR;\n\t\t\t\tconst panningOffsetDeltaL = 1.0 - instrumentState.panningOffsetDeltaL;\n\t\t\t\tconst panningOffsetDeltaR = 1.0 - instrumentState.panningOffsetDeltaR;"), c && (t += "\n\t\t\t\t\n\t\t\t\tconst chorusMask = synth.chorusDelayBufferMask >>> 0;\n\t\t\t\tconst chorusDelayLineL = instrumentState.chorusDelayLineL;\n\t\t\t\tconst chorusDelayLineR = instrumentState.chorusDelayLineR;\n\t\t\t\tinstrumentState.chorusDelayLineDirty = true;\n\t\t\t\tlet chorusDelayPos = instrumentState.chorusDelayPos & chorusMask;\n\t\t\t\t\n\t\t\t\tlet chorusVoiceMult = +instrumentState.chorusVoiceMult;\n\t\t\t\tconst chorusVoiceMultDelta = +instrumentState.chorusVoiceMultDelta;\n\t\t\t\tlet chorusCombinedMult = +instrumentState.chorusCombinedMult;\n\t\t\t\tconst chorusCombinedMultDelta = +instrumentState.chorusCombinedMultDelta;\n\t\t\t\t\n\t\t\t\tconst chorusDuration = +beepbox.Config.chorusPeriodSeconds;\n\t\t\t\tconst chorusAngle = Math.PI * 2.0 / (chorusDuration * synth.samplesPerSecond);\n\t\t\t\tconst chorusRange = synth.samplesPerSecond * beepbox.Config.chorusDelayRange;\n\t\t\t\tconst chorusOffset0 = synth.chorusDelayBufferSize - beepbox.Config.chorusDelayOffsets[0][0] * chorusRange;\n\t\t\t\tconst chorusOffset1 = synth.chorusDelayBufferSize - beepbox.Config.chorusDelayOffsets[0][1] * chorusRange;\n\t\t\t\tconst chorusOffset2 = synth.chorusDelayBufferSize - beepbox.Config.chorusDelayOffsets[0][2] * chorusRange;\n\t\t\t\tconst chorusOffset3 = synth.chorusDelayBufferSize - beepbox.Config.chorusDelayOffsets[1][0] * chorusRange;\n\t\t\t\tconst chorusOffset4 = synth.chorusDelayBufferSize - beepbox.Config.chorusDelayOffsets[1][1] * chorusRange;\n\t\t\t\tconst chorusOffset5 = synth.chorusDelayBufferSize - beepbox.Config.chorusDelayOffsets[1][2] * chorusRange;\n\t\t\t\tlet chorusPhase = instrumentState.chorusPhase % (Math.PI * 2.0);\n\t\t\t\tlet chorusTap0Index = chorusDelayPos + chorusOffset0 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[0][0]);\n\t\t\t\tlet chorusTap1Index = chorusDelayPos + chorusOffset1 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[0][1]);\n\t\t\t\tlet chorusTap2Index = chorusDelayPos + chorusOffset2 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[0][2]);\n\t\t\t\tlet chorusTap3Index = chorusDelayPos + chorusOffset3 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[1][0]);\n\t\t\t\tlet chorusTap4Index = chorusDelayPos + chorusOffset4 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[1][1]);\n\t\t\t\tlet chorusTap5Index = chorusDelayPos + chorusOffset5 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[1][2]);\n\t\t\t\tchorusPhase += chorusAngle * runLength;\n\t\t\t\tconst chorusTap0End = chorusDelayPos + chorusOffset0 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[0][0]) + runLength;\n\t\t\t\tconst chorusTap1End = chorusDelayPos + chorusOffset1 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[0][1]) + runLength;\n\t\t\t\tconst chorusTap2End = chorusDelayPos + chorusOffset2 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[0][2]) + runLength;\n\t\t\t\tconst chorusTap3End = chorusDelayPos + chorusOffset3 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[1][0]) + runLength;\n\t\t\t\tconst chorusTap4End = chorusDelayPos + chorusOffset4 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[1][1]) + runLength;\n\t\t\t\tconst chorusTap5End = chorusDelayPos + chorusOffset5 - chorusRange * Math.sin(chorusPhase + beepbox.Config.chorusPhaseOffsets[1][2]) + runLength;\n\t\t\t\tconst chorusTap0Delta = (chorusTap0End - chorusTap0Index) / runLength;\n\t\t\t\tconst chorusTap1Delta = (chorusTap1End - chorusTap1Index) / runLength;\n\t\t\t\tconst chorusTap2Delta = (chorusTap2End - chorusTap2Index) / runLength;\n\t\t\t\tconst chorusTap3Delta = (chorusTap3End - chorusTap3Index) / runLength;\n\t\t\t\tconst chorusTap4Delta = (chorusTap4End - chorusTap4Index) / runLength;\n\t\t\t\tconst chorusTap5Delta = (chorusTap5End - chorusTap5Index) / runLength;"), d && (t += "\n\t\t\t\t\n\t\t\t\tlet echoMult = +instrumentState.echoMult;\n\t\t\t\tconst echoMultDelta = +instrumentState.echoMultDelta;\n\t\t\t\t\n\t\t\t\tconst echoDelayLineL = instrumentState.echoDelayLineL;\n\t\t\t\tconst echoDelayLineR = instrumentState.echoDelayLineR;\n\t\t\t\tconst echoMask = (echoDelayLineL.length - 1) >>> 0;\n\t\t\t\tinstrumentState.echoDelayLineDirty = true;\n\t\t\t\t\n\t\t\t\tlet echoDelayPos = instrumentState.echoDelayPos & echoMask;\n\t\t\t\tconst echoDelayOffsetStart = (echoDelayLineL.length - instrumentState.echoDelayOffsetStart) & echoMask;\n\t\t\t\tconst echoDelayOffsetEnd   = (echoDelayLineL.length - instrumentState.echoDelayOffsetEnd) & echoMask;\n\t\t\t\tlet echoDelayOffsetRatio = +instrumentState.echoDelayOffsetRatio;\n\t\t\t\tconst echoDelayOffsetRatioDelta = +instrumentState.echoDelayOffsetRatioDelta;\n\t\t\t\t\n\t\t\t\tconst echoShelfA1 = +instrumentState.echoShelfA1;\n\t\t\t\tconst echoShelfB0 = +instrumentState.echoShelfB0;\n\t\t\t\tconst echoShelfB1 = +instrumentState.echoShelfB1;\n\t\t\t\tlet echoShelfSampleL = +instrumentState.echoShelfSampleL;\n\t\t\t\tlet echoShelfSampleR = +instrumentState.echoShelfSampleR;\n\t\t\t\tlet echoShelfPrevInputL = +instrumentState.echoShelfPrevInputL;\n\t\t\t\tlet echoShelfPrevInputR = +instrumentState.echoShelfPrevInputR;"), p && (t += "\n\t\t\t\t\n\t\t\t\tconst reverbMask = Config.reverbDelayBufferMask >>> 0; //TODO: Dynamic reverb buffer size.\n\t\t\t\tconst reverbDelayLine = instrumentState.reverbDelayLine;\n\t\t\t\tinstrumentState.reverbDelayLineDirty = true;\n\t\t\t\tlet reverbDelayPos = instrumentState.reverbDelayPos & reverbMask;\n\t\t\t\t\n\t\t\t\tlet reverb = +instrumentState.reverbMult;\n\t\t\t\tconst reverbDelta = +instrumentState.reverbMultDelta;\n\t\t\t\t\n\t\t\t\tconst reverbShelfA1 = +instrumentState.reverbShelfA1;\n\t\t\t\tconst reverbShelfB0 = +instrumentState.reverbShelfB0;\n\t\t\t\tconst reverbShelfB1 = +instrumentState.reverbShelfB1;\n\t\t\t\tlet reverbShelfSample0 = +instrumentState.reverbShelfSample0;\n\t\t\t\tlet reverbShelfSample1 = +instrumentState.reverbShelfSample1;\n\t\t\t\tlet reverbShelfSample2 = +instrumentState.reverbShelfSample2;\n\t\t\t\tlet reverbShelfSample3 = +instrumentState.reverbShelfSample3;\n\t\t\t\tlet reverbShelfPrevInput0 = +instrumentState.reverbShelfPrevInput0;\n\t\t\t\tlet reverbShelfPrevInput1 = +instrumentState.reverbShelfPrevInput1;\n\t\t\t\tlet reverbShelfPrevInput2 = +instrumentState.reverbShelfPrevInput2;\n\t\t\t\tlet reverbShelfPrevInput3 = +instrumentState.reverbShelfPrevInput3;"), t += "\n\t\t\t\t\n\t\t\t\tconst stopIndex = bufferIndex + runLength;\n\t\t\t\tfor (let sampleIndex = bufferIndex; sampleIndex < stopIndex; sampleIndex++) {\n\t\t\t\t\tlet sample = tempMonoInstrumentSampleBuffer[sampleIndex];\n\t\t\t\t\ttempMonoInstrumentSampleBuffer[sampleIndex] = 0.0;", h && (t += "\n\t\t\t\t\t\n\t\t\t\t\tconst distortionReverse = 1.0 - distortion;\n\t\t\t\t\tconst distortionNextInput = sample * distortionDrive;\n\t\t\t\t\tsample = distortionNextOutput;\n\t\t\t\t\tdistortionNextOutput = distortionNextInput / (distortionReverse * Math.abs(distortionNextInput) + distortion);\n\t\t\t\t\tdistortionFractionalInput1 = distortionFractionalDelayG1 * distortionNextInput + distortionPrevInput - distortionFractionalDelayG1 * distortionFractionalInput1;\n\t\t\t\t\tdistortionFractionalInput2 = distortionFractionalDelayG2 * distortionNextInput + distortionPrevInput - distortionFractionalDelayG2 * distortionFractionalInput2;\n\t\t\t\t\tdistortionFractionalInput3 = distortionFractionalDelayG3 * distortionNextInput + distortionPrevInput - distortionFractionalDelayG3 * distortionFractionalInput3;\n\t\t\t\t\tconst distortionOutput1 = distortionFractionalInput1 / (distortionReverse * Math.abs(distortionFractionalInput1) + distortion);\n\t\t\t\t\tconst distortionOutput2 = distortionFractionalInput2 / (distortionReverse * Math.abs(distortionFractionalInput2) + distortion);\n\t\t\t\t\tconst distortionOutput3 = distortionFractionalInput3 / (distortionReverse * Math.abs(distortionFractionalInput3) + distortion);\n\t\t\t\t\tdistortionNextOutput += distortionOutput1 * distortionNextOutputWeight1 + distortionOutput2 * distortionNextOutputWeight2 + distortionOutput3 * distortionNextOutputWeight3;\n\t\t\t\t\tsample += distortionOutput1 * distortionPrevOutputWeight1 + distortionOutput2 * distortionPrevOutputWeight2 + distortionOutput3 * distortionPrevOutputWeight3;\n\t\t\t\t\tsample *= distortionOversampleCompensation;\n\t\t\t\t\tdistortionPrevInput = distortionNextInput;\n\t\t\t\t\tdistortion += distortionDelta;\n\t\t\t\t\tdistortionDrive += distortionDriveDelta;"), a && (t += "\n\t\t\t\t\t\n\t\t\t\t\tbitcrusherPhase += bitcrusherPhaseDelta;\n\t\t\t\t\tif (bitcrusherPhase < 1.0) {\n\t\t\t\t\t\tbitcrusherPrevInput = sample;\n\t\t\t\t\t\tsample = bitcrusherCurrentOutput;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbitcrusherPhase = bitcrusherPhase % 1.0;\n\t\t\t\t\t\tconst ratio = bitcrusherPhase / bitcrusherPhaseDelta;\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst lerpedInput = sample + (bitcrusherPrevInput - sample) * ratio;\n\t\t\t\t\t\tbitcrusherPrevInput = sample;\n\t\t\t\t\t\t\n\t\t\t\t\t\tconst bitcrusherWrapLevel = bitcrusherFoldLevel * 4.0;\n\t\t\t\t\t\tconst wrappedSample = (((lerpedInput + bitcrusherFoldLevel) % bitcrusherWrapLevel) + bitcrusherWrapLevel) % bitcrusherWrapLevel;\n\t\t\t\t\t\tconst foldedSample = bitcrusherFoldLevel - Math.abs(bitcrusherFoldLevel * 2.0 - wrappedSample);\n\t\t\t\t\t\tconst scaledSample = foldedSample / bitcrusherScale;\n\t\t\t\t\t\tconst oldValue = bitcrusherCurrentOutput;\n\t\t\t\t\t\tconst newValue = (((scaledSample > 0 ? scaledSample + 1 : scaledSample)|0)-.5) * bitcrusherScale;\n\t\t\t\t\t\t\n\t\t\t\t\t\tsample = oldValue + (newValue - oldValue) * ratio;\n\t\t\t\t\t\tbitcrusherCurrentOutput = newValue;\n\t\t\t\t\t}\n\t\t\t\t\tbitcrusherPhaseDelta *= bitcrusherPhaseDeltaScale;\n\t\t\t\t\tbitcrusherScale *= bitcrusherScaleScale;\n\t\t\t\t\tbitcrusherFoldLevel *= bitcrusherFoldLevelScale;"), r && (t += "\n\t\t\t\t\t\n\t\t\t\t\tconst inputSample = sample;\n\t\t\t\t\tsample = applyFilters(inputSample, initialFilterInput1, initialFilterInput2, filterCount, filters);\n\t\t\t\t\tinitialFilterInput2 = initialFilterInput1;\n\t\t\t\t\tinitialFilterInput1 = inputSample;"), t += "\n\t\t\t\t\t\n\t\t\t\t\tsample *= eqFilterVolume;\n\t\t\t\t\teqFilterVolume += eqFilterVolumeDelta;", t += l ? "\n\t\t\t\t\t\n\t\t\t\t\tpanningDelayLine[panningDelayPos] = sample;\n\t\t\t\t\tconst panningRatioL  = panningOffsetL % 1;\n\t\t\t\t\tconst panningRatioR  = panningOffsetR % 1;\n\t\t\t\t\tconst panningTapLA   = panningDelayLine[(panningOffsetL) & panningMask];\n\t\t\t\t\tconst panningTapLB   = panningDelayLine[(panningOffsetL + 1) & panningMask];\n\t\t\t\t\tconst panningTapRA   = panningDelayLine[(panningOffsetR) & panningMask];\n\t\t\t\t\tconst panningTapRB   = panningDelayLine[(panningOffsetR + 1) & panningMask];\n\t\t\t\t\tconst panningTapL    = panningTapLA + (panningTapLB - panningTapLA) * panningRatioL;\n\t\t\t\t\tconst panningTapR    = panningTapRA + (panningTapRB - panningTapRA) * panningRatioR;\n\t\t\t\t\tlet sampleL = panningTapL * panningVolumeL;\n\t\t\t\t\tlet sampleR = panningTapR * panningVolumeR;\n\t\t\t\t\tpanningDelayPos = (panningDelayPos + 1) & panningMask;\n\t\t\t\t\tpanningVolumeL += panningVolumeDeltaL;\n\t\t\t\t\tpanningVolumeR += panningVolumeDeltaR;\n\t\t\t\t\tpanningOffsetL += panningOffsetDeltaL;\n\t\t\t\t\tpanningOffsetR += panningOffsetDeltaR;" : "\n\t\t\t\t\t\n\t\t\t\t\tlet sampleL = sample;\n\t\t\t\t\tlet sampleR = sample;", c && (t += "\n\t\t\t\t\t\n\t\t\t\t\tconst chorusTap0Ratio = chorusTap0Index % 1;\n\t\t\t\t\tconst chorusTap1Ratio = chorusTap1Index % 1;\n\t\t\t\t\tconst chorusTap2Ratio = chorusTap2Index % 1;\n\t\t\t\t\tconst chorusTap3Ratio = chorusTap3Index % 1;\n\t\t\t\t\tconst chorusTap4Ratio = chorusTap4Index % 1;\n\t\t\t\t\tconst chorusTap5Ratio = chorusTap5Index % 1;\n\t\t\t\t\tconst chorusTap0A = chorusDelayLineL[(chorusTap0Index) & chorusMask];\n\t\t\t\t\tconst chorusTap0B = chorusDelayLineL[(chorusTap0Index + 1) & chorusMask];\n\t\t\t\t\tconst chorusTap1A = chorusDelayLineL[(chorusTap1Index) & chorusMask];\n\t\t\t\t\tconst chorusTap1B = chorusDelayLineL[(chorusTap1Index + 1) & chorusMask];\n\t\t\t\t\tconst chorusTap2A = chorusDelayLineL[(chorusTap2Index) & chorusMask];\n\t\t\t\t\tconst chorusTap2B = chorusDelayLineL[(chorusTap2Index + 1) & chorusMask];\n\t\t\t\t\tconst chorusTap3A = chorusDelayLineR[(chorusTap3Index) & chorusMask];\n\t\t\t\t\tconst chorusTap3B = chorusDelayLineR[(chorusTap3Index + 1) & chorusMask];\n\t\t\t\t\tconst chorusTap4A = chorusDelayLineR[(chorusTap4Index) & chorusMask];\n\t\t\t\t\tconst chorusTap4B = chorusDelayLineR[(chorusTap4Index + 1) & chorusMask];\n\t\t\t\t\tconst chorusTap5A = chorusDelayLineR[(chorusTap5Index) & chorusMask];\n\t\t\t\t\tconst chorusTap5B = chorusDelayLineR[(chorusTap5Index + 1) & chorusMask];\n\t\t\t\t\tconst chorusTap0 = chorusTap0A + (chorusTap0B - chorusTap0A) * chorusTap0Ratio;\n\t\t\t\t\tconst chorusTap1 = chorusTap1A + (chorusTap1B - chorusTap1A) * chorusTap1Ratio;\n\t\t\t\t\tconst chorusTap2 = chorusTap2A + (chorusTap2B - chorusTap2A) * chorusTap2Ratio;\n\t\t\t\t\tconst chorusTap3 = chorusTap3A + (chorusTap3B - chorusTap3A) * chorusTap3Ratio;\n\t\t\t\t\tconst chorusTap4 = chorusTap4A + (chorusTap4B - chorusTap4A) * chorusTap4Ratio;\n\t\t\t\t\tconst chorusTap5 = chorusTap5A + (chorusTap5B - chorusTap5A) * chorusTap5Ratio;\n\t\t\t\t\tchorusDelayLineL[chorusDelayPos] = sampleL * delayInputMult;\n\t\t\t\t\tchorusDelayLineR[chorusDelayPos] = sampleR * delayInputMult;\n\t\t\t\t\tsampleL = chorusCombinedMult * (sampleL + chorusVoiceMult * (chorusTap1 - chorusTap0 - chorusTap2));\n\t\t\t\t\tsampleR = chorusCombinedMult * (sampleR + chorusVoiceMult * (chorusTap4 - chorusTap3 - chorusTap5));\n\t\t\t\t\tchorusDelayPos = (chorusDelayPos + 1) & chorusMask;\n\t\t\t\t\tchorusTap0Index += chorusTap0Delta;\n\t\t\t\t\tchorusTap1Index += chorusTap1Delta;\n\t\t\t\t\tchorusTap2Index += chorusTap2Delta;\n\t\t\t\t\tchorusTap3Index += chorusTap3Delta;\n\t\t\t\t\tchorusTap4Index += chorusTap4Delta;\n\t\t\t\t\tchorusTap5Index += chorusTap5Delta;\n\t\t\t\t\tchorusVoiceMult += chorusVoiceMultDelta;\n\t\t\t\t\tchorusCombinedMult += chorusCombinedMultDelta;"), d && (t += "\n\t\t\t\t\t\n\t\t\t\t\tconst echoTapStartIndex = (echoDelayPos + echoDelayOffsetStart) & echoMask;\n\t\t\t\t\tconst echoTapEndIndex   = (echoDelayPos + echoDelayOffsetEnd  ) & echoMask;\n\t\t\t\t\tconst echoTapStartL = echoDelayLineL[echoTapStartIndex];\n\t\t\t\t\tconst echoTapEndL   = echoDelayLineL[echoTapEndIndex];\n\t\t\t\t\tconst echoTapStartR = echoDelayLineR[echoTapStartIndex];\n\t\t\t\t\tconst echoTapEndR   = echoDelayLineR[echoTapEndIndex];\n\t\t\t\t\tconst echoTapL = (echoTapStartL + (echoTapEndL - echoTapStartL) * echoDelayOffsetRatio) * echoMult;\n\t\t\t\t\tconst echoTapR = (echoTapStartR + (echoTapEndR - echoTapStartR) * echoDelayOffsetRatio) * echoMult;\n\t\t\t\t\t\n\t\t\t\t\techoShelfSampleL = echoShelfB0 * echoTapL + echoShelfB1 * echoShelfPrevInputL - echoShelfA1 * echoShelfSampleL;\n\t\t\t\t\techoShelfSampleR = echoShelfB0 * echoTapR + echoShelfB1 * echoShelfPrevInputR - echoShelfA1 * echoShelfSampleR;\n\t\t\t\t\techoShelfPrevInputL = echoTapL;\n\t\t\t\t\techoShelfPrevInputR = echoTapR;\n\t\t\t\t\tsampleL += echoShelfSampleL;\n\t\t\t\t\tsampleR += echoShelfSampleR;\n\t\t\t\t\t\n\t\t\t\t\techoDelayLineL[echoDelayPos] = sampleL * delayInputMult;\n\t\t\t\t\techoDelayLineR[echoDelayPos] = sampleR * delayInputMult;\n\t\t\t\t\techoDelayPos = (echoDelayPos + 1) & echoMask;\n\t\t\t\t\techoDelayOffsetRatio += echoDelayOffsetRatioDelta;\n\t\t\t\t\techoMult += echoMultDelta;\n                    "), p && (t += "\n\t\t\t\t\t\n\t\t\t\t\t// Reverb, implemented using a feedback delay network with a Hadamard matrix and lowpass filters.\n\t\t\t\t\t// good ratios:    0.555235 + 0.618033 + 0.818 +   1.0 = 2.991268\n\t\t\t\t\t// Delay lengths:  3041     + 3385     + 4481  +  5477 = 16384 = 2^14\n\t\t\t\t\t// Buffer offsets: 3041    -> 6426   -> 10907 -> 16384\n\t\t\t\t\tconst reverbDelayPos1 = (reverbDelayPos +  3041) & reverbMask;\n\t\t\t\t\tconst reverbDelayPos2 = (reverbDelayPos +  6426) & reverbMask;\n\t\t\t\t\tconst reverbDelayPos3 = (reverbDelayPos + 10907) & reverbMask;\n\t\t\t\t\tconst reverbSample0 = (reverbDelayLine[reverbDelayPos]);\n\t\t\t\t\tconst reverbSample1 = reverbDelayLine[reverbDelayPos1];\n\t\t\t\t\tconst reverbSample2 = reverbDelayLine[reverbDelayPos2];\n\t\t\t\t\tconst reverbSample3 = reverbDelayLine[reverbDelayPos3];\n\t\t\t\t\tconst reverbTemp0 = -(reverbSample0 + sampleL) + reverbSample1;\n\t\t\t\t\tconst reverbTemp1 = -(reverbSample0 + sampleR) - reverbSample1;\n\t\t\t\t\tconst reverbTemp2 = -reverbSample2 + reverbSample3;\n\t\t\t\t\tconst reverbTemp3 = -reverbSample2 - reverbSample3;\n\t\t\t\t\tconst reverbShelfInput0 = (reverbTemp0 + reverbTemp2) * reverb;\n\t\t\t\t\tconst reverbShelfInput1 = (reverbTemp1 + reverbTemp3) * reverb;\n\t\t\t\t\tconst reverbShelfInput2 = (reverbTemp0 - reverbTemp2) * reverb;\n\t\t\t\t\tconst reverbShelfInput3 = (reverbTemp1 - reverbTemp3) * reverb;\n\t\t\t\t\treverbShelfSample0 = reverbShelfB0 * reverbShelfInput0 + reverbShelfB1 * reverbShelfPrevInput0 - reverbShelfA1 * reverbShelfSample0;\n\t\t\t\t\treverbShelfSample1 = reverbShelfB0 * reverbShelfInput1 + reverbShelfB1 * reverbShelfPrevInput1 - reverbShelfA1 * reverbShelfSample1;\n\t\t\t\t\treverbShelfSample2 = reverbShelfB0 * reverbShelfInput2 + reverbShelfB1 * reverbShelfPrevInput2 - reverbShelfA1 * reverbShelfSample2;\n\t\t\t\t\treverbShelfSample3 = reverbShelfB0 * reverbShelfInput3 + reverbShelfB1 * reverbShelfPrevInput3 - reverbShelfA1 * reverbShelfSample3;\n\t\t\t\t\treverbShelfPrevInput0 = reverbShelfInput0;\n\t\t\t\t\treverbShelfPrevInput1 = reverbShelfInput1;\n\t\t\t\t\treverbShelfPrevInput2 = reverbShelfInput2;\n\t\t\t\t\treverbShelfPrevInput3 = reverbShelfInput3;\n\t\t\t\t\treverbDelayLine[reverbDelayPos1] = reverbShelfSample0 * delayInputMult;\n\t\t\t\t\treverbDelayLine[reverbDelayPos2] = reverbShelfSample1 * delayInputMult;\n\t\t\t\t\treverbDelayLine[reverbDelayPos3] = reverbShelfSample2 * delayInputMult;\n\t\t\t\t\treverbDelayLine[reverbDelayPos ] = reverbShelfSample3 * delayInputMult;\n\t\t\t\t\treverbDelayPos = (reverbDelayPos + 1) & reverbMask;\n\t\t\t\t\tsampleL += reverbSample1 + reverbSample2 + reverbSample3;\n\t\t\t\t\tsampleR += reverbSample0 + reverbSample2 - reverbSample3;\n\t\t\t\t\treverb += reverbDelta;"), t += "\n\t\t\t\t\t\n\t\t\t\t\toutputDataL[sampleIndex] += sampleL * mixVolume;\n\t\t\t\t\toutputDataR[sampleIndex] += sampleR * mixVolume;\n\t\t\t\t\tmixVolume += mixVolumeDelta;", e && (t += "\n\t\t\t\t\t\n\t\t\t\t\tdelayInputMult += delayInputMultDelta;"), t += "\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tinstrumentState.mixVolume = mixVolume;\n\t\t\t\tinstrumentState.eqFilterVolume = eqFilterVolume;\n\t\t\t\t\n\t\t\t\t// Avoid persistent denormal or NaN values in the delay buffers and filter history.\n\t\t\t\tconst epsilon = (1.0e-24);", e && (t += "\n\t\t\t\t\n\t\t\t\tinstrumentState.delayInputMult = delayInputMult;"), h && (t += "\n\t\t\t\t\n\t\t\t\tinstrumentState.distortion = distortion;\n\t\t\t\tinstrumentState.distortionDrive = distortionDrive;\n\t\t\t\t\n\t\t\t\tif (!Number.isFinite(distortionFractionalInput1) || Math.abs(distortionFractionalInput1) < epsilon) distortionFractionalInput1 = 0.0;\n\t\t\t\tif (!Number.isFinite(distortionFractionalInput2) || Math.abs(distortionFractionalInput2) < epsilon) distortionFractionalInput2 = 0.0;\n\t\t\t\tif (!Number.isFinite(distortionFractionalInput3) || Math.abs(distortionFractionalInput3) < epsilon) distortionFractionalInput3 = 0.0;\n\t\t\t\tif (!Number.isFinite(distortionPrevInput) || Math.abs(distortionPrevInput) < epsilon) distortionPrevInput = 0.0;\n\t\t\t\tif (!Number.isFinite(distortionNextOutput) || Math.abs(distortionNextOutput) < epsilon) distortionNextOutput = 0.0;\n\t\t\t\t\n\t\t\t\tinstrumentState.distortionFractionalInput1 = distortionFractionalInput1;\n\t\t\t\tinstrumentState.distortionFractionalInput2 = distortionFractionalInput2;\n\t\t\t\tinstrumentState.distortionFractionalInput3 = distortionFractionalInput3;\n\t\t\t\tinstrumentState.distortionPrevInput = distortionPrevInput;\n\t\t\t\tinstrumentState.distortionNextOutput = distortionNextOutput;"), a && (t += "\n\t\t\t\t\t\n\t\t\t\tif (Math.abs(bitcrusherPrevInput) < epsilon) bitcrusherPrevInput = 0.0;\n\t\t\t\tif (Math.abs(bitcrusherCurrentOutput) < epsilon) bitcrusherCurrentOutput = 0.0;\n\t\t\t\tinstrumentState.bitcrusherPrevInput = bitcrusherPrevInput;\n\t\t\t\tinstrumentState.bitcrusherCurrentOutput = bitcrusherCurrentOutput;\n\t\t\t\tinstrumentState.bitcrusherPhase = bitcrusherPhase;\n\t\t\t\tinstrumentState.bitcrusherPhaseDelta = bitcrusherPhaseDelta;\n\t\t\t\tinstrumentState.bitcrusherScale = bitcrusherScale;\n\t\t\t\tinstrumentState.bitcrusherFoldLevel = bitcrusherFoldLevel;"), r && (t += "\n\t\t\t\t\t\n\t\t\t\tsynth.sanitizeFilters(filters);\n\t\t\t\t// The filter input here is downstream from another filter so we\n\t\t\t\t// better make sure it's safe too.\n\t\t\t\tif (!(initialFilterInput1 < 100) || !(initialFilterInput2 < 100)) {\n\t\t\t\t\tinitialFilterInput1 = 0.0;\n\t\t\t\t\tinitialFilterInput2 = 0.0;\n\t\t\t\t}\n\t\t\t\tif (Math.abs(initialFilterInput1) < epsilon) initialFilterInput1 = 0.0;\n\t\t\t\tif (Math.abs(initialFilterInput2) < epsilon) initialFilterInput2 = 0.0;\n\t\t\t\tinstrumentState.initialEqFilterInput1 = initialFilterInput1;\n\t\t\t\tinstrumentState.initialEqFilterInput2 = initialFilterInput2;"), l && (t += "\n\t\t\t\t\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(panningDelayLine, panningDelayPos, panningMask);\n\t\t\t\tinstrumentState.panningDelayPos = panningDelayPos;\n\t\t\t\tinstrumentState.panningVolumeL = panningVolumeL;\n\t\t\t\tinstrumentState.panningVolumeR = panningVolumeR;\n\t\t\t\tinstrumentState.panningOffsetL = panningOffsetL;\n\t\t\t\tinstrumentState.panningOffsetR = panningOffsetR;"), c && (t += "\n\t\t\t\t\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(chorusDelayLineL, chorusDelayPos, chorusMask);\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(chorusDelayLineR, chorusDelayPos, chorusMask);\n\t\t\t\tinstrumentState.chorusPhase = chorusPhase;\n\t\t\t\tinstrumentState.chorusDelayPos = chorusDelayPos;\n\t\t\t\tinstrumentState.chorusVoiceMult = chorusVoiceMult;\n\t\t\t\tinstrumentState.chorusCombinedMult = chorusCombinedMult;"), d && (t += "\n\t\t\t\t\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(echoDelayLineL, echoDelayPos, echoMask);\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(echoDelayLineR, echoDelayPos, echoMask);\n\t\t\t\tinstrumentState.echoDelayPos = echoDelayPos;\n\t\t\t\tinstrumentState.echoMult = echoMult;\n\t\t\t\tinstrumentState.echoDelayOffsetRatio = echoDelayOffsetRatio;\n\t\t\t\t\n\t\t\t\tif (!Number.isFinite(echoShelfSampleL) || Math.abs(echoShelfSampleL) < epsilon) echoShelfSampleL = 0.0;\n\t\t\t\tif (!Number.isFinite(echoShelfSampleR) || Math.abs(echoShelfSampleR) < epsilon) echoShelfSampleR = 0.0;\n\t\t\t\tif (!Number.isFinite(echoShelfPrevInputL) || Math.abs(echoShelfPrevInputL) < epsilon) echoShelfPrevInputL = 0.0;\n\t\t\t\tif (!Number.isFinite(echoShelfPrevInputR) || Math.abs(echoShelfPrevInputR) < epsilon) echoShelfPrevInputR = 0.0;\n\t\t\t\tinstrumentState.echoShelfSampleL = echoShelfSampleL;\n\t\t\t\tinstrumentState.echoShelfSampleR = echoShelfSampleR;\n\t\t\t\tinstrumentState.echoShelfPrevInputL = echoShelfPrevInputL;\n\t\t\t\tinstrumentState.echoShelfPrevInputR = echoShelfPrevInputR;"), p && (t += "\n\t\t\t\t\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(reverbDelayLine, reverbDelayPos        , reverbMask);\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(reverbDelayLine, reverbDelayPos +  3041, reverbMask);\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(reverbDelayLine, reverbDelayPos +  6426, reverbMask);\n\t\t\t\tbeepbox.Synth.sanitizeDelayLine(reverbDelayLine, reverbDelayPos + 10907, reverbMask);\n\t\t\t\tinstrumentState.reverbDelayPos = reverbDelayPos;\n\t\t\t\tinstrumentState.reverbMult = reverb;\n\t\t\t\t\n\t\t\t\tif (!Number.isFinite(reverbShelfSample0) || Math.abs(reverbShelfSample0) < epsilon) reverbShelfSample0 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfSample1) || Math.abs(reverbShelfSample1) < epsilon) reverbShelfSample1 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfSample2) || Math.abs(reverbShelfSample2) < epsilon) reverbShelfSample2 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfSample3) || Math.abs(reverbShelfSample3) < epsilon) reverbShelfSample3 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfPrevInput0) || Math.abs(reverbShelfPrevInput0) < epsilon) reverbShelfPrevInput0 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfPrevInput1) || Math.abs(reverbShelfPrevInput1) < epsilon) reverbShelfPrevInput1 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfPrevInput2) || Math.abs(reverbShelfPrevInput2) < epsilon) reverbShelfPrevInput2 = 0.0;\n\t\t\t\tif (!Number.isFinite(reverbShelfPrevInput3) || Math.abs(reverbShelfPrevInput3) < epsilon) reverbShelfPrevInput3 = 0.0;\n\t\t\t\tinstrumentState.reverbShelfSample0 = reverbShelfSample0;\n\t\t\t\tinstrumentState.reverbShelfSample1 = reverbShelfSample1;\n\t\t\t\tinstrumentState.reverbShelfSample2 = reverbShelfSample2;\n\t\t\t\tinstrumentState.reverbShelfSample3 = reverbShelfSample3;\n\t\t\t\tinstrumentState.reverbShelfPrevInput0 = reverbShelfPrevInput0;\n\t\t\t\tinstrumentState.reverbShelfPrevInput1 = reverbShelfPrevInput1;\n\t\t\t\tinstrumentState.reverbShelfPrevInput2 = reverbShelfPrevInput2;\n\t\t\t\tinstrumentState.reverbShelfPrevInput3 = reverbShelfPrevInput3;"), m = new Function("synth", "outputDataL", "outputDataR", "bufferIndex", "runLength", "instrumentState", t), Et.effectsFunctionCache[u] = m } m(t, e, i, s, n, o) } static pulseWidthSynth(t, e, i, s, n) { const o = t.tempMonoInstrumentSampleBuffer; let h = s.phaseDeltas[0]; const a = +s.phaseDeltaScales[0]; let r = +s.expression; const l = +s.expressionDelta; let c = s.phases[0] % 1, d = s.pulseWidth; const p = s.pulseWidthDelta, u = s.noteFilters, m = 0 | s.noteFilterCount; let f = +s.initialNoteFilterInput1, y = +s.initialNoteFilterInput2; const b = Et.applyFilters, g = e + i; for (let t = e; t < g; t++) { const e = c % 1, i = (c + d) % 1; let s = i - e; if (!n.aliases) { if (e < h) s += .5 * ((w = e / h) + w - w * w - 1); else if (e > 1 - h) { s += .5 * ((w = (e - 1) / h) + w + w * w + 1) } if (i < h) s -= .5 * ((w = i / h) + w - w * w - 1); else if (i > 1 - h) { var w; s -= .5 * ((w = (i - 1) / h) + w + w * w + 1) } } const g = s, v = b(g, f, y, m, u); y = f, f = g, c += h, h *= a, d += p; const k = v * r; r += l, o[t] += k } s.phases[0] = c, s.phaseDeltas[0] = h, s.expression = r, s.pulseWidth = d, t.sanitizeFilters(u), s.initialNoteFilterInput1 = f, s.initialNoteFilterInput2 = y } static noiseSynth(t, i, s, n, o) { const h = t.tempMonoInstrumentSampleBuffer, a = o.wave; let r = +n.phaseDeltas[0]; const l = +n.phaseDeltaScales[0]; let c = +n.expression; const d = +n.expressionDelta; let p = n.phases[0] % 1 * e.chipNoiseLength; 0 == n.phases[0] && (p = Math.random() * e.chipNoiseLength); const u = e.chipNoiseLength - 1; let m = +n.noiseSample; const f = n.noteFilters, y = 0 | n.noteFilterCount; let b = +n.initialNoteFilterInput1, g = +n.initialNoteFilterInput2; const w = Et.applyFilters, v = Math.min(1, r * o.noisePitchFilterMult), k = i + s; for (let t = i; t < k; t++) { m += (a[p & u] - m) * v; const e = m, i = w(e, b, g, y, f); g = b, b = e, p += r, r *= l; const s = i * c; c += d, h[t] += s } n.phases[0] = p / e.chipNoiseLength, n.phaseDeltas[0] = r, n.expression = c, n.noiseSample = m, t.sanitizeFilters(f), n.initialNoteFilterInput1 = b, n.initialNoteFilterInput2 = g } static spectrumSynth(t, i, s, n, o) { const h = t.tempMonoInstrumentSampleBuffer, a = o.wave; let r = 128 * n.phaseDeltas[0]; const l = +n.phaseDeltaScales[0]; let c = +n.expression; const d = +n.expressionDelta; let p = +n.noiseSample; const u = n.noteFilters, m = 0 | n.noteFilterCount; let f = +n.initialNoteFilterInput1, y = +n.initialNoteFilterInput2; const b = Et.applyFilters; let g = n.phases[0] % 1 * e.spectrumNoiseLength; 0 == n.phases[0] && (g = Et.findRandomZeroCrossing(a, e.spectrumNoiseLength) + r); const w = e.spectrumNoiseLength - 1, v = Math.min(1, r), k = i + s; for (let t = i; t < k; t++) { const e = 0 | g, i = e & w; let s = a[i]; const n = g - e; s += (a[i + 1] - s) * n, p += (s - p) * v; const o = p, k = b(o, f, y, m, u); y = f, f = o, g += r, r *= l; const x = k * c; c += d, h[t] += x } n.phases[0] = g / e.spectrumNoiseLength, n.phaseDeltas[0] = r / 128, n.expression = c, n.noiseSample = p, t.sanitizeFilters(u), n.initialNoteFilterInput1 = f, n.initialNoteFilterInput2 = y } static drumsetSynth(t, i, s, n, o) { const h = t.tempMonoInstrumentSampleBuffer; let a = o.getDrumsetWave(n.drumsetPitch); const r = Ft.drumsetIndexReferenceDelta(n.drumsetPitch); let l = n.phaseDeltas[0] / r; const c = +n.phaseDeltaScales[0]; let d = +n.expression; const p = +n.expressionDelta, u = n.noteFilters, m = 0 | n.noteFilterCount; let f = +n.initialNoteFilterInput1, y = +n.initialNoteFilterInput2; const b = Et.applyFilters; let g = n.phases[0] % 1 * e.spectrumNoiseLength; 0 == n.phases[0] && (g = Et.findRandomZeroCrossing(a, e.spectrumNoiseLength) + l); const w = e.spectrumNoiseLength - 1, v = i + s; for (let t = i; t < v; t++) { const e = 0 | g, i = e & w; let s = a[i]; const n = g - e; s += (a[i + 1] - s) * n; const o = s, r = b(o, f, y, m, u); y = f, f = o, g += l, l *= c; const v = r * d; d += p, h[t] += v } n.phases[0] = g / e.spectrumNoiseLength, n.phaseDeltas[0] = l * r, n.expression = d, t.sanitizeFilters(u), n.initialNoteFilterInput1 = f, n.initialNoteFilterInput2 = y } static modSynth(t, i, s, n, o) { if (!t.song) return; let h = e.modCount - 1 - n.pitches[0]; if (o.invalidModulators[h]) return; let a = o.modulators[h], r = []; if (e.modulators[o.modulators[h]].forSong) r.push(0); else if (o.modInstruments[h] == t.song.channels[o.modChannels[h]].instruments.length) for (let e = 0; e < t.song.channels[o.modChannels[h]].instruments.length; e++)r.push(e); else o.modInstruments[h] > t.song.channels[o.modChannels[h]].instruments.length ? null != t.song.getPattern(o.modChannels[h], t.bar) && (r = t.song.getPattern(o.modChannels[h], t.bar).instruments) : r.push(o.modInstruments[h]); for (let i = 0; i < r.length; i++)if (t.setModValue(n.expression, n.expression + n.expressionDelta, h, o.modChannels[h], r[i], a), a == e.modulators.dictionary["reset arp"].index && 0 == t.tick && n.noteStartPart == t.beat * e.partsPerBeat + t.part) t.song.channels[o.modChannels[h]].instruments[r[i]].arpTime = 0; else if (a == e.modulators.dictionary["next bar"].index) t.wantToSkip = !0; else if (a == e.modulators.dictionary["eq filter"].index) { const a = t.song.channels[o.modChannels[h]].instruments[r[i]]; if (!a.eqFilterType) { let i = 0 | o.modFilterTypes[h]; if (0 == i) { let i = 0; const o = t.getTicksIntoBar() / e.ticksPerPart; for (; n.note.start + n.note.pins[i].time <= o;)i++; let h = (o - n.note.start + s / (t.getSamplesPerTick() * e.ticksPerPart) * e.ticksPerPart - n.note.pins[i - 1].time) / (n.note.pins[i].time - n.note.pins[i - 1].time); null != a.eqSubFilters[n.note.pins[i - 1].size] || null != a.eqSubFilters[n.note.pins[i].size] ? a.tmpEqFilterEnd = bt.lerpFilters(a.eqSubFilters[n.note.pins[i - 1].size], a.eqSubFilters[n.note.pins[i].size], h) : a.tmpEqFilterEnd = a.eqFilter } else { for (let t = 0; t < e.filterMorphCount; t++)a.tmpEqFilterEnd == a.eqSubFilters[t] && null != a.tmpEqFilterEnd && (a.tmpEqFilterEnd = new bt, a.tmpEqFilterEnd.fromJsonObject(a.eqSubFilters[t].toJsonObject())); null == a.tmpEqFilterEnd && (a.tmpEqFilterEnd = new bt, a.tmpEqFilterEnd.fromJsonObject(a.eqFilter.toJsonObject())), a.tmpEqFilterEnd.controlPointCount > Math.floor((i - 1) / 2) && (i % 2 ? a.tmpEqFilterEnd.controlPoints[Math.floor((i - 1) / 2)].freq = n.expression + n.expressionDelta : a.tmpEqFilterEnd.controlPoints[Math.floor((i - 1) / 2)].gain = n.expression + n.expressionDelta) } } } else if (a == e.modulators.dictionary["note filter"].index) { const a = t.song.channels[o.modChannels[h]].instruments[r[i]]; if (!a.noteFilterType) { let i = 0 | o.modFilterTypes[h]; if (0 == i) { let i = 0; const o = t.getTicksIntoBar() / e.ticksPerPart; for (; n.note.start + n.note.pins[i].time <= o;)i++; let h = (o - n.note.start + s / (t.getSamplesPerTick() * e.ticksPerPart) * e.ticksPerPart - n.note.pins[i - 1].time) / (n.note.pins[i].time - n.note.pins[i - 1].time); null != a.noteSubFilters[n.note.pins[i - 1].size] || null != a.noteSubFilters[n.note.pins[i].size] ? a.tmpNoteFilterEnd = bt.lerpFilters(a.noteSubFilters[n.note.pins[i - 1].size], a.noteSubFilters[n.note.pins[i].size], h) : a.tmpNoteFilterEnd = a.noteFilter } else { for (let t = 0; t < e.filterMorphCount; t++)a.tmpNoteFilterEnd == a.noteSubFilters[t] && null != a.tmpNoteFilterEnd && (a.tmpNoteFilterEnd = new bt, a.tmpNoteFilterEnd.fromJsonObject(a.noteSubFilters[t].toJsonObject())); null == a.tmpNoteFilterEnd && (a.tmpNoteFilterEnd = new bt, a.tmpNoteFilterEnd.fromJsonObject(a.noteFilter.toJsonObject())), a.tmpNoteFilterEnd.controlPointCount > Math.floor((i - 1) / 2) && (i % 2 ? a.tmpNoteFilterEnd.controlPoints[Math.floor((i - 1) / 2)].freq = n.expression + n.expressionDelta : a.tmpNoteFilterEnd.controlPoints[Math.floor((i - 1) / 2)].gain = n.expression + n.expressionDelta) } } } } static findRandomZeroCrossing(t, e) { let i = Math.random() * e; const s = e - 1; let n = i & s, o = t[n]; for (let h = 128; h > 0; h--) { const h = n + 16 & s, a = t[h]; if (o * a <= 0) { for (let h = 0; h < 16; h++) { const h = n + 1 & s, a = t[h]; if (o * a <= 0) { const t = a - o; i = n, Math.abs(t) > 1e-8 && (i += -o / t), i = Math.max(0, i) % e; break } n = h, o = a } break } n = h, o = a } return i } static instrumentVolumeToVolumeMult(t) { return t == -e.volumeRange / 2 ? 0 : Math.pow(2, e.volumeLogScale * t) } static volumeMultToInstrumentVolume(t) { return t <= 0 ? -e.volumeRange / 2 : Math.min(e.volumeRange, Math.log(t) / Math.LN2 / e.volumeLogScale) } static noteSizeToVolumeMult(t) { return Math.pow(Math.max(0, t) / e.noteSizeMax, 1.5) } static volumeMultToNoteSize(t) { return Math.pow(Math.max(0, t), 1 / 1.5) * e.noteSizeMax } static fadeInSettingToSeconds(t) { return .0125 * (.95 * t + .05 * t * t) } static secondsToFadeInSetting(t) { return it(0, e.fadeInRange, Math.round((-.95 + Math.sqrt(.9025 + .2 * t / .0125)) / .1)) } static fadeOutSettingToTicks(t) { return e.fadeOutTicks[t] } static ticksToFadeOutSetting(t) { let i = e.fadeOutTicks[0]; if (t <= i) return 0; for (let s = 1; s < e.fadeOutTicks.length; s++) { let n = e.fadeOutTicks[s]; if (t <= n) return t < (i + n) / 2 ? s - 1 : s; i = n } return e.fadeOutTicks.length - 1 } static detuneToCents(t) { return t - e.detuneCenter } static centsToDetune(t) { return t + e.detuneCenter } static getOperatorWave(t, i) { return 3 != t ? e.operatorWaves[t] : e.pwmOperatorWaves[i] } getSamplesPerTick() { if (null == this.song) return 0; let t = this.song.getBeatsPerMinute(); return this.isModActive(e.modulators.dictionary.tempo.index) && (t = this.getModValue(e.modulators.dictionary.tempo.index)), this.getSamplesPerTickSpecificBPM(t) } getSamplesPerTickSpecificBPM(t) { const i = t / 60, s = e.partsPerBeat * i, n = e.ticksPerPart * s; return this.samplesPerSecond / n } static fittingPowerOfTwo(t) { return 1 << 32 - Math.clz32(Math.ceil(t) - 1) } sanitizeFilters(t) { let e = !1; for (const i of t) { const t = Math.abs(i.output1), s = Math.abs(i.output2); if (!(t < 100 && s < 100)) { e = !0; break } t < et && (i.output1 = 0), s < et && (i.output2 = 0) } if (e) for (const e of t) e.output1 = 0, e.output2 = 0 } static sanitizeDelayLine(t, e, i) { for (; ;) { const s = --e & i, n = Math.abs(t[s]); if (Number.isFinite(n) && (0 == n || n >= et)) break; t[s] = 0 } } static applyFilters(t, e, i, s, n) { for (let o = 0; o < s; o++) { const s = n[o], h = s.output1, a = s.output2, r = s.a1, l = s.a2, c = s.b0, d = s.b1, p = s.b2; t = c * t + d * e + p * i - r * h - l * a, s.a1 = r + s.a1Delta, s.a2 = l + s.a2Delta, s.useMultiplicativeInputCoefficients ? (s.b0 = c * s.b0Delta, s.b1 = d * s.b1Delta, s.b2 = p * s.b2Delta) : (s.b0 = c + s.b0Delta, s.b1 = d + s.b1Delta, s.b2 = p + s.b2Delta), s.output2 = h, s.output1 = t, i = a, e = h } return t } } Et.tempFilterStartCoefficients = new X, Et.tempFilterEndCoefficients = new X, Et.fmSynthFunctionCache = {}, Et.effectsFunctionCache = Array(128).fill(void 0), Et.pickedStringFunctionCache = Array(3).fill(void 0), Et.fmSourceTemplate = ("\n\t\tconst data = synth.tempMonoInstrumentSampleBuffer;\n\t\tconst sineWave = beepbox.Config.sineWave;\n\t\t\t\n\t\t// I'm adding 1000 to the phase to ensure that it's never negative even when modulated by other waves because negative numbers don't work with the modulus operator very well.\n\t\tlet operator#Phase       = +((tone.phases[#] % 1) + 1000) * " + e.sineWaveLength + ";\n\t\tlet operator#PhaseDelta  = +tone.phaseDeltas[#] * " + e.sineWaveLength + ";\n\t\tlet operator#PhaseDeltaScale = +tone.phaseDeltaScales[#];\n\t\tlet operator#OutputMult  = +tone.operatorExpressions[#];\n\t\tconst operator#OutputDelta = +tone.operatorExpressionDeltas[#];\n\t\tlet operator#Output      = +tone.feedbackOutputs[#];\n        const operator#Wave      = tone.operatorWaves[#].samples;\n\t\tlet feedbackMult         = +tone.feedbackMult;\n\t\tconst feedbackDelta        = +tone.feedbackDelta;\n        let expression = +tone.expression;\n\t\tconst expressionDelta = +tone.expressionDelta;\n\t\t\n\t\tconst filters = tone.noteFilters;\n\t\tconst filterCount = tone.noteFilterCount|0;\n\t\tlet initialFilterInput1 = +tone.initialNoteFilterInput1;\n\t\tlet initialFilterInput2 = +tone.initialNoteFilterInput2;\n\t\tconst applyFilters = beepbox.Synth.applyFilters;\n\t\t\n\t\tconst stopIndex = bufferIndex + roundedSamplesPerTick;\n\t\tfor (let sampleIndex = bufferIndex; sampleIndex < stopIndex; sampleIndex++) {\n\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\n\t\t\t\tconst fmOutput = (/*operator#Scaled*/); // CARRIER OUTPUTS\n\t\t\t\t\n\t\t\tconst inputSample = fmOutput;\n\t\t\tconst sample = applyFilters(inputSample, initialFilterInput1, initialFilterInput2, filterCount, filters);\n\t\t\tinitialFilterInput2 = initialFilterInput1;\n\t\t\tinitialFilterInput1 = inputSample;\n\t\t\t\t\n\t\t\t\tfeedbackMult += feedbackDelta;\n\t\t\t\toperator#OutputMult += operator#OutputDelta;\n\t\t\t\toperator#Phase += operator#PhaseDelta;\n\t\t\toperator#PhaseDelta *= operator#PhaseDeltaScale;\n\t\t\t\n\t\t\tconst output = sample * expression;\n\t\t\texpression += expressionDelta;\n\n\t\t\tdata[sampleIndex] += output;\n\t\t\t}\n\t\t\t\n\t\t\ttone.phases[#] = operator#Phase / " + e.sineWaveLength + ";\n\t\t\ttone.phaseDeltas[#] = operator#PhaseDelta / " + e.sineWaveLength + ";\n\t\t\ttone.operatorExpressions[#] = operator#OutputMult;\n\t\t    tone.feedbackOutputs[#] = operator#Output;\n\t\t    tone.feedbackMult = feedbackMult;\n\t\t    tone.expression = expression;\n\t\t\t\n\t\tsynth.sanitizeFilters(filters);\n\t\ttone.initialNoteFilterInput1 = initialFilterInput1;\n\t\ttone.initialNoteFilterInput2 = initialFilterInput2;\n\t\t").split("\n"), Et.operatorSourceTemplate = ("\n\t\t\t\tconst operator#PhaseMix = operator#Phase/* + operator@Scaled*/;\n\t\t\t\tconst operator#PhaseInt = operator#PhaseMix|0;\n\t\t\t\tconst operator#Index    = operator#PhaseInt & " + e.sineWaveMask + ";\n                const operator#Sample   = operator#Wave[operator#Index];\n                operator#Output         = operator#Sample + (operator#Wave[operator#Index + 1] - operator#Sample) * (operator#PhaseMix - operator#PhaseInt);\n\t\t\t\tconst operator#Scaled   = operator#OutputMult * operator#Output;\n\t\t").split("\n"); class Tt { constructor() { this.Tt = !0 } It() { this.Tt = !1 } isNoop() { return this.Tt } commit() { } } class It extends Tt { constructor(t) { super(), this.Pt = t, this.At = !t } undo() { this.Pt ? (this.Lt(), this.At = !0) : (this.qt(), this.At = !1) } redo() { this.Pt ? (this.qt(), this.At = !1) : (this.Lt(), this.At = !0) } Dt() { return this.At } Lt() { throw new Error("Change.doForwards(): Override me.") } qt() { throw new Error("Change.doBackwards(): Override me.") } } class Pt extends Tt { constructor() { super() } append(t) { t.isNoop() || this.It() } } class At extends It { constructor(t) { super(!1), this.Nt = null == t ? [] : t.concat() } append(t) { t.isNoop() || (this.Nt[this.Nt.length] = t, this.It()) } Lt() { for (let t = 0; t < this.Nt.length; t++)this.Nt[t].redo() } qt() { for (let t = this.Nt.length - 1; t >= 0; t--)this.Nt[t].undo() } } function Lt(t, e) { const i = t.every((t => -1 != e.indexOf(t))), s = e.every((e => -1 != t.indexOf(e))); return i && s && e.length == t.length } function qt(t, e, i) { const s = new Set(t); t.length = 0, t.push(...s); for (let s = 0; s < t.length; s++)t[s] >= e.channels[i].instruments.length && (t.splice(s, 1), s--); t.length > e.getMaxInstrumentsPerPattern(i) && (t.length = e.getMaxInstrumentsPerPattern(i)), t.length <= 0 && (t[0] = 0) } function Dt(t, e) { for (const i of t.notes) for (const t of i.pitches) for (const s of i.pins) { const i = (t + s.interval) % 12; e[i] || (e[i] = !0) } } function Nt(t) { for (let e = 1; e < t.length - 1;)t[e - 1].interval == t[e].interval && t[e].interval == t[e + 1].interval && t[e - 1].size == t[e].size && t[e].size == t[e + 1].size ? t.splice(e, 1) : e++ } function zt(t, i, s, n, o) { const h = new lt(-1, s, n, e.noteSizeMax, !1); h.pins.length = 0, h.pitches.length = 0; const a = n - s; for (const e of t.pitches) h.pitches.push(e); for (let e = 0; e < t.pins.length; e++) { const s = t.pins[e], n = s.time + i; if (n < 0) { if (e + 1 >= t.pins.length) throw new Error("Error converting pins in note overflow."); const o = t.pins[e + 1], a = o.time + i; if (a > 0) { const t = -n / (a - n); h.pins.push(rt(Math.round(s.interval + t * (o.interval - s.interval)), 0, Math.round(s.size + t * (o.size - s.size)))) } } else if (n <= a) h.pins.push(rt(s.interval, n, s.size)); else { if (e < 1) throw new Error("Error converting pins in note overflow."); const o = t.pins[e - 1], r = o.time + i; if (r < a) { const t = (a - r) / (n - r); h.pins.push(rt(Math.round(o.interval + t * (s.interval - o.interval)), a, Math.round(o.size + t * (s.size - o.size)))) } } } const r = h.pins[0].interval; for (let t = 0; t < h.pitches.length; t++)h.pitches[t] += r; for (let t = 0; t < h.pins.length; t++)h.pins[t].interval -= r; let l = !1; if (0 == h.start) h.continuesLastPattern = i < 0 || t.continuesLastPattern; else if (h.continuesLastPattern = !1, o.length > 0 && t.continuesLastPattern) { const t = o[o.length - 1]; if (t.end == h.start && Et.adjacentNotesHaveMatchingPitches(t, h)) { l = !0; const e = t.pins[t.pins.length - 1].interval, i = t.end - t.start; for (let s = 1; s < h.pins.length; s++) { const n = h.pins[s], o = rt(n.interval + e, n.time + i, n.size); t.pins.push(o), t.end = t.start + o.time } Nt(t.pins) } } l || o.push(h) } class Bt extends Pt { constructor(t, i, s) { super(); const n = [], o = [], h = []; for (let a = 0; a < t.song.getChannelCount(); a++) { const r = t.song.channels[a], l = new vt; a < t.song.pitchChannelCount ? n.push(l) : a < t.song.pitchChannelCount + t.song.noiseChannelCount ? o.push(l) : h.push(l), l.muted = r.muted, l.octave = r.octave, l.name = r.name; for (const t of r.instruments) l.instruments.push(t); const c = e.partsPerBeat * t.song.beatsPerBar, d = e.partsPerBeat * i; let p = -1, u = null; for (let e = 0; e < t.song.barCount; e++) { const i = t.song.getPattern(a, e); if (null != i) { const t = e * c; for (const e of i.notes) { const n = e.start + t + s, o = e.end + t + s, h = Math.floor(n / d), a = Math.ceil(o / d); for (let t = h; t < a; t++) { const s = t * d, h = Math.max(0, n - s), a = Math.min(d, o - s); if (h < a) { if (p < t || null == u) { for (p++; p < t;)l.bars[p] = 0, p++; u = new ct, l.patterns.push(u), l.bars[p] = l.patterns.length, u.instruments.length = 0, u.instruments.push(...i.instruments) } u = l.patterns[l.bars[t] - 1], zt(e, n - s - h, h, a, u.notes) } } } } } } bi(n), bi(o), bi(h), this.append(new fi(t, n, o, h)) } } class Rt extends It { constructor(t, e) { super(!1), this.l = t, this.zt = e, this.Bt = this.zt.start, this.Rt = this.zt.end, this.Ot = this.zt.start, this.$t = this.zt.end, this.Ht = this.zt.pins, this.Vt = [], this.Gt = this.zt.pitches, this._t = [], this.jt = this.zt.continuesLastPattern, this.Ut = this.zt.continuesLastPattern } Wt(t) { for (let t = 0; t < this.Vt.length - 1;)this.Vt[t].time >= this.Vt[t + 1].time ? this.Vt.splice(t, 1) : t++; Nt(this.Vt); const e = this.Vt[0].interval, i = this.Vt[0].time; for (let t = 0; t < this.Gt.length; t++)this._t[t] = this.Gt[t] + e; for (let t = 0; t < this.Vt.length; t++)this.Vt[t].interval -= e, this.Vt[t].time -= i; this.Ot = this.Bt + i, this.$t = this.Ot + this.Vt[this.Vt.length - 1].time, null != t && (this.Ut = t), 0 != this.Ot && (this.Ut = !1), this.Lt(), this.It() } Lt() { this.zt.pins = this.Vt, this.zt.pitches = this._t, this.zt.start = this.Ot, this.zt.end = this.$t, this.zt.continuesLastPattern = this.Ut, null != this.l && this.l.notifier.changed() } qt() { this.zt.pins = this.Ht, this.zt.pitches = this.Gt, this.zt.start = this.Bt, this.zt.end = this.Rt, this.zt.continuesLastPattern = this.jt, null != this.l && this.l.notifier.changed() } } class Ot extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()].customChipWave; var s = !0; for (let t = 0; t < i.length; t++)i[t] != e[t] && (s = !1, t = i.length); if (0 == s) { let i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; for (let t = 0; t < e.length; t++)i.customChipWave[t] = e[t]; let s = 0; for (let t = 0; t < i.customChipWave.length; t++)s += i.customChipWave[t]; const n = s / i.customChipWave.length; let o = 0, h = 0; for (let t = 0; t < i.customChipWave.length; t++)o += h, h = i.customChipWave[t] - n, i.customChipWaveIntegral[t] = o; i.customChipWaveIntegral[64] = 0, i.preset = i.type, t.notifier.changed(), this.It() } } } class $t extends Tt { constructor(t, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; if (s.preset != i) { const n = F.valueToPreset(i); if (null != n) if (null != n.customType) s.type = n.customType, !e.instrumentTypeHasSpecialInterval[s.type] && e.chords[s.chord].customInterval && (s.chord = 0), s.clearInvalidEnvelopeTargets(); else if (null != n.settings) { const e = s.volume, i = s.pan, o = s.panDelay; s.fromJsonObject(n.settings, t.song.getChannelIsNoise(t.channel), t.song.getChannelIsMod(t.channel), 0 == t.song.rhythm || 2 == t.song.rhythm, t.song.rhythm >= 2), s.volume = e, s.pan = i, s.panDelay = o, s.effects = 4 | s.effects } s.preset = i, t.notifier.changed(), this.It() } } } class Ht extends Tt { constructor(t) { function i(t) { let e = 0; for (const i of t) e += i.weight; let i = Math.random() * e; for (const e of t) if (i -= e.weight, i <= 0) return e.item; return t[Math.random() * t.length | 0].item } function s(t, e, s, n) { const o = []; for (let i = t; i <= e; i++)o.push({ item: i, weight: 1 / (Math.pow((i - s) / n, 2) + 1) }); return i(o) } super(); class n { constructor(t, e, i, s, n, o) { this.chance = t, this.type = e, this.minFreq = i, this.maxFreq = s, this.centerHz = n, this.centerGain = o } } function o(t, i) { t.reset(); const n = []; for (const o of i) { if (Math.random() > o.chance) continue; const i = new yt; i.type = o.type, i.freq = s(o.minFreq, o.maxFreq, yt.getRoundedSettingValueFromHz(o.centerHz), 1 / e.filterFreqStep), i.gain = s(0, e.filterGainRange - 1, e.filterGainCenter + o.centerGain, 2 / e.filterGainStep), 2 == i.type && i.gain == e.filterGainCenter || (n.includes(i.freq) || (n.push(i.freq), t.controlPoints[t.controlPointCount] = i, t.controlPointCount++)) } } const h = t.song.getChannelIsNoise(t.channel), a = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; a.effects &= 4, a.envelopeCount = 0; const r = yt.getRoundedSettingValueFromHz(700), l = e.filterFreqRange - 1; if (o(a.eqFilter, [new n(.8, 0, r, l, 4e3, -1), new n(.4, 1, 0, r - 1, 250, -1), new n(.5, 2, 0, l, 2e3, 0), new n(.4, 2, 0, l, 1400, 0), new n(.3, 2, 0, l, 1e3, 0), new n(.2, 2, 0, l, 500, 0)]), h) { const t = i([{ item: 2, weight: 1 }, { item: 3, weight: 3 }]); function c(t) { let i = 0; for (const e of t) e > i && (i = e); for (let s = 0; s < t.length; s++)t[s] = e.harmonicsMax * t[s] / i } switch (a.preset = a.type = t, a.fadeIn = Math.random() < .8 ? 0 : s(0, e.fadeInRange - 1, 0, 2), a.fadeOut = s(0, e.fadeOutTicks.length - 1, e.fadeOutNeutral, 2), Math.random() < .1 && (a.effects |= 1024, a.transition = e.transitions.dictionary[i([{ item: "normal", weight: 30 }, { item: "interrupt", weight: 1 }, { item: "slide", weight: 2 }])].index), Math.random() < .2 && (a.effects |= 2048, a.chord = e.chords.dictionary[i([{ item: "strum", weight: 2 }, { item: "arpeggio", weight: 1 }])].index), Math.random() < .1 && (a.pitchShift = s(0, e.pitchShiftRange - 1, e.pitchShiftCenter, 2), a.pitchShift != e.pitchShiftCenter && (a.effects |= 128, a.addEnvelope(e.instrumentAutomationTargets.dictionary.pitchShift.index, 0, e.envelopes.dictionary[i([{ item: "flare 1", weight: 2 }, { item: "flare 2", weight: 1 }, { item: "flare 3", weight: 1 }, { item: "twang 1", weight: 16 }, { item: "twang 2", weight: 8 }, { item: "twang 3", weight: 4 }, { item: "tremolo1", weight: 1 }, { item: "tremolo2", weight: 1 }, { item: "tremolo3", weight: 1 }, { item: "decay 1", weight: 4 }, { item: "decay 2", weight: 2 }, { item: "decay 3", weight: 1 }])].index))), Math.random() < .1 && (a.effects |= 512, a.vibrato = s(0, e.echoSustainRange - 1, e.echoSustainRange >> 1, 2), a.vibrato = e.vibratos.dictionary[i([{ item: "light", weight: 2 }, { item: "delayed", weight: 2 }, { item: "heavy", weight: 1 }, { item: "shaky", weight: 2 }])].index), Math.random() < .8 && (a.effects |= 32, o(a.noteFilter, [new n(1, 0, r, l, 8e3, -1)]), a.addEnvelope(e.instrumentAutomationTargets.dictionary.noteFilterAllFreqs.index, 0, e.envelopes.dictionary[i([{ item: "punch", weight: 4 }, { item: "flare 1", weight: 2 }, { item: "flare 2", weight: 2 }, { item: "flare 3", weight: 2 }, { item: "twang 1", weight: 8 }, { item: "twang 2", weight: 8 }, { item: "twang 3", weight: 8 }, { item: "swell 1", weight: 2 }, { item: "swell 2", weight: 2 }, { item: "swell 3", weight: 1 }, { item: "tremolo1", weight: 1 }, { item: "tremolo2", weight: 1 }, { item: "tremolo3", weight: 1 }, { item: "tremolo4", weight: 1 }, { item: "tremolo5", weight: 1 }, { item: "tremolo6", weight: 1 }, { item: "decay 1", weight: 4 }, { item: "decay 2", weight: 4 }, { item: "decay 3", weight: 4 }])].index)), Math.random() < .1 && (a.effects |= 8, a.distortion = s(1, e.distortionRange - 1, e.distortionRange - 1, 2)), Math.random() < .1 && (a.effects |= 16, a.bitcrusherFreq = s(0, e.bitcrusherFreqRange - 1, e.bitcrusherFreqRange >> 1, 2), a.bitcrusherQuantization = s(0, e.bitcrusherQuantizationRange - 1, e.bitcrusherQuantizationRange >> 1, 2)), Math.random() < .1 && (a.effects |= 2, a.chorus = s(1, e.chorusRange - 1, e.chorusRange - 1, 1)), Math.random() < .1 && (a.echoSustain = s(0, e.echoSustainRange - 1, e.echoSustainRange >> 1, 2), a.echoDelay = s(0, e.echoDelayRange - 1, e.echoDelayRange >> 1, 2), 0 == a.echoSustain && 0 == a.echoDelay || (a.effects |= 64)), Math.random() < .5 && (a.effects |= 1, a.reverb = s(1, e.reverbRange - 1, 1, 1)), t) { case 2: a.chipNoise = Math.random() * e.chipNoises.length | 0; break; case 3: { const t = [() => { const t = []; for (let i = 0; i < e.spectrumControlPoints; i++)t[i] = Math.random() < .5 ? Math.random() : 0; return t }, () => { let t = 1; const i = [t]; for (let s = 1; s < e.spectrumControlPoints; s++)t *= Math.pow(2, Math.random() - .52), i[s] = t; return i }, () => { let t = 1; const i = [t]; for (let s = 1; s < e.spectrumControlPoints; s++)t *= Math.pow(2, Math.random() - .52), i[s] = t * Math.random(); return i }], i = (0, t[Math.random() * t.length | 0])(); c(i); for (let t = 0; t < e.spectrumControlPoints; t++)a.spectrumWave.spectrum[t] = Math.round(i[t]); a.spectrumWave.markCustomWaveDirty() } break; default: throw new Error("Unhandled noise instrument type in random generator.") } } else { const t = i([{ item: 0, weight: 4 }, { item: 6, weight: 4 }, { item: 5, weight: 5 }, { item: 7, weight: 5 }, { item: 3, weight: 1 }, { item: 1, weight: 5 }]); function c(t) { let i = 0; for (const e of t) e > i && (i = e); for (let s = 0; s < t.length; s++)t[s] = e.harmonicsMax * t[s] / i } switch (a.preset = a.type = t, a.fadeIn = Math.random() < .5 ? 0 : s(0, e.fadeInRange - 1, 0, 2), a.fadeOut = s(0, e.fadeOutTicks.length - 1, e.fadeOutNeutral, 2), 0 != t && 5 != t && 7 != t || (a.unison = e.unisons.dictionary[i([{ item: "none", weight: 10 }, { item: "shimmer", weight: 5 }, { item: "hum", weight: 4 }, { item: "honky tonk", weight: 3 }, { item: "dissonant", weight: 1 }, { item: "fifth", weight: 1 }, { item: "octave", weight: 2 }, { item: "bowed", weight: 2 }, { item: "piano", weight: 5 }, { item: "warbled", weight: 3 }])].index), Math.random() < .1 && (a.effects |= 1024, a.transition = e.transitions.dictionary[i([{ item: "interrupt", weight: 1 }, { item: "slide", weight: 2 }])].index), Math.random() < .2 && (a.effects |= 2048, a.chord = e.chords.dictionary[i([{ item: "strum", weight: 2 }, { item: "arpeggio", weight: 1 }])].index), Math.random() < .05 && (a.pitchShift = s(0, e.pitchShiftRange - 1, e.pitchShiftCenter, 1), a.pitchShift != e.pitchShiftCenter && (a.effects |= 128, a.addEnvelope(e.instrumentAutomationTargets.dictionary.pitchShift.index, 0, e.envelopes.dictionary[i([{ item: "flare 1", weight: 2 }, { item: "flare 2", weight: 1 }, { item: "flare 3", weight: 1 }, { item: "twang 1", weight: 16 }, { item: "twang 2", weight: 8 }, { item: "twang 3", weight: 4 }, { item: "decay 1", weight: 4 }, { item: "decay 2", weight: 2 }, { item: "decay 3", weight: 1 }])].index))), Math.random() < .25 && (a.effects |= 512, a.vibrato = s(0, e.echoSustainRange - 1, e.echoSustainRange >> 1, 2), a.vibrato = e.vibratos.dictionary[i([{ item: "light", weight: 2 }, { item: "delayed", weight: 2 }, { item: "heavy", weight: 1 }, { item: "shaky", weight: 2 }])].index), Math.random() < .1 && (a.effects |= 8, a.distortion = s(1, e.distortionRange - 1, e.distortionRange - 1, 2)), b(a.effects) && Math.random() < .8 ? (a.effects |= 32, o(a.noteFilter, [new n(1, 0, r, l, 2e3, -1), new n(.9, 1, 0, r - 1, 500, -1), new n(.4, 2, 0, l, 1400, 0)])) : Math.random() < .5 && (a.effects |= 32, o(a.noteFilter, [new n(1, 0, r, l, 8e3, -1)]), a.addEnvelope(e.instrumentAutomationTargets.dictionary.noteFilterAllFreqs.index, 0, e.envelopes.dictionary[i([{ item: "punch", weight: 6 }, { item: "flare 1", weight: 2 }, { item: "flare 2", weight: 4 }, { item: "flare 3", weight: 2 }, { item: "twang 1", weight: 2 }, { item: "twang 2", weight: 4 }, { item: "twang 3", weight: 4 }, { item: "swell 1", weight: 4 }, { item: "swell 2", weight: 2 }, { item: "swell 3", weight: 1 }, { item: "tremolo1", weight: 1 }, { item: "tremolo2", weight: 1 }, { item: "tremolo3", weight: 1 }, { item: "tremolo4", weight: 1 }, { item: "tremolo5", weight: 1 }, { item: "tremolo6", weight: 1 }, { item: "decay 1", weight: 1 }, { item: "decay 2", weight: 2 }, { item: "decay 3", weight: 2 }])].index)), Math.random() < .1 && (a.effects |= 16, a.bitcrusherFreq = s(0, e.bitcrusherFreqRange - 1, 0, 2), a.bitcrusherQuantization = s(0, e.bitcrusherQuantizationRange - 1, e.bitcrusherQuantizationRange >> 1, 2)), Math.random() < .1 && (a.effects |= 2, a.chorus = s(1, e.chorusRange - 1, e.chorusRange - 1, 1)), Math.random() < .1 && (a.echoSustain = s(0, e.echoSustainRange - 1, e.echoSustainRange >> 1, 2), a.echoDelay = s(0, e.echoDelayRange - 1, e.echoDelayRange >> 1, 2), 0 == a.echoSustain && 0 == a.echoDelay || (a.effects |= 64)), Math.random() < .5 && (a.effects |= 1, a.reverb = s(1, e.reverbRange - 1, 1, 1)), t) { case 0: a.chipWave = Math.random() * e.chipWaves.length | 0; break; case 6: a.pulseWidth = s(0, e.pulseWidthRange - 1, e.pulseWidthRange - 1, 2), Math.random() < .6 && a.addEnvelope(e.instrumentAutomationTargets.dictionary.pulseWidth.index, 0, e.envelopes.dictionary[i([{ item: "punch", weight: 6 }, { item: "flare 1", weight: 2 }, { item: "flare 2", weight: 4 }, { item: "flare 3", weight: 2 }, { item: "twang 1", weight: 2 }, { item: "twang 2", weight: 4 }, { item: "twang 3", weight: 4 }, { item: "swell 1", weight: 4 }, { item: "swell 2", weight: 2 }, { item: "swell 3", weight: 1 }, { item: "tremolo1", weight: 1 }, { item: "tremolo2", weight: 1 }, { item: "tremolo3", weight: 1 }, { item: "tremolo4", weight: 1 }, { item: "tremolo5", weight: 1 }, { item: "tremolo6", weight: 1 }, { item: "decay 1", weight: 1 }, { item: "decay 2", weight: 2 }, { item: "decay 3", weight: 2 }])].index); break; case 7: case 5: { 7 == t && (a.stringSustain = Math.random() * e.stringSustainRange | 0); const i = [() => { const t = []; for (let i = 0; i < e.harmonicsControlPoints; i++)t[i] = Math.random() < .4 ? Math.random() : 0; return t[8 * Math.random() | 0] = Math.pow(Math.random(), .25), t }, () => { let t = 1; const i = [t]; for (let s = 1; s < e.harmonicsControlPoints; s++)t *= Math.pow(2, Math.random() - .55), i[s] = t; return i }, () => { let t = 1; const i = [t]; for (let s = 1; s < e.harmonicsControlPoints; s++)t *= Math.pow(2, Math.random() - .55), i[s] = t * Math.random(); return i }], s = (0, i[Math.random() * i.length | 0])(); c(s); for (let t = 0; t < e.harmonicsControlPoints; t++)a.harmonicsWave.harmonics[t] = Math.round(s[t]); a.harmonicsWave.markCustomWaveDirty() } break; case 3: { const t = []; for (let i = 0; i < e.spectrumControlPoints; i++) { const e = 0 == i || 7 == i || 11 == i || 14 == i || 16 == i || 18 == i || 21 == i; t[i] = e ? Math.pow(Math.random(), .25) : .5 * Math.pow(Math.random(), 3) } c(t); for (let i = 0; i < e.spectrumControlPoints; i++)a.spectrumWave.spectrum[i] = Math.round(t[i]); a.spectrumWave.markCustomWaveDirty() } break; case 1: { a.algorithm = Math.random() * e.algorithms.length | 0, a.feedbackType = Math.random() * e.feedbacks.length | 0; const t = e.algorithms[a.algorithm]; for (let n = 0; n < t.carrierCount; n++)a.operators[n].frequency = s(0, e.operatorFrequencies.length - 1, 0, 3), a.operators[n].amplitude = s(0, e.operatorAmplitudeMax, e.operatorAmplitudeMax - 1, 2), a.operators[n].waveform = e.operatorWaves.dictionary[i([{ item: "sine", weight: 10 }, { item: "triangle", weight: 6 }, { item: "sawtooth", weight: 3 }, { item: "pulse width", weight: 6 }, { item: "ramp", weight: 3 }, { item: "trapezoid", weight: 4 }])].index, 3 == a.operators[n].waveform && (a.operators[n].pulseWidth = i([{ item: 0, weight: 3 }, { item: 1, weight: 5 }, { item: 2, weight: 7 }, { item: 3, weight: 10 }, { item: 4, weight: 15 }, { item: 5, weight: 25 }, { item: 6, weight: 15 }, { item: 7, weight: 10 }, { item: 8, weight: 7 }, { item: 9, weight: 5 }, { item: 9, weight: 3 }])); for (let n = t.carrierCount; n < e.operatorCount; n++)a.operators[n].frequency = s(3, e.operatorFrequencies.length - 1, 0, 3), a.operators[n].amplitude = Math.pow(Math.random(), 2) * e.operatorAmplitudeMax | 0, a.envelopeCount < e.maxEnvelopeCount && Math.random() < .4 && (a.addEnvelope(e.instrumentAutomationTargets.dictionary.operatorAmplitude.index, n, e.envelopes.dictionary[i([{ item: "punch", weight: 2 }, { item: "flare 1", weight: 2 }, { item: "flare 2", weight: 2 }, { item: "flare 3", weight: 2 }, { item: "twang 1", weight: 2 }, { item: "twang 2", weight: 2 }, { item: "twang 3", weight: 2 }, { item: "swell 1", weight: 2 }, { item: "swell 2", weight: 2 }, { item: "swell 3", weight: 2 }, { item: "tremolo1", weight: 1 }, { item: "tremolo2", weight: 1 }, { item: "tremolo3", weight: 1 }, { item: "tremolo4", weight: 1 }, { item: "tremolo5", weight: 1 }, { item: "tremolo6", weight: 1 }, { item: "decay 1", weight: 1 }, { item: "decay 2", weight: 1 }, { item: "decay 3", weight: 1 }])].index), a.operators[n].waveform = e.operatorWaves.dictionary[i([{ item: "sine", weight: 10 }, { item: "triangle", weight: 6 }, { item: "sawtooth", weight: 3 }, { item: "pulse width", weight: 6 }, { item: "ramp", weight: 3 }, { item: "trapezoid", weight: 4 }])].index, 3 == a.operators[n].waveform && (a.operators[n].pulseWidth = i([{ item: 0, weight: 3 }, { item: 1, weight: 5 }, { item: 2, weight: 7 }, { item: 3, weight: 10 }, { item: 4, weight: 15 }, { item: 5, weight: 25 }, { item: 6, weight: 15 }, { item: 7, weight: 10 }, { item: 8, weight: 7 }, { item: 9, weight: 5 }, { item: 9, weight: 3 }]))), a.envelopeCount < e.maxEnvelopeCount && Math.random() < .05 && a.addEnvelope(e.instrumentAutomationTargets.dictionary.operatorFrequency.index, n, e.envelopes.dictionary[i([{ item: "punch", weight: 4 }, { item: "flare 1", weight: 4 }, { item: "flare 2", weight: 2 }, { item: "flare 3", weight: 1 }, { item: "twang 1", weight: 16 }, { item: "twang 2", weight: 2 }, { item: "twang 3", weight: 1 }, { item: "swell 1", weight: 4 }, { item: "swell 2", weight: 2 }, { item: "swell 3", weight: 1 }, { item: "decay 1", weight: 2 }, { item: "decay 2", weight: 1 }, { item: "decay 3", weight: 1 }])].index); a.feedbackAmplitude = Math.pow(Math.random(), 3) * e.operatorAmplitudeMax | 0, a.envelopeCount < e.maxEnvelopeCount && Math.random() < .4 && a.addEnvelope(e.instrumentAutomationTargets.dictionary.feedbackAmplitude.index, 0, e.envelopes.dictionary[i([{ item: "punch", weight: 2 }, { item: "flare 1", weight: 2 }, { item: "flare 2", weight: 2 }, { item: "flare 3", weight: 2 }, { item: "twang 1", weight: 2 }, { item: "twang 2", weight: 2 }, { item: "twang 3", weight: 2 }, { item: "swell 1", weight: 2 }, { item: "swell 2", weight: 2 }, { item: "swell 3", weight: 2 }, { item: "tremolo1", weight: 1 }, { item: "tremolo2", weight: 1 }, { item: "tremolo3", weight: 1 }, { item: "tremolo4", weight: 1 }, { item: "tremolo5", weight: 1 }, { item: "tremolo6", weight: 1 }, { item: "decay 1", weight: 1 }, { item: "decay 2", weight: 1 }, { item: "decay 3", weight: 1 }])].index) } break; default: throw new Error("Unhandled pitched instrument type in random generator.") } } t.notifier.changed(), this.It() } } class Vt extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.transition != e && (this.It(), i.transition = e, i.preset = i.type, t.notifier.changed()) } } class Gt extends Tt { constructor(t, e, i) { super(); let s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; null != i && (s = i); const n = s.effects, o = 0 != (n & 1 << e), h = o ? n & ~(1 << e) : n | 1 << e; s.effects = h, 2 != e && (s.preset = s.type), o && s.clearInvalidEnvelopeTargets(), this.It(), t.notifier.changed() } } class _t extends Tt { constructor(t, e, i, s, n, o) { if (super(), e > t.song.patternsPerChannel) throw new Error("invalid pattern"); for (let h = i; h < i + n; h++)for (let i = s; i < s + o; i++)t.song.channels[i].bars[h] != e && (t.song.channels[i].bars[h] = e, this.It()); if (s >= t.song.pitchChannelCount + t.song.noiseChannelCount) { const e = t.getCurrentPattern(); t.viewedInstrument[s] = null != e ? e.instruments[0] : 0 } t.notifier.changed() } } class jt extends Tt { constructor(t, e, i) { if (super(), t.song.barCount != e) { for (const s of t.song.channels) if (i) { for (; s.bars.length < e;)s.bars.unshift(0); t.song.barCount > e && s.bars.splice(0, t.song.barCount - e) } else { for (; s.bars.length < e;)s.bars.push(0); s.bars.length = e } if (i) { const i = e - t.song.barCount; t.bar = Math.max(0, t.bar + i), (i < 0 || t.barScrollPos > 0) && (t.barScrollPos = Math.max(0, t.barScrollPos + i)), t.song.loopStart = Math.max(0, t.song.loopStart + i) } t.bar = Math.min(t.bar, e - 1), t.song.loopLength = Math.min(e, t.song.loopLength), t.song.loopStart = Math.min(e - t.song.loopLength, t.song.loopStart), t.song.barCount = e, t.notifier.changed(), this.It() } } } class Ut extends Tt { constructor(t, i, s) { super(); const n = Math.min(e.barCountMax, t.song.barCount + s); if (0 != (s = n - t.song.barCount)) { for (const e of t.song.channels) for (; e.bars.length < n;)e.bars.splice(i, 0, 0); t.song.barCount = n, t.bar += s, t.barScrollPos += s, t.song.loopStart >= i ? t.song.loopStart += s : t.song.loopStart + t.song.loopLength >= i && (t.song.loopLength += s), t.notifier.changed(), this.It() } } } class Wt extends Tt { constructor(t, e, i) { super(); for (const s of t.song.channels) s.bars.splice(e, i), 0 == s.bars.length && s.bars.push(0); t.song.barCount = Math.max(1, t.song.barCount - i), t.bar = Math.max(0, t.bar - i), t.barScrollPos = Math.max(0, t.barScrollPos - i), t.song.loopStart >= e ? t.song.loopStart = Math.max(0, t.song.loopStart - i) : t.song.loopStart + t.song.loopLength > e && (t.song.loopLength -= i), t.song.loopLength = Math.max(1, Math.min(t.song.barCount - t.song.loopStart, t.song.loopLength)), t.notifier.changed(), this.It() } } class Kt extends Tt { constructor(t, e, i, s, n, o, h, a) { super(), t.song.limitRatio = e, t.song.compressionRatio = i, t.song.limitThreshold = s, t.song.compressionThreshold = n, t.song.limitRise = o, t.song.limitDecay = h, t.song.masterGain = a, t.notifier.changed(), this.It() } } class Jt extends Tt { constructor(t, i, s, n) { super(), t.song.channels.splice(i + n, 0, ...t.song.channels.splice(i, s - i + 1)), s = Math.max(s, i); for (let o = t.song.pitchChannelCount + t.song.noiseChannelCount; o < t.song.getChannelCount(); o++)for (let h = 0; h < t.song.channels[o].instruments.length; h++) { let a = t.song.channels[o].instruments[h]; for (let t = 0; t < e.modCount; t++)a.modChannels[t] >= i && a.modChannels[t] <= s ? a.modChannels[t] += n : a.modChannels[t] >= i + n && a.modChannels[t] <= s + n && (a.modChannels[t] -= n * (s - i + 1)) } t.notifier.changed(), this.It() } } class Yt extends Tt { constructor(t, i, s, n) { if (super(), t.song.pitchChannelCount != i || t.song.noiseChannelCount != s || t.song.modChannelCount != n) { const h = []; function o(i, s, n, o, a, r, l) { for (let c = 0; c < i; c++) { const i = c + n, d = c + o; if (c < s) h[i] = t.song.channels[d]; else { h[i] = new vt, h[i].octave = a; for (let s = 0; s < e.instrumentCountMin; s++) { const e = new wt(r, l); if (!l) { const i = di(r), s = F.valueToPreset(i); e.fromJsonObject(s.settings, r, l, 0 == t.song.rhythm || 2 == t.song.rhythm, t.song.rhythm >= 2), e.preset = i } h[i].instruments[s] = e } for (let e = 0; e < t.song.patternsPerChannel; e++)h[i].patterns[e] = new ct; for (let e = 0; e < t.song.barCount; e++)h[i].bars[e] = 0 } } } o(i, t.song.pitchChannelCount, 0, 0, 3, !1, !1), o(s, t.song.noiseChannelCount, i, t.song.pitchChannelCount, 0, !0, !1), o(n, t.song.modChannelCount, s + i, t.song.pitchChannelCount + t.song.noiseChannelCount, 0, !1, !0); let a = t.song.pitchChannelCount; t.song.pitchChannelCount = i, t.song.noiseChannelCount = s, t.song.modChannelCount = n; for (let e = 0; e < t.song.getChannelCount(); e++)t.song.channels[e] = h[e]; t.song.channels.length = t.song.getChannelCount(), t.channel = Math.min(t.channel, i + s + n - 1); for (let s = t.song.pitchChannelCount + t.song.noiseChannelCount; s < t.song.getChannelCount(); s++)for (let n = 0; n < t.song.channels[s].instruments.length; n++)for (let o = 0; o < e.modCount; o++) { let h = t.song.channels[s].instruments[n], r = h.modChannels[o]; (r >= t.song.pitchChannelCount && r < a || r >= t.song.pitchChannelCount + t.song.noiseChannelCount) && (h.modulators[o] = e.modulators.dictionary.none.index), r >= a && a < i && (h.modChannels[o] += i - a) } t.notifier.changed(), j.resetColors(), this.It() } } } class Qt extends Pt { constructor(t, i, s, n) { super(); const o = t.song.pitchChannelCount + (s || n ? 0 : 1), h = t.song.noiseChannelCount + (!s || n ? 0 : 1), a = t.song.modChannelCount + (s || !n ? 0 : 1); if (o <= e.pitchChannelCountMax && h <= e.noiseChannelCountMax && a <= e.modChannelCountMax) { const e = s ? t.song.pitchChannelCount + t.song.noiseChannelCount : t.song.pitchChannelCount; this.append(new Yt(t, o, h, a)), e - 1 >= i && this.append(new Jt(t, i, e - 1, 1)), t.synth.computeLatestModValues(), t.recalcChannelNames = !0 } } } class Xt extends Pt { constructor(t, i, s) { super(); const n = s; for (let s = t.song.pitchChannelCount + t.song.noiseChannelCount; s < t.song.channels.length; s++)for (let o = 0; o < t.song.channels[s].instruments.length; o++) { const h = t.song.channels[s].instruments[o]; for (let s = 0; s < e.modCount; s++)h.modChannels[s] >= i && h.modChannels[s] <= n ? this.append(new Qe(t, s, 0, h)) : h.modChannels[s] > n && this.append(new Qe(t, s, h.modChannels[s] - (n - i + 1) + 2, h)) } for (; s >= i;) { const e = t.song.getChannelIsNoise(s), i = t.song.getChannelIsMod(s); t.song.channels.splice(s, 1), e ? t.song.noiseChannelCount-- : i ? t.song.modChannelCount-- : t.song.pitchChannelCount--, s-- } t.song.pitchChannelCount < e.pitchChannelCountMin && this.append(new Yt(t, e.pitchChannelCountMin, t.song.noiseChannelCount, t.song.modChannelCount)), j.resetColors(), t.recalcChannelNames = !0, this.append(new Zt(t, Math.max(0, i - 1), t.bar)), t.synth.computeLatestModValues(), this.It(), t.notifier.changed() } } class Zt extends Tt { constructor(t, e, i, s = !1) { super(); const n = t.channel, o = t.bar; if (t.channel = e, t.bar = i, s || t.selection.scrollToSelectedPattern(), t.song.getChannelIsMod(t.channel)) { const e = t.song.getPattern(t.channel, t.bar); null != e && (t.viewedInstrument[t.channel] = e.instruments[0]) } t.notifier.changed(), n == e && o == i || this.It() } } class te extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.unison != e && (this.It(), i.unison = e, i.preset = i.type, t.notifier.changed()) } } class ee extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.chord != e && (this.It(), i.chord = e, i.preset = i.type, t.notifier.changed()) } } class ie extends Tt { constructor(t, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; s.vibrato != i && (s.vibrato = i, s.vibratoDepth = e.vibratos[s.vibrato].amplitude, s.vibratoDelay = e.vibratos[s.vibrato].delayTicks / 2, s.vibratoSpeed = 10, s.vibratoType = e.vibratos[s.vibrato].type, s.preset = s.type, t.notifier.changed(), this.It()) } } class se extends Tt { constructor(t, i, s) { super(); const n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; let o = n.vibrato; t.synth.unsetMod(e.modulators.dictionary["vibrato depth"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i == s && o == e.vibratos.length || (n.vibratoDepth = s / 25, n.vibrato = e.vibratos.length, t.notifier.changed(), this.It()) } } class ne extends Tt { constructor(t, i, s) { super(); const n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; let o = n.vibrato; t.synth.unsetMod(e.modulators.dictionary["vibrato speed"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i == s && o == e.vibratos.length || (n.vibratoSpeed = s, n.vibrato = e.vibratos.length, t.notifier.changed(), this.It()) } } class oe extends Tt { constructor(t, i, s) { super(); const n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; let o = n.vibrato; t.synth.unsetMod(e.modulators.dictionary["vibrato delay"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i == s && o == e.vibratos.length || (n.vibratoDelay = s, n.vibrato = e.vibratos.length, t.notifier.changed(), this.It()) } } class he extends Tt { constructor(t, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()], n = s.vibratoType; let o = s.vibrato; t.notifier.changed(), n == i && o == e.vibratos.length || (s.vibratoType = i, s.vibrato = e.vibratos.length, t.notifier.changed(), this.It()) } } class ae extends Tt { constructor(t, i, s) { super(); t.song.channels[t.channel].instruments[t.getCurrentInstrument()].arpeggioSpeed = s, t.synth.unsetMod(e.modulators.dictionary["arp speed"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class re extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()], s = i.fastTwoNoteArp; t.notifier.changed(), s != e && (i.fastTwoNoteArp = e, this.It()) } } class le extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()], s = i.clicklessTransition; t.notifier.changed(), s != e && (i.clicklessTransition = e, this.It()) } } class ce extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()], s = i.aliases; t.notifier.changed(), s != e && (i.aliases = e, this.It()) } } class de extends Tt { constructor(t, e, i) { super(), i.markCustomWaveDirty(), e.preset = e.type, t.notifier.changed(), this.It() } } class pe extends Tt { constructor(t, e, i) { super(), i.markCustomWaveDirty(), e.preset = e.type, t.notifier.changed(), this.It() } } class ue extends Tt { constructor(t, e, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; s.drumsetEnvelopes[e] != i && (s.drumsetEnvelopes[e] = i, s.preset = s.type, t.notifier.changed(), this.It()) } } class me extends Tt { constructor(t) { super(), this.l = t, this.Kt = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()] } commit() { this.isNoop() || (this.Kt.preset = this.Kt.type, this.l.notifier.changed()) } } class fe extends me { constructor(t, i, s) { super(t), this.Kt.pulseWidth = s, t.synth.unsetMod(e.modulators.dictionary["pulse width"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class ye extends me { constructor(t, e, i) { super(t), this.Kt.pitchShift = i, t.notifier.changed(), e != i && this.It() } } class be extends me { constructor(t, i, s) { super(t), this.Kt.detune = s + e.detuneCenter, t.notifier.changed(), t.synth.unsetMod(e.modulators.dictionary.detune.index, t.channel, t.getCurrentInstrument()), i != s && this.It() } } class ge extends me { constructor(t, i, s) { super(t), this.Kt.distortion = s, t.notifier.changed(), t.synth.unsetMod(e.modulators.dictionary.distortion.index, t.channel, t.getCurrentInstrument()), i != s && this.It() } } class we extends me { constructor(t, e, i) { super(t), this.Kt.bitcrusherFreq = i, t.notifier.changed(), e != i && this.It() } } class ve extends me { constructor(t, e, i) { super(t), this.Kt.bitcrusherQuantization = i, t.notifier.changed(), e != i && this.It() } } class ke extends me { constructor(t, i, s) { super(t), this.Kt.stringSustain = s, t.synth.unsetMod(e.modulators.dictionary.sustain.index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class xe extends Tt { constructor(t, i, s) { super(), i.eqFilterType = s, 1 == s ? (i.eqFilter.reset(), i.tmpEqFilterStart = i.eqFilter, i.tmpEqFilterEnd = null) : (i.eqFilter.convertLegacySettings(i.eqFilterSimpleCut, i.eqFilterSimplePeak, e.envelopes.dictionary.none), i.tmpEqFilterStart = i.eqFilter, i.tmpEqFilterEnd = null), i.clearInvalidEnvelopeTargets(), t.notifier.changed(), this.It() } } class Me extends Tt { constructor(t, i, s) { super(), i.noteFilterType = s, 1 == s ? (i.noteFilter.reset(), i.tmpNoteFilterStart = i.noteFilter, i.tmpNoteFilterEnd = null) : (i.noteFilter.convertLegacySettings(i.noteFilterSimpleCut, i.noteFilterSimplePeak, e.envelopes.dictionary.none), i.tmpNoteFilterStart = i.noteFilter, i.tmpNoteFilterEnd = null), i.clearInvalidEnvelopeTargets(), t.notifier.changed(), this.It() } } class Se extends me { constructor(t, i, s) { super(t), this.Kt.eqFilterSimpleCut = s, t.synth.unsetMod(e.modulators.dictionary["eq filt cut"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class Fe extends me { constructor(t, i, s) { super(t), this.Kt.eqFilterSimplePeak = s, t.synth.unsetMod(e.modulators.dictionary["eq filt peak"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class Ce extends me { constructor(t, i, s) { super(t), this.Kt.noteFilterSimpleCut = s, t.synth.unsetMod(e.modulators.dictionary["note filt cut"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class Ee extends me { constructor(t, i, s) { super(t), this.Kt.noteFilterSimplePeak = s, t.synth.unsetMod(e.modulators.dictionary["note filt peak"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class Te extends It { constructor(t, i, s, n, o, h = !1) { super(h), this.Jt = [], this.Yt = [], this.Qt = [], this.Xt = [], this.l = t, this.Kt = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], this.Zt = h ? this.Kt.preset : this.Kt.type, this.te = h ? this.Kt.type : this.Kt.preset, this.ee = i, this.ie = s, this.dt = n; for (let t = 0; t < this.Kt.envelopeCount; t++) { let s = this.Kt.envelopes[t].target, a = this.Kt.envelopes[t].index; if (this.Jt.push(s), this.Yt.push(a), h) { const t = e.instrumentAutomationTargets[s]; t.isFilter && 5 == t.effect == o && (t.maxCount == e.filterMaxPoints ? a == n ? (s = e.instrumentAutomationTargets.dictionary.none.index, a = 0) : a > n && a-- : i.controlPointCount <= 1 && (s = e.instrumentAutomationTargets.dictionary.none.index, a = 0)) } this.Qt.push(s), this.Xt.push(a) } this.It(), this.redo() } Lt() { this.ee.controlPoints.splice(this.dt, 0, this.ie), this.ee.controlPointCount++, this.ee.controlPoints.length = this.ee.controlPointCount, this.Kt.preset = this.Zt; for (let t = 0; t < this.Kt.envelopeCount; t++)this.Kt.envelopes[t].target = this.Jt[t], this.Kt.envelopes[t].index = this.Yt[t]; this.Kt.tmpEqFilterStart = this.Kt.eqFilter, this.Kt.tmpEqFilterEnd = null, this.Kt.tmpNoteFilterStart = this.Kt.noteFilter, this.Kt.tmpNoteFilterEnd = null, this.l.notifier.changed() } qt() { this.ee.controlPoints.splice(this.dt, 1), this.ee.controlPointCount--, this.ee.controlPoints.length = this.ee.controlPointCount, this.Kt.preset = this.te; for (let t = 0; t < this.Kt.envelopeCount; t++)this.Kt.envelopes[t].target = this.Qt[t], this.Kt.envelopes[t].index = this.Xt[t]; this.Kt.tmpEqFilterStart = this.Kt.eqFilter, this.Kt.tmpEqFilterEnd = null, this.Kt.tmpNoteFilterStart = this.Kt.noteFilter, this.Kt.tmpNoteFilterEnd = null, this.l.notifier.changed() } } class Ie extends It { constructor(t, e, i, s, n, o) { super(!1), this.l = t, this.Kt = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], this.Zt = this.Kt.type, this.te = this.Kt.preset, this.ie = e, this.se = i, this.ne = s, this.oe = n, this.he = o, this.It(), this.redo() } Lt() { this.ie.freq = this.ne, this.ie.gain = this.he, this.Kt.preset = this.Zt, this.Kt.tmpEqFilterStart = this.Kt.eqFilter, this.Kt.tmpEqFilterEnd = null, this.Kt.tmpNoteFilterStart = this.Kt.noteFilter, this.Kt.tmpNoteFilterEnd = null, this.l.notifier.changed() } qt() { this.ie.freq = this.se, this.ie.gain = this.oe, this.Kt.preset = this.te, this.Kt.tmpEqFilterStart = this.Kt.eqFilter, this.Kt.tmpEqFilterEnd = null, this.Kt.tmpNoteFilterStart = this.Kt.noteFilter, this.Kt.tmpNoteFilterEnd = null, this.l.notifier.changed() } } class Pe extends It { constructor(t, e, i, s, n = null, o = null) { super(!1), this.l = t, this.Kt = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], this.Zt = this.Kt.type, this.te = this.Kt.preset, this.ae = i, this.re = s, this.ee = e, null != n && null != o && (this.le = n, this.ce = o), this.Kt.clearInvalidEnvelopeTargets(), this.It(), this.redo() } Lt() { this.re ? (this.Kt.noteFilter = this.ee, null != this.le && (this.Kt.noteSubFilters = this.le), this.Kt.tmpNoteFilterStart = this.Kt.noteFilter, this.Kt.tmpNoteFilterEnd = null) : (this.Kt.eqFilter = this.ee, null != this.le && (this.Kt.eqSubFilters = this.le), this.Kt.tmpEqFilterStart = this.Kt.eqFilter, this.Kt.tmpEqFilterEnd = null), this.Kt.preset = this.Zt, this.Kt.clearInvalidEnvelopeTargets(), this.l.notifier.changed() } qt() { this.re ? (this.Kt.noteFilter = this.ae, null != this.ce && (this.Kt.noteSubFilters = this.ce), this.Kt.tmpNoteFilterStart = this.Kt.noteFilter, this.Kt.tmpNoteFilterEnd = null) : (this.Kt.eqFilter = this.ae, null != this.ce && (this.Kt.eqSubFilters = this.ce), this.Kt.tmpEqFilterStart = this.Kt.eqFilter, this.Kt.tmpEqFilterEnd = null), this.Kt.preset = this.te, this.Kt.clearInvalidEnvelopeTargets(), this.l.notifier.changed() } } class Ae extends It { constructor(t, e, i) { super(!1), this.l = t, this.Kt = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], this.Zt = this.Kt.type, this.te = this.Kt.preset, this.de = this.Kt.fadeIn, this.pe = this.Kt.fadeOut, this.ue = e, this.me = i, this.It(), this.redo() } Lt() { this.Kt.fadeIn = this.ue, this.Kt.fadeOut = this.me, this.Kt.preset = this.Zt, this.l.notifier.changed() } qt() { this.Kt.fadeIn = this.de, this.Kt.fadeOut = this.pe, this.Kt.preset = this.te, this.l.notifier.changed() } } class Le extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.algorithm != e && (i.algorithm = e, i.preset = i.type, t.notifier.changed(), this.It()) } } class qe extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.feedbackType != e && (i.feedbackType = e, i.preset = i.type, t.notifier.changed(), this.It()) } } class De extends Tt { constructor(t, e, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; s.operators[e].waveform != i && (s.operators[e].waveform = i, s.preset = s.type, t.notifier.changed(), this.It()) } } class Ne extends Tt { constructor(t, e, i, s) { super(); const n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; n.operators[e].pulseWidth = s, n.preset = n.type, t.notifier.changed(), i != s && this.It() } } class ze extends Tt { constructor(t, e, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; s.operators[e].frequency != i && (s.operators[e].frequency = i, s.preset = s.type, t.notifier.changed(), this.It()) } } class Be extends me { constructor(t, e, i, s) { super(t), this.Kt.operators[e].amplitude = s, t.notifier.changed(), i != s && this.It() } } class Re extends me { constructor(t, e, i) { super(t), this.Kt.feedbackAmplitude = i, t.notifier.changed(), e != i && this.It() } } class Oe extends Tt { constructor(t) { super(); const i = t.song.channels[t.channel], s = t.song.getChannelIsNoise(t.channel), n = t.song.getChannelIsMod(t.channel), o = t.song.getMaxInstrumentsPerChannel(); if (i.instruments.length >= o) return; const h = di(s), a = F.valueToPreset(h), r = new wt(s, n); r.fromJsonObject(a.settings, s, n, !1, !1, 1), r.preset = h, r.volume = 0, i.instruments.push(r), n || (t.viewedInstrument[t.channel] = i.instruments.length - 1); for (let i = t.song.pitchChannelCount + t.song.noiseChannelCount; i < t.song.getChannelCount(); i++)for (let s = 0; s < t.song.channels[i].instruments.length; s++)for (let n = 0; n < e.modCount; n++) { let e = t.song.channels[i].instruments[s], o = e.modInstruments[n], h = e.modChannels[n]; h == t.channel && o >= t.song.channels[h].instruments.length - 1 && e.modInstruments[n]++ } t.synth.computeLatestModValues(), t.notifier.changed(), this.It() } } class $e extends Tt { constructor(t) { super(); const i = t.song.channels[t.channel]; if (i.instruments.length <= e.instrumentCountMin) return; const s = t.viewedInstrument[t.channel]; if (i.instruments.splice(s, 1), t.song.patternInstruments) for (const t of i.patterns) { for (let e = 0; e < t.instruments.length; e++)t.instruments[e] == s ? (t.instruments.splice(e, 1), e--) : t.instruments[e] > s && t.instruments[e]--; t.instruments.length <= 0 && (t.instruments[0] = 0) } for (let i = t.song.pitchChannelCount + t.song.noiseChannelCount; i < t.song.getChannelCount(); i++)for (let n = 0; n < t.song.channels[i].instruments.length; n++)for (let o = 0; o < e.modCount; o++) { let e = t.song.channels[i].instruments[n], h = e.modInstruments[o]; e.modChannels[o] == t.channel && (h > s ? e.modInstruments[o]-- : h == s && (e.modInstruments[o] = 0, e.modulators[o] = 0)) } t.notifier.changed(), this.It() } } class He extends Tt { constructor(t, e) { super(), t.viewedInstrument[t.channel] != e && (t.viewedInstrument[t.channel] = e, t.notifier.changed(), this.It()) } } class Ve extends Tt { constructor(t, e, i) { super(); const s = t.song.layeredInstruments, n = t.song.patternInstruments; if (s != e || n != i) { t.song.layeredInstruments = e, t.song.patternInstruments = i; for (let e = 0; e < t.song.getChannelCount(); e++) { const s = t.song.channels[e]; s.instruments.length > t.song.getMaxInstrumentsPerChannel() && (s.instruments.length = t.song.getMaxInstrumentsPerChannel()); for (let o = 0; o < t.song.patternsPerChannel; o++) { const h = s.patterns[o]; if (!n && i) { for (let t = 0; t < s.instruments.length; t++)h.instruments[t] = t; h.instruments.length = s.instruments.length } qt(h.instruments, t.song, e) } } t.notifier.changed(), this.It() } } } class Ge extends Tt { constructor(t, e) { super(), t.song.key != e && (t.song.key = e, t.notifier.changed(), this.It()) } } class _e extends Tt { constructor(t, e, i, s, n) { super(), this.l = t, this.oldStart = e, this.oldLength = i, this.newStart = s, this.newLength = n, this.l.song.loopStart = this.newStart, this.l.song.loopLength = this.newLength, this.l.notifier.changed(), this.oldStart == this.newStart && this.oldLength == this.newLength || this.It() } } class je extends It { constructor(t, e, i, s, n = !1) { super(n), this.l = t, this.zt = e, this.fe = i, this.dt = s, this.It(), this.redo() } Lt() { this.zt.pitches.splice(this.dt, 0, this.fe), this.l.notifier.changed() } qt() { this.zt.pitches.splice(this.dt, 1), this.l.notifier.changed() } } class Ue extends Tt { constructor(t, e, i) { super(), this.oldValue = e, t.song.channels[t.channel].octave = i, t.notifier.changed(), e != i && this.It() } } class We extends Pt { constructor(t, e) { super(), t.song.rhythm != e && (t.song.rhythm = e, t.notifier.changed(), this.It()) } } class Ke extends Pt { constructor(t, e, i, s, n, o) { super(), this.append(new Fi(t, e, s, n, null, !0)); let h = 0; if (t.song.getChannelIsMod(t.channel)) h = e.notes.length; else for (let t = 0; t < e.notes.length; t++)if (e.notes[t].start < s) { if (e.notes[t].end > s) throw new Error; h = t + 1 } else if (e.notes[t].start < n) throw new Error; for (; s < n;) { for (const o of i) { const i = o.start + s, a = o.end + s; if (i >= n) break; const r = new lt(o.pitches[0], i, a, o.pins[0].size, !1); r.pitches.length = 0; for (const t of o.pitches) r.pitches.push(t); r.pins.length = 0; for (const t of o.pins) r.pins.push(rt(t.interval, t.time, t.size)); r.continuesLastPattern = !0 === o.continuesLastPattern && 0 == r.start, e.notes.splice(h++, 0, r), r.end > n && this.append(new Si(t, r, r.start, n)) } s += o } null != e && t.song.getChannelIsMod(t.channel) && e.notes.sort((function (t, e) { return t.start == e.start ? t.pitches[0] - e.pitches[0] : t.start - e.start })), t.notifier.changed(), this.It() } } class Je extends Pt { constructor(t, e, i) { super(), e.fromJsonObject(i, i.isDrum, i.isMod, !1, !1), t.notifier.changed(), this.It() } } class Ye extends Tt { constructor(t, e, i, s) { super(), Lt(i, s.instruments) || (s.instruments.length = 0, s.instruments.push(...i), qt(s.instruments, t.song, e), this.It(), t.notifier.changed()) } } class Qe extends Tt { constructor(t, i, s, n) { super(); let o = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; null != n && (o = n), (0 == s || e.modulators[o.modulators[i]].forSong && s >= 2 || !e.modulators[o.modulators[i]].forSong && s < 2) && (o.modulators[i] = e.modulators.dictionary.none.index), o.modChannels[i] = s - 2, t.notifier.changed(), this.It() } } class Xe extends Tt { constructor(t, e, i) { super(); let s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; s.modInstruments[e] != i && (s.modInstruments[e] = i, t.notifier.changed(), this.It()) } } class Ze extends Tt { constructor(t, i, s) { super(); let n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()], o = n.modChannels[i], h = []; if (o >= 0) if (n.modInstruments[i] == t.song.channels[o].instruments.length) h = h.concat(t.song.channels[o].instruments); else if (n.modInstruments[i] > t.song.channels[o].instruments.length) { let e = t.song.getPattern(o, t.bar); if (null != e) for (let i = 0; i < e.instruments.length; i++)h.push(t.song.channels[o].instruments[e.instruments[i]]) } else h.push(t.song.channels[o].instruments[n.modInstruments[i]]); if (s.startsWith("+ ")) { s = s.substr(2); for (let i = 0; i < h.length; i++) { const n = h[i]; n.effects & 1 << e.modulators.dictionary[s].associatedEffect || t.record(new Gt(t, e.modulators.dictionary[s].associatedEffect, n)) } } let a = e.modulators.dictionary[s].index; if (n.modulators[i] != a) { n.modulators[i] = a; let s = e.modulators[a].maxRawVol; for (let n = 0; n < t.song.patternsPerChannel; n++) { const o = t.song.channels[t.channel].patterns[n]; if (o.instruments[0] == t.getCurrentInstrument()) for (let t = 0; t < o.notes.length; t++) { const n = o.notes[t]; if (n.pitches[0] == e.modCount - i - 1) for (let t = 0; t < n.pins.length; t++) { const e = n.pins[t]; e.size > s && (e.size = s) } } } t.notifier.changed(), this.It() } } } class ti extends Tt { constructor(t, i, s) { super(); let n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; if (n.modFilterTypes[i] != s) { n.modFilterTypes[i] = s; let o = t.song.getVolumeCapForSetting(!0, n.modulators[i], n.modFilterTypes[i]); for (let s = 0; s < t.song.patternsPerChannel; s++) { const n = t.song.channels[t.channel].patterns[s]; if (n.instruments[0] == t.getCurrentInstrument()) for (let t = 0; t < n.notes.length; t++) { const s = n.notes[t]; if (s.pitches[0] == e.modCount - i - 1) for (let t = 0; t < s.pins.length; t++) { const e = s.pins[t]; e.size > o && (e.size = o) } } } t.notifier.changed(), this.It() } } } class ei extends Tt { constructor(t, e) { if (super(), t.song.patternsPerChannel != e) { for (let i = 0; i < t.song.getChannelCount(); i++) { const s = t.song.channels[i].bars, n = t.song.channels[i].patterns; for (let t = 0; t < s.length; t++)s[t] > e && (s[t] = 0); for (let t = n.length; t < e; t++)n[t] = new ct; n.length = e } t.song.patternsPerChannel = e, t.notifier.changed(), this.It() } } } class ii extends It { constructor(t, e, i) { super(!1), this.ye = null, this.be = null; const s = t.song; if (0 != s.channels[e].bars[i]) return; this.l = t, this.ge = i, this.we = e, this.ve = s.patternsPerChannel, this.ke = s.patternsPerChannel, this.xe = t.recentPatternInstruments[e].concat(); let n = null, o = null; for (let t = 1; t <= s.patternsPerChannel; t++) { let i = !1; for (let n = 0; n < s.barCount; n++)if (s.channels[e].bars[n] == t) { i = !0; break } if (i) continue; null == o && (o = t); if (0 == s.channels[e].patterns[t - 1].notes.length) { n = t; break } } if (null != n) this.Me = n, this.be = s.channels[e].patterns[n - 1].instruments.concat(); else if (s.patternsPerChannel < s.barCount) this.ke = s.patternsPerChannel + 1, this.Me = s.patternsPerChannel + 1; else { if (null == o) throw new Error; this.Me = o, this.ye = s.channels[e].patterns[o - 1].notes, this.be = s.channels[e].patterns[o - 1].instruments.concat() } this.It(), this.Lt() } Lt() { const t = this.l.song; for (let e = t.patternsPerChannel; e < this.ke; e++)for (let i = 0; i < t.getChannelCount(); i++)t.channels[i].patterns[e] = new ct; t.patternsPerChannel = this.ke; const e = t.channels[this.we].patterns[this.Me - 1]; e.notes = [], e.instruments.length = 0, e.instruments.push(...this.xe), t.channels[this.we].bars[this.ge] = this.Me, this.l.notifier.changed() } qt() { const t = this.l.song, e = t.channels[this.we].patterns[this.Me - 1]; null != this.ye && (e.notes = this.ye), null != this.be && (e.instruments.length = 0, e.instruments.push(...this.be)), t.channels[this.we].bars[this.ge] = 0; for (let e = 0; e < t.getChannelCount(); e++)t.channels[e].patterns.length = this.ve; t.patternsPerChannel = this.ve, this.l.notifier.changed() } } class si extends Rt { constructor(t, e, i, s, n) { super(t, e), s -= this.Bt; const o = this.Ht[i].time, h = Math.min(o, s), a = Math.max(o, s); let r = !1; for (let t = 0; t < this.Ht.length; t++) { const o = e.pins[t], l = o.time; l < h ? this.Vt.push(rt(o.interval, l, o.size)) : l > a && (r || (this.Vt.length > 0 && (n = e.continuesLastPattern), this.Vt.push(rt(this.Ht[i].interval, s, this.Ht[i].size)), r = !0), this.Vt.push(rt(o.interval, l, o.size))) } r || (n = e.continuesLastPattern, this.Vt.push(rt(this.Ht[i].interval, s, this.Ht[i].size))), this.Wt(n) } } class ni extends Rt { constructor(t, i, s, n, o, h) { super(t, i), s -= this.Bt, n -= this.Bt, o -= i.pitches[h]; let a, r, l, c, d = !1, p = !1, u = 0, m = e.noteSizeMax, f = !0; for (n > s ? (a = 0, r = 1, l = i.pins.length, c = t => { this.Vt.push(t) }) : (a = i.pins.length - 1, r = -1, l = -1, c = t => { this.Vt.unshift(t) }); a != l; a += r) { const t = i.pins[a], e = t.time; for (; ;)if (d) { if (p) { if (e * r == n * r) break; t.interval != u && (f = !1), c(rt(f ? o : t.interval, e, t.size)); break } if (e * r <= n * r && (u = t.interval, m = t.size), e * r < n * r) break; c(rt(o, n, m)), p = !0 } else { if (e * r <= s * r && (u = t.interval, m = t.size), e * r < s * r) { c(rt(t.interval, e, t.size)); break } c(rt(u, s, m)), d = !0 } } p || c(rt(o, n, m)), this.Wt() } } class oi extends At { constructor(t, i) { super(); const s = e.partsPerBeat / e.rhythms[t.song.rhythm].stepsPerBeat, n = function (i) { let n = e.rhythms[t.song.rhythm].roundUpThresholds; if (null != n) { const t = Math.floor(i / e.partsPerBeat) * e.partsPerBeat, o = i - t; let h = t; for (const t of n) { if (!(o >= t)) break; h += s } return h } return Math.round(i / s) * s }; let o = 0; for (; o < i.notes.length;) { const e = i.notes[o]; n(e.start) >= n(e.end) ? this.append(new Mi(t, i, e, o, !0)) : (this.append(new hi(t, e, n)), o++) } } } class hi extends Rt { constructor(t, e, i) { super(t, e); for (const t of this.Ht) this.Vt.push(rt(t.interval, i(t.time + this.Bt) - this.Bt, t.size)); this.Wt() } } class ai extends Pt { constructor(t, i, s) { super(); let n = Math.round(i % t.song.beatsPerBar * e.partsPerBeat); if (n < 0 && (n += t.song.beatsPerBar * e.partsPerBeat), 0 != n) { switch (s) { case "wrapAround": { const i = e.partsPerBeat * t.song.beatsPerBar; for (const e of t.song.channels) for (const t of e.patterns) { const e = []; for (let s = 1; s >= 0; s--) { const o = s * i; for (const s of t.notes) { const t = s.start + n, h = s.end + n, a = Math.max(0, t - o), r = Math.min(i, h - o); a < r && zt(s, t - o - a, a, r, e) } } t.notes = e } } break; case "overflow": { let e = t.song.barCount, s = t.song.loopStart, o = t.song.loopLength; if (this.append(new Bt(t, t.song.beatsPerBar, n)), i < 0) { let i = !0; for (const e of t.song.channels) 0 != e.bars[0] && (i = !1); if (i) { for (const e of t.song.channels) e.bars.shift(); t.song.barCount-- } else e++, s++, t.bar++ } for (; t.song.barCount < e;) { for (const e of t.song.channels) e.bars.push(0); t.song.barCount++ } t.song.loopStart = s, t.song.loopLength = o } break; default: throw new Error("Unrecognized beats-per-bar conversion strategy.") }t.notifier.changed(), this.It() } } } class ri extends Pt { constructor(t, i, s) { if (super(), t.song.beatsPerBar != i) { switch (s) { case "splice": if (t.song.beatsPerBar > i) { const s = new At; for (let n = 0; n < t.song.getChannelCount(); n++)for (let o = 0; o < t.song.channels[n].patterns.length; o++)s.append(new Fi(t, t.song.channels[n].patterns[o], i * e.partsPerBeat, t.song.beatsPerBar * e.partsPerBeat, null, !0)) } break; case "stretch": { const e = function (e) { return Math.round(e * i / t.song.beatsPerBar) }; for (let i = 0; i < t.song.getChannelCount(); i++)for (let s = 0; s < t.song.channels[i].patterns.length; s++) { const n = t.song.channels[i].patterns[s]; let o = 0; for (; o < n.notes.length;) { const i = n.notes[o]; e(i.start) >= e(i.end) ? this.append(new Mi(t, n, i, o, !0)) : (this.append(new hi(t, i, e)), o++) } } this.append(new gi(t, t.song.tempo, t.song.tempo * i / t.song.beatsPerBar)) } break; case "overflow": this.append(new Bt(t, i, 0)), t.song.loopStart = 0, t.song.loopLength = t.song.barCount; break; default: throw new Error("Unrecognized beats-per-bar conversion strategy.") }t.song.beatsPerBar = i, t.notifier.changed(), this.It() } } } class li extends Pt { constructor(t, e) { super(), t.song.scale != e && (t.song.scale = e, t.notifier.changed(), this.It()) } } class ci extends Pt { constructor(t) { super(); const i = t.song, s = e.keys[i.key].basePitch, n = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]; for (let t = 0; t < i.pitchChannelCount; t++)for (let o = 0; o < i.barCount; o++) { const h = i.getPattern(t, o); if (null != h) for (const t of h.notes) { const i = t.pins[0]; for (let o = 1; o < t.pins.length; o++) { const h = t.pins[o]; if (i.interval == h.interval) { let o = h.time - i.time; o += Math.max(0, Math.min(e.partsPerBeat, h.time + t.start) - (i.time + t.start)), o *= h.size + i.size; for (const e of t.pitches) { n[(s + i.interval + e) % 12] += o } } } } } let o = 0, h = 0; for (let t = 0; t < 12; t++) { const e = n[t] * (3 * n[(t + 7) % 12] + n[(t + 4) % 12] + n[(t + 3) % 12]); h < e && (h = e, o = t) } if (o != i.key) { const e = i.key - o, s = Math.abs(e); for (let n = 0; n < i.pitchChannelCount; n++)for (const o of i.channels[n].patterns) for (let i = 0; i < s; i++)this.append(new Ti(t, n, o, e > 0, !0)); i.key = o, t.notifier.changed(), this.It() } } } function di(t) { const e = []; for (let i = 0; i < F.presetCategories.length; i++) { const s = F.presetCategories[i]; if ("Novelty Presets" != s.name) for (let n = 0; n < s.presets.length; n++) { const o = s.presets[n]; null != o.settings && 1 == o.isNoise == t && e.push((i << 6) + n) } } return e[Math.random() * e.length | 0] } function pi(t) { for (let e = 0; e < t.channels.length; e++)for (const i of t.channels[e].instruments) { const s = t.getChannelIsNoise(e), n = t.getChannelIsMod(e), o = e == t.pitchChannelCount ? F.nameToPresetValue(Math.random() > .5 ? "chip noise" : "standard drumset") : di(s), h = F.valueToPreset(o); i.fromJsonObject(h.settings, s, n, 0 == t.rhythm || 2 == t.rhythm, t.rhythm >= 2, 1), i.preset = o } } class ui extends Pt { constructor(t, e) { super(); let i = t.song.pitchChannelCount, s = t.song.noiseChannelCount, n = t.song.modChannelCount; if (t.song.fromBase64String(e), i == t.song.pitchChannelCount && s == t.song.noiseChannelCount && n == t.song.modChannelCount || j.resetColors(), "" == e) { this.append(new Pi(t, 0, 0)), t.selection.resetBoxSelection(), pi(t.song), t.song.scale = t.prefs.defaultScale; for (let e = 0; e <= t.song.channels.length; e++)t.viewedInstrument[e] = 0, t.recentPatternInstruments[e] = [0]; t.viewedInstrument.length = t.song.channels.length } else this.append(new mi(t)); t.synth.computeLatestModValues(), t.notifier.changed(), this.It() } } class mi extends Tt { constructor(t) { super(); const e = Math.min(t.channel, t.song.getChannelCount() - 1), i = Math.max(0, Math.min(t.song.barCount - 1, t.bar)); t.channel == e && t.bar == i || (t.bar = i, t.channel = e, this.It()), t.selection.scrollToSelectedPattern(), t.notifier.changed() } } class fi extends Pt { constructor(t, i, s, n) { super(); const o = t.song; function h(t, e) { for (; t.length > e;) { let e = t.length - 1, i = 0; for (let s = 0; s < t.length - 1; s++) { let n = 0; for (const e of t[s].bars) 0 == e && n++; n >= i && (e = s, i = n) } t.splice(e, 1) } } for (h(i, e.pitchChannelCountMax), h(s, e.noiseChannelCountMax), h(n, e.modChannelCountMax); i.length < e.pitchChannelCountMin;)i.push(new vt); for (; s.length < e.noiseChannelCountMin;)s.push(new vt); for (; n.length < e.modChannelCountMin;)n.push(new vt); o.barCount = 1, o.patternsPerChannel = 8; const a = i.concat(s.concat(n)); for (let t = 0; t < a.length; t++) { const e = a[t]; o.barCount = Math.max(o.barCount, e.bars.length), o.patternsPerChannel = Math.max(o.patternsPerChannel, e.patterns.length), o.channels[t] = e } o.channels.length = a.length, o.pitchChannelCount = i.length, o.noiseChannelCount = s.length, o.modChannelCount = n.length, o.barCount = Math.min(e.barCountMax, o.barCount), o.patternsPerChannel = Math.min(e.barCountMax, o.patternsPerChannel); for (let t = 0; t < o.channels.length; t++) { const e = o.channels[t]; for (let t = 0; t < e.bars.length; t++)(e.bars[t] > o.patternsPerChannel || e.bars[t] < 0) && (e.bars[t] = 0); for (; e.bars.length < o.barCount;)e.bars.push(0); e.bars.length = o.barCount, e.instruments.length > o.getMaxInstrumentsPerChannel() && (e.instruments.length = o.getMaxInstrumentsPerChannel()); for (const i of e.patterns) qt(i.instruments, o, t); for (; e.patterns.length < o.patternsPerChannel;)e.patterns.push(new ct); e.patterns.length = o.patternsPerChannel } o.loopStart = Math.max(0, Math.min(o.barCount - 1, o.loopStart)), o.loopLength = Math.min(o.barCount - o.loopStart, o.loopLength), this.append(new mi(t)), t.notifier.changed(), this.It(), j.resetColors() } } function yi(t, e) { if (t.length != e.length) return !1; for (let i = 0; i < t.length; i++) { const s = t[i], n = e[i]; if (n.start != s.start || n.end != s.end || n.pitches.length != s.pitches.length || n.pins.length != s.pins.length) return !1; for (let t = 0; t < s.pitches.length; t++)if (n.pitches[t] != s.pitches[t]) return !1; for (let t = 0; t < s.pins.length; t++)if (n.pins[t].interval != s.pins[t].interval || n.pins[t].time != s.pins[t].time || n.pins[t].size != s.pins[t].size) return !1 } return !0 } function bi(t) { for (const e of t) { const t = []; for (let i = 0; i < e.bars.length; i++) { if (0 == e.bars[i]) continue; const s = e.patterns[e.bars[i] - 1]; let n = !1; for (let o = 0; o < t.length; o++) { const h = t[o]; if (Lt(s.instruments, h.instruments) && h.notes.length == s.notes.length && yi(s.notes, h.notes)) { n = !0, e.bars[i] = o + 1; break } } n || (t.push(s), e.bars[i] = t.length) } for (let i = 0; i < t.length; i++)e.patterns[i] = t[i]; e.patterns.length = t.length } } class gi extends Tt { constructor(t, i, s) { super(), t.song.tempo = Math.max(e.tempoMin, Math.min(e.tempoMax, Math.round(s))), t.synth.unsetMod(e.modulators.dictionary.tempo.index), t.notifier.changed(), i != s && this.It() } } class wi extends me { constructor(t, i, s) { super(t), this.Kt.echoDelay = s, t.synth.unsetMod(e.modulators.dictionary["echo delay"].index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class vi extends me { constructor(t, i, s) { super(t), this.Kt.echoSustain = s, t.synth.unsetMod(e.modulators.dictionary.echo.index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class ki extends me { constructor(t, e, i) { super(t), this.Kt.chorus = i, t.notifier.changed(), e != i && this.It() } } class xi extends me { constructor(t, i, s) { super(t), this.Kt.reverb = s, t.synth.unsetMod(e.modulators.dictionary.reverb.index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class Mi extends It { constructor(t, e, i, s, n = !1) { super(n), this.l = t, this.Se = e, this.zt = i, this.dt = s, this.It(), this.redo() } Lt() { this.Se.notes.splice(this.dt, 0, this.zt), this.l.notifier.changed() } qt() { this.Se.notes.splice(this.dt, 1), this.l.notifier.changed() } } class Si extends Rt { constructor(t, e, i, s) { super(t, e); const n = (this.Bt < 0 || e.continuesLastPattern) && 0 == i; i -= this.Bt, s -= this.Bt; let o, h = !1, a = this.Ht[0].size, r = this.Ht[0].interval, l = !0; for (o = 0; o < this.Ht.length; o++) { const t = this.Ht[o]; if (t.time < i) a = t.size, r = t.interval; else { if (t.time > i && !h && (this.Vt.push(rt(r, i, a)), h = !0), !(t.time <= s)) break; if (this.Vt.push(rt(t.interval, t.time, t.size)), t.time == s) { l = !1; break } } } l && this.Vt.push(rt(this.Ht[o].interval, s, this.Ht[o].size)), this.Wt(n) } } class Fi extends At { constructor(t, e, i, s, n = null, o = !1) { super(); let h = 0; for (; h < e.notes.length;) { const a = e.notes[h]; if (a == n && null != n) h++; else if (a.end <= i) h++; else if (a.start >= s) { if (!t.song.getChannelIsMod(t.channel)) break; h++ } else if (a.start < i && a.end > s) { if (!t.song.getChannelIsMod(t.channel) || o || null != n && a.pitches[0] == n.pitches[0]) { const n = a.clone(); this.append(new Si(t, a, a.start, i)), h++, this.append(new Mi(t, e, n, h, !1)), this.append(new Si(t, n, s, n.end)) } h++ } else a.start < i ? ((!t.song.getChannelIsMod(t.channel) || o || null != n && a.pitches[0] == n.pitches[0]) && this.append(new Si(t, a, a.start, i)), h++) : a.end > s ? ((!t.song.getChannelIsMod(t.channel) || o || null != n && a.pitches[0] == n.pitches[0]) && this.append(new Si(t, a, s, a.end)), h++) : !t.song.getChannelIsMod(t.channel) || o || null != n && a.pitches[0] == n.pitches[0] ? this.append(new Mi(t, e, a, h, !0)) : h++ } } } class Ci extends At { constructor(t, e) { super(); let i = 0; for (; i < e.notes.length;) { const s = e.notes[i]; if (s.start < t.selection.patternSelectionStart && t.selection.patternSelectionStart < s.end) { const n = s.clone(); this.append(new Si(t, s, s.start, t.selection.patternSelectionStart)), i++, this.append(new Mi(t, e, n, i, !1)), this.append(new Si(t, n, t.selection.patternSelectionStart, n.end)) } else if (s.start < t.selection.patternSelectionEnd && t.selection.patternSelectionEnd < s.end) { const n = s.clone(); this.append(new Si(t, s, s.start, t.selection.patternSelectionEnd)), i++, this.append(new Mi(t, e, n, i, !1)), this.append(new Si(t, n, t.selection.patternSelectionEnd, n.end)), i++ } else i++ } } } class Ei extends It { constructor(t, i, s, n, o = !1, h = !1) { super(!1), this.l = t, this.zt = s, this.Ht = s.pins, this.Vt = [], this.Gt = s.pitches, this._t = []; const a = t.song.getChannelIsNoise(i); if (a != t.song.getChannelIsNoise(t.channel)) return; if (t.song.getChannelIsMod(t.channel)) return; const r = a ? e.drumCount - 1 : e.maxPitch; for (let i = 0; i < this.Gt.length; i++) { let s = this.Gt[i]; if (h && !a) s = n ? Math.min(r, s + 12) : Math.max(0, s - 12); else if (n) { for (let i = s + 1; i <= r; i++)if (a || o || e.scales[t.song.scale].flags[i % 12]) { s = i; break } } else for (let i = s - 1; i >= 0; i--)if (a || o || e.scales[t.song.scale].flags[i % 12]) { s = i; break } let l = !1; for (let t = 0; t < this._t.length; t++)if (this._t[t] == s) { l = !0; break } l || this._t.push(s) } let l = 0, c = r; for (let t = 1; t < this._t.length; t++) { const e = this._t[0] - this._t[t]; l < e && (l = e), c > e + r && (c = e + r) } for (const i of this.Ht) { let s = i.interval + this.Gt[0]; if (s < l && (s = l), s > c && (s = c), h && !a) s = n ? Math.min(c, s + 12) : Math.max(l, s - 12); else if (n) { for (let i = s + 1; i <= c; i++)if (a || o || e.scales[t.song.scale].flags[i % 12]) { s = i; break } } else for (let i = s - 1; i >= l; i--)if (a || o || e.scales[t.song.scale].flags[i % 12]) { s = i; break } s -= this._t[0], this.Vt.push(rt(s, i.time, i.size)) } if (0 != this.Vt[0].interval) throw new Error("wrong pin start interval"); for (let t = 1; t < this.Vt.length - 1;)this.Vt[t - 1].interval == this.Vt[t].interval && this.Vt[t].interval == this.Vt[t + 1].interval && this.Vt[t - 1].size == this.Vt[t].size && this.Vt[t].size == this.Vt[t + 1].size ? this.Vt.splice(t, 1) : t++; this.Lt(), this.It() } Lt() { this.zt.pins = this.Vt, this.zt.pitches = this._t, this.l.notifier.changed() } qt() { this.zt.pins = this.Ht, this.zt.pitches = this.Gt, this.l.notifier.changed() } } class Ti extends At { constructor(t, e, i, s, n = !1, o = !1) { super(), t.selection.patternSelectionActive && this.append(new Ci(t, i)); for (const h of i.notes) t.selection.patternSelectionActive && (h.end <= t.selection.patternSelectionStart || h.start >= t.selection.patternSelectionEnd) || this.append(new Ei(t, e, h, s, n, o)) } } class Ii extends Tt { constructor(t, e, i, s, n) { super(), t.selection.boxSelectionX0 = e, t.selection.boxSelectionX1 = i, t.selection.boxSelectionY0 = s, t.selection.boxSelectionY1 = n, t.notifier.changed(), this.It() } } class Pi extends It { constructor(t, e, i) { super(!1), this.l = t, this.Bt = t.selection.patternSelectionStart, this.Rt = t.selection.patternSelectionEnd, this.Fe = t.selection.patternSelectionActive, this.Ot = e, this.$t = i, this.Ce = e < i, this.Lt(), this.It() } Lt() { this.l.selection.patternSelectionStart = this.Ot, this.l.selection.patternSelectionEnd = this.$t, this.l.selection.patternSelectionActive = this.Ce, this.l.notifier.changed() } qt() { this.l.selection.patternSelectionStart = this.Bt, this.l.selection.patternSelectionEnd = this.Rt, this.l.selection.patternSelectionActive = this.Fe, this.l.notifier.changed() } } class Ai extends At { constructor(t, i, s, n, o) { if (super(), 0 == n && 0 == o) return; t.selection.patternSelectionActive && this.append(new Ci(t, s)); const h = t.selection.patternSelectionStart, a = t.selection.patternSelectionEnd, r = Math.max(0, Math.min(t.song.beatsPerBar * e.partsPerBeat, h + n)), l = Math.max(0, Math.min(t.song.beatsPerBar * e.partsPerBeat, a + n)); r == l ? this.append(new Fi(t, s, h, a, null, !0)) : n < 0 ? this.append(new Fi(t, s, r, Math.min(h, l), null, !0)) : this.append(new Fi(t, s, Math.max(a, r), l, null, !0)), this.append(new Pi(t, r, l)); const c = []; let d = 0, p = 0; for (; p < s.notes.length;) { const e = s.notes[p]; e.end <= h || e.start >= a ? (p++, e.end <= r && (d = p)) : (c.push(e.clone()), this.append(new Mi(t, s, e, p, !0))) } for (const e of c) if (e.start += n, e.end += n, !(e.end <= r || e.start >= l)) { this.append(new Mi(t, s, e, d++, !1)), this.append(new Si(t, e, Math.max(e.start, r), Math.min(l, e.end))); for (let s = 0; s < Math.abs(o); s++)this.append(new Ei(t, i, e, o > 0, t.prefs.notesOutsideScale)) } } } class Li extends Pt { constructor(t, i, s, n, o) { super(); for (let h = n; h < n + o; h++) { const n = {}; for (let o = i; o < i + s; o++) { const a = t.song.channels[h].bars[o]; if (0 != a) { if (null == n[String(a)]) { let r = !1; for (let e = 0; e < t.song.barCount; e++)if ((e < i || e >= i + s) && t.song.channels[h].bars[e] == a) { r = !0; break } if (r) { const i = t.song.getPattern(h, o); this.append(new _t(t, 0, o, h, 1, 1)), this.append(new ii(t, h, o)); const s = t.song.getPattern(h, o); if (null == s) throw new Error; this.append(new Ke(t, s, i.notes, 0, e.partsPerBeat * t.song.beatsPerBar, e.partsPerBeat * t.song.beatsPerBar)), s.instruments.length = 0, s.instruments.push(...i.instruments), n[String(a)] = t.song.channels[h].bars[o] } else n[String(a)] = a } this.append(new _t(t, n[String(a)], o, h, 1, 1)) } } } } } class qi extends Tt { constructor(t, i, s) { super(), t.selection.patternSelectionActive && new Ci(t, i); const n = e.maxPitch; for (const e of i.notes) { if (t.selection.patternSelectionActive && (e.end <= t.selection.patternSelectionStart || e.start >= t.selection.patternSelectionEnd)) continue; const i = [], o = []; for (let t = 0; t < e.pitches.length; t++) { const n = e.pitches[t], o = s[n % 12] + (n - n % 12); -1 == i.indexOf(o) && i.push(o) } let h = 0, a = n; for (let t = 1; t < i.length; t++) { const e = i[0] - i[t]; h < e && (h = e), a > e + n && (a = e + n) } for (const t of e.pins) { let n = t.interval + e.pitches[0]; n < h && (n = h), n > a && (n = a); const r = s[n % 12] + (n - n % 12); o.push(rt(r - i[0], t.time, t.size)) } if (0 != o[0].interval) throw new Error("wrong pin start interval"); for (let t = 1; t < o.length - 1;)o[t - 1].interval == o[t].interval && o[t].interval == o[t + 1].interval && o[t - 1].size == o[t].size && o[t].size == o[t + 1].size ? o.splice(t, 1) : t++; e.pitches = i, e.pins = o } this.It(), t.notifier.changed() } } class Di extends Tt { constructor(t, e, i) { super(), t.song.channels[t.channel].instruments[t.getCurrentInstrument()].volume = i, t.notifier.changed(), e != i && this.It() } } class Ni extends Tt { constructor(t, e, i) { super(), i.length > 30 && (i = i.substring(0, 30)), t.song.title = i, document.title = i + " - " + F.versionDisplayName, t.notifier.changed(), e != i && this.It() } } class zi extends Tt { constructor(t, e, i) { super(), i.length > 15 && (i = i.substring(0, 15)), t.song.channels[t.muteEditorChannel].name = i, t.recalcChannelNames = !0, t.notifier.changed(), e != i && this.It() } } class Bi extends Tt { constructor(t, i, s) { super(), t.song.channels[t.channel].instruments[t.getCurrentInstrument()].pan = s, t.synth.unsetMod(e.modulators.dictionary.pan.index, t.channel, t.getCurrentInstrument()), t.notifier.changed(), i != s && this.It() } } class Ri extends Tt { constructor(t, e, i) { super(), t.song.channels[t.channel].instruments[t.getCurrentInstrument()].panDelay = i, t.notifier.changed(), e != i && this.It() } } class Oi extends It { constructor(t, e, i, s, n, o) { super(!1), this.l = t, this.zt = e, this.Ht = e.pins, this.Vt = []; let h = !1; for (const t of e.pins) t.time < i ? o ? this.Vt.push(rt(t.interval, t.time, s)) : this.Vt.push(t) : t.time == i ? (this.Vt.push(rt(n, i, s)), h = !0) : (o || h || (this.Vt.push(rt(n, i, s)), h = !0), o ? this.Vt.push(rt(t.interval, t.time, s)) : this.Vt.push(t)); Nt(this.Vt), this.Lt(), this.It() } Lt() { this.zt.pins = this.Vt, this.l.notifier.changed() } qt() { this.zt.pins = this.Ht, this.l.notifier.changed() } } class $i extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.chipWave != e && (i.chipWave = e, i.preset = i.type, t.notifier.changed(), this.It()) } } class Hi extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.chipNoise != e && (i.chipNoise = e, i.preset = i.type, t.notifier.changed(), this.It()) } } class Vi extends Tt { constructor(t) { super(); const e = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; e.addEnvelope(0, 0, 0), e.preset = e.type, t.notifier.changed(), this.It() } } class Gi extends Tt { constructor(t, e) { super(); const i = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; i.envelopeCount--; for (let t = e; t < i.envelopeCount; t++)i.envelopes[t].target = i.envelopes[t + 1].target, i.envelopes[t].index = i.envelopes[t + 1].index, i.envelopes[t].envelope = i.envelopes[t + 1].envelope; i.preset = i.type, t.notifier.changed(), this.It() } } class _i extends Tt { constructor(t, e, i, s) { super(); const n = t.song.channels[t.channel].instruments[t.getCurrentInstrument()], o = n.envelopes[e].target, h = n.envelopes[e].index; o == i && h == s || (n.envelopes[e].target = i, n.envelopes[e].index = s, n.preset = n.type, t.notifier.changed(), this.It()) } } class ji extends Tt { constructor(t, e, i) { super(); const s = t.song.channels[t.channel].instruments[t.getCurrentInstrument()]; s.envelopes[e].envelope != i && (s.envelopes[e].envelope = i, s.preset = s.type, t.notifier.changed(), this.It()) } } const { button: Ui, div: Wi, span: Ki, h2: Ji, input: Yi, br: Qi, select: Xi, option: Zi } = z; class ts { constructor(t) { this.l = t, this.Ee = Yi({ style: "width: 3em; margin-left: 1em;", type: "number", step: "1" }), this.Te = Xi({ style: "width: 100%;" }, Zi({ value: "splice" }, "Splice beats at end of bars."), Zi({ value: "stretch" }, "Stretch notes to fit in bars."), Zi({ value: "overflow" }, "Overflow notes across bars.")), this.Ie = Ui({ class: "cancelButton" }), this.Pe = Ui({ class: "okayButton", style: "width:45%;" }, "Okay"), this.container = Wi({ class: "prompt noSelection", style: "width: 250px;" }, Ji("Beats Per Bar"), Wi({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, Wi({ style: "text-align: right;" }, "Beats per bar:", Qi(), Ki({ style: "font-size: smaller; color: ${ColorConfig.secondaryText};" }, "(Multiples of 3 or 4 are recommended)")), this.Ee), Wi({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, Wi({ class: "selectContainer", style: "width: 100%;" }, this.Te)), Wi({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.Ee.removeEventListener("keypress", ts.qe), this.Ee.removeEventListener("blur", ts.De), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Le() }, this.Le = () => { window.localStorage.setItem("beatCountStrategy", this.Te.value), this.l.prompt = null, this.l.record(new ri(this.l, ts.ze(this.Ee), this.Te.value), !0) }, this.Ee.value = this.l.song.beatsPerBar + "", this.Ee.min = e.beatsPerBarMin + "", this.Ee.max = e.beatsPerBarMax + ""; const i = window.localStorage.getItem("beatCountStrategy"); null != i && (this.Te.value = i), this.Ee.select(), setTimeout((() => this.Ee.focus())), this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.Ee.addEventListener("keypress", ts.qe), this.Ee.addEventListener("blur", ts.De), this.container.addEventListener("keydown", this.Ne) } static qe(t) { const e = t.which ? t.which : t.keyCode; return 46 != e && e > 31 && (e < 48 || e > 57) && (t.preventDefault(), !0) } static De(t) { const e = t.target; e.value = String(ts.ze(e)) } static ze(t) { return Math.floor(Math.max(Number(t.min), Math.min(Number(t.max), Number(t.value)))) } } const { button: es, div: is, label: ss, br: ns, h2: os, input: hs } = z; class as { constructor(t) { this.l = t, this.Be = hs({ style: "width: 3em; margin-left: 1em;", type: "number", step: "1" }), this.Re = hs({ style: "width: 3em; margin-left: 1em;", type: "number", step: "1" }), this.Oe = hs({ style: "width: 3em; margin-left: 1em;", type: "number", step: "1" }), this.$e = hs({ style: "width: 3em; margin-left: 1em;", type: "number", step: "1" }), this.He = hs({ style: "width: 3em; margin-left: 1em;", type: "checkbox" }), this.Ve = hs({ style: "width: 3em; margin-left: 1em;", type: "checkbox" }), this.Ie = es({ class: "cancelButton" }), this.Pe = es({ class: "okayButton", style: "width:45%;" }, "Okay"), this.container = is({ class: "prompt noSelection", style: "width: 250px; text-align: right;" }, os("Channel Settings"), ss({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Pitch channels:", this.Re), ss({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Drum channels:", this.Oe), is({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Mod channels:", this.$e), ss({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Available patterns per channel:", this.Be), ss({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Simultaneous instruments", ns(), "per channel:", this.He), ss({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Different instruments", ns(), "per pattern:", this.Ve), ss({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.Be.removeEventListener("keypress", as.qe), this.Re.removeEventListener("keypress", as.qe), this.Oe.removeEventListener("keypress", as.qe), this.$e.removeEventListener("keypress", as.qe), this.Be.removeEventListener("blur", this.De), this.Re.removeEventListener("blur", this.De), this.Oe.removeEventListener("blur", this.De), this.$e.removeEventListener("blur", this.De), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Le() }, this.De = t => { const e = t.target; e.value = String(as.ze(e)) }, this.Le = () => { const t = new Pt; t.append(new Ve(this.l, this.He.checked, this.Ve.checked)), t.append(new ei(this.l, as.ze(this.Be))), t.append(new Yt(this.l, as.ze(this.Re), as.ze(this.Oe), as.ze(this.$e))), this.l.prompt = null, this.l.record(t, !0) }, this.Be.value = this.l.song.patternsPerChannel + "", this.Be.min = "1", this.Be.max = e.barCountMax + "", this.Re.value = this.l.song.pitchChannelCount + "", this.Re.min = e.pitchChannelCountMin + "", this.Re.max = e.pitchChannelCountMax + "", this.Oe.value = this.l.song.noiseChannelCount + "", this.Oe.min = e.noiseChannelCountMin + "", this.Oe.max = e.noiseChannelCountMax + "", this.$e.value = this.l.song.modChannelCount + "", this.$e.min = e.modChannelCountMin + "", this.$e.max = e.modChannelCountMax + "", this.He.checked = this.l.song.layeredInstruments, this.Ve.checked = this.l.song.patternInstruments, this.Re.select(), setTimeout((() => this.Re.focus())), this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.Be.addEventListener("keypress", as.qe), this.Re.addEventListener("keypress", as.qe), this.Oe.addEventListener("keypress", as.qe), this.$e.addEventListener("keypress", as.qe), this.Be.addEventListener("blur", this.De), this.Re.addEventListener("blur", this.De), this.Oe.addEventListener("blur", this.De), this.$e.addEventListener("blur", this.De), this.container.addEventListener("keydown", this.Ne) } static qe(t) { const e = t.which ? t.which : t.keyCode; return 46 != e && e > 31 && (e < 48 || e > 57) && (t.preventDefault(), !0) } static ze(t) { return Math.floor(Math.max(Number(t.min), Math.min(Number(t.max), Number(t.value)))) } } const { button: rs, div: ls, h2: cs } = z; class ds { constructor(t) { this.N = 0, this.Ge = 0, this._e = 0, this.je = 0, this.R = !1, this.chipData = new Float32Array(64), this.startingChipData = new Float32Array(64), this.Ue = 0, this.We = [], this.m = 768, this.v = 294, this.Ke = B.path({ fill: j.uiWidgetBackground, "pointer-events": "none" }), this.Je = B.svg({ "pointer-events": "none" }), this.Ye = B.svg({ "pointer-events": "none" }), this.Qe = B.svg({ "pointer-events": "none" }), this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: none; overflow: visible;`, width: "100%", height: "100%", viewBox: "0 0 " + this.m + " " + this.v, preserveAspectRatio: "none" }, this.Ke, this.Je, this.Ye, this.Qe), this.container = z.div({ class: "", style: "height: 294px; width: 768px; padding-bottom: 1.5em;" }, this.q), this.Xe = () => { var t = !0; if (this.We.length > 0) for (var e = 0; e < 64; e++)this.We[this.Ue][e] != this.chipData[e] && (t = !1, e = 64); 0 != t && 0 != this.We.length || (this.We.splice(0, this.Ue), this.Ue = 0, this.We.unshift(this.chipData.slice()), this.We.length > 32 && this.We.pop()) }, this.undo = () => { this.Ue < this.We.length - 1 && (this.Ue++, this.chipData = this.We[this.Ue].slice(), new Ot(this.l, this.chipData), this.render()) }, this.redo = () => { this.Ue > 0 && (this.Ue--, this.chipData = this.We[this.Ue].slice(), new Ot(this.l, this.chipData), this.render()) }, this.Ne = t => { 90 == t.keyCode ? (this.undo(), t.stopPropagation()) : 89 == t.keyCode && (this.redo(), t.stopPropagation()) }, this.J = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this._e = -1, this.tt() }, this.X = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this._e = -1, this.tt() }, this.Z = t => { if (null == this.container.offsetParent) return; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.et = t => { if (null == this.container.offsetParent) return; if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.it = t => { this.Xe(), this.R = !1 }, this.l = t; for (let t = 0; t <= 4; t += 2)this.Je.appendChild(B.rect({ fill: j.tonic, x: t * this.m / 4 - 1, y: 0, width: 2, height: this.v })); for (let t = 1; t <= 8; t++)this.Ye.appendChild(B.rect({ fill: j.fifthNote, x: t * this.m / 8 - 1, y: 0, width: 1, height: this.v })); this.Je.appendChild(B.rect({ fill: j.tonic, x: 0, y: this.v / 2 - 1, width: this.m, height: 2 })); for (let t = 0; t < 3; t++)this.Ye.appendChild(B.rect({ fill: j.fifthNote, x: 0, y: 8 * t * (this.v / 49), width: this.m, height: 1 })), this.Ye.appendChild(B.rect({ fill: j.fifthNote, x: 0, y: this.v - 1 - 8 * t * (this.v / 49), width: this.m, height: 1 })); let e = j.getChannelColor(this.l.song, this.l.channel).primaryNote; for (let t = 0; t <= 64; t++) { let i = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].customChipWave[t]; this.chipData[t] = i, this.startingChipData[t] = i, this.Qe.appendChild(B.rect({ fill: e, x: t * this.m / 64, y: (i + 24) * (this.v / 49), width: this.m / 64, height: this.v / 49 })) } this.Xe(), this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it), this.q.addEventListener("keydown", this.Ne), this.container.addEventListener("keydown", this.Ne) } tt() { if (this.R) { const o = Math.min(63, Math.max(0, Math.floor(64 * this.N / this.m))), h = Math.min(48, Math.max(0, Math.floor(49 * this.Ge / this.v))); if (-1 != this._e && this._e != o) { var t = o, e = this._e, i = h, s = this.je; this._e < o && (t = this._e, e = o, i = this.je, s = h); for (var n = t; n <= e; n++) { const o = Math.round(i + (n - t) / (e - t) * (s - i)); this.chipData[n] = o - 24, this.Qe.children[n].setAttribute("y", "" + o * (this.v / 49)) } } else this.chipData[o] = h - 24, this.Qe.children[o].setAttribute("y", "" + h * (this.v / 49)); new Ot(this.l, this.chipData), this._e = o, this.je = h } } render() { for (var t = 0; t < 64; t++)this.Qe.children[t].setAttribute("y", "" + (this.chipData[t] + 24) * (this.v / 49)) } } class ps { constructor(t, e) { this.l = t, this.Ze = e, this.customChipCanvas = new ds(this.l), this.ti = rs({ style: "width: 55%;", type: "button" }), this.Ie = rs({ class: "cancelButton" }), this.Pe = rs({ class: "okayButton", style: "width:45%;" }, "Okay"), this.container = ls({ class: "prompt noSelection", style: "width: 600px;" }, cs("Edit Custom Chip Instrument"), ls({ style: "display: flex; width: 55%; align-self: center; flex-direction: row; align-items: center; justify-content: center;" }, this.ti), ls({ style: "display: flex; flex-direction: row; align-items: center; justify-content: center;" }, this.customChipCanvas.container), ls({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.ei = () => { this.Ze.togglePlay(), this.updatePlayButton() }, this.Ae = () => { this.l.prompt = null, this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.whenKeyPressed), this.ti.removeEventListener("click", this.ei) }, this.whenKeyPressed = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode ? this.Le() : 32 == t.keyCode ? (this.ei(), t.preventDefault()) : 90 == t.keyCode ? (this.customChipCanvas.undo(), t.stopPropagation()) : 89 == t.keyCode ? (this.customChipCanvas.redo(), t.stopPropagation()) : 219 == t.keyCode ? this.l.synth.goToPrevBar() : 221 == t.keyCode && this.l.synth.goToNextBar() }, this.Le = () => { this.l.prompt = null, new Ot(this.l, this.customChipCanvas.startingChipData), this.l.record(new Ot(this.l, this.customChipCanvas.chipData), !0) }, this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.container.addEventListener("keydown", this.whenKeyPressed), this.ti.addEventListener("click", this.ei), this.updatePlayButton(), setTimeout((() => this.ti.focus())), this.customChipCanvas.render() } updatePlayButton() { this.l.synth.playing ? (this.ti.classList.remove("playButton"), this.ti.classList.add("pauseButton"), this.ti.title = "Pause (Space)", this.ti.innerText = "Pause") : (this.ti.classList.remove("pauseButton"), this.ti.classList.add("playButton"), this.ti.title = "Play (Space)", this.ti.innerText = "Play") } } class us { constructor(t, i = !1, s = !1) { if (this.l = t, this.m = 120, this.v = 26, this.ii = B.path({ fill: j.uiWidgetBackground, "pointer-events": "none" }), this.si = [], this.le = [], this.ni = B.path({ fill: "currentColor", "pointer-events": "none" }), this.oi = B.path({ fill: "none", stroke: "currentColor", "stroke-width": 1, "stroke-dasharray": "3, 2", "pointer-events": "none" }), this.hi = B.circle({ fill: "white", stroke: "none", "pointer-events": "none", r: 4 }), this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: none;`, width: "100%", height: "100%", viewBox: "0 0 " + this.m + " " + this.v, preserveAspectRatio: "none" }, this.ii, this.oi, this.hi, this.ni), this.selfUndoSettings = [], this.selfUndoHistoryPos = 0, this.ai = z.div({ style: "position: absolute; bottom: 0; left: 2px; font-size: 8px; line-height: 1; pointer-events: none;" }), this.coordText = null, this.container = z.div({ class: "filterEditor", style: "height: 100%; position: relative;" }, this.q, this.ai), this.ri = 2, this.re = !1, this.li = !1, this.ci = !1, this.N = 0, this.Ge = 0, this.O = !1, this.R = !1, this.di = !1, this.pi = !1, this.ui = !1, this.mi = 2, this.fi = 0, this.yi = 0, this.bi = 0, this.gi = null, this.wi = 0, this.vi = -1, this.ki = -1, this.xi = -1, this.Mi = -1, this.Si = -1, this.Ne = t => { 90 == t.keyCode && (this.undo(), t.stopPropagation()), 89 == t.keyCode && (this.redo(), t.stopPropagation()) }, this.U = t => { this.O = !0, this.li || this.ni.style.setProperty("fill", "currentColor") }, this.K = t => { this.O = !1, this.Fi(), null != this.coordText && (this.coordText.innerText = "") }, this.J = t => { t.preventDefault(), this.ci = !1; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Ci() }, this.X = t => { t.preventDefault(), this.ci = !0; const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Ci() }, this.Z = t => { if (null == this.container.offsetParent) return; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.R || this.Ei(), this.tt() }, this.et = t => { if (null == this.container.offsetParent) return; this.R && t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.R || this.Ei(), this.tt() }, this.it = t => { if (null != this.container.offsetParent) { if (this.R && this.l.lastChangeWas(this.gi) && null != this.gi) { if (this.pi || this.di || this.ci) this.li || this.l.record(this.gi); else if (this.fi < this.ee.controlPointCount && -1 != this.fi) { const t = this.ee.controlPoints[this.fi]; let e = new Te(this.l, this.ee, t, this.fi, this.re, !0); this.li || this.l.record(e) } this.Fi(), this.li && (this.selfUndoSettings.length = this.selfUndoHistoryPos + 1, this.selfUndoSettings.push(JSON.stringify(this.ee.toJsonObject())), this.selfUndoHistoryPos++) } this.gi = null, this.di = !1, this.ui = !1, this.R = !1, this.Ei() } }, this.re = i, this.li = s, this.li) { this.container.addEventListener("keydown", this.Ne), this.m = 1200, this.v = 260, this.ri = 14, this.q.setAttribute("viewBox", "0 -20 " + this.m + " " + (this.v + 30)), this.ai.style.setProperty("font-size", "16px"), this.ai.style.setProperty("position", ""), this.ai.style.setProperty("bottom", "-16px"), this.ai.style.setProperty("min-height", "1em"), this.oi.style.setProperty("stroke-width", "3"), this.oi.style.setProperty("stroke-dasharray", "6, 4"), this.oi.setAttribute("color", j.getChannelColor(this.l.song, this.l.channel).primaryNote), this.container.style.setProperty("width", "85%"), this.hi.setAttribute("r", "20"), this.ni.setAttribute("fill", j.getChannelColor(this.l.song, this.l.channel).primaryNote); for (let t = 0; t < e.filterMaxPoints; t++)this.si[t] = B.text(), this.si[t].setAttribute("fill", j.invertedText), this.si[t].setAttribute("text-anchor", "start"), this.si[t].setAttribute("dominant-baseline", "central"), this.si[t].setAttribute("pointer-events", "none"), this.si[t].setAttribute("font-weight", "bolder"), this.si[t].textContent = "" + (t + 1), this.si[t].style.setProperty("display", "none"), this.si[t].style.setProperty("font-size", "24px"), this.q.appendChild(this.si[t]); const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], i = this.re ? t.noteFilter : t.eqFilter; this.selfUndoSettings.push(JSON.stringify(i.toJsonObject())), this.le[0] = i; for (let i = 1; i < e.filterMorphCount; i++) { const e = this.re ? t.noteSubFilters[i] : t.eqSubFilters[i]; if (null != e) { let t = new bt; t.fromJsonObject(e.toJsonObject()), this.le[i] = t } } } this.container.addEventListener("mousedown", this.J), this.container.addEventListener("mouseover", this.U), this.container.addEventListener("mouseout", this.K), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it) } Ti(t) { return e.filterFreqRange * t / this.m - .5 } Ii(t) { return this.m * (t + .5) / e.filterFreqRange } Pi(t) { return (e.filterGainRange - 1) * (1 - (t - .5) / (this.v - 1)) } Ai(t) { return (this.v - 1) * (1 - t / (e.filterGainRange - 1)) + .5 } Ci() { this.R = !0; const t = new At; this.gi = t, this.l.setProspectiveChange(this.gi), this.Ei(), this.tt() } Ei() { this.yi = this.Ti(this.N), this.bi = this.Pi(this.Ge), this.pi = !0, this.fi = -1; let t = Number.POSITIVE_INFINITY; for (let i = 0; i < this.ee.controlPointCount; i++) { const s = this.ee.controlPoints[i], n = Math.sqrt(Math.pow(this.Ii(s.freq) - this.N, 2) + Math.pow(this.Ai(s.gain) - this.Ge, 2)); (n <= 13 * (+this.li + 1) || this.ee.controlPointCount >= e.filterMaxPoints) && n < t && (t = n, this.fi = i, this.pi = !1) } if (this.pi) { const t = this.N / this.m; this.mi = t < .2 ? 1 : t < .8 ? 2 : 0 } } tt() { if (null != this.gi && this.l.lastChangeWas(this.gi) ? this.gi.undo() : this.R = !1, this.gi = null, this.ui = !1, null != this.coordText && !this.R) { let t = Math.round(this.Pi(this.Ge)), i = Math.round(this.Ti(this.N)); i >= 0 && i < e.filterFreqRange && t >= 0 && t < e.filterGainRange ? this.coordText.innerText = "(" + i + ", " + t + ")" : this.coordText.innerText = "" } if (this.R) { const t = new At; if (this.gi = t, this.l.setProspectiveChange(this.gi), this.pi) { const i = Math.max(0, Math.min(e.filterGainRange - 1, Math.round(this.Pi(this.Ge)))), s = this.Li(this.ee, this.Ti(this.N), -1); if (s >= 0 && s < e.filterFreqRange) { const e = new yt; e.type = this.mi, e.freq = s, e.gain = i, t.append(new Te(this.l, this.ee, e, this.ee.controlPointCount, this.re)), null != this.coordText && (this.coordText.innerText = "(" + s + ", " + i + ")") } else this.ui = !0 } else if (this.fi >= this.ee.controlPointCount || -1 == this.fi) this.gi = null, this.R = !1; else { const i = this.Ti(this.N) - this.yi, s = this.Pi(this.Ge) - this.bi, n = this.ee.controlPoints[this.fi], o = Math.max(0, Math.min(e.filterGainRange - 1, Math.round(n.gain + s))), h = this.Li(this.ee, n.freq + i, this.fi); 0 == Math.round(i) && 0 == Math.round(s) && h == n.freq && o == n.gain || (this.di = !0), h >= 0 && h < e.filterFreqRange ? (t.append(new Ie(this.l, n, n.freq, h, n.gain, o)), null != this.coordText && (this.coordText.innerText = "(" + h + ", " + o + ")")) : (t.append(new Te(this.l, this.ee, n, this.fi, this.re, !0)), this.ui = !0) } } (this.R || this.O) && this.Fi() } Li(t, e, i) { const s = Math.round(e); let n = s, o = s, h = s <= e; for (; ;) { let e = !1; const s = h ? n : o; for (let n = 0; n < t.controlPointCount; n++)if (n != i && t.controlPoints[n].freq == s) { e = !0; break } if (!e) return s; h = !h, h && n--, h || o++ } } static qi(t, e, i, s = !1) { return `M ${t - i} ${e} a ${i} ${i} 0 1 ${s ? 1 : 0} ${2 * i} 0 a ${i} ${i} 0 1 ${s ? 1 : 0} ${2 * -i} 0 ` } Fi() { this.hi.style.display = "none", this.ai.textContent = ""; let t = "", i = ""; for (let s = 0; s < this.ee.controlPointCount; s++) { const n = this.ee.controlPoints[s], o = this.Ii(n.freq), h = this.Ai(n.gain); t += us.qi(o, h, this.ri), 1 == n.type ? i += "M 0 " + h + " L " + o + " " + h + " " : 0 == n.type && (i += "M " + this.m + " " + h + " L " + o + " " + h + " "), this.fi == s && this.O && !this.R && (this.hi.setAttribute("cx", String(o)), this.hi.setAttribute("cy", String(h)), this.hi.style.display = "", null != this.coordText && (this.coordText.innerText = "(" + n.freq + ", " + n.gain + ")")), (this.fi == s || this.pi && this.R && s == this.ee.controlPointCount - 1) && (this.O || this.R) && !this.ui && (this.ai.textContent = s + 1 + ": " + e.filterTypeNames[n.type] + (this.li ? " @" + S(n.getHz()) + "Hz" : "")), this.li && (this.si[s].style.setProperty("display", ""), this.si[s].setAttribute("x", "" + (o - 7)), this.si[s].setAttribute("y", "" + (h + 2))) } if (this.ni.setAttribute("d", t), this.oi.setAttribute("d", i), this.pi && !this.R && this.O && (this.ai.textContent = "+ " + e.filterTypeNames[this.mi]), this.li) for (let t = this.ee.controlPointCount; t < e.filterMaxPoints; t++)this.si[t].style.setProperty("display", "none"); const s = []; for (let t = 0; t < this.ee.controlPointCount; t++) { const e = this.ee.controlPoints[t], i = new X; e.toCoefficients(i, 44800), s.push(i) } const n = new Z; let o = "M 0 " + this.v + " "; for (let t = -1; t <= e.filterFreqRange; t++) { const i = yt.getHzFromSettingValue(t), h = 2 * Math.PI * i / 44800, a = Math.cos(h), r = Math.sin(h); let l = 1; for (const t of s) n.analyzeComplex(t, a, r), l *= n.magnitude(); const c = Math.log2(l) / e.filterGainStep + e.filterGainCenter, d = this.Ai(c); o += "L " + S(this.Ii(t)) + " " + S(d) + " " } o += "L " + this.m + " " + this.v + " L 0 " + this.v + " z ", this.ii.setAttribute("d", o) } swapToSettings(t, e = !1) { const i = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; new Pe(this.l, t, this.ee, this.re, this.le, this.re ? i.noteSubFilters : i.eqSubFilters), this.ee = t, this.le[this.wi] = t, e && this.li && (this.selfUndoSettings.length = this.selfUndoHistoryPos + 1, this.selfUndoSettings.push(JSON.stringify(this.ee.toJsonObject())), this.selfUndoHistoryPos++), this.Fi() } saveSettings() { let t = new bt; const e = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; t.fromJsonObject(JSON.parse(String(this.selfUndoSettings[0]))), this.l.record(new Pe(this.l, this.le[0], t, this.re, this.le, this.re ? e.noteSubFilters : e.eqSubFilters), !0) } undo() { if (this.selfUndoHistoryPos > 0) { if (this.selfUndoHistoryPos--, null != this.selfUndoSettings[this.selfUndoHistoryPos + 1] && this.selfUndoSettings[this.selfUndoHistoryPos + 1].startsWith("jmp")) { let t = this.selfUndoSettings[this.selfUndoHistoryPos + 1], e = +t.substring(3, t.indexOf("|")); return this.swapToSubfilter(this.wi, e), e } if (this.selfUndoSettings[this.selfUndoHistoryPos].startsWith("jmp")) { let t = new bt, e = this.selfUndoSettings[this.selfUndoHistoryPos]; t.fromJsonObject(JSON.parse(e.substring(e.indexOf(":") + 1))), this.swapToSettings(t, !1) } else { let t = new bt; t.fromJsonObject(JSON.parse(String(this.selfUndoSettings[this.selfUndoHistoryPos]))), this.swapToSettings(t, !1) } } return -1 } redo() { if (this.selfUndoHistoryPos < this.selfUndoSettings.length - 1) { if (this.selfUndoHistoryPos++, this.selfUndoSettings[this.selfUndoHistoryPos].startsWith("jmp")) { let t = this.selfUndoSettings[this.selfUndoHistoryPos], e = +t.substring(t.indexOf("|") + 1, t.indexOf(":")); return this.swapToSubfilter(this.wi, e, !1), e } { let t = new bt; t.fromJsonObject(JSON.parse(String(this.selfUndoSettings[this.selfUndoHistoryPos]))), this.swapToSettings(t, !1) } } return -1 } resetToInitial() { this.selfUndoHistoryPos = 1, this.undo() } swapSubfilterIndices(t) { if (-1 == this.fi) return; if (t >= this.ee.controlPointCount) return; let e = this.ee.controlPoints[this.fi]; this.ee.controlPoints[this.fi] = this.ee.controlPoints[t], this.ee.controlPoints[t] = e, this.render() } swapToSubfilter(t, e, i = !1) { if (t != e) { let s = new bt; if (s.fromJsonObject(this.ee.toJsonObject()), this.le[t] = s, null == this.le[e]) { let t = new bt; t.fromJsonObject(this.le[0].toJsonObject()), this.le[e] = t } i && (this.selfUndoSettings.length = this.selfUndoHistoryPos + 1, this.selfUndoSettings.push("jmp" + t + "|" + e + ":" + JSON.stringify(this.le[e].toJsonObject())), this.selfUndoHistoryPos++), this.wi = e, this.swapToSettings(this.le[e], !1) } } render(t = !1) { const i = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], s = this.re ? i.noteFilter : i.eqFilter; let n = t && !this.li && !this.O && !this.di && !this.R && this.l.synth.playing; n ? this.ni.style.setProperty("fill", "" + j.overwritingModSlider) : this.li || this.ni.style.setProperty("fill", "currentColor"), this.ee != s && (this.gi = null, this.R = !1), this.ee = s; let o = s; this.R || this.Ei(), n && (o = this.re ? i.tmpNoteFilterStart : i.tmpEqFilterStart, null == o && (o = this.re ? i.noteFilter : i.eqFilter), this.ee = o); let h = 0, a = 0, r = 0; for (let t = 0; t < o.controlPointCount; t++) { const i = o.controlPoints[t]; h = 3 * h + i.type, a = a * e.filterFreqRange + i.freq, r = r * e.filterGainRange + i.gain } this.vi == this.fi && this.ki == o.controlPointCount && this.xi == h && this.Mi == a && this.Si == r || (this.vi = this.fi, this.ki = o.controlPointCount, this.xi = h, this.Mi = a, this.Si = r, this.Fi()), n && (this.ee = s) } } const { button: ms, div: fs, h2: ys, p: bs } = z; class gs { constructor(t, i, s) { this.l = t, this.Ze = i, this.re = s, this.filterData = new bt, this.startingFilterData = new bt, this.wi = 0, this.ti = ms({ style: "width: 55%;", type: "button" }), this.Di = [], this.Ni = fs({ class: "instrument-bar", style: "justify-content: center;" }), this.Ie = ms({ class: "cancelButton" }), this.Pe = ms({ class: "okayButton", style: "width:45%;" }, "Okay"), this.zi = fs({ style: "width: 100%; display: flex; flex-direction: row; align-items: center; justify-content: center;" }), this.Bi = fs({}, ys("Edit Filter")), this.Ri = ms({ style: "width:86px; margin-right: 5px;", class: "copyButton" }, ["Copy", B.svg({ style: "flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;", width: "2em", height: "2em", viewBox: "-5 -21 26 26" }, [B.path({ d: "M 0 -15 L 1 -15 L 1 0 L 13 0 L 13 1 L 0 1 L 0 -15 z M 2 -1 L 2 -17 L 10 -17 L 14 -13 L 14 -1 z M 3 -2 L 13 -2 L 13 -12 L 9 -12 L 9 -16 L 3 -16 z", fill: "currentColor" })])]), this.Oi = ms({ style: "width:86px;", class: "pasteButton" }, ["Paste", B.svg({ style: "flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;", width: "2em", height: "2em", viewBox: "0 0 26 26" }, [B.path({ d: "M 8 18 L 6 18 L 6 5 L 17 5 L 17 7 M 9 8 L 16 8 L 20 12 L 20 22 L 9 22 z", stroke: "currentColor", fill: "none" }), B.path({ d: "M 9 3 L 14 3 L 14 6 L 9 6 L 9 3 z M 16 8 L 20 12 L 16 12 L 16 8 z", fill: "currentColor" })])]), this.$i = fs({ style: "width: 185px;" }, this.Ri, this.Oi), this.Hi = fs({ style: "text-align: left; margin-bottom: 0px; font-size: x-small; height: 1.3em; color: " + j.secondaryText + ";" }, bs("")), this.container = fs({ class: "prompt noSelection", style: "width: 600px;" }, this.Bi, fs({ style: "display: flex; width: 55%; align-self: center; flex-direction: row; align-items: center; justify-content: center;" }, this.ti), this.Ni, this.zi, fs({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe, this.$i), this.Ie), this.Vi = (t, e = !0, i = !0) => { this.Di[this.wi].classList.remove("selected-instrument"), i && this.filterEditor.swapToSubfilter(this.wi, t, e), this.wi = t, this.Di[t].classList.add("selected-instrument") }, this.Gi = () => { const t = this.re ? this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].noteFilter.toJsonObject() : this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].eqFilter.toJsonObject(); window.localStorage.setItem("filterCopy", JSON.stringify(t)) }, this._i = () => { let t = new bt; t.fromJsonObject(JSON.parse(String(window.localStorage.getItem("filterCopy")))), null != t && this.filterEditor.swapToSettings(t, !0) }, this.Ne = t => { if (90 == t.keyCode) { let e = this.filterEditor.undo(); e >= 0 && this.Vi(e, !1, !1), t.stopPropagation() } if (89 == t.keyCode) { let e = this.filterEditor.redo(); e >= 0 && this.Vi(e, !1, !1), t.stopPropagation() } t.keyCode >= 49 && t.keyCode <= 57 && (t.shiftKey || (this.filterEditor.swapSubfilterIndices(t.keyCode - 49), t.stopPropagation())) }, this.ei = () => { this.Ze.togglePlay(), this.updatePlayButton() }, this.Ae = () => { this.l.prompt = null, this.filterEditor.resetToInitial(), this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.whenKeyPressed), this.ti.removeEventListener("click", this.ei) }, this.whenKeyPressed = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode ? this.Le() : 32 == t.keyCode ? (this.ei(), t.preventDefault()) : 90 == t.keyCode ? (this.filterEditor.undo(), t.stopPropagation()) : 89 == t.keyCode ? (this.filterEditor.redo(), t.stopPropagation()) : 219 == t.keyCode ? this.l.synth.goToPrevBar() : 221 == t.keyCode ? this.l.synth.goToNextBar() : t.keyCode >= 48 && t.keyCode <= 57 && t.shiftKey && this.Vi(t.keyCode - 48) }, this.Le = () => { this.l.prompt = null, this.filterEditor.saveSettings() }, this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.ti.addEventListener("click", this.ei), this.Ri.addEventListener("click", this.Gi), this.Oi.addEventListener("click", this._i), this.updatePlayButton(); let n = j.getChannelColor(this.l.song, this.l.channel); this.filterEditor = new us(t, s, !0), this.zi.appendChild(this.filterEditor.container), this.filterEditor.container.insertBefore(this.Hi, this.filterEditor.container.firstChild), this.filterEditor.coordText = this.Hi, this.Bi.children[0].innerHTML = s ? "Edit Note Filter" : "Edit EQ Filter"; let o = ms({ class: "no-underline", style: "max-width: 5em;" }, "Main"); this.Ni.appendChild(o), this.Di.push(o), o.addEventListener("click", (() => { this.Vi(0) })); for (let t = 1; t < e.filterMorphCount; t++) { let e = ms({ class: "no-underline", style: "max-width: 2em;" }, "" + t); this.Di.push(e), this.Ni.appendChild(e), e.addEventListener("click", (() => { this.Vi(t) })) } this.Di[e.filterMorphCount - 1].classList.add("last-button"), this.Di[0].classList.add("selected-instrument"), this.Ni.style.setProperty("--text-color-lit", n.primaryNote), this.Ni.style.setProperty("--text-color-dim", n.secondaryNote), this.Ni.style.setProperty("--background-color-lit", n.primaryChannel), this.Ni.style.setProperty("--background-color-dim", n.secondaryChannel), this.zi.addEventListener("keydown", this.Ne), this.filterEditor.container.addEventListener("keydown", this.Ne), this.container.addEventListener("keydown", this.Ne), setTimeout((() => this.ti.focus())), this.filterEditor.render() } updatePlayButton() { this.l.synth.playing ? (this.ti.classList.remove("playButton"), this.ti.classList.add("pauseButton"), this.ti.title = "Pause (Space)", this.ti.innerText = "Pause") : (this.ti.classList.remove("pauseButton"), this.ti.classList.add("playButton"), this.ti.title = "Play (Space)", this.ti.innerText = "Play") } } function ws(t, e) { const i = new ArrayBuffer(e); let s = 0, n = Math.min(t.byteLength, i.byteLength); const o = [8, 4, 2, 1]; for (const e of o) if (n >= e) { const o = h(e, t, i, s, n); s = o.nextOffset, n = o.leftBytes } return i; function h(t, e, i, s, n) { let o = Uint8Array; switch (t) { case 8: o = Float64Array; break; case 4: o = Float32Array; break; case 2: o = Uint16Array; break; case 1: default: o = Uint8Array }const h = new o(e, s, n / t | 0), a = new o(i, s, n / t | 0); for (let t = 0; t < a.length; t++)a[t] = h[t]; return { nextOffset: h.byteOffset + h.byteLength, leftBytes: n - a.length * t } } } class vs { constructor(t) { this.ji = 0, this.Ui = 0, this.Wi = new ArrayBuffer(t), this.Ki = new DataView(this.Wi) } Ji(t) { this.Ui += t, this.Ui > this.Wi.byteLength && (this.Wi = ws(this.Wi, Math.max(2 * this.Wi.byteLength, this.Ui)), this.Ki = new DataView(this.Wi)) } getWriteIndex() { return this.ji } rewriteUint32(t, e) { this.Ki.setUint32(t, e >>> 0, !1) } writeUint32(t) { t >>>= 0, this.Ji(4), this.Ki.setUint32(this.ji, t, !1), this.ji = this.Ui } writeUint24(t) { t >>>= 0, this.Ji(3), this.Ki.setUint8(this.ji, t >> 16 & 255), this.Ki.setUint8(this.ji + 1, t >> 8 & 255), this.Ki.setUint8(this.ji + 2, 255 & t), this.ji = this.Ui } writeUint16(t) { t >>>= 0, this.Ji(2), this.Ki.setUint16(this.ji, t, !1), this.ji = this.Ui } writeUint8(t) { t >>>= 0, this.Ji(1), this.Ki.setUint8(this.ji, t), this.ji = this.Ui } writeInt8(t) { t |= 0, this.Ji(1), this.Ki.setInt8(this.ji, t), this.ji = this.Ui } writeMidi7Bits(t) { if ((t >>>= 0) >= 128) throw new Error("7 bit value contained 8th bit!"); this.Ji(1), this.Ki.setUint8(this.ji, t), this.ji = this.Ui } writeMidiVariableLength(t) { if ((t >>>= 0) > 268435455) throw new Error("writeVariableLength value too big."); let e = !1; for (let i = 0; i < 4; i++) { const s = t >>> 21 - 7 * i & 127; 0 == s && 3 != i || (e = !0), e && this.writeUint8((3 == i ? 0 : 128) | s) } } writeMidiAscii(t) { this.writeMidiVariableLength(t.length); for (let e = 0; e < t.length; e++) { const i = t.charCodeAt(e); if (i > 127) throw new Error("Trying to write unicode character as ascii."); this.writeUint8(i) } } toCompactArrayBuffer() { return ws(this.Wi, this.Ui) } } const ks = 8192, xs = { 35: { frequency: 0, duration: 2, volume: 3 }, 36: { frequency: 0, duration: 2, volume: 3 }, 37: { frequency: 5, duration: 1, volume: 3 }, 38: { frequency: 4, duration: 2, volume: 3 }, 39: { frequency: 5, duration: 2, volume: 3 }, 40: { frequency: 4, duration: 2, volume: 3 }, 41: { frequency: 1, duration: 2, volume: 3 }, 42: { frequency: 8, duration: 1, volume: 3 }, 43: { frequency: 1, duration: 2, volume: 3 }, 44: { frequency: 8, duration: 1, volume: 2 }, 45: { frequency: 2, duration: 2, volume: 3 }, 46: { frequency: 8, duration: 4, volume: 3 }, 47: { frequency: 2, duration: 2, volume: 3 }, 48: { frequency: 3, duration: 2, volume: 3 }, 49: { frequency: 7, duration: 4, volume: 3 }, 50: { frequency: 3, duration: 2, volume: 3 }, 51: { frequency: 6, duration: 4, volume: 2 }, 52: { frequency: 7, duration: 4, volume: 3 }, 53: { frequency: 6, duration: 2, volume: 3 }, 54: { frequency: 11, duration: 2, volume: 3 }, 55: { frequency: 9, duration: 4, volume: 3 }, 56: { frequency: 7, duration: 1, volume: 2 }, 57: { frequency: 7, duration: 4, volume: 3 }, 58: { frequency: 10, duration: 2, volume: 2 }, 59: { frequency: 6, duration: 4, volume: 3 }, 69: { frequency: 10, duration: 2, volume: 3 }, 70: { frequency: 10, duration: 2, volume: 3 }, 73: { frequency: 10, duration: 1, volume: 2 }, 74: { frequency: 10, duration: 2, volume: 2 } }; function Ms(t) { return Math.pow(t / 127, 4) / .3844015376046128 } const { button: Ss, div: Fs, h2: Cs, input: Es, select: Ts, option: Is } = z; function Ps(t, e, i) { return t + i * (e - t) } function As(t, e) { if (navigator.msSaveOrOpenBlob) return void navigator.msSaveOrOpenBlob(t, e); const i = document.createElement("a"); if (null != i.download) { const s = URL.createObjectURL(t); setTimeout((function () { URL.revokeObjectURL(s) }), 6e4), i.href = s, i.download = e, setTimeout((function () { i.dispatchEvent(new MouseEvent("click")) }), 0) } else { const e = URL.createObjectURL(t); setTimeout((function () { URL.revokeObjectURL(e) }), 6e4), window.open(e, "_blank") || (window.location.href = e) } } class Ls { constructor(t) { this.l = t, this.outputStarted = !1, this.Yi = Es({ type: "text", style: "width: 10em;", value: "BeepBox-Song", maxlength: 250, autofocus: "autofocus" }), this.Qi = Fs({ style: "width: 10em;" }, new Text("0:00")), this.Xi = Es({ type: "checkbox" }), this.Zi = Es({ style: "width: 2em;", type: "number", min: "1", max: "4", step: "1" }), this.ts = Es({ type: "checkbox" }), this.es = Ts({ style: "width: 100%;" }, Is({ value: "wav" }, "Export to .wav file."), Is({ value: "mp3" }, "Export to .mp3 file."), Is({ value: "midi" }, "Export to .mid file."), Is({ value: "json" }, "Export to .json file."), Is({ value: "html" }, "Export to .html file.")), this.Ie = Ss({ class: "cancelButton" }), this.ss = Ss({ class: "exportButton", style: "width:45%;" }, "Export"), this.ns = Fs({ style: `width: 0%; background: ${j.loopAccent}; height: 100%; position: absolute; z-index: 2;` }), this.os = Fs({ style: "position: relative; top: -1px; z-index: 3;" }, "0%"), this.hs = Fs({ style: `height: 12px; background: ${j.uiWidgetBackground}; display: block; position: relative; z-index: 1;` }, this.ns, this.os), this.container = Fs({ class: "prompt noSelection", style: "width: 200px;" }, Cs("Export Options"), Fs({ style: "display: flex; flex-direction: row; align-items: center; justify-content: space-between;" }, "File name:", this.Yi), Fs({ style: "display: flex; flex-direction: row; align-items: center; justify-content: space-between;" }, "Length:", this.Qi), Fs({ style: "display: table; width: 100%;" }, Fs({ style: "display: table-row;" }, Fs({ style: "display: table-cell;" }, "Intro:"), Fs({ style: "display: table-cell;" }, "Loop Count:"), Fs({ style: "display: table-cell;" }, "Outro:")), Fs({ style: "display: table-row;" }, Fs({ style: "display: table-cell; vertical-align: middle;" }, this.Xi), Fs({ style: "display: table-cell; vertical-align: middle;" }, this.Zi), Fs({ style: "display: table-cell; vertical-align: middle;" }, this.ts))), Fs({ class: "selectContainer", style: "width: 100%;" }, this.es), Fs({ style: "text-align: left;" }, "Exporting can be slow. Reloading the page or clicking the X will cancel it. Please be patient."), this.hs, Fs({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.ss), this.Ie), this.Ae = () => { null != this.synth && (this.synth.renderingSong = !1), this.outputStarted = !1, this.l.undo() }, this.cleanUp = () => { this.Yi.removeEventListener("input", Ls.rs), this.Zi.removeEventListener("blur", Ls.De), this.ss.removeEventListener("click", this.ls), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.ls() }, this.ls = () => { if (1 != this.outputStarted) switch (window.localStorage.setItem("exportFormat", this.es.value), this.es.value) { case "wav": this.outputStarted = !0, this.cs("wav"); break; case "mp3": this.outputStarted = !0, this.cs("mp3"); break; case "midi": this.outputStarted = !0, this.ds(); break; case "json": this.outputStarted = !0, this.ps(); break; case "html": this.us(); break; default: throw new Error("Unhandled file export type.") } }, this.Zi.value = "1", 0 == this.l.song.loopStart ? (this.Xi.checked = !1, this.Xi.disabled = !0) : (this.Xi.checked = !0, this.Xi.disabled = !1), this.l.song.loopStart + this.l.song.loopLength == this.l.song.barCount ? (this.ts.checked = !1, this.ts.disabled = !0) : (this.ts.checked = !0, this.ts.disabled = !1); const e = window.localStorage.getItem("exportFormat"); null != e && (this.es.value = e), this.Yi.select(), setTimeout((() => this.Yi.focus())), this.Yi.addEventListener("input", Ls.rs), this.Zi.addEventListener("blur", Ls.De), this.ss.addEventListener("click", this.ls), this.Ie.addEventListener("click", this.Ae), this.ts.addEventListener("click", (() => { this.Qi.firstChild.textContent = this.samplesToTime(this.l.synth.getTotalSamples(this.Xi.checked, this.ts.checked, +this.Zi.value - 1)) })), this.Xi.addEventListener("click", (() => { this.Qi.firstChild.textContent = this.samplesToTime(this.l.synth.getTotalSamples(this.Xi.checked, this.ts.checked, +this.Zi.value - 1)) })), this.Zi.addEventListener("change", (() => { this.Qi.firstChild.textContent = this.samplesToTime(this.l.synth.getTotalSamples(this.Xi.checked, this.ts.checked, +this.Zi.value - 1)) })), this.container.addEventListener("keydown", this.Ne), this.Yi.value = t.song.title, Ls.rs(null, this.Yi), this.Qi.firstChild.textContent = this.samplesToTime(this.l.synth.getTotalSamples(this.Xi.checked, this.ts.checked, +this.Zi.value - 1)) } samplesToTime(t) { const e = Math.round(t / this.l.synth.samplesPerSecond), i = e % 60; return Math.floor(e / 60) + ":" + (i < 10 ? "0" : "") + i } changeFileName(t) { this.Yi.value = t } static rs(t, e) { let i; if (null != t) i = t.target; else { if (null == e) return; i = e } const s = /[\+\*\$\?\|\{\}\\\/<>#%!`&'"=:@]/gi; if (s.test(i.value)) { let t = i.selectionStart; i.value = i.value.replace(s, ""), t--, i.setSelectionRange(t, t) } } static De(t) { const e = t.target; e.value = Math.floor(Math.max(Number(e.min), Math.min(Number(e.max), Number(e.value)))) + "" } fs() { if (0 == this.outputStarted) return; const t = 5 * this.synth.samplesPerSecond, e = this.currentChunk * t, i = Math.min(t, this.sampleFrames - e), s = new Float32Array(i), n = new Float32Array(i); if (this.synth.renderingSong = !0, this.synth.synthesize(s, n, i), this.recordedSamplesL.set(s, e), this.recordedSamplesR.set(n, e), this.ns.style.setProperty("width", Math.round((this.currentChunk + 1) / this.totalChunks * 100) + "%"), this.os.innerText = Math.round((this.currentChunk + 1) / this.totalChunks * 100) + "%", this.currentChunk++, this.currentChunk >= this.totalChunks) if (this.synth.renderingSong = !1, this.os.innerText = "Encoding...", "wav" == this.thenExportTo) this.ys(); else { if ("mp3" != this.thenExportTo) throw new Error("Unrecognized file export type chosen!"); this.bs() } else setTimeout((() => { this.fs() })) } cs(t) { if (this.thenExportTo = t, this.currentChunk = 0, this.synth = new Et(this.l.song), "wav" == t) this.synth.samplesPerSecond = 48e3; else { if ("mp3" != t) throw new Error("Unrecognized file export type chosen!"); this.synth.samplesPerSecond = 44100 } if (this.ns.style.setProperty("width", "0%"), this.os.innerText = "0%", this.synth.loopRepeatCount = Number(this.Zi.value) - 1, !this.Xi.checked) for (let t = 0; t < this.l.song.loopStart; t++)this.synth.goToNextBar(); this.synth.computeLatestModValues(), this.synth.warmUpSynthesizer(this.l.song), this.sampleFrames = this.synth.getTotalSamples(this.Xi.checked, this.ts.checked, this.synth.loopRepeatCount), this.totalChunks = Math.ceil(this.sampleFrames / (5 * this.synth.samplesPerSecond)), this.recordedSamplesL = new Float32Array(this.sampleFrames), this.recordedSamplesR = new Float32Array(this.sampleFrames), setTimeout((() => { this.fs() })) } ys() { const t = this.recordedSamplesL.length, e = this.synth.samplesPerSecond, i = 2 * t; let s = 0; const n = new ArrayBuffer(44 + 2 * i), o = new DataView(n); o.setUint32(s, 1380533830, !1), s += 4, o.setUint32(s, 36 + 2 * i, !0), s += 4, o.setUint32(s, 1463899717, !1), s += 4, o.setUint32(s, 1718449184, !1), s += 4, o.setUint32(s, 16, !0), s += 4, o.setUint16(s, 1, !0), s += 2, o.setUint16(s, 2, !0), s += 2, o.setUint32(s, e, !0), s += 4, o.setUint32(s, 2 * e * 2, !0), s += 4, o.setUint16(s, 4, !0), s += 2, o.setUint16(s, 16, !0), s += 2, o.setUint32(s, 1684108385, !1), s += 4, o.setUint32(s, 2 * i, !0), s += 4; { const e = 32767; for (let i = 0; i < t; i++) { let t = Math.floor(Math.max(-1, Math.min(1, this.recordedSamplesL[i])) * e), n = Math.floor(Math.max(-1, Math.min(1, this.recordedSamplesR[i])) * e); o.setInt16(s, t, !0), s += 2, o.setInt16(s, n, !0), s += 2 } } As(new Blob([n], { type: "audio/wav" }), this.Yi.value.trim() + ".wav"), this.Ae() } bs() { const t = () => { const t = 1152, e = new window.lamejs.Mp3Encoder(2, this.synth.samplesPerSecond, 192), i = [], s = new Int16Array(this.recordedSamplesL.length), n = new Int16Array(this.recordedSamplesR.length); for (let t = 0; t < this.recordedSamplesL.length; t++)s[t] = Math.floor(32767 * Math.max(-1, Math.min(1, this.recordedSamplesL[t]))), n[t] = Math.floor(32767 * Math.max(-1, Math.min(1, this.recordedSamplesR[t]))); for (let o = 0; o < s.length; o += t) { const h = s.subarray(o, o + t), a = n.subarray(o, o + t), r = e.encodeBuffer(h, a); r.length > 0 && i.push(r) } const o = e.flush(); o.length > 0 && i.push(o); As(new Blob(i, { type: "audio/mp3" }), this.Yi.value.trim() + ".mp3"), this.Ae() }; if ("lamejs" in window) t(); else { var e = document.createElement("script"); e.src = "https://cdn.jsdelivr.net/npm/lamejs@1.2.0/lame.min.js", e.onload = t, document.head.appendChild(e) } } ds() { const t = this.l.song, i = 2 * e.ticksPerPart * e.partsPerBeat, s = 2 * e.ticksPerPart, n = t.getBeatsPerMinute(), o = Math.round(6e7 / n), h = i * t.beatsPerBar, a = 24, r = []; if (this.Xi.checked) for (let e = 0; e < t.loopStart; e++)r.push(e); for (let e = 0; e < Number(this.Zi.value); e++)for (let e = t.loopStart; e < t.loopStart + t.loopLength; e++)r.push(e); if (this.ts.checked) for (let e = t.loopStart + t.loopLength; e < t.barCount; e++)r.push(e); const c = [{ isMeta: !0, channel: -1, midiChannel: -1, isNoise: !1, isDrumset: !1 }]; let d = 0, p = !1; for (let t = 0; t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; t++)if (p || 4 != this.l.song.channels[t].instruments[0].type) { if (d >= 16) continue; c.push({ isMeta: !1, channel: t, midiChannel: d++, isNoise: this.l.song.getChannelIsNoise(t), isDrumset: !1 }), 9 == d && d++ } else c.push({ isMeta: !1, channel: t, midiChannel: 9, isNoise: !0, isDrumset: !0 }), p = !0; const u = new vs(1024); u.writeUint32(1297377380), u.writeUint32(6), u.writeUint16(1), u.writeUint16(c.length), u.writeUint16(i); for (const n of c) { u.writeUint32(1297379947); const { isMeta: c, channel: d, midiChannel: p, isNoise: y, isDrumset: b } = n, g = u.getWriteIndex(); u.writeUint32(0); let w = 0, v = 0; const k = function (t) { if (t < w) throw new Error("Midi event time cannot go backwards."); u.writeMidiVariableLength(t - w), w = t }, x = function (t, e) { if (!(e >= 0 && e <= 127)) throw new Error("Midi control event value out of range: " + e); u.writeUint8(176 | p), u.writeMidi7Bits(t), u.writeMidi7Bits(0 | e) }; if (c) { k(0), u.writeUint8(255), u.writeMidi7Bits(1), u.writeMidiAscii("Composed with jummbus.bitbucket.io"), k(0), u.writeUint8(255), u.writeMidi7Bits(81), u.writeMidiVariableLength(3), u.writeUint24(o), k(0), u.writeUint8(255), u.writeMidi7Bits(88), u.writeMidiVariableLength(4), u.writeUint8(t.beatsPerBar), u.writeUint8(2), u.writeUint8(24), u.writeUint8(8); const i = e.scales[t.scale].flags[3] && !e.scales[t.scale].flags[4], s = t.key; let n = s; for (1 == (1 & s) && (n += 6), i && (n += 9); n > 6;)n -= 12; k(0), u.writeUint8(255), u.writeMidi7Bits(89), u.writeMidiVariableLength(2), u.writeInt8(n), u.writeUint8(i ? 1 : 0), this.Xi.checked && (v += h * t.loopStart), k(v), u.writeUint8(255), u.writeMidi7Bits(6), u.writeMidiAscii("Loop Start"); for (let e = 0; e < parseInt(this.Zi.value); e++)v += h * t.loopLength, k(v), u.writeUint8(255), u.writeMidi7Bits(6), u.writeMidiAscii(e < Number(this.Zi.value) - 1 ? "Loop Repeat" : "Loop End"); if (this.ts.checked && (v += h * (t.barCount - t.loopStart - t.loopLength)), v != h * r.length) throw new Error("Miscalculated number of bars.") } else { let n = y ? "noise channel " + d : "pitch channel " + d; k(0), u.writeUint8(255), u.writeMidi7Bits(3), u.writeMidiAscii(n), k(0), x(101, 0), k(0), x(100, 0), k(0), x(6, a), k(0), x(38, 0), k(0), x(101, 127), k(0), x(100, 127); let o = -1; function m(i) { const s = t.channels[d].instruments[i], n = F.valueToPreset(s.preset); if (o != i) { if (o = i, k(v), u.writeUint8(255), u.writeMidi7Bits(4), u.writeMidiAscii("Instrument " + (i + 1)), !b) { let t = 81; if (null != n && null != n.midiProgram) t = n.midiProgram; else if (4 == s.type) t = 116; else if (2 == s.type || 3 == s.type) t = y ? 116 : 75; else if (0 == s.type) Ls.midiChipInstruments.length > s.chipWave && (t = Ls.midiChipInstruments[s.chipWave]); else if (6 == s.type || 1 == s.type || 5 == s.type) t = 81; else if (7 == s.type) t = 25; else { if (8 != s.type) throw new Error("Unrecognized instrument type."); t = 81 } k(v), u.writeUint8(192 | p), u.writeMidi7Bits(t) } k(v); let t = (h = Et.instrumentVolumeToVolumeMult(s.volume), 127 * Math.pow(.3844015376046128 * h, .25)); x(7, Math.min(127, Math.round(t))), k(v); let a = 63 * (s.pan / e.panCenter - 1) + 64; x(10, Math.min(127, Math.round(a))) } var h } null == t.getPattern(d, 0) && m(0); let c = ks, g = 127, w = !1; const M = y ? e.spectrumBasePitch : e.keys[t.key].basePitch, S = y ? e.noiseInterval : 1; for (const n of r) { const o = t.getPattern(d, n); if (null != o) { const n = o.instruments[0], h = t.channels[d].instruments[n], r = F.valueToPreset(h.preset); m(n); let C = h.getChord().arpeggiates, E = C ? 1 : e.maxChordSize; h.getChord().customInterval && (0 == h.type || 5 == h.type ? (E = 2, C = !0) : 1 == h.type ? E = e.operatorCount : console.error("Unrecognized instrument type for harmonizing arpeggio: " + h.type)); for (let t = 0; t < o.notes.length; t++) { const n = o.notes[t], d = v + n.start * s; let m = d, T = n.pins[0].size, I = n.pins[0].interval; const P = [-1, -1, -1, -1], A = [-1, -1, -1, -1], L = Math.min(E, n.pitches.length), q = b ? Math.max(1, Math.round(90 * n.pins[0].size / e.noteSizeMax)) : 90; let D = n.pickMainInterval(), N = D * S; if (!b) { let t = a, e = -24; for (let i = 1; i < n.pins.length; i++) { const s = n.pins[i].interval * S; t = Math.min(t, s + a), e = Math.max(e, s - a) } N = Math.min(t, Math.max(e, N)) } for (let t = 1; t < n.pins.length; t++) { const o = d + n.pins[t].time * s, w = n.pins[t].size, E = n.pins[t].interval, z = o - m; for (let t = 0; t < z; t++) { const o = m + t, B = Ps(T, w, t / z), R = Ps(I, E, t / z) * S - N, O = Math.max(0, Math.min(16383, Math.round(8192 * (1 + R / a)))), $ = Math.min(127, Math.round((f = Et.noteSizeToVolumeMult(B), 127 * Math.pow(f, .25)))); O != c && (k(o), u.writeUint8(224 | p), u.writeMidi7Bits(127 & O), u.writeMidi7Bits(O >> 7 & 127), c = O), $ == g || b || (k(o), x(11, $), g = $); const H = o == d; for (let t = 0; t < L; t++) { let a = n.pitches[t]; if (b) { a += D; const t = [36, 41, 45, 48, 40, 39, 59, 49, 46, 55, 69, 54]; if (a < 0 || a >= t.length) throw new Error("Could not find corresponding drumset pitch. " + a); a = t[a] } else { if (C && n.pitches.length > t + 1 && t == L - 1) { const r = (o - v) % i, c = e.ticksPerArpeggio * s / e.ticksPerPart, d = Math.floor(r / c); a = n.pitches[t + l(n.pitches.length - t, h.fastTwoNoteArp, d)] } a = M + a * S + N, null != r && null != r.midiSubharmonicOctaves ? a += 12 * r.midiSubharmonicOctaves : y && (a += 12 * +F.presetCategories.dictionary["Drum Presets"].presets.dictionary["taiko drum"].midiSubharmonicOctaves), y && (a *= 2) } a = Math.max(0, Math.min(127, a)), A[t] = a, H || P[t] == A[t] || (k(o), u.writeUint8(128 | p), u.writeMidi7Bits(P[t]), u.writeMidi7Bits(q)) } for (let t = 0; t < L; t++)(H || P[t] != A[t]) && (k(o), u.writeUint8(144 | p), u.writeMidi7Bits(A[t]), u.writeMidi7Bits(q), P[t] = A[t]) } m = o, T = w, I = E } const z = v + n.end * s; for (let t = 0; t < L; t++)k(z), u.writeUint8(128 | p), u.writeMidi7Bits(P[t]), u.writeMidi7Bits(q); w = !0 } } else w && (w = !1, 127 != g && (g = 127, k(v), x(11, g)), c != ks && (c = ks, k(v), u.writeUint8(224 | p), u.writeMidi7Bits(127 & c), u.writeMidi7Bits(c >> 7 & 127))); v += h } } k(v), u.writeUint8(255), u.writeMidi7Bits(47), u.writeMidiVariableLength(0), u.rewriteUint32(g, u.getWriteIndex() - g - 4) } var f; As(new Blob([u.toCompactArrayBuffer()], { type: "audio/midi" }), this.Yi.value.trim() + ".mid"), this.Ae() } ps() { const t = this.l.song.toJsonObject(this.Xi.checked, Number(this.Zi.value), this.ts.checked), e = JSON.stringify(t, null, "\t"); As(new Blob([e], { type: "application/json" }), this.Yi.value.trim() + ".json"), this.Ae() } us() { const t = `<!DOCTYPE html><meta charset="utf-8">\n\nYou should be redirected to the song at:<br /><br />\n\n<a id="destination" href="${new URL("#" + this.l.song.toBase64String(), location.href).href}"></a>\n\n<style>\n\t:root {\n\t\tcolor: white;\n\t\tbackground: black;\n\t\tfont-family:\n\t\tsans-serif;\n\t}\n\ta {\n\t\tcolor: #98f;\n\t}\n\ta[href]::before {\n\t\tcontent: attr(href);\n\t}\n</style>\n\n<script>\n\tlocation.assign(document.querySelector("a#destination").href);\n<\/script>\n`; As(new Blob([t], { type: "text/html" }), this.Yi.value.trim() + ".html"), this.Ae() } } Ls.midiChipInstruments = [74, 71, 80, 70, 68, 81, 81, 81, 81]; class qs { static setLayout(t) { this.h.textContent = this.gs[t] } } qs.gs = { small: "", long: `\n\t\t\t/* long layout */\n\t\t\t@media (min-width: 711px) {\n\t\t\t\t#beepboxEditorContainer {\n\t\t\t\t\tmax-width: initial;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr) 390px; /* minmax(0, 1fr) min-content; Chrome 80 grid layout regression. https://bugs.chromium.org/p/chromium/issues/detail?id=1050307 */\n\t\t\t\t\tgrid-template-rows: minmax(481px, 1fr) minmax(0, min-content);\n\t\t\t\t\tgrid-template-areas: "pattern-area settings-area" "track-area track-area";\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .pattern-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .track-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmin-height: 0;\n\t\t\t\t\tflex: 1;\n\t\t\t\t\toverflow: auto;\n\t\t\t\t\tmax-height: 97.5vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area {\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area > .editor-controls {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .song-settings-area {\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .settings-area {\n\t\t\t\t\twidth: 390px;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr);\n\t\t\t\t\tgrid-template-rows: auto auto auto minmax(0, 1fr);\n\t\t\t\t\tgrid-template-areas:\n\t\t\t\t\t\t"instrument-settings-area version-area"\n\t\t\t\t\t\t"instrument-settings-area play-pause-area"\n\t\t\t\t\t\t"instrument-settings-area menu-area"\n\t\t\t\t\t\t"instrument-settings-area song-settings-area";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .barScrollBar {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor.selectRow {\n\t\t\t\t\theight: 2em;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .operatorRow {\n\t\t\t\t\theiht: 2em;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\tmax-height: 446px;\n\t\t\t\t}\n\n\t\t\t\t.beepboxEditor .trackContainer {\n\t\t\t\t\toverflow: visible;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\tscrollbar-width: auto;\n\t\t\t\t\tscrollbar-color: ${j.uiWidgetBackground} ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar {\n\t\t\t\t\twidth: 20px;\n\t\t\t\t\theight: 20px;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar-track {\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar-thumb {\n\t\t\t\t\tbackground-color: ${j.uiWidgetBackground};\n\t\t\t\t\tborder: 3px solid ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar-corner {\n\t\t\t\t\tbackground-color: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t}\n\t\t`, tall: `\t\t\t/* tall layout */\n\t\t\t@media (min-width: 711px) {\n\t\t\t\t#beepboxEditorContainer {\n\t\t\t\t\tmax-width: initial;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr) 192px;\n\t\t\t\t\tgrid-template-rows: 1fr;\n\t\t\t\t\tgrid-template-areas: "track-area pattern-area settings-area";\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .pattern-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .track-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-direction: column;\n\t\t\t\t\tjustify-content: center;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tmin-height: 0;\n\t\t\t\t\tflex: 0;\n\t\t\t\t\toverflow: auto;\n\t\t\t\t\tflex-basis: initial;\n\t\t\t\t\tflex-grow: 0;\n\t\t\t\t\tmax-height: 97.5vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area > .editor-controls {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .settings-area {\n\t\t\t\t\twidth: 192px;\n\t\t\t\t\tposition: relative;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr);\n\t\t\t\t\tgrid-template-rows: auto auto auto auto minmax(0, 1fr);\n\t\t\t\t\tgrid-template-areas:\n\t\t\t\t\t\t"version-area"\n\t\t\t\t\t\t"play-pause-area"\n\t\t\t\t\t\t"menu-area"\n\t\t\t\t\t\t"song-settings-area"\n\t\t\t\t\t\t"instrument-settings-area";\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .version-area {\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .play-pause-area {\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 22px;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .menu-area {\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 82px;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .barScrollBar {\n\t\t\t\t\tdisplay: none;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackContainer {\n\t\t\t\t\toverflow: visible;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\tscrollbar-width: auto;\n\t\t\t\t\tscrollbar-color: ${j.uiWidgetBackground} ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar {\n\t\t\t\t\twidth: 20px;\n\t\t\t\t\theight: 20px;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar-track {\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar-thumb {\n\t\t\t\t\tbackground-color: ${j.uiWidgetBackground};\n\t\t\t\t\tborder: 3px solid ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer::-webkit-scrollbar-corner {\n\t\t\t\t\tbackground-color: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t}\n\t\t`, wide: `\t\t\t/* wide (JB) layout */\n\t\t\t@media (min-width: 1001px) {\n\t\t\t\t#beepboxEditorContainer {\n\t\t\t\t\tmax-width: initial;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100vh;\n\t\t\t\t\tgrid-template-columns: 512px minmax(0, 1fr) 30em;\n\t\t\t\t\tgrid-template-rows: minmax(481px, 1fr) min-content;\n\t\t\t\t\tgrid-template-areas: "track-area pattern-area settings-area";\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .pattern-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .track-area {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tmax-height: 100%\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .editor-widget-column {\n\t\t\t\t\tflex: 0;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .trackAndMuteContainer {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tflex: 0;\n\t\t\t\t\tflex-basis: initial;\n\t\t\t\t\tflex-grow: 0;\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tmax-height: 97.5vh;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area {\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t\tposition: relative;\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .instrument-settings-area > .editor-controls {\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .song-settings-area {\n\t\t\t\t\toverflow-y: auto;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .settings-area {\n\t\t\t\t\twidth: 30em;\n\t\t\t\t\tgrid-template-columns: minmax(0, 1fr) minmax(0, 1fr);\n\t\t\t\t\tgrid-template-rows: auto auto auto minmax(0, 1fr);\n\t\t\t\t\tgrid-template-areas:\n\t\t\t\t\t\t"instrument-settings-area version-area"\n\t\t\t\t\t\t"instrument-settings-area play-pause-area"\n\t\t\t\t\t\t"instrument-settings-area menu-area"\n\t\t\t\t\t\t"instrument-settings-area song-settings-area";\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .version-area {\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .play-pause-area {\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 22px;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t.beepboxEditor .menu-area {\n\t\t\t\t\tposition: sticky;\n\t\t\t\t\ttop: 82px;\n\t\t\t\t\tz-index: 1;\n\t\t\t\t\tbackground: ${j.editorBackground};\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.beepboxEditor .trackContainer {\n\t\t\t\t\toverflow: visible;\n\t\t\t\t}\n\t\t\t}\n\t\t` }, qs.h = document.head.appendChild(z.style({ type: "text/css" })); class Ds { constructor(t) { this.l = t, this.m = 120, this.v = 26, this.ws = B.svg({ "pointer-events": "none" }), this.vs = B.svg({ "pointer-events": "none" }), this.ks = B.path({ fill: "none", stroke: "currentColor", "stroke-width": 2, "pointer-events": "none" }), this.xs = [], this.Ms = B.svg({ "pointer-events": "none" }), this.q = B.svg({ style: "background-color: ${ColorConfig.editorBackground}; touch-action: none; cursor: crosshair;", width: "100%", height: "100%", viewBox: "0 0 " + this.m + " " + this.v, preserveAspectRatio: "none" }, this.ws, this.vs, this.ks, this.Ms), this.container = z.div({ class: "harmonics", style: "height: 100%;" }, this.q), this.N = 0, this.Ge = 0, this.Ss = 0, this.Fs = 0, this.R = !1, this.Cs = null, this.Es = "", this.Ts = !0, this.J = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Ss = this.Ti(this.N), this.Fs = this.Is(this.Ge), this.tt() }, this.X = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Ss = this.Ti(this.N), this.Fs = this.Is(this.Ge), this.tt() }, this.Z = t => { if (null == this.container.offsetParent) return; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.et = t => { if (null == this.container.offsetParent) return; if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.it = t => { this.R && (this.l.record(this.Cs), this.Cs = null), this.R = !1 }; for (let t = 1; t <= e.harmonicsControlPoints; t *= 2)this.ws.appendChild(B.rect({ fill: j.tonic, x: (t - .5) * (this.m - 8) / (e.harmonicsControlPoints - 1) - 1, y: 0, width: 2, height: this.v })); for (let t = 3; t <= e.harmonicsControlPoints; t *= 2)this.vs.appendChild(B.rect({ fill: j.fifthNote, x: (t - .5) * (this.m - 8) / (e.harmonicsControlPoints - 1) - 1, y: 0, width: 2, height: this.v })); for (let t = 0; t < 4; t++) { const e = B.rect({ fill: "currentColor", x: this.m - 2 * t - 1, y: 0, width: 1, height: this.v }); this.xs.push(e), this.Ms.appendChild(e) } this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it) } Ti(t) { return (e.harmonicsControlPoints - 1) * t / (this.m - 8) - .5 } Is(t) { return e.harmonicsMax * (1 - t / this.v) } tt() { if (this.R) { const t = this.Ti(this.N), i = this.Is(this.Ge), s = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], n = s.harmonicsWave; if (t != this.Ss) { const s = (i - this.Fs) / (t - this.Ss), o = this.Fs - this.Ss * s, h = Math.ceil(Math.min(this.Ss, t)), a = Math.floor(Math.max(this.Ss, t)); for (let t = h; t <= a; t++)t < 0 || t >= e.harmonicsControlPoints || (n.harmonics[t] = Math.max(0, Math.min(e.harmonicsMax, Math.round(t * s + o)))) } n.harmonics[Math.max(0, Math.min(e.harmonicsControlPoints - 1, Math.round(t)))] = Math.max(0, Math.min(e.harmonicsMax, Math.round(i))), this.Ss = t, this.Fs = i, this.Cs = new pe(this.l, s, n), this.l.setProspectiveChange(this.Cs) } } render() { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].harmonicsWave, i = t => (1 - t / e.harmonicsMax) * this.v; let s = S(this.v), n = ""; for (let o = 0; o < e.harmonicsControlPoints - 1; o++) { if (0 == t.harmonics[o]) continue; let h = S((o + .5) * (this.m - 8) / (e.harmonicsControlPoints - 1)); n += "M " + h + " " + s + " ", n += "L " + h + " " + S(i(t.harmonics[o])) + " " } const o = i(t.harmonics[e.harmonicsControlPoints - 1]); for (let t = 0; t < 4; t++) { const e = this.xs[t]; e.setAttribute("y", S(o)), e.setAttribute("height", S(this.v - o)) } this.Es != n && (this.Es = n, this.ks.setAttribute("d", n)), this.Ts != this.l.prefs.showFifth && (this.Ts = this.l.prefs.showFifth, this.vs.style.display = this.l.prefs.showFifth ? "" : "none") } } const { span: Ns } = z; class zs { constructor(t, e, i) { this.input = t, this.l = e, this.Ps = i, this.Cs = null, this.As = "", this.Ls = "", this.qs = () => { this.l.lastChangeWas(this.Cs) || (this.Ls = this.As), this.Cs = this.Ps(this.Ls, this.input.value), this.l.setProspectiveChange(this.Cs) }, this.Ds = () => { this.l.record(this.Cs), this.Cs = null }, t.addEventListener("input", this.qs), t.addEventListener("change", this.Ds) } updateValue(t) { this.As = t, this.input.value = String(t) } } class Bs { constructor(t, e, i, s) { this.input = t, this.l = e, this.Ps = i, this.Cs = null, this.As = 0, this.Ls = 0, this.qs = () => { this.l.lastChangeWas(this.Cs) || (this.Ls = this.As), null != this.Ps && (this.Cs = this.Ps(this.Ls, parseInt(this.input.value)), this.l.setProspectiveChange(this.Cs)) }, this.Ds = () => { null != this.Ps && (this.l.record(this.Cs), this.Cs = null) }, this.container = Ns(s ? { class: "midTick", style: "position: sticky; width: 61.5%;" } : { style: "position: sticky;" }, t), t.addEventListener("input", this.qs), t.addEventListener("change", this.Ds) } updateValue(t) { this.As = t, this.input.value = String(t) } } class Rs { constructor(t) { this.ct = 0, this.Ki = t } getReadIndex() { return this.ct } readUint32() { if (this.ct + 4 > this.Ki.byteLength) throw new Error("Reading past the end of the buffer."); const t = this.Ki.getUint32(this.ct, !1); return this.ct += 4, t } readUint24() { return this.readUint8() << 16 | this.readUint8() << 8 | this.readUint8() } readUint16() { if (this.ct + 2 > this.Ki.byteLength) throw new Error("Reading past the end of the buffer."); const t = this.Ki.getUint16(this.ct, !1); return this.ct += 2, t } readUint8() { if (this.ct + 1 > this.Ki.byteLength) throw new Error("Reading past the end of the buffer."); const t = this.Ki.getUint8(this.ct); return this.ct++, t } readInt8() { if (this.ct + 1 > this.Ki.byteLength) throw new Error("Reading past the end of the buffer."); const t = this.Ki.getInt8(this.ct); return this.ct++, t } peakUint8() { if (this.ct + 1 > this.Ki.byteLength) throw new Error("Reading past the end of the buffer."); return this.Ki.getUint8(this.ct) } readMidi7Bits() { const t = this.readUint8(); return t >= 128 && console.log("7 bit value contained 8th bit! value " + t + ", index " + this.ct), 127 & t } readMidiVariableLength() { let t = 0; for (let e = 0; e < 4; e++) { const e = this.readUint8(); if (t += 127 & e, !(128 & e)) break; t <<= 7 } return t } skipBytes(t) { this.ct += t } hasMore() { return this.Ki.byteLength > this.ct } getReaderForNextBytes(t) { if (this.ct + t > this.Ki.byteLength) throw new Error("Reading past the end of the buffer."); const e = new Rs(new DataView(this.Ki.buffer, this.Ki.byteOffset + this.ct, t)); return this.skipBytes(t), e } } const { button: Os, p: $s, div: Hs, h2: Vs, input: Gs } = z; class _s { constructor(t) { this.l = t, this.Ns = Gs({ type: "file", accept: ".json,application/json,.mid,.midi,audio/midi,audio/x-midi" }), this.Ie = Os({ class: "cancelButton" }), this.container = Hs({ class: "prompt noSelection", style: "width: 300px;" }, Vs("Import"), $s({ style: "text-align: left; margin: 0.5em 0;" }, "BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure."), $s({ style: "text-align: left; margin: 0.5em 0;" }, "BeepBox can also (crudely) import .mid files. There are many tools available for creating .mid files. Shorter and simpler songs are more likely to work well."), this.Ns, this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Ns.removeEventListener("change", this.zs), this.Ie.removeEventListener("click", this.Ae) }, this.zs = () => { const t = this.Ns.files[0]; if (!t) return; const e = t.name.slice(2 + (t.name.lastIndexOf(".") - 1 >>> 0)); if ("json" == e) { const e = new FileReader; e.addEventListener("load", (t => { this.l.prompt = null, this.l.goBackToStart(), this.l.record(new ui(this.l, e.result), !0, !0) })), e.readAsText(t) } else if ("midi" == e || "mid" == e) { const e = new FileReader; e.addEventListener("load", (t => { this.l.prompt = null, this.l.goBackToStart(), this.Bs(e.result) })), e.readAsArrayBuffer(t) } else console.error("Unrecognized file extension."), this.Ae() }, this.Ns.select(), setTimeout((() => this.Ns.focus())), this.Ns.addEventListener("change", this.zs), this.Ie.addEventListener("click", this.Ae) } Bs(t) { const i = new Rs(new DataView(t)); let s = null; const n = []; for (; i.hasMore();) { const t = i.readUint32(), e = i.readUint32(); if (1297377380 == t) null == s ? s = i.getReaderForNextBytes(e) : console.error("This MIDI file has more than one header chunk."); else if (1297379947 == t) { const t = i.getReaderForNextBytes(e); t.hasMore() && n.push({ reader: t, nextEventMidiTick: t.readMidiVariableLength(), ended: !1, runningStatus: -1 }) } else i.skipBytes(e) } if (null == s) return console.error("No header chunk found in this MIDI file."), void this.Ae(); const o = s.readUint16(); s.readUint16(); const h = s.readUint16(); let a = 0; const r = [], l = 2 == o; if (l) r.push(a); else for (let t = 0; t < n.length; t++)r.push(t); const c = [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], d = [255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255], p = [2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2], u = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], m = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], f = [100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100], y = [64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64], b = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], g = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []], w = [[], [], [], [], [], [], [], [], [], [], [], [], [], [], [], []]; let v = 5e5, k = 8, x = 0, M = !1, S = 0; for (; ;) { let t = Number.MAX_VALUE, i = !1; for (const s of r) { const o = n[s]; for (; !o.ended && o.nextEventMidiTick == S;) { const s = 128 & o.reader.peakUint8() ? o.reader.readUint8() : o.runningStatus, h = 240 & s, F = 15 & s; 240 != h && (o.runningStatus = s); let E = !1; switch (h) { case 128: { const t = o.reader.readMidi7Bits(); o.reader.readMidi7Bits(), b[F].push({ midiTick: S, pitch: t, velocity: 0, program: -1, instrumentVolume: -1, instrumentPan: -1, on: !1 }) } break; case 144: { const t = o.reader.readMidi7Bits(), i = o.reader.readMidi7Bits(); if (0 == i) b[F].push({ midiTick: S, pitch: t, velocity: 0, program: -1, instrumentVolume: -1, instrumentPan: -1, on: !1 }); else { const s = Math.max(0, Math.min(e.volumeRange - 1, Math.round(Et.volumeMultToInstrumentVolume(Ms(f[F]))))), n = Math.max(0, Math.min(e.panMax, Math.round(((y[F] - 64) / 63 + 1) * e.panCenter))); b[F].push({ midiTick: S, pitch: t, velocity: Math.max(0, Math.min(1, (i + 14) / 90)), program: m[F], instrumentVolume: s, instrumentPan: n, on: !0 }) } } break; case 160: o.reader.readMidi7Bits(), o.reader.readMidi7Bits(); break; case 176: { const t = o.reader.readMidi7Bits(), e = o.reader.readMidi7Bits(); switch (t) { case 6: 0 == c[F] && 0 == d[F] && (p[F] = e); break; case 7: f[F] = e; break; case 10: y[F] = e; break; case 11: w[F].push({ midiTick: S, size: Et.volumeMultToNoteSize((C = e, Math.pow(C / 127, 4))) }); break; case 38: 0 == c[F] && 0 == d[F] && (u[F] = e); break; case 100: d[F] = e; break; case 101: c[F] = e } } break; case 192: { const t = o.reader.readMidi7Bits(); m[F] = t } break; case 208: o.reader.readMidi7Bits(); break; case 224: { const t = o.reader.readMidi7Bits(), e = ((o.reader.readMidi7Bits() << 7 | t) / 8192 - 1) * (p[F] + .01 * u[F]); g[F].push({ midiTick: S, interval: e }) } break; case 240: if (255 == s) { const t = o.reader.readMidi7Bits(), i = o.reader.readMidiVariableLength(); if (47 == t) E = !0, o.reader.skipBytes(i); else if (81 == t) v = o.reader.readUint24(), o.reader.skipBytes(i - 3); else if (88 == t) { const t = o.reader.readUint8(); let s = o.reader.readUint8(); for (o.reader.readUint8(), o.reader.readUint8(), o.reader.skipBytes(i - 4), k = 4 * t; 0 == (1 & k) && (s > 0 || k > e.beatsPerBarMax) && k >= 2 * e.beatsPerBarMin;)k >>= 1, s -= 1; k = Math.max(e.beatsPerBarMin, Math.min(e.beatsPerBarMax, k)) } else 89 == t ? (x = o.reader.readInt8(), M = 1 == o.reader.readUint8(), o.reader.skipBytes(i - 2)) : o.reader.skipBytes(i) } else { if (240 != s && 247 != s) return console.error("Unrecognized event status: " + s), void this.Ae(); { const t = o.reader.readMidiVariableLength(); o.reader.skipBytes(t) } } break; default: return console.error("Unrecognized event type: " + h), void this.Ae() }!E && o.reader.hasMore() ? o.nextEventMidiTick = S + o.reader.readMidiVariableLength() : (o.ended = !0, l && (a++, a < n.length && (r[0] = a, n[a].nextEventMidiTick += S, t = Math.min(t, n[a].nextEventMidiTick), i = !0))) } o.ended || (i = !0, t = Math.min(t, o.nextEventMidiTick)) } if (!i) break; S = t } var C; const E = Math.max(e.tempoMin, Math.min(e.tempoMax, Math.round(6e7 / v))), T = h / e.partsPerBeat, I = e.partsPerBeat * k, P = Math.ceil(S / T / I); function A(t) { return Math.round(t / T) } let L = x; for (M && (L += 3), 1 == (1 & L) && (L += 6); L < 0;)L += 12; L %= 12; const q = [], D = [], N = []; for (let t = 0; t < 16; t++) { if (0 == b[t].length) continue; const i = new vt, s = F.midiProgramToPresetValue(b[t][0].program), n = null == s ? null : F.valueToPreset(s), o = 9 == t, a = o || null != n && 1 == n.isNoise, r = null != n && 1 == n.isMod, l = a ? e.spectrumBasePitch : e.keys[L].basePitch, c = a ? e.noiseInterval : 1, d = a ? .5 : 1, p = a ? e.drumCount - 1 : e.maxPitch; a ? o ? D.unshift(i) : D.push(i) : r ? N.push(i) : q.push(i); let u = 1, m = 0, f = 0, y = e.panCenter; if (o) { const s = []; let n = -1, o = null, h = 0, a = !1; const r = F.nameToPresetValue("standard drumset"), l = F.valueToPreset(r), c = new wt(!1, !1); c.fromJsonObject(l.settings, !1, !1, !1, !1, 1), c.preset = r, i.instruments.push(c); for (let r = 0; r <= b[t].length; r++) { const l = r == b[t].length ? null : b[t][r], d = null == l ? Number.MAX_SAFE_INTEGER : A(l.midiTick); if (s.length > 0 && d > h && (null == l || l.on)) { const t = Math.floor(h / I), r = t * I; if (n != t || null == o) { for (n++; n < t;)i.bars[n] = 0, n++; o = new ct, i.patterns.push(o), i.bars[n] = i.patterns.length, o.instruments[0] = 0, o.instruments.length = 1 } (!a || c.volume > f) && (c.volume = f, c.pan = y, c.panDelay = 0, a = !0); const l = []; let m = p, b = 0, g = 1; for (const t of s) { const e = xs[t]; -1 == l.indexOf(e.frequency) && l.push(e.frequency), g = Math.max(g, Math.round(e.volume * u)), m = Math.min(m, e.duration), b = Math.max(b, e.duration) } const w = Math.min(b, Math.max(m, 2)), v = h - r, k = Math.min(I, Math.min(d - r, v + 6 * w)), x = new lt(-1, v, k, g, !0); x.pitches.length = 0; for (let t = 0; t < Math.min(e.maxChordSize, l.length); t++) { const i = l[t + Math.max(0, l.length - e.maxChordSize)]; -1 == x.pitches.indexOf(i) && x.pitches.push(i) } o.notes.push(x), s.length = 0 } null != l && l.on && null != xs[l.pitch] && (s.push(l.pitch), h = d, u = l.velocity, f = l.instrumentVolume, y = l.instrumentPan) } } else { let s = 0, n = e.noteSizeMax, o = 0, v = 0; function z(e) { for (; o < g[t].length && g[t][o].midiTick <= e;)s = g[t][o].interval, o++ } function B(e) { for (; v < w[t].length && w[t][v].midiTick <= e;)n = w[t][v].size, v++ } const x = [], M = []; let S = -1, C = null, E = 0, P = 0, L = 0, q = 0; for (let o of b[t]) { const t = o.midiTick, b = A(t); if (M.length > 0 && b > P) { const o = Math.floor(P / I), g = Math.ceil(b / I); let w = !1; for (let v = o; v < g; v++) { const o = v * I, g = v * k * h, A = (v + 1) * k * h, D = Math.max(0, P - o), N = Math.min(I, b - o), R = Math.max(g, E), O = Math.min(A, t); if (D < N) { const t = F.midiProgramToPresetValue(m), h = null == t ? null : F.valueToPreset(t); if (S != v || null == C) { for (S++; S < v;)i.bars[S] = 0, S++; if (C = new ct, i.patterns.push(C), i.bars[S] = i.patterns.length, null == x[m]) { const e = new wt(a, r); x[m] = e, null != t && null != h && 1 == h.isNoise == a ? (e.fromJsonObject(h.settings, a, r, !1, !1, 1), e.preset = t) : (e.setTypeAndReset(r ? 9 : a ? 2 : 0, a, r), e.chord = 0), e.volume = f, e.pan = y, e.panDelay = 0, i.instruments.push(e) } C.instruments[0] = i.instruments.indexOf(x[m]), C.instruments.length = 1 } null != x[m] && (x[m].volume = Math.min(x[m].volume, f), x[m].pan = Math.min(x[m].pan, y)); const b = new lt(-1, D, N, e.noteSizeMax, !1); b.pins.length = 0, b.continuesLastPattern = w && 0 == D, w = !0, z(R), B(R); const g = M[0] * d - l, k = Math.round((g + s) / c), E = Math.round(s - l); let I = rt(0, 0, Math.round(u * n)); b.pins.push(I); const P = [{ part: 0, pitch: k, size: I.size, keyPitch: !1, keySize: !1 }]; let A = 0, $ = (g + s) / c, H = u * n; for (let t = D + 1; t <= N; t++) { const e = Math.max(R, Math.min(O - 1, Math.round(T * (t + o)))), i = t - D, h = t == N; z(e), B(e); const a = (s + g) / c, r = u * n, l = Math.round(a), d = Math.abs(a - l) < .01, p = Math.abs($ - Math.round($)) < .01 ? Math.abs(a - $) >= 1 : Math.floor(a) != Math.floor($), m = d || p, f = Math.round(r), y = Math.abs(r - f) < .01, w = Math.abs(H - Math.round(H)) ? Math.abs(r - H) >= 1 : Math.floor(r) != Math.floor(H), v = y || w; if ($ = a, H = r, m || v || h) { const t = { part: i, pitch: l, size: f, keyPitch: m || h, keySize: v || h }, e = P[A]; let s = !1, n = Number.MAX_VALUE; if (t.keyPitch) { const i = (t.pitch - e.pitch) / (t.part - e.part); let o = Math.abs(i), h = !1, a = Number.MAX_VALUE; for (let t = A + 1; t < P.length; t++) { const s = P[t]; if (s.keyPitch) { const n = e.pitch + i * (s.part - e.part), r = Math.abs(n - s.pitch); o < r && (o = r, h = !0, a = t) } } h && (s = !0, n = Math.min(n, a)) } if (t.keySize) { const i = (t.size - e.size) / (t.part - e.part); let o = Math.abs(i), h = !1, a = Number.MAX_VALUE; for (let t = A + 1; t < P.length; t++) { const s = P[t]; if (s.keySize) { const n = e.size + i * (s.part - e.part), r = Math.abs(n - s.size); o < r && (o = r, h = !0, a = t) } } h && (s = !0, n = Math.min(n, a)) } if (s) { const t = P[n]; b.pins.push(rt(t.pitch - k, t.part, t.size)), A = n } P.push(t) } } const V = P[P.length - 1]; b.pins.push(rt(V.pitch - k, V.part, V.size)); let G = p, _ = 0; for (const t of b.pins) G = Math.min(G, p - t.interval), _ = Math.min(_, -t.interval); b.pitches.length = 0; for (let t = 0; t < Math.min(e.maxChordSize, M.length); t++) { let i = M[t + Math.max(0, M.length - e.maxChordSize)] * d; null != h && null != h.midiSubharmonicOctaves && (i -= 12 * h.midiSubharmonicOctaves); const s = Math.max(_, Math.min(G, Math.round((i + E) / c))); if (-1 == b.pitches.indexOf(s)) { b.pitches.push(s); const t = b.end - b.start; L += s * t, q += t } } C.notes.push(b) } } } -1 != M.indexOf(o.pitch) && M.splice(M.indexOf(o.pitch), 1), o.on && (M.push(o.pitch), u = o.velocity, m = o.program, f = o.instrumentVolume, y = o.instrumentPan), E = t, P = b } const D = L / q; i.octave = a || r ? 0 : Math.max(0, Math.min(e.pitchOctaves - 1, Math.floor(D / 12))) } for (; i.bars.length < P;)i.bars.push(0) } function R(t, e) { for (; t.length > e;) { let e = t.length - 2, i = t.length - 1, s = Number.MAX_VALUE, n = Number.MAX_VALUE; for (let o = 0; o < t.length - 1; o++)for (let h = o + 1; h < t.length; h++) { const a = t[o], r = t[h]; let l = 0, c = 0; for (let t = 0; t < a.bars.length && t < r.bars.length; t++)0 != a.bars[t] && 0 != r.bars[t] && l++, 0 == a.bars[t] && 0 == r.bars[t] && c++; l <= s && (l < s || c < n) && (e = o, i = h, s = l, n = c) } const o = t[e], h = t[i], a = o.instruments.length, r = o.patterns.length; for (const t of h.instruments) o.instruments.push(t); for (const t of h.patterns) t.instruments[0] += a, o.patterns.push(t); for (let t = 0; t < o.bars.length && t < h.bars.length; t++)0 == o.bars[t] && 0 != h.bars[t] && (o.bars[t] = h.bars[t] + r); t.splice(i, 1) } } R(q, e.pitchChannelCountMax), R(D, e.noiseChannelCountMax), R(N, e.modChannelCountMax); this.l.goBackToStart(); for (const t of this.l.song.channels) t.muted = !1; this.l.prompt = null, this.l.record(new class extends Pt { constructor(t) { super(); const e = t.song; e.tempo = E, e.beatsPerBar = k, e.key = L, e.scale = 11, e.rhythm = 1, e.layeredInstruments = !1, e.patternInstruments = q.some((t => t.instruments.length > 1)) || D.some((t => t.instruments.length > 1)), bi(q), bi(D), bi(N), this.append(new fi(t, q, D, N)), e.loopStart = 0, e.loopLength = e.barCount, this.It(), t.notifier.changed() } }(this.l), !0, !0) } } const { button: js, label: Us, div: Ws, form: Ks, h2: Js, input: Ys } = z; class Qs { constructor(t) { this.l = t, this.Ns = Ys({ type: "file", accept: ".json,application/json,.mid,.midi,audio/midi,audio/x-midi" }), this.Pe = js({ class: "okayButton", style: "width:45%;" }, "Okay"), this.Ie = js({ class: "cancelButton" }), this.Rs = Ks({ style: "display: flex; gap: 10px;" }, Us({ class: "layout-option" }, Ys({ type: "radio", name: "layout", value: "small" }), B('\t\t\t\t\t<svg viewBox="-4 -1 28 22">\n\t\t\t\t\t\t<rect x="0" y="0" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1"/>\n\t\t\t\t\t\t<rect x="2" y="2" width="11" height="10" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="14" y="2" width="4" height="16" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="2" y="13" width="11" height="5" fill="currentColor"/>\n\t\t\t\t\t</svg>\n\t\t\t\t'), Ws("Small")), Us({ class: "layout-option" }, Ys({ type: "radio", name: "layout", value: "long" }), B('\t\t\t\t\t<svg viewBox="-1 -1 28 22">\n\t\t\t\t\t\t<rect x="0" y="0" width="26" height="20" fill="none" stroke="currentColor" stroke-width="1"/>\n\t\t\t\t\t\t<rect x="2" y="2" width="12" height="10" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="15" y="2" width="4" height="10" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="20" y="2" width="4" height="10" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="2" y="13" width="22" height="5" fill="currentColor"/>\n\t\t\t\t\t</svg>\n\t\t\t\t'), Ws("Long")), Us({ class: "layout-option" }, Ys({ type: "radio", name: "layout", value: "tall" }), B('\t\t\t\t\t<svg viewBox="-1 -1 28 22">\n\t\t\t\t\t\t<rect x="0" y="0" width="26" height="20" fill="none" stroke="currentColor" stroke-width="1"/>\n\t\t\t\t\t\t<rect x="11" y="2" width="8" height="16" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="20" y="2" width="4" height="16" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="2" y="2" width="8" height="16" fill="currentColor"/>\n\t\t\t\t\t</svg>\n\t\t\t\t'), Ws("Tall")), Us({ class: "layout-option" }, Ys({ type: "radio", name: "layout", value: "wide" }), B('\t\t\t\t\t<svg viewBox="-1 -1 28 22">\n\t\t\t\t\t\t<rect x="0" y="0" width="26" height="20" fill="none" stroke="currentColor" stroke-width="1"/>\n\t\t\t\t\t\t<rect x="2" y="2" width="4" height="16" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="18" y="2" width="2.5" height="16" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="21.5" y="2" width="2.5" height="16" fill="currentColor"/>\n\t\t\t\t\t\t<rect x="7" y="2" width="10" height="16" fill="currentColor"/>\n\t\t\t\t\t</svg>\n\t\t\t\t'), Ws("Wide (JB)"))), this.container = Ws({ class: "prompt noSelection", style: "width: 300px;" }, Js("Layout"), this.Rs, Ws({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Os), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Os() }, this.Os = () => { this.l.prefs.layout = this.Rs.elements.layout.value, this.l.prefs.save(), qs.setLayout(this.l.prefs.layout), this.Ae() }, this.Ns.select(), setTimeout((() => this.Ns.focus())), this.Pe.addEventListener("click", this.Os), this.Ie.addEventListener("click", this.Ae), this.container.addEventListener("keydown", this.Ne), this.Rs.elements.layout.value = this.l.prefs.layout } } class Xs { constructor(t) { this.l = t, this.container = z.div({ class: "envelopeEditor" }), this.$s = [], this.Hs = [], this.Vs = [], this.Gs = [], this._s = 0, this.js = -1, this.Us = -1, this.Ws = 0, this.Ks = t => { const i = this.Hs.indexOf(t.target), s = this.Vs.indexOf(t.target); if (-1 != i) { const t = parseInt(this.Hs[i].value), s = t % e.instrumentAutomationTargets.length, n = t / e.instrumentAutomationTargets.length >>> 0; this.l.record(new _i(this.l, i, s, n)) } else -1 != s && this.l.record(new ji(this.l, s, this.Vs[s].selectedIndex)) }, this.Js = t => { const e = this.Gs.indexOf(t.target); -1 != e && this.l.record(new Gi(this.l, e)) }, this.container.addEventListener("change", this.Ks), this.container.addEventListener("click", this.Js) } Ys(t, i) { let s = e.instrumentAutomationTargets[t].displayName; return e.instrumentAutomationTargets[t].maxCount > 1 && (-1 != s.indexOf("#") ? s = s.replace("#", String(i + 1)) : s += " " + (i + 1)), z.option({ value: t + i * e.instrumentAutomationTargets.length }, s) } Qs(t, i) { for (let s = 0; s < t.childElementCount; s++) { const n = t.children[s], o = parseInt(n.value), h = o % e.instrumentAutomationTargets.length, a = o / e.instrumentAutomationTargets.length >>> 0; n.hidden = !i.supportsEnvelopeTarget(h, a) } } render() { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; for (let i = this.$s.length; i < t.envelopeCount; i++) { const t = z.select(); for (let i = 0; i < e.instrumentAutomationTargets.length; i++) { const s = e.instrumentAutomationTargets[i].interleave; for (let n = 0; n < e.instrumentAutomationTargets[i].maxCount; n++)t.appendChild(this.Ys(i, n)), s && t.appendChild(this.Ys(i + 1, n)); s && i++ } const s = z.select(); for (let t = 0; t < e.envelopes.length; t++)s.appendChild(z.option({ value: t }, e.envelopes[t].name)); const n = z.button({ type: "button", class: "delete-envelope" }), o = z.div({ class: "envelope-row" }, z.div({ class: "selectContainer", style: "width: 0; flex: 1;" }, t), z.div({ class: "selectContainer", style: "width: 0; flex: 0.7;" }, s), n); this.container.appendChild(o), this.$s[i] = o, this.Hs[i] = t, this.Vs[i] = s, this.Gs[i] = n } for (let e = this._s; e < t.envelopeCount; e++)this.$s[e].style.display = "", this.Qs(this.Hs[e], t); for (let e = t.envelopeCount; e < this._s; e++)this.$s[e].style.display = "none"; let i = t.noteFilter.controlPointCount; if (t.noteFilterType && (i = 1), this.js != t.eqFilter.controlPointCount || this.Us != i || this.Xs != t.type || this.Ws != t.effects) for (let e = 0; e < this._s; e++)this.Qs(this.Hs[e], t); for (let i = 0; i < t.envelopeCount; i++)this.Hs[i].value = String(t.envelopes[i].target + t.envelopes[i].index * e.instrumentAutomationTargets.length), this.Vs[i].selectedIndex = t.envelopes[i].envelope; this._s = t.envelopeCount, this.js = t.eqFilter.controlPointCount, this.Us = i, this.Xs = t.type, this.Ws = t.effects } } class Zs { constructor(t) { this.l = t, this.m = 120, this.v = 26, this.Zs = B.path({ fill: j.uiWidgetBackground, "pointer-events": "none" }), this.oi = B.path({ fill: "none", stroke: "currentColor", "stroke-width": 1, "stroke-dasharray": "3, 2", "pointer-events": "none" }), this.tn = B.path({ fill: "none", stroke: "currentColor", "stroke-width": 2, "pointer-events": "none" }), this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: none; cursor: crosshair;`, width: "100%", height: "100%", viewBox: "0 0 " + this.m + " " + this.v, preserveAspectRatio: "none" }, this.Zs, this.oi, this.tn), this.container = z.div({ class: "fadeInOut", style: "height: 100%;" }, this.q), this.N = 0, this.en = 0, this.R = !1, this.di = !1, this.sn = !1, this.gi = null, this.nn = -1, this.hn = -1, this.J = t => { t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - e.left, this.Ci() }, this.X = t => { t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - e.left, this.Ci() }, this.Z = t => { if (null == this.container.offsetParent) return; const e = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - e.left, isNaN(this.N) && (this.N = 0), this.tt() }, this.et = t => { if (null == this.container.offsetParent) return; if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - e.left, isNaN(this.N) && (this.N = 0), this.tt() }, this.it = t => { if (null != this.container.offsetParent) { if (this.R && this.l.lastChangeWas(this.gi) && null != this.gi) if (this.di) this.l.record(this.gi); else { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; this.sn ? this.l.record(new Ae(this.l, this.an(this.N), t.fadeOut)) : this.l.record(new Ae(this.l, t.fadeIn, this.rn(this.N))) } this.gi = null, this.di = !1, this.R = !1 } }; const i = this.ln(e.fadeOutNeutral); this.oi.setAttribute("d", `M ${i} 0 L ${i} ${this.v}`), this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it) } cn(t) { return 1 + .4 * (this.m - 2) * t / (e.fadeInRange - 1) } an(t) { return it(0, e.fadeInRange, Math.round((t - 1) * (e.fadeInRange - 1) / (.4 * this.m - 2))) } ln(t) { return 1 + (this.m - 2) * (.5 + .5 * t / (e.fadeOutTicks.length - 1)) } rn(t) { return it(0, e.fadeOutTicks.length, Math.round((e.fadeOutTicks.length - 1) * ((t - 1) / (this.m - 2) - .5) / .5)) } Ci() { isNaN(this.N) && (this.N = 0), this.en = this.N, this.R = !0, this.di = !1; const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], e = this.cn(t.fadeIn), i = this.ln(t.fadeOut); this.sn = this.en < (e + i) / 2, this.gi = new At, this.l.setProspectiveChange(this.gi) } tt() { if (null != this.gi && this.l.lastChangeWas(this.gi) ? this.gi.undo() : this.R = !1, this.gi = null, this.R) { const t = new At; if (this.gi = t, this.l.setProspectiveChange(this.gi), Math.abs(this.N - this.en) > 4 && (this.di = !0), this.di) { const e = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; this.sn ? t.append(new Ae(this.l, this.an(this.cn(e.fadeIn) + this.N - this.en), e.fadeOut)) : t.append(new Ae(this.l, e.fadeIn, this.rn(this.ln(e.fadeOut) + this.N - this.en))) } } } render() { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; if (this.nn == t.fadeIn && this.hn == t.fadeOut) return; const i = this.cn(t.fadeIn), s = this.ln(t.fadeOut); this.tn.setAttribute("d", `M ${i} 0 L ${i} ${this.v} M ${s} 0 L ${s} ${this.v}`); const n = this.ln(e.fadeOutNeutral); let o = ""; o += `M 0 ${this.v} `, o += `L ${i} 0 `, Et.fadeOutSettingToTicks(t.fadeOut) > 0 ? (o += `L ${n} 0 `, o += `L ${s} ${this.v} `) : (o += `L ${s} 0 `, o += `L ${n} ${this.v} `), o += "z", this.Zs.setAttribute("d", o) } } const { button: tn, div: en, h2: sn, input: nn } = z; class on { constructor(t) { this.m = 200, this.v = 52, this.Ke = B.path({ fill: j.uiWidgetBackground, "pointer-events": "none" }), this.Je = B.svg({ "pointer-events": "none" }), this.Ye = B.svg({ "pointer-events": "none" }), this.dn = B.path({ fill: "none", stroke: j.textSelection, "stroke-width": 2, "pointer-events": "none" }), this.pn = B.circle({ fill: j.textSelection, stroke: "none", r: "3" }), this.un = B.path({ fill: "none", stroke: j.primaryText, "stroke-width": 2, "pointer-events": "none" }), this.mn = B.path({ fill: "none", stroke: j.linkAccent, "stroke-width": 2, "pointer-events": "none" }), this.fn = B.circle({ fill: j.linkAccent, stroke: "none", r: "3" }), this.yn = B.text({ x: "-1.5%", y: "148.5%", "pointer-events": "none", "font-size": "7pt", fill: "var(--secondary-text)" }, "0"), this.bn = B.text({ x: "48.2%", y: "148.5%", "pointer-events": "none", "font-size": "7pt", fill: "var(--secondary-text)" }, "1"), this.gn = B.text({ x: "98.2%", y: "148.5%", "pointer-events": "none", "font-size": "7pt", fill: "var(--secondary-text)" }, "2"), this.wn = B.text({ x: "-5%", y: "113.5%", "pointer-events": "none", "font-size": "6pt", fill: "var(--secondary-text)" }, "In"), this.vn = B.text({ x: "-9%", y: "131%", "pointer-events": "none", "font-size": "6pt", fill: "var(--secondary-text)" }, "Out"), this.kn = B.text({ x: "42%", y: "172%", "pointer-events": "none", "font-size": "7pt", fill: "var(--primary-text)" }, "Volume"), this.xn = B.text({ x: "55.2%", y: "160%", "pointer-events": "none", "font-size": "7pt", transform: "rotate(-90 30,120)", fill: "var(--primary-text)" }, "Gain"), this.Mn = B.rect({ "pointer-events": "none", width: "100%", height: "6px", x: "0%", y: "105%", fill: j.uiWidgetBackground }), this.Sn = B.rect({ "pointer-events": "none", width: "100%", height: "6px", x: "0%", y: "120%", fill: j.uiWidgetBackground }), this.Fn = B.rect({ "pointer-events": "none", height: "6px", x: "0%", y: "105%", fill: "url('#volumeGrad')" }), this.Cn = B.rect({ "pointer-events": "none", width: "2px", height: "6px", y: "105%", fill: j.uiWidgetFocus }), this.En = B.rect({ "pointer-events": "none", height: "6px", x: "0%", y: "120%", fill: "url('#volumeGrad')" }), this.Tn = B.rect({ "pointer-events": "none", width: "2px", height: "6px", y: "120%", fill: j.uiWidgetFocus }), this.In = B.stop({ "stop-color": "lime", offset: "30%" }), this.Pn = B.stop({ "stop-color": "orange", offset: "45%" }), this.An = B.stop({ "stop-color": "red", offset: "50%" }), this.Ln = B.linearGradient({ id: "volumeGrad", gradientUnits: "userSpaceOnUse" }, this.In, this.Pn, this.An), this.qn = B.defs({}, this.Ln), this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: none; overflow: visible;`, width: "100%", height: "100%", viewBox: "0 0 " + this.m + " " + this.v, preserveAspectRatio: "none" }, this.qn, this.Ke, this.Je, this.Ye, this.dn, this.un, this.mn, this.pn, this.fn, this.yn, this.bn, this.gn, this.wn, this.vn, this.kn, this.xn, this.Mn, this.Sn, this.Fn, this.En, this.Cn, this.Tn), this.container = z.div({ class: "", style: "height: 4em; width: 80%; padding-bottom: 1.5em;" }, this.q); for (let t = 0; t <= 2; t++)this.Je.appendChild(B.rect({ fill: j.tonic, x: t * this.m / 2 - 1, y: 0, width: 2, height: this.v })); for (let t = 1; t <= 3; t += 2)this.Ye.appendChild(B.rect({ fill: j.fifthNote, x: t * this.m / 4 - 1, y: 0, width: 1, height: this.v })); this.Dn = t } animateVolume(t, e, i, s) { this.Fn.setAttribute("width", "" + Math.min(this.m, t * (this.m / 2))), this.Cn.setAttribute("x", "" + Math.min(this.m, e * (this.m / 2))), this.En.setAttribute("width", "" + Math.min(this.m, i * (this.m / 2))), this.Tn.setAttribute("x", "" + Math.min(this.m, s * (this.m / 2))) } render() { const t = t => Math.max(0, (1 - t / 5) * (this.v - 1) + 1); let e = 0, i = 0, s = -1, n = "", o = ["", "", ""]; for (let h = 0; h < 64; h++) { let a = +this.Dn.limitRatioSlider.value; a = a < 10 ? a / 10 : a - 9; let r = +this.Dn.compressionRatioSlider.value; r = r < 10 ? r / 10 : 1 + (r - 10) / 60; let l = +this.Dn.limitThresholdSlider.value, c = +this.Dn.compressionThresholdSlider.value, d = 2 * h / 64, p = 1 / 1.05; d >= l ? p = 1 / (1.05 * (d + 1 - l) * a + (1 - a)) : d < c && (p = 1 / ((.8 * (d + 1 - c) + .25) * r + 1.05 * (1 - r))), 0 == h && (n += "M 0 " + S(t(p)) + " "), i > s && (s >= 0 && (o[s] += "L " + S(h * this.m / 64) + " " + S(t(p)) + " "), o[i] += "M " + S(h * this.m / 64) + " " + S(t(p)) + " ", (1 == i || 0 == s && 2 == i) && (this.pn.setAttribute("cx", S(h * this.m / 64)), this.pn.setAttribute("cy", S(t(p)))), 2 == i && (this.fn.setAttribute("cx", S(h * this.m / 64)), this.fn.setAttribute("cy", S(t(p)))), s = i), 0 != e || 0 != p ? (n += "L ", o[i] += "L ") : (n += "M ", o[i] += "M "), n += S(h * this.m / 64) + " " + S(t(p)) + " ", o[i] += S(h * this.m / 64) + " " + S(t(p)) + " ", e = p, 0 == i && h >= 32 * c - 2 && i++, 1 == i && h >= 32 * l - 2 && i++ } const h = t(e); e > 0 && (n += "L " + (this.m - 1) + " " + S(h) + " ", o[i] += "L " + (this.m - 1) + " " + S(h) + " "), this.dn.setAttribute("d", o[0]), this.un.setAttribute("d", o[1]), this.mn.setAttribute("d", o[2]), this.Ke.setAttribute("d", n + "L " + this.m + " " + S(h) + " L " + this.m + " " + S(this.v) + " L 0 " + S(this.v) + " z ") } } class hn { constructor(t, e) { this.l = t, this.Ze = e, this.limiterCanvas = new on(this), this.ti = tn({ style: "width: 55%;", type: "button" }), this.limitDecaySlider = nn({ title: "limit decay", style: "width: 5em; flex-grow: 1; margin: 0;", type: "range", min: "1", max: "30", value: "4", step: "1" }), this.limitRiseSlider = nn({ title: "limit rise", style: "width: 5em; flex-grow: 1; margin: 0;", type: "range", min: "2000", max: "10000", value: "4000", step: "250" }), this.compressionThresholdSlider = nn({ title: "compressor threshold", style: "width: 100%; flex-grow: 1; margin: 0;", type: "range", min: "0", max: "1.1", value: "1", step: "0.05" }), this.limitThresholdSlider = nn({ title: "limiter threshold", style: "width: 100%; flex-grow: 1; margin: 0;", type: "range", min: "0", max: "2", value: "1", step: "0.05" }), this.compressionRatioSlider = nn({ title: "compressor ratio", style: "width: 100%; flex-grow: 1; margin: 0;", type: "range", min: "0", max: "20", value: "10", step: "1" }), this.limitRatioSlider = nn({ title: "limiter ratio", style: "width: 100%; flex-grow: 1; margin: 0;", type: "range", min: "0", max: "20", value: "10", step: "1" }), this.masterGainSlider = nn({ title: "master gain", style: "width: 5em; flex-grow: 1; margin: 0;", type: "range", min: "0", max: "5", value: "1", step: "0.02" }), this.inVolumeHistoricTimer = 0, this.inVolumeHistoricCap = 0, this.outVolumeHistoricTimer = 0, this.outVolumeHistoricCap = 0, this.Ie = tn({ class: "cancelButton" }), this.Pe = tn({ class: "okayButton", style: "width:45%;" }, "Okay"), this.Nn = tn({ style: "width:45%;" }, "Reset"), this.container = en({ class: "prompt noSelection", style: "width: 250px;" }, sn("Limiter Options"), en({ style: "display: flex; width: 55%; align-self: center; flex-direction: row; align-items: center; justify-content: center;" }, this.ti), en({ style: "display: flex; flex-direction: row; align-items: center; justify-content: center;" }, this.limiterCanvas.container), en({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; margin-top: 1.5em; justify-content: flex-end;" }, en({ style: `text-align: right; width: 25%; margin-right: 4.5%; color: ${j.primaryText};` }, ""), en({ style: `text-align: center; width: 33%; margin-right: 4.5%; color: ${j.textSelection};` }, "Boost"), en({ style: `text-align: center; width: 33%; margin-right: 0%; color: ${j.linkAccent};` }, "Cutoff")), en({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; margin-top: 0.5em; justify-content: flex-end;" }, en({ style: `text-align: right; width: 25%; margin-right: 4.5%; color: ${j.primaryText};` }, "Threshold:"), en({ style: "width: 33%; margin-right: 4.5%;" }, this.compressionThresholdSlider), en({ style: "width: 33%; margin-right: 0%;" }, this.limitThresholdSlider)), en({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, en({ style: `text-align: right; width: 25%; margin-right: 4.5%; color: ${j.primaryText};` }, "Ratio:"), en({ style: "width: 33%; margin-right: 4.5%;" }, this.compressionRatioSlider), en({ style: "width: 33%; margin-right: 0%;" }, this.limitRatioSlider)), en({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, en({ style: `text-align: right; width: 8.5em; margin-right: 1em; color: ${j.primaryText};` }, "Limit Decay:"), this.limitDecaySlider), en({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, en({ style: `text-align: right; width: 8.5em; margin-right: 1em; color: ${j.primaryText};` }, "Limit Rise:"), this.limitRiseSlider), en({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, en({ style: `text-align: right; width: 8.5em; margin-right: 1em; color: ${j.primaryText};` }, "Master Gain:"), this.masterGainSlider), en({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe, this.Nn), this.Ie), this.zn = () => { this.inVolumeHistoricTimer--, this.inVolumeHistoricTimer <= 0 && (this.inVolumeHistoricCap -= .03), this.l.song.inVolumeCap > this.inVolumeHistoricCap && (this.inVolumeHistoricCap = this.l.song.inVolumeCap, this.inVolumeHistoricTimer = 50), this.outVolumeHistoricTimer--, this.outVolumeHistoricTimer <= 0 && (this.outVolumeHistoricCap -= .03), this.l.song.outVolumeCap > this.outVolumeHistoricCap && (this.outVolumeHistoricCap = this.l.song.outVolumeCap, this.outVolumeHistoricTimer = 50), this.limiterCanvas.animateVolume(this.l.song.inVolumeCap, this.inVolumeHistoricCap, this.l.song.outVolumeCap, this.outVolumeHistoricCap), window.requestAnimationFrame(this.zn) }, this.ei = () => { this.Ze.togglePlay(), this.updatePlayButton() }, this.qs = () => { +this.limitThresholdSlider.value < +this.compressionThresholdSlider.value && (this.limitThresholdSlider.removeEventListener("input", this.Bn), this.limitThresholdSlider.value = this.compressionThresholdSlider.value, this.limitThresholdSlider.addEventListener("input", this.Bn)), this.limiterCanvas.render(), this.Rn() }, this.Bn = () => { +this.limitThresholdSlider.value < +this.compressionThresholdSlider.value && (this.compressionThresholdSlider.removeEventListener("input", this.qs), this.compressionThresholdSlider.value = this.limitThresholdSlider.value, this.compressionThresholdSlider.addEventListener("input", this.qs)), this.limiterCanvas.render(), this.Rn() }, this.Ae = () => { this.limitRatioSlider.value = "" + this.startingLimitRatio, this.compressionRatioSlider.value = "" + this.startingCompressionRatio, this.limitThresholdSlider.value = "" + this.startingLimitThreshold, this.compressionThresholdSlider.value = "" + this.startingCompressionThreshold, this.limitDecaySlider.value = "" + this.startingLimitDecay, this.limitRiseSlider.value = "" + this.startingLimitRise, this.masterGainSlider.value = "" + this.startingMasterGain, this.Rn(), this.l.prompt = null }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Nn.removeEventListener("click", this.On), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.whenKeyPressed), this.limitDecaySlider.removeEventListener("input", this.qs), this.limitRiseSlider.removeEventListener("input", this.qs), this.limitThresholdSlider.removeEventListener("input", this.Bn), this.limitRatioSlider.removeEventListener("input", this.qs), this.compressionRatioSlider.removeEventListener("input", this.qs), this.compressionThresholdSlider.removeEventListener("input", this.qs), this.masterGainSlider.removeEventListener("input", this.qs), this.ti.removeEventListener("click", this.ei) }, this.whenKeyPressed = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Le(), 32 == t.keyCode && (this.ei(), t.preventDefault()) }, this.On = () => { "10" == this.limitRatioSlider.value && "4000" == this.limitRiseSlider.value && "4" == this.limitDecaySlider.value && "1" == this.limitThresholdSlider.value && "10" == this.compressionRatioSlider.value && "1" == this.compressionThresholdSlider.value && "1" == this.masterGainSlider.value || (this.limitRatioSlider.value = "10", this.limitRiseSlider.value = "4000", this.limitDecaySlider.value = "4", this.limitThresholdSlider.value = "1", this.compressionRatioSlider.value = "10", this.compressionThresholdSlider.value = "1", this.masterGainSlider.value = "1", this.qs()) }, this.Rn = () => { this.l.record(new Kt(this.l, +this.limitRatioSlider.value < 10 ? +this.limitRatioSlider.value / 10 : +this.limitRatioSlider.value - 9, +this.compressionRatioSlider.value < 10 ? +this.compressionRatioSlider.value / 10 : 1 + (+this.compressionRatioSlider.value - 10) / 60, +this.limitThresholdSlider.value, +this.compressionThresholdSlider.value, +this.limitRiseSlider.value, +this.limitDecaySlider.value, +this.masterGainSlider.value), !0) }, this.Le = () => { this.Rn(), this.l.prompt = null }, this.Pe.addEventListener("click", this.Le), this.Nn.addEventListener("click", this.On), this.Ie.addEventListener("click", this.Ae), this.container.addEventListener("keydown", this.whenKeyPressed), this.limitRatioSlider.value = "" + (this.l.song.limitRatio < 1 ? 10 * this.l.song.limitRatio : 9 + this.l.song.limitRatio), this.compressionRatioSlider.value = "" + (this.l.song.compressionRatio < 1 ? 10 * this.l.song.compressionRatio : 10 + 60 * (this.l.song.compressionRatio - 1)), this.limitThresholdSlider.value = "" + this.l.song.limitThreshold, this.compressionThresholdSlider.value = "" + this.l.song.compressionThreshold, this.limitDecaySlider.value = "" + this.l.song.limitDecay, this.limitRiseSlider.value = "" + this.l.song.limitRise, this.masterGainSlider.value = "" + this.l.song.masterGain, this.startingLimitRatio = +this.limitRatioSlider.value, this.startingCompressionRatio = +this.compressionRatioSlider.value, this.startingLimitThreshold = +this.limitThresholdSlider.value, this.startingCompressionThreshold = +this.compressionThresholdSlider.value, this.startingLimitDecay = +this.limitDecaySlider.value, this.startingLimitRise = +this.limitRiseSlider.value, this.startingMasterGain = +this.masterGainSlider.value, this.limitDecaySlider.addEventListener("input", this.qs), this.limitRiseSlider.addEventListener("input", this.qs), this.limitRatioSlider.addEventListener("input", this.qs), this.limitThresholdSlider.addEventListener("input", this.Bn), this.compressionRatioSlider.addEventListener("input", this.qs), this.compressionThresholdSlider.addEventListener("input", this.qs), this.masterGainSlider.addEventListener("input", this.qs), this.ti.addEventListener("click", this.ei), window.requestAnimationFrame(this.zn), this.updatePlayButton(), setTimeout((() => this.ti.focus())), this.limiterCanvas.render() } updatePlayButton() { this.l.synth.playing ? (this.ti.classList.remove("playButton"), this.ti.classList.add("pauseButton"), this.ti.title = "Pause (Space)", this.ti.innerText = "Pause") : (this.ti.classList.remove("pauseButton"), this.ti.classList.add("playButton"), this.ti.title = "Play (Space)", this.ti.innerText = "Play") } } class an { constructor(t) { this.l = t, this.v = 20, this.$n = 0, this.Hn = 1, this.Vn = 2, this.Gn = B.path({ fill: "none", stroke: j.loopAccent, "stroke-width": 4 }), this.hi = B.path({ fill: j.hoverPreview, "pointer-events": "none" }), this.q = B.svg({ style: "touch-action: pan-y; position: absolute;", height: this.v }, this.Gn, this.hi), this.container = z.div({ class: "loopEditor" }, this.q), this._n = 32, this.Cs = null, this.jn = { startBar: -1, mode: -1 }, this.N = 0, this.Un = 0, this.Wn = 0, this.Kn = !1, this.Jn = !1, this.R = !1, this.O = !1, this.Yn = -1, this.Qn = -1, this.Xn = 0, this.Zn = -1, this.U = t => { this.O || (this.O = !0, this.W()) }, this.K = t => { this.O && (this.O = !1, this.W()) }, this.J = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - e.left, this.eo(), this.W(), this.Z(t) }, this.X = t => { this.R = !0; const e = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - e.left, this.eo(), this.W(), this.Un = t.touches[0].clientX, this.Wn = t.touches[0].clientY, this.Jn = !1, this.Kn = !1 }, this.Z = t => { const e = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - e.left, this.tt() }, this.et = t => { if (!this.R) return; const e = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - e.left, this.Jn || this.Kn || (Math.abs(t.touches[0].clientY - this.Wn) > 10 ? this.Kn = !0 : Math.abs(t.touches[0].clientX - this.Un) > 10 && (this.Jn = !0)), this.Jn && (this.tt(), t.preventDefault()) }, this.io = t => { t.preventDefault(), this.Kn || (this.tt(), this.O = !1, this.it(t), this.W()), this.R = !1 }, this.it = t => { null != this.Cs && this.l.record(this.Cs), this.Cs = null, this.R = !1, this.eo(), this.so() }, this.no = () => { this.so() }, this.eo(), this.so(), this.l.notifier.watch(this.no), this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("mouseover", this.U), this.container.addEventListener("mouseout", this.K), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.io), this.container.addEventListener("touchcancel", this.io) } eo() { const t = this.N / this._n; this.jn.startBar = t, t > this.l.song.loopStart - .25 && t < this.l.song.loopStart + this.l.song.loopLength + .25 ? t - this.l.song.loopStart < .5 * this.l.song.loopLength ? this.jn.mode = this.$n : this.jn.mode = this.Hn : this.jn.mode = this.Vn } oo(t) { let e = Math.round(t - this.l.song.loopLength / 2), i = e + this.l.song.loopLength; return e < 0 && (i -= e, e = 0), i > this.l.song.barCount && (e -= i - this.l.song.barCount, i = this.l.song.barCount), { start: e, length: i - e } } tt() { if (this.R) { let t = this.l.song.loopStart, e = this.l.song.loopStart + this.l.song.loopLength; null != this.Cs && this.l.lastChangeWas(this.Cs) && (t = this.Cs.oldStart, e = t + this.Cs.oldLength); const i = this.N / this._n; let s, n, o; if (this.jn.mode == this.$n) s = t + Math.round(i - this.jn.startBar), n = e, s < 0 && (s = 0), s >= this.l.song.barCount && (s = this.l.song.barCount), s == n ? s = n - 1 : s > n && (o = s, s = n, n = o), this.Cs = new _e(this.l, t, e - t, s, n - s); else if (this.jn.mode == this.Hn) s = t, n = e + Math.round(i - this.jn.startBar), n < 0 && (n = 0), n >= this.l.song.barCount && (n = this.l.song.barCount), n == s ? n = s + 1 : n < s && (o = s, s = n, n = o), this.Cs = new _e(this.l, t, e - t, s, n - s); else if (this.jn.mode == this.Vn) { const s = this.oo(i); this.Cs = new _e(this.l, t, e - t, s.start, s.length) } this.l.synth.jumpIntoLoop(), this.l.prefs.autoFollow && new Zt(this.l, this.l.channel, Math.floor(this.l.synth.playhead), !0), this.l.setProspectiveChange(this.Cs) } else this.eo(), this.W() } W() { const t = this.O && !this.R; if (this.hi.style.visibility = t ? "visible" : "hidden", t) { const t = this.v / 2; let e = this.l.song.loopStart * this._n, i = (this.l.song.loopStart + this.l.song.loopLength) * this._n; if (this.jn.mode == this.$n) i = this.l.song.loopStart * this._n + 2 * t; else if (this.jn.mode == this.Hn) e = (this.l.song.loopStart + this.l.song.loopLength) * this._n - 2 * t; else { const t = this.oo(this.jn.startBar); e = t.start * this._n, i = (t.start + t.length) * this._n } this.hi.setAttribute("d", `M ${e + t} 4 L ${i - t} 4 A ${t - 4} ${t - 4} 0 0 1 ${i - t} ${this.v - 4} L ${e + t} ${this.v - 4} A ${t - 4} ${t - 4} 0 0 1 ${e + t} 4 z`) } } so() { this._n = this.l.getBarWidth(); const t = this.v / 2, e = this.l.song.loopStart * this._n, i = (this.l.song.loopStart + this.l.song.loopLength) * this._n; if (this.Xn != this.l.song.barCount || this.Zn != this._n) { this.Xn = this.l.song.barCount, this.Zn = this._n; const t = this._n * this.l.song.barCount; this.container.style.width = t + "px", this.q.setAttribute("width", t + "") } this.Yn == e && this.Qn == i || (this.Yn = e, this.Qn = i, this.Gn.setAttribute("d", `M ${e + t} 2 L ${i - t} 2 A ${t - 2} ${t - 2} 0 0 1 ${i - t} ${this.v - 2} L ${e + t} ${this.v - 2} A ${t - 2} ${t - 2} 0 0 1 ${e + t} 2 z`)), this.W() } } const { button: rn, div: ln, span: cn, h2: dn, input: pn, br: un, select: mn, option: fn } = z; class yn { constructor(t) { this.l = t, this.Ee = pn({ style: "width: 3em; margin-left: 1em;", type: "number", step: "0.01", value: "0" }), this.Te = mn({ style: "width: 100%;" }, fn({ value: "overflow" }, "Overflow notes across bars."), fn({ value: "wrapAround" }, "Wrap notes around within bars.")), this.Ie = rn({ class: "cancelButton" }), this.Pe = rn({ class: "okayButton", style: "width:45%;" }, "Okay"), this.container = ln({ class: "prompt noSelection", style: "width: 250px;" }, dn("Move Notes Sideways"), ln({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, ln({ style: "text-align: right;" }, "Beats to move:", un(), cn({ style: `font-size: smaller; color: ${j.secondaryText};` }, "(Negative is left, positive is right)")), this.Ee), ln({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, ln({ class: "selectContainer", style: "width: 100%;" }, this.Te)), ln({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.Ee.removeEventListener("blur", yn.De), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Le() }, this.Le = () => { window.localStorage.setItem("moveNotesSidewaysStrategy", this.Te.value), this.l.prompt = null, this.l.record(new ai(this.l, +this.Ee.value, this.Te.value), !0) }, this.Ee.min = -this.l.song.beatsPerBar + "", this.Ee.max = this.l.song.beatsPerBar + ""; const e = window.localStorage.getItem("moveNotesSidewaysStrategy"); null != e && (this.Te.value = e), this.Ee.select(), setTimeout((() => this.Ee.focus()), 100), this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.Ee.addEventListener("blur", yn.De), this.container.addEventListener("keydown", this.Ne) } static De(t) { const i = t.target; let s = +i.value; s = Math.round(s * e.partsPerBeat) / e.partsPerBeat, s = Math.round(100 * s) / 100, i.value = Math.max(+i.min, Math.min(+i.max, s)) + "" } } class bn { constructor(t, i) { this.l = t, this.ho = i, this.ao = z.div({ style: `background: ${j.editorBackground}; position: sticky; bottom: 0; left: 0; width: 32px; height: 30px;` }), this.ro = [], this.lo = [], this.co = z.div({ style: `background-color: ${j.uiWidgetFocus}; white-space:nowrap; display: none; transform:translate(20px); width: auto; pointer-events: none; position: absolute; border-radius: 0.2em; z-index: 2;`, color: j.primaryText }, ""), this.do = new zs(z.input({ style: `color: ${j.primaryText}; background-color: ${j.uiWidgetFocus}; margin-top: -2px; display: none; width: 6em; position: absolute; border-radius: 0.2em; z-index: 2;`, color: j.primaryText }, ""), this.l, ((t, e) => new zi(this.l, t, e))), this.po = z.select({ style: "width: 0px; left: 19px; height: 19px; position:absolute; opacity:0" }, z.option({ value: "rename" }, "Rename..."), z.option({ value: "chnUp" }, "Move Channel Up"), z.option({ value: "chnDown" }, "Move Channel Down"), z.option({ value: "chnMute" }, "Mute Channel"), z.option({ value: "chnSolo" }, "Solo Channel"), z.option({ value: "chnInsert" }, "Insert Channel Below"), z.option({ value: "chnDelete" }, "Delete This Channel")), this.container = z.div({ class: "muteEditor", style: "position: sticky; padding-top: " + e.barEditorHeight + "px;" }, this.co, this.do.input, this.po), this.v = 128, this.uo = 0, this.mo = 0, this.fo = 0, this.yo = 0, this.bo = -1, this.wo = 0, this.vo = !1, this.ko = !1, this.xo = () => { let t = this.do.input.value; t.length > 15 && (this.do.input.value = t.substring(0, 15)) }, this.Mo = t => { t.stopPropagation() }, this.So = () => { this.do.input.style.setProperty("display", "none"), this.co.style.setProperty("display", "none") }, this.Fo = t => { this.vo = !this.ko, this.Co(t) }, this.Eo = () => { this.vo = !1, this.co.style.setProperty("display", "none") }, this.Co = t => { this.ko = this.vo, this.wo = Math.floor(Math.min(this.uo, Math.max(0, parseInt(this.po.style.getPropertyValue("top")) / this.bo))), this.l.muteEditorChannel = this.wo, this.co.style.setProperty("display", ""), this.wo < this.l.song.pitchChannelCount && this.l.song.pitchChannelCount == e.pitchChannelCountMax || this.wo >= this.l.song.pitchChannelCount && this.wo < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && this.l.song.noiseChannelCount == e.noiseChannelCountMax || this.wo >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && this.l.song.modChannelCount == e.modChannelCountMax ? this.po.options[5].disabled = !0 : this.po.options[5].disabled = !1, 0 == this.wo || this.wo == this.l.song.pitchChannelCount || this.wo == this.l.song.pitchChannelCount + this.l.song.noiseChannelCount ? this.po.options[1].disabled = !0 : this.po.options[1].disabled = !1, this.wo == this.l.song.pitchChannelCount - 1 || this.wo == this.l.song.pitchChannelCount + this.l.song.noiseChannelCount - 1 || this.wo == this.l.song.getChannelCount() - 1 ? this.po.options[2].disabled = !0 : this.po.options[2].disabled = !1, 1 == this.l.song.pitchChannelCount && 0 == this.wo ? this.po.options[6].disabled = !0 : this.po.options[6].disabled = !1 }, this.To = t => { switch (this.co.style.setProperty("display", "none"), this.po.style.setProperty("display", "none"), this.vo = !1, t.stopPropagation(), this.po.value) { case "rename": this.do.input.style.setProperty("display", ""), this.do.input.style.setProperty("transform", this.co.style.getPropertyValue("transform")), null != this.co.textContent ? this.do.input.value = this.co.textContent : this.do.input.value = "", this.do.input.select(); break; case "chnUp": this.l.record(new Jt(this.l, this.wo, this.wo, -1)); break; case "chnDown": this.l.record(new Jt(this.l, this.wo, this.wo, 1)); break; case "chnMute": this.l.song.channels[this.wo].muted = !this.l.song.channels[this.wo].muted, this.render(); break; case "chnSolo": { let t = !1; for (let e = 0; e < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; e++)this.l.song.channels[e].muted == (e == this.wo) && (t = !0, e = this.l.song.pitchChannelCount + this.l.song.noiseChannelCount); if (t) for (let t = 0; t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; t++)this.l.song.channels[t].muted = t != this.wo; else for (let t = 0; t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; t++)this.l.song.channels[t].muted = !1; this.render(); break } case "chnInsert": this.l.channel = this.wo, this.l.selection.resetBoxSelection(), this.l.selection.insertChannel(); break; case "chnDelete": this.l.record(new Xt(this.l, this.wo, this.wo)) }"rename" != this.po.value && this.ho.refocusStage(), this.po.selectedIndex = -1 }, this.Js = t => { const e = this.ro.indexOf(t.target); if (-1 == e) return; t.clientX - this.ro[0].getBoundingClientRect().left < 21 && (this.l.song.channels[e].muted = !this.l.song.channels[e].muted), this.l.notifier.changed() }, this.Io = t => { const i = this.ro.indexOf(t.target); if (-1 == i) return void (this.vo || t.target == this.co || t.target == this.po || (this.co.style.setProperty("display", "none"), this.po.style.setProperty("display", "none"), this.po.style.setProperty("width", "0px"))); if (t.clientX - this.ro[0].getBoundingClientRect().left >= 21) { if (!this.vo) { this.po.style.setProperty("display", ""); var s = this.l.getChannelHeight(); this.co.style.setProperty("transform", "translate(20px, " + (s / 4 + s * i) + "px)"), "" != this.l.song.channels[i].name ? (this.co.textContent = this.l.song.channels[i].name, this.co.style.setProperty("display", "")) : (i < this.l.song.pitchChannelCount ? this.co.textContent = "Pitch " + (i + 1) : i < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount ? this.co.textContent = "Noise " + (i - this.l.song.pitchChannelCount + 1) : this.co.textContent = "Mod " + (i - this.l.song.pitchChannelCount - this.l.song.noiseChannelCount + 1), this.co.style.setProperty("display", "none")), this.po.style.top = e.barEditorHeight + 2 + i * this.bo + "px", this.po.style.setProperty("width", "15px") } } else this.vo || (this.co.style.setProperty("display", "none"), this.po.style.setProperty("display", "none"), this.po.style.setProperty("width", "0px")) }, this.Po = t => { this.vo || (this.co.style.setProperty("display", "none"), this.po.style.setProperty("width", "0px")) }, this.container.addEventListener("click", this.Js), this.container.addEventListener("mousemove", this.Io), this.container.addEventListener("mouseleave", this.Po), this.po.selectedIndex = -1, this.po.addEventListener("change", this.To), this.po.addEventListener("mousedown", this.Co), this.po.addEventListener("blur", this.Eo), this.po.addEventListener("click", this.Fo), this.do.input.addEventListener("change", this.So), this.do.input.addEventListener("blur", this.So), this.do.input.addEventListener("mousedown", this.Mo), this.do.input.addEventListener("input", this.xo) } onKeyUp(t) { switch (t.keyCode) { case 27: case 13: this.vo = !1, this.co.style.setProperty("display", "none") } } render() { if (!this.l.prefs.enableChannelMuting) return; const t = this.l.getChannelHeight(); if (this.uo != this.l.song.getChannelCount()) { for (let t = this.uo; t < this.l.song.getChannelCount(); t++) { const e = z.div({ class: "noSelection muteButtonText", style: "display: table-cell; -webkit-text-stroke: 1.5px; vertical-align: middle; text-align: center; -webkit-user-select: none; -webkit-touch-callout: none; -moz-user-select: none; -ms-user-select: none; user-select: none; pointer-events: none; width: 12px; height: 20px; transform: translate(0px, 1px);" }), i = z.div({ class: "mute-button", title: "Mute (M), Mute All (M), Solo (S), Exclude (S)", style: "display: block; pointer-events: none; width: 16px; height: 20px; transform: translate(2px, 1px);" }), s = z.div({ style: "align-items: center; height: 20px; margin: 0px; display: table; flex-direction: row; justify-content: space-between;" }, [i, e]); this.container.appendChild(s), this.ro[t] = s, this.lo[t] = e } for (let t = this.l.song.getChannelCount(); t < this.uo; t++)this.container.removeChild(this.ro[t]); this.ro.length = this.l.song.getChannelCount(), this.container.appendChild(this.ao) } for (let t = 0; t < this.l.song.getChannelCount(); t++)this.l.song.channels[t].muted ? (this.ro[t].children[0].classList.add("muted"), t < this.l.song.pitchChannelCount ? this.lo[t].style.color = j.trackEditorBgPitchDim : t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount ? this.lo[t].style.color = j.trackEditorBgNoiseDim : this.lo[t].style.color = j.trackEditorBgModDim) : (this.ro[t].children[0].classList.remove("muted"), t < this.l.song.pitchChannelCount ? this.lo[t].style.color = j.trackEditorBgPitch : t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount ? this.lo[t].style.color = j.trackEditorBgNoise : this.lo[t].style.color = j.trackEditorBgMod); if (this.bo != t || this.uo != this.l.song.getChannelCount()) for (let e = 0; e < this.l.song.getChannelCount(); e++)this.ro[e].style.marginTop = (t - 20) / 2 + "px", this.ro[e].style.marginBottom = (t - 20) / 2 + "px"; if (this.yo != this.l.song.modChannelCount || this.uo != this.l.song.getChannelCount()) for (let t = 0; t < this.l.song.getChannelCount(); t++)t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount ? this.ro[t].children[0].classList.remove("modMute") : this.ro[t].children[0].classList.add("modMute"); if (this.yo != this.l.song.modChannelCount || this.mo != this.l.song.pitchChannelCount || this.fo != this.l.song.noiseChannelCount) { for (let t = 0; t < this.l.song.getChannelCount(); t++)if (t < this.l.song.pitchChannelCount) { let e = t + 1; this.lo[t].textContent = e + "", this.lo[t].style.fontSize = e >= 10 ? "xx-small" : "inherit" } else if (t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) { let e = t - this.l.song.pitchChannelCount + 1; this.lo[t].textContent = e + "", this.lo[t].style.fontSize = e >= 10 ? "xx-small" : "inherit" } else { let e = t - this.l.song.pitchChannelCount - this.l.song.noiseChannelCount + 1; this.lo[t].textContent = e + "", this.lo[t].style.fontSize = e >= 10 ? "xx-small" : "inherit" } this.mo = this.l.song.pitchChannelCount, this.fo = this.l.song.noiseChannelCount, this.yo = this.l.song.modChannelCount } this.bo == t && this.uo == this.l.song.getChannelCount() || (this.bo = t, this.uo = this.l.song.getChannelCount(), this.v = e.barEditorHeight + this.l.song.getChannelCount() * t, this.co.style.setProperty("display", "none"), this.container.style.height = this.v + 16 + "px", this.bo < 27 ? (this.co.style.setProperty("margin-top", "-2px"), this.po.style.setProperty("margin-top", "-4px"), this.do.input.style.setProperty("margin-top", "-4px")) : this.bo < 30 ? (this.co.style.setProperty("margin-top", "-1px"), this.po.style.setProperty("margin-top", "-3px"), this.do.input.style.setProperty("margin-top", "-3px")) : (this.co.style.setProperty("margin-top", "0px"), this.po.style.setProperty("margin-top", "0px"), this.do.input.style.setProperty("margin-top", "-2px"))) } } class gn { constructor(t, i) { this.l = t, this.Ao = i, this.m = 20, this.v = 481, this.Lo = 4, this.qo = e.pitchOctaves, this.Do = (this.v - this.Lo) / this.qo, this.S = B.rect({ fill: j.uiWidgetBackground, x: 2, y: 0, width: this.m - 4 }), this.T = B.rect({ fill: "none", stroke: j.hoverPreview, "stroke-width": 2, "pointer-events": "none", x: 1, y: 0, width: this.m - 2 }), this.No = B.path({ fill: j.hoverPreview, "pointer-events": "none" }), this.zo = B.path({ fill: j.hoverPreview, "pointer-events": "none" }), this.q = B.svg({ style: "background-color: ${ColorConfig.editorBackground}; touch-action: pan-x; position: absolute;", width: this.m, height: "100%", viewBox: "0 0 20 " + this.v, preserveAspectRatio: "none" }), this.container = z.div({ id: "octaveScrollBarContainer", style: "width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;" }, this.q), this.Ge = 0, this.R = !1, this.O = !1, this.$ = !1, this.Bo = -1, this.Ro = -1, this.Cs = null, this.U = t => { this.O || (this.O = !0, this.W()) }, this.K = t => { this.O && (this.O = !1, this.W()) }, this.J = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.l.song.getChannelIsNoise(this.l.channel) || this.l.song.getChannelIsMod(this.l.channel) || (this.W(), this.Ge >= this.Oo - this.$o && this.Ge <= this.Oo && (this.$ = !0, this.Cs = null, this.Y = this.Ge)) }, this.X = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.l.song.getChannelIsNoise(this.l.channel) || this.l.song.getChannelIsMod(this.l.channel) || (this.W(), this.Ge >= this.Oo - this.$o && this.Ge <= this.Oo && (this.$ = !0, this.Cs = null, this.Y = this.Ge)) }, this.Z = t => { const e = this.q.getBoundingClientRect(); this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.et = t => { if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.it = t => { if (!this.l.song.getChannelIsNoise(this.l.channel) && !this.l.song.getChannelIsMod(this.l.channel) && this.R) if (this.$) null != this.Cs && this.l.record(this.Cs); else { const t = this.l.getVisibleOctaveCount(), i = e.pitchOctaves - t, s = this.l.lastChangeWas(this.Cs), n = s ? this.Cs.oldValue : this.l.song.channels[this.l.channel].octave, o = this.l.getBaseVisibleOctave(this.l.channel); this.Ge < this.Oo - .5 * this.$o ? o < i && (this.Cs = new Ue(this.l, n, Math.floor(o + 1 + .5 * t)), this.l.record(this.Cs, s)) : o > 0 && (this.Cs = new Ue(this.l, n, Math.floor(o - 1 + .5 * t)), this.l.record(this.Cs, s)) } this.R = !1, this.$ = !1, this.W() }, this.no = () => { this.Oo = this.v - this.Do * this.l.getBaseVisibleOctave(this.l.channel), this.q.style.visibility = this.l.song.getChannelIsNoise(this.l.channel) || this.l.song.getChannelIsMod(this.l.channel) ? "hidden" : "visible"; const t = this.l.getVisibleOctaveCount(); this.Bo == this.Oo && this.Ro == t || (this.Bo = this.Oo, this.Ro = t, this.$o = this.Do * t + this.Lo, this.S.setAttribute("height", String(this.$o)), this.T.setAttribute("height", String(this.$o)), this.S.setAttribute("y", String(this.Oo - this.$o)), this.T.setAttribute("y", String(this.Oo - this.$o)), this.Ao.forceRender()), this.W() }, this.l.notifier.watch(this.no), this.no(), this.q.appendChild(this.S); for (let t = 0; t <= this.qo; t++)this.q.appendChild(B.rect({ fill: j.tonic, x: 0, y: t * this.Do, width: this.m, height: this.Lo })); this.q.appendChild(this.T), this.q.appendChild(this.No), this.q.appendChild(this.zo); const s = .5 * this.m; this.No.setAttribute("d", `M ${s} 9 L ${s + 6} 20 L ${s - 6} 20 z`), this.zo.setAttribute("d", `M ${s} ${this.v - 9} L ${s + 6} ${this.v - 20} L ${s - 6} ${this.v - 20} z`), this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("mouseover", this.U), this.container.addEventListener("mouseout", this.K), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it) } tt() { if (!this.l.song.getChannelIsNoise(this.l.channel) && !this.l.song.getChannelIsMod(this.l.channel)) { if (this.$) { const t = this.l.getVisibleOctaveCount(), i = e.pitchOctaves - t, s = this.l.lastChangeWas(this.Cs) ? this.Cs.oldValue : this.l.song.channels[this.l.channel].octave; let n = this.l.getBaseVisibleOctave(this.l.channel); for (; this.Ge - this.Y < .5 * -this.Do && n < i;)n++, this.Y -= this.Do; for (; this.Ge - this.Y > .5 * this.Do && n > 0;)n--, this.Y += this.Do; this.Cs = new Ue(this.l, s, Math.floor(n + .5 * t)), this.l.setProspectiveChange(this.Cs) } this.O && this.W() } } W() { let t = !1, e = !1, i = !1; this.O && !this.R && (this.Ge < this.Oo - this.$o ? t = !0 : this.Ge > this.Oo ? e = !0 : i = !0), this.No.style.visibility = t ? "inherit" : "hidden", this.zo.style.visibility = e ? "inherit" : "hidden", this.T.style.visibility = i ? "inherit" : "hidden" } } var wn = t && t.Ho || function (t, e, i, s) { return new (i || (i = Promise))((function (n, o) { function h(t) { try { r(s.next(t)) } catch (t) { o(t) } } function a(t) { try { r(s.throw(t)) } catch (t) { o(t) } } function r(t) { var e; t.done ? n(t.value) : (e = t.value, e instanceof i ? e : new i((function (t) { t(e) }))).then(h, a) } r((s = s.apply(t, e || [])).next()) })) }; const vn = (4294967295 * Math.random() >>> 0).toString(16); class kn { constructor(t) { this.l = t, this.Vo = t => { localStorage.setItem("midiHandlerId", vn) }, this.Go = t => { if ("input" === t.port.type) switch (t.port.state) { case "connected": this._o(t.port); break; case "disconnected": this.jo(t.port) } }, this._o = t => { t.addEventListener("midimessage", this.Uo) }, this.jo = t => { t.removeEventListener("midimessage", this.Uo), this.l.performance.clearAllPitches() }, this.Uo = t => { if (!this.l.prefs.enableMidi || localStorage.getItem("midiHandlerId") != vn) return; const i = this.l.song.getChannelIsNoise(this.l.channel); let [s, n, o] = t.data; if (s &= 240, i) { const t = xs[n]; if (null == t) return; n = t.frequency } else if (n -= e.keys[this.l.song.key].basePitch, n < 0 || n > e.maxPitch) return; switch (144 == s && 0 == o && (s = 128), s) { case 144: this.l.synth.preferLowerLatency = !0, this.l.performance.addPerformedPitch(n); break; case 128: this.l.performance.removePerformedPitch(n) } }, this.registerMidiAccessHandler() } registerMidiAccessHandler() { return wn(this, void 0, void 0, (function* () { if (null != navigator.requestMIDIAccess) try { const t = yield navigator.requestMIDIAccess(); t.inputs.forEach(this._o), t.addEventListener("statechange", this.Go), this.Vo(), window.addEventListener("focus", this.Vo) } catch (t) { console.error("Failed to get MIDI access", t) } })) } } class xn { constructor(t) { this.l = t, this.Wo = !1, this.Ko = t => { this.Wo && (this.l.performance.clearAllPitches(), this.Wo = !1) }, window.addEventListener("blur", this.Ko) } static keyPosToPitch(t, i, s, n) { let o = null, h = null; switch (n) { case "wickiHayden": o = 5 * s + 2 * i - 2; break; case "songScale": const n = e.scales[t.song.scale].flags.map(((t, e) => t ? e : null)).filter((t => null != t)); o = (s - 1 + Math.floor(i / n.length)) * e.pitchesPerOctave + n[(i + n.length) % n.length]; break; case "pianoAtC": o = xn.Jo[s][i], h = e.keys.dictionary.C.basePitch; break; case "pianoAtA": o = xn.Yo[s][i], h = e.keys.dictionary.A.basePitch; break; case "pianoTransposingC": o = xn.Jo[s][i]; break; case "pianoTransposingA": o = xn.Yo[s][i] }if (null == o) return null; const a = Math.max(0, t.song.channels[t.channel].octave - 1) * e.pitchesPerOctave; let r = 0; if (null != h) { r = (h - e.keys[t.song.key].basePitch + 144) % 12 } const l = a + r + o; return l < 0 || l > e.maxPitch ? null : l } handleKeyEvent(t, e) { switch (t.code) { case "Backquote": this.handleKey(-1, 3, e); break; case "Digit1": this.handleKey(0, 3, e); break; case "Digit2": this.handleKey(1, 3, e); break; case "Digit3": this.handleKey(2, 3, e); break; case "Digit4": this.handleKey(3, 3, e); break; case "Digit5": this.handleKey(4, 3, e); break; case "Digit6": this.handleKey(5, 3, e); break; case "Digit7": this.handleKey(6, 3, e); break; case "Digit8": this.handleKey(7, 3, e); break; case "Digit9": this.handleKey(8, 3, e); break; case "Digit0": this.handleKey(9, 3, e); break; case "Minus": this.handleKey(10, 3, e); break; case "Equal": this.handleKey(11, 3, e); break; case "IntlYen": this.handleKey(12, 3, e); break; case "KeyQ": this.handleKey(0, 2, e); break; case "KeyW": this.handleKey(1, 2, e); break; case "KeyE": this.handleKey(2, 2, e); break; case "KeyR": this.handleKey(3, 2, e); break; case "KeyT": this.handleKey(4, 2, e); break; case "KeyY": this.handleKey(5, 2, e); break; case "KeyU": this.handleKey(6, 2, e); break; case "KeyI": this.handleKey(7, 2, e); break; case "KeyO": this.handleKey(8, 2, e); break; case "KeyP": this.handleKey(9, 2, e); break; case "BracketLeft": this.handleKey(10, 2, e); break; case "BracketRight": this.handleKey(11, 2, e); break; case "Backslash": "\\" == t.key || "|" == t.key ? this.handleKey(12, 2, e) : this.handleKey(11, 1, e); break; case "KeyA": this.handleKey(0, 1, e); break; case "KeyS": this.handleKey(1, 1, e); break; case "KeyD": this.handleKey(2, 1, e); break; case "KeyF": this.handleKey(3, 1, e); break; case "KeyG": this.handleKey(4, 1, e); break; case "KeyH": this.handleKey(5, 1, e); break; case "KeyJ": this.handleKey(6, 1, e); break; case "KeyK": this.handleKey(7, 1, e); break; case "KeyL": this.handleKey(8, 1, e); break; case "Semicolon": this.handleKey(9, 1, e); break; case "Quote": this.handleKey(10, 1, e); break; case "IntlHash": this.handleKey(11, 1, e); break; case "IntlBackslash": this.handleKey(-1, 0, e); break; case "KeyZ": this.handleKey(0, 0, e); break; case "KeyX": this.handleKey(1, 0, e); break; case "KeyC": this.handleKey(2, 0, e); break; case "KeyV": this.handleKey(3, 0, e); break; case "KeyB": this.handleKey(4, 0, e); break; case "KeyN": this.handleKey(5, 0, e); break; case "KeyM": this.handleKey(6, 0, e); break; case "Comma": this.handleKey(7, 0, e); break; case "Period": this.handleKey(8, 0, e); break; case "Slash": this.handleKey(9, 0, e); break; case "IntlRo": this.handleKey(10, 0, e); break; default: return }t.preventDefault() } handleKey(t, i, s) { if (this.l.song.getChannelIsNoise(this.l.channel)) return void (t >= 0 && t < e.drumCount && (s ? (this.l.synth.preferLowerLatency = !0, this.l.performance.addPerformedPitch(t), this.Wo = !0) : this.l.performance.removePerformedPitch(t))); const n = xn.keyPosToPitch(this.l, t, i, this.l.prefs.keyboardLayout); null != n && (s ? (this.l.synth.preferLowerLatency = !0, this.l.performance.addPerformedPitch(n), this.Wo = !0) : this.l.performance.removePerformedPitch(n)) } } xn.Jo = [[0, 2, 4, 5, 7, 9, 11, 12, 14, 16, 17], [null, 1, 3, null, 6, 8, 10, null, 13, 15, null, 18], [12, 14, 16, 17, 19, 21, 23, 24, 26, 28, 29, 31, 33], [null, 13, 15, null, 18, 20, 22, null, 25, 27, null, 30, 32]], xn.Yo = [[0, 2, 3, 5, 7, 8, 10, 12, 14, 15, 17], [-1, 1, null, 4, 6, null, 9, 11, 13, null, 16, 18], [12, 14, 15, 17, 19, 20, 22, 24, 26, 27, 29, 31, 32], [11, 13, null, 16, 18, null, 21, 23, 25, null, 28, 30, null]]; class Mn { constructor() { this.valid = !1, this.prevNote = null, this.curNote = null, this.nextNote = null, this.pitch = 0, this.pitchIndex = -1, this.curIndex = 0, this.start = 0, this.end = 0, this.part = 0, this.exactPart = 0, this.nearPinIndex = 0, this.pins = [] } } class Sn { constructor(t, i, s) { this.l = t, this.Qo = i, this.Xo = s, this.controlMode = !1, this.shiftMode = !1, this.Zo = B.pattern({ id: "patternEditorNoteBackground" + this.Xo, x: "0", y: "0", patternUnits: "userSpaceOnUse" }), this.th = B.pattern({ id: "patternEditorDrumBackground" + this.Xo, x: "0", y: "0", patternUnits: "userSpaceOnUse" }), this.eh = B.pattern({ id: "patternEditorModBackground" + this.Xo, x: "0", y: "0", patternUnits: "userSpaceOnUse" }), this.ih = B.rect({ x: "0", y: "0", "pointer-events": "none", fill: "url(#patternEditorNoteBackground" + this.Xo + ")" }), this.sh = B.svg(), this.nh = B.rect({ x: "0", y: "0", width: "4", fill: j.playhead, "pointer-events": "none" }), this.oh = B.rect({ class: "dashed-line dash-move", fill: j.boxSelectionFill, stroke: j.hoverPreview, "stroke-width": 2, "stroke-dasharray": "5, 3", "fill-opacity": "0.4", "pointer-events": "none", visibility: "hidden" }), this.hh = B.path({ fill: "none", stroke: j.hoverPreview, "stroke-width": "2", "pointer-events": "none" }), this.modDragValueLabel = z.div({ width: "90", "text-anchor": "start", contenteditable: "true", style: "display: flex, justify-content: center; align-items:center; position:absolute; pointer-events: none;", "dominant-baseline": "central" }), this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: none; position: absolute;`, width: "100%", height: "100%" }, B.defs(this.Zo, this.th, this.eh), this.ih, this.oh, this.sh, this.hh, this.nh), this.container = z.div({ style: "height: 100%; overflow:hidden; position: relative; flex-grow: 1;" }, this.q, this.modDragValueLabel), this.ah = 34, this.rh = [], this.lh = B.rect(), this.dh = B.rect(), this.ph = 0, this.uh = 0, this.mh = 0, this.editingModLabel = !1, this.fh = 0, this.yh = 0, this.bh = 6, this.gh = -1, this.N = 0, this.Ge = 0, this.R = !1, this.O = !1, this.di = !1, this.wh = !1, this.kh = !1, this.xh = [], this.en = 0, this.Mh = 0, this.Sh = 0, this.Fh = !1, this.Ch = !1, this.Eh = !1, this.Th = !1, this.Ih = !1, this.Ph = 0, this.Ah = 0, this.Lh = 0, this.qh = !1, this.gi = null, this.Dh = null, this.Nh = !1, this.jn = new Mn, this.zh = [], this.Se = null, this.Bh = 0, this.Rh = 0, this.Oh = -1, this.$h = -1, this.Hh = -1, this.Vh = -1, this.Ts = !1, this.Gh = !1, this._h = !1, this.jh = -1, this.Uh = -1, this.Wh = -1, this.Kh = -1, this.Jh = -1, this.Yh = t => { const i = t.target; let s = Number(i.innerText); if (!(!isNaN(s) && s >= 0 && s < this.yh) && "" != i.innerText && "-" != i.innerText) { isNaN(s) && (s = this.yh, i.innerText = "" + this.yh); let t = Math.floor(Math.max(Number(this.yh), Math.min(Number(this.bh), s))); i.innerText != t + "" && (i.innerText = t + ""); let n = +(t >= 10) + +(t >= 100) + +(t < 0) + +(t <= -10); this.ph = +S(Math.max(Math.min(this.m - 10 - 8 * n, this.Qh * (this.Xh.start + this.Zh.time) - 4 - 4 * n), 2)), this.modDragValueLabel.style.setProperty("left", this.ph + "px"); const o = new At; this.gi = o, this.l.setProspectiveChange(this.gi), o.append(new Oi(this.l, this.Xh, this.Zh.time, t - e.modulators[this.ta].convertRealFactor, this.Zh.interval, this.shiftMode)) } }, this.resetCopiedPins = () => { const t = this.ea(); let e = this.l.song.getVolumeCap(!1); this.xh.length = this.l.song.getChannelCount(), this.zh.length = this.l.song.getChannelCount(); for (let i = 0; i < this.l.song.pitchChannelCount; i++)this.xh[i] = [rt(0, 0, e), rt(0, t, e)], this.zh[i] = [e, e]; for (let i = this.l.song.pitchChannelCount; i < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; i++)this.xh[i] = [rt(0, 0, e), rt(0, t, 0)], this.zh[i] = [e, 0]; for (let i = this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; i < this.l.song.getChannelCount(); i++)this.xh[i] = [rt(0, 0, e), rt(0, t, 0)], this.zh[i] = [e, 0] }, this.ia = t => { this.kh && !this.shiftMode && !this.di && this.R && performance.now() > this.Sh + 1e3 && this.jn.valid && this.l.lastChangeWas(this.gi) && (this.gi.undo(), this.Fh = !0, this.Ch = !1, this.Ci(), this.l.notifier.notifyWatchers()); const e = Math.floor(this.l.synth.playhead); if (this.l.synth.playing && (null != this.Se && this.l.song.getPattern(this.l.channel, Math.floor(this.l.synth.playhead)) == this.Se || Math.floor(this.l.synth.playhead) == this.l.bar + this.Xo)) { this.nh.setAttribute("visibility", "visible"); const t = this.l.synth.playhead - e; Math.abs(t - this.Bh) > .1 ? this.Bh = t : this.Bh += .2 * (t - this.Bh), this.nh.setAttribute("x", "" + S(this.Bh * this.m - 2)) } else this.nh.setAttribute("visibility", "hidden"); this.l.synth.playing && (this.l.synth.recording || this.l.prefs.autoFollow) && this.Jh != e && (new Zt(this.l, this.l.channel, e), this.l.notifier.notifyWatchers()), this.Jh = e, this.l.currentPatternIsDirty && this.sa(), window.requestAnimationFrame(this.ia) }, this.U = t => { this.O || (this.O = !0, this.kh = !1) }, this.K = t => { this.O && (this.O = !1) }, this.J = t => { t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.kh = !1, this.Fh = t.shiftKey, this.Ch = !1, this.Ci() }, this.X = t => { t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.kh = !0, this.Fh = t.shiftKey, this.Ch = !1, this.Sh = performance.now(), this.Ci() }, this.Z = t => { this.controlMode = t.ctrlKey, this.shiftMode = t.shiftKey; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.kh = !1, this.tt() }, this.et = t => { if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.it = t => { if (!this.jn.valid) return; const i = this.l.lastChangeWas(this.gi); if (this.R && i && null != this.gi) if (this.Ih) this.l.record(this.gi), this.gi = null, null != this.Se && this.l.song.getChannelIsMod(this.l.channel) && this.Se.notes.sort((function (t, e) { return t.start == e.start ? t.pitches[0] - e.pitches[0] : t.start - e.start })); else if (this.Eh || this.Th || this.Fh) this.na(this.gi), this.gi = null; else if (this.di || null == this.jn.curNote || !this.gi.isNoop() || this.Eh || this.Th || this.Ih || this.Fh) this.l.record(this.gi), this.gi = null, null != this.Se && this.l.song.getChannelIsMod(this.l.channel) && this.Se.notes.sort((function (t, e) { return t.start == e.start ? t.pitches[0] - e.pitches[0] : t.start - e.start })); else { if (null == this.Se) throw new Error; const t = new At; if (t.append(new Pi(this.l, 0, 0)), -1 == this.jn.pitchIndex) { if (this.jn.curNote.pitches.length == e.maxChordSize && t.append(new je(this.l, this.jn.curNote, this.jn.curNote.pitches[0], 0, !0)), t.append(new je(this.l, this.jn.curNote, this.jn.pitch, this.jn.curNote.pitches.length)), this.oa(this.jn.curNote), this.l.prefs.enableNotePreview && !this.l.synth.playing) { const t = Math.min(e.partsPerBeat, this.jn.end - this.jn.start); this.l.performance.setTemporaryPitches(this.jn.curNote.pitches, t) } } else 1 == this.jn.curNote.pitches.length ? t.append(new Mi(this.l, this.Se, this.jn.curNote, this.jn.curIndex, !0)) : t.append(new je(this.l, this.jn.curNote, this.jn.pitch, this.jn.curNote.pitches.indexOf(this.jn.pitch), !0)); this.l.record(t) } this.R = !1, this.di = !1, this.Eh = !1, this.Th = !1, this.Ih = !1, this.Nh = !1, this.modDragValueLabel.setAttribute("fill", j.secondaryText), this.eo(), this.W() }; for (let t = 0; t < e.pitchesPerOctave; t++) { const e = B.rect(); e.setAttribute("x", "1"), e.setAttribute("fill", 0 == t ? j.tonic : j.pitchBackground), this.Zo.appendChild(e), this.rh[t] = e } this.lh.setAttribute("x", "1"), this.lh.setAttribute("y", "1"), this.lh.setAttribute("fill", j.pitchBackground), this.th.appendChild(this.lh), this.dh.setAttribute("fill", j.pitchBackground), this.eh.appendChild(this.dh), this.Qo ? (this.eo(), this.W(), window.requestAnimationFrame(this.ia), this.q.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.q.addEventListener("mouseover", this.U), this.q.addEventListener("mouseout", this.K), this.q.addEventListener("touchstart", this.X), this.q.addEventListener("touchmove", this.et), this.q.addEventListener("touchend", this.it), this.q.addEventListener("touchcancel", this.it), this.modDragValueLabel.addEventListener("input", this.Yh)) : (this.nh.style.display = "none", this.q.appendChild(B.rect({ x: 0, y: 0, width: 1e4, height: 1e4, fill: j.editorBackground, style: "opacity: 0.5;" }))), this.resetCopiedPins() } ea() { const t = e.rhythms[this.l.song.rhythm].stepsPerBeat; return t % 4 == 0 ? e.partsPerBeat / 2 : t % 3 == 0 ? e.partsPerBeat / 3 : t % 2 == 0 ? e.partsPerBeat / 2 : e.partsPerBeat } ha() { return e.partsPerBeat / e.rhythms[this.l.song.rhythm].stepsPerBeat } aa(t) { const e = this.ha(); return Math.floor(t / e) * e } eo() { if (this.jn = new Mn, this.N < 0 || this.N > this.m || this.Ge < 0 || this.Ge > this.v || this.gh <= 0) return; const t = this.ha(); this.jn.exactPart = this.N / this.Qh, this.jn.part = Math.floor(Math.max(0, Math.min(this.l.song.beatsPerBar * e.partsPerBeat - t, this.jn.exactPart)) / t) * t; let i = !1; if (null != this.Se) { for (const t of this.Se.notes) if (t.end <= this.jn.exactPart) this.l.song.getChannelIsMod(this.l.channel) ? (t.pitches[0] == Math.floor(this.ra(this.Ge)) && (this.jn.prevNote = t), i || this.jn.curIndex++) : (this.jn.prevNote = t, this.jn.curIndex++); else if (t.start <= this.jn.exactPart && t.end > this.jn.exactPart) this.l.song.getChannelIsMod(this.l.channel) ? t.pitches[0] == Math.floor(this.ra(this.Ge)) ? (this.jn.curNote = t, i = !0) : (!i || null != this.jn.curNote && t.start < this.jn.curNote.start) && this.jn.curIndex++ : this.jn.curNote = t; else if (t.start > this.jn.exactPart) { if (!this.l.song.getChannelIsMod(this.l.channel)) { this.jn.nextNote = t; break } if (t.pitches[0] == Math.floor(this.ra(this.Ge))) { this.jn.nextNote = t; break } } if (this.l.song.getChannelIsMod(this.l.channel) && !this.editingModLabel) if (null != this.Se.notes[this.jn.curIndex] && null != this.jn.curNote) { let t = 0; for (; this.jn.curNote.start + this.jn.curNote.pins[t].time < this.jn.exactPart && t < this.jn.curNote.pins.length;)t++; t > 0 && this.jn.curNote.start + this.jn.curNote.pins[t].time - this.jn.exactPart > this.jn.exactPart - (this.jn.curNote.start + this.jn.curNote.pins[t - 1].time) && t--, this.modDragValueLabel.style.setProperty("color", "#666688"), this.modDragValueLabel.style.setProperty("display", ""); const i = Math.max(0, e.modCount - 1 - this.jn.curNote.pitches[0]); let s = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument(this.Xo)].modulators[i], n = this.jn.curNote.pins[t].size + e.modulators[s].convertRealFactor, o = +(n >= 10) + +(n >= 100) + +(n < 0) + +(n <= -10); this.mh = 8 + 8 * o, this.ph = +S(Math.max(Math.min(this.m - 10 - 8 * o, this.Qh * (this.jn.curNote.start + this.jn.curNote.pins[t].time) - 4 - 4 * o), 2)), this.uh = +S(this.la(this.jn.curNote.pitches[0] - this.Rh) - 17 - (this.gh - this.ca) / 2), this.fh = this.jn.curNote.pins[t].size, this.Xh = this.jn.curNote, this.Zh = this.jn.curNote.pins[t], this.yh = e.modulators[s].convertRealFactor, this.bh = e.modulators[s].convertRealFactor + e.modulators[s].maxRawVol, this.ta = s, this.modDragValueLabel.style.setProperty("left", this.ph + "px"), this.modDragValueLabel.style.setProperty("top", this.uh + "px"), this.modDragValueLabel.textContent = "" + n } else this.modDragValueLabel.style.setProperty("display", "none"), this.modDragValueLabel.style.setProperty("pointer-events", "none"), this.modDragValueLabel.setAttribute("contenteditable", "false"); else this.editingModLabel || (this.modDragValueLabel.style.setProperty("display", "none"), this.modDragValueLabel.style.setProperty("pointer-events", "none"), this.modDragValueLabel.setAttribute("contenteditable", "false")) } else this.modDragValueLabel.style.setProperty("display", "none"), this.modDragValueLabel.style.setProperty("pointer-events", "none"), this.modDragValueLabel.setAttribute("contenteditable", "false"); let s = this.ra(this.Ge); if (null != this.jn.curNote) { this.jn.start = this.jn.curNote.start, this.jn.end = this.jn.curNote.end, this.jn.pins = this.jn.curNote.pins; let t, i = 0, n = 0, o = this.jn.curNote.pins[0]; for (let e = 1; e < this.jn.curNote.pins.length; e++) { t = o, o = this.jn.curNote.pins[e]; const s = this.Qh * (this.jn.curNote.start + t.time), h = this.Qh * (this.jn.curNote.start + o.time); if (this.N > h) continue; if (this.N < s) throw new Error; const a = (this.N - s) / (h - s), r = Math.sqrt(1 / Math.sqrt(4) - Math.pow(a - .5, 2)) - .5, l = Math.abs(o.interval - t.interval); i = t.interval * (1 - a) + o.interval * a, n = r * l + .95; break } let h = Number.MAX_VALUE, a = -Number.MAX_VALUE, r = Number.MAX_VALUE; for (const t of this.jn.curNote.pins) { h > t.interval && (h = t.interval), a < t.interval && (a = t.interval); const e = Math.abs(this.jn.curNote.start + t.time - this.N / this.Qh); r > e && (r = e, this.jn.nearPinIndex = this.jn.curNote.pins.indexOf(t)) } s -= i; const l = this.l.song.getChannelIsNoise(this.l.channel) ? e.drumCount - 1 : this.l.song.getChannelIsMod(this.l.channel) ? e.modCount - 1 : e.maxPitch; if (this.jn.pitch = this.da(s, -h, l - a), !this.l.song.getChannelIsNoise(this.l.channel) && !this.l.song.getChannelIsMod(this.l.channel)) { let t = n; for (let e = 0; e < this.jn.curNote.pitches.length; e++) { const i = Math.abs(this.jn.curNote.pitches[e] - s + .5); i > t || (t = i, this.jn.pitch = this.jn.curNote.pitches[e]) } } for (let t = 0; t < this.jn.curNote.pitches.length; t++)if (this.jn.curNote.pitches[t] == this.jn.pitch) { this.jn.pitchIndex = t; break } } else { const t = this.l.song.getChannelIsNoise(this.l.channel) ? e.drumCount - 1 : this.l.song.getChannelIsMod(this.l.channel) ? e.modCount : e.maxPitch; this.jn.pitch = this.da(s, 0, t); const i = this.pa[this.pa.length - 1].time, n = Math.floor(this.jn.part / e.partsPerBeat), o = this.ea(), h = this.jn.part % e.partsPerBeat; if (1 == i) this.jn.start = this.jn.part; else if (i > e.partsPerBeat) this.jn.start = n * e.partsPerBeat; else if (i == e.partsPerBeat) this.jn.start = n * e.partsPerBeat, o < e.partsPerBeat && h > o && (this.jn.start += Math.floor(h / o) * o); else { this.jn.start = n * e.partsPerBeat; let t = e.partsPerBeat % i == 0 ? i : Math.min(i, o); for (; t < o && e.partsPerBeat % t != 0;)t++; this.jn.start += Math.floor(h / t) * t } this.jn.end = this.jn.start + i; let a = 0, r = this.l.song.beatsPerBar * e.partsPerBeat; if (null != this.jn.prevNote && (a = this.jn.prevNote.end), null != this.jn.nextNote && (r = this.jn.nextNote.start), this.jn.start < a ? (this.jn.start = a, this.jn.end = this.jn.start + i, this.jn.end > r && (this.jn.end = r)) : this.jn.end > r && (this.jn.end = r, this.jn.start = this.jn.end - i, this.jn.start < a && (this.jn.start = a)), this.jn.end - this.jn.start == i) this.pa = this.xh[this.l.channel], this.jn.pins = this.pa; else { this.jn.pins = []; for (const t of this.pa) { if (!(t.time <= this.jn.end - this.jn.start)) { this.jn.pins.push(rt(0, this.jn.end - this.jn.start, t.size)); break } if (this.jn.pins.push(rt(0, t.time, t.size)), t.time == this.jn.end - this.jn.start) break } } if (this.l.song.getChannelIsMod(this.l.channel)) { if (this.jn.pitch = Math.max(0, Math.min(e.modCount - 1, this.jn.pitch)), null != this.zh && null != this.zh[this.l.channel]) for (let t = 0; t < this.jn.pins.length; t++)this.jn.pins[t].size = this.zh[this.l.channel][t]; let t = this.l.song.getVolumeCap(this.l.song.getChannelIsMod(this.l.channel), this.l.channel, this.l.getCurrentInstrument(this.Xo), this.jn.pitch), i = 0; for (const t of this.jn.pins) t.size > i && (i = t.size); if (i > t) for (const e of this.jn.pins) e.size = Math.round(e.size * (t / i)) } } this.jn.valid = !0 } ua() { return this.jn.valid && this.l.selection.patternSelectionActive && this.l.selection.patternSelectionStart <= this.jn.exactPart && this.jn.exactPart <= this.l.selection.patternSelectionEnd } ma() { return this.jn.valid && this.l.selection.patternSelectionActive && -1 == this.jn.pitchIndex && this.l.selection.patternSelectionStart - 3 <= this.jn.exactPart && this.jn.exactPart <= this.l.selection.patternSelectionStart + 1.25 } fa() { return this.jn.valid && this.l.selection.patternSelectionActive && -1 == this.jn.pitchIndex && this.l.selection.patternSelectionEnd - 1.25 <= this.jn.exactPart && this.jn.exactPart <= this.l.selection.patternSelectionEnd + 3 } ra(t) { return Math.max(0, Math.min(this.ya - 1, this.ya - t / this.gh)) + this.Rh } da(t, i, s) { t < i && (t = i), t > s && (t = s); const n = this.l.prefs.notesOutsideScale ? e.scales.dictionary.Free.flags : e.scales[this.l.song.scale].flags; if (n[Math.floor(t) % e.pitchesPerOctave] || this.l.song.getChannelIsNoise(this.l.channel) || this.l.song.getChannelIsMod(this.l.channel)) return Math.floor(t); { let o = Math.floor(t) + 1, h = Math.floor(t) - 1; for (; !n[o % e.pitchesPerOctave];)o++; for (; !n[h % e.pitchesPerOctave];)h--; if (o > s) return h < i ? i : h; if (h < i) return o; let a = o, r = h + 1; return o % e.pitchesPerOctave != 0 && o % e.pitchesPerOctave != 7 || (a -= .5), h % e.pitchesPerOctave != 0 && h % e.pitchesPerOctave != 7 || (r += .5), t - r > a - t ? o : h } } oa(t) { this.pa = []; for (const e of t.pins) this.pa.push(rt(0, e.time, e.size)); for (let t = 1; t < this.pa.length - 1;)this.pa[t - 1].size == this.pa[t].size && this.pa[t].size == this.pa[t + 1].size ? this.pa.splice(t, 1) : t++; this.xh[this.l.channel] = this.pa, this.zh[this.l.channel] = []; for (let t = 0; t < this.pa.length; t++)this.zh[this.l.channel].push(this.pa[t].size) } movePlayheadToMouse() { return !!this.O && (this.l.synth.playhead = this.l.bar + this.Xo + this.N / this.m, !0) } stopEditingModLabel(t) { if (this.editingModLabel) { if (this.editingModLabel = !1, this.modDragValueLabel.style.setProperty("pointer-events", "none"), window.getSelection) { let t = window.getSelection(); null != t && t.removeAllRanges() } if (t) { this.Zh.size = this.fh; let t = this.fh + e.modulators[this.ta].convertRealFactor, i = +(t >= 10) + +(t >= 100) + +(t < 0) + +(t <= -10); this.ph = +S(Math.max(Math.min(this.m - 10 - 8 * i, this.Qh * (this.Xh.start + this.Zh.time) - 4 - 4 * i), 2)), this.modDragValueLabel.style.setProperty("left", this.ph + "px"); const s = new At; this.gi = s, this.l.setProspectiveChange(this.gi), s.append(new Oi(this.l, this.Xh, this.Zh.time, this.fh, this.Zh.interval, this.shiftMode)), this.gi = null } this.l.lastChangeWas(this.gi) && null != this.gi && (this.l.record(this.gi), this.gi = null) } } Ci() { if (this.l.song.getChannelIsMod(this.l.channel) && "none" != this.modDragValueLabel.style.getPropertyValue("display") && this.N > +this.ph - 6 && this.N < +this.ph + this.mh + 6 && this.Ge > +this.uh - 8 && this.Ge < +this.uh + 11) { if (this.modDragValueLabel.style.setProperty("pointer-events", "fill"), this.modDragValueLabel.setAttribute("contenteditable", "true"), window.getSelection) { let t = window.getSelection(); null != t && t.selectAllChildren(this.modDragValueLabel) } window.setTimeout((() => { this.modDragValueLabel.focus() })), this.editingModLabel = !0 } else { this.stopEditingModLabel(!1), this.l.prefs.enableNotePreview && this.l.synth.maintainLiveInput(), this.R = !0, this.en = this.N, this.Mh = this.Ge, this.eo(), this.W(); const t = new At; if (this.gi = t, this.Nh = this.l.lastChangeWas(this.Dh), this.l.setProspectiveChange(this.gi), this.ma()) this.Eh = !0; else if (this.fa()) this.Th = !0; else if (this.Fh) if (this.l.selection.patternSelectionActive && -1 == this.jn.pitchIndex || this.ua()) t.append(new Pi(this.l, 0, 0)); else if (null != this.jn.curNote) t.append(new Pi(this.l, this.jn.curNote.start, this.jn.curNote.end)); else { const i = Math.max(0, Math.min((this.l.song.beatsPerBar - 1) * e.partsPerBeat, Math.floor(this.jn.exactPart / e.partsPerBeat) * e.partsPerBeat)), s = i + e.partsPerBeat; t.append(new Pi(this.l, i, s)) } else if (this.ua()) this.Ih = !0; else if (this.jn.valid && null == this.jn.curNote) { t.append(new Pi(this.l, 0, 0)); const i = new lt(this.jn.pitch, this.jn.start, this.jn.end, e.noteSizeMax, this.l.song.getChannelIsNoise(this.l.channel)); i.pins = []; for (const t of this.jn.pins) i.pins.push(rt(0, t.time, t.size)); t.append(new ii(this.l, this.l.channel, this.l.bar)); const s = this.l.getCurrentPattern(this.Xo); if (null == s) throw new Error; if (t.append(new Mi(this.l, s, i, this.jn.curIndex)), this.l.prefs.enableNotePreview && !this.l.synth.playing) { const t = Math.min(e.partsPerBeat, this.jn.end - this.jn.start); this.l.performance.setTemporaryPitches([this.jn.pitch], t) } } this.ba() } } tt() { this.l.prefs.enableNotePreview && this.O && this.l.synth.maintainLiveInput(); const t = this.l.lastChangeWas(this.gi); if (!this.di && this.R && this.jn.valid && t) { const t = this.N - this.en, e = this.Ge - this.Mh; Math.sqrt(t * t + e * e) > 5 && (this.di = !0, this.wh = Math.abs(t) >= Math.abs(e)) } if (this.Fh && this.wh && Math.abs(this.en - this.N) > 5 && (this.Ch = !0), this.di && this.R && this.jn.valid && t) { this.gi.undo(); const t = new At; this.gi = t, this.l.setProspectiveChange(this.gi); const i = this.ha(), s = this.aa(this.N / this.Qh); if (this.Eh) t.append(new Pi(this.l, Math.max(0, Math.min(this.l.song.beatsPerBar * e.partsPerBeat, s)), this.l.selection.patternSelectionEnd)), this.ba(); else if (this.Th) t.append(new Pi(this.l, this.l.selection.patternSelectionStart, Math.max(0, Math.min(this.l.song.beatsPerBar * e.partsPerBeat, s)))), this.ba(); else if (this.Ih) { const t = this.l.getCurrentPattern(this.Xo); if (this.di && null != t) { this.gi.undo(); const s = new At; this.gi = s, this.l.setProspectiveChange(this.gi); const n = e.scales[this.l.song.scale].flags.filter((t => t)).length, o = this.l.song.getChannelIsNoise(this.l.channel) ? 1 : 12 / n, h = Math.round((this.N - this.en) / (this.Qh * i)) * i, a = Math.round((this.Mh - this.Ge) / (this.gh * o)); s.append(new Ai(this.l, this.l.channel, t, h, a)) } } else if (this.Fh && this.Ch) { if (this.di) { let i = Math.max(0, Math.min((this.l.song.beatsPerBar - 1) * e.partsPerBeat, Math.floor(this.jn.exactPart / e.partsPerBeat) * e.partsPerBeat)), n = i + e.partsPerBeat; if (null != this.jn.curNote && (i = Math.max(i, this.jn.curNote.start), n = Math.min(n, this.jn.curNote.end)), s < i) { i = 0; const t = this.l.getCurrentPattern(this.Xo); if (null != t) for (let e = 0; e < t.notes.length; e++)t.notes[e].start <= s && (i = t.notes[e].start), t.notes[e].end <= s && (i = t.notes[e].end); for (let t = 0; t <= this.l.song.beatsPerBar; t++) { const n = t * e.partsPerBeat; i <= n && n <= s && (i = n) } } if (s > n) { n = e.partsPerBeat * this.l.song.beatsPerBar; const t = this.l.getCurrentPattern(this.Xo); if (null != t) for (let e = 0; e < t.notes.length; e++) { if (t.notes[e].start >= s) { n = t.notes[e].start; break } if (t.notes[e].end >= s) { n = t.notes[e].end; break } } for (let t = 0; t <= this.l.song.beatsPerBar; t++) { const i = t * e.partsPerBeat; s < i && i < n && (n = i) } } t.append(new Pi(this.l, i, n)), this.ba() } } else if (null == this.jn.curNote) { let n, o; t.append(new Pi(this.l, 0, 0)), s < this.jn.start ? (n = !0, o = this.jn.start - s) : (n = !1, o = s - this.jn.start + i); let h, a, r = i; for (let t = i; t <= this.l.song.beatsPerBar * e.partsPerBeat; t += i) { if (1 == i) { if (t < 5); else if (t <= e.partsPerBeat / 2) { if (t % 3 != 0 && t % 4 != 0) continue } else if (t <= 1.5 * e.partsPerBeat) { if (t % 6 != 0 && t % 8 != 0) continue } else if (t % e.partsPerBeat != 0) continue } else if (t >= 5 * i && t % e.partsPerBeat != 0 && t != 3 * e.partsPerBeat / 4 && t != 3 * e.partsPerBeat / 2 && t != 4 * e.partsPerBeat / 3) continue; const s = t; if (s == o) { r = s; break } if (s < o && (r = s), s > o) { r < o - i && (r = s); break } } n ? (a = this.jn.start, h = a - r) : (h = this.jn.start, a = h + r); const l = h < 0 && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; if (h < 0 && (h = 0), a > this.l.song.beatsPerBar * e.partsPerBeat && (a = this.l.song.beatsPerBar * e.partsPerBeat), h < a) { t.append(new ii(this.l, this.l.channel, this.l.bar)); const e = this.l.getCurrentPattern(this.Xo); if (null == e) throw new Error; let i; for (t.append(new Fi(this.l, e, h, a, new lt(this.jn.pitch, 0, 0, 0))), i = 0; i < e.notes.length && !(e.notes[i].start >= a); i++); const s = new lt(this.jn.pitch, h, a, this.l.song.getNewNoteVolume(this.l.song.getChannelIsMod(this.l.channel), this.l.channel, this.l.getCurrentInstrument(this.Xo), this.jn.pitch), this.l.song.getChannelIsNoise(this.l.channel)); s.continuesLastPattern = l, t.append(new Mi(this.l, e, s, i)), this.oa(s), this.Ph = n ? h : a, this.Ah = this.jn.pitch, this.Lh = s.pins[n ? 0 : 1].size, this.qh = !0 } let c = this.Se; this.Se = this.l.getCurrentPattern(this.Xo), null != this.Se && this.l.song.getChannelIsMod(this.l.channel) && this.Qo && c != this.Se && this.Se.notes.sort((function (t, e) { return t.start == e.start ? t.pitches[0] - e.pitches[0] : t.start - e.start })) } else if (this.wh) { t.append(new Pi(this.l, 0, 0)); const s = (this.N - this.en) / this.Qh, n = this.jn.curNote.pins[this.jn.nearPinIndex]; let o = Math.round((this.jn.curNote.start + n.time + s) / i) * i; const h = o < 0 && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; if (o < 0 && (o = 0), o > this.l.song.beatsPerBar * e.partsPerBeat && (o = this.l.song.beatsPerBar * e.partsPerBeat), null == this.Se) throw new Error; if (o <= this.jn.curNote.start && this.jn.nearPinIndex == this.jn.curNote.pins.length - 1 || o >= this.jn.curNote.end && 0 == this.jn.nearPinIndex) t.append(new Mi(this.l, this.Se, this.jn.curNote, this.jn.curIndex, !0)), this.qh = !1; else { const e = Math.min(this.jn.curNote.start, o), i = Math.max(this.jn.curNote.end, o); this.Ph = o, this.Ah = this.jn.curNote.pitches[-1 == this.jn.pitchIndex ? 0 : this.jn.pitchIndex] + this.jn.curNote.pins[this.jn.nearPinIndex].interval, this.Lh = this.jn.curNote.pins[this.jn.nearPinIndex].size, this.qh = !0, t.append(new Fi(this.l, this.Se, e, i, this.jn.curNote)), t.append(new si(this.l, this.jn.curNote, this.jn.nearPinIndex, o, h)), this.oa(this.jn.curNote) } } else if (-1 == this.jn.pitchIndex || this.l.song.getChannelIsMod(this.l.channel)) { this.di || t.append(new Pi(this.l, 0, 0)); const s = Math.max(this.jn.curNote.start, Math.min(this.jn.curNote.end, Math.round(this.N / (this.Qh * i)) * i)) - this.jn.curNote.start; let n, o = this.jn.curNote.pins[0], h = 0, a = 0, r = this.l.song.getVolumeCap(this.l.song.getChannelIsMod(this.l.channel), this.l.channel, this.l.getCurrentInstrument(this.Xo), this.jn.pitch), l = 25 / Math.pow(r, .4), c = 22 / Math.pow(r, .5), d = this.Mh > this.Ge ? 1 : -1, p = Math.min(Math.abs(this.Mh - this.Ge) / l, 8) + Math.max(0, Math.abs(this.Mh - this.Ge) / c - 8); p > 0 && (this.Fh = !1); for (let t = 1; t < this.jn.curNote.pins.length; t++) { if (n = o, o = this.jn.curNote.pins[t], s > o.time) continue; if (s < n.time) throw new Error; const i = (s - n.time) / (o.time - n.time); h = Math.round(n.size * (1 - i) + o.size * i + d * p), this.controlMode || this.l.prefs.alwaysFineNoteVol || this.l.song.getChannelIsMod(this.l.channel) || (h = 2 * Math.floor(h / 2)), h < 0 && (h = 0), h > r && (h = r), a = this.da(n.interval * (1 - i) + o.interval * i + this.jn.curNote.pitches[0], 0, e.maxPitch) - this.jn.curNote.pitches[0]; break } if (this.l.song.getChannelIsMod(this.l.channel) && this.controlMode) if (s >= this.jn.curNote.pins[this.jn.curNote.pins.length - 1].time) if (this.jn.curNote.start + this.jn.curNote.pins[this.jn.curNote.pins.length - 1].time < this.l.song.beatsPerBar * e.partsPerBeat) for (const e of this.Se.notes) e.start == this.jn.curNote.start + this.jn.curNote.pins[this.jn.curNote.pins.length - 1].time && e.pitches[0] == this.jn.curNote.pitches[0] && t.append(new Oi(this.l, e, e.pins[0].time, h, a, this.shiftMode)); else { const e = this.l.getCurrentPattern(1); if (null != e && e.instruments[0] == this.Se.instruments[0]) for (const i of e.notes) 0 == i.start && i.pitches[0] == this.jn.curNote.pitches[0] && t.append(new Oi(this.l, i, i.pins[0].time, h, a, this.shiftMode)) } else if (s <= this.jn.curNote.pins[0].time) if (this.jn.curNote.start > 0) for (const e of this.Se.notes) e.end == this.jn.curNote.start && e.pitches[0] == this.jn.curNote.pitches[0] && t.append(new Oi(this.l, e, e.pins[e.pins.length - 1].time, h, a, this.shiftMode)); else { const i = this.l.getCurrentPattern(-1); if (null != i && i.instruments[0] == this.Se.instruments[0]) for (const s of i.notes) s.end == this.l.song.beatsPerBar * e.partsPerBeat && s.pitches[0] == this.jn.curNote.pitches[0] && t.append(new Oi(this.l, s, s.pins[s.pins.length - 1].time, h, a, this.shiftMode)) } this.Ph = this.jn.curNote.start + s, this.Ah = this.jn.curNote.pitches[-1 == this.jn.pitchIndex ? 0 : this.jn.pitchIndex] + a, this.Lh = h, this.qh = !0, t.append(new Oi(this.l, this.jn.curNote, s, h, a, this.shiftMode)), this.oa(this.jn.curNote) } else { if (t.append(new Pi(this.l, 0, 0)), this.Lh = this.jn.curNote.pins[this.jn.nearPinIndex].size, null == this.Se) throw new Error; let n, o; this.N >= this.en ? (n = Math.max(this.jn.curNote.start, this.jn.part), o = s + i) : (n = Math.min(this.jn.curNote.end, this.jn.part + i), o = s), o < 0 && (o = 0), o > this.l.song.beatsPerBar * e.partsPerBeat && (o = this.l.song.beatsPerBar * e.partsPerBeat), o > this.jn.curNote.end && t.append(new Fi(this.l, this.Se, this.jn.curNote.start, o, this.jn.curNote)), o < this.jn.curNote.start && t.append(new Fi(this.l, this.Se, o, this.jn.curNote.end, this.jn.curNote)); let h = Number.MAX_VALUE, a = -Number.MAX_VALUE; for (const t of this.jn.curNote.pitches) h > t && (h = t), a < t && (a = t); if (h -= this.jn.curNote.pitches[this.jn.pitchIndex], a -= this.jn.curNote.pitches[this.jn.pitchIndex], this.l.song.getChannelIsMod(this.l.channel)) { const i = this.da(this.Ah, -h, e.modCount - 1); t.append(new ni(this.l, this.jn.curNote, n, o, i, this.jn.pitchIndex)), this.Ah = i } else { const i = this.da(this.ra(this.Ge), -h, (this.l.song.getChannelIsNoise(this.l.channel) ? e.drumCount - 1 : e.maxPitch) - a); t.append(new ni(this.l, this.jn.curNote, n, o, i, this.jn.pitchIndex)), this.Ah = i } this.oa(this.jn.curNote), this.Ph = o, this.qh = !0 } } this.R && this.jn.valid && t || (this.eo(), this.W()) } na(t) { this.Dh = t, this.l.record(this.Dh, this.Nh) } W() { if (this.kh) if (!this.R || !this.jn.valid || !this.di || !this.qh || this.Fh || this.Eh || this.Th || this.Ih) this.hh.setAttribute("visibility", "hidden"), this.editingModLabel || (this.modDragValueLabel.style.setProperty("display", "none"), this.modDragValueLabel.style.setProperty("pointer-events", "none"), this.modDragValueLabel.setAttribute("contenteditable", "false")); else { this.hh.setAttribute("visibility", "visible"); const t = this.Qh * this.Ph, e = this.la(this.Ah - this.Rh), i = (this.gh - this.ca) / 2, s = 80, n = 60, o = this.l.song.getVolumeCap(this.l.song.getChannelIsMod(this.l.channel), this.l.channel, this.l.getCurrentInstrument(this.Xo), this.jn.pitch); let h = ""; h += "M " + S(t) + " " + S(e - i * (this.Lh / o)) + " ", h += "L " + S(t) + " " + S(e - i * (this.Lh / o) - n) + " ", h += "M " + S(t) + " " + S(e + i * (this.Lh / o)) + " ", h += "L " + S(t) + " " + S(e + i * (this.Lh / o) + n) + " ", h += "M " + S(t) + " " + S(e - i * (this.Lh / o)) + " ", h += "L " + S(t + s) + " " + S(e - i * (this.Lh / o)) + " ", h += "M " + S(t) + " " + S(e + i * (this.Lh / o)) + " ", h += "L " + S(t + s) + " " + S(e + i * (this.Lh / o)) + " ", h += "M " + S(t) + " " + S(e - i * (this.Lh / o)) + " ", h += "L " + S(t - s) + " " + S(e - i * (this.Lh / o)) + " ", h += "M " + S(t) + " " + S(e + i * (this.Lh / o)) + " ", h += "L " + S(t - s) + " " + S(e + i * (this.Lh / o)) + " ", this.hh.setAttribute("d", h) } else if (this.O && !this.R && this.jn.valid) if (this.hh.setAttribute("visibility", "visible"), this.ma()) { const t = this.Qh * this.l.selection.patternSelectionStart, e = S(t - 4), i = S(t + 4), s = this.la(-.5); this.hh.setAttribute("d", "M " + e + " 0 L " + e + " " + s + " L " + i + " " + s + " L " + i + " 0 z") } else if (this.fa()) { const t = this.Qh * this.l.selection.patternSelectionEnd, e = S(t - 4), i = S(t + 4), s = this.la(-.5); this.hh.setAttribute("d", "M " + e + " 0 L " + e + " " + s + " L " + i + " " + s + " L " + i + " 0 z") } else if (this.ua()) { const t = S(this.Qh * this.l.selection.patternSelectionStart - 2), e = S(this.Qh * this.l.selection.patternSelectionEnd + 2), i = this.la(-.5); this.hh.setAttribute("d", "M " + t + " 0 L " + t + " " + i + " L " + e + " " + i + " L " + e + " 0 z") } else this.ga(this.hh, this.jn.pitch, this.jn.start, this.jn.pins, (this.gh - this.ca) / 2 + 1, !0, this.Rh); else this.hh.setAttribute("visibility", "hidden"), this.editingModLabel || (this.modDragValueLabel.style.setProperty("display", "none"), this.modDragValueLabel.style.setProperty("pointer-events", "none"), this.modDragValueLabel.setAttribute("contenteditable", "false")) } ba() { this.l.selection.patternSelectionActive ? (this.oh.setAttribute("visibility", "visible"), this.oh.setAttribute("x", String(this.Qh * this.l.selection.patternSelectionStart)), this.oh.setAttribute("width", String(this.Qh * (this.l.selection.patternSelectionEnd - this.l.selection.patternSelectionStart)))) : this.oh.setAttribute("visibility", "hidden") } render() { const t = this.l.getCurrentPattern(this.Xo); if (this.Se != t && null != this.Se && (this.l.song.getChannelIsMod(this.l.channel) && this.Qo && null != t && t.notes.sort((function (t, e) { return t.start == e.start ? t.pitches[0] - e.pitches[0] : t.start - e.start })), this.gi = null, this.it(null)), this.Se = t, this.m = this.container.clientWidth, this.v = this.container.clientHeight, this.Qh = this.m / (this.l.song.beatsPerBar * e.partsPerBeat), this.Rh = this.l.channel >= this.l.song.pitchChannelCount ? 0 : this.l.song.channels[this.l.channel].octave * e.pitchesPerOctave, this.l.song.getChannelIsNoise(this.l.channel)) this.ca = 0, this.ya = e.drumCount; else if (this.l.song.getChannelIsMod(this.l.channel)) { if (this.ca = this.ah, this.ya = e.modCount, null != this.Se) for (const t of this.Se.notes) { let e = t.pitches[0], i = this.l.song.getVolumeCap(!0, this.l.channel, this.l.getCurrentInstrument(this.Xo), e), s = 0; for (const e of t.pins) e.size > s && (s = e.size); if (s > i) for (const e of t.pins) e.size = Math.round(e.size * (i / s)) } } else this.ca = 0, this.ya = this.l.getVisiblePitchCount(); this.gh = this.v / this.ya, this.Rh = this.l.channel >= this.l.song.pitchChannelCount ? 0 : this.l.getBaseVisibleOctave(this.l.channel) * e.pitchesPerOctave, this.jh == this.l.song.rhythm && this.Uh == this.l.song.pitchChannelCount && this.Wh == this.l.song.noiseChannelCount && this.Kh == this.l.song.modChannelCount || (this.jh = this.l.song.rhythm, this.Uh = this.l.song.pitchChannelCount, this.Wh = this.l.song.noiseChannelCount, this.Kh = this.l.song.modChannelCount, this.resetCopiedPins()), this.pa = this.xh[this.l.channel], this.Oh == this.m && this.$h == this.v || (this.Oh = this.m, this.$h = this.v, this.ih.setAttribute("width", "" + this.m), this.ih.setAttribute("height", "" + this.v), this.nh.setAttribute("height", "" + this.v), this.oh.setAttribute("y", "0"), this.oh.setAttribute("height", "" + this.v)); const i = this.m / this.l.song.beatsPerBar; if (this.Hh != i || this.Vh != this.gh) { this.Hh = i, this.Vh = this.gh, this.Zo.setAttribute("width", "" + i), this.Zo.setAttribute("height", "" + this.gh * e.pitchesPerOctave), this.th.setAttribute("width", "" + i), this.th.setAttribute("height", "" + this.gh), this.eh.setAttribute("width", "" + i), this.eh.setAttribute("height", "" + this.gh), this.eh.setAttribute("y", "" + this.ca / 2), this.lh.setAttribute("width", "" + (i - 2)), this.lh.setAttribute("height", "" + (this.gh - 2)), this.gh > this.ca && (this.dh.setAttribute("width", "" + (i - 2)), this.dh.setAttribute("height", "" + (this.gh - this.ca))); for (let t = 0; t < e.pitchesPerOctave; t++) { const s = this.rh[t], n = (e.pitchesPerOctave - t) % e.pitchesPerOctave; s.setAttribute("width", "" + (i - 2)), s.setAttribute("y", "" + (n * this.gh + 1)), s.setAttribute("height", "" + (this.gh - 2)) } } this.Qo && (this.R || this.eo(), this.W(), this.ba()), this.Ts != this.l.prefs.showFifth && (this.Ts = this.l.prefs.showFifth, this.rh[7].setAttribute("fill", this.l.prefs.showFifth ? j.fifthNote : j.pitchBackground)); for (let t = 0; t < e.pitchesPerOctave; t++)this.rh[t].style.visibility = e.scales[this.l.song.scale].flags[t] ? "visible" : "hidden"; this.l.song.getChannelIsNoise(this.l.channel) ? this.Gh || (this.Gh = !0, this._h = !1, this.ih.setAttribute("fill", "url(#patternEditorDrumBackground" + this.Xo + ")")) : this.l.song.getChannelIsMod(this.l.channel) ? this._h || (this.Gh = !1, this._h = !0, this.ih.setAttribute("fill", "url(#patternEditorModBackground" + this.Xo + ")")) : (this.Gh || this._h) && (this.Gh = !1, this._h = !1, this.ih.setAttribute("fill", "url(#patternEditorNoteBackground" + this.Xo + ")")), this.sa() } sa() { if (this.sh = function (t) { const e = t.cloneNode(!1); return t.parentNode.replaceChild(e, t), e }(this.sh), this.l.prefs.showChannels && !this.l.song.getChannelIsMod(this.l.channel)) for (let t = this.l.song.pitchChannelCount + this.l.song.noiseChannelCount - 1; t >= 0; t--) { if (t == this.l.channel) continue; if (this.l.song.getChannelIsNoise(t) != this.l.song.getChannelIsNoise(this.l.channel)) continue; const i = this.l.song.getPattern(t, this.l.bar + this.Xo); if (null == i) continue; const s = this.l.getBaseVisibleOctave(t) * e.pitchesPerOctave; for (const e of i.notes) for (const i of e.pitches) { const n = B.path(); n.setAttribute("fill", j.getChannelColor(this.l.song, t).secondaryNote), n.setAttribute("pointer-events", "none"), this.ga(n, i, e.start, e.pins, .19 * this.gh, !1, s), this.sh.appendChild(n) } } if (null != this.Se) { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument(this.Xo)], i = t.getChord(), s = t.getTransition(), n = i.customInterval || i.arpeggiates || i.strumParts > 0 || s.slides; for (const i of this.Se.notes) { let s = !1; if (this.l.song.getChannelIsMod(this.l.channel)) { (t.modulators[e.modCount - 1 - i.pitches[0]] == e.modulators.dictionary.none.index || t.invalidModulators[e.modCount - 1 - i.pitches[0]]) && (s = !0) } for (let t = 0; t < i.pitches.length; t++) { const e = i.pitches[t]; let o = B.path(), h = s ? j.disabledNotePrimary : j.getChannelColor(this.l.song, this.l.channel).primaryNote, a = s ? j.disabledNoteSecondary : j.getChannelColor(this.l.song, this.l.channel).secondaryNote; o.setAttribute("fill", a), o.setAttribute("pointer-events", "none"), this.ga(o, e, i.start, i.pins, (this.gh - this.ca) / 2 + 1, !1, this.Rh), this.sh.appendChild(o), o = B.path(), o.setAttribute("fill", h), o.setAttribute("pointer-events", "none"), this.ga(o, e, i.start, i.pins, (this.gh - this.ca) / 2 + 1, !0, this.Rh), this.sh.appendChild(o); let r = 2; if (i.continuesLastPattern) { const t = Math.min(this.gh, 20); let s; s = "M " + S(this.Qh * i.start + r) + " " + S(this.la(e - this.Rh) - .1 * t), s += "L " + S(this.Qh * i.start + r) + " " + S(this.la(e - this.Rh) + .1 * t), s += "L " + S(this.Qh * i.start + r + 4) + " " + S(this.la(e - this.Rh) + .1 * t), s += "L " + S(this.Qh * i.start + r + 4) + " " + S(this.la(e - this.Rh) + .3 * t), s += "L " + S(this.Qh * i.start + r + 12) + " " + S(this.la(e - this.Rh)), s += "L " + S(this.Qh * i.start + r + 4) + " " + S(this.la(e - this.Rh) - .3 * t), s += "L " + S(this.Qh * i.start + r + 4) + " " + S(this.la(e - this.Rh) - .1 * t); const n = B.path(); n.setAttribute("d", s), n.setAttribute("fill", j.invertedText), this.sh.appendChild(n), r += 12 } if (i.pitches.length > 1 && n) { const s = B.text(); s.setAttribute("x", "" + S(this.Qh * i.start + r)), s.setAttribute("y", "" + S(this.la(e - this.Rh))), s.setAttribute("width", "30"), s.setAttribute("fill", j.invertedText), s.setAttribute("text-anchor", "start"), s.setAttribute("dominant-baseline", "central"), s.setAttribute("pointer-events", "none"), s.textContent = "" + (t + 1), this.sh.appendChild(s) } } if (this.l.song.getChannelIsMod(this.l.channel) && this.di && !this.wh && i == this.jn.curNote) { this.modDragValueLabel.style.setProperty("display", ""), this.modDragValueLabel.style.setProperty("pointer-events", "none"), this.modDragValueLabel.setAttribute("contenteditable", "false"), this.modDragValueLabel.style.setProperty("color", "#FFFFFF"); let t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument(this.Xo)].modulators[e.modCount - 1 - i.pitches[0]], s = this.Lh + e.modulators[t].convertRealFactor, n = +(s >= 10) + +(s >= 100) + +(s < 0) + +(s <= -10); this.mh = 8 + 8 * n, this.ph = +S(Math.max(Math.min(this.m - 10 - 8 * n, this.Qh * this.Ph - 4 - 4 * n), 2)), this.uh = +S(this.la(i.pitches[0] - this.Rh) - 17 - (this.gh - this.ca) / 2), this.modDragValueLabel.style.setProperty("left", this.ph + "px"), this.modDragValueLabel.style.setProperty("top", this.uh + "px"), this.modDragValueLabel.textContent = "" + s } } } this.l.currentPatternIsDirty = !1 } ga(t, e, i, s, n, o, h) { const a = this.Qh * (s[s.length - 1].time + s[0].time), r = .5 * Math.min(2, a - 1); let l = s[0]; const c = this.l.song.getVolumeCap(this.l.song.getChannelIsMod(this.l.channel), this.l.channel, this.l.getCurrentInstrument(this.Xo), e); let d = "M " + S(this.Qh * (i + l.time) + r) + " " + S(this.la(e - h) + n * (o ? l.size / c : 1)) + " "; for (let t = 1; t < s.length; t++) { let a = l; l = s[t]; let p = this.Qh * (i + a.time) + (1 == t ? r : 0), u = this.Qh * (i + l.time) - (t == s.length - 1 ? r : 0), m = this.la(e + a.interval - h), f = this.la(e + l.interval - h), y = o ? a.size / c : 1, b = o ? l.size / c : 1; d += "L " + S(p) + " " + S(m - n * y) + " ", a.interval > l.interval && (d += "L " + S(p + 1) + " " + S(m - n * y) + " "), a.interval < l.interval && (d += "L " + S(u - 1) + " " + S(f - n * b) + " "), d += "L " + S(u) + " " + S(f - n * b) + " " } for (let t = s.length - 2; t >= 0; t--) { let a = l; l = s[t]; let p = this.Qh * (i + a.time) - (t == s.length - 2 ? r : 0), u = this.Qh * (i + l.time) + (0 == t ? r : 0), m = this.la(e + a.interval - h), f = this.la(e + l.interval - h), y = o ? a.size / c : 1, b = o ? l.size / c : 1; d += "L " + S(p) + " " + S(m + n * y) + " ", a.interval < l.interval && (d += "L " + S(p - 1) + " " + S(m + n * y) + " "), a.interval > l.interval && (d += "L " + S(u + 1) + " " + S(f + n * b) + " "), d += "L " + S(u) + " " + S(f + n * b) + " " } d += "z", t.setAttribute("d", d) } la(t) { return this.gh * (this.ya - t - .5) } } class Fn { constructor(t) { this.l = t, this.wa = z.div({ style: "width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;" }), this.va = z.div({ style: "width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;" }), this.ka = z.div({ style: "width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;" }), this.xa = z.div({ style: `width: 100%; height: 40px; border: 2px solid ${j.primaryText}; position: absolute; box-sizing: border-box; pointer-events: none;` }), this.container = z.div({ style: "width: 32px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0; touch-action: none;" }, this.wa, this.va, this.ka, this.xa), this.v = 481, this.Ma = [], this.Sa = [], this.Fa = [], this.Ca = [], this.Ea = [], this.Ta = [], this.Ge = 0, this.R = !1, this.O = !1, this.Ia = -1, this.Pa = -1, this.Gh = !1, this._h = !1, this.Aa = -1, this.La = -1, this.qa = [], this.U = t => { this.O || (this.O = !0, this.W()) }, this.K = t => { this.O && (this.O = !1, this.W()) }, this.J = t => { t.preventDefault(), this.l.synth.maintainLiveInput(), this.R = !0; const e = this.container.getBoundingClientRect(); this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.Da(), this.Na(), this.W() }, this.Z = t => { (this.R || this.O) && this.l.synth.maintainLiveInput(); const e = this.container.getBoundingClientRect(); this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.Da(), this.R && this.Na(), this.W() }, this.za = t => { this.R && this.Ba(), this.R = !1, this.W() }, this.X = t => { t.preventDefault(), this.l.synth.maintainLiveInput(), this.R = !0; const e = this.container.getBoundingClientRect(); this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.Da(), this.Na() }, this.et = t => { t.preventDefault(), this.l.synth.maintainLiveInput(); const e = this.container.getBoundingClientRect(); this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.Ge) && (this.Ge = 0), this.Da(), this.R && this.Na() }, this.io = t => { t.preventDefault(), this.R = !1, this.Ba() }, this.Ra = () => { window.requestAnimationFrame(this.Ra); let t = !1; const e = this.l.performance.pitchesAreTemporary() ? 0 : this.l.synth.liveInputPitches.length; this.qa.length != e && (t = !0); for (let i = 0; i < e; i++)this.qa[i] != this.l.synth.liveInputPitches[i] && (this.qa[i] = this.l.synth.liveInputPitches[i], t = !0); this.qa.length = e, t && this.W() }, this.no = () => { const t = this.l.song.getChannelIsNoise(this.l.channel), i = this.l.song.getChannelIsMod(this.l.channel); if (this.ya = i ? e.modCount : t ? e.drumCount : this.l.getVisiblePitchCount(), this.gh = this.v / this.ya, this.Da(), this.R && this.Na(), !this.l.prefs.showLetters) return; if (this.Pa == this.l.song.scale && this.Aa == this.l.song.key && this.Gh == t && this._h == i && this.La == this.ya) return; this.Pa = this.l.song.scale, this.Aa = this.l.song.key, this.Gh = t, this._h = i; const s = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; if (this.wa.style.display = t || i ? "none" : "flex", this.va.style.display = t ? "flex" : "none", this.ka.style.display = i ? "flex" : "none", t || i) { if (i) { let t = "", i = "", a = j.modLabelPrimaryText, r = j.modLabelSecondaryText; for (let l = 0; l < e.modCount; l++) { let c = !0, d = !0, p = s.modInstruments[e.modCount - l - 1] + 1, u = s.modChannels[e.modCount - l - 1] + 1, m = s.modulators[e.modCount - l - 1], f = +(u - 1 >= this.l.song.pitchChannelCount) + 1; -2 == s.modChannels[e.modCount - l - 1] ? f = 0 : -1 == s.modChannels[e.modCount - l - 1] && (f = 3); let y = this.l.song.channels[Math.max(0, u - 1)].instruments.length; switch (f) { case 0: t = "Mod", c = !1, r = j.modLabelSecondaryText, d = !1; break; case 1: if ("" == this.l.song.channels[u - 1].name) y > 1 ? u >= 10 || p >= 10 ? (t = "P" + u, t += p - 1 == y ? " All" : p - 1 > y ? " Act" : " I" + p) : (t = "Pitch" + u, t += p - 1 == y ? " All" : p - 1 > y ? " Act" : " Ins" + p) : t = "Pitch " + u; else { let e; e = p - 1 == y ? " All" : p - 1 > y ? " Act" : " I" + p, t = y > 1 ? "P" + u + " " + this.l.song.channels[u - 1].name + e : "P" + u + " " + this.l.song.channels[u - 1].name } break; case 2: if (u = s.modChannels[e.modCount - l - 1] + 1 - this.l.song.pitchChannelCount, y = this.l.song.channels[u - 1].instruments.length, "" == this.l.song.channels[u - 1].name) y > 1 ? u >= 10 || p >= 10 ? (t = "N" + u, t += p - 1 == y ? " All" : p - 1 > y ? " Act" : " I" + p) : (t = "Noise" + u, t += p - 1 == y ? " All" : p - 1 > y ? " Act" : " Ins" + p) : t = "Noise " + u; else if (y > 1) { let e; e = p - 1 == y ? " All" : p - 1 > y ? " Act" : " I" + p, t = "N" + u + " " + this.l.song.channels[u - 1].name + e } else t = "N" + u + " " + this.l.song.channels[u - 1].name; break; case 3: t = "Song" }if (c) if (i = e.modulators[m].pianoName, m == e.modulators.dictionary.none.index) r = j.modLabelSecondaryText, d = !1; else if (m == e.modulators.dictionary["eq filter"].index || m == e.modulators.dictionary["note filter"].index) { var n = " Morph", o = s.modFilterTypes[e.modCount - l - 1]; o > 0 && o % 2 ? n = " Dot" + Math.ceil(o / 2) + "X" : o > 0 && (n = " Dot" + Math.ceil(o / 2) + "Y"), i += n } const b = this.Fa[l], g = this.Ca[l], w = this.Ea[l], v = this.Ta[l]; if (b.style.fill = a, b.textContent = t, g.style.fill = r, g.textContent = c ? i : "Not set", w.textContent = "" + (e.modCount - l), v.style.fill = d ? j.indicatorPrimary : j.modLabelSecondaryText, "" != this.l.song.channels[Math.max(0, s.modChannels[e.modCount - l - 1])].name) { let t = "1", e = b.parentElement.parentElement.getBoundingClientRect().height, i = b.getComputedTextLength(), s = 0; for (i > e - 8 ? (t = "0.65", s = 2) : i > e - 24 && (t = "0.8", s = 1), b.style.transform = "rotate(-90deg) translate(" + (-20 - s - Math.round(Math.max(0, (e - 80) / 2))) + "px, 39px) scale(" + t + ", 1)"; "0.65" == t && b.getComputedTextLength() > e + 8;) { var h = 4 + (p >= 10 ? 1 : 0); b.textContent = b.textContent.substr(0, b.textContent.length - h) + b.textContent.substr(b.textContent.length - h + 1) } } else { let t = b.parentElement.parentElement.getBoundingClientRect().height; b.style.transform = "rotate(-90deg) translate(" + (-20 - Math.round(Math.max(0, (t - 80) / 2))) + "px, 39px) scale(1, 1)" } } } } else { if (this.La != this.ya) { this.wa.innerHTML = ""; for (let t = 0; t < this.ya; t++) { const e = z.div({ class: "piano-label", style: "font-weight: bold; -webkit-text-stroke-width: 0; font-size: 11px; font-family: sans-serif; position: absolute; padding-left: 15px;" }), i = z.div({ class: "piano-button", style: "background: gray;" }, e); this.wa.appendChild(i), this.Sa[t] = e, this.Ma[t] = i } this.Sa.length = this.ya, this.Ma.length = this.ya, this.La = this.ya } for (let t = 0; t < this.ya; t++) { const i = (t + e.keys[this.l.song.key].basePitch) % e.pitchesPerOctave, s = e.keys[i].isWhiteKey; if (this.Ma[t].style.background = s ? j.whitePianoKey : j.blackPianoKey, e.scales[this.l.song.scale].flags[t % e.pitchesPerOctave]) { this.Ma[t].classList.remove("disabled"), this.Sa[t].style.display = ""; const s = this.Sa[t]; s.style.transform = t % 12 == 0 ? "translate(-5px, 0px)" : "translate(0px, 0px)", s.style.color = e.keys[i].isWhiteKey ? "black" : "white", s.textContent = Fn.getPitchName(i, t, this.l.getBaseVisibleOctave(this.l.channel)) } else this.Ma[t].classList.add("disabled"), this.Sa[t].style.display = "none" } } this.W() }; for (let t = 0; t < e.drumCount; t++) { const i = 100 * (1 - t / e.drumCount * .35); this.va.appendChild(z.div({ class: "drum-button", style: `background-size: ${i}% ${i}%;` })) } for (let t = 0; t < e.modCount; t++) { const t = B.text({ class: "modulator-label", "text-anchor": "left", fill: j.modLabelPrimaryText, style: "font-weight: bold; align-self: flex-start; transform-origin: center; transform: rotate(-90deg) translate(-19px, 39px); font-size: 11px; font-family: sans-serif;" }), e = B.text({ class: "modulator-label", "text-anchor": "left", fill: j.modLabelPrimaryText, style: "font-weight: bold; align-self: flex-end; transform-origin: center; transform: rotate(-90deg) translate(-26px, 42px); font-size: 11px; font-family: sans-serif;" }), i = B.text({ class: "modulator-inverse-label", fill: j.modLabelPrimary, style: "font-weight: bold; align-self: flex-start; transform-origin: center; transform: rotate(-90deg) translate(4px, 13px); font-size: 11px; font-family: sans-serif;" }), s = B.rect({ width: "12px", height: "9px", fill: j.indicatorPrimary, style: "pointer-events: none; transform: translate(4px, 4px);" }), n = B.svg({ viewBox: "0 0 16 66", width: "16px", style: "pointer-events: none; flex-grow: 1;" }, [t]), o = B.svg({ viewBox: "0 0 16 14", width: "16px", style: "pointer-events: none;" }, [s, i]), h = B.svg({ viewBox: "0 0 16 80", width: "16px", style: "pointer-events: none;" }, [e]), a = z.div({ style: "display: flex; flex-direction: column; justify-content: space-between; pointer-events: none;" }, [o, n]), r = z.div({ style: "display: flex; flex-direction: column-reverse; justify-content: space-between; pointer-events: none;" }, [h]), l = z.div({ style: "display: flex; flex-direction: row; justify-content: space-between; padding: 0px; width: 32px; height: 100%; overflow: hidden; pointer-events: none;" }, [a, r]), c = z.div({ class: "modulator-button", style: "background: " + j.modLabelPrimary + ";" }, l); this.ka.appendChild(c), this.Fa.push(t), this.Ca.push(e), this.Ea.push(i), this.Ta.push(s) } this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.za), this.container.addEventListener("mouseover", this.U), this.container.addEventListener("mouseout", this.K), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.io), this.container.addEventListener("touchcancel", this.io), this.l.notifier.watch(this.no), this.no(), window.requestAnimationFrame(this.Ra) } forceRender() { this.Pa = -1, this.no() } Da() { const t = e.scales[this.l.song.scale].flags, i = Math.max(0, Math.min(this.ya - 1, this.ya - this.Ge / this.gh)); if (t[Math.floor(i) % e.pitchesPerOctave] || this.l.song.getChannelIsNoise(this.l.channel)) this.Oa = Math.floor(i); else { let s = Math.floor(i) + 1, n = Math.floor(i) - 1; for (; !t[s % e.pitchesPerOctave];)s++; for (; !t[n % e.pitchesPerOctave];)n--; let o = s, h = n + 1; s % e.pitchesPerOctave != 0 && s % e.pitchesPerOctave != 7 || (o -= .5), n % e.pitchesPerOctave != 0 && n % e.pitchesPerOctave != 7 || (h += .5), this.Oa = i - h > o - i ? s : n } } Na() { const t = this.l.getBaseVisibleOctave(this.l.channel) * e.pitchesPerOctave, i = this.Oa + t; this.Ia != i && (this.l.performance.removePerformedPitch(this.Ia), this.Ia = i, this.l.performance.addPerformedPitch(i)) } Ba() { this.l.performance.removePerformedPitch(this.Ia), this.Ia = -1 } W() { if (this.xa.style.visibility = !this.O || this.R ? "hidden" : "visible", this.O && !this.R) { const t = this.container.getBoundingClientRect(), e = this.gh / (this.v / (t.bottom - t.top)); this.xa.style.left = "0px", this.xa.style.top = e * (this.ya - this.Oa - 1) + "px", this.xa.style.height = e + "px" } const t = this.l.getBaseVisibleOctave(this.l.channel) * e.pitchesPerOctave, i = (this.l.song.getChannelIsNoise(this.l.channel) ? this.va : this.wa).children; for (let e = 0; e < i.length; e++) { const s = i[e]; -1 == this.qa.indexOf(e + t) ? s.classList.remove("pressed") : s.classList.add("pressed") } } static getPitchName(t, i, s) { let n; if (e.keys[t].isWhiteKey) n = e.keys[t].name; else { const s = e.blackKeyNameParents[i % e.pitchesPerOctave]; n = e.keys[(t + e.pitchesPerOctave + s) % e.pitchesPerOctave].name, 1 == s ? n += "" : -1 == s && (n += "") } return i % 12 == 0 && (n += Math.floor(i / 12) + s), n } } const { button: Cn, div: En, span: Tn, h2: In, input: Pn, br: An, select: Ln, option: qn } = z; class Dn { constructor(t) { this.l = t, this.$a = Pn({ style: "width: 3em; margin-left: 1em;", type: "number", step: "1" }), this.Ha = Ln({ style: "width: 100%;" }, qn({ value: "end" }, "Apply change at end of song."), qn({ value: "beginning" }, "Apply change at beginning of song.")), this.Ie = Cn({ class: "cancelButton" }), this.Pe = Cn({ class: "okayButton", style: "width:45%;" }, "Okay"), this.container = En({ class: "prompt noSelection", style: "width: 250px;" }, In("Song Length"), En({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, En({ style: "display: inline-block; text-align: right;" }, "Bars per song:", An(), Tn({ style: `font-size: smaller; color: ${j.secondaryText};` }, "(Multiples of 4 are recommended)")), this.$a), En({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, En({ class: "selectContainer", style: "width: 100%;" }, this.Ha)), En({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.$a.removeEventListener("keypress", Dn.qe), this.$a.removeEventListener("blur", Dn.De), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Le() }, this.Le = () => { window.localStorage.setItem("barCountPosition", this.Ha.value); const t = new Pt; t.append(new jt(this.l, Dn.ze(this.$a), "beginning" == this.Ha.value)), this.l.prompt = null, this.l.record(t, !0) }, this.$a.value = this.l.song.barCount + "", this.$a.min = e.barCountMin + "", this.$a.max = e.barCountMax + ""; const i = window.localStorage.getItem("barCountPosition"); null != i && (this.Ha.value = i), this.$a.select(), setTimeout((() => this.$a.focus())), this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.$a.addEventListener("keypress", Dn.qe), this.$a.addEventListener("blur", Dn.De), this.container.addEventListener("keydown", this.Ne) } static qe(t) { const e = t.which ? t.which : t.keyCode; return 46 != e && e > 31 && (e < 48 || e > 57) && (t.preventDefault(), !0) } static De(t) { const e = t.target; e.value = String(Dn.ze(e)) } static ze(t) { return Math.floor(Math.max(Number(t.min), Math.min(Number(t.max), Number(t.value)))) } } const Nn = "songVersion: "; function zn(t) { return JSON.parse(t.substring(Nn.length)) } function Bn(t) { return Nn + JSON.stringify(t) } function Rn() { return (Math.random() * (-1 >>> 0) >>> 0).toString(32) } function On(t, e) { return e.versions[0].time - t.versions[0].time } function $n(t, e) { return e.time - t.time } class Hn { constructor() { this.Va = new kt } static getAllRecoveredSongs() { const t = [], e = {}; for (let i = 0; i < localStorage.length; i++) { const s = localStorage.key(i); if (0 == s.indexOf(Nn)) { const i = zn(s); let n = e[i.uid]; null == n && (n = { versions: [] }, e[i.uid] = n, t.push(n)), n.versions.push(i) } } for (const e of t) e.versions.sort($n); return t.sort(On), t } saveVersion(t, e, i) { const s = e, n = Math.round(Date.now()); clearTimeout(this.Ga), this.Ga = setTimeout((() => { try { this.Va.fromBase64String(i) } catch (t) { return void window.alert('Whoops, the song data appears to have been corrupted! Please try to recover the last working version of the song from the "Recover Recent Song..." option in BeepBox\'s "File" menu.') } const e = Hn.getAllRecoveredSongs(); let o = null; for (const i of e) i.versions[0].uid == t && (o = i); null == o && (o = { versions: [] }, e.unshift(o)); let h = o.versions, a = 1e3; if (h.length > 0) { const t = h[0].time; a = h[0].work + Math.min(18e4, n - t) } const r = { uid: t, name: s, time: n, work: a }, l = Bn(r); h.unshift(r), localStorage.setItem(l, i); let c = 6e4; const d = Math.pow(2, .5); for (var p = 1; p < h.length; p++) { if (h[p].work - (p == h.length - 1 ? 0 : h[p + 1].work) < c) { let t = p; if (p < h.length - 1) { const e = h[p].time, i = h[p - 1].time; e - h[p + 1].time < .5 * (i - e) && (t = p + 1) } localStorage.removeItem(Bn(h[t])); break } c *= d } for (; e.length > 8;) { let t = null, i = Number.POSITIVE_INFINITY; for (let s = Math.round(4); s < e.length; s++) { const o = e[s], h = 1 / ((n - o.versions[0].time) / 432e5 + 1), a = (o.versions[0].work + 3e5) * h; i > a && (i = a, t = o) } for (const e of t.versions) localStorage.removeItem(Bn(e)); e.splice(e.indexOf(t), 1) } }), 750) } } const { button: Vn, div: Gn, h2: _n, p: jn, select: Un, option: Wn, iframe: Kn } = z; class Jn { constructor(t) { this.l = t, this._a = Gn(), this.Ie = Vn({ class: "cancelButton" }), this.container = Gn({ class: "prompt", style: "width: 300px;" }, _n("Song Recovery"), Gn({ style: "max-height: 385px; overflow-y: auto;" }, jn("This is a TEMPORARY list of songs you have recently modified. Please keep your own backups of songs you care about!"), this._a, jn('(If "Display Song Data in URL" is enabled in your preferences, then you may also be able to find song versions in your browser history. However, song recovery won\'t work if you were browsing in private/incognito mode.)')), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Ie.removeEventListener("click", this.Ae) }, this.Ie.addEventListener("click", this.Ae); const e = Hn.getAllRecoveredSongs(); 0 == e.length && this._a.appendChild(jn("There are no recovered songs available yet. Try making a song!")); for (const t of e) { const e = Un({ style: "width: 100%;" }); for (const i of t.versions) e.appendChild(Wn({ value: i.time }, i.name + ": " + new Date(i.time).toLocaleString())); const i = Kn({ style: "width: 100%; height: 60px; border: none; display: block;" }); i.src = "player/index.html#song=" + window.localStorage.getItem(Bn(t.versions[0])); const s = Gn({ style: "margin: 4px 0;" }, Gn({ class: "selectContainer", style: "width: 100%; margin: 2px 0;" }, e), i); this._a.appendChild(s), e.addEventListener("change", (() => { const s = t.versions[e.selectedIndex]; i.contentWindow.location.replace("player/index.html#song=" + window.localStorage.getItem(Bn(s))), i.contentWindow.dispatchEvent(new Event("hashchange")) })) } } } const { button: Yn, label: Qn, div: Xn, p: Zn, a: to, h2: eo, input: io, select: so, option: no } = z; class oo { constructor(t) { this.l = t, this.ja = so({ style: "width: 100%;" }, no({ value: "useCapsLockForNotes" }, "simple shortcuts, use caps lock to play notes"), no({ value: "pressControlForShortcuts" }, "simple notes, press " + F.ctrlName + " for shortcuts")), this.Ua = so({ style: "width: 100%;" }, no({ value: "wickiHayden" }, "Wicki-Hayden"), no({ value: "songScale" }, "selected song scale"), no({ value: "pianoAtC" }, "piano starting at C :)"), no({ value: "pianoAtA" }, "piano starting at A :("), no({ value: "pianoTransposingC" }, "piano transposing C :) to song key"), no({ value: "pianoTransposingA" }, "piano transposing A :( to song key")), this.Wa = Xn({ style: "display: grid; row-gap: 4px; margin: 4px auto; font-size: 10px;" }), this.Ka = io({ style: "width: 2em; margin-left: 1em;", type: "checkbox" }), this.Ja = io({ style: "width: 2em; margin-left: 1em;", type: "checkbox" }), this.Ya = io({ style: "width: 2em; margin-left: 1em;", type: "checkbox" }), this.Qa = io({ style: "width: 2em; margin-left: 1em;", type: "checkbox" }), this.Xa = io({ style: "width: 2em; margin-left: 1em;", type: "checkbox" }), this.Za = io({ style: "width: 2em; margin-left: 1em;", type: "checkbox" }), this.Pe = Yn({ class: "okayButton", style: "width:45%;" }, "Okay"), this.Ie = Yn({ class: "cancelButton" }), this.container = Xn({ class: "prompt noSelection recordingSetupPrompt", style: "width: 333px; text-align: right; max-height: 90%;" }, eo("Note Recording Setup"), Xn({ style: "display: grid; overflow-y: auto; overflow-x: hidden; flex-shrink: 1;" }, Zn("BeepBox can record notes as you perform them. You can start recording by pressing Ctrl+Space (or " + F.ctrlSymbol + "P)."), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Add  record button next to  play button:", this.Ja), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Snap recorded notes to the song's rhythm:", this.Ya), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Ignore notes not in the song's scale:", this.Qa), Zn("While recording, you can perform notes on your keyboard!"), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Keyboard layout:", Xn({ class: "selectContainer", style: "width: 65%; margin-left: 1em;" }, this.Ua)), this.Wa, Zn("When not recording, you can use the computer keyboard either for shortcuts (like C and V for copy and paste) or for performing notes, depending on this mode:"), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, Xn({ class: "selectContainer", style: "width: 100%;" }, this.ja)), Zn("Performing music takes practice! Try slowing the tempo and using this metronome to help you keep a rhythm."), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Hear metronome while recording:", this.Za), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Count-in 1 bar of metronome before recording:", this.Xa), Zn("If you have a ", to({ href: "https://caniuse.com/midi", target: "_blank" }, "compatible browser"), " on a device connected to a MIDI keyboard, you can use it to perform notes in BeepBox! (Or you could buy ", to({ href: "https://imitone.com/", target: "_blank" }, "Imitone"), " or ", to({ href: "https://vochlea.com/", target: "_blank" }, "Dubler"), " to hum notes into a microphone while wearing headphones!)"), Qn({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, "Enable MIDI performance:", this.Ka), Zn('Tip: Recorded notes often overlap such that one note ends after the next note already started. In BeepBox, these notes get split into two notes which may sound different when re-played than they did when you were recording. To fix the sound, you can either manually clean up the notes in the pattern editor, or you could try enabling the "transition type" effect on the instrument and setting it to "continue".'), Xn({ style: `width: 100%; height: 80px; background: linear-gradient(rgba(0,0,0,0), ${j.editorBackground}); position: sticky; bottom: 0; pointer-events: none;` })), Qn({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Os), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Os() }, this.Os = () => { this.l.prefs.pressControlForShortcuts = "pressControlForShortcuts" == this.ja.value, this.l.prefs.keyboardLayout = this.Ua.value, this.l.prefs.enableMidi = this.Ka.checked, this.l.prefs.showRecordButton = this.Ja.checked, this.l.prefs.snapRecordedNotesToRhythm = this.Ya.checked, this.l.prefs.ignorePerformedNotesNotInScale = this.Qa.checked, this.l.prefs.metronomeCountIn = this.Xa.checked, this.l.prefs.metronomeWhileRecording = this.Za.checked, this.l.prefs.save(), this.Ae() }, this.tr = () => { for (; this.Wa.firstChild;)this.Wa.removeChild(this.Wa.firstChild); const t = [12, 12, 11, 10], i = e.scales[this.l.song.scale].flags; for (let s = 0; s < 4; s++) { const n = Xn({ style: "display: flex;" }); this.Wa.appendChild(n); const o = Xn({ style: "width: " + 12 * s + "px; height: 20px; flex-shrink: 0;" }); n.appendChild(o); for (let o = 0; o < t[s]; o++) { const t = Xn({ style: "width: 20px; height: 20px; margin: 0 2px; box-sizing: border-box; flex-shrink: 0; display: flex; justify-content: center; align-items: center;" }); n.appendChild(t); const h = xn.keyPosToPitch(this.l, o, 3 - s, this.Ua.value); if (null != h) { const s = h % 12; i[s] ? 0 == s ? t.style.background = j.tonic : 7 == s && this.l.prefs.showFifth ? t.style.background = j.fifthNote : t.style.background = j.pitchBackground : t.style.border = "2px solid " + j.pitchBackground; const n = (s + e.keys[this.l.song.key].basePitch) % e.pitchesPerOctave; t.textContent = Fn.getPitchName(n, s, Math.floor(h / 12)) } } } }, this.ja.value = this.l.prefs.pressControlForShortcuts ? "pressControlForShortcuts" : "useCapsLockForNotes", this.Ua.value = this.l.prefs.keyboardLayout, this.Ka.checked = this.l.prefs.enableMidi, this.Ja.checked = this.l.prefs.showRecordButton, this.Ya.checked = this.l.prefs.snapRecordedNotesToRhythm, this.Qa.checked = this.l.prefs.ignorePerformedNotesNotInScale, this.Xa.checked = this.l.prefs.metronomeCountIn, this.Za.checked = this.l.prefs.metronomeWhileRecording, setTimeout((() => this.Ja.focus())), this.Pe.addEventListener("click", this.Os), this.Ie.addEventListener("click", this.Ae), this.container.addEventListener("keydown", this.Ne), this.tr(), this.Ua.addEventListener("change", this.tr) } } class ho { constructor(t, i) { this.l = t, this.er = i, this.m = 120, this.v = 26, this.Ke = B.path({ fill: j.uiWidgetBackground, "pointer-events": "none" }), this.ws = B.svg({ "pointer-events": "none" }), this.vs = B.svg({ "pointer-events": "none" }), this.ks = B.path({ fill: "none", stroke: "currentColor", "stroke-width": 2, "pointer-events": "none" }), this.ir = B.path({ fill: "currentColor", "pointer-events": "none" }), this.q = B.svg({ style: `background-color: ${j.editorBackground}; touch-action: none; cursor: crosshair;`, width: "100%", height: "100%", viewBox: "0 0 " + this.m + " " + this.v, preserveAspectRatio: "none" }, this.Ke, this.ws, this.vs, this.ks, this.ir), this.container = z.div({ class: "spectrum", style: "height: 100%;" }, this.q), this.N = 0, this.Ge = 0, this.Ss = 0, this.Fs = 0, this.R = !1, this.Cs = null, this.Es = "", this.Ts = !0, this.J = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Ss = this.Ti(this.N), this.Fs = this.Is(this.Ge), this.tt() }, this.X = t => { t.preventDefault(), this.R = !0; const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Ss = this.Ti(this.N), this.Fs = this.Is(this.Ge), this.tt() }, this.Z = t => { if (null == this.container.offsetParent) return; const e = this.q.getBoundingClientRect(); this.N = ((t.clientX || t.pageX) - e.left) * this.m / (e.right - e.left), this.Ge = ((t.clientY || t.pageY) - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.et = t => { if (null == this.container.offsetParent) return; if (!this.R) return; t.preventDefault(); const e = this.q.getBoundingClientRect(); this.N = (t.touches[0].clientX - e.left) * this.m / (e.right - e.left), this.Ge = (t.touches[0].clientY - e.top) * this.v / (e.bottom - e.top), isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.tt() }, this.it = t => { this.R && (this.l.record(this.Cs), this.Cs = null), this.R = !1 }; for (let t = 0; t < e.spectrumControlPoints; t += e.spectrumControlPointsPerOctave)this.ws.appendChild(B.rect({ fill: j.tonic, x: (t + 1) * this.m / (e.spectrumControlPoints + 2) - 1, y: 0, width: 2, height: this.v })); for (let t = 4; t <= e.spectrumControlPoints; t += e.spectrumControlPointsPerOctave)this.vs.appendChild(B.rect({ fill: j.fifthNote, x: (t + 1) * this.m / (e.spectrumControlPoints + 2) - 1, y: 0, width: 2, height: this.v })); this.container.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.it), this.container.addEventListener("touchstart", this.X), this.container.addEventListener("touchmove", this.et), this.container.addEventListener("touchend", this.it), this.container.addEventListener("touchcancel", this.it) } Ti(t) { return (e.spectrumControlPoints + 2) * t / this.m - 1 } Is(t) { return e.spectrumMax * (1 - (t - 1) / (this.v - 2)) } tt() { if (this.R) { const t = this.Ti(this.N), i = this.Is(this.Ge), s = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], n = null == this.er ? s.spectrumWave : s.drumsetSpectrumWaves[this.er]; if (t != this.Ss) { const s = (i - this.Fs) / (t - this.Ss), o = this.Fs - this.Ss * s, h = Math.ceil(Math.min(this.Ss, t)), a = Math.floor(Math.max(this.Ss, t)); for (let t = h; t <= a; t++)t < 0 || t >= e.spectrumControlPoints || (n.spectrum[t] = Math.max(0, Math.min(e.spectrumMax, Math.round(t * s + o)))) } n.spectrum[Math.max(0, Math.min(e.spectrumControlPoints - 1, Math.round(t)))] = Math.max(0, Math.min(e.spectrumMax, Math.round(i))), this.Ss = t, this.Fs = i, this.Cs = new de(this.l, s, n), this.l.setProspectiveChange(this.Cs) } } render() { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], i = null == this.er ? t.spectrumWave : t.drumsetSpectrumWaves[this.er], s = t => (1 - t / e.spectrumMax) * (this.v - 1) + 1; let n = 0, o = "M 0 " + S(this.v) + " "; for (let t = 0; t < e.spectrumControlPoints; t++) { let h = i.spectrum[t]; o += 0 != n || 0 != h ? "L " : "M ", o += S((t + 1) * this.m / (e.spectrumControlPoints + 2)) + " " + S(s(h)) + " ", n = h } const h = s(n); n > 0 && (o += "L " + (this.m - 1) + " " + S(h) + " "), this.Es != o && (this.Es = o, this.ks.setAttribute("d", o), this.Ke.setAttribute("d", o + "L " + this.m + " " + S(h) + " L " + this.m + " " + S(this.v) + " L 0 " + S(this.v) + " z "), this.ir.setAttribute("d", "M " + this.m + " " + S(h) + " L " + (this.m - 4) + " " + S(h - 4) + " L " + (this.m - 4) + " " + S(h + 4) + " z"), this.ir.style.display = n > 0 ? "" : "none"), this.Ts != this.l.prefs.showFifth && (this.Ts = this.l.prefs.showFifth, this.vs.style.display = this.l.prefs.showFifth ? "" : "none") } } const { button: ao, div: ro, h2: lo, select: co, option: po } = z; class uo { constructor(t) { this.l = t, this.sr = co({ style: "width: 100%;" }, po({ value: "dark classic" }, "BeepBox Dark"), po({ value: "light classic" }, "BeepBox Light"), po({ value: "dark competition" }, "BeepBox Competition Dark"), po({ value: "jummbox classic" }, "JummBox Dark"), po({ value: "forest" }, "Forest"), po({ value: "canyon" }, "Canyon"), po({ value: "midnight" }, "Midnight"), po({ value: "beachcombing" }, "Beachcombing"), po({ value: "violet verdant" }, "Violet Verdant"), po({ value: "sunset" }, "Sunset"), po({ value: "autumn" }, "Autumn"), po({ value: "fruit" }, "Shadowfruit"), po({ value: "toxic" }, "Toxic"), po({ value: "roe" }, "Roe"), po({ value: "moonlight" }, "Moonlight"), po({ value: "portal" }, "Portal"), po({ value: "fusion" }, "Fusion"), po({ value: "inverse" }, "Inverse"), po({ value: "nebula" }, "Nebula"), po({ value: "roe light" }, "Roe Light"), po({ value: "energized" }, "Energized"), po({ value: "neapolitan" }, "Neapolitan"), po({ value: "mono" }, "Mono")), this.Ie = ao({ class: "cancelButton" }), this.Pe = ao({ class: "okayButton", style: "width:45%;" }, "Okay"), this.container = ro({ class: "prompt noSelection", style: "width: 220px;" }, lo("Set Theme"), ro({ style: "display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;" }, ro({ class: "selectContainer", style: "width: 100%;" }, this.sr)), ro({ style: "display: flex; flex-direction: row-reverse; justify-content: space-between;" }, this.Pe), this.Ie), this.lastTheme = window.localStorage.getItem("colorTheme"), this.Ae = () => { null != this.lastTheme ? j.setTheme(this.lastTheme) : j.setTheme("dark classic"), this.l.undo() }, this.cleanUp = () => { this.Pe.removeEventListener("click", this.Le), this.Ie.removeEventListener("click", this.Ae), this.container.removeEventListener("keydown", this.Ne) }, this.Ne = t => { "BUTTON" != t.target.tagName && 13 == t.keyCode && this.Le() }, this.Le = () => { window.localStorage.setItem("colorTheme", this.sr.value), this.l.prompt = null, this.l.prefs.colorTheme = this.sr.value, this.l.undo() }, this.nr = () => { j.setTheme(this.sr.value), this.l.notifier.changed() }, null != this.lastTheme && (this.sr.value = this.lastTheme), this.Pe.addEventListener("click", this.Le), this.Ie.addEventListener("click", this.Ae), this.container.addEventListener("keydown", this.Ne), this.sr.addEventListener("change", this.nr) } } const { button: mo, div: fo, p: yo, h2: bo, h3: go } = z; class wo { constructor(t, i) { let s; switch (this.l = t, this.hr = mo({ class: "cancelButton" }), this.Ae = () => { this.l.undo() }, this.cleanUp = () => { this.hr.removeEventListener("click", this.Ae) }, i) { case "scale": s = fo(bo("Scale"), yo("This setting limits the available pitches for adding notes. You may think that there's no point in limiting your choices, but the set of pitches you use has a strong influence on the mood and feel of your song, and these scales serve as guides to help you choose appropriate pitches. Don't worry, you can change the scale at any time, so you're not locked into it. Try making little melodies using all the available pitches of a scale to get a sense for how it sounds."), yo('The most common scales are major and minor. Assuming your song uses all pitches in the scale and especially "tonic" pitches (the purple rows in the pattern editor) then major scales tend to sound more playful or optimistic, whereas minor scales sound more serious or sad.')); break; case "key": s = fo(bo("Song Key"), yo('This setting can shift the frequency of every note in your entire song up or down, keeping the "tonic" pitches (the brown rows in the pattern editor) aligned with the selected "key" pitch.'), yo('If you\'ve already placed some notes but they don\'t emphasize "tonic" pitches then the selected key isn\'t very meaningful. You can select the "Detect Key" option in the key menu to automatically align the most emphasized notes with "tonic" pitches.')); break; case "tempo": s = fo(bo("Song Tempo"), yo('This setting controls the speed of your song, measured in beats-per-minute. A "beat" is the duration of the little gray rectangles in the pattern editor. (In conventional music notation, a "quarter note" is usually equivalent to "beat".)')); break; case "reverb": s = fo(bo("Reverb"), yo('Reverb is like a continuous echo effect. A little bit helps instruments sound more natural. Adding a lot of reverb can add sense of depth or mystery, but too much reverb can kinda "smear" sounds so that it\'s harder to distinguish notes or instruments, especially for lower "bass" notes.')); break; case "rhythm": s = fo(bo("Rhythm"), yo("This setting determines how beats are divided. The pattern editor helps you align notes to fractions of a beat based on this setting."), yo("If you've already placed some notes but they don't align with the selected rhythm, you can select the \"Snap Notes To Rhythm\" option in the rhythm menu to force the notes in the currently selected pattern(s) to align with the selected rhythm.")); break; case "instrumentIndex": s = fo(bo("Instrument Number"), yo('In the "Channel Settings" option from JummBox\'s "File" menu, there are a few ways to enable multiple instruments per channel.'), yo("First, you could enable multiple simultaneous instruments per channel. All of the channel's instruments will play all of the notes in the channel at the same time, and you can click an instrument number to view and edit its settings."), yo("Second, you could enable different instruments per pattern. Only one of the instruments will play at any given time, but you can click the instrument number to change which instrument is used for the currently selected pattern(s)."), yo("Finally, you can enable them both, in which case you can click an instrument number once to view it, and again to toggle whether the instrument is used for the currently selected pattern(s)."), yo("Either way, you can click the + button to add more instruments to a channel, and you can press shift and a number key on your keyboard to select an instrument as if you had clicked the corresponding button here.")); break; case "instrumentVolume": s = fo(bo("Instrument Volume"), yo("This setting controls the volume of the selected instrument without affecting the volume of the other instruments. This allows you to balance the loudness of each instrument relative to each other."), yo("Please be careful when using volume settings above 0. This indicates amplification and too much of that can trip the audio limiter built into this tool. This can lead to your song sounding muffled if overused. But when used carefully, amplification can be a powerful tool!")); break; case "pan": s = fo(bo("Instrument Panning"), yo("If you're listening through headphones or some other stereo sound system, this controls the position of the instrument and where the sound is coming from, ranging from left to right."), yo("As a suggestion, composers often put lead melodies, drums, and basses in the center, and spread other instruments toward either side. If too many instruments seem like they're coming from the same place, it can feel crowded and harder to distinguish individual sounds, especially if they cover a similar pitch range.")); break; case "panDelay": s = fo(bo("Stereo Delay"), yo("When panning, a slight delay is often added between the left and right ear to help make a sound feel more 'directional'. For example, in the real world your left ear will hear a sound coming from the left just slightly before the right ear."), yo("This setting controls how much delay is added. When this is set to minimum, panning only affects the volume of the left/right ear without changing the delay. This can help to get a more 'uniform' feeling sound, which can be desirable for making 8-bit music.")); break; case "arpeggioSpeed": s = fo(bo("Arpeggio Speed"), yo("This setting affects how fast your chord will 'arpeggiate', or cycle between notes. With a fast arpeggio speed it will sound rapid-fire, with a slow speed you can hear each note one after another.")); break; case "twoNoteArpeggio": s = fo(bo("Faster Two-Note Arpeggio"), yo("This setting makes arpeggios with only two notes in them happen twice as fast. Arpeggios with more notes in them are unaffected.")); break; case "detune": s = fo(bo("Detune"), yo("This setting can be used to finely control the pitch of your instrument. It is in units of 'cents', 100 of which equal a pitch shift of one semitone."), yo("Careful - you can quickly get very dissonant sounding songs by using this setting.")); break; case "instrumentType": s = fo(bo("Instrument Type"), yo("JummBox comes with many instrument presets, try them out! You can also create your own custom instruments!"), yo("There are also options for copying and pasting instrument settings and for generating random instruments at the top of the instrument type menu.")); break; case "eqFilter": s = fo(bo("EQ Filter"), yo("Filters are a way of emphasizing or diminishing different parts of a sound. Musical notes have a fundamental (base) frequency, but the sound of a musical note also has parts at higher frequencies and filters can adjust the volume of each of these parts based on their frequency."), yo("Click in the filter editor to insert, delete, or drag a filter control point. The horizontal position of the point determines which frequencies it affects, and the vertical position determines how the volume is affected at that frequency."), yo('Insert a new point on the left side of the filter editor to add a "high-pass" filter point, which additionally reduces the volume of lower frequencies, or insert a new point on the right side to add a "low-pass" filter point which reduces the volume of higher frequencies.'), yo('You can also enable a "Note Filter" as an effect. EQ and note filters are mostly the same, but have different purposes. EQ filters are for overall adjustments, whereas note filters are for dynamic control and can be moved with envelopes. Note filters also change how the distortion effect sounds.')); break; case "noteFilter": s = fo(bo("Note Filter"), yo("Note filters are mostly the same as EQ filters, but have a different purpose. EQ filters are for overall adjustments, whereas note filters are for dynamic control and can be moved with envelopes. Note filters also change how the distortion effect sounds."), yo("Filters are a way of emphasizing or diminishing different parts of a sound. Musical notes have a fundamental (base) frequency, but the sound of a musical note also has parts at higher frequencies and filters can adjust the volume of each of these parts based on their frequency."), yo("Click in the filter editor to insert, delete, or drag a filter control point. The horizontal position of the point determines which frequencies it affects, and the vertical position determines how the volume is affected at that frequency."), yo('Insert a new point on the left side of the filter editor to add a "high-pass" filter point, which additionally reduces the volume of lower frequencies, or insert a new point on the right side to add a "low-pass" filter point which reduces the volume of higher frequencies.')); break; case "fadeInOut": s = fo(bo("Fade In/Out"), yo("This setting controls how long it takes for notes to reach full volume at the beginning or decay to silence at the end."), yo("An instant fade-in sounds like instruments that are played by hitting or plucking, whereas slower fade-ins sound like instruments that are played by blowing air."), yo("You can also make the fade-out start before the note ends to leave a gap before the next note starts, or after the note ends to allow the sound of the end of the note to overlap with the start of the next note.")); break; case "transition": s = fo(bo("Transition"), yo("Usually, when one note ends at the same time another begins, the old note will fade out and the new note will fade in based on the fade in/out settings, but this setting can override that, connecting the end of one note to the beginning of the next."), yo('The "interrupt" transition makes the wave suddenly change from the old note\'s frequency to the new note\'s frequency without any fading, but still restarts envelopes at the beginning of the new note. The "continue" transition is similar but it doesn\'t even restart envelopes, and can be used to make each of the notes in a chord start or stop at different times!'), yo('The "slide" transition makes the pitch shift quickly but not instantaneously from the old note\'s frequency to the new note\'s frequency, and softly restarts envelopes. The "slide in pattern" transition is the same except it doesn\'t connect the last note in a pattern to the first note in the next pattern.')); break; case "chipWave": s = fo(bo("Chip Wave"), yo("JummBox comes with some sound waves based on classic electronic sound chips, as well as several unique waves. This is the basic source of the sound of the instrument, which is modified by the other instrument settings.")); break; case "chipNoise": s = fo(bo("Noise"), yo("JummBox comes with several basic noise sounds. These do not have any distinct musical pitch, and can be used like drums to create beats and emphasize your song's rhythm.")); break; case "pulseWidth": s = fo(bo("Pulse Wave Width"), yo("This setting controls the shape and sound of a pulse wave. At the minimum width, it sounds light and buzzy. At the maximum width, it is shaped like a classic square wave.")); break; case "unison": s = fo(bo("Unison"), yo("This instrument can play two identical waves at different frequencies. When two waves play at slightly different frequencies, they move in and out of phase with each other over time as different parts of the waves line up. This creates a dynamic, shifting sound. Pianos are a common example of this kind of sound, because each piano key strikes multiple strings that are tuned to slightly different frequencies."), yo('The distance between two frequencies is called an "interval", and this setting controls how large it is. If the interval is too wide, then the waves may sound out-of-tune and "dissonant". However, if the interval is even larger, then the two frequencies can even be distinct pitches.')); break; case "chords": s = fo(bo("Chords"), yo("When multiple different notes occur at the same time, this is called a chord. Chords can be created in JummBox's pattern editor by adding notes above or below another note."), yo('This setting determines how chords are played. The standard option is "simultaneous" which starts playing all of the pitches in a chord at the same instant. The "strum" option is similar, but plays the notes starting at slightly different times. The "arpeggio" option is used in "chiptune" style music and plays a single tone that rapidly alternates between all of the pitches in the chord.'), yo('Some JummBox instruments have an option called "custom interval" which uses the chord notes to control the interval between the waves of a single tone. This can create strange sound effects when combined with FM modulators.')); break; case "vibrato": s = fo(bo("Vibrato"), yo("This setting causes the frequency of a note to wobble slightly. Singers and violinists often use vibrato.")); break; case "vibratoDepth": s = fo(bo("Vibrato Depth"), yo("This setting affects the depth of your instrument's vibrato, making the wobbling effect sound stronger or weaker.")); break; case "vibratoDelay": s = fo(bo("Vibrato Delay"), yo("This setting changes when vibrato starts to kick in after a note is played. Vibrato is most common for long held notes and less common in short notes, so this can help you achieve that effect.")); break; case "vibratoSpeed": s = fo(bo("Vibrato Speed"), yo("This setting determines how fast the vibrato's up-and-down wobble effect will happen for your instrument.")); break; case "vibratoType": s = fo(bo("Vibrato Type"), yo("This determines the way vibrato causes your instrument's pitch to wobble. The normal type is smooth up and down, the shaky type is chaotic.")); break; case "algorithm": s = fo(bo("FM Algorithm"), yo("FM Synthesis is a mysterious but powerful technique for crafting sounds, popularized by Yamaha keyboards and the Sega Genesis/Mega Drive. It may seem confusing, but try playing around with the options until you get a feel for it, or check out some of the preset examples!"), yo("This FM synthesizer uses up to four waves, numbered 1, 2, 3, and 4. Each wave may have its own frequency and volume."), yo('There are two kinds of waves: "carrier" waves play a tone out loud, but "modulator" waves distort other waves instead. Wave 1 is always a carrier and plays a tone, but other waves may distort it. The "Algorithm" setting determines which waves are modulators, and which other waves those modulators distort. For example, "12" means that wave 2 modulates wave 1, and wave 1 plays out loud.')); break; case "feedbackType": s = fo(bo("Feedback Type"), yo("Modulators distort in one direction (like 12), but you can also use the feedback setting to make any wave distort in the opposite direction (12), or even itself (1).")); break; case "feedbackVolume": s = fo(bo("Feedback Distortion"), yo("This setting controls the amount of feedback distortion based on the feedback type setting.")); break; case "operatorFrequency": s = fo(bo("Operator Frequency"), yo('This setting controls the frequency of an individual FM wave, relative to the fundamental frequency of the note. The multiplier 1 is the same as the fundamental frequency, whereas 2x would be an octave (12 semitones) above it. The frequencies with a "~" are slightly detuned and shift in and out of phase over time compared to the other frequencies.'), yo('Try different combinations of a "carrier" wave and a "modulator" wave with different frequencies to get a feel for how they sound together.')); break; case "operatorVolume": s = fo(bo("Operator Volume"), yo('This setting controls the volume of "carrier" waves, or the amount of distortion that "modulator" waves apply to other waves.')); break; case "spectrum": s = fo(bo("Spectrum"), yo("This setting allows you to draw your own noise spectrum! This is good for making drum sounds."), yo("If you only use certain frequencies and a soft fade in/out, it's also possible to make howling wind sounds or even musical wind instruments."), yo("The left side of the spectrum editor controls the noise energy at lower frequencies, and the right side controls higher frequencies.")); break; case "harmonics": s = fo(bo("Harmonics"), yo("This setting allows you to design your own sound wave! Most musical waves are actually a combination of sine waves at certain frequencies, and this lets you control the volume of each sine wave individually."), yo("The left side of the harmonics editor controls the sine wave volumes at lower frequencies, and the right side controls higher frequencies.")); break; case "effects": s = fo(bo("Effects"), yo("JummBox has many different kinds of special effects you can add to instruments. You can turn on multiple effects at once, and they can be configured individually. Try them all out!")); break; case "drumsetEnvelope": s = fo(bo("Drumset Envelope"), yo("This drumset comes with a low-pass filter, and this setting can dynamically change the low-pass filter frequency over time. Each row in the pattern editor can have a different envelope shape.")); break; case "drumsetSpectrum": s = fo(bo("Drumset Spectrum"), yo("This setting allows you to draw your own noise spectrum! This is good for making drumsets. Each row in the pattern editor gets its own spectrum."), yo("The left side of the spectrum editor controls the noise energy at lower frequencies, and the right side controls higher frequencies.")); break; case "chorus": s = fo(bo("Chorus"), yo("The chorus effect combines multiple copies of the instrument's sound and adds a bit of vibrato to simulate an ensemble of instruments or voices. Drag the slider to control how much chorus is added.")); break; case "echoSustain": s = fo(bo("Echo Volume"), yo("The echo effect repeats the instrument's sound after a delay. Each echo is a little bit quieter than the last, and this setting controls how much quieter.")); break; case "echoDelay": s = fo(bo("Echo Delay"), yo("The echo effect repeats the instrument's sound after a delay, and this setting controls how long the delay is.")); break; case "pitchShift": s = fo(bo("Pitch Shift"), yo("This setting makes instruments play higher or lower pitches than the ones displayed in the pattern editor. Be careful that you don't confuse yourself!"), yo("You can combine this with envelopes to bend pitch over time, or play multiple simultaneous instruments with different pitch shifts for interesting layered sounds."), yo('The intervals created by this setting are in "just intonation" which means they stay in phase with the original pitch instead of shifting in and out of phase over time. If you want the shifting, add the detune effect!')); break; case "detune": s = fo(bo("Detune"), yo('This setting slightly adjusts the frequency of notes played by the instrument. You can use a little bit to add a pleasing shifting sound similar to the "unison" feature when combined with other instruments. If you use too much, then the instrument may sound unpleasantly out-of-tune.')); break; case "distortion": s = fo(bo("Distortion"), yo("This is the famous electric guitar effect! However, there are some things to be aware of."), yo('First, most chords don\'t sound right when combined with heavy distortion. The only chords commonly used with distorted electric guitars are "power chords" which consist of a root note, a "fifth" note above that, and/or any octaves of those two notes.'), yo("Second, the distortion sound depends a lot on filtering. In particular, I recommend enabling the note filter effect, and adding both high-pass and low-pass points to the note filter. (Note filters are applied first, then distortion which transforms the sound based on that filtering, then the EQ filter is applied last.)"), yo("Finally, I recommend adjusting the fade-out setting to allow the end of each note to overlap a little bit with the beginning of the next, but not too much!")); break; case "bitcrusherQuantization": s = fo(bo("Bitcrusher Quantization"), yo("This effect makes stuff sounds harsher, artificial, and \"low quality\", which is great if that's what you're going for!")); break; case "bitcrusherFreq": s = fo(bo("Frequency Quantization"), yo("The bitcrusher effect comes with an additional frequency quantization effect! This is a fun one to play with, especially when combined with the note filter effect."), yo("Every other notch on this slider is aligned with the currently selected key of the song, and the in-between notches are aligned with the tritones of the key.")); break; case "stringSustain": s = fo(bo("String sustain"), yo("This setting controls how quickly the picked string vibration decays."), yo('Unlike most of BeepBox\'s instrument synthesizer features, a picked string cannot change frequency suddenly while maintaining its decay. If a tone\'s pitch changes suddenly (e.g. if the chord type is set to "arpeggio" or the transition type is set to "continues") then the string will be re-picked and start decaying from the beginning again, even if the envelopes don\'t otherwise restart.')); break; case "envelopes": s = fo(bo("Envelopes"), yo("Envelopes are a way to dynamically adjust various other settings over time, usually based on how long the note lasts. Press the + button to add an envelope, then use the menus below to select which setting to control and the curve of the envelope. Try different combinations to see how they sound!"), yo('Most envelope curves restart from the beginning every time a new note plays. The "note size" option is based on the note width as drawn in the pattern editor.'), yo("Envelope curves move in the range from 0 to 1 (or vice versa), where 0 means as quiet as possible and 1 is the same as the corresponding position selected in the instrument settings above. If multiple envelopes are targetting the same setting, they are multiplied before applying to the setting.")); break; case "usedInstrument": s = fo(go("'Is this instrument used somewhere else?'"), yo("This indicator will light up when the instrument you're currently looking at is used in another place in your song (outside the selection)."), yo("This can be useful when you're not sure if you've used the instrument before and making edits carelessly could change other parts of the song.")); break; case "usedPattern": s = fo(go("'Is this pattern used somewhere else?'"), yo("This indicator will light up when the pattern you're currently looking at is used in another place in your song (outside the selection)."), yo("This can be useful when you're not sure if you've used the pattern before and making edits carelessly could change other parts of the song.")); break; case "modChannel": s = fo(bo("Modulator Channel"), yo("Modulators can be used to change settings in your song automatically over time. This technique is also known as automation."), yo("This setting controls which channel the modulators will take effect for. If you choose 'Song', you can change song-wide settings too!")); break; case "modInstrument": s = fo(bo("Modulator Instrument"), yo("Modulators can be used to change settings in your song automatically over time. This technique is also known as automation."), yo("This setting controls which instrument your modulator will apply to within the given channel you've chosen."), yo("If you choose 'all', every instrument in the channel will be affected. If you choose 'active', just the current ones used in this pattern will be instead."), yo("Note that with 'all' or 'active', effects will only be applied to instruments that the effect is applicable on. For example if an instrument does not have panning effects, modulating panning will not affect it.")); break; case "modSet": s = fo(bo("Modulator Setting"), yo("This is the parameter that you want to change with this modulator. For example, if you set this to 'Tempo', you can speed up or slow down your song by laying notes in the pattern editor."), yo("Note that you'll see different options if your channel is set to 'Song' versus a channel number. With 'Song', you'll see song-wide settings such as tempo. With a channel, you'll see specific instrument settings. Adding more effects to the instrument causes modulators for them to be available, so be sure to experiment!"), yo("Most modulators behave as you'd expect and work just as if you were moving their associated slider. Click the '?' when you have a setting selected to get more info about it!")); break; case "modFilter": s = fo(bo("Filter Target"), yo("This setting specifies which parameter of your targeted filter you would like to change."), yo("With the 'morph' setting, the note value for your modulator represents the number of a subfilter to 'morph' into over time. For example, dragging a note from 0 to 7 will morph from your main filter to the 7th subfilter. To change how your subfilters are set up, click the '+' button on the target filter."), yo("With a Dot setting, you can fine-tune the exact location of every dot on your filter graph. Note that this is extremely intensive if you want to modulate all dots - a morph is better in that case - but this can come in handy for small adjustments.")); break; case "transitionBar": s = fo(bo("Tie Notes Over Bars"), yo("With this option ticked, notes won't transition across bars if you put notes with the same pitches at the start of the next bar. Instead they will 'tie over' and sound like one long note.")); break; case "clicklessTransition": s = fo(bo("Clickless Transition"), yo("Sometimes, seamless and other transition types can make audible 'clicks' when changing between notes. Ticking this option will cause those clicks to be silenced as much as possible.")); break; case "aliases": s = fo(bo("Aliasing"), yo("JummBox applies a technique called 'anti-aliasing' to instruments normally to help them sound cleaner even at high frequencies and low sample rates."), yo("When this setting is ticked that technique is disabled, so you may hear strange audio artifacts especially at high pitches and when bending notes. However, this can lend a grungy sound to an instrument that could be desirable.")); break; case "operatorWaveform": s = fo(bo("Operator Waveform"), yo("This setting controls the what kind of sound wave an individual FM wave uses. By defualt the FM synth only uses sinewaves."), yo("This feature was ported from Aury system`s GoldBox!")); break; case "filterType": s = fo(bo("Filter Type"), yo("Toggling these buttons lets you choose between a simple filter interface with two sliders, or the more advanced filter graph."), yo("The two-slider version controls a single low-pass filter and was used in legacy versions. It is not as powerful, but if you feel overwhelmed you can start with this."), yo("Note that switching from the simple interface to the advanced interface will convert your current settings, so you can also use it as a basis for later tweaking.")); break; case "filterCutoff": s = fo(bo("Low-Pass Filter Cutoff Frequency"), yo('The lowest setting feels "muffled" or "dark", and the highest setting feels "harsh" or "bright".'), yo("Most sounds include a range of frequencies from low to high. JummBox instruments have a filter that allows the lowest frequencies to pass through at full volume, but can reduce the volume of the higher frequencies that are above a cutoff frequency. This setting controls the cutoff frequency and thus the range of higher frequencies that are reduced."), yo("This cutoff setting also determines which frequency resonates when the resonance peak setting is used.")); break; case "filterResonance": s = fo(bo("Low-Pass Filter Resonance Peak"), yo("Increasing this setting emphasizes a narrow range of frequencies, based on the position of the filter cutoff setting. This can be used to imitate the resonant bodies of acoustic instruments and other interesting effects."), yo("The filter preserves the volume of frequencies that are below the cutoff frequency, and reduces the volume of frequencies that are above the cutoff. If this setting is used, the filter also increases the volume of frequencies that are near the cutoff.")); break; default: if (i.indexOf("modSetInfo") >= 0) { let n = +i[i.length - 1], o = t.song.channels[t.channel].instruments[t.getCurrentInstrument()].modulators[n], h = []; for (let t = 0; t < e.modulators[o].promptDesc.length; t++)h.push(yo(e.modulators[o].promptDesc[t].replace("$LO", "" + e.modulators[o].convertRealFactor).replace("$MID", "" + (e.modulators[o].convertRealFactor + e.modulators[o].maxRawVol / 2)).replace("$HI", "" + (e.modulators[o].convertRealFactor + e.modulators[o].maxRawVol)))); h[h.length - 1].style.setProperty("color", "var(--secondary-text)"), s = fo(bo(e.modulators[o].promptName), h); break } throw new Error("Unhandled TipPrompt type: " + i) }this.container = fo({ class: "prompt", style: "width: 300px;" }, s, this.hr), setTimeout((() => this.hr.focus())), this.hr.addEventListener("click", this.Ae) } } class vo { constructor(t, e, i, s) { this.ar = e, this.rr = i, this.lr = document.createTextNode("1"), this.ai = B.text({ "font-family": "sans-serif", "font-size": 20, "text-anchor": "middle", "font-weight": "bold", fill: "red" }, this.lr), this.cr = B.rect({ x: 1, y: 1 }), this.container = B.svg(this.cr, this.ai), this.dr = 1, this.pr = !0, this.ur = !1, this.mr = "", this.cr.setAttribute("fill", j.uiWidgetBackground), this.ai.setAttribute("fill", s) } setSize(t, i) { this.container.setAttribute("x", "" + this.ar * t), this.container.setAttribute("y", "" + (e.barEditorHeight + this.rr * i)), this.cr.setAttribute("width", "" + (t - 2)), this.cr.setAttribute("height", "" + (i - 2)), this.ai.setAttribute("x", "" + t / 2), this.ai.setAttribute("y", "" + Math.round(i / 2 + 7)) } setIndex(t, e, i, s, n, o) { this.dr != t && (this.ur || 0 == t == (0 == this.dr) || (0 == t ? this.cr.setAttribute("fill", "none") : n ? this.cr.setAttribute("fill", e ? j.trackEditorBgNoiseDim : j.trackEditorBgNoise) : o ? this.cr.setAttribute("fill", e ? j.trackEditorBgModDim : j.trackEditorBgMod) : this.cr.setAttribute("fill", e ? j.trackEditorBgPitchDim : j.trackEditorBgPitch)), t >= 100 ? (this.ai.setAttribute("font-size", "16"), this.ai.setAttribute("style", "transform: translate(0px, -1.5px);")) : (this.ai.setAttribute("font-size", "20"), this.ai.setAttribute("style", "transform: translate(0px, 0px);")), this.dr = t, this.lr.data = "" + t), this.pr == e && this.mr == s || (this.pr = e, i ? this.ai.setAttribute("fill", j.invertedText) : (this.ai.setAttribute("fill", s), 0 == this.dr ? this.cr.setAttribute("fill", j.editorBackground) : n ? this.cr.setAttribute("fill", e ? j.trackEditorBgNoiseDim : j.trackEditorBgNoise) : o ? this.cr.setAttribute("fill", e ? j.trackEditorBgModDim : j.trackEditorBgMod) : this.cr.setAttribute("fill", e ? j.trackEditorBgPitchDim : j.trackEditorBgPitch))), this.ur == i && this.mr == s || (this.ur = i, i ? (this.cr.setAttribute("fill", s), this.ai.setAttribute("fill", j.invertedText)) : (this.ai.setAttribute("fill", s), 0 == this.dr ? this.cr.setAttribute("fill", j.editorBackground) : n ? this.cr.setAttribute("fill", e ? j.trackEditorBgNoiseDim : j.trackEditorBgNoise) : o ? this.cr.setAttribute("fill", e ? j.trackEditorBgModDim : j.trackEditorBgMod) : this.cr.setAttribute("fill", e ? j.trackEditorBgPitchDim : j.trackEditorBgPitch))), this.mr = s } } class ko { constructor(t, i) { this.l = t, this.Ze = i, this.yr = z.select({ style: "width: 32px; height: " + e.barEditorHeight + "px; top: 0px; position: absolute; opacity: 0" }, z.option({ value: "barBefore" }, "Insert Bar Before"), z.option({ value: "barAfter" }, "Insert Bar After"), z.option({ value: "deleteBar" }, "Delete This Bar")), this.gr = B.g(), this.wr = B.g(), this.k = B.rect({ fill: j.playhead, x: 0, y: 0, width: 4, height: 128 }), this.vr = B.rect({ fill: "none", stroke: j.hoverPreview, "stroke-width": 2, "pointer-events": "none", x: 1, y: 1, width: 30, height: 30 }), this.No = B.path({ fill: j.invertedText, stroke: j.invertedText, "stroke-width": 1, "pointer-events": "none" }), this.zo = B.path({ fill: j.invertedText, stroke: j.invertedText, "stroke-width": 1, "pointer-events": "none" }), this.kr = B.path({ fill: j.uiWidgetBackground, stroke: j.uiWidgetBackground, "stroke-width": 1, "pointer-events": "none" }), this.oh = B.rect({ class: "dashed-line dash-move", fill: j.boxSelectionFill, stroke: j.hoverPreview, "stroke-width": 2, "stroke-dasharray": "5, 3", "fill-opacity": "0.4", "pointer-events": "none", visibility: "hidden", x: 1, y: 1, width: 62, height: 62 }), this.q = B.svg({ style: `background-color: ${j.editorBackground}; position: absolute;`, height: 128 }, this.gr, this.kr, this.oh, this.wr, this.vr, this.No, this.zo, this.k), this.Mr = z.select({ class: "trackSelectBox", style: "background: none; border: none; appearance: none; border-radius: initial; box-shadow: none; color: transparent; position: absolute; touch-action: none;" }), this.container = z.div({ class: "noSelection", style: "height: 128px; position: relative; overflow:hidden;" }, this.q, this.Mr, this.yr), this.Sr = [], this.Fr = [], this.N = 0, this.Ge = 0, this.Cr = 0, this.Er = 0, this.Tr = 0, this.Ir = 0, this.O = !1, this.Pr = !1, this.di = !1, this._n = 32, this.Ar = 32, this.uo = 0, this.Xn = 0, this.Lr = 0, this.L = -1, this.Zn = -1, this.bo = -1, this.ci = M, this.qr = 0, this.Dr = 0, this.Nr = t => { this.qr = Math.floor(Math.min(this.l.song.barCount - 1, Math.max(0, this.N / this._n))) }, this.zr = t => { var e = "barBefore" == this.yr.value ? 0 : 1; "barBefore" == this.yr.value || "barAfter" == this.yr.value ? (this.l.bar = this.qr - 1 + e, this.l.selection.resetBoxSelection(), this.l.selection.insertBars(), this.l.synth.playhead >= this.qr + e && (this.l.synth.playhead++, this.Ze.Br.animatePlayhead())) : "deleteBar" == this.yr.value && (this.l.bar = this.qr, this.l.selection.resetBoxSelection(), this.l.selection.deleteBars(), this.l.synth.playhead > this.qr && (this.l.synth.playhead--, this.Ze.Br.animatePlayhead())), this.yr.selectedIndex = -1 }, this.Rr = () => { this.l.selection.setPattern(this.Mr.selectedIndex) }, this.ia = t => { const e = this._n * this.l.synth.playhead - 2; this.L != e && (this.L = e, this.k.setAttribute("x", "" + e)), window.requestAnimationFrame(this.ia) }, this.Or = t => { this.Pr = !0, this.di = !0, this.$r(t), this.Cr = this.Tr, this.Er = this.Ir }, this.Hr = t => { this.$r(t), this.Cr == this.Tr && this.Er == this.Ir || t.preventDefault(), this.Pr && this.Vr(), this.W() }, this.Gr = t => { this.Pr = !1, this.di = !1, this.W() }, this.U = t => { this.O || (this.O = !0) }, this.K = t => { this.O && (this.O = !1) }, this.J = t => { t.preventDefault(), this.Pr = !0, this._r(t), this.Cr = this.Tr, this.Er = this.Ir, this.Ge >= e.barEditorHeight && (t.shiftKey ? (this.di = !0, this.l.selection.setTrackSelection(this.l.selection.boxSelectionX0, this.Tr, this.l.selection.boxSelectionY0, this.Ir), this.l.selection.selectionUpdated()) : (this.di = !1, this.l.channel == this.Ir && this.l.bar == this.Tr || (this.l.selection.setChannelBar(this.Ir, this.Tr), this.di = !0), this.l.selection.resetBoxSelection())) }, this.Z = t => { this._r(t), this.Pr && (this.Cr == this.Tr && this.Er == this.Ir || (this.di = !0), this.Vr()), this.W() }, this.za = t => { if (this.Pr && !this.di && this.l.channel == this.Ir && this.l.bar == this.Tr) { const t = (this.Ge - e.barEditorHeight) % this.Ar < this.Ar / 2, i = this.l.song.patternsPerChannel; this.l.selection.setPattern((this.l.song.channels[this.Ir].bars[this.Tr] + (t ? 1 : i)) % (i + 1)) } this.Pr = !1, this.di = !1, this.W() }, window.requestAnimationFrame(this.ia), this.q.addEventListener("mousedown", this.J), document.addEventListener("mousemove", this.Z), document.addEventListener("mouseup", this.za), this.q.addEventListener("mouseover", this.U), this.q.addEventListener("mouseout", this.K), this.Mr.addEventListener("change", this.Rr), this.Mr.addEventListener("touchstart", this.Or), this.Mr.addEventListener("touchmove", this.Hr), this.Mr.addEventListener("touchend", this.Gr), this.Mr.addEventListener("touchcancel", this.Gr); let s = !1; document.addEventListener("mousedown", (() => { s || (this.ci = !1, this.W()), s = !0 }), !0), document.addEventListener("touchstart", (() => { s || (this.ci = !0, this.W()), s = !0 }), !0), this.yr.selectedIndex = -1, this.yr.addEventListener("change", this.zr), this.yr.addEventListener("mousedown", this.Nr) } movePlayheadToMouse() { return !!this.O && (this.l.synth.playhead = this.Tr + this.N % this._n / this._n, !0) } Vr() { this.l.selection.setTrackSelection(this.l.selection.boxSelectionX0, this.Tr, this.l.selection.boxSelectionY0, this.Ir), this.l.selection.selectionUpdated() } $r(t) { const i = this.q.getBoundingClientRect(); this.N = t.touches[0].clientX - i.left, this.Ge = t.touches[0].clientY - i.top, isNaN(this.N) && (this.N = 0), isNaN(this.Ge) && (this.Ge = 0), this.Tr = Math.floor(Math.min(this.l.song.barCount - 1, Math.max(0, this.N / this._n))), this.Ir = Math.floor(Math.min(this.l.song.getChannelCount() - 1, Math.max(0, (this.Ge - e.barEditorHeight) / this.Ar))) } _r(t) { const i = this.q.getBoundingClientRect(); this.N = (t.clientX || t.pageX) - i.left, this.Ge = (t.clientY || t.pageY) - i.top, this.Tr = Math.floor(Math.min(this.l.song.barCount - 1, Math.max(0, this.N / this._n))), this.Ir = Math.floor(Math.min(this.l.song.getChannelCount() - 1, Math.max(0, (this.Ge - e.barEditorHeight) / this.Ar))) } W() { let t = this.Ir, i = this.Tr; this.ci && (i = this.l.bar, t = this.l.channel); const s = i == this.l.bar && t == this.l.channel, n = this.Ge >= e.barEditorHeight; if (this.di && this.Cr != this.Tr) { var o = Date.now(); o - this.Dr >= 50 && (i > this.l.barScrollPos + this.l.trackVisibleBars - 1 && this.l.barScrollPos < this.l.song.barCount - this.l.trackVisibleBars && this.Ze.changeBarScrollPos(1), i < this.l.barScrollPos && this.l.barScrollPos > 0 && this.Ze.changeBarScrollPos(-1), this.Dr = o) } if (this.O && !this.Pr && !s && n ? (this.vr.setAttribute("x", "" + (1 + this._n * i)), this.vr.setAttribute("y", "" + (1 + e.barEditorHeight + this.Ar * t)), this.vr.setAttribute("height", "" + (this.Ar - 2)), this.vr.setAttribute("width", "" + (this._n - 2)), this.vr.style.visibility = "visible") : (this.O || this.N >= i * this._n && this.N < i * this._n + this._n && this.Ge > 0) && !n ? (this.vr.setAttribute("x", "" + (1 + this._n * i)), this.vr.setAttribute("y", "1"), this.vr.setAttribute("height", "" + (e.barEditorHeight - 3)), this.vr.style.visibility = "visible") : this.vr.style.visibility = "hidden", (this.O || this.ci) && s && n) { const s = (this.Ge - e.barEditorHeight) % this.Ar < this.Ar / 2, n = this._n * (i + .8), o = e.barEditorHeight + this.Ar * (t + .5), h = .1 * this.Ar, a = .4 * this.Ar, r = .175 * this.Ar; this.No.setAttribute("fill", s && !this.ci ? j.hoverPreview : j.invertedText), this.zo.setAttribute("fill", s || this.ci ? j.invertedText : j.hoverPreview), this.No.setAttribute("d", `M ${n} ${o - a} L ${n + r} ${o - h} L ${n - r} ${o - h} z`), this.zo.setAttribute("d", `M ${n} ${o + a} L ${n + r} ${o + h} L ${n - r} ${o + h} z`), this.No.style.visibility = "visible", this.zo.style.visibility = "visible" } else this.No.style.visibility = "hidden", this.zo.style.visibility = "hidden"; this.oh.style.left = this._n * this.l.bar + "px", this.oh.style.top = e.barEditorHeight + this.Ar * this.l.channel + "px", this.Mr.style.left = this._n * this.l.bar + "px", this.Mr.style.width = this._n + "px", this.Mr.style.top = e.barEditorHeight + this.Ar * this.l.channel + "px", this.Mr.style.height = this.Ar + "px", this.yr.style.left = this._n * i + "px"; const h = this.l.song.patternsPerChannel + 1; for (let t = this.Lr; t < h; t++)this.Mr.appendChild(z.option({ value: t }, t)); for (let t = h; t < this.Lr; t++)this.Mr.removeChild(this.Mr.lastChild); this.Lr = h; const a = this.l.song.channels[this.l.channel].bars[this.l.bar]; this.Mr.selectedIndex != a && (this.Mr.selectedIndex = a) } render() { if (this._n = this.l.getBarWidth(), this.Ar = this.l.getChannelHeight(), this.uo != this.l.song.getChannelCount()) { for (let t = this.uo; t < this.l.song.getChannelCount(); t++) { this.Sr[t] = []; for (let e = 0; e < this.Xn; e++) { const i = new vo(t, e, t, j.getChannelColor(this.l.song, t).secondaryChannel); i.setSize(this._n, this.Ar), this.gr.appendChild(i.container), this.Sr[t][e] = i } } for (let t = this.l.song.getChannelCount(); t < this.uo; t++)for (let e = 0; e < this.Xn; e++)this.gr.removeChild(this.Sr[t][e].container); this.Sr.length = this.l.song.getChannelCount(), this.Pr = !1 } if (this.Xn != this.l.song.barCount || this.Zn != this._n) { for (let t = 0; t < this.l.song.getChannelCount(); t++) { for (let e = this.Xn; e < this.l.song.barCount; e++) { const i = new vo(t, e, t, j.getChannelColor(this.l.song, t).secondaryChannel); i.setSize(this._n, this.Ar), this.gr.appendChild(i.container), this.Sr[t][e] = i } for (let e = this.l.song.barCount; e < this.Xn; e++)this.gr.removeChild(this.Sr[t][e].container); this.Sr[t].length = this.l.song.barCount } var t = ""; for (let s = 0; s < this.l.song.barCount; s++) { var i = s * this._n + 2; t += `M ${i} 1 H ${s * this._n + this._n - 2} V ${e.barEditorHeight - 3} H ${i} V 1 Z ` } if (this.kr.setAttribute("d", t), this.Xn < this.l.song.barCount) { this.Fr.length = this.l.song.barCount; for (var s = this.Xn; s < this.Fr.length; s++)this.Fr[s] = B.text({ "font-family": "sans-serif", "font-size": "8px", "text-anchor": "middle", "font-weight": "bold", x: s * this._n + this._n / 2 + "px", y: "7px", fill: j.secondaryText }, "" + (s + 1)), s % 4 == 0 && this.Fr[s].setAttribute("fill", j.primaryText), this.wr.appendChild(this.Fr[s]) } else if (this.Xn > this.l.song.barCount) { for (s = this.Xn - 1; s >= this.l.song.barCount; s--)this.wr.removeChild(this.Fr[s]); this.Fr.length = this.l.song.barCount } if (this.Zn != this._n) for (s = 0; s < this.Fr.length; s++)this.Fr[s].setAttribute("x", s * this._n + this._n / 2 + "px"); this.Xn = this.l.song.barCount; const n = this._n * this.l.song.barCount; this.container.style.width = n + "px", this.q.setAttribute("width", n + ""), this.Pr = !1 } if (this.bo != this.Ar || this.Zn != this._n) { this.Zn = this._n; for (let t = 0; t < this.l.song.getChannelCount(); t++)for (let e = 0; e < this.Xn; e++)this.Sr[t][e].setSize(this._n, this.Ar); this.Pr = !1 } if (this.bo != this.Ar || this.uo != this.l.song.getChannelCount()) { this.bo = this.Ar, this.uo = this.l.song.getChannelCount(); const t = e.barEditorHeight + this.l.song.getChannelCount() * this.Ar; this.q.setAttribute("height", "" + t), this.k.setAttribute("height", "" + t), this.container.style.height = t + "px" } for (let t = 0; t < this.l.song.getChannelCount(); t++)for (let e = 0; e < this.Xn; e++) { const i = this.l.song.getPattern(t, e), s = e == this.l.bar && t == this.l.channel, n = null == i || 0 == i.notes.length, o = this.Sr[t][e]; if (e < this.l.song.barCount) { const i = j.getChannelColor(this.l.song, t); o.setIndex(this.l.song.channels[t].bars[e], n, s, n && !s ? i.secondaryChannel : i.primaryChannel, t >= this.l.song.pitchChannelCount && t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount, t >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount), o.container.style.visibility = "visible" } else o.container.style.visibility = "hidden" } this.Mr.style.display = this.ci ? "" : "none", this.l.selection.boxSelectionActive ? (this.oh.setAttribute("x", String(this._n * this.l.selection.boxSelectionBar + 1)), this.oh.setAttribute("y", String(e.barEditorHeight + this.Ar * this.l.selection.boxSelectionChannel + 1)), this.oh.setAttribute("width", String(this._n * this.l.selection.boxSelectionWidth - 2)), this.oh.setAttribute("height", String(this.Ar * this.l.selection.boxSelectionHeight - 2)), this.oh.setAttribute("visibility", "visible")) : this.oh.setAttribute("visibility", "hidden"), this.W() } } const { button: xo, div: Mo, input: So, select: Fo, span: Co, optgroup: Eo, option: To, canvas: Io } = z; function Po(t, e) { for (let i = 0; i < e.length; i++)t.appendChild(To({ value: i }, e[i])); return t } function Ao(t, e) { const i = Fo({ id: e }); t ? (i.appendChild(To({ value: 2 }, F.valueToPreset(2).name)), i.appendChild(To({ value: 3 }, F.valueToPreset(3).name)), i.appendChild(To({ value: 4 }, F.valueToPreset(4).name))) : (i.appendChild(To({ value: 0 }, F.valueToPreset(0).name)), i.appendChild(To({ value: 6 }, F.valueToPreset(6).name)), i.appendChild(To({ value: 5 }, F.valueToPreset(5).name)), i.appendChild(To({ value: 7 }, F.valueToPreset(7).name)), i.appendChild(To({ value: 3 }, F.valueToPreset(3).name)), i.appendChild(To({ value: 1 }, F.valueToPreset(1).name)), i.appendChild(To({ value: 8 }, F.valueToPreset(8).name))); const s = Eo({ label: "Randomize " }); s.appendChild(To({ value: "randomPreset" }, "Random Preset")), s.appendChild(To({ value: "randomGenerated" }, "Random Generated")), i.appendChild(s); for (let e = 1; e < F.presetCategories.length; e++) { const s = F.presetCategories[e], n = Eo({ label: s.name + " " }); let o = !1; for (let i = 0; i < s.presets.length; i++) { const h = s.presets[i]; 1 == h.isNoise == t && (n.appendChild(To({ value: (e << 6) + i }, h.name)), o = !0) } if ("String Presets" == s.name && o) { let t = n.removeChild(n.children[11]); n.insertBefore(t, n.children[1]) } if ("Flute Presets" == s.name && o) { let t = n.removeChild(n.children[11]); n.insertBefore(t, n.children[1]) } if ("Keyboard Presets" == s.name && o) { let t = n.removeChild(n.children[9]); n.insertBefore(t, n.children[1]) } o && i.appendChild(n) } return i } function Lo(t, e) { const i = e.toString(); t.value != i && (t.value = i), $(t).data("select2") && $(t).val(e).trigger("change.select2") } class qo { constructor(t, e, i) { this.canvas = t, this.l = e, this.Ps = i, this.Cs = null, this.Io = t => { if (this.mouseDown) { var e = (t.clientX || t.pageX) - this.canvas.getBoundingClientRect().left, i = Math.floor((t.clientY || t.pageY) - this.canvas.getBoundingClientRect().top); i < 2 && (i = 2), i > 50 && (i = 50); var s = this.canvas.getContext("2d"); if (1 == this.continuousEdit && Math.abs(this.lastX - e) < 40) { var n = e < this.lastX ? e : this.lastX, o = e < this.lastX ? this.lastX : e; for (let t = n; t <= o; t += 2) { var h = Math.abs(e - this.lastX) > 2 ? e > this.lastX ? 1 - (t - n) / (o - n) : (t - n) / (o - n) : 0, a = Math.round(i + (this.lastY - i) * h); s.fillStyle = j.getComputed("--editor-background"), s.fillRect(2 * Math.floor(t / 2), 0, 2, 53), s.fillStyle = j.getComputed("--ui-widget-background"), s.fillRect(2 * Math.floor(t / 2), 25, 2, 2), s.fillStyle = j.getComputed("--track-editor-bg-pitch-dim"), s.fillRect(2 * Math.floor(t / 2), 13, 2, 1), s.fillRect(2 * Math.floor(t / 2), 39, 2, 1), s.fillStyle = j.getComputedChannelColor(this.l.song, this.l.channel).primaryNote, s.fillRect(2 * Math.floor(t / 2), a - 2, 2, 4), this.newArray[Math.floor(t / 2)] = a - 26 } } else s.fillStyle = j.getComputed("--editor-background"), s.fillRect(2 * Math.floor(e / 2), 0, 2, 52), s.fillStyle = j.getComputed("--ui-widget-background"), s.fillRect(2 * Math.floor(e / 2), 25, 2, 2), s.fillStyle = j.getComputed("--track-editor-bg-pitch-dim"), s.fillRect(2 * Math.floor(e / 2), 13, 2, 1), s.fillRect(2 * Math.floor(e / 2), 39, 2, 1), s.fillStyle = j.getComputedChannelColor(this.l.song, this.l.channel).primaryNote, s.fillRect(2 * Math.floor(e / 2), i - 2, 2, 4), this.newArray[Math.floor(e / 2)] = i - 26; this.continuousEdit = !0, this.lastX = e, this.lastY = i; let r = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], l = 0; for (let t = 0; t < this.newArray.length; t++)l += this.newArray[t]; const c = l / this.newArray.length; let d = 0, p = 0; for (let t = 0; t < this.newArray.length; t++)d += p, p = this.newArray[t] - c, r.customChipWaveIntegral[t] = d; r.customChipWaveIntegral[64] = 0 } }, this.jr = t => { this.mouseDown = !0, this.Io(t) }, this.Ur = () => { this.mouseDown = !1, this.continuousEdit = !1, this.Ds() }, this.Ds = () => { this.Cs = this.Ps(this.newArray), this.l.record(this.Cs), this.Cs = null }, t.addEventListener("mousemove", this.Io), t.addEventListener("mousedown", this.jr), t.addEventListener("mouseup", this.Ur), t.addEventListener("mouseleave", this.Ur), this.mouseDown = !1, this.continuousEdit = !1, this.lastX = 0, this.lastY = 0, this.newArray = new Float32Array(64), this.redrawCanvas() } redrawCanvas() { var t = this.canvas.getContext("2d"); t.fillStyle = j.getComputed("--editor-background"), t.fillRect(0, 0, 128, 52), t.fillStyle = j.getComputed("--ui-widget-background"), t.fillRect(0, 25, 128, 2), t.fillStyle = j.getComputed("--track-editor-bg-pitch-dim"), t.fillRect(0, 13, 128, 1), t.fillRect(0, 39, 128, 1), t.fillStyle = j.getComputedChannelColor(this.l.song, this.l.channel).primaryNote; for (let i = 0; i < 64; i++) { var e = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].customChipWave[i] + 26; t.fillRect(2 * i, e - 2, 2, 4), this.newArray[i] = e - 26 } } } class Do { constructor(t) { this.l = t, this.prompt = null, this.Ua = new xn(this.l), this.Wr = new Sn(this.l, !1, -1), this.Kr = new Sn(this.l, !0, 0), this.Jr = new Sn(this.l, !1, 1), this.Yr = new ko(this.l, this), this.Qr = new bn(this.l, this), this.Xr = new an(this.l), this.Ao = new Fn(this.l), this.Zr = new gn(this.l, this.Ao), this.ti = xo({ class: "playButton", type: "button", title: "Play (Space)" }, Co("Play")), this.tl = xo({ class: "pauseButton", style: "display: none;", type: "button", title: "Pause (Space)" }, "Pause"), this.el = xo({ class: "recordButton", style: "display: none;", type: "button", title: "Record (Ctrl+Space)" }, Co("Record")), this.il = xo({ class: "stopButton", style: "display: none;", type: "button", title: "Stop Recording (Space)" }, "Stop Recording"), this.sl = xo({ class: "prevBarButton", type: "button", title: "Previous Bar (left bracket)" }), this.nl = xo({ class: "nextBarButton", type: "button", title: "Next Bar (right bracket)" }), this.ol = new Bs(So({ title: "main volume", style: "width: 5em; flex-grow: 1; margin: 0;", type: "range", min: "0", max: "75", value: "50", step: "1" }), this.l, null, !1), this.hl = B.rect({ "pointer-events": "none", width: "90%", height: "50%", x: "5%", y: "25%", fill: j.uiWidgetBackground }), this.En = B.rect({ "pointer-events": "none", height: "50%", width: "0%", x: "5%", y: "25%", fill: "url('#volumeGrad2')" }), this.Tn = B.rect({ "pointer-events": "none", width: "2px", height: "50%", x: "5%", y: "25%", fill: j.uiWidgetFocus }), this.In = B.stop({ "stop-color": "lime", offset: "60%" }), this.Pn = B.stop({ "stop-color": "orange", offset: "90%" }), this.An = B.stop({ "stop-color": "red", offset: "100%" }), this.Ln = B.linearGradient({ id: "volumeGrad2", gradientUnits: "userSpaceOnUse" }, this.In, this.Pn, this.An), this.qn = B.defs({}, this.Ln), this.al = B.svg({ style: "touch-action: none; overflow: visible; margin: auto; max-width: 20vw;", width: "160px", height: "100%", preserveAspectRatio: "none", viewBox: "0 0 160 12" }, this.qn, this.hl, this.En, this.Tn), this.rl = Mo({ class: "playback-volume-bar", style: "height: 12px; align-self: center;" }, this.al), this.ll = Fo({ style: "width: 100%;" }, To({ selected: !0, disabled: !0, hidden: !1 }, "File"), To({ value: "new" }, "+ New Blank Song"), To({ value: "import" }, " Import Song... (" + F.ctrlSymbol + "O)"), To({ value: "export" }, " Export Song... (" + F.ctrlSymbol + "S)"), To({ value: "copyUrl" }, " Copy Song URL"), To({ value: "shareUrl" }, " Share Song URL"), To({ value: "shortenUrl" }, " Shorten Song URL"), To({ value: "viewPlayer" }, " View in Song Player"), To({ value: "copyEmbed" }, " Copy HTML Embed Code"), To({ value: "songRecovery" }, " Recover Recent Song...")), this.cl = Fo({ style: "width: 100%;" }, To({ selected: !0, disabled: !0, hidden: !1 }, "Edit"), To({ value: "undo" }, "Undo (Z)"), To({ value: "redo" }, "Redo (Y)"), To({ value: "copy" }, "Copy Pattern (C)"), To({ value: "pasteNotes" }, "Paste Pattern Notes (V)"), To({ value: "pasteNumbers" }, "Paste Pattern Numbers (" + F.ctrlSymbol + "V)"), To({ value: "insertBars" }, "Insert Bar ()"), To({ value: "deleteBars" }, "Delete Selected Bars ()"), To({ value: "insertChannel" }, "Insert Channel (" + F.ctrlSymbol + ")"), To({ value: "deleteChannel" }, "Delete Selected Channels (" + F.ctrlSymbol + ")"), To({ value: "selectChannel" }, "Select Channel (A)"), To({ value: "selectAll" }, "Select All (A)"), To({ value: "duplicatePatterns" }, "Duplicate Reused Patterns (D)"), To({ value: "transposeUp" }, "Move Notes Up (+ or +)"), To({ value: "transposeDown" }, "Move Notes Down (- or -)"), To({ value: "moveNotesSideways" }, "Move All Notes Sideways... (W)"), To({ value: "beatsPerBar" }, "Change Beats Per Bar..."), To({ value: "barCount" }, "Change Song Length... (L)"), To({ value: "channelSettings" }, "Channel Settings... (Q)"), To({ value: "limiterSettings" }, "Limiter Settings... (L)")), this.dl = Fo({ style: "width: 100%;" }, To({ selected: !0, disabled: !0, hidden: !1 }, "Preferences"), To({ value: "autoPlay" }, "Auto Play on Load"), To({ value: "autoFollow" }, "Keep Current Pattern Selected"), To({ value: "enableNotePreview" }, "Hear Preview of Added Notes"), To({ value: "showLetters" }, "Show Piano Keys"), To({ value: "showFifth" }, 'Highlight "Fifth" of Song Key'), To({ value: "notesOutsideScale" }, "Allow Adding Notes Not in Scale"), To({ value: "setDefaultScale" }, "Use Current Scale as Default"), To({ value: "showChannels" }, "Show Notes From All Channels"), To({ value: "showScrollBar" }, "Show Octave Scroll Bar"), To({ value: "alwaysFineNoteVol" }, "Always Fine Note Volume"), To({ value: "enableChannelMuting" }, "Enable Channel Muting"), To({ value: "displayBrowserUrl" }, "Display Song Data in URL"), To({ value: "displayVolumeBar" }, "Show Playback Volume"), To({ value: "layout" }, "Set Layout..."), To({ value: "colorTheme" }, "Set Theme..."), To({ value: "recordingSetup" }, "Set Up Note Recording...")), this.pl = Po(Fo(), e.scales.map((t => t.name))), this.ul = Po(Fo(), e.keys.map((t => t.name)).reverse()), this.ml = new Bs(So({ style: "margin: 0; vertical-align: middle;", type: "range", min: "30", max: "320", value: "160", step: "1" }), this.l, ((t, e) => new gi(this.l, t, e)), !1), this.fl = So({ style: "width: 4em; font-size: 80%; margin-left: 0.4em; vertical-align: middle;", type: "number", step: "1" }), this.yl = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.chorusRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new ki(this.l, t, e)), !1), this.bl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("chorus") }, "Chorus:"), this.yl.container), this.wl = new Bs(So({ style: "margin: 0; position: sticky,", type: "range", min: "0", max: e.reverbRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new xi(this.l, t, e)), !1), this.vl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("reverb") }, "Reverb:"), this.wl.container), this.kl = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.echoSustainRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new vi(this.l, t, e)), !1), this.xl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("echoSustain") }, "Echo:"), this.kl.container), this.Ml = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.echoDelayRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new wi(this.l, t, e)), !1), this.Sl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("echoDelay") }, "Echo Delay:"), this.Ml.container), this.Fl = Po(Fo(), e.rhythms.map((t => t.name))), this.Cl = Ao(!1, "pitchPresetSelect"), this.El = Ao(!0, "drumPresetSelect"), this.Tl = Po(Fo(), e.algorithms.map((t => t.name))), this.Il = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("algorithm") }, "Algorithm: "), Mo({ class: "selectContainer" }, this.Tl)), this.Pl = [], this.Al = xo({ type: "button", class: "add-instrument last-button" }), this.Ll = xo({ type: "button", class: "remove-instrument" }), this.ql = Mo({ class: "instrument-bar" }, this.Ll, this.Al), this.Dl = Mo({ class: "selectRow", style: "display: none;" }, Co({ class: "tip", onclick: () => this.gl("instrumentIndex") }, "Instrument:"), this.ql), this.Nl = new Bs(So({ style: "margin: 0; position: sticky;", type: "range", min: Math.floor(-e.volumeRange / 2), max: Math.floor(e.volumeRange / 2), value: "0", step: "1" }), this.l, ((t, e) => new Di(this.l, t, e)), !0), this.zl = So({ style: "width: 4em; font-size: 80%", id: "volumeSliderInputBox", type: "number", step: "1", min: Math.floor(-e.volumeRange / 2), max: Math.floor(e.volumeRange / 2), value: "0" }), this.Bl = Mo({ class: "selectRow", style: "height: 1em" }, Co({ class: "tip", style: "font-size: smaller;", onclick: () => this.gl("instrumentVolume") }, "Volume: ")), this.Rl = Mo({ class: "selectRow" }, Mo({}, Mo({ style: "color: " + j.secondaryText + ";" }, Co({ class: "tip" }, this.Bl)), Mo({ style: "color: " + j.secondaryText + "; margin-top: -3px;" }, this.zl)), this.Nl.container), this.Ol = new Bs(So({ style: "margin: 0; position: sticky;", type: "range", min: "0", max: e.panMax, value: e.panCenter, step: "1" }), this.l, ((t, e) => new Bi(this.l, t, e)), !0), this.$l = xo({ style: "margin-left:0em; height:1.5em; width: 10px; padding: 0px; font-size: 8px;", onclick: () => this.Hl(1) }, ""), this.Vl = So({ style: "width: 4em; font-size: 80%; ", id: "panSliderInputBox", type: "number", step: "1", min: "0", max: "100", value: "0" }), this.Gl = Mo({ class: "selectRow" }, Mo({}, Co({ class: "tip", tabindex: "0", style: "height:1em; font-size: smaller;", onclick: () => this.gl("pan") }, "Pan: "), Mo({ style: "color: " + j.secondaryText + "; margin-top: -3px;" }, this.Vl)), this.$l, this.Ol.container), this._l = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.modulators.dictionary["pan delay"].maxRawVol, value: "0", step: "1" }), this.l, ((t, e) => new Ri(this.l, t, e)), !1), this.jl = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("panDelay") }, "Delay:"), this._l.container), this.Ul = Mo({ class: "editor-controls", style: "display: none;" }, this.jl), this.Wl = Po(Fo(), e.chipWaves.map((t => t.name))), this.Kl = Po(Fo(), e.chipNoises.map((t => t.name))), this.Jl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("chipWave") }, "Wave: "), Mo({ class: "selectContainer" }, this.Wl)), this.Yl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("chipNoise") }, "Noise: "), Mo({ class: "selectContainer" }, this.Kl)), this.Ql = new Zs(this.l), this.Xl = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("fadeInOut") }, "Fade:"), this.Ql.container), this.Zl = Po(Fo(), e.transitions.map((t => t.name))), this.tc = xo({ style: "margin-left:0em; height:1.5em; width: 10px; padding: 0px; font-size: 8px;", onclick: () => this.Hl(3) }, ""), this.ec = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("transition") }, "Transition:"), this.tc, Mo({ class: "selectContainer", style: "width: 52.5%;" }, this.Zl)), this.ic = So({ type: "checkbox", style: "width: 1em; padding: 0; margin-right: 4em;" }), this.sc = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("clicklessTransition") }, "Clickless:"), this.ic), this.nc = Mo({ class: "editor-controls", style: "display: none;" }, this.sc), this.oc = Fo(To({ selected: !0, disabled: !0, hidden: !1 })), this.hc = xo({ style: "font-size: x-small; width: 50%; height: 40%", class: "no-underline", onclick: () => this.ac(!0) }, "simple"), this.rc = xo({ style: "font-size: x-small; width: 50%; height: 40%", class: "last-button no-underline", onclick: () => this.ac(!1) }, "advanced"), this.lc = Mo({ class: "selectRow", style: "padding-top: 4px; margin-bottom: 0px;" }, Co({ style: "font-size: x-small;", class: "tip", onclick: () => this.gl("filterType") }, "EQ Filt.Type:"), Mo({ class: "instrument-bar" }, this.hc, this.rc)), this.cc = new us(this.l), this.dc = xo({ style: "margin-left:0em; padding-left:0.2em; height:1.5em; max-width: 12px;", onclick: () => this.gl("customEQFilterSettings") }, "+"), this.uc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("eqFilter") }, "EQ Filt:"), this.dc, this.cc.container), this.mc = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.filterSimpleCutRange - 1, value: "6", step: "1" }), this.l, ((t, e) => new Se(this.l, t, e)), !1), this.fc = Mo({ class: "selectRow", title: "Low-pass Filter Cutoff Frequency" }, Co({ class: "tip", onclick: () => this.gl("filterCutoff") }, "Filter Cut:"), this.mc.container), this.yc = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.filterSimplePeakRange - 1, value: "6", step: "1" }), this.l, ((t, e) => new Fe(this.l, t, e)), !1), this.bc = Mo({ class: "selectRow", title: "Low-pass Filter Peak Resonance" }, Co({ class: "tip", onclick: () => this.gl("filterResonance") }, "Filter Peak:"), this.yc.container), this.gc = xo({ style: "font-size: x-small; width: 50%; height: 40%", class: "no-underline", onclick: () => this.wc(!0) }, "simple"), this.vc = xo({ style: "font-size: x-small; width: 50%; height: 40%", class: "last-button no-underline", onclick: () => this.wc(!1) }, "advanced"), this.kc = Mo({ class: "selectRow", style: "padding-top: 4px; margin-bottom: 0px;" }, Co({ style: "font-size: x-small;", class: "tip", onclick: () => this.gl("filterType") }, "Note Filt.Type:"), Mo({ class: "instrument-bar" }, this.gc, this.vc)), this.xc = new us(this.l, !0), this.Mc = xo({ style: "margin-left:0em; padding-left:0.2em; height:1.5em; max-width: 12px;", onclick: () => this.gl("customNoteFilterSettings") }, "+"), this.Sc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("noteFilter") }, "Note Filt:"), this.Mc, this.xc.container), this.Fc = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.filterSimpleCutRange - 1, value: "6", step: "1" }), this.l, ((t, e) => new Ce(this.l, t, e)), !1), this.Cc = Mo({ class: "selectRow", title: "Low-pass Filter Cutoff Frequency" }, Co({ class: "tip", onclick: () => this.gl("filterCutoff") }, "Filter Cut:"), this.Fc.container), this.Ec = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.filterSimplePeakRange - 1, value: "6", step: "1" }), this.l, ((t, e) => new Ee(this.l, t, e)), !1), this.Tc = Mo({ class: "selectRow", title: "Low-pass Filter Peak Resonance" }, Co({ class: "tip", onclick: () => this.gl("filterResonance") }, "Filter Peak:"), this.Ec.container), this.Ic = new Bs(So({ style: "margin: 0;", type: "range", min: "1", max: e.pulseWidthRange, value: "1", step: "1" }), this.l, ((t, e) => new fe(this.l, t, e)), !1), this.Pc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("pulseWidth") }, "Pulse Width:"), this.Ic.container), this.Ac = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.pitchShiftRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new ye(this.l, t, e)), !0), this.Lc = [Mo({ class: "pitchShiftMarker", style: { color: j.tonic } }), Mo({ class: "pitchShiftMarker", style: { color: j.tonic, left: "50%" } }), Mo({ class: "pitchShiftMarker", style: { color: j.tonic, left: "100%" } })], this.qc = [Mo({ class: "pitchShiftMarker", style: { color: j.fifthNote, left: 700 / 24 + "%" } }), Mo({ class: "pitchShiftMarker", style: { color: j.fifthNote, left: 1900 / 24 + "%" } })], this.Dc = Mo({ style: "display: flex; position: relative;" }, this.Ac.container, Mo({ class: "pitchShiftMarkerContainer" }, this.Lc, this.qc)), this.Nc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("pitchShift") }, "Pitch Shift:"), this.Dc), this.zc = new Bs(So({ style: "margin: 0;", type: "range", min: e.detuneMin - e.detuneCenter, max: e.detuneMax - e.detuneCenter, value: 0, step: "4" }), this.l, ((t, e) => new be(this.l, t, e)), !0), this.Bc = So({ style: "width: 4em; font-size: 80%; ", id: "detuneSliderInputBox", type: "number", step: "1", min: e.detuneMin - e.detuneCenter, max: e.detuneMax - e.detuneCenter, value: 0 }), this.Rc = Mo({ class: "selectRow" }, Mo({}, Co({ class: "tip", style: "height:1em; font-size: smaller;", onclick: () => this.gl("detune") }, "Detune: "), Mo({ style: "color: " + j.secondaryText + "; margin-top: -3px;" }, this.Bc)), this.zc.container), this.Oc = new Bs(So({ style: "margin: 0; position: sticky;", type: "range", min: "0", max: e.distortionRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new ge(this.l, t, e)), !1), this.$c = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("distortion") }, "Distortion:"), this.Oc.container), this.Hc = So({ type: "checkbox", style: "width: 1em; padding: 0; margin-right: 4em;" }), this.Vc = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("aliases") }, "Aliasing:"), this.Hc), this.Gc = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.bitcrusherQuantizationRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new ve(this.l, t, e)), !1), this._c = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("bitcrusherQuantization") }, "Bit Crush:"), this.Gc.container), this.jc = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.bitcrusherFreqRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new we(this.l, t, e)), !1), this.Uc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("bitcrusherFreq") }, "Freq Crush:"), this.jc.container), this.Wc = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.stringSustainRange - 1, value: "0", step: "1" }), this.l, ((t, e) => new ke(this.l, t, e)), !1), this.Kc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("stringSustain") }, "Sustain:"), this.Wc.container), this.Jc = Po(Fo(), e.unisons.map((t => t.name))), this.Yc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("unison") }, "Unison:"), Mo({ class: "selectContainer" }, this.Jc)), this.Qc = Po(Fo(), e.chords.map((t => t.name))), this.Xc = xo({ style: "margin-left:0em; height:1.5em; width: 10px; padding: 0px; font-size: 8px;", onclick: () => this.Hl(2) }, ""), this.Zc = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("chords") }, "Chords:"), this.Xc, Mo({ class: "selectContainer" }, this.Qc)), this.td = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.modulators.dictionary["arp speed"].maxRawVol, value: "0", step: "1" }), this.l, ((t, e) => new ae(this.l, t, e)), !1), this.ed = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("arpeggioSpeed") }, "Speed:"), this.td.container), this.sd = So({ type: "checkbox", style: "width: 1em; padding: 0; margin-right: 4em;" }), this.nd = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("twoNoteArpeggio") }, "Fast Two-Note:"), this.sd), this.od = Mo({ class: "editor-controls", style: "display: none;" }, this.ed, this.nd), this.hd = Po(Fo(), e.vibratos.map((t => t.name))), this.ad = xo({ style: "margin-left:0em; height:1.5em; width: 10px; padding: 0px; font-size: 8px;", onclick: () => this.Hl(0) }, ""), this.rd = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("vibrato") }, "Vibrato:"), this.ad, Mo({ class: "selectContainer", style: "width: 61.5%;" }, this.hd)), this.ld = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.modulators.dictionary["vibrato depth"].maxRawVol, value: "0", step: "1" }), this.l, ((t, e) => new se(this.l, t, e)), !1), this.dd = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("vibratoDepth") }, "Depth:"), this.ld.container), this.pd = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.modulators.dictionary["vibrato speed"].maxRawVol, value: "0", step: "1" }), this.l, ((t, e) => new ne(this.l, t, e)), !1), this.ud = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("vibratoSpeed") }, "Speed:"), this.pd.container), this.md = new Bs(So({ style: "margin: 0;", type: "range", min: "0", max: e.modulators.dictionary["vibrato delay"].maxRawVol, value: "0", step: "1" }), this.l, ((t, e) => new oe(this.l, t, e)), !1), this.fd = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("vibratoDelay") }, "Delay:"), this.md.container), this.yd = Po(Fo(), e.vibratoTypes.map((t => t.name))), this.bd = Mo({ class: "selectRow" }, Co({ class: "tip", style: "margin-left:10px;", onclick: () => this.gl("vibratoType") }, "Type:"), Mo({ class: "selectContainer", style: "width: 61.5%;" }, this.yd)), this.gd = Mo({ class: "editor-controls", style: "display: none;" }, this.dd, this.ud, this.fd, this.bd), this.wd = Mo({ class: "editor-controls" }), this.vd = Po(Fo(), e.feedbacks.map((t => t.name))), this.kd = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("feedbackType") }, "Feedback:"), Mo({ class: "selectContainer" }, this.vd)), this.xd = new ho(this.l, null), this.Md = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("spectrum") }, "Spectrum:"), this.xd.container), this.Sd = new Ds(this.l), this.Fd = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("harmonics") }, "Harmonics:"), this.Sd.container), this.Cd = new Xs(this.l), this.Ed = Mo({ class: "editor-controls" }), this.Td = Mo({ class: "editor-controls" }), this.Id = xo({ style: "max-width:86px; width: 86px;", class: "copyButton" }, ["Copy", B.svg({ style: "flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;", width: "2em", height: "2em", viewBox: "-5 -21 26 26" }, [B.path({ d: "M 0 -15 L 1 -15 L 1 0 L 13 0 L 13 1 L 0 1 L 0 -15 z M 2 -1 L 2 -17 L 10 -17 L 14 -13 L 14 -1 z M 3 -2 L 13 -2 L 13 -12 L 9 -12 L 9 -16 L 3 -16 z", fill: "currentColor" })])]), this.Pd = xo({ style: "max-width:86px;", class: "pasteButton" }, ["Paste", B.svg({ style: "flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;", width: "2em", height: "2em", viewBox: "0 0 26 26" }, [B.path({ d: "M 8 18 L 6 18 L 6 5 L 17 5 L 17 7 M 9 8 L 16 8 L 20 12 L 20 22 L 9 22 z", stroke: "currentColor", fill: "none" }), B.path({ d: "M 9 3 L 14 3 L 14 6 L 9 6 L 9 3 z M 16 8 L 20 12 L 16 12 L 16 8 z", fill: "currentColor" })])]), this.Ad = new qo(Io({ width: 128, height: 52, style: "border:2px solid " + j.uiWidgetBackground, id: "customWaveDrawCanvas" }), this.l, (t => new Ot(this.l, t))), this.Ld = function (t, e, i) { e.appendChild(To({ selected: !0, disabled: !0, value: t }, t)); for (const t of i) e.appendChild(To({ value: t }, t)); return e }("Load Preset", Fo({ style: "width: 50%; height:1.5em; text-align: center; text-align-last: center;" }), e.chipWaves.map((t => t.name))), this.qd = xo({ style: "margin-left:0.5em; height:1.5em; max-width: 20px;", onclick: () => this.gl("customChipSettings") }, "+"), this.Dd = Mo({ style: "height:80px; margin-top:10px; margin-bottom:5px" }, [Mo({ style: "height:54px; display:flex; justify-content:center;" }, [this.Ad.canvas]), Mo({ style: "margin-top:5px; display:flex; justify-content:center;" }, [this.Ld, this.qd])]), this.Nd = new zs(So({ style: "font-weight:bold; border:none; width: 100%; background-color:${ColorConfig.editorBackground}; color:${ColorConfig.primaryText}; text-align:center", maxlength: "30", type: "text", value: F.versionDisplayName }), this.l, ((t, e) => new Ni(this.l, t, e))), this.zd = new Bs(So({ type: "range", min: "0", max: e.operatorAmplitudeMax, value: "0", step: "1", title: "Feedback Amplitude" }), this.l, ((t, e) => new Re(this.l, t, e)), !1), this.Bd = Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("feedbackVolume") }, "Fdback Vol:"), this.zd.container), this.Rd = xo({ type: "button", class: "add-envelope" }), this.Od = Mo({ class: "editor-controls" }, this.Gl, this.Ul, this.Jl, this.Yl, this.Dd, this.lc, this.uc, this.fc, this.bc, this.Xl, this.Il, this.wd, this.kd, this.Bd, this.Md, this.Fd, this.Ed, this.Pc, this.Kc, this.Yc, Mo({ style: "padding: 2px 0; margin-left: 2em; display: flex; align-items: center;" }, Co({ style: "flex-grow: 1; text-align: center;" }, Co({ class: "tip", onclick: () => this.gl("effects") }, "Effects")), Mo({ class: "effects-menu" }, this.oc)), this.ec, this.nc, this.Zc, this.od, this.Nc, this.Rc, this.rd, this.gd, this.kc, this.Sc, this.Cc, this.Tc, this.$c, this.Vc, this._c, this.Uc, this.bl, this.xl, this.Sl, this.vl, Mo({ style: "padding: 2px 0; margin-left: 2em; display: flex; align-items: center;" }, Co({ style: "flex-grow: 1; text-align: center;" }, Co({ class: "tip", onclick: () => this.gl("envelopes") }, "Envelopes")), this.Rd), this.Cd.container), this.$d = Mo({ class: "editor-controls" }, Mo({ class: "selectRow" }, this.Id, this.Pd)), this.Hd = Mo({ id: "instrumentSettingsText", style: `padding: 3px 0; max-width: 15em; text-align: center; color: ${j.secondaryText};` }, "Instrument Settings"), this.Vd = Mo({ class: "selectRow", id: "typeSelectRow" }, Co({ class: "tip", onclick: () => this.gl("instrumentType") }, "Type:"), Mo(Mo({ class: "pitchSelect" }, this.Cl), Mo({ class: "drumSelect" }, this.El))), this.Gd = Mo({ class: "editor-controls" }, this.Hd, this.Dl, this.Vd, this.Rl, this.Od), this._d = B.path({ d: "M -6 -6 H 6 V 6 H -6 V -6 M -2 -3 L -2 -3 L -1 -4 H 1 V 4 H -1 V -1.2 L -1.2 -1 H -2 V -3 z", fill: j.indicatorSecondary, "fill-rule": "evenodd" }), this.jd = B.path({ d: "M -6 -0.8 H -3.8 V -6 H 0.8 V 4.4 H 2.2 V -0.8 H 6 V 0.8 H 3.8 V 6 H -0.8 V -4.4 H -2.2 V 0.8 H -6 z", fill: j.indicatorSecondary }), this.Ud = B.svg({ style: "width: 92%; height: 1.3em; flex-shrink: 0; position: absolute;", viewBox: "0 0 200 200" }, [B.path({ d: "M90 155 l0 -45 -45 0 c-25 0 -45 -4 -45 -10 0 -5 20 -10 45 -10 l45 0 0 -45 c0 -25 5 -45 10 -45 6 0 10 20 10 45 l0 45 45 0 c25 0 45 5 45 10 0 6 -20 10 -45 10 l -45 0 0 45 c0 25 -4 45 -10 45 -5 0 -10 -20 -10 -45z" }), B.path({ d: "M42 158 c-15 -15 -16 -38 -2 -38 6 0 10 7 10 15 0 8 7 15 15 15 8 0 15 5 15 10 0 14 -23 13 -38 -2z" }), B.path({ d: "M120 160 c0 -5 7 -10 15 -10 8 0 15 -7 15 -15 0 -8 5 -15 10 -15 14 0 13 23 -2 38 -15 15 -38 16 -38 2z" }), B.path({ d: "M32 58 c3 -23 48 -40 48 -19 0 6 -7 11 -15 11 -8 0 -15 7 -15 15 0 8 -5 15 -11 15 -6 0 -9 -10 -7 -22z" }), B.path({ d: "M150 65 c0 -8 -7 -15 -15 -15 -8 0 -15 -4 -15 -10 0 -14 23 -13 38 2 15 15 16 38 2 38 -5 0 -10 -7 -10 -15z" })]), this.Wd = Mo({ class: "promptContainer", style: "display: none;" }), this.Kd = xo({ class: "zoomInButton", type: "button", title: "Zoom In" }), this.Jd = xo({ class: "zoomOutButton", type: "button", title: "Zoom Out" }), this.Yd = Mo({ style: "flex: 1; height: 100%; display: flex; overflow: hidden; justify-content: center;" }, this.Wr.container, this.Kr.container, this.Jr.container), this.Qd = Mo({ class: "pattern-area" }, this.Ao.container, this.Yd, this.Zr.container, this.Kd, this.Jd), this.u = Mo({ class: "trackContainer" }, this.Yr.container, this.Xr.container), this.Xd = Mo({ style: "position: absolute; width: 100%; height: 100%; pointer-events: none;" }), this.Zd = Mo({ class: "trackAndMuteContainer" }, this.Qr.container, this.u, this.Xd), this.Br = new W(this.l, this.Zd), this.tp = Mo({ class: "track-area" }, this.Zd, this.Br.container), this.ep = Mo({ class: "menu-area" }, Mo({ class: "selectContainer menu file" }, this.ll), Mo({ class: "selectContainer menu edit" }, this.cl), Mo({ class: "selectContainer menu preferences" }, this.dl)), this.ip = Mo({ class: "song-settings-area" }, Mo({ class: "editor-controls" }, Mo({ class: "editor-song-settings" }, Mo({ style: "margin: 3px 0; position: relative; text-align: center; color: ${ColorConfig.secondaryText};" }, Mo({ class: "tip", style: "flex-shrink: 0; position:absolute; left: 0; top: 0; width: 12px; height: 12px", onclick: () => this.gl("usedPattern") }, B.svg({ style: "flex-shrink: 0; position: absolute; left: 0; top: 0; pointer-events: none;", width: "12px", height: "12px", "margin-right": "0.5em", viewBox: "-6 -6 12 12" }, this._d)), Mo({ class: "tip", style: "flex-shrink: 0; position: absolute; left: 14px; top: 0; width: 12px; height: 12px", onclick: () => this.gl("usedInstrument") }, B.svg({ style: "flex-shrink: 0; position: absolute; left: 0; top: 0; pointer-events: none;", width: "12px", height: "12px", "margin-right": "1em", viewBox: "-6 -6 12 12" }, this.jd)), "Song Settings", Mo({ style: "width: 100%; left: 0; top: -1px; position:absolute; overflow-x:clip;" }, this.Ud))), Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("scale") }, "Scale: "), Mo({ class: "selectContainer" }, this.pl)), Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("key") }, "Key: "), Mo({ class: "selectContainer" }, this.ul)), Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("tempo") }, "Tempo: "), Co({ style: "display: flex;" }, this.ml.container, this.fl)), Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("rhythm") }, "Rhythm: "), Mo({ class: "selectContainer" }, this.Fl)))), this.sp = Mo({ class: "instrument-settings-area" }, this.Gd, this.Td), this.np = Mo({ class: "settings-area noSelection" }, Mo({ class: "version-area" }, Mo({ style: `text-align: center; margin: 3px 0; color: ${j.secondaryText};` }, this.Nd.input)), Mo({ class: "play-pause-area" }, this.rl, Mo({ class: "playback-bar-controls" }, this.ti, this.tl, this.el, this.il, this.sl, this.nl), Mo({ class: "playback-volume-controls" }, Co({ class: "volume-speaker" }), this.ol.container)), this.ep, this.ip, this.sp), this.mainLayer = Mo({ class: "beepboxEditor", tabIndex: "0" }, this.Qd, this.tp, this.np, this.Wd), this.op = !1, this.hp = null, this.ap = -1, this.rp = 0, this.lp = !1, this.cp = !1, this.dp = !1, this.pp = !1, this.up = !1, this.mp = !1, this.fp = [], this.yp = [], this.bp = [], this.gp = [], this.wp = [], this.vp = [], this.kp = [], this.xp = [], this.Mp = [], this.Sp = [], this.Fp = [], this.Cp = [], this.Ep = [], this.Tp = [], this.Ip = !1, this.Pp = !1, this.Ap = !1, this.Lp = !1, this.qp = !1, this.Dp = [], this.outVolumeHistoricTimer = 0, this.outVolumeHistoricCap = 0, this.lastOutVolumeCap = 0, this.refocusStage = () => { this.mainLayer.focus({ preventScroll: !0 }) }, this.Np = t => { this.l.synth.recording && t.target != this.mainLayer && t.target != this.il && t.target != this.ol.input && this.refocusStage() }, this.zp = () => { this.Kr.editingModLabel || this.mainLayer.focus({ preventScroll: !0 }) }, this.whenUpdated = () => { const t = this.l.prefs; this.Qr.container.style.display = t.enableChannelMuting ? "" : "none"; const i = this.Xd.getBoundingClientRect(); this.l.trackVisibleBars = Math.floor((i.right - i.left - (t.enableChannelMuting ? 32 : 0)) / this.l.getBarWidth()), this.l.trackVisibleChannels = Math.floor((i.bottom - i.top - 30) / this.l.getChannelHeight()); for (let t = this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; t < this.l.song.channels.length; t++) { const e = this.l.song.channels[t]; for (let t = 0; t < e.instruments.length; t++)this.l.synth.determineInvalidModulators(e.instruments[t]) } if (this.Br.render(), this.Qr.render(), this.Yr.render(), document.activeElement != this.Kr.modDragValueLabel && this.Kr.editingModLabel && this.Kr.stopEditingModLabel(!1), this.Ao.container.style.display = t.showLetters ? "" : "none", this.Zr.container.style.display = t.showScrollBar ? "" : "none", this.Br.container.style.display = this.l.song.barCount > this.l.trackVisibleBars ? "" : "none", this.rl.style.display = this.l.prefs.displayVolumeBar ? "" : "none", this.l.getFullScreen()) { const e = 5 * (this.Yd.clientHeight / this.l.getVisiblePitchCount()), i = this.Yd.clientWidth / (3 * this.l.song.beatsPerBar), s = this.Yd.clientWidth / (this.l.song.beatsPerBar + 2), n = Math.max(i, Math.min(s, e)) * this.l.song.beatsPerBar; this.Wr.container.style.width = n + "px", this.Kr.container.style.width = n + "px", this.Jr.container.style.width = n + "px", this.Wr.container.style.flexShrink = "0", this.Kr.container.style.flexShrink = "0", this.Jr.container.style.flexShrink = "0", this.Wr.container.style.display = "", this.Jr.container.style.display = "", this.Wr.render(), this.Jr.render(), this.Kd.style.display = this.l.channel < this.l.song.pitchChannelCount ? "" : "none", this.Jd.style.display = this.l.channel < this.l.song.pitchChannelCount ? "" : "none", this.Kd.style.right = t.showScrollBar ? "24px" : "4px", this.Jd.style.right = t.showScrollBar ? "24px" : "4px" } else this.Kr.container.style.width = "", this.Kr.container.style.flexShrink = "", this.Wr.container.style.display = "none", this.Jr.container.style.display = "none", this.Kd.style.display = "none", this.Jd.style.display = "none"; this.Kr.render(); const s = [(t.autoPlay ? " " : "") + "Auto Play on Load", (t.autoFollow ? " " : "") + "Keep Current Pattern Selected", (t.enableNotePreview ? " " : "") + "Hear Preview of Added Notes", (t.showLetters ? " " : "") + "Show Piano Keys", (t.showFifth ? " " : "") + 'Highlight "Fifth" of Song Key', (t.notesOutsideScale ? " " : "") + "Allow Adding Notes Not in Scale", (t.defaultScale == this.l.song.scale ? " " : "") + "Use Current Scale as Default", (t.showChannels ? " " : "") + "Show Notes From All Channels", (t.showScrollBar ? " " : "") + "Show Octave Scroll Bar", (t.alwaysFineNoteVol ? " " : "") + "Always Fine Note Volume", (t.enableChannelMuting ? " " : "") + "Enable Channel Muting", (t.displayBrowserUrl ? " " : "") + "Display Song Data in URL", (t.displayVolumeBar ? " " : "") + "Show Playback Volume", "Set Layout...", "Set Theme...", "Set Up Note Recording..."]; for (let t = 0; t < s.length; t++) { const e = this.dl.children[t + 1]; e.textContent != s[t] && (e.textContent = s[t]) } const n = this.l.song.channels[this.l.channel], o = this.l.getCurrentInstrument(), h = n.instruments[o], a = this.mainLayer.contains(document.activeElement), r = document.activeElement, l = j.getChannelColor(this.l.song, this.l.channel); for (let t = this.oc.childElementCount - 1; t < e.effectOrder.length; t++)this.oc.appendChild(To({ value: t })); this.oc.selectedIndex = -1; for (let t = 0; t < e.effectOrder.length; t++) { let i = e.effectOrder[t]; const s = (0 != (h.effects & 1 << i) ? " " : "") + e.effectNames[i], n = this.oc.children[t + 1]; n.textContent != s && (n.textContent = s) } if (Lo(this.pl, this.l.song.scale), this.pl.title = e.scales[this.l.song.scale].realName, Lo(this.ul, e.keys.length - 1 - this.l.song.key), this.ml.updateValue(Math.max(0, Math.round(this.l.song.tempo))), this.fl.value = Math.round(this.l.song.tempo).toString(), this.Nd.updateValue(this.l.song.title), this.lc.style.setProperty("--text-color-lit", l.primaryNote), this.lc.style.setProperty("--text-color-dim", l.secondaryNote), this.lc.style.setProperty("--background-color-lit", l.primaryChannel), this.lc.style.setProperty("--background-color-dim", l.secondaryChannel), h.eqFilterType ? (this.hc.classList.remove("deactivated"), this.rc.classList.add("deactivated"), this.uc.style.display = "none", this.fc.style.display = "", this.bc.style.display = "") : (this.hc.classList.add("deactivated"), this.rc.classList.remove("deactivated"), this.uc.style.display = "", this.fc.style.display = "none", this.bc.style.display = "none"), Lo(this.Fl, this.l.song.rhythm), this.l.song.getChannelIsMod(this.l.channel)) { this.Bp(this.l.channel, o), this.Cl.style.display = "none", this.El.style.display = "none", $("#pitchPresetSelect").parent().hide(), $("#drumPresetSelect").parent().hide(), this.Td.appendChild(this.$d), this.Td.insertBefore(this.Dl, this.Td.firstChild), this.Td.insertBefore(this.Hd, this.Td.firstChild), "" == this.l.song.channels[this.l.channel].name ? this.Hd.textContent = "Modulator Settings" : this.Hd.textContent = this.l.song.channels[this.l.channel].name, this.Yl.style.display = "none", this.Jl.style.display = "none", this.Md.style.display = "none", this.Fd.style.display = "none", this.ec.style.display = "none", this.Zc.style.display = "none", this.od.style.display = "none", this.Ed.style.display = "none", this.Dd.style.display = "none", this.Il.style.display = "none", this.wd.style.display = "none", this.kd.style.display = "none", this.Bd.style.display = "none", this.Pc.style.display = "none", this.rd.style.display = "none", this.gd.style.display = "none", this.Rc.style.display = "none", this.Gl.style.display = "none", this.Ul.style.display = "none", this.Td.style.display = "", this.Td.style.color = j.getChannelColor(this.l.song, this.l.channel).primaryNote; for (let t = 0; t < e.modCount; t++) { let i = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], s = Math.max(0, i.modChannels[t]), n = i.modInstruments[t]; if ((n >= this.l.song.channels[s].instruments.length + 2 || n > 0 && this.l.song.channels[s].instruments.length <= 1) && (n = 0, i.modInstruments[t] = 0, i.modulators[t] = 0), s >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && (i.modInstruments[t] = 0, i.modulators[t] = 0), this.l.recalcChannelNames || this.Rp[t].children.length != 2 + this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) { for (; this.Rp[t].firstChild;)this.Rp[t].remove(0); const e = []; e.push("none"), e.push("song"); for (let t = 0; t < this.l.song.pitchChannelCount; t++)"" == this.l.song.channels[t].name ? e.push("pitch " + (t + 1)) : e.push(this.l.song.channels[t].name); for (let t = 0; t < this.l.song.noiseChannelCount; t++)"" == this.l.song.channels[t + this.l.song.pitchChannelCount].name ? e.push("noise " + (t + 1)) : e.push(this.l.song.channels[t + this.l.song.pitchChannelCount].name); Po(this.Rp[t], e) } this.Rp[t].selectedIndex = i.modChannels[t] + 2; let o = this.l.song.channels[s]; if (this.Op[t].children.length != o.instruments.length + 2) { for (; this.Op[t].firstChild;)this.Op[t].remove(0); const e = []; for (let t = 0; t < o.instruments.length; t++)e.push("" + t + 1); e.push("all"), e.push("active"), Po(this.Op[t], e) } if (o.bars[this.l.bar] > 0) { let e = o.patterns[o.bars[this.l.bar] - 1].instruments; for (let i = 0; i < o.instruments.length; i++)e.includes(i) ? this.Op[t].options[i].label = "" + (i + 1) : this.Op[t].options[i].label = "" + (i + 1) } else for (let e = 0; e < o.instruments.length; e++)this.Op[t].options[e].label = "" + (e + 1); if (this.Op[t].selectedIndex = i.modInstruments[t], -2 != i.modChannels[t]) { for (; this.$p[t].firstChild;)this.$p[t].remove(0); const s = [], h = []; if (s.push("none"), -1 == i.modChannels[t]) s.push("song volume"), s.push("tempo"), s.push("song reverb"), s.push("next bar"), s.push("song detune"); else { s.push("note volume"), s.push("mix volume"); let t = [], e = !1, i = !1, a = !1, r = !1, l = !1, c = !1, d = !1, M = !1, S = !1, F = !1, C = !1, E = !1, T = !1, I = !1, P = !1, A = !0, L = !0, q = !0, D = !0, N = !0, z = !0, B = !0, R = !0, O = !0, $ = []; if (n >= o.instruments.length) for (let t = 0; t < o.instruments.length; t++)$.push(t); else $.push(n); for (let s = 0; s < $.length; s++) { let n = $[s]; t.includes(o.instruments[n].type) || t.push(o.instruments[n].type), o.instruments[n].eqFilterType ? i = !0 : e = !0, p(o.instruments[n].effects) && o.instruments[n].getChord().arpeggiates && (l = !0), u(o.instruments[n].effects) && (c = !0), m(o.instruments[n].effects) ? d = !0 : L = !1, f(o.instruments[n].effects) ? M = !0 : q = !1, y(o.instruments[n].effects) ? (S = !0, o.instruments[n].noteFilterType ? r = !0 : a = !0) : A = !1, b(o.instruments[n].effects) ? F = !0 : D = !1, g(o.instruments[n].effects) ? C = !0 : N = !1, w(o.instruments[n].effects) ? E = !0 : z = !1, v(o.instruments[n].effects) ? T = !0 : B = !1, k(o.instruments[n].effects) ? I = !0 : R = !1, x(o.instruments[n].effects) ? P = !0 : O = !1 } e && s.push("eq filter"), i && (s.push("eq filt cut"), s.push("eq filt peak")), t.includes(1) && (s.push("fm slider 1"), s.push("fm slider 2"), s.push("fm slider 3"), s.push("fm slider 4"), s.push("fm feedback")), t.includes(6) && s.push("pulse width"), t.includes(7) && s.push("sustain"), l && (s.push("arp speed"), s.push("reset arp")), c && s.push("pitch shift"), d && s.push("detune"), L || h.push("+ detune"), M && (s.push("vibrato depth"), s.push("vibrato speed"), s.push("vibrato delay")), q || (h.push("+ vibrato depth"), h.push("+ vibrato speed"), h.push("+ vibrato delay")), S && (a && s.push("note filter"), r && (s.push("note filt cut"), s.push("note filt peak"))), A || h.push("+ note filter"), F && s.push("distortion"), D || h.push("+ distortion"), C && (s.push("bit crush"), s.push("freq crush")), N || (h.push("+ bit crush"), h.push("+ freq crush")), E && (s.push("pan"), s.push("pan delay")), z || (h.push("+ pan"), h.push("+ pan delay")), T && s.push("chorus"), B || h.push("+ chorus"), I && s.push("echo"), R || h.push("+ echo"), P && s.push("reverb"), O || h.push("+ reverb") } Po(this.$p[t], s), h.length > 0 && (this.$p[t].appendChild(To({ selected: !1, disabled: !0, value: "Add Effect" }, "Add Effect")), Po(this.$p[t], h)); let a = s.indexOf(e.modulators[i.modulators[t]].name); -1 == a ? (this.$p[t].insertBefore(To({ value: e.modulators[i.modulators[t]].name, style: "color: red;" }, e.modulators[i.modulators[t]].name), this.$p[t].children[0]), this.$p[t].selectedIndex = 0, this.Hp(t, !0)) : (this.$p[t].selectedIndex = a, this.$p[t].classList.remove("invalidSetting"), i.invalidModulators[t] = !1) } else this.$p[t].selectedIndex > 0 && (this.$p[t].selectedIndex = 0, this.Hp(t)); i.modChannels[t] < 0 ? (this.Op[t].parentElement.style.display = "none", $("#modInstrumentText" + t).get(0).style.display = "none", $("#modChannelText" + t).get(0).innerText = "Channel:", -2 == i.modChannels[t] ? ($("#modSettingText" + t).get(0).style.display = "none", this.$p[t].parentElement.style.display = "none") : ($("#modSettingText" + t).get(0).style.display = "", this.$p[t].parentElement.style.display = ""), this.Vp[t].style.setProperty("fill", j.uiWidgetFocus), this.Vp[t].classList.remove("modTarget")) : (this.Op[t].parentElement.style.display = o.instruments.length > 1 ? "" : "none", $("#modInstrumentText" + t).get(0).style.display = o.instruments.length > 1 ? "" : "none", $("#modChannelText" + t).get(0).innerText = o.instruments.length > 1 ? "Ch:" : "Channel:", $("#modSettingText" + t).get(0).style.display = "", this.$p[t].parentElement.style.display = "", this.Vp[t].style.setProperty("fill", j.indicatorPrimary), this.Vp[t].classList.add("modTarget")); let h = e.modulators[i.modulators[t]].name; if ("eq filter" == h || "note filter" == h) { $("#modFilterText" + t).get(0).style.display = "", $("#modSettingText" + t).get(0).style.setProperty("margin-bottom", "2px"); let e = i.modInstruments[t], s = this.l.song.channels[Math.max(0, i.modChannels[t])], n = -1; if (e >= s.instruments.length) for (let t = 0; t < s.instruments.length; t++)"eq filter" == h ? s.instruments[t].eqFilter.controlPointCount > n && (n = s.instruments[t].eqFilter.controlPointCount, e = t) : s.instruments[t].noteFilter.controlPointCount > n && (n = s.instruments[t].noteFilter.controlPointCount, e = t); let a = "eq filter" == h ? o.instruments[e].eqFilter.controlPointCount : o.instruments[e].noteFilter.controlPointCount; const r = "eq filter" == h ? o.instruments[e].eqFilterType : o.instruments[e].noteFilterType; if (r && (a = 0), r || this.Gp[t].children.length != 1 + 2 * a) { for (; this.Gp[t].firstChild;)this.Gp[t].remove(0); const e = []; r || e.push("morph"); for (let t = 0; t < a; t++)e.push("dot " + (t + 1) + " x"), e.push("dot " + (t + 1) + " y"); Po(this.Gp[t], e) } if (r || i.modFilterTypes[t] >= this.Gp[t].length) { this.Gp[t].classList.add("invalidSetting"), i.invalidModulators[t] = !0; let e = (i.modFilterTypes[t] - 1) % 2 == 1 ? "dot " + (Math.floor((i.modFilterTypes[t] - 1) / 2) + 1) + " y" : "dot " + (Math.floor((i.modFilterTypes[t] - 1) / 2) + 1) + " x"; 0 == i.modFilterTypes[t] && (e = "morph"), this.Gp[t].insertBefore(To({ value: e, style: "color: red;" }, e), this.Gp[t].children[0]), this.Gp[t].selectedIndex = 0 } else this.Gp[t].classList.remove("invalidSetting"), i.invalidModulators[t] = !1, this.Gp[t].selectedIndex = i.modFilterTypes[t] } else $("#modFilterText" + t).get(0).style.display = "none", $("#modSettingText" + t).get(0).style.setProperty("margin-bottom", "0.9em") } this.l.recalcChannelNames = !1; for (let t = 0; t < e.chords.length; t++) { const e = this.Qc.children[t]; e.hasAttribute("hidden") || e.setAttribute("hidden", "") } this.Od.style.display = "none", this.Gl.style.display = "none", this.Ul.style.display = "none", this.Rl.style.display = "none", this.Vd.style.setProperty("display", "none"), this.Gd.style.color = j.getChannelColor(this.l.song, this.l.channel).primaryNote, this.l.channel >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && this.Ao.forceRender(), this._p(n, o, l) } else { if (this.Od.style.display = "", this.Gl.style.display = "", this.Ul.style.display = this.Pp ? "" : "none", this.Rc.style.display = "", this.Rl.style.display = "", this.Vd.style.setProperty("display", ""), this.Gd.appendChild(this.$d), this.Gd.insertBefore(this.Dl, this.Gd.firstChild), this.Gd.insertBefore(this.Hd, this.Gd.firstChild), "" == this.l.song.channels[this.l.channel].name ? this.Hd.textContent = "Instrument Settings" : this.Hd.textContent = this.l.song.channels[this.l.channel].name, this.Td.style.display = "none", this.Bp(this.l.channel, o), this.l.song.getChannelIsNoise(this.l.channel) ? (this.Cl.style.display = "none", this.El.style.display = "", $("#pitchPresetSelect").parent().hide(), $("#drumPresetSelect").parent().show(), Lo(this.El, h.preset)) : (this.Cl.style.display = "", this.El.style.display = "none", $("#pitchPresetSelect").parent().show(), $("#drumPresetSelect").parent().hide(), Lo(this.Cl, h.preset)), 2 == h.type ? (this.Jl.style.display = "none", this.Yl.style.display = "", Lo(this.Kl, h.chipNoise)) : this.Yl.style.display = "none", 3 == h.type ? (this.Jl.style.display = "none", this.Md.style.display = "", this.xd.render()) : this.Md.style.display = "none", 5 == h.type || 7 == h.type ? (this.Jl.style.display = "none", this.Fd.style.display = "", this.Sd.render()) : this.Fd.style.display = "none", 7 == h.type ? (this.Jl.style.display = "none", this.Kc.style.display = "", this.Wc.updateValue(h.stringSustain)) : this.Kc.style.display = "none", 4 == h.type) { this.Ed.style.display = "", this.Jl.style.display = "none", this.Xl.style.display = "none"; for (let t = 0; t < e.drumCount; t++)Lo(this.Fp[t], h.drumsetEnvelopes[t]), this.Sp[t].render() } else this.Ed.style.display = "none", this.Xl.style.display = "", this.Ql.render(); if (0 == h.type && (this.Jl.style.display = "", Lo(this.Wl, h.chipWave)), 8 == h.type ? (this.Dd.style.display = "", this.Jl.style.display = "none") : this.Dd.style.display = "none", 6 == h.type ? (this.Jl.style.display = "none", this.Pc.style.display = "", this.Ic.input.title = S(h.pulseWidth) + "%", this.Ic.updateValue(h.pulseWidth)) : this.Pc.style.display = "none", 1 == h.type) { this.Il.style.display = "", this.wd.style.display = "", this.kd.style.display = "", this.Bd.style.display = "", this.Jl.style.display = "none", Lo(this.Tl, h.algorithm), Lo(this.vd, h.feedbackType), this.zd.updateValue(h.feedbackAmplitude); for (let t = 0; t < e.operatorCount; t++) { const i = t < e.algorithms[h.algorithm].carrierCount; this.fp[t].style.color = i ? j.primaryText : "", Lo(this.bp[t], h.operators[t].frequency), this.yp[t].updateValue(h.operators[t].amplitude), Lo(this.wp[t], h.operators[t].waveform), this.kp[t].updateValue(h.operators[t].pulseWidth), this.kp[t].input.title = "" + e.pwmOperatorWaves[h.operators[t].pulseWidth].name, this.Mp[t].style.color = i ? j.primaryText : ""; const s = (i ? "Voice " : "Modulator ") + (t + 1); this.bp[t].title = s + " Frequency", this.yp[t].input.title = s + (i ? " Volume" : " Amplitude"), this.Mp[t].style.display = this.Dp[t] ? "" : "none", 3 == h.operators[t].waveform ? (this.kp[t].container.style.display = "", this.vp[t].style.display = "none") : (this.kp[t].container.style.display = "none", this.vp[t].style.display = "") } } else this.Il.style.display = "none", this.wd.style.display = "none", this.kd.style.display = "none", this.Bd.style.display = "none"; if (this.Ic.input.title = S(h.pulseWidth) + "%", d(h.effects) ? (this.ec.style.display = "", this.qp && (this.nc.style.display = ""), Lo(this.Zl, h.transition)) : (this.nc.style.display = "none", this.ec.style.display = "none"), p(h.effects) ? (this.Zc.style.display = "", this.Xc.style.display = h.chord == e.chords.dictionary.arpeggio.index ? "" : "none", this.od.style.display = h.chord == e.chords.dictionary.arpeggio.index && this.Lp ? "" : "none", Lo(this.Qc, h.chord)) : (this.Zc.style.display = "none", this.Xc.style.display = "none", this.od.style.display = "none"), u(h.effects)) { this.Nc.style.display = "", this.Ac.updateValue(h.pitchShift), this.Ac.input.title = h.pitchShift - e.pitchShiftCenter + " semitone(s)"; for (const e of this.qc) e.style.display = t.showFifth ? "" : "none" } else this.Nc.style.display = "none"; m(h.effects) ? (this.Rc.style.display = "", this.zc.updateValue(h.detune - e.detuneCenter), this.zc.input.title = Et.detuneToCents(h.detune) + " cent(s)") : this.Rc.style.display = "none", f(h.effects) ? (this.rd.style.display = "", this.Ap && (this.gd.style.display = ""), Lo(this.hd, h.vibrato)) : (this.gd.style.display = "none", this.rd.style.display = "none"), y(h.effects) ? (this.kc.style.setProperty("--text-color-lit", l.primaryNote), this.kc.style.setProperty("--text-color-dim", l.secondaryNote), this.kc.style.setProperty("--background-color-lit", l.primaryChannel), this.kc.style.setProperty("--background-color-dim", l.secondaryChannel), this.kc.style.display = "", this.xc.render(), h.noteFilterType ? (this.gc.classList.remove("deactivated"), this.vc.classList.add("deactivated"), this.Sc.style.display = "none", this.Cc.style.display = "", this.Tc.style.display = "") : (this.gc.classList.add("deactivated"), this.vc.classList.remove("deactivated"), this.Sc.style.display = "", this.Cc.style.display = "none", this.Tc.style.display = "none")) : (this.Sc.style.display = "none", this.Cc.style.display = "none", this.Tc.style.display = "none", this.kc.style.display = "none"), b(h.effects) ? (this.$c.style.display = "", 0 == h.type || 8 == h.type || 6 == h.type ? this.Vc.style.display = "" : this.Vc.style.display = "none", this.Oc.updateValue(h.distortion)) : (this.$c.style.display = "none", this.Vc.style.display = "none"), g(h.effects) ? (this._c.style.display = "", this.Uc.style.display = "", this.Gc.updateValue(h.bitcrusherQuantization), this.jc.updateValue(h.bitcrusherFreq)) : (this._c.style.display = "none", this.Uc.style.display = "none"), w(h.effects) ? (this.Gl.style.display = "", this.Pp && (this.Ul.style.display = ""), this.Ol.updateValue(h.pan)) : (this.Gl.style.display = "none", this.Ul.style.display = "none"), v(h.effects) ? (this.bl.style.display = "", this.yl.updateValue(h.chorus)) : this.bl.style.display = "none", k(h.effects) ? (this.xl.style.display = "", this.kl.updateValue(h.echoSustain), this.Sl.style.display = "", this.Ml.updateValue(h.echoDelay), this.Ml.input.title = Math.round((h.echoDelay + 1) * e.echoDelayStepTicks / (e.ticksPerPart * e.partsPerBeat) * 1e3) / 1e3 + " beat(s)") : (this.xl.style.display = "none", this.Sl.style.display = "none"), x(h.effects) ? (this.vl.style.display = "", this.wl.updateValue(h.reverb)) : this.vl.style.display = "none", 0 == h.type || 8 == h.type || 5 == h.type || 7 == h.type ? (this.Yc.style.display = "", Lo(this.Jc, h.unison)) : this.Yc.style.display = "none", this.Cd.render(); for (let t = 0; t < e.chords.length; t++) { let i = !e.instrumentTypeHasSpecialInterval[h.type] && e.chords[t].customInterval; const s = this.Qc.children[t]; i ? s.hasAttribute("hidden") || s.setAttribute("hidden", "") : s.removeAttribute("hidden") } this.Gd.style.color = j.getChannelColor(this.l.song, this.l.channel).primaryNote, Lo(this.Zl, h.transition), Lo(this.hd, h.vibrato), Lo(this.yd, h.vibratoType), Lo(this.Qc, h.chord), this.Vl.value = h.pan + "", this.Bc.value = h.detune - e.detuneCenter + "", this.Nl.updateValue(h.volume), this.zl.value = "" + h.volume, this.ld.updateValue(Math.round(25 * h.vibratoDepth)), this.md.updateValue(Math.round(h.vibratoDelay)), this.pd.updateValue(h.vibratoSpeed), Lo(this.yd, h.vibratoType), this.td.updateValue(h.arpeggioSpeed), this._l.updateValue(h.panDelay), this.md.input.title = "" + Math.round(h.vibratoDelay), this.ld.input.title = "" + h.vibratoDepth, this.pd.input.title = "" + h.vibratoSpeed, this._l.input.title = "" + h.panDelay, this.td.input.title = "x" + S(e.arpSpeedScale[h.arpeggioSpeed]), this.mc.updateValue(h.eqFilterSimpleCut), this.yc.updateValue(h.eqFilterSimplePeak), this.Fc.updateValue(h.noteFilterSimpleCut), this.Ec.updateValue(h.noteFilterSimplePeak), 8 == h.type && (this.Ad.redrawCanvas(), this.prompt instanceof ps && this.prompt.customChipCanvas.render()), this._p(n, o, l) } if (this.Gd.style.color = l.primaryNote, this.cc.render(), this.Nl.updateValue(h.volume), this.zc.updateValue(h.detune - e.detuneCenter), this.sd.checked = !!h.fastTwoNoteArp, this.ic.checked = !!h.clicklessTransition, this.Hc.checked = !!h.aliases, this.Rd.disabled = h.envelopeCount >= e.maxEnvelopeCount, this.ol.updateValue(t.volume), a && null != r && 0 == r.clientWidth && this.refocusStage(), this.jp(this.l.prompt), t.autoFollow && !this.l.synth.playing && this.l.synth.goToBar(this.l.bar), this.l.addedEffect) { const t = this.Rd.getBoundingClientRect(), e = this.sp.getBoundingClientRect(), i = this.np.getBoundingClientRect(); this.sp.scrollTop += Math.max(0, t.top - (e.top + e.height)), this.np.scrollTop += Math.max(0, t.top - (i.top + i.height)), this.l.addedEffect = !1 } this.l.addedEnvelope && (this.sp.scrollTop = this.sp.scrollHeight, this.np.scrollTop = this.np.scrollHeight, this.l.addedEnvelope = !1) }, this.updatePlayButton = () => { this.lp == this.l.synth.playing && this.cp == this.l.synth.recording && this.dp == this.l.prefs.showRecordButton && this.pp == this.up || (this.lp = this.l.synth.playing, this.cp = this.l.synth.recording, this.dp = this.l.prefs.showRecordButton, this.pp = this.up, document.activeElement != this.ti && document.activeElement != this.tl && document.activeElement != this.el && document.activeElement != this.il || this.refocusStage(), this.ti.style.display = "none", this.tl.style.display = "none", this.el.style.display = "none", this.il.style.display = "none", this.sl.style.display = "", this.nl.style.display = "", this.ti.classList.remove("shrunk"), this.el.classList.remove("shrunk"), this.Yd.style.pointerEvents = "", this.Zr.container.style.pointerEvents = "", this.Zr.container.style.opacity = "", this.u.style.pointerEvents = "", this.Xr.container.style.opacity = "", this.sp.style.pointerEvents = "", this.sp.style.opacity = "", this.ep.style.pointerEvents = "", this.ep.style.opacity = "", this.ip.style.pointerEvents = "", this.ip.style.opacity = "", this.l.synth.recording ? (this.il.style.display = "", this.sl.style.display = "none", this.nl.style.display = "none", this.Yd.style.pointerEvents = "none", this.Zr.container.style.pointerEvents = "none", this.Zr.container.style.opacity = "0.5", this.u.style.pointerEvents = "none", this.Xr.container.style.opacity = "0.5", this.sp.style.pointerEvents = "none", this.sp.style.opacity = "0.5", this.ep.style.pointerEvents = "none", this.ep.style.opacity = "0.5", this.ip.style.pointerEvents = "none", this.ip.style.opacity = "0.5") : this.l.synth.playing ? this.tl.style.display = "" : this.l.prefs.showRecordButton ? (this.ti.style.display = "", this.el.style.display = "", this.ti.classList.add("shrunk"), this.el.classList.add("shrunk")) : this.up ? this.el.style.display = "" : this.ti.style.display = ""), window.requestAnimationFrame(this.updatePlayButton) }, this.Up = t => !t.ctrlKey || (t.preventDefault(), !1), this.Wp = t => { switch (t.keyCode) { case 8: case 13: case 38: case 40: case 37: case 39: case 48: case 49: case 50: case 51: case 52: case 53: case 54: case 55: case 56: case 57: t.stopPropagation() } }, this.Ne = t => { if (this.up = t.ctrlKey, this.prompt) return (this.prompt instanceof ps || this.prompt instanceof hn || this.prompt instanceof gs) && this.prompt.whenKeyPressed(t), void (27 == t.keyCode && this.l.undo()); if (document.activeElement == this.Nd.input || this.Kr.editingModLabel || document.activeElement == this.Qr.do.input) return void (13 != t.keyCode && 27 != t.keyCode || (this.mainLayer.focus(), this.Kr.stopEditingModLabel(27 == t.keyCode))); if (document.activeElement == this.Vl || document.activeElement == this.Bc || document.activeElement == this.zl) return void (13 != t.keyCode && 27 != t.keyCode || this.mainLayer.focus()); if (this.l.synth.recording) return t.ctrlKey || t.metaKey || this.Ua.handleKeyEvent(t, !0), void ((32 == t.keyCode || 80 == t.keyCode && (t.ctrlKey || t.metaKey)) && (this.Kp(), t.preventDefault(), this.refocusStage())); const i = this.l.prefs.pressControlForShortcuts != t.getModifierState("CapsLock"), s = !t.ctrlKey && !t.metaKey && i; switch (s && this.Ua.handleKeyEvent(t, !0), t.keyCode) { case 27: t.ctrlKey || t.metaKey || (new Pi(this.l, 0, 0), this.l.selection.resetBoxSelection()); break; case 16: this.Kr.shiftMode = !0; break; case 17: this.Kr.controlMode = !0; break; case 32: t.ctrlKey ? this.Kp() : t.shiftKey ? (this.Yr.movePlayheadToMouse() || this.Kr.movePlayheadToMouse()) && (this.l.synth.playing || this.l.performance.play()) : this.togglePlay(), t.preventDefault(), this.refocusStage(); break; case 80: if (s) break; (t.ctrlKey || t.metaKey) && (this.Kp(), t.preventDefault(), this.refocusStage()); break; case 90: if (s) break; t.shiftKey ? this.l.redo() : this.l.undo(), t.preventDefault(); break; case 89: if (s) break; this.l.redo(), t.preventDefault(); break; case 67: if (s) break; t.shiftKey ? this.Jp() : this.l.selection.copy(), this.l.selection.resetBoxSelection(), this.l.selection.selectionUpdated(), t.preventDefault(); break; case 13: t.ctrlKey || t.metaKey ? this.l.selection.insertChannel() : this.l.selection.insertBars(), t.preventDefault(); break; case 8: t.ctrlKey || t.metaKey ? this.l.selection.deleteChannel() : this.l.selection.deleteBars(), this.Br.animatePlayhead(), t.preventDefault(); break; case 65: if (s) break; t.shiftKey ? this.l.selection.selectChannel() : this.l.selection.selectAll(), t.preventDefault(); break; case 68: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.selection.duplicatePatterns(), t.preventDefault()); break; case 69: if (t.shiftKey) { !this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].eqFilterType && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && this.gl("customEQFilterSettings") } break; case 70: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.synth.snapToStart(), this.l.synth.computeLatestModValues(), this.l.prefs.autoFollow && this.l.selection.setChannelBar(this.l.channel, Math.floor(this.l.synth.playhead)), t.preventDefault()); break; case 72: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.synth.goToBar(this.l.bar), this.l.synth.snapToBar(), this.l.synth.computeLatestModValues(), this.l.prefs.autoFollow && this.l.selection.setChannelBar(this.l.channel, Math.floor(this.l.synth.playhead)), t.preventDefault()); break; case 74: if (s) break; t.shiftKey && t.ctrlKey && t.altKey && (this.l.prefs.autoPlay = !1, this.l.prefs.autoFollow = !1, this.l.prefs.enableNotePreview = !0, this.l.prefs.showFifth = !0, this.l.prefs.notesOutsideScale = !1, this.l.prefs.defaultScale = 0, this.l.prefs.showLetters = !0, this.l.prefs.showChannels = !0, this.l.prefs.showScrollBar = !0, this.l.prefs.alwaysFineNoteVol = !1, this.l.prefs.enableChannelMuting = !0, this.l.prefs.displayBrowserUrl = !0, this.l.prefs.displayVolumeBar = !0, this.l.prefs.layout = "wide", this.l.prefs.visibleOctaves = 5, this.l.prefs.save(), t.preventDefault(), location.reload()); break; case 76: if (s) break; t.shiftKey ? this.gl("limiterSettings") : this.gl("barCount"); break; case 77: if (s) break; i == (t.ctrlKey || t.metaKey) && this.l.prefs.enableChannelMuting && (this.l.selection.muteChannels(t.shiftKey), t.preventDefault()); break; case 78: if (s) break; const n = new Pt; if (t.shiftKey) { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; y(t.effects) && !t.noteFilterType && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && this.gl("customNoteFilterSettings"); break } if (t.ctrlKey) { let t = 0; for (; t < this.l.song.patternsPerChannel && this.l.song.channels[this.l.channel].patterns[t].notes.length > 0;)t++; t++, t <= e.barCountMax && (t > this.l.song.patternsPerChannel && n.append(new ei(this.l, t)), n.append(new _t(this.l, t, this.l.bar, this.l.channel, 1, 1))) } else { let t = 1; for (; -1 != this.l.song.channels[this.l.channel].bars.indexOf(t) && t <= this.l.song.patternsPerChannel;)t++; t <= e.barCountMax && (t > this.l.song.patternsPerChannel && n.append(new ei(this.l, t)), n.append(new _t(this.l, t, this.l.bar, this.l.channel, 1, 1))) } this.l.record(n), t.preventDefault(); break; case 81: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.gl("channelSettings"), t.preventDefault()); break; case 83: if (s) break; t.ctrlKey || t.metaKey ? (this.gl("export"), t.preventDefault()) : this.l.prefs.enableChannelMuting && (t.shiftKey ? this.l.selection.muteChannels(!1) : this.l.selection.soloChannels(!1), t.preventDefault()); break; case 79: if (s) break; (t.ctrlKey || t.metaKey) && (this.gl("import"), t.preventDefault()); break; case 86: if (s) break; (t.ctrlKey || t.metaKey) && t.shiftKey && !i ? this.l.selection.pasteNumbers() : t.shiftKey ? this.Yp() : this.l.selection.pasteNotes(), t.preventDefault(); break; case 87: if (s) break; this.gl("moveNotesSideways"); break; case 73: if (s) break; if (i == (t.ctrlKey || t.metaKey) && t.shiftKey) { const i = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].toJsonObject(); delete i.preset, delete i.volume, delete i.pan; const s = i.effects.indexOf(e.effectNames[2]); -1 != s && i.effects.splice(s, 1); for (let t = 0; t < i.envelopes.length; t++) { const e = i.envelopes[t]; "panning" != e.target && "none" != e.target && "none" != e.envelope || (i.envelopes.splice(t, 1), t--) } this.Qp(JSON.stringify(i)), t.preventDefault() } break; case 82: if (s) break; i == (t.ctrlKey || t.metaKey) && (t.shiftKey ? this.Xp() : this.Zp(), t.preventDefault()); break; case 219: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.synth.goToPrevBar(), this.l.prefs.autoFollow && this.l.selection.setChannelBar(this.l.channel, Math.floor(this.l.synth.playhead)), t.preventDefault()); break; case 221: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.synth.goToNextBar(), this.l.prefs.autoFollow && this.l.selection.setChannelBar(this.l.channel, Math.floor(this.l.synth.playhead)), t.preventDefault()); break; case 189: case 173: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.selection.transpose(!1, t.shiftKey), t.preventDefault()); break; case 187: case 61: case 171: if (s) break; i == (t.ctrlKey || t.metaKey) && (this.l.selection.transpose(!0, t.shiftKey), t.preventDefault()); break; case 38: t.ctrlKey || t.metaKey ? this.l.selection.swapChannels(-1) : t.shiftKey ? (this.l.selection.boxSelectionY1 = Math.max(0, this.l.selection.boxSelectionY1 - 1), this.l.selection.scrollToEndOfSelection(), this.l.selection.selectionUpdated()) : (this.l.selection.setChannelBar((this.l.channel - 1 + this.l.song.getChannelCount()) % this.l.song.getChannelCount(), this.l.bar), this.l.selection.resetBoxSelection()), t.preventDefault(); break; case 40: t.ctrlKey || t.metaKey ? this.l.selection.swapChannels(1) : t.shiftKey ? (this.l.selection.boxSelectionY1 = Math.min(this.l.song.getChannelCount() - 1, this.l.selection.boxSelectionY1 + 1), this.l.selection.scrollToEndOfSelection(), this.l.selection.selectionUpdated()) : (this.l.selection.setChannelBar((this.l.channel + 1) % this.l.song.getChannelCount(), this.l.bar), this.l.selection.resetBoxSelection()), t.preventDefault(); break; case 37: t.shiftKey ? (this.l.selection.boxSelectionX1 = Math.max(0, this.l.selection.boxSelectionX1 - 1), this.l.selection.scrollToEndOfSelection(), this.l.selection.selectionUpdated()) : (this.l.selection.setChannelBar(this.l.channel, (this.l.bar + this.l.song.barCount - 1) % this.l.song.barCount), this.l.selection.resetBoxSelection()), t.preventDefault(); break; case 39: t.shiftKey ? (this.l.selection.boxSelectionX1 = Math.min(this.l.song.barCount - 1, this.l.selection.boxSelectionX1 + 1), this.l.selection.scrollToEndOfSelection(), this.l.selection.selectionUpdated()) : (this.l.selection.setChannelBar(this.l.channel, (this.l.bar + 1) % this.l.song.barCount), this.l.selection.resetBoxSelection()), t.preventDefault(); break; case 46: this.l.selection.digits = "", this.l.selection.nextDigit("0", !1, !1); break; case 48: if (s) break; this.l.selection.nextDigit("0", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 49: if (s) break; this.l.selection.nextDigit("1", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 50: if (s) break; this.l.selection.nextDigit("2", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 51: if (s) break; this.l.selection.nextDigit("3", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 52: if (s) break; this.l.selection.nextDigit("4", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 53: if (s) break; this.l.selection.nextDigit("5", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 54: if (s) break; this.l.selection.nextDigit("6", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 55: if (s) break; this.l.selection.nextDigit("7", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 56: if (s) break; this.l.selection.nextDigit("8", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; case 57: if (s) break; this.l.selection.nextDigit("9", i != (t.shiftKey || t.ctrlKey || t.metaKey), t.altKey), this._p(this.l.song.channels[this.l.channel], this.l.getCurrentInstrument(), j.getChannelColor(this.l.song, this.l.channel)), t.preventDefault(); break; default: this.l.selection.digits = "", this.l.selection.instrumentDigits = "" }s && (this.l.selection.digits = "", this.l.selection.instrumentDigits = "") }, this.tu = t => { this.Qr.onKeyUp(t), t.ctrlKey || (this.Kr.controlMode = !1), t.shiftKey || (this.Kr.shiftMode = !1), this.up = t.ctrlKey, this.Ua.handleKeyEvent(t, !1) }, this.eu = () => { this.l.synth.goToPrevBar(), this.Br.animatePlayhead() }, this.iu = () => { this.l.synth.goToNextBar(), this.Br.animatePlayhead() }, this.togglePlay = () => { this.l.synth.playing ? (this.l.performance.pause(), this.outVolumeHistoricCap = 0) : (this.l.synth.snapToBar(), this.l.performance.play()) }, this.Kp = () => { this.l.synth.playing ? this.l.performance.pause() : this.l.performance.record() }, this.su = () => { this.nu(), this.l.prefs.displayVolumeBar && this.zn(), this.Br.animatePlayhead(), this.l.synth.isFilterModActive(!1, this.l.channel, this.l.getCurrentInstrument()) && this.cc.render(!0), this.l.synth.isFilterModActive(!0, this.l.channel, this.l.getCurrentInstrument()) && this.xc.render(!0), window.requestAnimationFrame(this.su) }, this.zn = () => { this.outVolumeHistoricTimer--, this.outVolumeHistoricTimer <= 0 && (this.outVolumeHistoricCap -= .03), this.l.song.outVolumeCap > this.outVolumeHistoricCap && (this.outVolumeHistoricCap = this.l.song.outVolumeCap, this.outVolumeHistoricTimer = 50), this.l.song.outVolumeCap != this.lastOutVolumeCap && (this.lastOutVolumeCap = this.l.song.outVolumeCap, this.ou(this.l.song.outVolumeCap, this.outVolumeHistoricCap)) }, this.hu = () => { this.l.setVolume(Number(this.ol.input.value)) }, this.Jp = () => { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].toJsonObject(); t.isDrum = this.l.song.getChannelIsNoise(this.l.channel), window.localStorage.setItem("instrumentCopy", JSON.stringify(t)), this.refocusStage() }, this.Yp = () => { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], e = JSON.parse(String(window.localStorage.getItem("instrumentCopy"))); null != e && e.isDrum == this.l.song.getChannelIsNoise(this.l.channel) && this.l.record(new Je(this.l, t, e)), this.refocusStage() }, this.au = () => { this.l.record(new gi(this.l, -1, 0 | parseInt(this.fl.value))) }, this.ru = () => { if (isNaN(this.pl.value)) { switch (this.pl.value) { case "forceScale": this.l.selection.forceScale() }this.l.notifier.changed() } else this.l.record(new li(this.l, this.pl.selectedIndex)) }, this.lu = () => { if (isNaN(this.ul.value)) { switch (this.ul.value) { case "detectKey": this.l.record(new ci(this.l)) }this.l.notifier.changed() } else this.l.record(new Ge(this.l, e.keys.length - 1 - this.ul.selectedIndex)) }, this.cu = () => { if (isNaN(this.Fl.value)) { switch (this.Fl.value) { case "forceRhythm": this.l.selection.forceRhythm() }this.l.notifier.changed() } else this.l.record(new We(this.l, this.Fl.selectedIndex)) }, this.du = () => { var t = this; setTimeout((function () { t.mainLayer.focus() }), 20) }, this.pu = () => { this.uu($("#pitchPresetSelect").val() + "") }, this.mu = () => { this.uu($("#drumPresetSelect").val() + "") }, this.fu = () => { this.l.record(new qe(this.l, this.vd.selectedIndex)) }, this.yu = () => { this.l.record(new Le(this.l, this.Tl.selectedIndex)) }, this.bu = t => { if (t.target == this.Al) this.l.record(new Oe(this.l)); else if (t.target == this.Ll) this.l.record(new $e(this.l)); else { const e = this.Pl.indexOf(t.target); -1 != e && this.l.selection.selectInstrument(e), this.l.channel >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount && this.Ao.forceRender(), this._p(this.l.song.channels[this.l.channel], e, j.getChannelColor(this.l.song, this.l.channel)) } this.refocusStage() }, this.gu = t => { let i = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], s = 0 == i.modulators[t] || e.modulators[i.modulators[t]].forSong; this.l.selection.setModChannel(t, this.Rp[t].selectedIndex); const n = Math.max(0, i.modChannels[t]); this.l.song.channels[n].instruments.length > 1 && s && this.Rp[t].selectedIndex >= 2 && this.l.song.channels[n].bars[this.l.bar] > 0 && this.l.selection.setModInstrument(t, this.l.song.channels[n].patterns[this.l.song.channels[n].bars[this.l.bar] - 1].instruments[0]), this.Ao.forceRender() }, this.wu = t => { this.l.selection.setModInstrument(t, this.Op[t].selectedIndex), this.Ao.forceRender() }, this.Hp = (t, e = !1) => { let i = "none"; -1 != this.$p[t].selectedIndex && (i = this.$p[t].children[this.$p[t].selectedIndex].textContent, e ? (this.$p[t].selectedOptions.item(0).style.setProperty("color", "red"), this.$p[t].classList.add("invalidSetting"), this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].invalidModulators[t] = !0) : (this.$p[t].classList.remove("invalidSetting"), this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].invalidModulators[t] = !1)), e || this.l.selection.setModSetting(t, i), this.Ao.forceRender() }, this.vu = t => { this.Rp[t].selectedIndex >= 2 && this.l.selection.setChannelBar(this.Rp[t].selectedIndex - 2, this.l.bar) }, this.ku = () => { const t = this.l.channel, i = this.l.getCurrentInstrument(); if (t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) for (let s = this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; s < this.l.song.channels.length; s++) { const n = this.l.song.channels[s], o = n.bars[this.l.bar]; if (o > 0) { const h = n.patterns[o - 1].instruments[0], a = n.instruments[h]; for (let n = 0; n < e.modCount; n++)if (a.modChannels[n] == t && (a.modInstruments[n] == i || a.modInstruments[n] >= this.l.song.channels[t].instruments.length)) return void this.l.selection.setChannelBar(s, this.l.bar) } } }, this.xu = t => { this.l.selection.setModFilter(t, this.Gp[t].selectedIndex) }, this.Mu = () => { this.l.record(new $i(this.l, this.Wl.selectedIndex)) }, this.Su = () => { this.l.record(new Hi(this.l, this.Kl.selectedIndex)) }, this.Fu = () => { this.l.record(new Vt(this.l, this.Zl.selectedIndex)) }, this.Cu = () => { const t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()], i = t.effects, s = e.effectOrder[this.oc.selectedIndex - 1]; this.l.record(new Gt(this.l, s, null)), this.oc.selectedIndex = 0, t.effects > i && (this.l.addedEffect = !0), this.l.notifier.changed() }, this.Eu = () => { this.l.record(new ie(this.l, this.hd.selectedIndex)) }, this.Tu = () => { this.l.record(new he(this.l, this.yd.selectedIndex)) }, this.Iu = () => { this.l.record(new te(this.l, this.Jc.selectedIndex)) }, this.Pu = () => { this.l.record(new ee(this.l, this.Qc.selectedIndex)) }, this.Au = () => { this.l.record(new Vi(this.l)), this.refocusStage(), this.l.addedEnvelope = !0 }, this.Lu = () => { this.l.prefs.visibleOctaves = Math.max(1, this.l.prefs.visibleOctaves - 1), this.l.prefs.save(), this.l.notifier.changed(), this.refocusStage() }, this.qu = () => { this.l.prefs.visibleOctaves = Math.min(e.pitchOctaves, this.l.prefs.visibleOctaves + 1), this.l.prefs.save(), this.l.notifier.changed(), this.refocusStage() }, this.Du = t => { switch (this.ll.value) { case "new": this.l.goBackToStart(), this.l.song.restoreLimiterDefaults(); for (const t of this.l.song.channels) t.muted = !1, t.name = ""; this.l.record(new ui(this.l, ""), !1, !0); break; case "export": this.gl("export"); break; case "import": this.gl("import"); break; case "copyUrl": this.Qp(new URL("#" + this.l.song.toBase64String(), location.href).href); break; case "shareUrl": navigator.share({ url: new URL("#" + this.l.song.toBase64String(), location.href).href }); break; case "shortenUrl": window.open("https://tinyurl.com/api-create.php?url=" + encodeURIComponent(new URL("#" + this.l.song.toBase64String(), location.href).href)); break; case "viewPlayer": location.href = "player/index.html#song=" + this.l.song.toBase64String(); break; case "copyEmbed": this.Qp(`<iframe width="384" height="60" style="border: none;" src="${new URL("player/index.html#song=" + this.l.song.toBase64String(), location.href).href}"></iframe>`); break; case "songRecovery": this.gl("songRecovery") }this.ll.selectedIndex = 0 }, this.Nu = t => { switch (this.cl.value) { case "undo": this.l.undo(); break; case "redo": this.l.redo(); break; case "copy": this.l.selection.copy(); break; case "insertBars": this.l.selection.insertBars(); break; case "deleteBars": this.l.selection.deleteBars(); break; case "insertChannel": this.l.selection.insertChannel(); break; case "deleteChannel": this.l.selection.deleteChannel(); break; case "pasteNotes": this.l.selection.pasteNotes(); break; case "pasteNumbers": this.l.selection.pasteNumbers(); break; case "transposeUp": this.l.selection.transpose(!0, !1); break; case "transposeDown": this.l.selection.transpose(!1, !1); break; case "selectAll": this.l.selection.selectAll(); break; case "selectChannel": this.l.selection.selectChannel(); break; case "duplicatePatterns": this.l.selection.duplicatePatterns(); break; case "barCount": this.gl("barCount"); break; case "beatsPerBar": this.gl("beatsPerBar"); break; case "moveNotesSideways": this.gl("moveNotesSideways"); break; case "channelSettings": this.gl("channelSettings"); break; case "limiterSettings": this.gl("limiterSettings") }this.cl.selectedIndex = 0 }, this.zu = t => { switch (this.dl.value) { case "autoPlay": this.l.prefs.autoPlay = !this.l.prefs.autoPlay; break; case "autoFollow": this.l.prefs.autoFollow = !this.l.prefs.autoFollow; break; case "enableNotePreview": this.l.prefs.enableNotePreview = !this.l.prefs.enableNotePreview; break; case "showLetters": this.l.prefs.showLetters = !this.l.prefs.showLetters; break; case "showFifth": this.l.prefs.showFifth = !this.l.prefs.showFifth; break; case "notesOutsideScale": this.l.prefs.notesOutsideScale = !this.l.prefs.notesOutsideScale; break; case "setDefaultScale": this.l.prefs.defaultScale = this.l.song.scale; break; case "showChannels": this.l.prefs.showChannels = !this.l.prefs.showChannels; break; case "showScrollBar": this.l.prefs.showScrollBar = !this.l.prefs.showScrollBar; break; case "alwaysFineNoteVol": this.l.prefs.alwaysFineNoteVol = !this.l.prefs.alwaysFineNoteVol; break; case "enableChannelMuting": this.l.prefs.enableChannelMuting = !this.l.prefs.enableChannelMuting; for (const t of this.l.song.channels) t.muted = !1; break; case "displayBrowserUrl": this.l.toggleDisplayBrowserUrl(); break; case "displayVolumeBar": this.l.prefs.displayVolumeBar = !this.l.prefs.displayVolumeBar; break; case "layout": this.gl("layout"); break; case "colorTheme": this.gl("theme"); break; case "recordingSetup": this.gl("recordingSetup") }this.dl.selectedIndex = 0, this.l.notifier.changed(), this.l.prefs.save() }, this.Bu = t => { let i = new Float32Array(64), s = this.Ld.selectedIndex - 1, n = Number.MIN_VALUE, o = Number.MAX_VALUE, h = 0, a = (e.chipWaves[s].samples.length - 1) / 64; for (let t = 0; t < 64; t++)i[t] = (e.chipWaves[s].samples[Math.floor(h)] - e.chipWaves[s].samples[Math.floor(h) + 1]) / a, i[t] < o && (o = i[t]), i[t] > n && (n = i[t]), h += a; for (let t = 0; t < 64; t++)i[t] -= o, i[t] /= n - o, i[t] *= 48, i[t] -= 24, i[t] = Math.ceil(i[t]), this.Ad.newArray[t] = i[t]; this.l.record(new Ot(this.l, i)), this.l.record(new Di(this.l, +this.Nl.input.value, -e.volumeRange / 2 + Math.round(Math.sqrt(e.chipWaves[s].expression) * e.volumeRange / 2))), this.Ld.selectedIndex = 0, this.l.notifier.changed(), this.l.prefs.save() }, this.l.notifier.watch(this.whenUpdated), new kn(this.l), window.addEventListener("resize", this.whenUpdated), window.requestAnimationFrame(this.updatePlayButton), window.requestAnimationFrame(this.su), "share" in navigator || this.ll.removeChild(this.ll.querySelector("[value='shareUrl']")), this.pl.appendChild(Eo({ label: "Edit" }, To({ value: "forceScale" }, "Snap Notes To Scale"))), this.ul.appendChild(Eo({ label: "Edit" }, To({ value: "detectKey" }, "Detect Key"))), this.Fl.appendChild(Eo({ label: "Edit" }, To({ value: "forceRhythm" }, "Snap Notes To Rhythm"))), this.hd.appendChild(To({ hidden: !0, value: 5 }, "custom")), this.Cp = new Array(e.modulators.length), this.Tp = new Array(e.modulators.length), this.wd.appendChild(Mo({ class: "selectRow", style: `color: ${j.secondaryText}; height: 1em; margin-top: 0.5em;` }, Mo({ style: "margin-right: .1em; visibility: hidden;" }, "1."), Mo({ style: "width: 3em; margin-right: .3em;", class: "tip", onclick: () => this.gl("operatorFrequency") }, "Freq:"), Mo({ class: "tip", onclick: () => this.gl("operatorVolume") }, "Volume:"))); for (let t = 0; t < e.operatorCount; t++) { const i = t, s = Mo({ style: "margin-right: 0px; color: " + j.secondaryText + ";" }, t + 1 + ""), n = Po(Fo({ style: "width: 100%;", title: "Frequency" }), e.operatorFrequencies.map((t => t.name))), o = new Bs(So({ type: "range", min: "0", max: e.operatorAmplitudeMax, value: "0", step: "1", title: "Volume" }), this.l, ((t, e) => new Be(this.l, i, t, e)), !1), h = Po(Fo({ style: "width: 100%;", title: "Waveform" }), e.operatorWaves.map((t => t.name))), a = xo({ style: "margin-left:0em; margin-right: 2px; height:1.5em; width: 8px; max-width: 10px; padding: 0px; font-size: 8px;", onclick: () => this.Hl(4, t) }, ""), r = Co({ class: "tip", style: "margin-left: 10px;", onclick: () => this.gl("operatorWaveform") }, "Wave:"), l = new Bs(So({ style: "margin-left: 10px; width: 85%;", type: "range", min: "0", max: e.pwmOperatorWaves.length - 1, value: "0", step: "1", title: "Pulse Width" }), this.l, ((t, e) => new Ne(this.l, i, t, e)), !0), c = Mo({ class: "selectRow" }, r, l.container, Mo({ class: "selectContainer", style: "width: 6em; margin-left: .3em;" }, h)), d = Mo({ class: "operatorRow" }, c), p = Mo({ class: "selectRow" }, s, a, Mo({ class: "selectContainer", style: "width: 3em; margin-right: .3em;" }, n), o.container); this.wd.appendChild(p), this.fp[t] = p, this.yp[t] = o, this.bp[t] = n, this.gp[t] = a, this.vp[t] = r, this.wp[t] = h, this.kp[t] = l, this.xp[t] = c, this.wd.appendChild(d), this.Mp[t] = d, this.Dp[t] = !1, h.addEventListener("change", (() => { this.l.record(new De(this.l, i, h.selectedIndex)) })), n.addEventListener("change", (() => { this.l.record(new ze(this.l, i, n.selectedIndex)) })) } this.Ed.appendChild(Mo({ class: "selectRow" }, Co({ class: "tip", onclick: () => this.gl("drumsetEnvelope") }, "Envelope:"), Co({ class: "tip", onclick: () => this.gl("drumsetSpectrum") }, "Spectrum:"))); for (let t = e.drumCount - 1; t >= 0; t--) { const i = t, s = new ho(this.l, i); s.container.addEventListener("mousedown", this.refocusStage), this.Sp[t] = s; const n = Po(Fo({ style: "width: 100%;", title: "Filter Envelope" }), e.envelopes.map((t => t.name))); this.Fp[t] = n, n.addEventListener("change", (() => { this.l.record(new ue(this.l, i, n.selectedIndex)) })); const o = Mo({ class: "selectRow" }, Mo({ class: "selectContainer", style: "width: 5em; margin-right: .3em;" }, n), this.Sp[t].container); this.Ed.appendChild(o) } this.Ru = [], this.Rp = [], this.Op = [], this.Ou = [], this.$p = [], this.$u = [], this.Gp = [], this.Vp = []; for (let t = 0; t < e.modCount; t++) { let e = Fo({ style: "width: 100%; color: currentColor; text-overflow:ellipsis;" }), i = Fo({ style: "width: 100%; color: currentColor;" }), s = Mo({ class: "operatorRow", style: "height: 1em; margin-bottom: 0.65em;" }, Mo({ class: "tip", style: "width: 10%; max-width: 5.4em;", id: "modChannelText" + t, onclick: () => this.gl("modChannel") }, "Ch:"), Mo({ class: "selectContainer", style: "width: 35%;" }, e), Mo({ class: "tip", style: "width: 1.2em; margin-left: 0.8em;", id: "modInstrumentText" + t, onclick: () => this.gl("modInstrument") }, "Ins:"), Mo({ class: "selectContainer", style: "width: 10%;" }, i)), n = Fo(), o = Fo(), h = Mo({ class: "selectRow", id: "modSettingText" + t, style: "margin-bottom: 0.9em; color: currentColor;" }, Co({ class: "tip", onclick: () => this.gl("modSet") }, "Setting: "), Co({ class: "tip", style: "font-size:x-small;", onclick: () => this.gl("modSetInfo" + t) }, "?"), Mo({ class: "selectContainer" }, n)), a = Mo({ class: "selectRow", id: "modFilterText" + t, style: "margin-bottom: 0.9em; color: currentColor;" }, Co({ class: "tip", onclick: () => this.gl("modFilter" + t) }, "Target: "), Mo({ class: "selectContainer" }, o)), r = B.svg({ style: "transform: translate(0px, 1px);", width: "1.5em", height: "1em", viewBox: "0 0 200 200" }, [B.path({ d: "M90 155 l0 -45 -45 0 c-25 0 -45 -4 -45 -10 0 -5 20 -10 45 -10 l45 0 0 -45 c0 -25 5 -45 10 -45 6 0 10 20 10 45 l0 45 45 0 c25 0 45 5 45 10 0 6 -20 10 -45 10 l -45 0 0 45 c0 25 -4 45 -10 45 -5 0 -10 -20 -10 -45z" }), B.path({ d: "M42 158 c-15 -15 -16 -38 -2 -38 6 0 10 7 10 15 0 8 7 15 15 15 8 0 15 5 15 10 0 14 -23 13 -38 -2z" }), B.path({ d: "M120 160 c0 -5 7 -10 15 -10 8 0 15 -7 15 -15 0 -8 5 -15 10 -15 14 0 13 23 -2 38 -15 15 -38 16 -38 2z" }), B.path({ d: "M32 58 c3 -23 48 -40 48 -19 0 6 -7 11 -15 11 -8 0 -15 7 -15 15 0 8 -5 15 -11 15 -6 0 -9 -10 -7 -22z" }), B.path({ d: "M150 65 c0 -8 -7 -15 -15 -15 -8 0 -15 -4 -15 -10 0 -14 23 -13 38 2 15 15 16 38 2 38 -5 0 -10 -7 -10 -15z" })]); this.Ru.push(s), this.Rp.push(e), this.Op.push(i), this.Ou.push(h), this.$p.push(n), this.$u.push(a), this.Gp.push(o), this.Vp.push(r), this.Td.appendChild(Mo({ style: "margin: 3px 0; font-weight: bold; margin-bottom: 0.7em; text-align: center; color: " + j.secondaryText + "; background: " + j.uiWidgetBackground + ";" }, ["Modulator " + (t + 1), r])), this.Td.appendChild(s), this.Td.appendChild(h), this.Td.appendChild(a) } this.Ac.container.style.setProperty("transform", "translate(0px, 3px)"), this.Ac.container.style.setProperty("width", "100%"), this.ll.addEventListener("change", this.Du), this.cl.addEventListener("change", this.Nu), this.dl.addEventListener("change", this.zu), this.Ld.addEventListener("change", this.Bu), this.fl.addEventListener("change", this.au), this.pl.addEventListener("change", this.ru), this.ul.addEventListener("change", this.lu), this.Fl.addEventListener("change", this.cu), this.Tl.addEventListener("change", this.yu), this.ql.addEventListener("click", this.bu), this.vd.addEventListener("change", this.fu), this.Wl.addEventListener("change", this.Mu), this.Kl.addEventListener("change", this.Su), this.Zl.addEventListener("change", this.Fu), this.oc.addEventListener("change", this.Cu), this.Jc.addEventListener("change", this.Iu), this.Qc.addEventListener("change", this.Pu), this.hd.addEventListener("change", this.Eu), this.yd.addEventListener("change", this.Tu), this.ti.addEventListener("click", this.togglePlay), this.tl.addEventListener("click", this.togglePlay), this.el.addEventListener("click", this.Kp), this.il.addEventListener("click", this.Kp), this.el.addEventListener("contextmenu", (t => { t.ctrlKey && (t.preventDefault(), this.Kp()) })), this.il.addEventListener("contextmenu", (t => { t.ctrlKey && (t.preventDefault(), this.Kp()) })), this.sl.addEventListener("click", this.eu), this.nl.addEventListener("click", this.iu), this.ol.input.addEventListener("input", this.hu), this.Kd.addEventListener("click", this.Lu), this.Jd.addEventListener("click", this.qu), this.Qd.addEventListener("mousedown", this.zp), this.tp.addEventListener("mousedown", this.refocusStage), this.ol.container.style.setProperty("flex-grow", "1"), this.ol.container.style.setProperty("display", "flex"), this.al.style.setProperty("flex-grow", "1"), this.al.style.setProperty("display", "flex"), this.ol.container.style.setProperty("--mod-color", j.multiplicativeModSlider), this.ol.container.style.setProperty("--mod-border-radius", "50%"), this.Nl.container.style.setProperty("--mod-color", j.multiplicativeModSlider), this.Nl.container.style.setProperty("--mod-border-radius", "50%"), this.zd.container.style.setProperty("--mod-color", j.multiplicativeModSlider), this.zd.container.style.setProperty("--mod-border-radius", "50%"); for (let t = 0; t < e.operatorCount; t++)this.yp[t].container.style.setProperty("--mod-color", j.multiplicativeModSlider), this.yp[t].container.style.setProperty("--mod-border-radius", "50%"); let i = this; for (let t = 0; t < e.modCount; t++)this.Rp[t].addEventListener("change", (function () { i.gu(t) })), this.Op[t].addEventListener("change", (function () { i.wu(t) })), this.$p[t].addEventListener("change", (function () { i.Hp(t) })), this.Gp[t].addEventListener("change", (function () { i.xu(t) })), this.Vp[t].addEventListener("click", (function () { i.vu(t) })); if (this.Ud.addEventListener("click", (function () { i.ku() })), this.Qd.addEventListener("mousedown", this.refocusStage), this.Ql.container.addEventListener("mousedown", this.refocusStage), this.xd.container.addEventListener("mousedown", this.refocusStage), this.cc.container.addEventListener("mousedown", this.refocusStage), this.xc.container.addEventListener("mousedown", this.refocusStage), this.Sd.container.addEventListener("mousedown", this.refocusStage), this.fl.addEventListener("keydown", this.Wp, !1), this.Rd.addEventListener("click", this.Au), this.Qd.addEventListener("contextmenu", this.Up), this.tp.addEventListener("contextmenu", this.Up), this.mainLayer.addEventListener("keydown", this.Ne), this.mainLayer.addEventListener("keyup", this.tu), this.mainLayer.addEventListener("focusin", this.Np), this.Id.addEventListener("click", this.Jp.bind(this)), this.Pd.addEventListener("click", this.Yp.bind(this)), this.zl.addEventListener("input", (() => { this.l.record(new Di(this.l, this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].volume, Math.min(25, Math.max(-25, Math.round(+this.zl.value))))) })), this.Vl.addEventListener("input", (() => { this.l.record(new Bi(this.l, this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].pan, Math.min(100, Math.max(0, Math.round(+this.Vl.value))))) })), this.Bc.addEventListener("input", (() => { this.l.record(new be(this.l, this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()].detune, Math.min(e.detuneMax - e.detuneCenter, Math.max(e.detuneMin - e.detuneCenter, Math.round(+this.Bc.value))))) })), this.Dd.addEventListener("input", (() => { this.l.record(new Ot(this.l, this.Ad.newArray)) })), this.sd.addEventListener("input", (() => { this.l.record(new re(this.l, this.sd.checked)) })), this.ic.addEventListener("input", (() => { this.l.record(new le(this.l, this.ic.checked)) })), this.Hc.addEventListener("input", (() => { this.l.record(new ce(this.l, this.Hc.checked)) })), this.Wd.addEventListener("click", (t => { t.target == this.Wd && this.l.undo() })), M) { const t = this.dl.querySelector("[value=autoPlay]"); t.disabled = !0, t.setAttribute("hidden", "") } if (window.screen.availWidth < 710) { const t = this.dl.querySelector("[value=layout]"); t.disabled = !0, t.setAttribute("hidden", "") } } Hl(t, i = 0) { let s = this.ad, n = this.gd; switch (t) { case 0: s = this.ad, this.Ap = !this.Ap, n = this.gd; break; case 1: s = this.$l, this.Pp = !this.Pp, n = this.Ul; break; case 2: s = this.Xc, this.Lp = !this.Lp, n = this.od; break; case 3: s = this.tc, this.qp = !this.qp, n = this.nc; break; case 4: s = this.gp[i], this.Dp[i] = !this.Dp[i], n = this.Mp[i] }if ("" == s.textContent) { let t = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; s.textContent = "", (n != this.od || t.chord == e.chords.dictionary.arpeggio.index) && (n.style.display = "") } else s.textContent = "", n.style.display = "none" } nu() { if (this.l.synth.playing) { let i = this.l.getCurrentInstrument(); const s = this.l.synth.isAnyModActive(this.l.channel, i); if (s) { let i = this.l.getCurrentInstrument(); function t(t, i, s, n, o) { if (t.l.synth.isModActive(s, n, o)) { let h = (t.l.synth.getModValue(s, n, o, !1) - e.modulators[s].convertRealFactor) / e.modulators[s].maxRawVol; return h != t.Tp[s] && (t.Tp[s] = h, i.container.style.setProperty("--mod-position", 96 * h + 2 + "%")), !0 } return !1 } for (let s = 0; s < e.modulators.length; s++) { this.Ep[s] = this.Cp[s]; let e = this.Hu(s); null != e && (this.Ep[s] = t(this, e, s, this.l.channel, i)) } } else if (this.Ip) for (let t = 0; t < e.modulators.length; t++)this.Ep[t] = !1; if (s || this.Ip) { let t = !1; for (let i = 0; i < e.modulators.length; i++) { if (this.Ep[i] != this.Cp[i]) { this.Cp[i] = this.Ep[i]; let t = this.Hu(i); null != t && (1 == this.Cp[i] ? t.container.classList.add("modSlider") : t.container.classList.remove("modSlider")) } 1 == this.Ep[i] && (t = !0) } this.Ip = t } } else { this.Ip = !1; for (let t = 0; t < e.modulators.length; t++)if (1 == this.Cp[t]) { this.Cp[t] = !1, this.Ep[t] = !1; let e = this.Hu(t); null != e && e.container.classList.remove("modSlider") } } } Hu(t) { switch (t) { case e.modulators.dictionary.pan.index: return this.Ol; case e.modulators.dictionary.detune.index: return this.zc; case e.modulators.dictionary["fm slider 1"].index: return this.yp[0]; case e.modulators.dictionary["fm slider 2"].index: return this.yp[1]; case e.modulators.dictionary["fm slider 3"].index: return this.yp[2]; case e.modulators.dictionary["fm slider 4"].index: return this.yp[3]; case e.modulators.dictionary["fm feedback"].index: return this.zd; case e.modulators.dictionary["pulse width"].index: return this.Ic; case e.modulators.dictionary.reverb.index: return this.wl; case e.modulators.dictionary.distortion.index: return this.Oc; case e.modulators.dictionary["note volume"].index: return this.Cp[e.modulators.dictionary["mix volume"].index] ? null : this.Nl; case e.modulators.dictionary["mix volume"].index: return this.Nl; case e.modulators.dictionary["vibrato depth"].index: return this.ld; case e.modulators.dictionary["vibrato speed"].index: return this.pd; case e.modulators.dictionary["vibrato delay"].index: return this.md; case e.modulators.dictionary["arp speed"].index: return this.td; case e.modulators.dictionary["pan delay"].index: return this._l; case e.modulators.dictionary.tempo.index: return this.ml; case e.modulators.dictionary["song volume"].index: return this.ol; case e.modulators.dictionary["eq filt cut"].index: return this.mc; case e.modulators.dictionary["eq filt peak"].index: return this.yc; case e.modulators.dictionary["note filt cut"].index: return this.Fc; case e.modulators.dictionary["note filt peak"].index: return this.Ec; case e.modulators.dictionary["bit crush"].index: return this.Gc; case e.modulators.dictionary["freq crush"].index: return this.jc; case e.modulators.dictionary["pitch shift"].index: return this.Ac; case e.modulators.dictionary.chorus.index: return this.yl; case e.modulators.dictionary.echo.index: return this.kl; case e.modulators.dictionary["echo delay"].index: return this.Ml; case e.modulators.dictionary.sustain.index: return this.Wc; default: return null } } gl(t) { this.l.openPrompt(t), this.jp(t) } jp(t) { if (this.hp != t && (this.hp = t, this.prompt && (this.op && !(this.prompt instanceof wo || this.prompt instanceof hn || this.prompt instanceof ps || this.prompt instanceof gs) && this.l.performance.play(), this.op = !1, this.Wd.style.display = "none", this.Wd.removeChild(this.prompt.container), this.prompt.cleanUp(), this.prompt = null, this.refocusStage()), t)) { switch (t) { case "export": this.prompt = new Ls(this.l); break; case "import": this.prompt = new _s(this.l); break; case "songRecovery": this.prompt = new Jn(this.l); break; case "barCount": this.prompt = new Dn(this.l); break; case "beatsPerBar": this.prompt = new ts(this.l); break; case "moveNotesSideways": this.prompt = new yn(this.l); break; case "channelSettings": this.prompt = new as(this.l); break; case "limiterSettings": this.prompt = new hn(this.l, this); break; case "customChipSettings": this.prompt = new ps(this.l, this); break; case "customEQFilterSettings": this.prompt = new gs(this.l, this, !1); break; case "customNoteFilterSettings": this.prompt = new gs(this.l, this, !0); break; case "theme": this.prompt = new uo(this.l); break; case "layout": this.prompt = new Qs(this.l); break; case "recordingSetup": this.prompt = new oo(this.l); break; default: this.prompt = new wo(this.l, t) }this.prompt && (this.prompt instanceof wo || this.prompt instanceof hn || this.prompt instanceof ps || this.prompt instanceof gs || (this.op = this.l.synth.playing, this.l.performance.pause()), this.Wd.style.display = "", this.Wd.appendChild(this.prompt.container)) } } changeBarScrollPos(t) { this.Br.changePos(t) } _p(t, i, s) { if (this.l.song.layeredInstruments || this.l.song.patternInstruments) { this.Dl.style.display = "", this.ql.style.setProperty("--text-color-lit", s.primaryNote), this.ql.style.setProperty("--text-color-dim", s.secondaryNote), this.ql.style.setProperty("--background-color-lit", s.primaryChannel), this.ql.style.setProperty("--background-color-dim", s.secondaryChannel); const n = this.l.song.getMaxInstrumentsPerChannel(); for (; this.Pl.length < t.instruments.length;) { const t = xo(String(this.Pl.length + 1)); this.Pl.push(t), this.ql.insertBefore(t, this.Ll) } for (let e = this.rp; e < t.instruments.length; e++)this.Pl[e].style.display = ""; for (let e = t.instruments.length; e < this.rp; e++)this.Pl[e].style.display = "none"; for (this.rp = t.instruments.length; this.Pl.length > n;)this.ql.removeChild(this.Pl.pop()); if (this.Ll.style.display = t.instruments.length > e.instrumentCountMin ? "" : "none", this.Al.style.display = t.instruments.length < n ? "" : "none", t.instruments.length < n ? this.Ll.classList.remove("last-button") : this.Ll.classList.add("last-button"), t.instruments.length > 1) { if (this.ap != i) { const t = this.Pl[this.ap]; null != t && t.classList.remove("selected-instrument"); this.Pl[i].classList.add("selected-instrument"), this.ap = i } } else { const t = this.Pl[this.ap]; null != t && t.classList.remove("selected-instrument"), this.ap = -1 } if (this.l.song.layeredInstruments && this.l.song.patternInstruments && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) { for (let e = 0; e < t.instruments.length; e++)-1 != this.l.recentPatternInstruments[this.l.channel].indexOf(e) ? this.Pl[e].classList.remove("deactivated") : this.Pl[e].classList.add("deactivated"); this.mp = !0 } else if (this.mp || this.l.channel >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) { for (let e = 0; e < t.instruments.length; e++)this.Pl[e].classList.remove("deactivated"); this.mp = !1 } if (this.l.song.layeredInstruments && this.l.song.patternInstruments && t.instruments.length > 1 && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) for (let e = 0; e < t.instruments.length; e++)this.Pl[e].classList.remove("no-underline"); else for (let e = 0; e < t.instruments.length; e++)this.Pl[e].classList.add("no-underline") } else this.Dl.style.display = "none" } Bp(t, i) { var s = !1, n = !1, o = !1; const h = this.l.song.channels[t]; if (t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) for (let s = this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; s < this.l.song.channels.length; s++) { const n = this.l.song.channels[s], a = n.bars[this.l.bar]; if (a > 0) { const s = n.patterns[a - 1].instruments[0], r = n.instruments[s]; for (let s = 0; s < e.modCount; s++)r.modChannels[s] == t && (r.modInstruments[s] == i || r.modInstruments[s] >= h.instruments.length) && (o = !0) } } if (0 != h.bars[this.l.bar]) { let t = Math.min(this.l.selection.boxSelectionX0, this.l.selection.boxSelectionX1), e = Math.max(this.l.selection.boxSelectionX0, this.l.selection.boxSelectionX1), o = Math.min(this.l.selection.boxSelectionY0, this.l.selection.boxSelectionY1), a = Math.max(this.l.selection.boxSelectionY0, this.l.selection.boxSelectionY1); for (let i = 0; i < this.l.song.barCount; i++)h.bars[i] == h.bars[this.l.bar] && i != this.l.bar && (i < t || i > e || this.l.channel < o || this.l.channel > a) && (n = !0, i = this.l.song.barCount); for (let n = 0; n < this.l.song.barCount; n++)0 != h.bars[n] && h.bars[n] != h.bars[this.l.bar] && h.patterns[h.bars[n] - 1].instruments.includes(i) && n != this.l.bar && (n < t || n > e || this.l.channel < o || this.l.channel > a) && (s = !0, n = this.l.song.barCount) } n ? this._d.style.setProperty("fill", j.indicatorPrimary) : this._d.style.setProperty("fill", j.indicatorSecondary), s ? this.jd.style.setProperty("fill", j.indicatorPrimary) : this.jd.style.setProperty("fill", j.indicatorSecondary), o ? (this.Ud.style.setProperty("display", ""), this.Ud.style.setProperty("fill", j.indicatorPrimary), this.Ud.classList.add("modTarget")) : t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount ? (this.Ud.style.setProperty("display", ""), this.Ud.style.setProperty("fill", j.indicatorSecondary), this.Ud.classList.remove("modTarget")) : this.Ud.style.setProperty("display", "none") } Qp(t) { let e; if (e = navigator, e.clipboard && e.clipboard.writeText) return void e.clipboard.writeText(t).catch((() => { window.prompt("Copy to clipboard:", t) })); const i = document.createElement("textarea"); i.textContent = t, document.body.appendChild(i), i.select(); const s = document.execCommand("copy"); i.remove(), this.refocusStage(), s || window.prompt("Copy this:", t) } ou(t, e) { this.En.setAttribute("width", "" + Math.min(144, 144 * t)), this.Tn.setAttribute("x", "" + (8 + Math.min(144, 144 * e))) } ac(t) { const e = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; e.eqFilterType != t && this.l.record(new xe(this.l, e, t)) } wc(t) { const e = this.l.song.channels[this.l.channel].instruments[this.l.getCurrentInstrument()]; e.noteFilterType != t && this.l.record(new Me(this.l, e, t)) } Zp() { const t = this.l.song.getChannelIsNoise(this.l.channel); this.l.record(new $t(this.l, di(t))) } Xp() { this.l.record(new Ht(this.l)) } uu(t) { if (isNaN(t)) { switch (t) { case "copyInstrument": this.Jp(); break; case "pasteInstrument": this.Yp(); break; case "randomPreset": this.Zp(); break; case "randomGenerated": this.Xp() }this.l.notifier.changed() } else this.l.record(new $t(this.l, parseInt(t))) } } class No { constructor(t) { this.l = t, this.Vu = !1, this.Gu = -1, this._u = -1, this.ju = !1, this.Uu = [], this.Wu = -1, this.Ku = -1, this.Ju = null, this.Yu = !1, this.Qu = null, this.Xu = null, this.Ra = () => { if (window.requestAnimationFrame(this.Ra), this.l.synth.recording) { this.Zu() && this.l.notifier.notifyWatchers() } }, this.no = () => { const t = this.l.song.getChannelIsNoise(this.l.channel), e = this.l.song.channels[this.l.channel].octave; this.l.synth.liveInputChannel == this.l.channel && this.Vu == t && this.Gu == e && this._u == this.l.song.key || (this.l.synth.liveInputChannel = this.l.channel, this.Vu = t, this.Gu = e, this._u = this.l.song.key, this.clearAllPitches()), this.l.synth.liveInputInstruments = this.l.recentPatternInstruments[this.l.channel] }, this.l.notifier.watch(this.no), this.no(), window.requestAnimationFrame(this.Ra) } play() { this.l.synth.play(), this.l.synth.enableMetronome = !1, this.l.synth.countInMetronome = !1, this.l.synth.maintainLiveInput() } pause() { this.clearAllPitches(), null != this.Xu && (this.l.song.barCount > this.Wu && !this.tm() && (new Wt(this.l, this.l.song.barCount - 1, 1), new Zt(this.l, this.l.channel, this.l.song.barCount - 1)), this.Xu.isNoop() || (this.l.record(this.Xu), this.Xu = null), this.Qu = null), this.l.synth.pause(), this.l.synth.resetEffects(), this.l.synth.enableMetronome = !1, this.l.synth.countInMetronome = !1, this.l.prefs.autoFollow && this.l.synth.goToBar(this.l.bar), this.l.synth.snapToBar() } record() { this.l.synth.snapToBar(); const t = Math.floor(this.l.synth.playhead); t != this.l.bar && new Zt(this.l, this.l.channel, t), this.ju && (this.clearAllPitches(), this.ju = !1), this.l.synth.enableMetronome = this.l.prefs.metronomeWhileRecording, this.l.synth.countInMetronome = this.l.prefs.metronomeCountIn, this.l.synth.startRecording(), this.l.synth.maintainLiveInput(), this.Wu = this.l.song.barCount, this.Ku = this.im(), this.Ju = null, this.Yu = !1, this.Qu = null, this.Uu.length = 0, this.Xu = new Pt, this.l.setProspectiveChange(this.Xu) } abortRecording() { this.Xu = null, this.pause() } pitchesAreTemporary() { return this.ju } ha() { return this.l.prefs.snapRecordedNotesToRhythm ? e.partsPerBeat / e.rhythms[this.l.song.rhythm].stepsPerBeat : 1 } im() { const t = this.l.synth.playhead * this.l.song.beatsPerBar * e.partsPerBeat; if (this.l.prefs.snapRecordedNotesToRhythm) { const e = this.ha(); return Math.round(t / e) * e } return Math.round(t) } tm() { for (let t = 0; t < this.l.song.getChannelCount(); t++)if (0 != this.l.song.channels[t].bars[this.l.song.barCount - 1]) return !0; return !1 } Zu() { if (null == this.Xu) return !1; if (!this.l.lastChangeWas(this.Xu)) return this.abortRecording(), !1; if (this.l.synth.countInMetronome) return this.Uu.length = 0, this.Yu = !1, !1; const t = this.l.song.beatsPerBar * e.partsPerBeat, i = this.Ku % t, s = Math.floor(this.Ku / t), n = this.Ku; this.Ku = this.im(); const o = this.Ku % t, h = Math.floor(this.Ku / t); if (i == o && s == h) return !1; if (this.Ku < n) return this.Qu = null, this.Ju = null, !1; let a = !1; for (let n = s; n <= h; n++) { n != s && (this.Ju = null); const r = n == s ? i : 0, l = n == h ? o : t; if (r == l) break; if (null != this.Qu && !this.Yu && r > 0 && this.l.synth.liveInputPitches.length > 0) this.Xu.append(new si(this.l, this.Qu, 1, l, this.Qu.continuesLastPattern)), this.l.currentPatternIsDirty = !0; else { null != this.Qu && (this.Qu = null); let t = r, i = l; for (; t < l;) { let s = !1; if (this.Uu.length > 0 || this.l.synth.liveInputPitches.length > 0) { if (null == this.Ju && (this.l.selection.erasePatternInBar(this.Xu, this.l.synth.liveInputChannel, n), this.Xu.append(new ii(this.l, this.l.synth.liveInputChannel, n)), this.Ju = this.l.song.getPattern(this.l.synth.liveInputChannel, n)), null == this.Ju) throw new Error; for (this.Qu = new lt(-1, t, i, e.noteSizeMax, this.l.song.getChannelIsNoise(this.l.synth.liveInputChannel)), this.Qu.continuesLastPattern = 0 == t && !this.Yu, this.Qu.pitches.length = 0; this.Uu.length > 0 && !(this.Qu.pitches.length >= e.maxChordSize);) { const t = this.Uu.shift(); -1 == this.l.synth.liveInputPitches.indexOf(t) && (this.Qu.pitches.push(t), s = !0) } for (let t = 0; t < this.l.synth.liveInputPitches.length && !(this.Qu.pitches.length >= e.maxChordSize); t++)this.Qu.pitches.push(this.l.synth.liveInputPitches[t]); this.Xu.append(new Mi(this.l, this.Ju, this.Qu, this.Ju.notes.length)), s && (i = t + this.ha(), new Si(this.l, this.Qu, this.Qu.start, i), this.Qu = null), a = !0 } this.Yu = s, t = i, i = l } } n == this.l.song.barCount - 1 && this.tm() && (new Ut(this.l, this.l.song.barCount, 1), this.l.bar--, a = !0) } return a } setTemporaryPitches(t, i) { this.Zu(); for (let e = 0; e < t.length; e++)this.l.synth.liveInputPitches[e] = t[e]; this.l.synth.liveInputPitches.length = Math.min(t.length, e.maxChordSize), this.l.synth.liveInputDuration = i, this.l.synth.liveInputStarted = !0, this.ju = !0, this.Yu = !0 } addPerformedPitch(t) { if (this.l.synth.maintainLiveInput(), this.Zu(), this.ju && (this.clearAllPitches(), this.ju = !1), (!this.l.prefs.ignorePerformedNotesNotInScale || e.scales[this.l.song.scale].flags[t % e.pitchesPerOctave]) && -1 == this.l.synth.liveInputPitches.indexOf(t)) { for (this.l.synth.liveInputPitches.push(t), this.Yu = !0; this.l.synth.liveInputPitches.length > e.maxChordSize;)this.l.synth.liveInputPitches.shift(); if (this.l.synth.liveInputDuration = Number.MAX_SAFE_INTEGER, null != this.Xu) { const i = this.Uu.indexOf(t); for (-1 != i && this.Uu.splice(i, 1), this.Uu.push(t); this.Uu.length > 4 * e.maxChordSize;)this.Uu.shift() } } } removePerformedPitch(t) { this.Zu(); for (let e = 0; e < this.l.synth.liveInputPitches.length; e++)this.l.synth.liveInputPitches[e] == t && (this.l.synth.liveInputPitches.splice(e, 1), this.Yu = !0, e--) } clearAllPitches() { this.Zu(), this.l.synth.liveInputPitches.length = 0, this.Yu = !0 } } class zo { constructor(t) { this.l = t, this.boxSelectionX0 = 0, this.boxSelectionY0 = 0, this.boxSelectionX1 = 0, this.boxSelectionY1 = 0, this.digits = "", this.instrumentDigits = "", this.patternSelectionStart = 0, this.patternSelectionEnd = 0, this.patternSelectionActive = !1, this.sm = null, this.nm = null, this.om = null, this.hm = null } toJSON() { return { x0: this.boxSelectionX0, x1: this.boxSelectionX1, y0: this.boxSelectionY0, y1: this.boxSelectionY1, start: this.patternSelectionStart, end: this.patternSelectionEnd } } fromJSON(t) { null != t && (this.boxSelectionX0 = +t.x0, this.boxSelectionX1 = +t.x1, this.boxSelectionY0 = +t.y0, this.boxSelectionY1 = +t.y1, this.patternSelectionStart = +t.start, this.patternSelectionEnd = +t.end, this.digits = "", this.instrumentDigits = "", this.patternSelectionActive = this.patternSelectionStart < this.patternSelectionEnd) } selectionUpdated() { this.l.notifier.changed(), this.digits = "", this.instrumentDigits = "" } get boxSelectionBar() { return Math.min(this.boxSelectionX0, this.boxSelectionX1) } get boxSelectionChannel() { return Math.min(this.boxSelectionY0, this.boxSelectionY1) } get boxSelectionWidth() { return Math.abs(this.boxSelectionX0 - this.boxSelectionX1) + 1 } get boxSelectionHeight() { return Math.abs(this.boxSelectionY0 - this.boxSelectionY1) + 1 } get boxSelectionActive() { return this.boxSelectionWidth > 1 || this.boxSelectionHeight > 1 } scrollToSelectedPattern() { this.l.barScrollPos = Math.min(this.l.bar, Math.max(this.l.bar - (this.l.trackVisibleBars - 1), this.l.barScrollPos)), this.l.channelScrollPos = Math.min(this.l.channel, Math.max(this.l.channel - (this.l.trackVisibleChannels - 1), this.l.channelScrollPos)) } scrollToEndOfSelection() { this.l.barScrollPos = Math.min(this.boxSelectionX1, Math.max(this.boxSelectionX1 - (this.l.trackVisibleBars - 1), this.l.barScrollPos)), this.l.channelScrollPos = Math.min(this.boxSelectionY1, Math.max(this.boxSelectionY1 - (this.l.trackVisibleChannels - 1), this.l.channelScrollPos)) } setChannelBar(t, e) { if (t == this.l.channel && e == this.l.bar) return; const i = this.l.lastChangeWas(this.nm); this.nm = new Pt, this.nm.append(new Zt(this.l, t, e)); const s = this.l.getCurrentPattern(0); null != s && s.instruments.indexOf(this.l.viewedInstrument[this.l.channel]) < 0 && (this.l.viewedInstrument[this.l.channel] = s.instruments[0]), this.l.hasRedoHistory() || this.l.record(this.nm, i), this.selectionUpdated() } setPattern(t) { this.l.record(new _t(this.l, t, this.boxSelectionBar, this.boxSelectionChannel, this.boxSelectionWidth, this.boxSelectionHeight)) } nextDigit(t, e, i) { if (i) "3" == t ? this.l.record(new We(this.l, 0)) : "4" == t ? this.l.record(new We(this.l, 1)) : "6" == t ? this.l.record(new We(this.l, 2)) : "8" == t ? this.l.record(new We(this.l, 3)) : "0" != t && "1" != t || this.l.record(new We(this.l, 4)); else if (e) { "0" == t && (t = "10"), this.instrumentDigits += t; var s = parseInt(this.instrumentDigits); if (0 != s && s <= this.l.song.channels[this.l.channel].instruments.length) return void this.selectInstrument(s - 1); if (this.instrumentDigits = t, 0 != (s = parseInt(this.instrumentDigits)) && s <= this.l.song.channels[this.l.channel].instruments.length) return void this.selectInstrument(s - 1); this.instrumentDigits = "" } else { this.digits += t; let e = parseInt(this.digits); if (e <= this.l.song.patternsPerChannel) return void this.setPattern(e); if (this.digits = t, e = parseInt(this.digits), e <= this.l.song.patternsPerChannel) return void this.setPattern(e); this.digits = "" } } setModChannel(t, e) { this.l.record(new Qe(this.l, t, e)) } setModInstrument(t, e) { this.l.record(new Xe(this.l, t, e)) } setModSetting(t, e) { this.l.record(new Ze(this.l, t, e)) } setModFilter(t, e) { this.l.record(new ti(this.l, t, e)) } insertBars() { this.l.record(new Ut(this.l, this.boxSelectionBar + this.boxSelectionWidth, this.boxSelectionWidth)); const t = this.boxSelectionWidth; this.boxSelectionX0 += t, this.boxSelectionX1 += t } insertChannel() { const t = new Pt, e = this.boxSelectionChannel + this.boxSelectionHeight, i = this.l.song.getChannelIsNoise(e - 1), s = this.l.song.getChannelIsMod(e - 1); t.append(new Qt(this.l, e, i, s)), t.isNoop() || (this.boxSelectionY0 = this.boxSelectionY1 = e, t.append(new Zt(this.l, e, this.l.bar)), this.l.record(t)) } deleteBars() { const t = new Pt; if (this.l.selection.patternSelectionActive) { this.boxSelectionActive && t.append(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)); for (const e of this.am()) for (const i of this.rm(e)) t.append(new Fi(this.l, i, this.l.selection.patternSelectionStart, this.l.selection.patternSelectionEnd)); t.append(new Pi(this.l, 0, 0)) } else { t.append(new Wt(this.l, this.boxSelectionBar, this.boxSelectionWidth)); const e = this.boxSelectionWidth; this.boxSelectionX0 = Math.max(0, this.boxSelectionX0 - e), this.boxSelectionX1 = Math.max(0, this.boxSelectionX1 - e) } this.l.record(t) } deleteChannel() { this.l.record(new Xt(this.l, this.boxSelectionChannel, this.boxSelectionChannel + this.boxSelectionHeight - 1)), this.boxSelectionY0 = this.boxSelectionY1 = this.l.channel, j.resetColors() } *am() { for (let t = this.boxSelectionChannel; t < this.boxSelectionChannel + this.boxSelectionHeight; t++)yield t } *lm() { for (let t = this.boxSelectionBar; t < this.boxSelectionBar + this.boxSelectionWidth; t++)yield t } *rm(t) { const e = {}; for (const i of this.lm()) { const s = this.l.song.channels[t].bars[i]; if (0 == s) continue; if (e[String(s)]) continue; e[String(s)] = !0; const n = this.l.song.getPattern(t, i); if (null == n) throw new Error; yield n } } dm(t, e) { const i = Array.from(t.instruments).map((t => t >>> 0)); return qt(i, this.l.song, e), i } pm(t, e) { for (let i = 0; i < this.l.song.barCount; i++)if (this.l.song.channels[t].bars[i] == e) return !1; return !0 } copy() { const t = []; for (const e of this.am()) { const i = {}, s = []; for (const t of this.lm()) { const n = this.l.song.channels[e].bars[t]; if (s.push(n), null == i[String(n)]) { const s = this.l.song.getPattern(e, t); let o = this.l.recentPatternInstruments[e], h = []; if (null != s) if (o = s.instruments.concat(), this.patternSelectionActive) for (const t of s.cloneNotes()) t.end <= this.patternSelectionStart || t.start >= this.patternSelectionEnd || (t.start -= this.patternSelectionStart, t.end -= this.patternSelectionStart, (t.start < 0 || t.end > this.patternSelectionEnd - this.patternSelectionStart) && new Si(null, t, Math.max(t.start, 0), Math.min(this.patternSelectionEnd - this.patternSelectionStart, t.end)), h.push(t)); else h = s.notes; i[String(n)] = { instruments: o, notes: h } } } const n = { isNoise: this.l.song.getChannelIsNoise(e), isMod: this.l.song.getChannelIsMod(e), patterns: i, bars: s }; t.push(n) } const i = { partDuration: this.patternSelectionActive ? this.patternSelectionEnd - this.patternSelectionStart : this.l.song.beatsPerBar * e.partsPerBeat, channels: t }; window.localStorage.setItem("selectionCopy", JSON.stringify(i)), new Pi(this.l, 0, 0) } pasteNotes() { const t = JSON.parse(String(window.localStorage.getItem("selectionCopy"))); if (null == t) return; const i = t.channels || [], s = t.partDuration >>> 0, n = new Pt, o = this.boxSelectionWidth > 1 || this.boxSelectionHeight > 1, h = o ? this.boxSelectionHeight : Math.min(i.length, this.l.song.getChannelCount() - this.boxSelectionChannel); for (let t = 0; t < h; t++) { const a = i[t % i.length], r = this.boxSelectionChannel + t, l = !!a.isNoise, c = !!a.isMod, d = a.patterns || {}, p = a.bars || []; if (0 == p.length) continue; if (l != this.l.song.getChannelIsNoise(r)) continue; if (c != this.l.song.getChannelIsMod(r)) continue; const u = o ? this.boxSelectionWidth : Math.min(p.length, this.l.song.barCount - this.boxSelectionBar); if (o || 1 != p.length || 1 != i.length) if (this.patternSelectionActive) { const t = {}, e = {}; n.append(new Li(this.l, this.boxSelectionBar, u, this.boxSelectionChannel, h)); for (let i = 0; i < u; i++) { const o = this.boxSelectionBar + i, h = p[i % p.length] >>> 0, a = this.l.song.channels[r].bars[o], l = [h, a].join(","); if (0 == h && 0 == a) continue; if (null != t[l]) { n.append(new _t(this.l, t[l], o, r, 1, 1)); continue } if (0 == a) { n.append(new ii(this.l, r, o)); const t = d[String(h)], e = this.dm(t, r), i = this.l.song.getPattern(r, o); n.append(new Ye(this.l, r, e, i)) } else { const t = this.l.song.getPattern(r, o); if (null == t) throw new Error; if (e[String(a)]) { n.append(new _t(this.l, 0, o, r, 1, 1)), n.append(new ii(this.l, r, o)); const e = this.l.song.getPattern(r, o); if (null == e) throw new Error; for (const i of t.cloneNotes()) n.append(new Mi(this.l, e, i, e.notes.length, !1)) } else e[String(a)] = !0 } const c = this.l.song.getPattern(r, o); if (null == c) throw new Error; if (0 == h) n.append(new Fi(this.l, c, this.patternSelectionStart, this.patternSelectionEnd)); else { const t = d[String(h)]; n.append(new Ke(this.l, c, t.notes, this.patternSelectionStart, this.patternSelectionEnd, s)) } t[l] = this.l.song.channels[r].bars[o] } } else { for (let t = 0; t < u; t++)this.erasePatternInBar(n, r, this.boxSelectionBar + t); const t = {}; for (let i = 0; i < u; i++) { const o = this.boxSelectionBar + i, h = p[i % p.length] >>> 0, a = String(h); if (0 == h) continue; if (null != t[a]) { n.append(new _t(this.l, t[a], o, r, 1, 1)); continue } const l = d[String(h)], c = this.dm(l, r), u = this.l.song.channels[r].patterns[h - 1]; if (null != u && s == e.partsPerBeat * this.l.song.beatsPerBar && yi(l.notes, u.notes) && Lt(c, u.instruments)) n.append(new _t(this.l, h, o, r, 1, 1)); else { null != u && this.pm(r, h) ? n.append(new _t(this.l, h, o, r, 1, 1)) : n.append(new ii(this.l, r, o)); const t = this.l.song.getPattern(r, o); if (null == t) throw new Error; n.append(new Ke(this.l, t, l.notes, this.patternSelectionActive ? this.patternSelectionStart : 0, this.patternSelectionActive ? this.patternSelectionEnd : e.partsPerBeat * this.l.song.beatsPerBar, s)), n.append(new Ye(this.l, r, c, t)) } t[a] = this.l.song.channels[r].bars[o] } } else { const t = p[0] >>> 0, i = this.boxSelectionBar, o = this.l.song.channels[r].bars[i]; if (0 == t && 0 == o) continue; const h = d[String(t)], a = this.dm(h, r); if (0 == o) { const e = this.l.song.channels[r].patterns[t - 1]; null != e && !this.patternSelectionActive && (yi(h.notes, e.notes) && Lt(a, e.instruments) || this.pm(r, t)) ? n.append(new _t(this.l, t, i, r, 1, 1)) : n.append(new ii(this.l, r, i)) } const l = this.l.song.getPattern(r, i); if (null == l) throw new Error; n.append(new Ke(this.l, l, h.notes, this.patternSelectionActive ? this.patternSelectionStart : 0, this.patternSelectionActive ? this.patternSelectionEnd : e.partsPerBeat * this.l.song.beatsPerBar, s)), (0 == o || 0 == h.notes.length || r >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) && (this.selectInstrument(a[0]), n.append(new Ye(this.l, r, a, l))) } } this.l.record(n) } erasePatternInBar(t, e, i) { const s = this.l.song.channels[e].bars[i]; 0 != s && (t.append(new _t(this.l, 0, i, e, 1, 1)), this.pm(e, s) && (this.l.song.channels[e].patterns[s - 1].notes.length = 0)) } pasteNumbers() { const t = JSON.parse(String(window.localStorage.getItem("selectionCopy"))); if (null == t) return; const e = t.channels || [], i = new Pt, s = this.boxSelectionActive, n = s ? this.boxSelectionHeight : Math.min(e.length, this.l.song.getChannelCount() - this.boxSelectionChannel); for (let t = 0; t < n; t++) { const n = e[t % e.length], o = this.boxSelectionChannel + t, h = n.bars || []; if (0 == h.length) continue; const a = s ? this.boxSelectionWidth : Math.min(h.length, this.l.song.barCount - this.boxSelectionBar); for (let t = 0; t < a; t++) { const e = h[t % h.length] >>> 0, s = this.boxSelectionBar + t; e > this.l.song.patternsPerChannel && i.append(new ei(this.l, e)), i.append(new _t(this.l, e, s, o, 1, 1)) } } this.l.record(i) } selectAll() { new Pi(this.l, 0, 0), 0 == this.boxSelectionBar && 0 == this.boxSelectionChannel && this.boxSelectionWidth == this.l.song.barCount && this.boxSelectionHeight == this.l.song.getChannelCount() ? this.setTrackSelection(this.l.bar, this.l.bar, this.l.channel, this.l.channel) : this.setTrackSelection(0, this.l.song.barCount - 1, 0, this.l.song.getChannelCount() - 1), this.selectionUpdated() } selectChannel() { new Pi(this.l, 0, 0), 0 == this.boxSelectionBar && this.boxSelectionWidth == this.l.song.barCount ? this.setTrackSelection(this.l.bar, this.l.bar, this.boxSelectionY0, this.boxSelectionY1) : this.setTrackSelection(0, this.l.song.barCount - 1, this.boxSelectionY0, this.boxSelectionY1), this.selectionUpdated() } duplicatePatterns() { this.l.record(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)) } muteChannels(t) { if (t) { let t = !1; for (let e = 0; e < this.l.song.channels.length; e++)if (this.l.song.channels[e].muted) { t = !0; break } for (let e = 0; e < this.l.song.channels.length; e++)this.l.song.channels[e].muted = !t } else { let t = !1; for (const e of this.am()) if (!this.l.song.channels[e].muted) { t = !0; break } for (const e of this.am()) this.l.song.channels[e].muted = t } this.l.notifier.changed() } soloChannels(t) { let i = !0; if (this.boxSelectionChannel >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) { const i = this.l.song.channels[this.boxSelectionChannel], s = i.bars[this.l.bar] - 1, n = s >= 0 ? i.instruments[i.patterns[s].instruments[0]] : i.instruments[this.l.viewedInstrument[this.boxSelectionChannel]], o = []; let h = !t; for (let t = 0; t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; t++) { o[t] = !1; for (let i = 0; i < e.modCount; i++)n.modChannels[i] == t && (o[t] = !0) } for (let e = 0; e < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; e++)if (this.l.song.channels[e].muted == o[e]) { h = t; break } for (let t = 0; t < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; t++)this.l.song.channels[t].muted = !h && !o[t] } else { for (let e = 0; e < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; e++) { const s = e < this.boxSelectionChannel || e >= this.boxSelectionChannel + this.boxSelectionHeight ? !t : t; if (this.l.song.channels[e].muted != s) { i = !1; break } } if (i) for (let t = 0; t < this.l.song.channels.length; t++)this.l.song.channels[t].muted = !1; else for (let e = 0; e < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount; e++)this.l.song.channels[e].muted = e < this.boxSelectionChannel || e >= this.boxSelectionChannel + this.boxSelectionHeight ? !t : t } this.l.notifier.changed() } forceRhythm() { const t = new Pt; this.boxSelectionActive && t.append(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)); for (const e of this.am()) for (const i of this.rm(e)) t.append(new oi(this.l, i)); this.l.record(t) } forceScale() { const t = new Pt; this.boxSelectionActive && t.append(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)); const i = [!0, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1, !1]; for (const t of this.am()) if (!this.l.song.getChannelIsNoise(t) && !this.l.song.getChannelIsMod(t)) for (const e of this.rm(t)) Dt(e, i); const s = function (t, i) { const s = e.scales[i].flags, n = [], o = []; for (let e = 0; e < 12; e++)t[e] && n.push(e), s[e] && o.push(e); const h = n.length > o.length, a = h ? o : n, r = h ? n : o, l = ["root", "second", "second", "third", "third", "fourth", "tritone", "fifth", "sixth", "sixth", "seventh", "seventh", "root"]; let c = Number.MAX_SAFE_INTEGER, d = []; const p = [[0]]; for (; p.length > 0;) { const t = p.pop(); if (t.length == a.length) { let e = 0; for (let i = 0; i < t.length; i++)e += Math.abs(a[i] - r[t[i]]), l[a[i]] != l[r[t[i]]] && (e += .75); c > e && (c = e, d = t) } else { const e = t[t.length - 1] + 1, i = r.length - a.length + t.length; for (let s = e; s <= i; s++)p.push(t.concat(s)) } } const u = []; for (let t = 0; t < d.length; t++) { const e = a[t], i = r[d[t]]; u[t] = h ? [i, e] : [e, i] } u.push([12, 12]), o.push(12); let m = 0; const f = []; for (let t = 0; t < 12; t++) { const e = u[m][0], i = u[m][1], s = u[m + 1][0], n = u[m + 1][1]; t == s - 1 && m++; const h = (t - e) * (n - i) / (s - e) + i; let a = 0, r = Number.MAX_SAFE_INTEGER; for (const e of o) { let i = Math.abs(e - h); l[e] != l[t] && (i += .1), r > i && (r = i, a = e) } f[t] = a } return f }(i, this.l.song.scale); for (const e of this.am()) if (!this.l.song.getChannelIsNoise(e) && !this.l.song.getChannelIsMod(e)) for (const i of this.rm(e)) t.append(new qi(this.l, i, s)); this.l.record(t) } setTrackSelection(t, e, i, s) { this.nm = new Pt, this.nm.append(new Ii(this.l, t, e, i, s)), this.l.record(this.nm, !0) } transpose(t, e) { const i = this.l.lastChangeWas(this.sm); this.sm = new Pt, this.boxSelectionActive && this.sm.append(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)); for (const i of this.am()) if (!(i >= this.l.song.pitchChannelCount + this.l.song.noiseChannelCount)) for (const s of this.rm(i)) this.sm.append(new Ti(this.l, i, s, t, this.l.prefs.notesOutsideScale, e)); this.l.record(this.sm, i) } swapChannels(t) { const e = [this.l.song.pitchChannelCount, this.l.song.pitchChannelCount + this.l.song.noiseChannelCount, this.l.song.pitchChannelCount + this.l.song.noiseChannelCount + this.l.song.modChannelCount, this.l.song.getChannelCount()]; let i = 0, s = 0; for (const n of e) { if (this.boxSelectionChannel < n && t < 0 || this.boxSelectionChannel + this.boxSelectionHeight <= n) { s = n - 1; break } i = n } const n = Math.max(this.boxSelectionChannel, i), o = Math.min(this.boxSelectionChannel + this.boxSelectionHeight - 1, s); if (t = Math.max(t, i - n), 0 != (t = Math.min(t, s - o))) { const e = this.l.lastChangeWas(this.hm); this.hm = new Pt, this.boxSelectionY0 = n + t, this.boxSelectionY1 = o + t, this.hm.append(new Jt(this.l, n, o, t)), this.hm.append(new Zt(this.l, Math.max(this.boxSelectionY0, Math.min(this.boxSelectionY1, this.l.channel + t)), this.l.bar)), this.selectionUpdated(), this.l.record(this.hm, e) } } selectInstrument(t) { if (this.l.viewedInstrument[this.l.channel] == t) { if (this.l.song.layeredInstruments && this.l.song.patternInstruments && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount) { const e = this.l.lastChangeWas(this.om); this.om = new Pt; const i = this.l.recentPatternInstruments[this.l.channel]; if (-1 == i.indexOf(t)) { i.push(t); const e = this.l.song.getMaxInstrumentsPerPattern(this.l.channel); i.length > e && i.splice(0, i.length - e) } else i.splice(i.indexOf(t), 1), 0 == i.length && (i[0] = 0); this.boxSelectionActive && this.om.append(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)); for (const t of this.am()) for (const e of this.rm(t)) this.om.append(new Ye(this.l, t, i, e)); this.om.isNoop() || this.l.record(this.om, e) } } else { const e = this.l.lastChangeWas(this.om); if (this.om = new Pt, this.om.append(new He(this.l, t)), this.l.song.layeredInstruments && this.l.channel < this.l.song.pitchChannelCount + this.l.song.noiseChannelCount || !this.l.song.patternInstruments) this.l.hasRedoHistory() || this.l.record(this.om, e); else { this.boxSelectionActive && this.om.append(new Li(this.l, this.boxSelectionBar, this.boxSelectionWidth, this.boxSelectionChannel, this.boxSelectionHeight)); const i = [t]; for (const t of this.am()) for (const e of this.rm(t)) this.om.append(new Ye(this.l, t, i, e)); this.l.record(this.om, e) } } } resetBoxSelection() { this.boxSelectionX0 = this.boxSelectionX1 = this.l.bar, this.boxSelectionY0 = this.boxSelectionY1 = this.l.channel } } class Bo { constructor() { this.volume = 75, this.visibleOctaves = Bo.defaultVisibleOctaves, this.reload() } reload() { this.autoPlay = "true" == window.localStorage.getItem("autoPlay"), this.autoFollow = "false" != window.localStorage.getItem("autoFollow"), this.enableNotePreview = "false" != window.localStorage.getItem("enableNotePreview"), this.showFifth = "true" == window.localStorage.getItem("showFifth"), this.notesOutsideScale = "true" == window.localStorage.getItem("notesOutsideScale"), this.showLetters = "true" == window.localStorage.getItem("showLetters"), this.showChannels = "true" == window.localStorage.getItem("showChannels"), this.showScrollBar = "true" == window.localStorage.getItem("showScrollBar"), this.alwaysFineNoteVol = "true" == window.localStorage.getItem("alwaysFineNoteVol"), this.displayVolumeBar = "true" == window.localStorage.getItem("displayVolumeBar"), this.instrumentCopyPaste = "true" == window.localStorage.getItem("instrumentCopyPaste"), this.enableChannelMuting = "true" == window.localStorage.getItem("enableChannelMuting"), this.displayBrowserUrl = "false" != window.localStorage.getItem("displayBrowserUrl"), this.pressControlForShortcuts = "true" == window.localStorage.getItem("pressControlForShortcuts"), this.enableMidi = "false" != window.localStorage.getItem("enableMidi"), this.showRecordButton = "true" == window.localStorage.getItem("showRecordButton"), this.snapRecordedNotesToRhythm = "true" == window.localStorage.getItem("snapRecordedNotesToRhythm"), this.ignorePerformedNotesNotInScale = "true" == window.localStorage.getItem("ignorePerformedNotesNotInScale"), this.metronomeCountIn = "false" != window.localStorage.getItem("metronomeCountIn"), this.metronomeWhileRecording = "false" != window.localStorage.getItem("metronomeWhileRecording"), this.keyboardLayout = window.localStorage.getItem("keyboardLayout") || "wickiHayden", this.layout = window.localStorage.getItem("layout") || "small", this.colorTheme = window.localStorage.getItem("colorTheme") || "dark classic", this.visibleOctaves = window.localStorage.getItem("visibleOctaves") >>> 0 || Bo.defaultVisibleOctaves; const t = e.scales.dictionary[window.localStorage.getItem("defaultScale")]; this.defaultScale = null != t ? t.index : 0, null != window.localStorage.getItem("volume") && (this.volume = Math.min(window.localStorage.getItem("volume") >>> 0, 75)), null != window.localStorage.getItem("fullScreen") && ("true" == window.localStorage.getItem("fullScreen") && (this.layout = "long"), window.localStorage.removeItem("fullScreen")) } save() { window.localStorage.setItem("autoPlay", this.autoPlay ? "true" : "false"), window.localStorage.setItem("autoFollow", this.autoFollow ? "true" : "false"), window.localStorage.setItem("enableNotePreview", this.enableNotePreview ? "true" : "false"), window.localStorage.setItem("showFifth", this.showFifth ? "true" : "false"), window.localStorage.setItem("notesOutsideScale", this.notesOutsideScale ? "true" : "false"), window.localStorage.setItem("defaultScale", e.scales[this.defaultScale].name), window.localStorage.setItem("showLetters", this.showLetters ? "true" : "false"), window.localStorage.setItem("showChannels", this.showChannels ? "true" : "false"), window.localStorage.setItem("showScrollBar", this.showScrollBar ? "true" : "false"), window.localStorage.setItem("alwaysFineNoteVol", this.alwaysFineNoteVol ? "true" : "false"), window.localStorage.setItem("displayVolumeBar", this.displayVolumeBar ? "true" : "false"), window.localStorage.setItem("enableChannelMuting", this.enableChannelMuting ? "true" : "false"), window.localStorage.setItem("instrumentCopyPaste", this.instrumentCopyPaste ? "true" : "false"), window.localStorage.setItem("displayBrowserUrl", this.displayBrowserUrl ? "true" : "false"), window.localStorage.setItem("pressControlForShortcuts", this.pressControlForShortcuts ? "true" : "false"), window.localStorage.setItem("enableMidi", this.enableMidi ? "true" : "false"), window.localStorage.setItem("showRecordButton", this.showRecordButton ? "true" : "false"), window.localStorage.setItem("snapRecordedNotesToRhythm", this.snapRecordedNotesToRhythm ? "true" : "false"), window.localStorage.setItem("ignorePerformedNotesNotInScale", this.ignorePerformedNotesNotInScale ? "true" : "false"), window.localStorage.setItem("metronomeCountIn", this.metronomeCountIn ? "true" : "false"), window.localStorage.setItem("metronomeWhileRecording", this.metronomeWhileRecording ? "true" : "false"), window.localStorage.setItem("keyboardLayout", this.keyboardLayout), window.localStorage.setItem("layout", this.layout), window.localStorage.setItem("colorTheme", this.colorTheme), window.localStorage.setItem("volume", String(this.volume)), window.localStorage.setItem("visibleOctaves", String(this.visibleOctaves)) } } Bo.defaultVisibleOctaves = 3; class Ro { constructor() { this.um = [], this.fm = !1 } watch(t) { -1 == this.um.indexOf(t) && this.um.push(t) } unwatch(t) { const e = this.um.indexOf(t); -1 != e && this.um.splice(e, 1) } changed() { this.fm = !0 } notifyWatchers() { if (this.fm) { this.fm = !1; for (const t of this.um.concat()) t() } } } class Oo { constructor() { this.notifier = new Ro, this.selection = new zo(this), this.prefs = new Bo, this.channel = 0, this.muteEditorChannel = 0, this.bar = 0, this.recentPatternInstruments = [], this.viewedInstrument = [], this.trackVisibleBars = 16, this.trackVisibleChannels = 4, this.barScrollPos = 0, this.channelScrollPos = 0, this.prompt = null, this.addedEffect = !1, this.addedEnvelope = !1, this.currentPatternIsDirty = !1, this.ym = new Hn, this.bm = null, this.gm = 0, this.wm = 0, this.vm = !1, this.km = !1, this.xm = !1, this.Mm = () => { if (this.synth.recording && this.performance.abortRecording(), null == window.history.state && "" != window.location.hash) { this.gm++, this.Sm(); const t = { canUndo: !0, sequenceNumber: this.gm, bar: this.bar, channel: this.channel, instrument: this.viewedInstrument[this.channel], recoveryUid: this.Fm, prompt: null, selection: this.selection.toJSON() }; return new ui(this, window.location.hash), this.prompt = t.prompt, this.prefs.displayBrowserUrl ? this.Cm(t, this.song.toBase64String()) : this.Em(t, this.song.toBase64String()), this.forgetLastChange(), this.notifier.notifyWatchers(), this.synth.pause(), void this.synth.goToBar(0) } const t = this.Tm(); if (null == t) throw new Error("History state is null."); t.sequenceNumber != this.gm && (this.bar = t.bar, this.channel = t.channel, this.viewedInstrument[this.channel] = t.instrument, this.gm = t.sequenceNumber, this.prompt = t.prompt, new ui(this, this.Im()), this.Fm = t.recoveryUid, this.selection.fromJSON(t.selection), this.forgetLastChange(), this.notifier.notifyWatchers()) }, this.Pm = () => { this.notifier.notifyWatchers() }, this.Am = () => { const t = this.song.getChannelCount(); for (let e = this.recentPatternInstruments.length; e < t; e++)this.recentPatternInstruments[e] = [0]; this.recentPatternInstruments.length = t; for (let e = 0; e < t; e++) { if (e == this.channel) if (this.song.patternInstruments) { const t = this.song.getPattern(this.channel, this.bar); null != t && (this.recentPatternInstruments[e] = t.instruments.concat()) } else { const t = this.song.channels[this.channel]; for (let i = 0; i < t.instruments.length; i++)this.recentPatternInstruments[e][i] = i; this.recentPatternInstruments[e].length = t.instruments.length } qt(this.recentPatternInstruments[e], this.song, e) } for (let e = this.viewedInstrument.length; e < t; e++)this.viewedInstrument[e] = 0; this.viewedInstrument.length = t; for (let e = 0; e < t; e++) { if (this.song.patternInstruments && !this.song.layeredInstruments && e == this.channel) { const t = this.song.getPattern(this.channel, this.bar); null != t && (this.viewedInstrument[e] = t.instruments[0]) } this.viewedInstrument[e] = Math.min(0 | this.viewedInstrument[e], this.song.channels[e].instruments.length - 1) } const e = this.getCurrentPattern(); null != e && this.song.patternInstruments && (this.recentPatternInstruments[this.channel] = e.instruments.concat()), (!this.synth.playing && (this.bar < this.selection.boxSelectionBar || this.selection.boxSelectionBar + this.selection.boxSelectionWidth <= this.bar) || this.channel < this.selection.boxSelectionChannel || this.selection.boxSelectionChannel + this.selection.boxSelectionHeight <= this.channel || this.song.barCount < this.selection.boxSelectionBar + this.selection.boxSelectionWidth || t < this.selection.boxSelectionChannel + this.selection.boxSelectionHeight || 1 == this.selection.boxSelectionWidth && 1 == this.selection.boxSelectionHeight) && this.selection.resetBoxSelection() }, this.Lm = () => { let t; this.xm = !1; try { t = this.song.toBase64String() } catch (t) { return void window.alert('Whoops, the song data appears to have been corrupted! Please try to recover the last working version of the song from the "Recover Recent Song..." option in BeepBox\'s "File" menu.') } this.vm && this.gm++, this.km ? this.Sm() : this.ym.saveVersion(this.Fm, this.song.title, t); let e = { canUndo: !0, sequenceNumber: this.gm, bar: this.bar, channel: this.channel, instrument: this.viewedInstrument[this.channel], recoveryUid: this.Fm, prompt: this.prompt, selection: this.selection.toJSON() }; this.vm ? this.Em(e, t) : this.Cm(e, t), this.vm = !1, this.km = !1 }, this.notifier.watch(this.Am), j.setTheme(this.prefs.colorTheme), qs.setLayout(this.prefs.layout), null == window.sessionStorage.getItem("currentUndoIndex") && (window.sessionStorage.setItem("currentUndoIndex", "0"), window.sessionStorage.setItem("oldestUndoIndex", "0"), window.sessionStorage.setItem("newestUndoIndex", "0")); let t = window.location.hash; "" == t && (t = this.Im()), this.song = new kt(t), "" != t && null != t || (pi(this.song), this.song.scale = this.prefs.defaultScale), t = this.song.toBase64String(), this.synth = new Et(this.song), this.synth.volume = this.qm(), this.synth.anticipatePoorPerformance = M; let e = this.Tm(); null == e && (e = { canUndo: !1, sequenceNumber: 0, bar: 0, channel: 0, instrument: 0, recoveryUid: Rn(), prompt: null, selection: this.selection.toJSON() }), null == e.recoveryUid && (e.recoveryUid = Rn()), this.Cm(e, t), window.addEventListener("hashchange", this.Mm), window.addEventListener("popstate", this.Mm), this.bar = 0 | e.bar, this.channel = 0 | e.channel; for (let t = 0; t <= this.channel; t++)this.viewedInstrument[t] = 0; this.viewedInstrument[this.channel] = 0 | e.instrument, this.Fm = e.recoveryUid, this.prompt = e.prompt, this.selection.fromJSON(e.selection); for (const t of ["input", "change", "click", "keyup", "keydown", "mousedown", "mousemove", "mouseup", "touchstart", "touchmove", "touchend", "touchcancel"]) window.addEventListener(t, this.Pm); this.Am(), this.performance = new No(this) } toggleDisplayBrowserUrl() { const t = this.Tm(); this.prefs.displayBrowserUrl = !this.prefs.displayBrowserUrl, this.Cm(t, this.song.toBase64String()) } Tm() { if (this.prefs.displayBrowserUrl) return window.history.state; { const t = JSON.parse(window.sessionStorage.getItem(window.sessionStorage.getItem("currentUndoIndex"))); return null == t ? null : t.state } } Im() { if (this.prefs.displayBrowserUrl) return window.location.hash; { const t = JSON.parse(window.sessionStorage.getItem(window.sessionStorage.getItem("currentUndoIndex"))); return null == t ? "" : t.hash } } Cm(t, e) { this.prefs.displayBrowserUrl ? window.history.replaceState(t, "", "#" + e) : (window.sessionStorage.setItem(window.sessionStorage.getItem("currentUndoIndex") || "0", JSON.stringify({ state: t, hash: e })), window.history.replaceState(null, "", location.pathname)) } Em(t, e) { if (this.prefs.displayBrowserUrl) window.history.pushState(t, "", "#" + e); else { let i = Number(window.sessionStorage.getItem("currentUndoIndex")), s = Number(window.sessionStorage.getItem("oldestUndoIndex")); i = (i + 1) % Oo.Dm, window.sessionStorage.setItem("currentUndoIndex", String(i)), window.sessionStorage.setItem("newestUndoIndex", String(i)), i == s && (s = (s + 1) % Oo.Dm, window.sessionStorage.setItem("oldestUndoIndex", String(s))), window.sessionStorage.setItem(String(i), JSON.stringify({ state: t, hash: e })), window.history.replaceState(null, "", location.pathname) } this.wm = t.sequenceNumber } hasRedoHistory() { return this.wm > this.gm } Nm() { if (this.prefs.displayBrowserUrl) window.history.forward(); else { let t = Number(window.sessionStorage.getItem("currentUndoIndex")); t != Number(window.sessionStorage.getItem("newestUndoIndex")) && (t = (t + 1) % Oo.Dm, window.sessionStorage.setItem("currentUndoIndex", String(t)), setTimeout(this.Mm)) } } zm() { if (this.prefs.displayBrowserUrl) window.history.back(); else { let t = Number(window.sessionStorage.getItem("currentUndoIndex")); t != Number(window.sessionStorage.getItem("oldestUndoIndex")) && (t = (t + Oo.Dm - 1) % Oo.Dm, window.sessionStorage.setItem("currentUndoIndex", String(t)), setTimeout(this.Mm)) } } record(t, e = !1, i = !1) { t.isNoop() ? (this.bm = null, e && this.zm()) : (t.commit(), this.bm = t, this.vm = this.vm || !e, this.km = this.km || i, this.xm || (window.requestAnimationFrame(this.Lm), this.xm = !0)) } Sm() { this.Fm = Rn() } openPrompt(t) { this.prompt = t; const e = this.song.toBase64String(); this.gm++; const i = { canUndo: !0, sequenceNumber: this.gm, bar: this.bar, channel: this.channel, instrument: this.viewedInstrument[this.channel], recoveryUid: this.Fm, prompt: this.prompt, selection: this.selection.toJSON() }; this.Em(i, e) } undo() { this.Tm().canUndo && this.zm() } redo() { this.Nm() } setProspectiveChange(t) { this.bm = t } forgetLastChange() { this.bm = null } lastChangeWas(t) { return null != t && t == this.bm } goBackToStart() { this.bar = 0, this.channel = 0, this.barScrollPos = 0, this.channelScrollPos = 0, this.synth.snapToStart(), this.notifier.changed() } setVolume(t) { this.prefs.volume = t, this.prefs.save(), this.synth.volume = this.qm() } qm() { return Math.min(1, Math.pow(this.prefs.volume / 50, .5)) * Math.pow(2, (this.prefs.volume - 75) / 25) } getCurrentPattern(t = 0) { return this.song.getPattern(this.channel, this.bar + t) } getCurrentInstrument(t = 0) { if (0 == t) return this.viewedInstrument[this.channel]; { const e = this.getCurrentPattern(t); return null == e ? 0 : e.instruments[0] } } getMobileLayout() { return "wide" == this.prefs.layout ? window.innerWidth <= 1e3 : window.innerWidth <= 710 } getBarWidth() { return this.getMobileLayout() || !this.prefs.enableChannelMuting || this.getFullScreen() && "wide" != this.prefs.layout ? 32 : 30 } getChannelHeight() { const t = this.getMobileLayout() || this.song.getChannelCount() > 4 || this.song.barCount > this.trackVisibleBars && this.song.getChannelCount() > 3; return !this.getMobileLayout() && ("wide" != this.prefs.layout && this.song.getChannelCount() > 11 || this.song.getChannelCount() > 22) ? 23 : t ? 27 : 32 } getFullScreen() { return !this.getMobileLayout() && "small" != this.prefs.layout } getVisibleOctaveCount() { return this.getFullScreen() ? this.prefs.visibleOctaves : Bo.defaultVisibleOctaves } getVisiblePitchCount() { return this.getVisibleOctaveCount() * e.pitchesPerOctave + 1 } getBaseVisibleOctave(t) { const i = this.getVisibleOctaveCount(); return Math.max(0, Math.min(e.pitchOctaves - i, Math.ceil(this.song.channels[t].octave - .5 * i))) } } Oo.Dm = 300; const $o = new Oo, Ho = new Do($o); if (document.getElementById("beepboxEditorContainer").appendChild(Ho.mainLayer), Ho.whenUpdated(), Ho.mainLayer.className += " load", Ho.mainLayer.getElementsByClassName("pattern-area")[0].className += " load", Ho.mainLayer.getElementsByClassName("settings-area")[0].className += " load", Ho.mainLayer.getElementsByClassName("editor-song-settings")[0].className += " load", Ho.mainLayer.getElementsByClassName("instrument-settings-area")[0].className += " load", Ho.mainLayer.getElementsByClassName("trackAndMuteContainer")[0].className += " load", Ho.mainLayer.getElementsByClassName("barScrollBar")[0].className += " load", $("#pitchPresetSelect").select2({ dropdownAutoWidth: !0 }), $("#drumPresetSelect").select2({ dropdownAutoWidth: !0 }), $("body").on("click", ".select2-container--open .select2-results__group", (function () { $(this).siblings().toggle() })), $("#pitchPresetSelect").on("select2:open", (function () { $(".select2-dropdown--below").css("opacity", 0), $(".select2-dropdown").css("opacity", 1), $("#pitchPresetSelect"), setTimeout((() => { let t = $(".select2-container--open .select2-results__group"), e = $(".select2-container--open .select2-results__option"); $.each(t, ((t, e) => { $(e).siblings().hide(), $(e)[0].setAttribute("style", "color: " + j.getChannelColor($o.song, $o.channel).primaryNote + ";") })), $.each(e, ((t, e) => { $(e)[0].setAttribute("style", "color: " + j.getChannelColor($o.song, $o.channel).primaryNote + ";") })), $(".select2-dropdown--below").css("opacity", 1) }), 0) })), $("#drumPresetSelect").on("select2:open", (function () { $(".select2-dropdown--below").css("opacity", 0), $(".select2-dropdown").css("opacity", 1), $("#drumPresetSelect"), setTimeout((() => { let t = $(".select2-container--open .select2-results__group"), e = $(".select2-container--open .select2-results__option"); $.each(t, ((t, e) => { $(e).siblings().hide(), $(e)[0].setAttribute("style", "color: " + j.getChannelColor($o.song, $o.channel).primaryNote + ";") })), $.each(e, ((t, e) => { $(e)[0].setAttribute("style", "color: " + j.getChannelColor($o.song, $o.channel).primaryNote + ";") })), $(".select2-dropdown--below").css("opacity", 1) }), 0) })), $("#pitchPresetSelect").on("change", Ho.pu), $("#pitchPresetSelect").on("select2:close", Ho.du), $("#drumPresetSelect").on("change", Ho.mu), $("#drumPresetSelect").on("select2:close", Ho.du), Ho.mainLayer.focus(), !M && $o.prefs.autoPlay) { function Vo() { document.hidden || ($o.synth.play(), Ho.updatePlayButton(), window.removeEventListener("visibilitychange", Vo)) } document.hidden ? window.addEventListener("visibilitychange", Vo) : window.setTimeout(Vo) } return "scrollRestoration" in history && (history.scrollRestoration = "manual"), Ho.updatePlayButton(), "serviceWorker" in navigator && navigator.serviceWorker.register("/service_worker.js", { updateViaCache: "all", scope: "/" }).catch((() => { })), t.ChangePreset = $t, t.Channel = vt, t.ColorConfig = j, t.Config = e, t.EditorConfig = F, t.ExportPrompt = Ls, t.Instrument = wt, t.Note = lt, t.Pattern = ct, t.Song = kt, t.SongDocument = Oo, t.SongEditor = Do, t.Synth = Et, Object.defineProperty(t, "Bm", { value: !0 }), t
        }({});
//# sourceMappingURL=beepbox_editor.min.js.map
    </script>
    <script src="main.js"></script>
</body>

</html>